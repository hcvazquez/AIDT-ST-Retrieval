<!doctype html>
<html lang="en" dir="ltr" class="client-nojs">
 <head> 
  <meta charset="UTF-8"> 
  <title>Grayscale image - Rosetta Code</title> 
  <script src="/cdn-cgi/apps/head/7qaJovFEYxjqsAZAxmfekTkNrFg.js"></script>
  <script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"https://ajax.cloudflare.com/cdn-cgi/nexp/dok3v=9eecb7db59/","cloudflare-static": "https://ajax.cloudflare.com/cdn-cgi/scripts/c2b63e8a/"},atok:"729967fafbcdab984b4962ab8571d1ba",petok:"bd9574398116bdf8fb1639923cf799cd2dfea6cd-1506973886-1800",rocket: "a",zone:"rosettacode.org"}];document.write('<script type="text/javascript" src="https://ajax.cloudflare.com/cdn-cgi/nexp/dok3v=c37cbdadf2/cloudflare.min.js"><'+'\/script>');}}catch(e){};
//]]>
</script> 
  <script type="text/rocketscript">document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script> 
  <script type="text/rocketscript">window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":0,"wgPageName":"Grayscale_image","wgTitle":"Grayscale image","wgCurRevisionId":237790,"wgRevisionId":237790,"wgArticleId":3224,"wgIsArticle":!0,"wgIsRedirect":!1,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Programming Tasks","Image processing","Ada","BASIC256","Batch File/Omit","BBC BASIC","C","C sharp","Clojure","Common Lisp","D","Euler Math Toolbox","Erlang","Euphoria","FBSL","Forth","Fortran","Go","Haskell","J","Java","JavaScript","Julia","Lingo","Lua","Mathematica","Wolfram Language","MATLAB","OCaml","Octave","Oz","Perl","Imlib2","Perl 6","Phix","PHP","PL/I","PicoLisp","PureBasic","Python","R","Pixmap","Racket","REXX","Ruby","Scala","Sidef","Tcl","Tk","Vedit macro language","Visual Basic .NET","Zkl","AWK/Omit","Lotus 123 Macro Scripting/Omit","ML/I/Omit","PARI/GP/Omit","TI-83 BASIC/Omit","TI-89 BASIC/Omit"],"wgBreakFrames":!1,"wgPageContentLanguage":
"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Grayscale_image","wgRelevantArticleId":3224,"wgIsProbablyEditable":!0,"wgRestrictionEdit":[],"wgRestrictionMove":[],"sfgAutocompleteValues":[],"sfgAutocompleteOnAllChars":!1,"sfgFieldProperties":[],"sfgDependentFields":[],"sfgShowOnSelect":[],"sfgScriptPath":"/mw/extensions/SemanticForms","sdgDownArrowImage":"/mw/extensions/SemanticDrilldown/skins/down-arrow.png","sdgRightArrowImage":"/mw/extensions/SemanticDrilldown/skins/right-arrow.png"});mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});mw.loader.load(["ext.smw.style","ext.smw.tooltips","mediawiki.page.startup","mediawiki.legacy.wikibits"]);
} );</script> 
  <link rel="stylesheet" href="/mw/load.php?debug=false&amp;lang=en&amp;modules=ext.bootstrap.styles&amp;only=styles&amp;skin=chameleon"> 
  <meta name="ResourceLoaderDynamicStyles" content=""> 
  <link rel="stylesheet" href="/mw/load.php?debug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=chameleon"> 
  <style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}</style> 
  <script async data-rocketsrc="/mw/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=chameleon" type="text/rocketscript"></script> 
  <meta name="generator" content="MediaWiki 1.26.2"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <link rel="ExportRDF" type="application/rdf+xml" title="Grayscale image" href="/mw/index.php?title=Special:ExportRDF/Grayscale_image&amp;xmlmime=rdf"> 
  <link rel="alternate" type="application/x-wiki" title="Edit" href="/mw/index.php?title=Grayscale_image&amp;action=edit"> 
  <link rel="edit" title="Edit" href="/mw/index.php?title=Grayscale_image&amp;action=edit"> 
  <link rel="shortcut icon" href="/favicon.ico"> 
  <link rel="search" type="application/opensearchdescription+xml" href="/mw/opensearch_desc.php" title="Rosetta Code (en)"> 
  <link rel="EditURI" type="application/rsd+xml" href="https://rosettacode.org/mw/api.php?action=rsd"> 
  <link rel="copyright" href="http://www.gnu.org/licenses/fdl-1.2.html"> 
  <link rel="alternate" type="application/atom+xml" title="Rosetta Code Atom feed" href="/mw/index.php?title=Special:RecentChanges&amp;feed=atom"> 
 </head> 
 <body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Grayscale_image layout-standard skin-chameleon action-view"> 
  <div class="container"> 
   <div class="row"> 
    <div class="col-lg-3"> 
     <div id="p-logo" class="p-logo" role="banner"> 
      <a href="/wiki/Rosetta_Code" title="Visit the main page"><img src="/mw/title.png" alt="Rosetta Code"></a> 
     </div> 
    </div> 
    <div class="col-lg-9"> 
     <div class="row"> 
      <div class="col-lg-12"> 
       <div class="p-personal pull-right" id="p-personal"> 
        <ul class="p-personal-tools list-inline pull-right"> 
         <li id="pt-createaccount"><a href="/mw/index.php?title=Special:UserLogin&amp;returnto=Grayscale+image&amp;type=signup" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li> 
         <li id="pt-login"><a href="/mw/index.php?title=Special:UserLogin&amp;returnto=Grayscale+image" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li> 
        </ul> 
        <div class="newtalk-notifier"> 
        </div> 
       </div> 
      </div> 
     </div> 
     <div class="row"> 
      <div class="col-lg-12"> 
       <div id="p-search" class="p-search pull-right" role="search"> 
        <form id="searchform" class="mw-search form-inline" action="/mw/index.php"> 
         <input type="hidden" name="title" value="Special:Search"> 
         <div class="input-group"> 
          <input name="search" placeholder="Search" title="Search Rosetta Code [f]" accesskey="f" id="searchInput" class="form-control"> 
          <div class="input-group-btn"> 
           <button value="Go" id="searchGoButton" name="go" title="Go to a page with this exact name if it exists" type="submit" class="searchGoButton btn btn-default"><span class="glyphicon glyphicon-share-alt"></span></button>
           <button value="Search" id="mw-searchButton" name="fulltext" title="Search the pages for this text" type="submit" class="mw-searchButton btn btn-default"><span class="glyphicon glyphicon-search"></span></button> 
          </div> 
         </div> 
        </form> 
       </div> 
      </div> 
     </div> 
    </div> 
   </div> 
   <div class="row"> 
    <div class="col-lg-12"> 
     <nav class="navbar navbar-default p-navbar" role="navigation" id="mw-navigation"> 
      <div class="container-fluid">
       <div class="navbar-header"> 
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#mw-navigation-collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> 
       </div> 
       <div class="collapse navbar-collapse" id="mw-navigation-collapse">
        <ul class="nav navbar-nav"> 
         <li class="dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Community <b class="caret"></b></a> 
          <ul class="dropdown-menu p-Community" id="p-Community"> 
           <li id="n-Twitter"><a href="http://twitter.com/rosettacode" rel="nofollow">Twitter</a></li> 
           <li id="n-Chat.2FIRC"><a href="/wiki/Special:WebChat">Chat/IRC</a></li> 
           <li id="n-Planet"><a href="http://rosettacode.org/planet" rel="nofollow">Planet</a></li> 
           <li id="n-The-Village-Pump"><a href="/wiki/Rosetta_Code:Village_Pump">The Village Pump</a></li> 
           <li id="n-Finances"><a href="/wiki/Rosetta_Code:Finances">Finances</a></li> 
          </ul> </li> 
         <li class="dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Explore <b class="caret"></b></a> 
          <ul class="dropdown-menu p-Explore" id="p-Explore"> 
           <li id="n-Languages"><a href="/wiki/Category:Programming_Languages">Languages</a></li> 
           <li id="n-Tasks"><a href="/wiki/Category:Programming_Tasks">Tasks</a></li> 
           <li id="n-recentchanges"><a href="/wiki/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li> 
           <li id="n-Similar-sites"><a href="/wiki/Help:Similar_Sites">Similar sites</a></li> 
           <li id="n-randompage"><a href="/wiki/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li> 
          </ul> </li>
        </ul> 
       </div> 
      </div> 
     </nav> 
    </div> 
   </div> 
   <div class="row"> 
    <div class="col-lg-12"> 
     <ul class="p-contentnavigation list-inline text-center" id="p-contentnavigation"> 
      <li id="p-namespaces"> 
       <ul class="list-inline"> 
        <li id="ca-nstab-main" class="selected"><a href="/wiki/Grayscale_image" title="View the content page [c]" accesskey="c" class="selected">Page</a></li> 
        <li id="ca-talk"><a href="/wiki/Talk:Grayscale_image" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li> 
       </ul> </li> 
      <li id="p-views"> 
       <ul class="list-inline"> 
        <li id="ca-edit"><a href="/mw/index.php?title=Grayscale_image&amp;action=edit" title="Edit this page [e]" accesskey="e">Edit</a></li> 
        <li id="ca-history"><a href="/mw/index.php?title=Grayscale_image&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li> 
       </ul> </li> 
     </ul> 
    </div> 
   </div> 
   <div class="row"> 
    <div class="col-lg-12"> 
    </div> 
   </div> 
   <div class="row"> 
    <div class="col-lg-12"> 
     <div id="content" class="mw-body">
      <a id="top"></a> 
      <div id="mw-js-message" style="display:none;"></div> 
      <div class="contentHeader"> 
       <h1 id="firstHeading" class="firstHeading">Grayscale image</h1> 
       <div id="siteSub">
        From Rosetta Code
       </div>
       <div id="jump-to-nav" class="mw-jump">
        Jump to:
        <a href="#mw-navigation">navigation</a>, 
        <a href="#p-search">search</a>
       </div> 
      </div>
      <div id="bodyContent"> 
       <div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr">
        <div class="infobox" style="width: 2in">
         <div class="floatleft">
          <a href="/wiki/Category:Solutions_by_Programming_Task" title="Category:Solutions by Programming Task"><img alt="Task" src="/mw/images/thumb/b/ba/Rcode-button-task-crushed.png/64px-Rcode-button-task-crushed.png" width="64" height="64" srcset="/mw/images/thumb/b/ba/Rcode-button-task-crushed.png/96px-Rcode-button-task-crushed.png 1.5x, /mw/images/thumb/b/ba/Rcode-button-task-crushed.png/128px-Rcode-button-task-crushed.png 2x"></a>
         </div>
         <b>Grayscale image</b>
         <br> You are encouraged to 
         <a href="/wiki/Rosetta_Code:Solve_a_Task" title="Rosetta Code:Solve a Task">solve this task</a> according to the task description, using any language you may know.
        </div> 
        <p>Many image processing algorithms are defined for <a href="http://en.wikipedia.org/wiki/Grayscale" class="extiw" title="wp:Grayscale">grayscale</a> (or else monochromatic) images. </p>
        <p><br> </p> 
        <dl>
         <dt>
          Task
         </dt> 
         <dd></dd>
        </dl> 
        <p>Extend the data storage type defined <a href="/wiki/Basic_bitmap_storage" title="Basic bitmap storage" class="mw-redirect">on this page</a> to support grayscale images. </p>
        <p>Define two operations, one to convert a color image to a grayscale image and one for the backward conversion. </p>
        <p>To get luminance of a color use the formula recommended by <a rel="nofollow" class="external text" href="http://www.cie.co.at/index_ie.html">CIE</a>: </p> 
        <pre><big> L  =  0.2126 × R   +   0.7152 × G   +   0.0722 × B </big>
</pre> 
        <p>When using floating-point arithmetic make sure that rounding errors would not cause run-time problems or else distorted results when calculated luminance is stored as an unsigned integer. <br><br> </p> 
        <div id="toc" class="toc">
         <div id="toctitle">
          <h2>Contents</h2>
         </div> 
         <ul> 
          <li class="toclevel-1 tocsection-1"><a href="#Ada"><span class="tocnumber">1</span> <span class="toctext">Ada</span></a></li> 
          <li class="toclevel-1 tocsection-2"><a href="#BASIC256"><span class="tocnumber">2</span> <span class="toctext">BASIC256</span></a></li> 
          <li class="toclevel-1 tocsection-3"><a href="#BBC_BASIC"><span class="tocnumber">3</span> <span class="toctext">BBC BASIC</span></a></li> 
          <li class="toclevel-1 tocsection-4"><a href="#C"><span class="tocnumber">4</span> <span class="toctext">C</span></a></li> 
          <li class="toclevel-1 tocsection-5"><a href="#C.23"><span class="tocnumber">5</span> <span class="toctext">C#</span></a></li> 
          <li class="toclevel-1 tocsection-6"><a href="#Clojure"><span class="tocnumber">6</span> <span class="toctext">Clojure</span></a></li> 
          <li class="toclevel-1 tocsection-7"><a href="#Common_Lisp"><span class="tocnumber">7</span> <span class="toctext">Common Lisp</span></a></li> 
          <li class="toclevel-1 tocsection-8"><a href="#D"><span class="tocnumber">8</span> <span class="toctext">D</span></a></li> 
          <li class="toclevel-1 tocsection-9"><a href="#Euler_Math_Toolbox"><span class="tocnumber">9</span> <span class="toctext">Euler Math Toolbox</span></a></li> 
          <li class="toclevel-1 tocsection-10"><a href="#Erlang"><span class="tocnumber">10</span> <span class="toctext">Erlang</span></a></li> 
          <li class="toclevel-1 tocsection-11"><a href="#Euphoria"><span class="tocnumber">11</span> <span class="toctext">Euphoria</span></a></li> 
          <li class="toclevel-1 tocsection-12"><a href="#FBSL"><span class="tocnumber">12</span> <span class="toctext">FBSL</span></a></li> 
          <li class="toclevel-1 tocsection-13"><a href="#Forth"><span class="tocnumber">13</span> <span class="toctext">Forth</span></a></li> 
          <li class="toclevel-1 tocsection-14"><a href="#Fortran"><span class="tocnumber">14</span> <span class="toctext">Fortran</span></a></li> 
          <li class="toclevel-1 tocsection-15"><a href="#Go"><span class="tocnumber">15</span> <span class="toctext">Go</span></a></li> 
          <li class="toclevel-1 tocsection-16"><a href="#Haskell"><span class="tocnumber">16</span> <span class="toctext">Haskell</span></a></li> 
          <li class="toclevel-1 tocsection-17"><a href="#J"><span class="tocnumber">17</span> <span class="toctext">J</span></a></li> 
          <li class="toclevel-1 tocsection-18"><a href="#Java"><span class="tocnumber">18</span> <span class="toctext">Java</span></a></li> 
          <li class="toclevel-1 tocsection-19"><a href="#JavaScript"><span class="tocnumber">19</span> <span class="toctext">JavaScript</span></a></li> 
          <li class="toclevel-1 tocsection-20"><a href="#Julia"><span class="tocnumber">20</span> <span class="toctext">Julia</span></a></li> 
          <li class="toclevel-1 tocsection-21"><a href="#Lingo"><span class="tocnumber">21</span> <span class="toctext">Lingo</span></a></li> 
          <li class="toclevel-1 tocsection-22"><a href="#Lua"><span class="tocnumber">22</span> <span class="toctext">Lua</span></a></li> 
          <li class="toclevel-1 tocsection-23"><a href="#Mathematica_.2F_Wolfram_Language"><span class="tocnumber">23</span> <span class="toctext">Mathematica / Wolfram Language</span></a></li> 
          <li class="toclevel-1 tocsection-24"><a href="#MATLAB"><span class="tocnumber">24</span> <span class="toctext">MATLAB</span></a></li> 
          <li class="toclevel-1 tocsection-25"><a href="#OCaml"><span class="tocnumber">25</span> <span class="toctext">OCaml</span></a></li> 
          <li class="toclevel-1 tocsection-26"><a href="#Octave"><span class="tocnumber">26</span> <span class="toctext">Octave</span></a></li> 
          <li class="toclevel-1 tocsection-27"><a href="#Oz"><span class="tocnumber">27</span> <span class="toctext">Oz</span></a></li> 
          <li class="toclevel-1 tocsection-28"><a href="#Perl"><span class="tocnumber">28</span> <span class="toctext">Perl</span></a></li> 
          <li class="toclevel-1 tocsection-29"><a href="#Perl_6"><span class="tocnumber">29</span> <span class="toctext">Perl 6</span></a></li> 
          <li class="toclevel-1 tocsection-30"><a href="#Phix"><span class="tocnumber">30</span> <span class="toctext">Phix</span></a></li> 
          <li class="toclevel-1 tocsection-31"><a href="#PHP"><span class="tocnumber">31</span> <span class="toctext">PHP</span></a></li> 
          <li class="toclevel-1 tocsection-32"><a href="#PL.2FI"><span class="tocnumber">32</span> <span class="toctext">PL/I</span></a></li> 
          <li class="toclevel-1 tocsection-33"><a href="#PicoLisp"><span class="tocnumber">33</span> <span class="toctext">PicoLisp</span></a></li> 
          <li class="toclevel-1 tocsection-34"><a href="#PureBasic"><span class="tocnumber">34</span> <span class="toctext">PureBasic</span></a></li> 
          <li class="toclevel-1 tocsection-35"><a href="#Python"><span class="tocnumber">35</span> <span class="toctext">Python</span></a></li> 
          <li class="toclevel-1 tocsection-36"><a href="#R"><span class="tocnumber">36</span> <span class="toctext">R</span></a></li> 
          <li class="toclevel-1 tocsection-37"><a href="#Racket"><span class="tocnumber">37</span> <span class="toctext">Racket</span></a></li> 
          <li class="toclevel-1 tocsection-38"><a href="#REXX"><span class="tocnumber">38</span> <span class="toctext">REXX</span></a></li> 
          <li class="toclevel-1 tocsection-39"><a href="#Ruby"><span class="tocnumber">39</span> <span class="toctext">Ruby</span></a></li> 
          <li class="toclevel-1 tocsection-40"><a href="#Scala"><span class="tocnumber">40</span> <span class="toctext">Scala</span></a></li> 
          <li class="toclevel-1 tocsection-41"><a href="#Sidef"><span class="tocnumber">41</span> <span class="toctext">Sidef</span></a></li> 
          <li class="toclevel-1 tocsection-42"><a href="#Tcl"><span class="tocnumber">42</span> <span class="toctext">Tcl</span></a></li> 
          <li class="toclevel-1 tocsection-43"><a href="#Vedit_macro_language"><span class="tocnumber">43</span> <span class="toctext">Vedit macro language</span></a></li> 
          <li class="toclevel-1 tocsection-44"><a href="#Visual_Basic_.NET"><span class="tocnumber">44</span> <span class="toctext">Visual Basic .NET</span></a></li> 
          <li class="toclevel-1 tocsection-45"><a href="#zkl"><span class="tocnumber">45</span> <span class="toctext">zkl</span></a></li> 
         </ul> 
        </div> 
        <h2><span class="mw-headline" id="Ada"><a href="/wiki/Category:Ada" title="Category:Ada">Ada</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=1" title="Edit section: Ada">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <pre class="ada highlighted_source"><span class="kw3">type</span> Grayscale_Image <span class="kw1">is</span> <span class="kw3">array</span> <span class="br0">(</span>Positive <span class="kw3">range</span> &lt;&gt;, Positive <span class="kw3">range</span> &lt;&gt;<span class="br0">)</span> <span class="kw3">of</span> Luminance;</pre> 
        <p>Conversion to a grayscale image: </p> 
        <pre class="ada highlighted_source"><span class="kw3">function</span> Grayscale <span class="br0">(</span>Picture&nbsp;: Image<span class="br0">)</span> <span class="kw1">return</span> Grayscale_Image <span class="kw1">is</span><br>   <span class="kw3">type</span> Extended_Luminance <span class="kw1">is</span> <span class="kw3">range</span> <span class="nu0">0</span>..<span class="nu0">10</span>_000_000;<br>   Result&nbsp;: Grayscale_Image <span class="br0">(</span>Picture'<span class="kw3">Range</span> <span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>, Picture'<span class="kw3">Range</span> <span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span><span class="br0">)</span>;<br>   Color &nbsp;: Pixel;<br><span class="kw1">begin</span><br>   <span class="kw1">for</span> I <span class="kw3">in</span> Picture'<span class="kw3">Range</span> <span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span> <span class="kw1">loop</span><br>      <span class="kw1">for</span> J <span class="kw3">in</span> Picture'<span class="kw3">Range</span> <span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span> <span class="kw1">loop</span><br>         Color&nbsp;:= Picture <span class="br0">(</span>I, J<span class="br0">)</span>;<br>         Result <span class="br0">(</span>I, J<span class="br0">)</span>&nbsp;:=<br>            Luminance<br>            <span class="br0">(</span>  <span class="br0">(</span>  <span class="nu0">2</span>_126 * Extended_Luminance <span class="br0">(</span>Color.<span class="me1">R</span><span class="br0">)</span><br>               +  <span class="nu0">7</span>_152 * Extended_Luminance <span class="br0">(</span>Color.<span class="me1">G</span><span class="br0">)</span><br>               +    <span class="nu0">722</span> * Extended_Luminance <span class="br0">(</span>Color.<span class="me1">B</span><span class="br0">)</span><br>               <span class="br0">)</span><br>            /  <span class="nu0">10</span>_000<br>            <span class="br0">)</span>;<br>      <span class="kw1">end</span> <span class="kw1">loop</span>;<br>   <span class="kw1">end</span> <span class="kw1">loop</span>;<br>   <span class="kw1">return</span> Result;<br><span class="kw1">end</span> Grayscale;</pre> 
        <p>Conversion to a color image: </p> 
        <pre class="ada highlighted_source"><span class="kw3">function</span> Color <span class="br0">(</span>Picture&nbsp;: Grayscale_Image<span class="br0">)</span> <span class="kw1">return</span> Image <span class="kw1">is</span><br>   Result&nbsp;: Image <span class="br0">(</span>Picture'<span class="kw3">Range</span> <span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>, Picture'<span class="kw3">Range</span> <span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span><span class="br0">)</span>;<br><span class="kw1">begin</span><br>   <span class="kw1">for</span> I <span class="kw3">in</span> Picture'<span class="kw3">Range</span> <span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span> <span class="kw1">loop</span><br>      <span class="kw1">for</span> J <span class="kw3">in</span> Picture'<span class="kw3">Range</span> <span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span> <span class="kw1">loop</span><br>         Result <span class="br0">(</span>I, J<span class="br0">)</span>&nbsp;:= <span class="br0">(</span><span class="kw3">others</span> =&gt; Picture <span class="br0">(</span>I, J<span class="br0">)</span><span class="br0">)</span>;<br>      <span class="kw1">end</span> <span class="kw1">loop</span>;<br>   <span class="kw1">end</span> <span class="kw1">loop</span>;<br>   <span class="kw1">return</span> Result;<br><span class="kw1">end</span> Color;</pre> 
        <h2><span class="mw-headline" id="BASIC256"><a href="/wiki/Category:BASIC256" title="Category:BASIC256">BASIC256</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=2" title="Edit section: BASIC256">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <div class="floatright">
         <a href="/wiki/File:BASIC256_greyscale_Mona_Lisa.jpg" class="image"><img alt="BASIC256 greyscale Mona Lisa.jpg" src="/mw/images/4/4e/BASIC256_greyscale_Mona_Lisa.jpg" width="143" height="188"></a>
        </div> 
        <div class="floatright">
         <a href="/wiki/File:BASIC256_greysacle_Grey_Mona_lisa.jpg" class="image"><img alt="BASIC256 greysacle Grey Mona lisa.jpg" src="/mw/images/2/2a/BASIC256_greysacle_Grey_Mona_lisa.jpg" width="143" height="188"></a>
        </div> 
        <pre class="text highlighted_source">w = 143<br>h = 188<br>name$ = "Mona_Lisa.jpg"<br>graphsize w,h<br>imgload w/2, h/2, name$<br>fastgraphics<br>&nbsp;<br>for x = 0 to w-1<br>   for y = 0 to h-1<br>      p = pixel(x,y)<br>      b = p&nbsp;% 256<br>      p = p \256<br>      g = p&nbsp;% 256<br>      p = p \ 256<br>      r = p&nbsp;% 256<br>      l = 0.2126*r + 0.7152*g + 0.0722*b<br>      color rgb(l,l,l)<br>      plot x,y<br>   next y<br>   refresh<br>next x<br>&nbsp;<br>imgsave "Grey_"+name$,"jpg"</pre> 
        <h2><span class="mw-headline" id="BBC_BASIC"><a href="/wiki/Category:BBC_BASIC" title="Category:BBC BASIC">BBC BASIC</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=3" title="Edit section: BBC BASIC">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <div class="examplemeta workswith">
         <b>Works with</b>: 
         <a href="/wiki/BBC_BASIC_for_Windows" title="BBC BASIC for Windows">BBC BASIC for Windows</a>
        </div> 
        <p>This uses the formula for gamma-corrected images, which is more appropriate to this task (see discussion page). </p> 
        <div class="floatright">
         <a href="/wiki/File:Original_bbc.jpg" class="image"><img alt="Original bbc.jpg" src="/mw/images/4/41/Original_bbc.jpg" width="208" height="228"></a>
        </div> 
        <div class="floatright">
         <a href="/wiki/File:Greyscale_bbc.jpg" class="image"><img alt="Greyscale bbc.jpg" src="/mw/images/4/48/Greyscale_bbc.jpg" width="208" height="228"></a>
        </div> 
        <pre class="text highlighted_source">      Width% = 200<br>      Height% = 200<br>&nbsp;<br>      VDU 23,22,Width%;Height%;8,16,16,128<br>      *display c:\lena<br>&nbsp;<br>      FOR y% = 0 TO Height%-1<br>        FOR x% = 0 TO Width%-1<br>          rgb% = FNgetpixel(x%,y%)<br>          r% = rgb% &gt;&gt; 16<br>          g% = (rgb% &gt;&gt; 8) AND &amp;FF<br>          b% = rgb% AND &amp;FF<br>          l% = INT(0.3*r% + 0.59*g% + 0.11*b% + 0.5)<br>          PROCsetpixel(x%,y%,l%,l%,l%)<br>        NEXT<br>      NEXT y%<br>      END<br>&nbsp;<br>      DEF PROCsetpixel(x%,y%,r%,g%,b%)<br>      COLOUR 1,r%,g%,b%<br>      GCOL 1<br>      LINE x%*2,y%*2,x%*2,y%*2<br>      ENDPROC<br>&nbsp;<br>      DEF FNgetpixel(x%,y%)<br>      LOCAL col%<br>      col% = TINT(x%*2,y%*2)<br>      SWAP&nbsp;?^col%,?(^col%+2)<br>      = col%</pre> 
        <h2><span class="mw-headline" id="C"><a href="/wiki/Category:C" title="Category:C">C</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=4" title="Edit section: C">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>Definition/interface for a grayscale image. </p> 
        <pre class="c highlighted_source"><span class="kw4">typedef</span> <span class="kw4">unsigned</span> <span class="kw4">char</span> luminance<span class="sy0">;</span><br><span class="kw4">typedef</span> luminance pixel1<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="sy0">;</span><br><span class="kw4">typedef</span> <span class="kw4">struct</span> <span class="br0">{</span><br>   <span class="kw4">unsigned</span> <span class="kw4">int</span> width<span class="sy0">;</span><br>   <span class="kw4">unsigned</span> <span class="kw4">int</span> height<span class="sy0">;</span><br>   luminance <span class="sy0">*</span>buf<span class="sy0">;</span><br><span class="br0">}</span> grayimage_t<span class="sy0">;</span><br><span class="kw4">typedef</span> grayimage_t <span class="sy0">*</span>grayimage<span class="sy0">;</span><br>&nbsp;<br>grayimage alloc_grayimg<span class="br0">(</span><span class="kw4">unsigned</span> <span class="kw4">int</span><span class="sy0">,</span> <span class="kw4">unsigned</span> <span class="kw4">int</span><span class="br0">)</span><span class="sy0">;</span><br>grayimage tograyscale<span class="br0">(</span>image<span class="br0">)</span><span class="sy0">;</span><br>image tocolor<span class="br0">(</span>grayimage<span class="br0">)</span><span class="sy0">;</span></pre> 
        <p>The same as <tt>alloc_img</tt>, but for grayscale images. </p> 
        <pre class="c highlighted_source">grayimage alloc_grayimg<span class="br0">(</span><span class="kw4">unsigned</span> <span class="kw4">int</span> width<span class="sy0">,</span> <span class="kw4">unsigned</span> <span class="kw4">int</span> height<span class="br0">)</span><br><span class="br0">{</span><br>     grayimage img<span class="sy0">;</span><br>     img <span class="sy0">=</span> <a href="http://www.opengroup.org/onlinepubs/009695399/functions/malloc.html"><span class="kw3">malloc</span></a><span class="br0">(</span><span class="kw4">sizeof</span><span class="br0">(</span>grayimage_t<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span><br>     img<span class="sy0">-&gt;</span>buf <span class="sy0">=</span> <a href="http://www.opengroup.org/onlinepubs/009695399/functions/malloc.html"><span class="kw3">malloc</span></a><span class="br0">(</span>width<span class="sy0">*</span>height<span class="sy0">*</span><span class="kw4">sizeof</span><span class="br0">(</span>pixel1<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span><br>     img<span class="sy0">-&gt;</span>width <span class="sy0">=</span> width<span class="sy0">;</span><br>     img<span class="sy0">-&gt;</span>height <span class="sy0">=</span> height<span class="sy0">;</span><br>     <span class="kw1">return</span> img<span class="sy0">;</span><br><span class="br0">}</span></pre> 
        <p>Convert from <i>color</i> image to <i>grayscale</i> image. </p> 
        <pre class="c highlighted_source">grayimage tograyscale<span class="br0">(</span>image img<span class="br0">)</span><br><span class="br0">{</span><br>   <span class="kw4">unsigned</span> <span class="kw4">int</span> x<span class="sy0">,</span> y<span class="sy0">;</span><br>   grayimage timg<span class="sy0">;</span><br>   <span class="kw4">double</span> rc<span class="sy0">,</span> gc<span class="sy0">,</span> bc<span class="sy0">,</span> l<span class="sy0">;</span><br>   <span class="kw4">unsigned</span> <span class="kw4">int</span> ofs<span class="sy0">;</span><br>&nbsp;<br>   timg <span class="sy0">=</span> alloc_grayimg<span class="br0">(</span>img<span class="sy0">-&gt;</span>width<span class="sy0">,</span> img<span class="sy0">-&gt;</span>height<span class="br0">)</span><span class="sy0">;</span><br>&nbsp;<br>   <span class="kw1">for</span><span class="br0">(</span>x<span class="sy0">=</span><span class="nu0">0</span><span class="sy0">;</span> x <span class="sy0">&lt;</span> img<span class="sy0">-&gt;</span>width<span class="sy0">;</span> x<span class="sy0">++</span><span class="br0">)</span><br>   <span class="br0">{</span><br>      <span class="kw1">for</span><span class="br0">(</span>y<span class="sy0">=</span><span class="nu0">0</span><span class="sy0">;</span> y <span class="sy0">&lt;</span> img<span class="sy0">-&gt;</span>height<span class="sy0">;</span> y<span class="sy0">++</span><span class="br0">)</span><br>      <span class="br0">{</span><br>        ofs <span class="sy0">=</span> <span class="br0">(</span>y <span class="sy0">*</span> img<span class="sy0">-&gt;</span>width<span class="br0">)</span> <span class="sy0">+</span> x<span class="sy0">;</span><br>        rc <span class="sy0">=</span> <span class="br0">(</span><span class="kw4">double</span><span class="br0">)</span> img<span class="sy0">-&gt;</span>buf<span class="br0">[</span>ofs<span class="br0">]</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="sy0">;</span><br>        gc <span class="sy0">=</span> <span class="br0">(</span><span class="kw4">double</span><span class="br0">)</span> img<span class="sy0">-&gt;</span>buf<span class="br0">[</span>ofs<span class="br0">]</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="sy0">;</span><br>        bc <span class="sy0">=</span> <span class="br0">(</span><span class="kw4">double</span><span class="br0">)</span> img<span class="sy0">-&gt;</span>buf<span class="br0">[</span>ofs<span class="br0">]</span><span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span><span class="sy0">;</span><br>        l <span class="sy0">=</span> <span class="nu16">0.2126</span><span class="sy0">*</span>rc <span class="sy0">+</span> <span class="nu16">0.7152</span><span class="sy0">*</span>gc <span class="sy0">+</span> <span class="nu16">0.0722</span><span class="sy0">*</span>bc<span class="sy0">;</span><br>        timg<span class="sy0">-&gt;</span>buf<span class="br0">[</span>ofs<span class="br0">]</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">=</span> <span class="br0">(</span>luminance<span class="br0">)</span> <span class="br0">(</span>l<span class="sy0">+</span><span class="nu16">0.5</span><span class="br0">)</span><span class="sy0">;</span><br>      <span class="br0">}</span><br>   <span class="br0">}</span><br>   <span class="kw1">return</span> timg<span class="sy0">;</span><br><span class="br0">}</span></pre> 
        <p>And back from a <i>grayscale</i> image to a <i>color</i> image. </p> 
        <pre class="c highlighted_source">image tocolor<span class="br0">(</span>grayimage img<span class="br0">)</span><br><span class="br0">{</span><br>   <span class="kw4">unsigned</span> <span class="kw4">int</span> x<span class="sy0">,</span> y<span class="sy0">;</span><br>   image timg<span class="sy0">;</span><br>   luminance l<span class="sy0">;</span><br>   <span class="kw4">unsigned</span> <span class="kw4">int</span> ofs<span class="sy0">;</span><br>&nbsp;<br>   timg <span class="sy0">=</span> alloc_img<span class="br0">(</span>img<span class="sy0">-&gt;</span>width<span class="sy0">,</span> img<span class="sy0">-&gt;</span>height<span class="br0">)</span><span class="sy0">;</span><br>&nbsp;<br>   <span class="kw1">for</span><span class="br0">(</span>x<span class="sy0">=</span><span class="nu0">0</span><span class="sy0">;</span> x <span class="sy0">&lt;</span> img<span class="sy0">-&gt;</span>width<span class="sy0">;</span> x<span class="sy0">++</span><span class="br0">)</span><br>   <span class="br0">{</span><br>      <span class="kw1">for</span><span class="br0">(</span>y<span class="sy0">=</span><span class="nu0">0</span><span class="sy0">;</span> y <span class="sy0">&lt;</span> img<span class="sy0">-&gt;</span>height<span class="sy0">;</span> y<span class="sy0">++</span><span class="br0">)</span><br>      <span class="br0">{</span><br>        ofs <span class="sy0">=</span> <span class="br0">(</span>y <span class="sy0">*</span> img<span class="sy0">-&gt;</span>width<span class="br0">)</span> <span class="sy0">+</span> x<span class="sy0">;</span><br>        l <span class="sy0">=</span> img<span class="sy0">-&gt;</span>buf<span class="br0">[</span>ofs<span class="br0">]</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="sy0">;</span><br>        timg<span class="sy0">-&gt;</span>buf<span class="br0">[</span>ofs<span class="br0">]</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">=</span> l<span class="sy0">;</span><br>        timg<span class="sy0">-&gt;</span>buf<span class="br0">[</span>ofs<span class="br0">]</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">=</span> l<span class="sy0">;</span><br>        timg<span class="sy0">-&gt;</span>buf<span class="br0">[</span>ofs<span class="br0">]</span><span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span> <span class="sy0">=</span> l<span class="sy0">;</span><br>      <span class="br0">}</span><br>   <span class="br0">}</span><br>   <span class="kw1">return</span> timg<span class="sy0">;</span><br><span class="br0">}</span></pre> 
        <p><b>Notes</b> </p> 
        <ul>
         <li> <tt>tocolor</tt> and <tt>tograyscale</tt> do not free the previous image, so it must be freed normally calling <tt>free_img</tt>. With a cast we can use the same function also for grayscale images, or we can define something like</li>
        </ul> 
        <pre class="c highlighted_source"><span class="co2">#define free_grayimg(IMG) free_img((image)(IMG))</span></pre> 
        <ul>
         <li> <i>Luminance</i> is rounded. Since the C implementation is based on unsigned char (256 possible values per components), L can be at most 255.0 and rounding gives 255, as we expect. Changing the color_component type would only change 256, 255.0 and 255 values here written in something else, the code would work the same.</li>
        </ul> 
        <h2><span class="mw-headline" id="C.23"><a href="/wiki/Category:C_sharp" title="Category:C sharp">C#</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=5" title="Edit section: C#">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>To convert TO grayscale: </p> 
        <pre class="csharp highlighted_source">&nbsp;<br>Bitmap tImage <span class="sy0">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span class="kw3">new</span></a> Bitmap<span class="br0">(</span><span class="st0">"spectrum.bmp"</span><span class="br0">)</span><span class="sy0">;</span><br>&nbsp;<br><span class="kw1">for</span> <span class="br0">(</span><span class="kw4">int</span> x <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> x <span class="sy0">&lt;</span> tImage<span class="sy0">.</span><span class="me1">Width</span><span class="sy0">;</span> x<span class="sy0">++</span><span class="br0">)</span><br><span class="br0">{</span><br>	<span class="kw1">for</span> <span class="br0">(</span><span class="kw4">int</span> y <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> y <span class="sy0">&lt;</span> tImage<span class="sy0">.</span><span class="me1">Height</span><span class="sy0">;</span> y<span class="sy0">++</span><span class="br0">)</span><br>	<span class="br0">{</span><br>		Color tCol <span class="sy0">=</span> tImage<span class="sy0">.</span><span class="me1">GetPixel</span><span class="br0">(</span>x, y<span class="br0">)</span><span class="sy0">;</span><br>&nbsp;<br>		<span class="co1">// L = 0.2126·R + 0.7152·G + 0.0722·B </span><br>		<span class="kw4">double</span> L <span class="sy0">=</span> <span class="nu0">0.2126</span> <span class="sy0">*</span> tCol<span class="sy0">.</span><span class="me1">R</span> <span class="sy0">+</span> <span class="nu0">0.7152</span> <span class="sy0">*</span> tCol<span class="sy0">.</span><span class="me1">G</span> <span class="sy0">+</span> <span class="nu0">0.0722</span> <span class="sy0">*</span> tCol<span class="sy0">.</span><span class="me1">B</span><span class="sy0">;</span><br>		tImage<span class="sy0">.</span><span class="me1">SetPixel</span><span class="br0">(</span>x, y, Color<span class="sy0">.</span><span class="me1">FromArgb</span><span class="br0">(</span>Convert<span class="sy0">.</span><span class="me1">ToInt32</span><span class="br0">(</span>L<span class="br0">)</span>, Convert<span class="sy0">.</span><span class="me1">ToInt32</span><span class="br0">(</span>L<span class="br0">)</span>, Convert<span class="sy0">.</span><span class="me1">ToInt32</span><span class="br0">(</span>L<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span><br>	<span class="br0">}</span><br><span class="br0">}</span><br>&nbsp;<br><span class="co1">// Save</span><br>tImage<span class="sy0">.</span><span class="me1">Save</span><span class="br0">(</span><span class="st0">"spectrum2.bmp"</span><span class="br0">)</span><span class="sy0">;</span><br>&nbsp;</pre> 
        <h2><span class="mw-headline" id="Clojure"><a href="/wiki/Category:Clojure" title="Category:Clojure">Clojure</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=6" title="Edit section: Clojure">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <pre class="clojure highlighted_source">&nbsp;<br><span class="br0">(</span><span class="kw1">import</span> '<span class="br0">[</span>java<span class="sy0">.</span>io File<span class="br0">]</span><br>        '<span class="br0">[</span>javax<span class="sy0">.</span>imageio ImageIO<span class="br0">]</span><br>        '<span class="br0">[</span>java<span class="sy0">.</span>awt Color<span class="br0">]</span><br>        '<span class="br0">[</span>java<span class="sy0">.</span>awt<span class="sy0">.</span>image BufferedImage<span class="br0">]</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp;<br><span class="br0">(</span><span class="kw1">defn</span> rgb<span class="sy0">-</span>to<span class="sy0">-</span>gray <span class="br0">[</span>color<span class="sy0">-</span>image<span class="br0">]</span> <br>  <span class="br0">(</span><span class="kw1">let</span> <span class="br0">[</span>width <span class="br0">(</span><span class="sy0">.</span>getWidth color<span class="sy0">-</span>image<span class="br0">)</span><span class="br0">]</span><br>    <span class="br0">(</span><span class="kw1">partition</span> width<br>               <span class="br0">(</span><span class="kw1">for</span> <span class="br0">[</span>x <span class="br0">(</span><span class="kw1">range</span> width<span class="br0">)</span><br>                     y <span class="br0">(</span><span class="kw1">range</span> <span class="br0">(</span><span class="sy0">.</span>getHeight color<span class="sy0">-</span>image<span class="br0">)</span><span class="br0">)</span><span class="br0">]</span><br>                 <span class="br0">(</span><span class="kw1">let</span> <span class="br0">[</span>rgb <span class="br0">(</span><span class="sy0">.</span>getRGB color<span class="sy0">-</span>image x y<span class="br0">)</span> <br>                       rgb<span class="sy0">-</span>object <span class="br0">(</span>new Color rgb<span class="br0">)</span> <br>                       r <span class="br0">(</span><span class="sy0">.</span>getRed rgb<span class="sy0">-</span>object<span class="br0">)</span> <br>                       g <span class="br0">(</span><span class="sy0">.</span>getGreen rgb<span class="sy0">-</span>object<span class="br0">)</span><br>                       b <span class="br0">(</span><span class="sy0">.</span>getBlue rgb<span class="sy0">-</span>object<span class="br0">)</span> <br>                       a <span class="br0">(</span><span class="sy0">.</span>getAlpha rgb<span class="sy0">-</span>object<span class="br0">)</span><span class="br0">]</span><br>                   <span class="co1">;Compute the grayscale value an return it: L = 0.2126·R + 0.7152·G + 0.0722·B</span><br>                   <span class="br0">(</span><span class="sy0">+</span> <span class="br0">(</span><span class="sy0">*</span> r <span class="nu0">0.2126</span><span class="br0">)</span> <span class="br0">(</span><span class="sy0">*</span> g <span class="nu0">0.7152</span><span class="br0">)</span> <span class="br0">(</span><span class="sy0">*</span> b <span class="nu0">0.0722</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp;<br>&nbsp;<br><span class="br0">(</span><span class="kw1">defn</span> write<span class="sy0">-</span>matrix<span class="sy0">-</span>to<span class="sy0">-</span>image <span class="br0">[</span>matrix filename<span class="br0">]</span><br>  <span class="br0">(</span>ImageIO<span class="sy0">/</span>write <br>   <span class="br0">(</span><span class="kw1">let</span> <span class="br0">[</span>height <span class="br0">(</span><span class="kw1">count</span> matrix<span class="br0">)</span> <br>         width <span class="br0">(</span><span class="kw1">count</span> <span class="br0">(</span><span class="kw1">first</span> matrix<span class="br0">)</span><span class="br0">)</span> <br>         output<span class="sy0">-</span>image <span class="br0">(</span>new BufferedImage width height BufferedImage<span class="sy0">/</span>TYPE_BYTE_GRAY<span class="br0">)</span><span class="br0">]</span><br>     <span class="br0">(</span><span class="kw1">doseq</span> <span class="br0">[</span>row<span class="sy0">-</span>index    <span class="br0">(</span><span class="kw1">range</span> height<span class="br0">)</span> <br>             column<span class="sy0">-</span>index <span class="br0">(</span><span class="kw1">range</span> width<span class="br0">)</span><span class="br0">]</span> <br>       <span class="br0">(</span><span class="sy0">.</span>setRGB output<span class="sy0">-</span>image column<span class="sy0">-</span>index row<span class="sy0">-</span>index <span class="br0">(</span><span class="sy0">.</span>intValue <span class="br0">(</span>nth <span class="br0">(</span>nth matrix row<span class="sy0">-</span>index<span class="br0">)</span> column<span class="sy0">-</span>index<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><br>     output<span class="sy0">-</span>image<span class="br0">)</span><br>   <span class="st0">"png"</span> <br>   <span class="br0">(</span>new File filename<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp;<br><span class="br0">(</span>println<br>  <span class="br0">(</span>write<span class="sy0">-</span>matrix<span class="sy0">-</span>to<span class="sy0">-</span>image<br>    <span class="br0">(</span>rgb<span class="sy0">-</span>to<span class="sy0">-</span>gray<br>      <span class="br0">(</span>ImageIO<span class="sy0">/</span>read <span class="br0">(</span>new File <span class="st0">"test.jpg"</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><br>    <span class="st0">"test-gray-cloj.png"</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp;<br>&nbsp;</pre> 
        <h2><span class="mw-headline" id="Common_Lisp"><a href="/wiki/Category:Common_Lisp" title="Category:Common Lisp">Common Lisp</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=7" title="Edit section: Common Lisp">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>Use the function rgb-to-gray-image to convert a rgb-image as loaded by the function defined <a href="/wiki/Bitmap/Read_a_PPM_file#Common_Lisp" title="Bitmap/Read a PPM file">Bitmap/Read a PPM file#Common Lisp</a>. The package identifier assumes that you have the package as defined in <a href="/wiki/Basic_bitmap_storage#Common_Lisp" title="Basic bitmap storage" class="mw-redirect">Basic bitmap storage#Common Lisp</a>. With the function grayscale-image-to-pgm-file it is possible to write out the gray image as pgm file which can then be further processed. </p> 
        <pre class="lisp highlighted_source">&nbsp;<br><span class="br0">(</span>in-package #<span class="sy0">:</span><span class="me1">rgb-pixel-buffer</span><span class="br0">)</span><br>&nbsp;<br><span class="br0">(</span><span class="kw1">defun</span> rgb-to-gray-image <span class="br0">(</span>rgb-image<span class="br0">)</span><br>  <span class="br0">(</span>flet <span class="br0">(</span><span class="br0">(</span>rgb-to-gray <span class="br0">(</span>rgb-<span class="kw1">value</span><span class="br0">)</span><br>	   <span class="br0">(</span>round <span class="br0">(</span>+ <span class="br0">(</span>* <span class="nu0">0.2126</span> <span class="br0">(</span>rgb-pixel-red rgb-<span class="kw1">value</span><span class="br0">)</span><span class="br0">)</span><br>		     <span class="br0">(</span>* <span class="nu0">0.7152</span> <span class="br0">(</span>rgb-pixel-green rgb-<span class="kw1">value</span><span class="br0">)</span><span class="br0">)</span><br>		     <span class="br0">(</span>* <span class="nu0">0.0722</span> <span class="br0">(</span>rgb-pixel-blue rgb-<span class="kw1">value</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><br>    <span class="br0">(</span><span class="kw1">let</span> <span class="br0">(</span><span class="br0">(</span>gray-image <span class="br0">(</span>make-<span class="kw1">array</span> <span class="br0">(</span>array-dimensions rgb-image<span class="br0">)</span> <span class="sy0">:</span><span class="me1">element-type</span> '<span class="br0">(</span>unsigned-byte <span class="nu0">8</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><br>      <span class="br0">(</span><span class="kw1">dotimes</span> <span class="br0">(</span>i <span class="br0">(</span>array-total-size rgb-image<span class="br0">)</span><span class="br0">)</span><br>	<span class="br0">(</span><span class="kw1">setf</span> <span class="br0">(</span>row-major-<span class="kw1">aref</span> gray-image i<span class="br0">)</span> <span class="br0">(</span>rgb-to-gray <span class="br0">(</span>row-major-<span class="kw1">aref</span> rgb-image i<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><br>      gray-image<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp;<br><span class="br0">(</span>export 'rgb-to-gray-image<span class="br0">)</span><br>&nbsp;<br>&nbsp;<br><span class="br0">(</span><span class="kw1">defun</span> grayscale-image-to-pgm-file <span class="br0">(</span>image file-<span class="kw1">name</span> <span class="sy0">&amp;</span>optional <span class="br0">(</span>max-<span class="kw1">value</span> <span class="nu0">255</span><span class="br0">)</span><span class="br0">)</span><br>  <span class="br0">(</span>with-open-file <span class="br0">(</span>p file-<span class="kw1">name</span> <span class="sy0">:</span><span class="me1">direction</span> <span class="sy0">:</span><span class="me1">output</span><br>		     <span class="sy0">:</span><span class="me1">if-exists</span> <span class="sy0">:</span><span class="me1">supersede</span><span class="br0">)</span><br>    <span class="br0">(</span>format p <span class="st0">"P2 ~&amp;~A ~A ~&amp;~A"</span> <span class="br0">(</span>array-dimension image <span class="nu0">1</span><span class="br0">)</span> <span class="br0">(</span>array-dimension image <span class="nu0">0</span><span class="br0">)</span> max-<span class="kw1">value</span><span class="br0">)</span><br>    <span class="br0">(</span><span class="kw1">dotimes</span> <span class="br0">(</span>i <span class="br0">(</span>array-total-size image<span class="br0">)</span><span class="br0">)</span><br>      <span class="br0">(</span><span class="kw1">print</span> <span class="br0">(</span>row-major-<span class="kw1">aref</span> image i<span class="br0">)</span> p<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp;<br><span class="br0">(</span>export 'grayscale-image-to-pgm-file<span class="br0">)</span><br>&nbsp;<br>&nbsp;</pre> 
        <h2><span class="mw-headline" id="D"><a href="/wiki/Category:D" title="Category:D">D</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=8" title="Edit section: D">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>This example uses the bitmap module defined in the <a href="/wiki/Bitmap" title="Bitmap">Bitmap</a> Task page. </p> 
        <pre class="d highlighted_source"><span class="kw2">module</span> grayscale_image<span class="sy0">;</span><br>&nbsp;<br><span class="kw2">import</span> core.<span class="me1">stdc</span>.<span class="me1">stdio</span><span class="sy0">,</span> std.<span class="me1">array</span><span class="sy0">,</span> std.<span class="me1">algorithm</span><span class="sy0">,</span> std.<span class="kw4">string</span><span class="sy0">,</span> std.<span class="me1">ascii</span><span class="sy0">;</span><br><span class="kw4">public</span> <span class="kw2">import</span> bitmap<span class="sy0">;</span><br>&nbsp;<br><span class="kw4">struct</span> Gray <span class="br0">{</span><br>    <span class="kw4">ubyte</span> c<span class="sy0">;</span><br>    <span class="kw4">enum</span> black <span class="sy0">=</span> <span class="kw2">typeof</span><span class="br0">(</span><span class="kw2">this</span><span class="br0">)</span><span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw4">enum</span> white <span class="sy0">=</span> <span class="kw2">typeof</span><span class="br0">(</span><span class="kw2">this</span><span class="br0">)</span><span class="br0">(</span><span class="nu0">255</span><span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw2">alias</span> c <span class="kw2">this</span><span class="sy0">;</span><br><span class="br0">}</span><br>&nbsp;<br>&nbsp;<br>Image<span class="sy0">!</span>Color loadPGM<span class="br0">(</span>Color<span class="br0">)</span><span class="br0">(</span>Image<span class="sy0">!</span>Color img<span class="sy0">,</span> <span class="kw2">in</span> <span class="kw4">string</span> fileName<span class="br0">)</span> <span class="br0">{</span><br>    <span class="kw4">static</span> <span class="kw4">int</span> readNum<span class="br0">(</span>FILE<span class="sy0">*</span> f<span class="br0">)</span> <span class="kw4">nothrow</span> @nogc <span class="br0">{</span><br>        <span class="kw4">int</span> n<span class="sy0">;</span><br>        <span class="kw1">while</span> <span class="br0">(</span><span class="sy0">!</span>fscanf<span class="br0">(</span>f<span class="sy0">,</span> <span class="st0">"%d "</span><span class="sy0">,</span> <span class="sy0">&amp;</span>n<span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span><br>            <span class="kw1">if</span> <span class="br0">(</span><span class="br0">(</span>n <span class="sy0">=</span> fgetc<span class="br0">(</span>f<span class="br0">)</span><span class="br0">)</span> <span class="sy0">==</span> <span class="st0">'#'</span><span class="br0">)</span> <span class="br0">{</span><br>                <span class="kw1">while</span> <span class="br0">(</span><span class="br0">(</span>n <span class="sy0">=</span> fgetc<span class="br0">(</span>f<span class="br0">)</span><span class="br0">)</span> <span class="sy0">!=</span> <span class="st0">'<span class="es1">\n</span>'</span><span class="br0">)</span><br>                    <span class="kw1">if</span> <span class="br0">(</span>n <span class="sy0">==</span> EOF<span class="br0">)</span><br>                        <span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span><br>            <span class="br0">}</span> <span class="kw1">else</span><br>                <span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span><br>        <span class="br0">}</span><br>        <span class="kw1">return</span> n<span class="sy0">;</span><br>    <span class="br0">}</span><br>&nbsp;<br>    <span class="kw1">if</span> <span class="br0">(</span>img <span class="kw2">is</span> <span class="kw2">null</span><span class="br0">)</span><br>        img <span class="sy0">=</span> <span class="kw2">new</span> Image<span class="sy0">!</span>Color<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><br>&nbsp;<br>    <span class="kw4">auto</span> fin <span class="sy0">=</span> fopen<span class="br0">(</span>fileName.<span class="me1">toStringz</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span> <span class="st0">"rb"</span><span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw2">scope</span><span class="br0">(</span>exit<span class="br0">)</span> <span class="kw1">if</span> <span class="br0">(</span>fin<span class="br0">)</span> fclose<span class="br0">(</span>fin<span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw1">if</span> <span class="br0">(</span><span class="sy0">!</span>fin<span class="br0">)</span><br>        <span class="kw2">throw</span> <span class="kw2">new</span> <span class="kw3">Exception</span><span class="br0">(</span><span class="st0">"Can't open input file."</span><span class="br0">)</span><span class="sy0">;</span><br>&nbsp;<br>    <span class="kw1">if</span> <span class="br0">(</span>fgetc<span class="br0">(</span>fin<span class="br0">)</span> <span class="sy0">!=</span> <span class="st0">'P'</span> <span class="sy0">||</span><br>        fgetc<span class="br0">(</span>fin<span class="br0">)</span> <span class="sy0">!=</span> <span class="st0">'5'</span> <span class="sy0">||</span><br>        <span class="sy0">!</span>isWhite<span class="br0">(</span>fgetc<span class="br0">(</span>fin<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><br>        <span class="kw2">throw</span> <span class="kw2">new</span> <span class="kw3">Exception</span><span class="br0">(</span><span class="st0">"Not a PGM (PPM P5) image."</span><span class="br0">)</span><span class="sy0">;</span><br>&nbsp;<br>    <span class="kw4">immutable</span> <span class="kw4">int</span> nc <span class="sy0">=</span> readNum<span class="br0">(</span>fin<span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw4">immutable</span> <span class="kw4">int</span> nr <span class="sy0">=</span> readNum<span class="br0">(</span>fin<span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw4">immutable</span> <span class="kw4">int</span> maxVal <span class="sy0">=</span> readNum<span class="br0">(</span>fin<span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw1">if</span> <span class="br0">(</span>nc <span class="sy0">&lt;=</span> <span class="nu0">0</span> <span class="sy0">||</span> nr <span class="sy0">&lt;=</span> <span class="nu0">0</span> <span class="sy0">||</span> maxVal <span class="sy0">&lt;=</span> <span class="nu0">0</span><span class="br0">)</span><br>        <span class="kw2">throw</span> <span class="kw2">new</span> <span class="kw3">Exception</span><span class="br0">(</span><span class="st0">"Wrong input image sizes."</span><span class="br0">)</span><span class="sy0">;</span><br>    img.<span class="me1">allocate</span><span class="br0">(</span>nc<span class="sy0">,</span> nr<span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw4">auto</span> pix <span class="sy0">=</span> <span class="kw2">new</span> <span class="kw4">ubyte</span><span class="br0">[</span>img.<span class="me1">image</span>.<span class="me1">length</span><span class="br0">]</span><span class="sy0">;</span><br>&nbsp;<br>    <span class="kw4">immutable</span> count <span class="sy0">=</span> fread<span class="br0">(</span>pix.<span class="me1">ptr</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> nc <span class="sy0">*</span> nr<span class="sy0">,</span> fin<span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw1">if</span> <span class="br0">(</span>count <span class="sy0">!=</span> nc <span class="sy0">*</span> nr<span class="br0">)</span><br>        <span class="kw2">throw</span> <span class="kw2">new</span> <span class="kw3">Exception</span><span class="br0">(</span><span class="st0">"Wrong number of items read."</span><span class="br0">)</span><span class="sy0">;</span><br>&nbsp;<br>    pix.<span class="me1">copy</span><span class="br0">(</span>img.<span class="me1">image</span><span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw1">return</span> img<span class="sy0">;</span><br><span class="br0">}</span><br>&nbsp;<br>&nbsp;<br><span class="kw4">void</span> savePGM<span class="br0">(</span>Color<span class="br0">)</span><span class="br0">(</span><span class="kw2">in</span> Image<span class="sy0">!</span>Color img<span class="sy0">,</span> <span class="kw2">in</span> <span class="kw4">string</span> fileName<span class="br0">)</span><br><span class="kw2">in</span> <span class="br0">{</span><br>    <span class="kw2">assert</span><span class="br0">(</span>img <span class="sy0">!</span><span class="kw2">is</span> <span class="kw2">null</span><span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw2">assert</span><span class="br0">(</span><span class="sy0">!</span>fileName.<span class="me1">empty</span><span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw2">assert</span><span class="br0">(</span>img.<span class="me1">nx</span> <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> img.<span class="me1">ny</span> <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span><br>           img.<span class="me1">image</span>.<span class="me1">length</span> <span class="sy0">==</span> img.<span class="me1">nx</span> <span class="sy0">*</span> img.<span class="me1">ny</span><span class="sy0">,</span><br>           <span class="st0">"Wrong image."</span><span class="br0">)</span><span class="sy0">;</span><br><span class="br0">}</span> <span class="kw2">body</span> <span class="br0">{</span><br>    <span class="kw4">auto</span> fout <span class="sy0">=</span> fopen<span class="br0">(</span>fileName.<span class="me1">toStringz</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span> <span class="st0">"wb"</span><span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw1">if</span> <span class="br0">(</span>fout <span class="sy0">==</span> <span class="kw2">null</span><span class="br0">)</span><br>        <span class="kw2">throw</span> <span class="kw2">new</span> <span class="kw3">Exception</span><span class="br0">(</span><span class="st0">"File can't be opened."</span><span class="br0">)</span><span class="sy0">;</span><br>    fprintf<span class="br0">(</span>fout<span class="sy0">,</span> <span class="st0">"P5<span class="es1">\n</span>%d&nbsp;%d<span class="es1">\n</span>255<span class="es1">\n</span>"</span><span class="sy0">,</span> img.<span class="me1">nx</span><span class="sy0">,</span> img.<span class="me1">ny</span><span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw4">auto</span> pix <span class="sy0">=</span> <span class="kw2">new</span> <span class="kw4">ubyte</span><span class="br0">[</span>img.<span class="me1">image</span>.<span class="me1">length</span><span class="br0">]</span><span class="sy0">;</span><br>    <span class="kw1">foreach</span> <span class="br0">(</span>i<span class="sy0">,</span> <span class="kw2">ref</span> p<span class="sy0">;</span> pix<span class="br0">)</span><br>        p <span class="sy0">=</span> <span class="kw2">cast</span><span class="br0">(</span><span class="kw2">typeof</span><span class="br0">(</span>pix<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span><span class="br0">)</span><span class="br0">)</span>img.<span class="me1">image</span><span class="br0">[</span>i<span class="br0">]</span><span class="sy0">;</span><br>    <span class="kw4">immutable</span> count <span class="sy0">=</span> fwrite<span class="br0">(</span>pix.<span class="me1">ptr</span><span class="sy0">,</span> <span class="kw4">ubyte</span>.<span class="me1">sizeof</span><span class="sy0">,</span><br>                             img.<span class="me1">nx</span> <span class="sy0">*</span> img.<span class="me1">ny</span><span class="sy0">,</span> fout<span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw1">if</span> <span class="br0">(</span>count <span class="sy0">!=</span> img.<span class="me1">nx</span> <span class="sy0">*</span> img.<span class="me1">ny</span><span class="br0">)</span><br>        <span class="kw2">new</span> <span class="kw3">Exception</span><span class="br0">(</span><span class="st0">"Wrong number of items written."</span><span class="br0">)</span><span class="sy0">;</span><br>    fclose<span class="br0">(</span>fout<span class="br0">)</span><span class="sy0">;</span><br><span class="br0">}</span><br>&nbsp;<br>&nbsp;<br>Gray lumCIE<span class="br0">(</span><span class="kw2">in</span> RGB c<span class="br0">)</span> <span class="kw4">pure</span> <span class="kw4">nothrow</span> @nogc <span class="br0">{</span><br>    <span class="kw1">return</span> Gray<span class="br0">(</span><span class="kw2">cast</span><span class="br0">(</span><span class="kw4">ubyte</span><span class="br0">)</span><span class="br0">(</span><span class="nu16">0.2126</span> <span class="sy0">*</span> c.<span class="me1">r</span> <span class="sy0">+</span><br>                            <span class="nu16">0.7152</span> <span class="sy0">*</span> c.<span class="me1">g</span> <span class="sy0">+</span><br>                            <span class="nu16">0.0722</span> <span class="sy0">*</span> c.<span class="me1">b</span> <span class="sy0">+</span> <span class="nu16">0.5</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span><br><span class="br0">}</span><br>&nbsp;<br>Gray lumAVG<span class="br0">(</span><span class="kw2">in</span> RGB c<span class="br0">)</span> <span class="kw4">pure</span> <span class="kw4">nothrow</span> @nogc <span class="br0">{</span><br>    <span class="kw1">return</span> Gray<span class="br0">(</span><span class="kw2">cast</span><span class="br0">(</span><span class="kw4">ubyte</span><span class="br0">)</span><span class="br0">(</span><span class="nu16">0.3333</span> <span class="sy0">*</span> c.<span class="me1">r</span> <span class="sy0">+</span><br>                            <span class="nu16">0.3333</span> <span class="sy0">*</span> c.<span class="me1">g</span> <span class="sy0">+</span><br>                            <span class="nu16">0.3333</span> <span class="sy0">*</span> c.<span class="me1">b</span> <span class="sy0">+</span> <span class="nu16">0.5</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span><br><span class="br0">}</span><br>&nbsp;<br>Image<span class="sy0">!</span>Gray rgb2grayImage<span class="br0">(</span><span class="kw2">alias</span> Conv<span class="sy0">=</span>lumCIE<span class="br0">)</span><span class="br0">(</span><span class="kw2">in</span> Image<span class="sy0">!</span>RGB im<span class="br0">)</span> <span class="kw4">nothrow</span> <span class="br0">{</span><br>    <span class="kw4">auto</span> result <span class="sy0">=</span> <span class="kw2">new</span> <span class="kw2">typeof</span><span class="br0">(</span><span class="kw1">return</span><span class="br0">)</span><span class="br0">(</span>im.<span class="me1">nx</span><span class="sy0">,</span> im.<span class="me1">ny</span><span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw1">foreach</span> <span class="br0">(</span><span class="kw4">immutable</span> i<span class="sy0">,</span> <span class="kw4">immutable</span> rgb<span class="sy0">;</span> im.<span class="me1">image</span><span class="br0">)</span><br>        result.<span class="me1">image</span><span class="br0">[</span>i<span class="br0">]</span> <span class="sy0">=</span> Conv<span class="br0">(</span>rgb<span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw1">return</span> result<span class="sy0">;</span><br><span class="br0">}</span><br>&nbsp;<br>Image<span class="sy0">!</span>RGB gray2rgbImage<span class="br0">(</span><span class="kw2">in</span> Image<span class="sy0">!</span>Gray im<span class="br0">)</span> <span class="kw4">nothrow</span> <span class="br0">{</span><br>    <span class="kw4">auto</span> result <span class="sy0">=</span> <span class="kw2">new</span> <span class="kw2">typeof</span><span class="br0">(</span><span class="kw1">return</span><span class="br0">)</span><span class="br0">(</span>im.<span class="me1">nx</span><span class="sy0">,</span> im.<span class="me1">ny</span><span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw1">foreach</span> <span class="br0">(</span><span class="kw4">immutable</span> i<span class="sy0">,</span> <span class="kw4">immutable</span> gr<span class="sy0">;</span> im.<span class="me1">image</span><span class="br0">)</span><br>        result.<span class="me1">image</span><span class="br0">[</span>i<span class="br0">]</span> <span class="sy0">=</span> RGB<span class="br0">(</span>gr<span class="sy0">,</span> gr<span class="sy0">,</span> gr<span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw1">return</span> result<span class="sy0">;</span><br><span class="br0">}</span><br>&nbsp;<br><span class="kw4">version</span> <span class="br0">(</span>grayscale_image_main<span class="br0">)</span> <span class="br0">{</span><br>    <span class="kw4">void</span> main<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span><br>        <span class="kw4">auto</span> im1 <span class="sy0">=</span> <span class="kw2">new</span> Image<span class="sy0">!</span>Gray<span class="sy0">;</span><br>        im1.<span class="me1">loadPGM</span><span class="br0">(</span><span class="st0">"lena.pgm"</span><span class="br0">)</span><span class="sy0">;</span><br>        gray2rgbImage<span class="br0">(</span>im1<span class="br0">)</span>.<span class="me1">savePPM6</span><span class="br0">(</span><span class="st0">"lena_rgb.ppm"</span><span class="br0">)</span><span class="sy0">;</span><br>&nbsp;<br>        <span class="kw4">auto</span> img2 <span class="sy0">=</span> <span class="kw2">new</span> Image<span class="sy0">!</span>RGB<span class="sy0">;</span><br>        img2.<span class="me1">loadPPM6</span><span class="br0">(</span><span class="st0">"quantum_frog.ppm"</span><span class="br0">)</span><span class="sy0">;</span><br>        img2.<span class="me1">rgb2grayImage</span>.<span class="me1">savePGM</span><span class="br0">(</span><span class="st0">"quantum_frog_grey.pgm"</span><span class="br0">)</span><span class="sy0">;</span><br>    <span class="br0">}</span><br><span class="br0">}</span></pre> 
        <h2><span class="mw-headline" id="Euler_Math_Toolbox"><a href="/wiki/Category:Euler_Math_Toolbox" title="Category:Euler Math Toolbox">Euler Math Toolbox</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=9" title="Edit section: Euler Math Toolbox">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <pre class="text highlighted_source">&nbsp;<br>&gt;A=loadrgb("mona.jpg");<br>&gt;insrgb(A);<br>&gt;function grayscale (A) ...<br>${r,g,b}=getrgb(A);<br>$c=0.2126*r+0.7152*g+0.0722*b;<br>$return rgb(c,c,c);<br>$endfunction<br>&gt;insrgb(grayscale(A));<br>&gt;insrgb(A|grayscale(A));<br>&nbsp;</pre> 
        <h2><span class="mw-headline" id="Erlang"><a href="/wiki/Category:Erlang" title="Category:Erlang">Erlang</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=10" title="Edit section: Erlang">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>The code below extends the erlang module on <a href="/wiki/Bitmap" title="Bitmap">Bitmap</a> task. This module supports RGB and grayscale modes. RGB colors are specified as {rgb, R, G, B} and saved as bytes into an array. Grayscale colors are likewise specified as {gray, L} where L is luminance. </p> 
        <pre class="erlang highlighted_source"><span class="sy3">-</span><span class="re2">module</span><span class="br0">(</span>ros_bitmap<span class="br0">)</span><span class="sy1">.</span><br>&nbsp;<br><span class="sy3">-</span><span class="re2">export</span><span class="br0">(</span><span class="br0">[</span>new<span class="sy3">/</span><span class="nu0">2</span><span class="sy1">,</span> fill<span class="sy3">/</span><span class="nu0">2</span><span class="sy1">,</span> set_pixel<span class="sy3">/</span><span class="nu0">3</span><span class="sy1">,</span> <span class="kw3">get</span>_pixel<span class="sy3">/</span><span class="nu0">2</span><span class="sy1">,</span> convert<span class="sy3">/</span><span class="nu0">2</span><span class="br0">]</span><span class="br0">)</span><span class="sy1">.</span><br>&nbsp;<br><span class="sy3">-</span><span class="re2">record</span><span class="br0">(</span><span class="re1">bitmap</span><span class="sy1">,</span> <span class="br0">{</span><br>    mode <span class="sy3">=</span> rgb<span class="sy1">,</span><br>    pixels <span class="sy3">=</span> nil<span class="sy1">,</span><br>    shape <span class="sy3">=</span> <span class="br0">{</span><span class="nu0">0</span><span class="sy1">,</span> <span class="nu0">0</span><span class="br0">}</span><br>  <span class="br0">}</span><span class="br0">)</span><span class="sy1">.</span><br>&nbsp;<br><span class="re3">tuple_to_bytes</span><span class="br0">(</span><span class="br0">{</span>rgb<span class="sy1">,</span> <span class="re5">R</span><span class="sy1">,</span> <span class="re5">G</span><span class="sy1">,</span> <span class="re5">B</span><span class="br0">}</span><span class="br0">)</span> <span class="sy1">-&gt;</span><br>  <span class="sy2">&lt;&lt;</span><span class="re5">R</span>:<span class="nu0">8</span><span class="sy1">,</span> <span class="re5">G</span>:<span class="nu0">8</span><span class="sy1">,</span> <span class="re5">B</span>:<span class="nu0">8</span><span class="sy2">&gt;&gt;</span><span class="sy1">;</span><br><span class="re3">tuple_to_bytes</span><span class="br0">(</span><span class="br0">{</span>gray<span class="sy1">,</span> <span class="re5">L</span><span class="br0">}</span><span class="br0">)</span> <span class="sy1">-&gt;</span><br>  <span class="sy2">&lt;&lt;</span><span class="re5">L</span>:<span class="nu0">8</span><span class="sy2">&gt;&gt;</span><span class="sy1">.</span><br>&nbsp;<br><span class="re3">bytes_to_tuple</span><span class="br0">(</span>rgb<span class="sy1">,</span> <span class="re5">Bytes</span><span class="br0">)</span> <span class="sy1">-&gt;</span><br>  <span class="sy2">&lt;&lt;</span><span class="re5">R</span>:<span class="nu0">8</span><span class="sy1">,</span> <span class="re5">G</span>:<span class="nu0">8</span><span class="sy1">,</span> <span class="re5">B</span>:<span class="nu0">8</span><span class="sy2">&gt;&gt;</span> <span class="sy3">=</span> <span class="re5">Bytes</span><span class="sy1">,</span><br>  <span class="br0">{</span>rgb<span class="sy1">,</span> <span class="re5">R</span><span class="sy1">,</span> <span class="re5">G</span><span class="sy1">,</span> <span class="re5">B</span><span class="br0">}</span><span class="sy1">;</span><br><span class="re3">bytes_to_tuple</span><span class="br0">(</span>gray<span class="sy1">,</span> <span class="re5">Bytes</span><span class="br0">)</span> <span class="sy1">-&gt;</span><br>  <span class="sy2">&lt;&lt;</span><span class="re5">L</span>:<span class="nu0">8</span><span class="sy2">&gt;&gt;</span> <span class="sy3">=</span> <span class="re5">Bytes</span><span class="sy1">,</span><br>  <span class="br0">{</span>gray<span class="sy1">,</span> <span class="re5">L</span><span class="br0">}</span><span class="sy1">.</span><br>&nbsp;<br><span class="re3">new</span><span class="br0">(</span><span class="re5">Width</span><span class="sy1">,</span> <span class="re5">Height</span><span class="br0">)</span> <span class="sy1">-&gt;</span><br>  <span class="re3">new</span><span class="br0">(</span><span class="re5">Width</span><span class="sy1">,</span> <span class="re5">Height</span><span class="sy1">,</span> <span class="br0">{</span>rgb<span class="sy1">,</span> <span class="nu0">0</span><span class="sy1">,</span> <span class="nu0">0</span><span class="sy1">,</span> <span class="nu0">0</span><span class="br0">}</span><span class="br0">)</span><span class="sy1">.</span><br>&nbsp;<br><span class="re3">new</span><span class="br0">(</span><span class="re5">Width</span><span class="sy1">,</span> <span class="re5">Height</span><span class="sy1">,</span> rgb<span class="br0">)</span> <span class="sy1">-&gt;</span><br>  <span class="re3">new</span><span class="br0">(</span><span class="re5">Width</span><span class="sy1">,</span> <span class="re5">Height</span><span class="sy1">,</span> <span class="br0">{</span>rgb<span class="sy1">,</span> <span class="nu0">0</span><span class="sy1">,</span> <span class="nu0">0</span><span class="sy1">,</span> <span class="nu0">0</span><span class="br0">}</span><span class="br0">)</span><span class="sy1">;</span><br>&nbsp;<br><span class="re3">new</span><span class="br0">(</span><span class="re5">Width</span><span class="sy1">,</span> <span class="re5">Height</span><span class="sy1">,</span> gray<span class="br0">)</span> <span class="sy1">-&gt;</span><br>  <span class="re3">new</span><span class="br0">(</span><span class="re5">Width</span><span class="sy1">,</span> <span class="re5">Height</span><span class="sy1">,</span> <span class="br0">{</span>gray<span class="sy1">,</span> <span class="nu0">0</span><span class="sy1">,</span> <span class="nu0">0</span><span class="sy1">,</span> <span class="nu0">0</span><span class="br0">}</span><span class="br0">)</span><span class="sy1">;</span><br>&nbsp;<br><span class="re3">new</span><span class="br0">(</span><span class="re5">Width</span><span class="sy1">,</span> <span class="re5">Height</span><span class="sy1">,</span> <span class="re5">ColorTuple</span><span class="br0">)</span> <span class="kw1">when</span> <span class="re3">is_tuple</span><span class="br0">(</span><span class="re5">ColorTuple</span><span class="br0">)</span> <span class="sy1">-&gt;</span><br>  <span class="br0">[</span><span class="re5">Mode</span>|Components<span class="br0">]</span> <span class="sy3">=</span> <span class="kw3">tuple_to_list</span><span class="br0">(</span><span class="re5">ColorTuple</span><span class="br0">)</span><span class="sy1">,</span><br>  <span class="re5">Bytes</span> <span class="sy3">=</span> <span class="kw3">list_to_binary</span><span class="br0">(</span><span class="re5">Components</span><span class="br0">)</span><span class="sy1">,</span><br>  #<span class="re7">bitmap</span><span class="br0">{</span><br>    pixels<span class="sy3">=</span><a href="http://erlang.org/doc/man/array.html"><span class="kw5">array</span></a>:<span class="re3">new</span><span class="br0">(</span><span class="re5">Width</span> <span class="sy3">*</span> <span class="re5">Height</span><span class="sy1">,</span> <span class="br0">{</span>default<span class="sy1">,</span> <span class="re5">Bytes</span><span class="br0">}</span><span class="br0">)</span><span class="sy1">,</span><br>    shape<span class="sy3">=</span><span class="br0">{</span><span class="re5">Width</span><span class="sy1">,</span> <span class="re5">Height</span><span class="br0">}</span><span class="sy1">,</span><br>    mode<span class="sy3">=</span><span class="re5">Mode</span><span class="br0">}</span><span class="sy1">.</span><br>&nbsp;<br><span class="re3">fill</span><span class="br0">(</span>#<span class="re7">bitmap</span><span class="br0">{</span>shape<span class="sy3">=</span><span class="br0">{</span><span class="re5">Width</span><span class="sy1">,</span> <span class="re5">Height</span><span class="br0">}</span><span class="sy1">,</span> mode<span class="sy3">=</span><span class="re5">Mode</span><span class="br0">}</span><span class="sy1">,</span> <span class="re5">ColorTuple</span><span class="br0">)</span><br>    <span class="kw1">when</span> <span class="kw3">element</span><span class="br0">(</span><span class="nu0">1</span><span class="sy1">,</span> <span class="re5">ColorTuple</span><span class="br0">)</span> <span class="sy3">=:=</span> <span class="re5">Mode</span> <span class="sy1">-&gt;</span><br>  <span class="re3">new</span><span class="br0">(</span><span class="re5">Width</span><span class="sy1">,</span> <span class="re5">Height</span><span class="sy1">,</span> <span class="re5">ColorTuple</span><span class="br0">)</span><span class="sy1">.</span><br>&nbsp;<br><span class="re3">set_pixel</span><span class="br0">(</span>#<span class="re7">bitmap</span><span class="br0">{</span>pixels<span class="sy3">=</span><span class="re5">Pixels</span><span class="sy1">,</span> shape<span class="sy3">=</span><span class="br0">{</span><span class="re5">Width</span><span class="sy1">,</span> <span class="re5">_Height</span><span class="br0">}</span><span class="sy1">,</span> mode<span class="sy3">=</span><span class="re5">Mode</span><span class="br0">}</span><span class="sy3">=</span><span class="re5">Bitmap</span><span class="sy1">,</span><br>    <span class="br0">{</span>at<span class="sy1">,</span> <span class="re5">X</span><span class="sy1">,</span> <span class="re5">Y</span><span class="br0">}</span><span class="sy1">,</span> <span class="re5">ColorTuple</span><span class="br0">)</span> <span class="kw1">when</span>  <span class="kw3">element</span><span class="br0">(</span><span class="nu0">1</span><span class="sy1">,</span> <span class="re5">ColorTuple</span><span class="br0">)</span> <span class="sy3">=:=</span> <span class="re5">Mode</span> <span class="sy1">-&gt;</span><br>  <span class="re5">Index</span> <span class="sy3">=</span> <span class="re5">X</span> <span class="sy3">+</span> <span class="re5">Y</span> <span class="sy3">*</span> <span class="re5">Width</span><span class="sy1">,</span><br>  <span class="re5">Bitmap</span><span class="re8">#</span><span class="re7">bitmap</span><span class="br0">{</span>pixels<span class="sy3">=</span><a href="http://erlang.org/doc/man/array.html"><span class="kw5">array</span></a>:<span class="re3">set</span><span class="br0">(</span><span class="re5">Index</span><span class="sy1">,</span> <span class="re3">tuple_to_bytes</span><span class="br0">(</span><span class="re5">ColorTuple</span><span class="br0">)</span><span class="sy1">,</span> <span class="re5">Pixels</span><span class="br0">)</span><span class="br0">}</span><span class="sy1">.</span><br>&nbsp;<br><span class="kw3">get</span>_<span class="re3">pixel</span><span class="br0">(</span>#<span class="re7">bitmap</span><span class="br0">{</span>pixels<span class="sy3">=</span><span class="re5">Pixels</span><span class="sy1">,</span> shape<span class="sy3">=</span><span class="br0">{</span><span class="re5">Width</span><span class="sy1">,</span> <span class="re5">_Height</span><span class="br0">}</span><span class="sy1">,</span> mode<span class="sy3">=</span><span class="re5">Mode</span><span class="br0">}</span><span class="sy1">,</span><br>    <span class="br0">{</span>at<span class="sy1">,</span> <span class="re5">X</span><span class="sy1">,</span> <span class="re5">Y</span><span class="br0">}</span><span class="br0">)</span> <span class="sy1">-&gt;</span><br>  <span class="re5">Index</span> <span class="sy3">=</span> <span class="re5">X</span> <span class="sy3">+</span> <span class="re5">Y</span> <span class="sy3">*</span> <span class="re5">Width</span><span class="sy1">,</span><br>  <span class="re5">Bytes</span> <span class="sy3">=</span> <a href="http://erlang.org/doc/man/array.html"><span class="kw5">array</span></a>:<span class="kw3">get</span><span class="br0">(</span><span class="re5">Index</span><span class="sy1">,</span> <span class="re5">Pixels</span><span class="br0">)</span><span class="sy1">,</span><br>  <span class="re3">bytes_to_tuple</span><span class="br0">(</span><span class="re5">Mode</span><span class="sy1">,</span> <span class="re5">Bytes</span><span class="br0">)</span><span class="sy1">.</span><br>&nbsp;<br><span class="re3">luminance</span><span class="br0">(</span><span class="sy2">&lt;&lt;</span><span class="re5">R</span>:<span class="nu0">8</span><span class="sy1">,</span> <span class="re5">G</span>:<span class="nu0">8</span><span class="sy1">,</span> <span class="re5">B</span>:<span class="nu0">8</span><span class="sy2">&gt;&gt;</span><span class="br0">)</span> <span class="sy1">-&gt;</span><br>  <span class="sy2">&lt;&lt;</span><span class="br0">(</span><span class="kw3">trunc</span><span class="br0">(</span><span class="re5">R</span> <span class="sy3">*</span> <span class="nu0">0.2126</span> <span class="sy3">+</span> <span class="re5">G</span> <span class="sy3">*</span> <span class="nu0">0.7152</span> <span class="sy3">+</span> <span class="re5">B</span> <span class="sy3">*</span> <span class="nu0">0.0722</span><span class="br0">)</span><span class="br0">)</span><span class="sy2">&gt;&gt;</span><span class="sy1">.</span><br>&nbsp;<br><span class="co1">%% convert from rgb to grayscale</span><br><span class="re3">convert</span><span class="br0">(</span>#<span class="re7">bitmap</span><span class="br0">{</span>pixels<span class="sy3">=</span><span class="re5">Pixels</span><span class="sy1">,</span> mode<span class="sy3">=</span>rgb<span class="br0">}</span><span class="sy3">=</span><span class="re5">Bitmap</span><span class="sy1">,</span> gray<span class="br0">)</span> <span class="sy1">-&gt;</span><br>  <span class="re5">Bitmap</span><span class="re8">#</span><span class="re7">bitmap</span><span class="br0">{</span><br>    pixels<span class="sy3">=</span><a href="http://erlang.org/doc/man/array.html"><span class="kw5">array</span></a>:<span class="re3">map</span><span class="br0">(</span><span class="kw1">fun</span><span class="br0">(</span><span class="re5">_I</span><span class="sy1">,</span> <span class="re5">Pixel</span><span class="br0">)</span> <span class="sy1">-&gt;</span><br>          <span class="re3">luminance</span><span class="br0">(</span><span class="re5">Pixel</span><span class="br0">)</span> <span class="kw1">end</span><span class="sy1">,</span> <span class="re5">Pixels</span><span class="br0">)</span><span class="sy1">,</span><br>    mode<span class="sy3">=</span>gray<span class="br0">}</span><span class="sy1">;</span><br>&nbsp;<br><span class="co1">%% convert from grayscale to rgb</span><br><span class="re3">convert</span><span class="br0">(</span>#<span class="re7">bitmap</span><span class="br0">{</span>pixels<span class="sy3">=</span><span class="re5">Pixels</span><span class="sy1">,</span> mode<span class="sy3">=</span>gray<span class="br0">}</span><span class="sy3">=</span><span class="re5">Bitmap</span><span class="sy1">,</span> rgb<span class="br0">)</span><span class="sy1">-&gt;</span><br>  <span class="re5">Bitmap</span><span class="re8">#</span><span class="re7">bitmap</span><span class="br0">{</span><br>    pixels<span class="sy3">=</span><a href="http://erlang.org/doc/man/array.html"><span class="kw5">array</span></a>:<span class="re3">map</span><span class="br0">(</span><span class="kw1">fun</span><span class="br0">(</span><span class="re5">_I</span><span class="sy1">,</span> <span class="sy2">&lt;&lt;</span><span class="re5">L</span>:<span class="nu0">8</span><span class="sy2">&gt;&gt;</span><span class="br0">)</span> <span class="sy1">-&gt;</span> <span class="sy2">&lt;&lt;</span><span class="re5">L</span>:<span class="nu0">8</span><span class="sy1">,</span> <span class="re5">L</span>:<span class="nu0">8</span><span class="sy1">,</span> <span class="re5">L</span>:<span class="nu0">8</span><span class="sy2">&gt;&gt;</span> <span class="kw1">end</span><span class="sy1">,</span> <span class="re5">Pixels</span><span class="br0">)</span><span class="sy1">,</span><br>    mode<span class="sy3">=</span>rgb<span class="br0">}</span><span class="sy1">;</span><br>&nbsp;<br><span class="co1">%% no conversion if the mode is the same with the bitmap.</span><br><span class="re3">convert</span><span class="br0">(</span>#<span class="re7">bitmap</span><span class="br0">{</span>mode<span class="sy3">=</span><span class="re5">Mode</span><span class="br0">}</span><span class="sy3">=</span><span class="re5">Bitmap</span><span class="sy1">,</span> <span class="re5">Mode</span><span class="br0">)</span> <span class="sy1">-&gt;</span><br>  <span class="re5">Bitmap</span><span class="sy1">.</span><br>&nbsp;</pre> 
        <h2><span class="mw-headline" id="Euphoria"><a href="/wiki/Category:Euphoria" title="Category:Euphoria">Euphoria</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=11" title="Edit section: Euphoria">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <pre class="euphoria highlighted_source"><span class="kw1">function</span> to_gray<span class="br0">(</span><span class="kw2">sequence</span> image<span class="br0">)</span><br>    <span class="kw2">sequence</span> color<br>    <span class="kw1">for</span> i <span class="sy1">=</span> <span class="nu0">1</span> <span class="kw1">to</span> <span class="kw2">length</span><span class="br0">(</span>image<span class="br0">)</span> <span class="kw1">do</span><br>        <span class="kw1">for</span> j <span class="sy1">=</span> <span class="nu0">1</span> <span class="kw1">to</span> <span class="kw2">length</span><span class="br0">(</span>image<span class="br0">[</span>i<span class="br0">]</span><span class="br0">)</span> <span class="kw1">do</span><br>            color <span class="sy1">=</span> <span class="kw2">and_bits</span><span class="br0">(</span>image<span class="br0">[</span>i<span class="br0">]</span><span class="br0">[</span>j<span class="br0">]</span><span class="sy2">,</span> <span class="br0">{</span>#FF0000<span class="sy2">,</span>#FF00<span class="sy2">,</span>#FF<span class="br0">}</span><span class="br0">)</span> <span class="sy1">/</span><br>                                          <span class="br0">{</span>#010000<span class="sy2">,</span>#0100<span class="sy2">,</span>#01<span class="br0">}</span> <span class="co1">-- unpack color triple</span><br>            image<span class="br0">[</span>i<span class="br0">]</span><span class="br0">[</span>j<span class="br0">]</span> <span class="sy1">=</span> <span class="kw2">floor</span><span class="br0">(</span><span class="nu0">0.2126</span><span class="sy1">*</span>color<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy1">+</span> <span class="nu0">0.7152</span><span class="sy1">*</span>color<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span> <span class="sy1">+</span> <span class="nu0">0.0722</span><span class="sy1">*</span>color<span class="br0">[</span><span class="nu0">3</span><span class="br0">]</span><span class="br0">)</span><br>        <span class="kw1">end</span> <span class="kw1">for</span><br>    <span class="kw1">end</span> <span class="kw1">for</span><br>    <span class="kw1">return</span> image<br><span class="kw1">end</span> <span class="kw1">function</span><br>&nbsp;<br><span class="kw1">function</span> to_color<span class="br0">(</span><span class="kw2">sequence</span> image<span class="br0">)</span><br>    <span class="kw1">for</span> i <span class="sy1">=</span> <span class="nu0">1</span> <span class="kw1">to</span> <span class="kw2">length</span><span class="br0">(</span>image<span class="br0">)</span> <span class="kw1">do</span><br>        <span class="kw1">for</span> j <span class="sy1">=</span> <span class="nu0">1</span> <span class="kw1">to</span> <span class="kw2">length</span><span class="br0">(</span>image<span class="br0">[</span>i<span class="br0">]</span><span class="br0">)</span> <span class="kw1">do</span><br>            image<span class="br0">[</span>i<span class="br0">]</span><span class="br0">[</span>j<span class="br0">]</span> <span class="sy1">=</span> image<span class="br0">[</span>i<span class="br0">]</span><span class="br0">[</span>j<span class="br0">]</span><span class="sy1">*</span>#010101<br>        <span class="kw1">end</span> <span class="kw1">for</span><br>    <span class="kw1">end</span> <span class="kw1">for</span><br>    <span class="kw1">return</span> image<br><span class="kw1">end</span> <span class="kw1">function</span></pre> 
        <h2><span class="mw-headline" id="FBSL"><a href="/wiki/Category:FBSL" title="Category:FBSL">FBSL</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=12" title="Edit section: FBSL">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>24-bpp BMP-format P.O.T.-size image solution: </p> 
        <div class="floatright">
         <a href="/wiki/File:FBSLLena.png" class="image"><img alt="FBSLLena.png" src="/mw/images/1/1d/FBSLLena.png" width="128" height="256"></a>
        </div> 
        <pre class="qbasic highlighted_source"><a href="http://www.qbasicnews.com/qboho/qckdim.shtml"><span class="kw3">DIM</span></a> colored <span class="sy0">=</span> <span class="st0">".\LenaClr.bmp"</span><span class="sy0">,</span> grayscale <span class="sy0">=</span> <span class="st0">".\LenaGry.bmp"</span><br><a href="http://www.qbasicnews.com/qboho/qckdim.shtml"><span class="kw3">DIM</span></a> head<span class="sy0">,</span> tail<span class="sy0">,</span> r<span class="sy0">,</span> g<span class="sy0">,</span> b<span class="sy0">,</span> l<span class="sy0">,</span> ptr<span class="sy0">,</span> blobsize <span class="sy0">=</span> <span class="nu0">54</span> <span class="co1">' sizeof BMP file headers</span><br>&nbsp;<br>FILEGET<span class="br0">(</span>FILEOPEN<span class="br0">(</span>colored<span class="sy0">,</span> <a href="http://www.qbasicnews.com/qboho/qckbinary.shtml"><span class="kw3">BINARY</span></a><span class="br0">)</span><span class="sy0">,</span> FILELEN<span class="br0">(</span>colored<span class="br0">)</span><span class="br0">)</span>: FILECLOSE<span class="br0">(</span>FILEOPEN<span class="br0">)</span> <span class="co1">' load buffer</span><br>head <span class="sy0">=</span> @FILEGET <span class="sy0">+</span> blobsize: tail <span class="sy0">=</span> @FILEGET <span class="sy0">+</span> FILELEN <span class="co1">' set loop bounds</span><br>&nbsp;<br><span class="kw1">FOR</span> ptr <span class="sy0">=</span> head <span class="kw1">TO</span> tail <span class="kw1">STEP</span> <span class="nu0">3</span> <span class="co1">' transform color triplets</span><br>	b <span class="sy0">=</span> <a href="http://www.qbasicnews.com/qboho/qckpeek.shtml"><span class="kw3">PEEK</span></a><span class="br0">(</span>ptr <span class="sy0">+</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="br0">)</span> <span class="co1">' read Windows colors stored in BGR order</span><br>	g <span class="sy0">=</span> <a href="http://www.qbasicnews.com/qboho/qckpeek.shtml"><span class="kw3">PEEK</span></a><span class="br0">(</span>ptr <span class="sy0">+</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="br0">)</span><br>	r <span class="sy0">=</span> <a href="http://www.qbasicnews.com/qboho/qckpeek.shtml"><span class="kw3">PEEK</span></a><span class="br0">(</span>ptr <span class="sy0">+</span> <span class="nu0">2</span><span class="sy0">,</span> <span class="nu0">1</span><span class="br0">)</span><br>	l <span class="sy0">=</span> <span class="nu0">0.2126</span> <span class="sy0">*</span> r <span class="sy0">+</span> <span class="nu0">0.7152</span> <span class="sy0">*</span> g <span class="sy0">+</span> <span class="nu0">0.0722</span> <span class="sy0">*</span> b <span class="co1">' derive luminance</span><br>	<a href="http://www.qbasicnews.com/qboho/qcksetmem.shtml"><span class="kw3">SETMEM</span></a><span class="br0">(</span>FILEGET<span class="sy0">,</span> RGB<span class="br0">(</span>l<span class="sy0">,</span> l<span class="sy0">,</span> l<span class="br0">)</span><span class="sy0">,</span> ptr <span class="sy0">-</span> head <span class="sy0">+</span> blobsize<span class="sy0">,</span> <span class="nu0">3</span><span class="br0">)</span> <span class="co1">' write grayscale</span><br><span class="kw1">NEXT</span><br>&nbsp;<br>FILEPUT<span class="br0">(</span>FILEOPEN<span class="br0">(</span>grayscale<span class="sy0">,</span> BINARY_NEW<span class="br0">)</span><span class="sy0">,</span> FILEGET<span class="br0">)</span>: FILECLOSE<span class="br0">(</span>FILEOPEN<span class="br0">)</span> <span class="co1">' save buffer</span></pre> 
        <h2><span class="mw-headline" id="Forth"><a href="/wiki/Category:Forth" title="Category:Forth">Forth</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=13" title="Edit section: Forth">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <pre class="text highlighted_source">\ grayscale bitmap (without word-alignment for scan lines)<br>&nbsp;<br>\ bdim, bwidth, bdata all work with graymaps<br>&nbsp;<br>: graymap ( w h -- gmp )<br>  2dup * bdata allocate throw<br>  dup &gt;r 2! r&gt;&nbsp;;<br>&nbsp;<br>: gxy ( x y gmp -- addr )<br>  dup bwidth rot * rot + swap bdata +&nbsp;;<br>&nbsp;<br>: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="771037">[email&nbsp;protected]</a> ( x y gmp -- c ) gxy <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c9aa89">[email&nbsp;protected]</a>&nbsp;;<br>: g! ( c x y bmp -- ) gxy c!&nbsp;;<br>&nbsp;<br>: gfill ( c gmp -- )<br>  dup bdata swap bdim * rot fill&nbsp;;<br>&nbsp;<br>: gshow ( gmp -- )<br>  dup bdim<br>  0 do cr<br>    dup 0 do<br>      over i j rot <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e88fa8">[email&nbsp;protected]</a> if [char] * emit else space then<br>    loop<br>  loop<br>  2drop&nbsp;;<br>&nbsp;<br>\ RGB &lt;-&gt; Grayscale<br>: lum&gt;rgb ( 0..255 -- pixel )<br>   dup 8 lshift or<br>   dup 8 lshift or&nbsp;;<br>&nbsp;<br>: pixel&gt;rgb ( pixel -- r g b )<br>  256 /mod 256 /mod&nbsp;;<br>: rgb&gt;lum ( pixel -- 0..255 )<br>  pixel&gt;rgb<br>   722 *   swap<br>  7152 * + swap<br>  2126 * + 10000 /&nbsp;;<br>&nbsp;<br>: bitmap&gt;graymap ( bmp -- gmp )<br>  dup bdim graymap<br>  dup bdim nip 0 do<br>    dup bwidth 0 do<br>      over i j rot <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b4d6f4">[email&nbsp;protected]</a> rgb&gt;lum<br>      over i j rot g!<br>    loop<br>  loop nip&nbsp;;<br>&nbsp;<br>: graymap&gt;bitmap ( gmp -- bmp )<br>  dup bdim bitmap<br>  dup bdim nip 0 do<br>    dup bwidth 0 do<br>      over i j rot <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1c7b5c">[email&nbsp;protected]</a> lum&gt;rgb<br>      over i j rot b!<br>    loop<br>  loop nip&nbsp;;</pre> 
        <h2><span class="mw-headline" id="Fortran"><a href="/wiki/Category:Fortran" title="Category:Fortran">Fortran</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=14" title="Edit section: Fortran">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>(These fragments should be added to <tt>RCImageBasic</tt> module, see <a href="/wiki/Basic_bitmap_storage#Fortran" title="Basic bitmap storage" class="mw-redirect">Basic bitmap storage</a>) </p>
        <p>First let's define a new type; the <tt>sc</tt> stands for Single Channel, which can be luminance (as it is here). </p> 
        <pre class="fortran highlighted_source"><span class="kw3">type</span> scimage<br>   <span class="kw3">integer</span>, <span class="kw3">dimension</span><span class="br0">(</span><span class="sy0">:</span>,<span class="sy0">:</span><span class="br0">)</span>, <span class="kw3">pointer</span> <span class="sy0">::</span> <span class="me2">channel</span><br>   <span class="kw3">integer</span> <span class="sy0">::</span> <span class="me2">width</span>, height<br><span class="kw1">end</span> <span class="kw3">type</span> scimage</pre> 
        <p>In order to allow proper overloading, the following subroutines of the <a href="/wiki/Basic_bitmap_storage#Fortran" title="Basic bitmap storage" class="mw-redirect">storage</a> should be renamed appending the <tt>_rgb</tt> suffix: valid_image, inside_image, alloc_img, free_img, fill_img, get_pixel, put_pixel, init_img. The <i>single channel</i> version would be named with the <tt>_sc</tt> suffix, then we should define the proper interfaces to use the already written code as before. Here there are only the interfaces and subroutines needed for the task. </p> 
        <pre class="fortran highlighted_source"><span class="kw1">interface</span> alloc_img<br>   <span class="kw1">module</span> <span class="kw1">procedure</span> alloc_img_rgb, alloc_img_sc<br><span class="kw1">end</span> <span class="kw1">interface</span><br>&nbsp;<br><span class="kw1">interface</span> free_img<br>   <span class="kw1">module</span> <span class="kw1">procedure</span> free_img_rgb, free_img_sc<br><span class="kw1">end</span> <span class="kw1">interface</span></pre> 
        <p>Now we can define useful interfaces and subroutines more task-related: </p> 
        <pre class="fortran highlighted_source"><span class="kw1">interface</span> assignment<span class="br0">(</span><span class="sy0">=</span><span class="br0">)</span><br>   <span class="kw1">module</span> <span class="kw1">procedure</span> rgbtosc, sctorgb<br><span class="kw1">end</span> <span class="kw1">interface</span></pre> 
        <pre class="fortran highlighted_source"><span class="kw1">subroutine</span> alloc_img_sc<span class="br0">(</span>img, w, h<span class="br0">)</span><br>  <span class="kw3">type</span><span class="br0">(</span>scimage<span class="br0">)</span> <span class="sy0">::</span> <span class="me2">img</span><br>  <span class="kw3">integer</span>, <span class="kw3">intent</span><span class="br0">(</span><span class="kw3">in</span><span class="br0">)</span> <span class="sy0">::</span> <span class="me2">w</span>, h<br>&nbsp;<br>  <span class="kw1">allocate</span><span class="br0">(</span>img<span class="sy0">%</span>channel<span class="br0">(</span>w, h<span class="br0">)</span><span class="br0">)</span><br>  img<span class="sy0">%</span>width <span class="sy0">=</span> w<br>  img<span class="sy0">%</span>height <span class="sy0">=</span> h<br><span class="kw1">end</span> <span class="kw1">subroutine</span> alloc_img_sc<br>&nbsp;<br><span class="kw1">subroutine</span> free_img_sc<span class="br0">(</span>img<span class="br0">)</span><br>  <span class="kw3">type</span><span class="br0">(</span>scimage<span class="br0">)</span> <span class="sy0">::</span> <span class="me2">img</span><br>&nbsp;<br>  <span class="kw1">if</span> <span class="br0">(</span> associated<span class="br0">(</span>img<span class="sy0">%</span>channel<span class="br0">)</span> <span class="br0">)</span> <span class="kw1">deallocate</span><span class="br0">(</span>img<span class="sy0">%</span>channel<span class="br0">)</span><br><span class="kw1">end</span> <span class="kw1">subroutine</span> free_img_sc<br>&nbsp;<br><span class="kw1">subroutine</span> rgbtosc<span class="br0">(</span>sc, colored<span class="br0">)</span><br>  <span class="kw3">type</span><span class="br0">(</span>rgbimage<span class="br0">)</span>, <span class="kw3">intent</span><span class="br0">(</span><span class="kw3">in</span><span class="br0">)</span> <span class="sy0">::</span> <span class="me2">colored</span><br>  <span class="kw3">type</span><span class="br0">(</span>scimage<span class="br0">)</span>, <span class="kw3">intent</span><span class="br0">(</span><span class="kw3">inout</span><span class="br0">)</span> <span class="sy0">::</span> <span class="me2">sc</span><br>&nbsp;<br>  <span class="kw1">if</span> <span class="br0">(</span> <span class="br0">(</span> <span class="kw2">.<span class="kw4">not</span>.</span> valid_image<span class="br0">(</span>sc<span class="br0">)</span> <span class="br0">)</span> <span class="kw2">.<span class="me1">and</span>.</span> valid_image<span class="br0">(</span>colored<span class="br0">)</span> <span class="br0">)</span> <span class="kw1">then</span><br>     <span class="kw1">call</span> alloc_img<span class="br0">(</span>sc, colored<span class="sy0">%</span>width, colored<span class="sy0">%</span>height<span class="br0">)</span><br>  <span class="kw1">end</span> <span class="kw1">if</span><br>&nbsp;<br>  <span class="kw1">if</span> <span class="br0">(</span> valid_image<span class="br0">(</span>sc<span class="br0">)</span> <span class="kw2">.<span class="me1">and</span>.</span> valid_image<span class="br0">(</span>colored<span class="br0">)</span> <span class="br0">)</span> <span class="kw1">then</span><br>     sc<span class="sy0">%</span>channel <span class="sy0">=</span> <span class="kw4">floor</span><span class="br0">(</span><span class="nu0">0.2126</span><span class="sy0">*</span>colored<span class="sy0">%</span>red <span class="sy0">+</span> <span class="nu0">0.7152</span><span class="sy0">*</span>colored<span class="sy0">%</span>green <span class="sy0">+</span> <span class="sy0">&amp;</span><br>                        <span class="nu0">0.0722</span><span class="sy0">*</span>colored<span class="sy0">%</span>blue<span class="br0">)</span><br>  <span class="kw1">end</span> <span class="kw1">if</span><br>&nbsp;<br><span class="kw1">end</span> <span class="kw1">subroutine</span> rgbtosc<br>&nbsp;<br><span class="kw1">subroutine</span> sctorgb<span class="br0">(</span>colored, sc<span class="br0">)</span><br>  <span class="kw3">type</span><span class="br0">(</span>scimage<span class="br0">)</span>, <span class="kw3">intent</span><span class="br0">(</span><span class="kw3">in</span><span class="br0">)</span> <span class="sy0">::</span> <span class="me2">sc</span><br>  <span class="kw3">type</span><span class="br0">(</span>rgbimage<span class="br0">)</span>, <span class="kw3">intent</span><span class="br0">(</span><span class="kw3">inout</span><span class="br0">)</span> <span class="sy0">::</span> <span class="me2">colored</span><br>&nbsp;<br>  <span class="kw1">if</span> <span class="br0">(</span> <span class="br0">(</span> <span class="kw2">.<span class="kw4">not</span>.</span> valid_image<span class="br0">(</span>colored<span class="br0">)</span> <span class="br0">)</span> <span class="kw2">.<span class="me1">and</span>.</span> valid_image<span class="br0">(</span>sc<span class="br0">)</span> <span class="br0">)</span> <span class="kw1">then</span><br>     <span class="kw1">call</span> alloc_img_rgb<span class="br0">(</span>colored, sc<span class="sy0">%</span>width, sc<span class="sy0">%</span>height<span class="br0">)</span><br>  <span class="kw1">end</span> <span class="kw1">if</span><br>&nbsp;<br>  <span class="kw1">if</span> <span class="br0">(</span> valid_image<span class="br0">(</span>sc<span class="br0">)</span> <span class="kw2">.<span class="me1">and</span>.</span> valid_image<span class="br0">(</span>colored<span class="br0">)</span> <span class="br0">)</span> <span class="kw1">then</span><br>     colored<span class="sy0">%</span>red <span class="sy0">=</span> sc<span class="sy0">%</span>channel<br>     colored<span class="sy0">%</span>green <span class="sy0">=</span> sc<span class="sy0">%</span>channel<br>     colored<span class="sy0">%</span>blue <span class="sy0">=</span> sc<span class="sy0">%</span>channel<br>  <span class="kw1">end</span> <span class="kw1">if</span><br>&nbsp;<br><span class="kw1">end</span> <span class="kw1">subroutine</span> sctorgb</pre> 
        <p><b>Usage example</b> (fragment) which can be used to convert from <i>rgb</i> image to <i>grayscale</i> image and back (since we only can output the <i>rgb</i> kind): </p> 
        <pre class="fortran highlighted_source"><span class="kw3">type</span><span class="br0">(</span>scimage<span class="br0">)</span> <span class="sy0">::</span> <span class="me2">gray</span><br><span class="kw3">type</span><span class="br0">(</span>rgbimage<span class="br0">)</span> <span class="sy0">::</span> <span class="me2">animage</span><br>  <span class="co1">! ... here we "load" or create animage</span><br>  <span class="co1">! while gray must be created or initialized to null</span><br>  <span class="co1">! or errors can arise...</span><br>  <span class="kw1">call</span> init_img<span class="br0">(</span>gray<span class="br0">)</span><br>  gray <span class="sy0">=</span> animage<br>  animage <span class="sy0">=</span> gray<br>  <span class="kw1">call</span> output_ppm<span class="br0">(</span>an_unit, animage<span class="br0">)</span></pre> 
        <h2><span class="mw-headline" id="Go"><a href="/wiki/Category:Go" title="Category:Go">Go</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=15" title="Edit section: Go">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <pre class="go highlighted_source"><span class="kw1">package</span> raster<br>&nbsp;<br><span class="kw1">import</span> <span class="sy1">(</span><br>    <span class="st0">"math"</span><br>    <span class="st0">"math/rand"</span><br><span class="sy1">)</span><br>&nbsp;<br><span class="co1">// Grmap parallels Bitmap, but with an element type of uint16</span><br><span class="co1">// in place of Pixel.</span><br><span class="kw1">type</span> Grmap <span class="kw4">struct</span> <span class="sy1">{</span><br>    Comments   <span class="sy1">[]</span><span class="kw4">string</span><br>    rows<span class="sy1">,</span> cols <span class="kw4">int</span><br>    px         <span class="sy1">[]</span><span class="kw4">uint16</span><br>    pxRow      <span class="sy1">[][]</span><span class="kw4">uint16</span><br><span class="sy1">}</span><br>&nbsp;<br><span class="co1">// NewGrmap constructor.</span><br><span class="kw4">func</span> NewGrmap<span class="sy1">(</span>x<span class="sy1">,</span> y <span class="kw4">int</span><span class="sy1">)</span> <span class="sy1">(</span>b <span class="sy3">*</span>Grmap<span class="sy1">)</span> <span class="sy1">{</span><br>    g <span class="sy2">:=</span> &amp;Grmap<span class="sy1">{</span><br>        Comments<span class="sy1">:</span> <span class="sy1">[]</span><span class="kw4">string</span><span class="sy1">{</span>creator<span class="sy1">},</span> <span class="co1">// creator a const in bitmap source file</span><br>        rows<span class="sy1">:</span>     y<span class="sy1">,</span><br>        cols<span class="sy1">:</span>     x<span class="sy1">,</span><br>        px<span class="sy1">:</span>       <span class="kw3">make</span><span class="sy1">([]</span><span class="kw4">uint16</span><span class="sy1">,</span> x<span class="sy3">*</span>y<span class="sy1">),</span><br>        pxRow<span class="sy1">:</span>    <span class="kw3">make</span><span class="sy1">([][]</span><span class="kw4">uint16</span><span class="sy1">,</span> y<span class="sy1">),</span><br>    <span class="sy1">}</span><br>    x0<span class="sy1">,</span> x1 <span class="sy2">:=</span> <span class="nu0">0</span><span class="sy1">,</span> x<br>    <span class="kw1">for</span> <span class="nu2">i</span> <span class="sy2">:=</span> <span class="kw1">range</span> g<span class="sy3">.</span>pxRow <span class="sy1">{</span><br>        g<span class="sy3">.</span>pxRow<span class="sy1">[</span><span class="nu2">i</span><span class="sy1">]</span> <span class="sy2">=</span> g<span class="sy3">.</span>px<span class="sy1">[</span>x0<span class="sy1">:</span>x1<span class="sy1">]</span><br>        x0<span class="sy1">,</span> x1 <span class="sy2">=</span> x1<span class="sy1">,</span> x1<span class="sy3">+</span>x<br>    <span class="sy1">}</span><br>    <span class="kw1">return</span> g<br><span class="sy1">}</span><br>&nbsp;<br><span class="kw4">func</span> <span class="sy1">(</span>b <span class="sy3">*</span>Grmap<span class="sy1">)</span> Extent<span class="sy1">()</span> <span class="sy1">(</span>cols<span class="sy1">,</span> rows <span class="kw4">int</span><span class="sy1">)</span> <span class="sy1">{</span><br>    <span class="kw1">return</span> b<span class="sy3">.</span>cols<span class="sy1">,</span> b<span class="sy3">.</span>rows<br><span class="sy1">}</span><br>&nbsp;<br><span class="kw4">func</span> <span class="sy1">(</span>g <span class="sy3">*</span>Grmap<span class="sy1">)</span> Fill<span class="sy1">(</span>c <span class="kw4">uint16</span><span class="sy1">)</span> <span class="sy1">{</span><br>    <span class="kw1">for</span> <span class="nu2">i</span> <span class="sy2">:=</span> <span class="kw1">range</span> g<span class="sy3">.</span>px <span class="sy1">{</span><br>        g<span class="sy3">.</span>px<span class="sy1">[</span><span class="nu2">i</span><span class="sy1">]</span> <span class="sy2">=</span> c<br>    <span class="sy1">}</span><br><span class="sy1">}</span><br>&nbsp;<br><span class="kw4">func</span> <span class="sy1">(</span>g <span class="sy3">*</span>Grmap<span class="sy1">)</span> SetPx<span class="sy1">(</span>x<span class="sy1">,</span> y <span class="kw4">int</span><span class="sy1">,</span> c <span class="kw4">uint16</span><span class="sy1">)</span> <span class="kw4">bool</span> <span class="sy1">{</span><br>    <span class="kw1">defer</span> <span class="kw4">func</span><span class="sy1">()</span> <span class="sy1">{</span> <span class="kw3">recover</span><span class="sy1">()</span> <span class="sy1">}()</span><br>    g<span class="sy3">.</span>pxRow<span class="sy1">[</span>y<span class="sy1">][</span>x<span class="sy1">]</span> <span class="sy2">=</span> c<br>    <span class="kw1">return</span> <span class="kw2">true</span><br><span class="sy1">}</span><br>&nbsp;<br><span class="kw4">func</span> <span class="sy1">(</span>g <span class="sy3">*</span>Grmap<span class="sy1">)</span> GetPx<span class="sy1">(</span>x<span class="sy1">,</span> y <span class="kw4">int</span><span class="sy1">)</span> <span class="sy1">(</span><span class="kw4">uint16</span><span class="sy1">,</span> <span class="kw4">bool</span><span class="sy1">)</span> <span class="sy1">{</span><br>    <span class="kw1">defer</span> <span class="kw4">func</span><span class="sy1">()</span> <span class="sy1">{</span> <span class="kw3">recover</span><span class="sy1">()</span> <span class="sy1">}()</span><br>    <span class="kw1">return</span> g<span class="sy3">.</span>pxRow<span class="sy1">[</span>y<span class="sy1">][</span>x<span class="sy1">],</span> <span class="kw2">true</span><br><span class="sy1">}</span><br>&nbsp;<br><span class="co1">// Grmap method of Bitmap, converts (color) Bitmap to (grayscale) Grmap</span><br><span class="kw4">func</span> <span class="sy1">(</span>b <span class="sy3">*</span>Bitmap<span class="sy1">)</span> Grmap<span class="sy1">()</span> <span class="sy3">*</span>Grmap <span class="sy1">{</span><br>    g <span class="sy2">:=</span> NewGrmap<span class="sy1">(</span>b<span class="sy3">.</span>cols<span class="sy1">,</span> b<span class="sy3">.</span>rows<span class="sy1">)</span><br>    g<span class="sy3">.</span>Comments <span class="sy2">=</span> append<span class="sy1">([]</span><span class="kw4">string</span><span class="sy1">{},</span> b<span class="sy3">.</span>Comments<span class="sy4">...</span><span class="sy1">)</span><br>    <span class="kw1">for</span> <span class="nu2">i</span><span class="sy1">,</span> p <span class="sy2">:=</span> <span class="kw1">range</span> b<span class="sy3">.</span>px <span class="sy1">{</span><br>        g<span class="sy3">.</span>px<span class="sy1">[</span><span class="nu2">i</span><span class="sy1">]</span> <span class="sy2">=</span> <span class="kw4">uint16</span><span class="sy1">((</span><span class="kw4">int64</span><span class="sy1">(</span>p<span class="sy3">.</span>R<span class="sy1">)</span><span class="sy3">*</span><span class="nu0">2126</span> <span class="sy3">+</span> <span class="kw4">int64</span><span class="sy1">(</span>p<span class="sy3">.</span>G<span class="sy1">)</span><span class="sy3">*</span><span class="nu0">7152</span> <span class="sy3">+</span> <span class="kw4">int64</span><span class="sy1">(</span>p<span class="sy3">.</span>B<span class="sy1">)</span><span class="sy3">*</span><span class="nu0">722</span><span class="sy1">)</span> <span class="sy3">*</span><br>            math<span class="sy3">.</span>MaxUint16 <span class="sy3">/</span> <span class="sy1">(</span>math<span class="sy3">.</span>MaxUint8 <span class="sy3">*</span> <span class="nu0">10000</span><span class="sy1">))</span><br>    <span class="sy1">}</span><br>    <span class="kw1">return</span> g<br><span class="sy1">}</span><br>&nbsp;<br><span class="co1">// Bitmap method Grmap, converts Grmap to Bitmap.  All pixels in the resulting</span><br><span class="co1">// color Bitmap will be (very nearly) shades of gray.</span><br><span class="kw4">func</span> <span class="sy1">(</span>g <span class="sy3">*</span>Grmap<span class="sy1">)</span> Bitmap<span class="sy1">()</span> <span class="sy3">*</span>Bitmap <span class="sy1">{</span><br>    b <span class="sy2">:=</span> NewBitmap<span class="sy1">(</span>g<span class="sy3">.</span>cols<span class="sy1">,</span> g<span class="sy3">.</span>rows<span class="sy1">)</span><br>    b<span class="sy3">.</span>Comments <span class="sy2">=</span> append<span class="sy1">([]</span><span class="kw4">string</span><span class="sy1">{},</span> g<span class="sy3">.</span>Comments<span class="sy4">...</span><span class="sy1">)</span><br>    <span class="kw1">for</span> <span class="nu2">i</span><span class="sy1">,</span> p <span class="sy2">:=</span> <span class="kw1">range</span> g<span class="sy3">.</span>px <span class="sy1">{</span><br>        roundedSum <span class="sy2">:=</span> <span class="kw4">int</span><span class="sy1">(</span>p<span class="sy1">)</span> <span class="sy3">*</span> <span class="nu0">3</span> <span class="sy3">*</span> math<span class="sy3">.</span>MaxUint8 <span class="sy3">/</span> math<span class="sy3">.</span>MaxUint16<br>        rounded <span class="sy2">:=</span> <span class="kw4">uint8</span><span class="sy1">(</span>roundedSum <span class="sy3">/</span> <span class="nu0">3</span><span class="sy1">)</span><br>        remainder <span class="sy2">:=</span> roundedSum <span class="sy3">%</span> <span class="nu0">3</span><br>        b<span class="sy3">.</span>px<span class="sy1">[</span><span class="nu2">i</span><span class="sy1">]</span><span class="sy3">.</span>R <span class="sy2">=</span> rounded<br>        b<span class="sy3">.</span>px<span class="sy1">[</span><span class="nu2">i</span><span class="sy1">]</span><span class="sy3">.</span>G <span class="sy2">=</span> rounded<br>        b<span class="sy3">.</span>px<span class="sy1">[</span><span class="nu2">i</span><span class="sy1">]</span><span class="sy3">.</span>B <span class="sy2">=</span> rounded<br>        <span class="kw1">if</span> remainder &gt; <span class="nu0">0</span> <span class="sy1">{</span><br>            odd <span class="sy2">:=</span> rand<span class="sy3">.</span>Intn<span class="sy1">(</span><span class="nu0">3</span><span class="sy1">)</span><br>            <span class="kw1">switch</span> odd <span class="sy3">+</span> <span class="sy1">(</span>remainder <span class="sy3">*</span> <span class="nu0">3</span><span class="sy1">)</span> <span class="sy1">{</span><br>            <span class="kw1">case</span> <span class="nu0">3</span><span class="sy1">:</span><br>                b<span class="sy3">.</span>px<span class="sy1">[</span><span class="nu2">i</span><span class="sy1">]</span><span class="sy3">.</span>R<span class="sy2">++</span><br>            <span class="kw1">case</span> <span class="nu0">4</span><span class="sy1">:</span><br>                b<span class="sy3">.</span>px<span class="sy1">[</span><span class="nu2">i</span><span class="sy1">]</span><span class="sy3">.</span>G<span class="sy2">++</span><br>            <span class="kw1">case</span> <span class="nu0">5</span><span class="sy1">:</span><br>                b<span class="sy3">.</span>px<span class="sy1">[</span><span class="nu2">i</span><span class="sy1">]</span><span class="sy3">.</span>B<span class="sy2">++</span><br>            <span class="kw1">case</span> <span class="nu0">6</span><span class="sy1">:</span><br>                b<span class="sy3">.</span>px<span class="sy1">[</span><span class="nu2">i</span><span class="sy1">]</span><span class="sy3">.</span>G<span class="sy2">++</span><br>                b<span class="sy3">.</span>px<span class="sy1">[</span><span class="nu2">i</span><span class="sy1">]</span><span class="sy3">.</span>B<span class="sy2">++</span><br>            <span class="kw1">case</span> <span class="nu0">7</span><span class="sy1">:</span><br>                b<span class="sy3">.</span>px<span class="sy1">[</span><span class="nu2">i</span><span class="sy1">]</span><span class="sy3">.</span>R<span class="sy2">++</span><br>                b<span class="sy3">.</span>px<span class="sy1">[</span><span class="nu2">i</span><span class="sy1">]</span><span class="sy3">.</span>B<span class="sy2">++</span><br>            <span class="kw1">case</span> <span class="nu0">8</span><span class="sy1">:</span><br>                b<span class="sy3">.</span>px<span class="sy1">[</span><span class="nu2">i</span><span class="sy1">]</span><span class="sy3">.</span>R<span class="sy2">++</span><br>                b<span class="sy3">.</span>px<span class="sy1">[</span><span class="nu2">i</span><span class="sy1">]</span><span class="sy3">.</span>G<span class="sy2">++</span><br>            <span class="sy1">}</span><br>        <span class="sy1">}</span><br>    <span class="sy1">}</span><br>    <span class="kw1">return</span> b<br><span class="sy1">}</span></pre> 
        <p>For demonstration program see task <a href="/wiki/Bitmap/Read_a_PPM_file" title="Bitmap/Read a PPM file">Bitmap/Read a PPM file</a>. </p> 
        <h2><span class="mw-headline" id="Haskell"><a href="/wiki/Category:Haskell" title="Category:Haskell">Haskell</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=16" title="Edit section: Haskell">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <pre class="haskell highlighted_source"><span class="kw1">module</span> Bitmap<span class="sy0">.</span>Gray<span class="br0">(</span><span class="kw1">module</span> Bitmap<span class="sy0">.</span>Gray<span class="br0">)</span> <span class="kw1">where</span><br>&nbsp;<br><span class="kw1">import</span> Bitmap<br><span class="kw1">import</span> Control<span class="sy0">.</span><a href="http://haskell.org/ghc/docs/latest/html/libraries/base/Prelude.html#t:Monad"><span class="kw4">Monad</span></a><span class="sy0">.</span>ST<br>&nbsp;<br><span class="kw1">newtype</span> Gray <span class="sy0">=</span> Gray <a href="http://haskell.org/ghc/docs/latest/html/libraries/base/Prelude.html#t:Int"><span class="kw4">Int</span></a> <span class="kw1">deriving</span> <span class="br0">(</span><a href="http://haskell.org/ghc/docs/latest/html/libraries/base/Prelude.html#t:Eq"><span class="kw4">Eq</span></a><span class="sy0">,</span> <a href="http://haskell.org/ghc/docs/latest/html/libraries/base/Prelude.html#t:Ord"><span class="kw4">Ord</span></a><span class="br0">)</span><br>&nbsp;<br><span class="kw1">instance</span> Color Gray <span class="kw1">where</span><br>    luminance <span class="br0">(</span>Gray x<span class="br0">)</span> <span class="sy0">=</span> x<br>    black <span class="sy0">=</span> Gray <span class="nu0">0</span><br>    white <span class="sy0">=</span> Gray <span class="nu0">255</span><br>    toNetpbm <span class="sy0">=</span> <a href="http://haskell.org/ghc/docs/latest/html/libraries/base/Prelude.html#v:map"><span class="kw3">map</span></a> <span class="sy0">$</span> <a href="http://haskell.org/ghc/docs/latest/html/libraries/base/Prelude.html#v:toEnum"><span class="kw3">toEnum</span></a> <span class="sy0">.</span> luminance<br>    fromNetpbm <span class="sy0">=</span> <a href="http://haskell.org/ghc/docs/latest/html/libraries/base/Prelude.html#v:map"><span class="kw3">map</span></a> <span class="sy0">$</span> Gray <span class="sy0">.</span> <a href="http://haskell.org/ghc/docs/latest/html/libraries/base/Prelude.html#v:fromEnum"><span class="kw3">fromEnum</span></a><br>    netpbmMagicNumber <span class="sy0">_</span> <span class="sy0">=</span> <span class="st0">"P5"</span><br>    netpbmMaxval <span class="sy0">_</span> <span class="sy0">=</span> <span class="st0">"255"</span><br>&nbsp;<br>toGrayImage <span class="sy0">::</span> Color c <span class="sy0">=&gt;</span> Image s c <span class="sy0">-&gt;</span> ST s <span class="br0">(</span>Image s Gray<span class="br0">)</span><br>toGrayImage <span class="sy0">=</span> mapImage <span class="sy0">$</span> Gray <span class="sy0">.</span> luminance</pre> 
        <p>A <tt>Gray</tt> image can be converted to an <tt>RGB</tt> image with <tt>Bitmap.RGB.toRGBImage</tt>, defined <a href="/wiki/Basic_bitmap_storage" title="Basic bitmap storage" class="mw-redirect">here</a>. </p> 
        <h2><span class="mw-headline" id="J"><a href="/wiki/Category:J" title="Category:J">J</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=17" title="Edit section: J">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>Color bitmap structure and basic functions for manipulations with it are described <a href="/wiki/Basic_bitmap_storage#J" title="Basic bitmap storage" class="mw-redirect">here</a>. </p>
        <p>Grayscale image is stored as two-dimensional array of luminance values. Allowed luminance scale is the same as for the color bitmap; the functions below are neutral to scale. </p> 
        <pre class="j highlighted_source"><span class="co1">NB. converts the image to grayscale according to formula</span><br><span class="co1">NB. L = 0.2126*R + 0.7152*G + 0.0722*B</span><br>toGray=: [: &lt;. +/ .*"<span class="nu0">1</span>&amp;<span class="nu0">0.2126</span> <span class="nu0">0.7152</span> <span class="nu0">0.0722</span><br>&nbsp;<br><span class="co1">NB. converts grayscale image to the color image, with all channels equal</span><br>toColor=: <span class="nu0">3</span> &amp; $"<span class="nu0">0</span></pre> 
        <p>Example: </p> 
        <pre class="j highlighted_source">viewRGB toColor toGray myimg</pre> 
        <h2><span class="mw-headline" id="Java"><a href="/wiki/Category:Java" title="Category:Java">Java</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=18" title="Edit section: Java">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <pre class="java highlighted_source"><span class="kw4">void</span> convertToGrayscale<span class="br0">(</span><span class="kw1">final</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Abufferedimage+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span class="kw3">BufferedImage</span></a> image<span class="br0">)</span><span class="br0">{</span><br>    <span class="kw1">for</span><span class="br0">(</span><span class="kw4">int</span> i<span class="sy0">=</span><span class="nu0">0</span><span class="sy0">;</span> i<span class="sy0">&lt;</span>image.<span class="me1">getWidth</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> i<span class="sy0">++</span><span class="br0">)</span><span class="br0">{</span><br>        <span class="kw1">for</span><span class="br0">(</span><span class="kw4">int</span> j<span class="sy0">=</span><span class="nu0">0</span><span class="sy0">;</span> j<span class="sy0">&lt;</span>image.<span class="me1">getHeight</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> j<span class="sy0">++</span><span class="br0">)</span><span class="br0">{</span><br>            <span class="kw4">int</span> color <span class="sy0">=</span> image.<span class="me1">getRGB</span><span class="br0">(</span>i,j<span class="br0">)</span><span class="sy0">;</span><br>&nbsp;<br>            <span class="kw4">int</span> alpha <span class="sy0">=</span> <span class="br0">(</span>color <span class="sy0">&gt;&gt;</span> <span class="nu0">24</span><span class="br0">)</span> <span class="sy0">&amp;</span> <span class="nu0">255</span><span class="sy0">;</span><br>            <span class="kw4">int</span> red <span class="sy0">=</span> <span class="br0">(</span>color <span class="sy0">&gt;&gt;</span> <span class="nu0">16</span><span class="br0">)</span> <span class="sy0">&amp;</span> <span class="nu0">255</span><span class="sy0">;</span><br>            <span class="kw4">int</span> green <span class="sy0">=</span> <span class="br0">(</span>color <span class="sy0">&gt;&gt;</span> <span class="nu0">8</span><span class="br0">)</span> <span class="sy0">&amp;</span> <span class="nu0">255</span><span class="sy0">;</span><br>            <span class="kw4">int</span> blue <span class="sy0">=</span> <span class="br0">(</span>color<span class="br0">)</span> <span class="sy0">&amp;</span> <span class="nu0">255</span><span class="sy0">;</span><br>&nbsp;<br>            <span class="kw1">final</span> <span class="kw4">int</span> lum <span class="sy0">=</span> <span class="br0">(</span><span class="kw4">int</span><span class="br0">)</span><span class="br0">(</span><span class="nu0">0.2126</span> <span class="sy0">*</span> red <span class="sy0">+</span> <span class="nu0">0.7152</span> <span class="sy0">*</span> green <span class="sy0">+</span> <span class="nu0">0.0722</span> <span class="sy0">*</span> blue<span class="br0">)</span><span class="sy0">;</span><br>&nbsp;<br>            alpha <span class="sy0">=</span> <span class="br0">(</span>alpha <span class="sy0">&lt;&lt;</span> <span class="nu0">24</span><span class="br0">)</span><span class="sy0">;</span><br>            red <span class="sy0">=</span> <span class="br0">(</span>lum <span class="sy0">&lt;&lt;</span> <span class="nu0">16</span><span class="br0">)</span><span class="sy0">;</span><br>            green <span class="sy0">=</span> <span class="br0">(</span>lum <span class="sy0">&lt;&lt;</span> <span class="nu0">8</span><span class="br0">)</span><span class="sy0">;</span><br>            blue <span class="sy0">=</span> lum<span class="sy0">;</span><br>&nbsp;<br>            color <span class="sy0">=</span> alpha <span class="sy0">+</span> red <span class="sy0">+</span> green <span class="sy0">+</span> blue<span class="sy0">;</span><br>&nbsp;<br>            image.<span class="me1">setRGB</span><span class="br0">(</span>i,j,color<span class="br0">)</span><span class="sy0">;</span><br>        <span class="br0">}</span><br>    <span class="br0">}</span><br><span class="br0">}</span><br>&nbsp;</pre> 
        <h2><span class="mw-headline" id="JavaScript"><a href="/wiki/Category:JavaScript" title="Category:JavaScript">JavaScript</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=19" title="Edit section: JavaScript">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>Live Demo: <a rel="nofollow" class="external free" href="http://jsfiddle.net/J4zVy/embedded/result/">http://jsfiddle.net/J4zVy/embedded/result/</a>. </p>
        <p>To load local files into the canvas you have to run a local webserver. See: <a rel="nofollow" class="external free" href="http://stackoverflow.com/questions/3276072/canvas-getimagedata-uncaught-error-security-err-dom-exception-18">http://stackoverflow.com/questions/3276072/canvas-getimagedata-uncaught-error-security-err-dom-exception-18</a>. </p> 
        <pre class="javascript highlighted_source">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"<br>        "http://www.w3.org/TR/html4/strict.dtd"&gt;<br>&lt;html&gt;&lt;head&gt;<span class="sy0">&lt;</span>script type<span class="sy0">=</span><span class="st0">"text/javascript"</span><span class="sy0">&gt;</span><br>window.<span class="me1">addEventListener</span><span class="br0">(</span><br>    <span class="st0">"load"</span><span class="sy0">,</span> <span class="kw1">function</span><span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>   <br>        <span class="kw1">var</span> img <span class="sy0">=</span> <span class="kw1">new</span> Image<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>   <br>        <span class="co1">// ***********************************************************</span><br>        <span class="co1">// RUN LOCAL WEBSERVER TO LOAD LOCAL FILES: e.g. python -m http.server (python3) </span><br>        <span class="co1">// ***********************************************************</span><br>        <span class="co1">// img.src = prompt("enter image path","http://localhost:8000/test.jpg");</span><br>        img.<span class="me1">src</span> <span class="sy0">=</span> <br>            <span class="st0">'data:image/gif;base64,R0lGODlhEAAOALMAAOazToeHh0tLS/7LZv/0jvb29t/f3//Ub/<span class="es0">\</span><br>            /ge8WSLf/rhf/3kdbW1mxsbP//mf///yH5BAAAAAAALAAAAAAQAA4AAARe8L1Ekyky67QZ1hLnjM5UUde0ECwLJoExKcpp<span class="es0">\</span><br>            V0aCcGCmTIHEIUEqjgaORCMxIC6e0CcguWw6aFjsVMkkIr7g77ZKPJjPZqIyd7sJAgVGoEGv2xsBxqNgYPj/gAwXEQA7'</span><span class="sy0">;</span> <br>        img.<span class="me1">onload</span> <span class="sy0">=</span> <span class="kw1">function</span><span class="br0">(</span><span class="br0">)</span><span class="br0">{</span> <br>            <span class="kw1">var</span> can1 <span class="sy0">=</span> <span class="kw1">new</span> CustomCanvas<span class="br0">(</span><span class="st0">"color"</span><span class="sy0">,</span> img.<span class="me1">width</span><span class="sy0">,</span> img.<span class="me1">height</span><span class="br0">)</span><span class="sy0">;</span><br>            <span class="kw1">var</span> can2 <span class="sy0">=</span> <span class="kw1">new</span> CustomCanvas<span class="br0">(</span><span class="st0">"grayscale"</span><span class="sy0">,</span>  img.<span class="me1">width</span><span class="sy0">,</span> img.<span class="me1">height</span><span class="br0">)</span><span class="sy0">;</span><br>            can1.<span class="me1">ctx</span>.<span class="me1">drawImage</span><span class="br0">(</span>img<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> img.<span class="me1">width</span><span class="sy0">,</span> img.<span class="me1">height</span><span class="br0">)</span><span class="sy0">;</span> <br>            <span class="kw1">var</span> imgData <span class="sy0">=</span> can1.<span class="me1">ctx</span>.<span class="me1">getImageData</span><span class="br0">(</span><span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> can1.<span class="me1">w</span><span class="sy0">,</span> can1.<span class="me1">h</span><span class="br0">)</span><span class="sy0">;</span>      <br>            <span class="co1">// desaturate</span><br>            <span class="kw1">var</span> avg<span class="sy0">;</span> <span class="kw1">var</span> max<span class="sy0">;</span> <span class="kw1">var</span> rwgt<span class="sy0">=</span><span class="nu0">0.2126</span><span class="sy0">;</span> <span class="kw1">var</span> gwgt<span class="sy0">=</span><span class="nu0">0.7152</span><span class="sy0">;</span>  <span class="kw1">var</span> bwgt<span class="sy0">=</span><span class="nu0">0.0722</span><span class="sy0">;</span><br>            <span class="kw1">for</span><span class="br0">(</span><span class="kw1">var</span> i <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">,</span> max <span class="sy0">=</span> can1.<span class="me1">w</span><span class="sy0">*</span>can1.<span class="me1">h</span><span class="sy0">*</span><span class="nu0">4</span><span class="sy0">;</span> i <span class="sy0">&lt;</span> max<span class="sy0">;</span> i<span class="sy0">=</span>i<span class="sy0">+</span><span class="nu0">4</span><span class="br0">)</span><span class="br0">{</span><br>                avg <span class="sy0">=</span> imgData.<span class="me1">data</span><span class="br0">[</span>i<span class="br0">]</span><span class="sy0">*</span>rwgt <span class="sy0">+</span> imgData.<span class="me1">data</span><span class="br0">[</span>i<span class="sy0">+</span><span class="nu0">1</span><span class="br0">]</span><span class="sy0">*</span>gwgt <span class="sy0">+</span> imgData.<span class="me1">data</span><span class="br0">[</span>i<span class="sy0">+</span><span class="nu0">2</span><span class="br0">]</span><span class="sy0">*</span>bwgt<span class="sy0">;</span><br>                imgData.<span class="me1">data</span><span class="br0">[</span>i  <span class="br0">]</span> <span class="sy0">=</span> avg<span class="sy0">;</span>  <span class="co1">// red</span><br>                imgData.<span class="me1">data</span><span class="br0">[</span>i<span class="sy0">+</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">=</span> avg<span class="sy0">;</span>  <span class="co1">// green</span><br>                imgData.<span class="me1">data</span><span class="br0">[</span>i<span class="sy0">+</span><span class="nu0">2</span><span class="br0">]</span> <span class="sy0">=</span> avg<span class="sy0">;</span><span class="br0">}</span> <span class="co1">// blue, alpha=alpha</span><br>            can2.<span class="me1">ctx</span>.<span class="me1">putImageData</span><span class="br0">(</span>imgData<span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>  <br>            <span class="br0">}</span><br>        <span class="br0">}</span><span class="sy0">,</span> <span class="kw2">false</span><span class="br0">)</span><span class="sy0">;</span> <br>&nbsp;<br>    <span class="kw1">function</span> CustomCanvas<span class="br0">(</span>id<span class="sy0">,</span> w<span class="sy0">,</span> h<span class="sy0">,</span> s<span class="br0">)</span> <span class="br0">{</span> <span class="coMULTI">/* Custom Canvas Object */</span><br>        <span class="kw1">var</span> c <span class="sy0">=</span> document.<span class="me1">createElement</span><span class="br0">(</span><span class="st0">"canvas"</span><span class="br0">)</span><span class="sy0">;</span><br>        c.<span class="me1">setAttribute</span><span class="br0">(</span><span class="st0">'id'</span><span class="sy0">,</span> id<span class="br0">)</span><span class="sy0">;</span> c.<span class="me1">setAttribute</span><span class="br0">(</span><span class="st0">'width'</span><span class="sy0">,</span> w<span class="br0">)</span><span class="sy0">;</span><br>        c.<span class="me1">setAttribute</span><span class="br0">(</span><span class="st0">'height'</span><span class="sy0">,</span> h<span class="br0">)</span><span class="sy0">;</span> <span class="br0">(</span>s<span class="br0">)</span><span class="sy0">?</span>c.<span class="me1">setAttribute</span><span class="br0">(</span><span class="st0">'style'</span><span class="sy0">,</span> s<span class="br0">)</span><span class="sy0">:</span><span class="nu0">0</span><span class="sy0">;</span><br>        document.<span class="me1">body</span>.<span class="me1">appendChild</span><span class="br0">(</span>c<span class="sy0">,</span> document.<span class="me1">body</span>.<span class="me1">firstChild</span><span class="br0">)</span><span class="sy0">;</span><br>        <span class="kw1">this</span>.<span class="me1">ctx</span> <span class="sy0">=</span> document.<span class="me1">getElementById</span><span class="br0">(</span>id<span class="br0">)</span>.<span class="me1">getContext</span><span class="br0">(</span><span class="st0">"2d"</span><span class="br0">)</span><span class="sy0">;</span><br>        <span class="kw1">this</span>.<span class="me1">w</span> <span class="sy0">=</span> w<span class="sy0">;</span> <span class="kw1">this</span>.<span class="me1">h</span> <span class="sy0">=</span> h<span class="sy0">;</span><span class="br0">}</span>           <br><span class="sy0">&lt;/</span>script<span class="sy0">&gt;</span>&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;<br>&nbsp;</pre> 
        <h2><span class="mw-headline" id="Julia"><a href="/wiki/Category:Julia" title="Category:Julia">Julia</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=20" title="Edit section: Julia">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p><b>Adhering to the Task Description</b> </p> 
        <pre class="text highlighted_source">&nbsp;<br>using Color, Images, FixedPointNumbers<br>&nbsp;<br>const M_RGB_Y = reshape(Color.M_RGB_XYZ[2,:], 3)<br>&nbsp;<br>function rgb2gray(img::Image)<br>    g = red(img)*M_RGB_Y[1] + green(img)*M_RGB_Y[2] + blue(img)*M_RGB_Y[3]<br>    g = clamp(g, 0.0, 1.0)<br>    return grayim(g)<br>end<br>&nbsp;<br>function gray2rgb(img::Image)<br>    colorspace(img) == "Gray" || return img<br>    g = map((x)-&gt;RGB{Ufixed8}(x, x, x), img.data)<br>    return Image(g, spatialorder=spatialorder(img))<br>end<br>&nbsp;<br>ima = imread("grayscale_image_color.png")<br>imb = rgb2gray(ima)<br>imc = gray2rgb(imb)<br>imwrite(imc, "grayscale_image_rc.png")<br>&nbsp;</pre> 
        <p>Rounding errors are unlikely to be an issue for <code>rgb2gray</code>. The calculation of <code>g</code> promotes it to the literal float type (typically <code>Float64</code>). </p>
        <p><b>A More Idiomatic Approach</b> </p> 
        <pre class="text highlighted_source">&nbsp;<br>using Color, Images, FixedPointNumbers<br>&nbsp;<br>ima = imread("grayscale_image_color.png")<br>imb = convert(Image{Gray{Ufixed8}}, ima)<br>imwrite(imb, "grayscale_image_julia.png")<br>&nbsp;</pre> 
        <div> 
         <dl>
          <dt>
           Output:
          </dt>
         </dl>
        </div> 
        <p>I didn't find a colorful image that I was comfortable modifying and sharing, so I'm omitting the image files from my solution to this task. Try out these <a rel="nofollow" class="external text" href="http://r0k.us/graphics/kodak/">images</a> for something to work with. Although these images are intended for image processing testing and development and are said to be available for unrestricted use, I could find no clear and definitive statement of their usage rights. </p>
        <p>The results of the two approaches (according to task, <i>rc</i>, and idiomatic, <i>julia</i>) are indistinguishable except perhaps by close examination. The <i>julia</i> file is native grayscale, and the <i>rc</i> file is RGB that shows only grays. </p>
        <p>The task description is silent on the issue of companded sRGB versus linear RGB. Most images are actually sRGB, and strictly speaking, the transformation to get Y from RGB is applicable to linear RGB. I imagine that, unlike the <i>rc</i> version, the <i>julia</i> version reverses compansion prior to applying the CIE transformation to extract luminance from RGB. </p> 
        <h2><span class="mw-headline" id="Lingo"><a href="/wiki/Category:Lingo" title="Category:Lingo">Lingo</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=21" title="Edit section: Lingo">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <pre class="text highlighted_source">on rgbToGrayscaleImageFast (img)<br>  res = image(img.width, img.height, 8)<br>  res.paletteRef = #grayScale<br>  res.copyPixels(img, img.rect, img.rect)<br>  return res<br>end<br>&nbsp;<br>on rgbToGrayscaleImageCustom (img)<br>  res = image(img.width, img.height, 8)<br>  res.paletteRef = #grayScale<br>  repeat with x = 0 to img.width-1<br>    repeat with y = 0 to img.height-1<br>      c = img.getPixel(x,y)<br>      n = c.red*0.2126 + c.green*0.7152 + c.blue*0.0722<br>      res.setPixel(x,y, color(256-n))<br>    end repeat<br>  end repeat<br>  return res<br>end</pre> 
        <h2><span class="mw-headline" id="Lua"><a href="/wiki/Category:Lua" title="Category:Lua">Lua</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=22" title="Edit section: Lua">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <pre class="lua highlighted_source"><span class="kw1">function</span> ConvertToGrayscaleImage<span class="br0">(</span> bitmap <span class="br0">)</span><br>    <span class="kw1">local</span> size_x<span class="sy0">,</span> size_y <span class="sy0">=</span> <span class="sy0">#</span>bitmap<span class="sy0">,</span> <span class="sy0">#</span>bitmap<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><br>    <span class="kw1">local</span> gray_im <span class="sy0">=</span> <span class="br0">{</span><span class="br0">}</span><br>&nbsp;<br>    <span class="kw1">for</span> i <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">,</span> size_x <span class="kw1">do</span><br>        gray_im<span class="br0">[</span>i<span class="br0">]</span> <span class="sy0">=</span> <span class="br0">{</span><span class="br0">}</span><br>        <span class="kw1">for</span> j <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">,</span> size_y <span class="kw1">do</span> <br>            gray_im<span class="br0">[</span>i<span class="br0">]</span><span class="br0">[</span>j<span class="br0">]</span> <span class="sy0">=</span> <span class="kw3">math.floor</span><span class="br0">(</span> <span class="nu0">0.2126</span><span class="sy0">*</span>bitmap<span class="br0">[</span>i<span class="br0">]</span><span class="br0">[</span>j<span class="br0">]</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">+</span> <span class="nu0">0.7152</span><span class="sy0">*</span>bitmap<span class="br0">[</span>i<span class="br0">]</span><span class="br0">[</span>j<span class="br0">]</span><span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span> <span class="sy0">+</span> <span class="nu0">0.0722</span><span class="sy0">*</span>bitmap<span class="br0">[</span>i<span class="br0">]</span><span class="br0">[</span>j<span class="br0">]</span><span class="br0">[</span><span class="nu0">3</span><span class="br0">]</span> <span class="br0">)</span><br>        <span class="kw1">end</span><br>    <span class="kw1">end</span><br>&nbsp;<br>    <span class="kw1">return</span> gray_im<br><span class="kw1">end</span><br>&nbsp;<br><span class="kw1">function</span> ConvertToColorImage<span class="br0">(</span> gray_im <span class="br0">)</span><br>    <span class="kw1">local</span> size_x<span class="sy0">,</span> size_y <span class="sy0">=</span> <span class="sy0">#</span>gray_im<span class="sy0">,</span> <span class="sy0">#</span>gray_im<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>    <br>    <span class="kw1">local</span> bitmap <span class="sy0">=</span> Allocate_Bitmap<span class="br0">(</span> size_x<span class="sy0">,</span> size_y <span class="br0">)</span>         <span class="co1">-- this function is defined at http://rosettacode.org/wiki/Basic_bitmap_storage#Lua</span><br>&nbsp;<br>    <span class="kw1">for</span> i <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">,</span> size_x <span class="kw1">do</span><br>        <span class="kw1">for</span> j <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">,</span> size_y <span class="kw1">do</span> <br>            bitmap<span class="br0">[</span>i<span class="br0">]</span><span class="br0">[</span>j<span class="br0">]</span> <span class="sy0">=</span> <span class="br0">{</span> gray_im<span class="br0">[</span>i<span class="br0">]</span><span class="br0">[</span>j<span class="br0">]</span><span class="sy0">,</span> gray_im<span class="br0">[</span>i<span class="br0">]</span><span class="br0">[</span>j<span class="br0">]</span><span class="sy0">,</span> gray_im<span class="br0">[</span>i<span class="br0">]</span><span class="br0">[</span>j<span class="br0">]</span> <span class="br0">}</span><br>        <span class="kw1">end</span><br>    <span class="kw1">end</span><br>&nbsp;<br>    <span class="kw1">return</span> bitmap<br><span class="kw1">end</span></pre> 
        <h2><span class="mw-headline" id="Mathematica_.2F_Wolfram_Language"><a href="/wiki/Category:Mathematica" title="Category:Mathematica">Mathematica</a> / <a href="/wiki/Category:Wolfram_Language" title="Category:Wolfram Language">Wolfram Language</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=23" title="Edit section: Mathematica / Wolfram Language">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>Mathematica has a built-in grayscale conversion function called "ColorConvert". This example does not use it since it appears the luminance calculation is different from the CIE spec. Grayscale to RGB "conversion" just changes the single channel grayscale image to a triple channel image. </p> 
        <pre class="text highlighted_source">toGrayscale[rgb_Image]&nbsp;:= ImageApply[#.{0.2126, 0.7152, 0.0722}&amp;, rgb]<br>toFakeRGB[L_Image]&nbsp;:= ImageApply[{#, #, #}&amp;, L] </pre> 
        <h2><span class="mw-headline" id="MATLAB"><a href="/wiki/Category:MATLAB" title="Category:MATLAB">MATLAB</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=24" title="Edit section: MATLAB">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>Built in colour to grayscale converter uses the following forumula: 0.2989*R + 0.5870*G + 0.1140*B </p> 
        <pre class="matlab highlighted_source"><span class="kw1">function</span> <span class="br0">[</span>grayImage<span class="br0">]</span> = colortograyscale<span class="br0">(</span>inputImage<span class="br0">)</span><br>   grayImage = rgb2gray<span class="br0">(</span>inputImage<span class="br0">)</span>;</pre> 
        <h2><span class="mw-headline" id="OCaml"><a href="/wiki/Category:OCaml" title="Category:OCaml">OCaml</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=25" title="Edit section: OCaml">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>Conversion to a grayscale image: </p> 
        <pre class="ocaml highlighted_source"><span class="kw1">let</span> to_grayscale <span class="re1">~img</span><span class="sy0">:</span><span class="br0">(</span>_, r_channel, g_channel, b_channel<span class="br0">)</span> <span class="sy0">=</span><br>  <span class="kw1">let</span> width <span class="sy0">=</span> <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.html"><span class="kw2">Bigarray</span></a><span class="sy0">.</span>Array2<span class="sy0">.</span>dim1 r_channel<br>  <span class="kw1">and</span> height <span class="sy0">=</span> <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.html"><span class="kw2">Bigarray</span></a><span class="sy0">.</span>Array2<span class="sy0">.</span>dim2 r_channel <span class="kw1">in</span><br>&nbsp;<br>  <span class="kw1">let</span> gray_channel <span class="sy0">=</span><br>    <span class="kw1">let</span> kind <span class="sy0">=</span> <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.html"><span class="kw2">Bigarray</span></a><span class="sy0">.</span>int8_unsigned<br>    <span class="kw1">and</span> layout <span class="sy0">=</span> <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.html"><span class="kw2">Bigarray</span></a><span class="sy0">.</span>c_layout<br>    <span class="kw1">in</span><br>    <span class="br0">(</span><a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.html"><span class="kw2">Bigarray</span></a><span class="sy0">.</span>Array2<span class="sy0">.</span>create kind layout width height<span class="br0">)</span><br>  <span class="kw1">in</span><br>  <span class="kw1">for</span> y <span class="sy0">=</span> <span class="nu0">0</span> <span class="kw1">to</span> <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Pervasives.html#VALpred"><span class="kw3">pred</span></a> height <span class="kw1">do</span><br>    <span class="kw1">for</span> x <span class="sy0">=</span> <span class="nu0">0</span> <span class="kw1">to</span> <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Pervasives.html#VALpred"><span class="kw3">pred</span></a> width <span class="kw1">do</span><br>      <span class="kw1">let</span> r <span class="sy0">=</span> r_channel<span class="sy0">.</span><span class="br0">{</span>x,y<span class="br0">}</span><br>      <span class="kw1">and</span> g <span class="sy0">=</span> g_channel<span class="sy0">.</span><span class="br0">{</span>x,y<span class="br0">}</span><br>      <span class="kw1">and</span> b <span class="sy0">=</span> b_channel<span class="sy0">.</span><span class="br0">{</span>x,y<span class="br0">}</span> <span class="kw1">in</span><br>      <span class="kw1">let</span> v <span class="sy0">=</span> <span class="br0">(</span><span class="nu0">2</span>_126 <span class="sy0">*</span> r <span class="sy0">+</span>  <span class="nu0">7</span>_152 <span class="sy0">*</span> g <span class="sy0">+</span> <span class="nu0">722</span> <span class="sy0">*</span> b<span class="br0">)</span> <span class="sy0">/</span> <span class="nu0">10</span>_000 <span class="kw1">in</span><br>      gray_channel<span class="sy0">.</span><span class="br0">{</span>x,y<span class="br0">}</span> <span class="sy0">&lt;-</span> v<span class="sy0">;</span><br>    <span class="kw1">done</span><span class="sy0">;</span><br>  <span class="kw1">done</span><span class="sy0">;</span><br>  <span class="br0">(</span>gray_channel<span class="br0">)</span></pre> 
        <p>Conversion to a color image: </p> 
        <pre class="ocaml highlighted_source"><span class="kw1">let</span> to_color <span class="re1">~img</span><span class="sy0">:</span>gray_channel <span class="sy0">=</span><br>  <span class="kw1">let</span> width <span class="sy0">=</span> <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.html"><span class="kw2">Bigarray</span></a><span class="sy0">.</span>Array2<span class="sy0">.</span>dim1 gray_channel<br>  <span class="kw1">and</span> height <span class="sy0">=</span> <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.html"><span class="kw2">Bigarray</span></a><span class="sy0">.</span>Array2<span class="sy0">.</span>dim2 gray_channel <span class="kw1">in</span><br>  <span class="kw1">let</span> all_channels <span class="sy0">=</span><br>    <span class="kw1">let</span> kind <span class="sy0">=</span> <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.html"><span class="kw2">Bigarray</span></a><span class="sy0">.</span>int8_unsigned<br>    <span class="kw1">and</span> layout <span class="sy0">=</span> <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.html"><span class="kw2">Bigarray</span></a><span class="sy0">.</span>c_layout<br>    <span class="kw1">in</span><br>    <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.html"><span class="kw2">Bigarray</span></a><span class="sy0">.</span>Array3<span class="sy0">.</span>create kind layout <span class="nu0">3</span> width height<br>  <span class="kw1">in</span><br>  <span class="kw1">let</span> r_channel <span class="sy0">=</span> <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.html"><span class="kw2">Bigarray</span></a><span class="sy0">.</span>Array3<span class="sy0">.</span>slice_left_2 all_channels <span class="nu0">0</span><br>  <span class="kw1">and</span> g_channel <span class="sy0">=</span> <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.html"><span class="kw2">Bigarray</span></a><span class="sy0">.</span>Array3<span class="sy0">.</span>slice_left_2 all_channels <span class="nu0">1</span><br>  <span class="kw1">and</span> b_channel <span class="sy0">=</span> <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.html"><span class="kw2">Bigarray</span></a><span class="sy0">.</span>Array3<span class="sy0">.</span>slice_left_2 all_channels <span class="nu0">2</span><br>  <span class="kw1">in</span><br>  <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.html"><span class="kw2">Bigarray</span></a><span class="sy0">.</span>Array2<span class="sy0">.</span>blit gray_channel r_channel<span class="sy0">;</span><br>  <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.html"><span class="kw2">Bigarray</span></a><span class="sy0">.</span>Array2<span class="sy0">.</span>blit gray_channel g_channel<span class="sy0">;</span><br>  <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.html"><span class="kw2">Bigarray</span></a><span class="sy0">.</span>Array2<span class="sy0">.</span>blit gray_channel b_channel<span class="sy0">;</span><br>  <span class="br0">(</span>all_channels,<br>   r_channel,<br>   g_channel,<br>   b_channel<span class="br0">)</span></pre> 
        <p>and functions to get/set a pixel: </p> 
        <pre class="ocaml highlighted_source"><span class="kw1">let</span> gray_get_pixel_unsafe <span class="br0">(</span>gray_channel<span class="br0">)</span> <span class="sy0">=</span><br>  <span class="br0">(</span><span class="kw1">fun</span> x y <span class="sy0">-&gt;</span> gray_channel<span class="sy0">.</span><span class="br0">{</span>x,y<span class="br0">}</span><span class="br0">)</span><br>&nbsp;<br><span class="kw1">let</span> gray_put_pixel_unsafe <span class="br0">(</span>gray_channel<span class="br0">)</span> v <span class="sy0">=</span><br>  <span class="br0">(</span><span class="kw1">fun</span> x y <span class="sy0">-&gt;</span> gray_channel<span class="sy0">.</span><span class="br0">{</span>x,y<span class="br0">}</span> <span class="sy0">&lt;-</span> v<span class="br0">)</span></pre> 
        <h2><span class="mw-headline" id="Octave"><a href="/wiki/Category:Octave" title="Category:Octave">Octave</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=26" title="Edit section: Octave">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p><b>Use package</b>: image </p> 
        <pre class="octave highlighted_source"><span class="kw4">function</span> <span class="br0">[</span>grayImage<span class="br0">]</span> <span class="sy3">=</span> colortograyscale<span class="br0">(</span>inputImage<span class="br0">)</span><br>   grayImage <span class="sy3">=</span> rgb2gray<span class="br0">(</span>inputImage<span class="br0">)</span><span class="sy5">;</span></pre> 
        <p>Differently from <a href="/wiki/Grayscale_image#MATLAB" title="Grayscale image">MATLAB</a>, the grayscale is computed as mean of the three RGB values. Changing this non-optimal behaviour is a matter of fixing three lines in the <tt>rgb2gray.m</tt> file; since it's a GPL-ed code, here it is a semplified version (error checking, usage help, argument checking removed) </p> 
        <pre class="octave highlighted_source"><span class="kw4">function</span> <a href="http://octave.sourceforge.net/octave/function/gray.html"><span class="kw6">gray</span></a> <span class="sy3">=</span> rgb2gray <span class="br0">(</span>rgb<span class="br0">)</span><br>    <span class="kw4">switch</span><span class="br0">(</span><a href="http://octave.sourceforge.net/octave/function/class.html"><span class="kw5">class</span></a><span class="br0">(</span>rgb<span class="br0">)</span><span class="br0">)</span><br>    <span class="kw4">case</span> <span class="co4">"double"</span><br>      <a href="http://octave.sourceforge.net/octave/function/gray.html"><span class="kw6">gray</span></a> <span class="sy3">=</span> luminance<span class="br0">(</span>rgb<span class="br0">)</span><span class="sy5">;</span><br>    <span class="kw4">case</span> <span class="co4">"uint8"</span><br>      <a href="http://octave.sourceforge.net/octave/function/gray.html"><span class="kw6">gray</span></a> <span class="sy3">=</span> <a href="http://octave.sourceforge.net/octave/<span class=" kw4">function<span class="sy1">/</span>uint8.html"&gt;<span class="kw1">uint8</span></a><span class="br0">(</span>luminance<span class="br0">(</span>rgb<span class="br0">)</span><span class="br0">)</span><span class="sy5">;</span><br>    <span class="kw4">case</span> <span class="co4">"uint16"</span><br>      <a href="http://octave.sourceforge.net/octave/function/gray.html"><span class="kw6">gray</span></a> <span class="sy3">=</span> <a href="http://octave.sourceforge.net/octave/<span class=" kw4">function<span class="sy1">/</span>uint16.html"&gt;<span class="kw1">uint16</span></a><span class="br0">(</span>luminance<span class="br0">(</span>rgb<span class="br0">)</span><span class="br0">)</span><span class="sy5">;</span><br>    <span class="kw4">endswitch</span><br><span class="kw4">endfunction</span><br>&nbsp;<br><span class="kw4">function</span> lum <span class="sy3">=</span> luminance<span class="br0">(</span>rgb<span class="br0">)</span><br>   lum <span class="sy3">=</span> <span class="nu19">0.2126</span><span class="sy1">*</span>rgb<span class="br0">(</span><span class="sy4">:</span><span class="sy5">,</span><span class="sy4">:</span><span class="sy5">,</span><span class="nu0">1</span><span class="br0">)</span> <span class="sy1">+</span> <span class="nu19">0.7152</span><span class="sy1">*</span>rgb<span class="br0">(</span><span class="sy4">:</span><span class="sy5">,</span><span class="sy4">:</span><span class="sy5">,</span><span class="nu0">2</span><span class="br0">)</span> <span class="sy1">+</span> <span class="nu19">0.0722</span><span class="sy1">*</span>rgb<span class="br0">(</span><span class="sy4">:</span><span class="sy5">,</span><span class="sy4">:</span><span class="sy5">,</span><span class="nu0">3</span><span class="br0">)</span><span class="sy5">;</span> <br><span class="kw4">endfunction</span></pre> 
        <p>Original code of the <tt>rgb2gray.m</tt> in the image package version 1.0.8 is by Kai Habel (under the GNU General Public License) </p> 
        <h2><span class="mw-headline" id="Oz"><a href="/wiki/Category:Oz" title="Category:Oz">Oz</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=27" title="Edit section: Oz">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>We define a "graymap" as a two-dimensional array of floats. In module <code>"Grayscale.oz"</code>, we implement conversion functions from and to bitmaps: </p> 
        <pre class="oz highlighted_source"><span class="kw1">functor</span><br><span class="kw1">import</span><br>   Array2D<br><span class="kw1">export</span><br>   ToGraymap<br>   FromGraymap<br><span class="kw1">define</span><br>   <span class="kw1">fun</span> <span class="br0">{</span><span class="re1">ToGraymap</span> bitmap<span class="br0">(</span>Arr<span class="br0">)</span><span class="br0">}</span><br>      graymap<span class="br0">(</span><span class="br0">{</span>Array2D<span class="sy0">.</span>map Arr Luminance<span class="br0">}</span><span class="br0">)</span><br>   <span class="kw1">end</span><br>&nbsp;<br>   <span class="kw1">fun</span> <span class="br0">{</span><span class="re1">Luminance</span> Color<span class="br0">}</span><br>      F = <span class="br0">{</span>Record<span class="sy0">.</span>map Color Int<span class="sy0">.</span>toFloat<span class="br0">}</span><br>   <span class="kw1">in</span><br>      0<span class="sy0">.</span>2126<span class="sy0">*</span>F<span class="sy0">.</span>1 <span class="sy0">+</span> 0<span class="sy0">.</span>7152<span class="sy0">*</span>F<span class="sy0">.</span>2 <span class="sy0">+</span> 0<span class="sy0">.</span>0722<span class="sy0">*</span>F<span class="sy0">.</span>3<br>   <span class="kw1">end</span><br>&nbsp;<br>   <span class="kw1">fun</span> <span class="br0">{</span><span class="re1">FromGraymap</span> graymap<span class="br0">(</span>Arr<span class="br0">)</span><span class="br0">}</span><br>      bitmap<span class="br0">(</span><span class="br0">{</span>Array2D<span class="sy0">.</span>map Arr ToColor<span class="br0">}</span><span class="br0">)</span><br>   <span class="kw1">end</span><br>&nbsp;<br>   <span class="kw1">fun</span> <span class="br0">{</span><span class="re1">ToColor</span> Lum<span class="br0">}</span><br>      L = <span class="br0">{</span>Float<span class="sy0">.</span>toInt Lum<span class="br0">}</span><br>   <span class="kw1">in</span><br>      color<span class="br0">(</span>L L L<span class="br0">)</span><br>   <span class="kw1">end</span><br><span class="kw1">end</span></pre> 
        <h2><span class="mw-headline" id="Perl"><a href="/wiki/Category:Perl" title="Category:Perl">Perl</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=28" title="Edit section: Perl">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <div class="examplemeta libheader">
         <b>Library:</b> 
         <a href="/wiki/Category:Imlib2" title="Category:Imlib2">Imlib2</a>
        </div> 
        <p>Since we are using Imlib2, this one <b>does</b> <b>not</b> implement really a gray-scale (single channel) storage; it only <i>converts</i> an RGB image to an RGB image with the same three colour components for each pixel (which result in a gray-scale-like image) </p> 
        <pre class="perl highlighted_source"><span class="co1">#! /usr/bin/perl</span><br>&nbsp;<br><span class="kw2">use</span> strict<span class="sy0">;</span><br><span class="kw2">use</span> Image<span class="sy0">::</span><span class="me2">Imlib2</span><span class="sy0">;</span><br>&nbsp;<br><span class="kw2">sub</span> tograyscale<br><span class="br0">{</span><br>    <span class="kw1">my</span> <span class="re0">$img</span> <span class="sy0">=</span> <a href="http://perldoc.perl.org/functions/shift.html"><span class="kw3">shift</span></a><span class="sy0">;</span><br>    <span class="kw1">my</span> <span class="re0">$gimg</span> <span class="sy0">=</span> Image<span class="sy0">::</span><span class="me2">Imlib2</span><span class="sy0">-&gt;</span><span class="kw2">new</span><span class="br0">(</span><span class="re0">$img</span><span class="sy0">-&gt;</span><span class="me1">width</span><span class="sy0">,</span> <span class="re0">$img</span><span class="sy0">-&gt;</span><span class="me1">height</span><span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw1">for</span> <span class="br0">(</span> <span class="kw1">my</span> <span class="re0">$x</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="re0">$x</span> <span class="sy0">&lt;</span> <span class="re0">$gimg</span><span class="sy0">-&gt;</span><span class="me1">width</span><span class="sy0">;</span> <span class="re0">$x</span><span class="sy0">++</span> <span class="br0">)</span> <span class="br0">{</span><br>	<span class="kw1">for</span> <span class="br0">(</span> <span class="kw1">my</span> <span class="re0">$y</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="re0">$y</span> <span class="sy0">&lt;</span> <span class="re0">$gimg</span><span class="sy0">-&gt;</span><span class="me1">height</span><span class="sy0">;</span> <span class="re0">$y</span><span class="sy0">++</span> <span class="br0">)</span> <span class="br0">{</span><br>	    <span class="kw1">my</span> <span class="br0">(</span> <span class="re0">$r</span><span class="sy0">,</span> <span class="re0">$g</span><span class="sy0">,</span> <span class="re0">$b</span><span class="sy0">,</span> <span class="re0">$a</span> <span class="br0">)</span> <span class="sy0">=</span> <span class="re0">$img</span><span class="sy0">-&gt;</span><span class="me1">query_pixel</span><span class="br0">(</span><span class="re0">$x</span><span class="sy0">,</span> <span class="re0">$y</span><span class="br0">)</span><span class="sy0">;</span><br>	    <span class="kw1">my</span> <span class="re0">$gray</span> <span class="sy0">=</span> <a href="http://perldoc.perl.org/functions/int.html"><span class="kw3">int</span></a><span class="br0">(</span><span class="nu0">0.2126</span> <span class="sy0">*</span> <span class="re0">$r</span> <span class="sy0">+</span> <span class="nu0">0.7152</span> <span class="sy0">*</span> <span class="re0">$g</span> <span class="sy0">+</span> <span class="nu0">0.0722</span> <span class="sy0">*</span> <span class="re0">$b</span><span class="br0">)</span><span class="sy0">;</span><br>	    <span class="co1"># discard alpha info...</span><br>	    <span class="re0">$gimg</span><span class="sy0">-&gt;</span><span class="me1">set_color</span><span class="br0">(</span><span class="re0">$gray</span><span class="sy0">,</span> <span class="re0">$gray</span><span class="sy0">,</span> <span class="re0">$gray</span><span class="sy0">,</span> <span class="nu0">255</span><span class="br0">)</span><span class="sy0">;</span><br>	    <span class="re0">$gimg</span><span class="sy0">-&gt;</span><span class="me1">draw_point</span><span class="br0">(</span><span class="re0">$x</span><span class="sy0">,</span> <span class="re0">$y</span><span class="br0">)</span><span class="sy0">;</span><br>	<span class="br0">}</span><br>    <span class="br0">}</span><br>    <a href="http://perldoc.perl.org/functions/return.html"><span class="kw3">return</span></a> <span class="re0">$gimg</span><span class="sy0">;</span><br><span class="br0">}</span><br>&nbsp;<br><span class="kw1">my</span> <span class="re0">$animage</span> <span class="sy0">=</span> Image<span class="sy0">::</span><span class="me2">Imlib2</span><span class="sy0">-&gt;</span><span class="me1">load</span><span class="br0">(</span><span class="st0">"Lenna100.jpg"</span><span class="br0">)</span><span class="sy0">;</span><br><span class="kw1">my</span> <span class="re0">$gscale</span> <span class="sy0">=</span> tograyscale<span class="br0">(</span><span class="re0">$animage</span><span class="br0">)</span><span class="sy0">;</span><br><span class="re0">$gscale</span><span class="sy0">-&gt;</span><span class="me1">set_quality</span><span class="br0">(</span><span class="nu0">80</span><span class="br0">)</span><span class="sy0">;</span><br><span class="re0">$gscale</span><span class="sy0">-&gt;</span><span class="me1">save</span><span class="br0">(</span><span class="st0">"Lennagray.jpg"</span><span class="br0">)</span><span class="sy0">;</span><br>&nbsp;<br><a href="http://perldoc.perl.org/functions/exit.html"><span class="kw3">exit</span></a> <span class="nu0">0</span><span class="sy0">;</span></pre> 
        <h2><span class="mw-headline" id="Perl_6"><a href="/wiki/Category:Perl_6" title="Category:Perl 6">Perl 6</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=29" title="Edit section: Perl 6">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>This script expects to be fed a P6 .ppm file name at the command line. It will convert it to grey scale and save it as a binary portable grey map (P5 .pgm) file. </p> 
        <pre class="perl6 highlighted_source"><span class="kw2">sub</span> MAIN <span class="br0">(</span><span class="re0">$filename</span> <span class="sy0">=</span> <span class="st_h">'default.ppm'</span><span class="br0">)</span> <span class="br0">{</span><br>&nbsp;<br>    <span class="kw1">my</span> <span class="re0">$in</span> <span class="sy0">=</span> open<span class="br0">(</span><span class="re0">$filename</span><span class="sy0">,</span> <span class="sy0">:</span>r<span class="sy0">,</span> <span class="sy0">:</span>enc<span class="sy0">&lt;</span>iso<span class="sy0">-</span><span class="nu0">8859</span><span class="sy0">-</span><span class="nu0">1</span><span class="sy0">&gt;</span><span class="br0">)</span><span class="sy0">;</span><br>&nbsp;<br>    <span class="kw1">my</span> <span class="br0">(</span><span class="re0">$type</span><span class="sy0">,</span> <span class="re0">$dim</span><span class="sy0">,</span> <span class="re0">$depth</span><span class="br0">)</span> <span class="sy0">=</span> <span class="re0">$in</span><span class="sy0">.</span><span class="me1">lines</span><span class="br0">[</span><span class="sy0">^</span><span class="nu0">3</span><span class="br0">]</span><span class="sy0">;</span><br>&nbsp;<br>    <span class="kw1">my</span> <span class="re0">$outfile</span> <span class="sy0">=</span> <span class="re0">$filename</span><span class="sy0">.</span><span class="kw3">subst</span><span class="br0">(</span><span class="st_h">'.ppm'</span><span class="sy0">,</span> <span class="st_h">'.pgm'</span><span class="br0">)</span><span class="sy0">;</span><br>    <span class="kw1">my</span> <span class="re0">$out</span> <span class="sy0">=</span> open<span class="br0">(</span><span class="re0">$outfile</span><span class="sy0">,</span> <span class="sy0">:</span>w<span class="sy0">,</span> <span class="sy0">:</span>enc<span class="sy0">&lt;</span>iso<span class="sy0">-</span><span class="nu0">8859</span><span class="sy0">-</span><span class="nu0">1</span><span class="sy0">&gt;</span><span class="br0">)</span><span class="sy0">;</span><br>&nbsp;<br>    <span class="re0">$out</span><span class="sy0">.</span><span class="kw3">say</span><span class="br0">(</span><span class="st0">"P5<span class="es0">\n</span>$dim<span class="es0">\n</span>$depth"</span><span class="br0">)</span><span class="sy0">;</span><br>&nbsp;<br>    <span class="kw1">for</span> <span class="re0">$in</span><span class="sy0">.</span><span class="me1">lines</span><span class="sy0">.</span><span class="me1">ords</span> <span class="sy0">-&gt;</span> <span class="re0">$r</span><span class="sy0">,</span> <span class="re0">$g</span><span class="sy0">,</span> <span class="re0">$b</span> <span class="br0">{</span><br>        <span class="kw1">my</span> <span class="re0">$gs</span> <span class="sy0">=</span> <span class="re0">$r</span> <span class="sy0">*</span> <span class="nu0">0.2126</span> <span class="sy0">+</span> <span class="re0">$g</span> <span class="sy0">*</span> <span class="nu0">0.7152</span> <span class="sy0">+</span> <span class="re0">$b</span> <span class="sy0">*</span> <span class="nu0">0.0722</span><span class="sy0">;</span><br>        <span class="re0">$out</span><span class="sy0">.</span><span class="kw3">print</span><span class="sy0">:</span> chr<span class="br0">(</span><span class="re0">$gs</span> <span class="kw3">min</span> <span class="nu0">255</span><span class="br0">)</span><span class="sy0">;</span><br>    <span class="br0">}</span><br>&nbsp;<br>    <span class="re0">$in</span><span class="sy0">.</span><span class="me1">close</span><span class="sy0">;</span><br>    <span class="re0">$out</span><span class="sy0">.</span><span class="me1">close</span><span class="sy0">;</span><br><span class="br0">}</span></pre> 
        <p>Using the .ppm file from the <a href="/wiki/Bitmap/Write_a_PPM_file#Perl_6" title="Bitmap/Write a PPM file">Write a PPM file</a> task: </p>
        <p>Original: <a href="/wiki/File:Ppm-perl6.png" class="image"><img alt="Ppm-perl6.png" src="/mw/images/2/27/Ppm-perl6.png" width="125" height="125"></a> Grey Scale: <a href="/wiki/File:Pgm-g2-perl6.png" class="image"><img alt="Pgm-g2-perl6.png" src="/mw/images/f/fe/Pgm-g2-perl6.png" width="125" height="125"></a> </p> 
        <h2><span class="mw-headline" id="Phix"><a href="/wiki/Category:Phix" title="Category:Phix">Phix</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=30" title="Edit section: Phix">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <div class="examplemeta translation">
         <b>Translation of</b>: 
         <a href="#Euphoria">Euphoria</a>
        </div> 
        <p>Requires read_ppm() from <a href="/wiki/Bitmap/Read_a_PPM_file#Phix" title="Bitmap/Read a PPM file">Read_a_PPM_file</a>, see <a href="/wiki/Bitmap/Write_a_PPM_file#Phix" title="Bitmap/Write a PPM file">Write_a_PPM_file</a> for actual use. Included as demo\rosetta\Bitmap_Greyscale.exw </p> 
        <pre class="text highlighted_source">function to_gray(sequence image)<br>sequence color<br>    for i=1 to length(image) do<br>        for j=1 to length(image[i]) do<br>            -- unpack color triple<br>            color = sq_div(sq_and_bits(image[i][j], {#FF0000,#FF00,#FF}),<br>                                                    {#010000,#0100,#01})<br>            image[i][j] = floor(0.2126*color[1] + 0.7152*color[2] + 0.0722*color[3])*#010101<br>        end for<br>    end for<br>    return image<br>end function<br>&nbsp;<br>sequence img = read_ppm("Lena.ppm")<br>    img = to_gray(img)</pre> 
        <h2><span class="mw-headline" id="PHP"><a href="/wiki/Category:PHP" title="Category:PHP">PHP</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=31" title="Edit section: PHP">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>Uses the <a href="/wiki/Write_ppm_file#PHP" title="Write ppm file" class="mw-redirect">Bitmap class</a> defined for writing a PPM file </p> 
        <pre class="php highlighted_source"><span class="kw2">class</span> BitmapGrayscale <span class="kw2">extends</span> Bitmap <span class="br0">{</span><br>  <span class="kw2">public</span> <span class="kw2">function</span> toGrayscale<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span><br>    <span class="kw1">for</span> <span class="br0">(</span><span class="re0">$i</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="re0">$i</span> <span class="sy0">&lt;</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">h</span><span class="sy0">;</span> <span class="re0">$i</span><span class="sy0">++</span><span class="br0">)</span><span class="br0">{</span><br>      <span class="kw1">for</span> <span class="br0">(</span><span class="re0">$j</span> <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="re0">$j</span> <span class="sy0">&lt;</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">w</span><span class="sy0">;</span> <span class="re0">$j</span><span class="sy0">++</span><span class="br0">)</span><span class="br0">{</span><br>        <span class="re0">$l</span> <span class="sy0">=</span> <span class="br0">(</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">data</span><span class="br0">[</span><span class="re0">$j</span><span class="br0">]</span><span class="br0">[</span><span class="re0">$i</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">*</span> <span class="nu19">0.2126</span><span class="br0">)</span><br>           <span class="sy0">+</span> <span class="br0">(</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">data</span><span class="br0">[</span><span class="re0">$j</span><span class="br0">]</span><span class="br0">[</span><span class="re0">$i</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">*</span> <span class="nu19">0.7152</span><span class="br0">)</span><br>           <span class="sy0">+</span> <span class="br0">(</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">data</span><span class="br0">[</span><span class="re0">$j</span><span class="br0">]</span><span class="br0">[</span><span class="re0">$i</span><span class="br0">]</span><span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span> <span class="sy0">*</span> <span class="nu19">0.0722</span><span class="br0">)</span><span class="sy0">;</span><br>        <span class="re0">$l</span> <span class="sy0">=</span> <a href="http://www.php.net/round"><span class="kw3">round</span></a><span class="br0">(</span><span class="re0">$l</span><span class="br0">)</span><span class="sy0">;</span><br>        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">data</span><span class="br0">[</span><span class="re0">$j</span><span class="br0">]</span><span class="br0">[</span><span class="re0">$i</span><span class="br0">]</span> <span class="sy0">=</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="re0">$l</span><span class="sy0">,</span><span class="re0">$l</span><span class="sy0">,</span><span class="re0">$l</span><span class="br0">)</span><span class="sy0">;</span><br>      <span class="br0">}</span><br>    <span class="br0">}</span><br>  <span class="br0">}</span><br><span class="br0">}</span><br>&nbsp;<br><span class="re0">$b</span> <span class="sy0">=</span> <span class="kw2">new</span> BitmapGrayscale<span class="br0">(</span><span class="nu0">16</span><span class="sy0">,</span><span class="nu0">16</span><span class="br0">)</span><span class="sy0">;</span><br><span class="re0">$b</span><span class="sy0">-&gt;</span><span class="me1">fill</span><span class="br0">(</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="kw4">null</span><span class="sy0">,</span><span class="kw4">null</span><span class="sy0">,</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="nu0">255</span><span class="sy0">,</span><span class="nu0">255</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span><br><span class="re0">$b</span><span class="sy0">-&gt;</span><span class="me1">setPixel</span><span class="br0">(</span><span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">15</span><span class="sy0">,</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="nu0">255</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span><br><span class="re0">$b</span><span class="sy0">-&gt;</span><span class="me1">setPixel</span><span class="br0">(</span><span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">14</span><span class="sy0">,</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">255</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span><br><span class="re0">$b</span><span class="sy0">-&gt;</span><span class="me1">setPixel</span><span class="br0">(</span><span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">13</span><span class="sy0">,</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">(</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">255</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span><br><span class="re0">$b</span><span class="sy0">-&gt;</span><span class="me1">toGrayscale</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><br><span class="re0">$b</span><span class="sy0">-&gt;</span><span class="me1">writeP6</span><span class="br0">(</span><span class="st_h">'p6-grayscale.ppm'</span><span class="br0">)</span><span class="sy0">;</span></pre> 
        <h2><span class="mw-headline" id="PL.2FI"><a href="/wiki/Category:PL/I" title="Category:PL/I">PL/I</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=32" title="Edit section: PL/I">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <pre class="text highlighted_source">&nbsp;<br>do j = 1 to hbound(image,1);<br>   do i = 0 to hbound(image,2);<br>      color = image(i,j);<br>      R = substr(color, 17, 8);<br>      G = substr(color, 9, 8);<br>      B = substr(color, 1, 8);<br>      grey =  trunc(0.2126*R + 0.7152*G + 0.0722*B);<br>      greybits = grey;<br>      image(i,j) = substr(greybits, length(greybits)-7, 8);<br>   end;<br>end;<br>&nbsp;</pre> 
        <h2><span class="mw-headline" id="PicoLisp"><a href="/wiki/Category:PicoLisp" title="Category:PicoLisp">PicoLisp</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=33" title="Edit section: PicoLisp">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <pre class="text highlighted_source"># Convert color image (PPM) to greyscale image (PGM)<br>(de ppm-&gt;pgm (Ppm)<br>   (mapcar<br>      '((Y)<br>         (mapcar<br>            '((C)<br>               (/<br>                  (+<br>                     (* (car C) 2126)  # Red<br>                     (* (cadr C) 7152)  # Green<br>                     (* (caddr C) 722) )  # Blue<br>                  10000 ) )<br>            Y ) )<br>      Ppm ) )<br>&nbsp;<br># Convert greyscale image (PGM) to color image (PPM)<br>(de pgm-&gt;ppm (Pgm)<br>   (mapcar<br>      '((Y)<br>         (mapcar<br>            '((G) (list G G G))<br>            Y ) )<br>      Pgm ) )</pre> 
        <pre class="text highlighted_source"># Write greyscale image (PGM) to file<br>(de pgmWrite (Pgm File)<br>   (out File<br>      (prinl "P5")<br>      (prinl (length (car Pgm)) " " (length Pgm))<br>      (prinl 255)<br>      (for Y Pgm (apply wr Y)) ) )<br>&nbsp;<br># Create an empty image of 120 x 90 pixels<br>(setq *Ppm (make (do 90 (link (need 120)))))<br>&nbsp;<br># Fill background with green color<br>(ppmFill *Ppm 0 255 0)<br>&nbsp;<br># Draw a diagonal line<br>(for I 80 (ppmSetPixel *Ppm I I 0 0 0))<br>&nbsp;<br>&nbsp;<br># Convert to greyscale image (PGM)<br>(setq *Pgm (ppm-&gt;pgm *Ppm))<br>&nbsp;<br># Write greyscale image to .pgm file<br>(pgmWrite *Pgm "img.pgm")<br>&nbsp;<br># Convert to color image and write to .ppm file<br>(ppmWrite (pgm-&gt;ppm *Pgm) "img.ppm")</pre> 
        <h2><span class="mw-headline" id="PureBasic"><a href="/wiki/Category:PureBasic" title="Category:PureBasic">PureBasic</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=34" title="Edit section: PureBasic">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <pre class="purebasic highlighted_source"><span class="kw1">Procedure</span> ImageGrayout<span class="br0">(</span>image<span class="br0">)</span><br>  <span class="kw1">Protected</span> w, h, x, y, r, g, b, gray, color<br>&nbsp;<br>  w <span class="sy0">=</span> <span class="kw2">ImageWidth</span><span class="br0">(</span>image<span class="br0">)</span><br>  h <span class="sy0">=</span> <span class="kw2">ImageHeight</span><span class="br0">(</span>image<span class="br0">)</span><br>  <span class="kw2">StartDrawing</span><span class="br0">(</span><span class="kw2">ImageOutput</span><span class="br0">(</span>image<span class="br0">)</span><span class="br0">)</span><br>  <span class="kw1">For</span> x <span class="sy0">=</span> <span class="nu0">0</span> <span class="kw1">To</span> w <span class="sy0">-</span> <span class="nu0">1</span><br>    <span class="kw1">For</span> y <span class="sy0">=</span> <span class="nu0">0</span> <span class="kw1">To</span> h <span class="sy0">-</span> <span class="nu0">1</span><br>      color <span class="sy0">=</span> <span class="kw2">Point</span><span class="br0">(</span>x, y<span class="br0">)</span><br>      r    <span class="sy0">=</span> <span class="kw2">Red</span><span class="br0">(</span>color<span class="br0">)</span><br>      g    <span class="sy0">=</span> <span class="kw2">Green</span><span class="br0">(</span>color<span class="br0">)</span><br>      b    <span class="sy0">=</span> <span class="kw2">Blue</span><span class="br0">(</span>color<span class="br0">)</span><br>      gray <span class="sy0">=</span> <span class="nu0">0.2126</span><span class="sy0">*</span>r <span class="sy0">+</span> <span class="nu0">0.7152</span><span class="sy0">*</span>g <span class="sy0">+</span> <span class="nu0">0.0722</span><span class="sy0">*</span>b<br>      <span class="kw2">Plot</span><span class="br0">(</span>x, y, <span class="kw2">RGB</span><span class="br0">(</span>gray, gray, gray<span class="br0">)</span><br>    <span class="kw1">Next</span><br>  <span class="kw1">Next</span><br>  <span class="kw2">StopDrawing</span><span class="br0">(</span><span class="br0">)</span><br><span class="kw1">EndProcedure</span><br>&nbsp;<br><span class="kw1">Procedure</span> ImageToColor<span class="br0">(</span>image<span class="br0">)</span><br>  <span class="kw1">Protected</span> w, h, x, y, v, gray<br>&nbsp;<br>  w <span class="sy0">=</span> <span class="kw2">ImageWidth</span><span class="br0">(</span>image<span class="br0">)</span><br>  h <span class="sy0">=</span> <span class="kw2">ImageHeight</span><span class="br0">(</span>image<span class="br0">)</span><br>  <span class="kw2">StartDrawing</span><span class="br0">(</span><span class="kw2">ImageOutput</span><span class="br0">(</span>image<span class="br0">)</span><span class="br0">)</span><br>  <span class="kw1">For</span> x <span class="sy0">=</span> <span class="nu0">0</span> <span class="kw1">To</span> w <span class="sy0">-</span> <span class="nu0">1</span><br>    <span class="kw1">For</span> y <span class="sy0">=</span> <span class="nu0">0</span> <span class="kw1">To</span> h <span class="sy0">-</span> <span class="nu0">1</span><br>      gray <span class="sy0">=</span> <span class="kw2">Point</span><span class="br0">(</span>x, y<span class="br0">)</span><br>      v    <span class="sy0">=</span> <span class="kw2">Red</span><span class="br0">(</span>gray<span class="br0">)</span> <span class="co1">;for gray, each of the color's components is the same </span><br>      <span class="co1">;color = RGB(0.2126*v, 0.7152*v, 0.0722*v)</span><br>      <span class="kw2">Plot</span><span class="br0">(</span>x, y, <span class="kw2">RGB</span><span class="br0">(</span>v, v, v<span class="br0">)</span><span class="br0">)</span><br>    <span class="kw1">Next</span><br>  <span class="kw1">Next</span><br>  <span class="kw2">StopDrawing</span><span class="br0">(</span><span class="br0">)</span><br><span class="kw1">EndProcedure</span></pre> 
        <h2><span class="mw-headline" id="Python"><a href="/wiki/Category:Python" title="Category:Python">Python</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=35" title="Edit section: Python">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <div class="examplemeta workswith">
         <b>Works with</b>: 
         <a href="/wiki/Python" title="Python" class="mw-redirect">Python</a> version 3.1
        </div> 
        <p>Extending the example given <a href="/wiki/Basic_bitmap_storage#Alternative_version" title="Basic bitmap storage" class="mw-redirect">here</a> </p> 
        <pre class="python highlighted_source"><span class="co1"># String masquerading as ppm file (version P3)</span><br><span class="kw1">import</span> io<br>ppmfileout <span class="sy0">=</span> io.<span class="kw3">StringIO</span><span class="br0">(</span><span class="st0">''</span><span class="br0">)</span><br>&nbsp;<br><span class="kw1">def</span> togreyscale<span class="br0">(</span><span class="kw2">self</span><span class="br0">)</span>:<br>    <span class="kw1">for</span> h <span class="kw1">in</span> <span class="kw2">range</span><span class="br0">(</span><span class="kw2">self</span>.<span class="me1">height</span><span class="br0">)</span>:<br>        <span class="kw1">for</span> w <span class="kw1">in</span> <span class="kw2">range</span><span class="br0">(</span><span class="kw2">self</span>.<span class="me1">width</span><span class="br0">)</span>:<br>            r<span class="sy0">,</span> g<span class="sy0">,</span> b <span class="sy0">=</span> <span class="kw2">self</span>.<span class="me1">get</span><span class="br0">(</span>w<span class="sy0">,</span> h<span class="br0">)</span><br>            l <span class="sy0">=</span> <span class="kw2">int</span><span class="br0">(</span><span class="nu0">0.2126</span> * r + <span class="nu0">0.7152</span> * g + <span class="nu0">0.0722</span> * b<span class="br0">)</span><br>            <span class="kw2">self</span>.<span class="kw2">set</span><span class="br0">(</span>w<span class="sy0">,</span> h<span class="sy0">,</span> Colour<span class="br0">(</span>l<span class="sy0">,</span> l<span class="sy0">,</span> l<span class="br0">)</span><span class="br0">)</span><br>&nbsp;<br>Bitmap.<span class="me1">togreyscale</span> <span class="sy0">=</span> togreyscale    <br>&nbsp;<br>&nbsp;<br><span class="co1"># Draw something simple</span><br>bitmap <span class="sy0">=</span> Bitmap<span class="br0">(</span><span class="nu0">4</span><span class="sy0">,</span> <span class="nu0">4</span><span class="sy0">,</span> white<span class="br0">)</span><br>bitmap.<span class="me1">fillrect</span><span class="br0">(</span><span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">2</span><span class="sy0">,</span> Colour<span class="br0">(</span><span class="nu0">127</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">63</span><span class="br0">)</span><span class="br0">)</span><br>bitmap.<span class="kw2">set</span><span class="br0">(</span><span class="nu0">3</span><span class="sy0">,</span> <span class="nu0">3</span><span class="sy0">,</span> Colour<span class="br0">(</span><span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">127</span><span class="sy0">,</span> <span class="nu0">31</span><span class="br0">)</span><span class="br0">)</span><br><span class="kw1">print</span><span class="br0">(</span><span class="st0">'Colour:'</span><span class="br0">)</span><br><span class="co1"># Write to the open 'file' handle</span><br>bitmap.<span class="me1">writeppmp3</span><span class="br0">(</span>ppmfileout<span class="br0">)</span><br><span class="kw1">print</span><span class="br0">(</span>ppmfileout.<span class="me1">getvalue</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><br><span class="kw1">print</span><span class="br0">(</span><span class="st0">'Grey:'</span><span class="br0">)</span><br>bitmap.<span class="me1">togreyscale</span><span class="br0">(</span><span class="br0">)</span><br>ppmfileout <span class="sy0">=</span> io.<span class="kw3">StringIO</span><span class="br0">(</span><span class="st0">''</span><span class="br0">)</span><br>bitmap.<span class="me1">writeppmp3</span><span class="br0">(</span>ppmfileout<span class="br0">)</span><br><span class="kw1">print</span><span class="br0">(</span>ppmfileout.<span class="me1">getvalue</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp;<br>&nbsp;<br><span class="st0">'''<br>The print statement above produces the following output&nbsp;:<br>&nbsp;<br>Colour:<br>P3<br># generated from Bitmap.writeppmp3<br>4 4<br>255<br>   255 255 255   255 255 255   255 255 255     0 127  31<br>   255 255 255   255 255 255   255 255 255   255 255 255<br>   255 255 255   127   0  63   255 255 255   255 255 255<br>   255 255 255   127   0  63   255 255 255   255 255 255<br>&nbsp;<br>Grey:<br>P3<br># generated from Bitmap.writeppmp3<br>4 4<br>254<br>   254 254 254   254 254 254   254 254 254    93  93  93<br>   254 254 254   254 254 254   254 254 254   254 254 254<br>   254 254 254    31  31  31   254 254 254   254 254 254<br>   254 254 254    31  31  31   254 254 254   254 254 254<br>&nbsp;<br>'''</span></pre> 
        <h2><span class="mw-headline" id="R"><a href="/wiki/Category:R" title="Category:R">R</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=36" title="Edit section: R">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <div class="examplemeta libheader">
         <b>Library:</b> 
         <a href="/wiki/Category:Pixmap" title="Category:Pixmap">pixmap</a>
        </div> 
        <pre class="text highlighted_source"># Conversion from Grey to RGB uses the following code<br>setAs("pixmapGrey", "pixmapRGB",<br>function(from, to){<br>    z = new(to, as(from, "pixmap"))<br>    <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ee94ae9c8b8a">[email&nbsp;protected]</a> = <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ec8a9e8381ac8b9e8995">[email&nbsp;protected]</a><br>    <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="92e8d2f5e0f7f7fc">[email&nbsp;protected]</a> = <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="dabca8b5b79abda8bfa3">[email&nbsp;protected]</a><br>    <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a9d3e9cbc5dccc">[email&nbsp;protected]</a> = <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="781e0a1715381f0a1d01">[email&nbsp;protected]</a><br>    <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="2e546e4d464f40404b425d">[email&nbsp;protected]</a> = c("red", "green", "blue")<br>    z<br>})<br>&nbsp;<br># Conversion from RGB to grey uses built-in coefficients of 0.3, 0.59, 0.11.  To see this, type<br>getMethods(addChannels)<br>&nbsp;<br># We can override this behaviour with<br>setMethod("addChannels", "pixmapRGB",<br>function(object, coef=NULL){<br>    if(is.null(coef)) coef = c(0.2126, 0.7152, 0.0722)<br>    z = new("pixmapGrey", object)<br>    <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d8a298bfaabda1">[email&nbsp;protected]</a> = coef[1] * <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5e313c343b3d2a1e2c3b3a">[email&nbsp;protected]</a> + coef[2] * <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="036c616966607743647166666d">[email&nbsp;protected]</a> +<br>        coef[3] * <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3b5459515e584f7b59574e5e">[email&nbsp;protected]</a><br>    <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="176d57747f767979727b64">[email&nbsp;protected]</a> = "grey"<br>    z<br>})<br>&nbsp;<br># Colour image<br>plot(p1 &lt;- pixmapRGB(c(c(1,0,0,0,0,1), c(0,1,0,0,1,0), c(0,0,1,1,0,0)), nrow=6, ncol=6))<br>&nbsp;<br>#Convert to grey<br>plot(p2 &lt;- as(p1, "pixmapGrey"))<br>&nbsp;<br># Convert back to "colour"<br>plot(p3 &lt;- as(p2, "pixmapRGB"))</pre> 
        <h2><span class="mw-headline" id="Racket"><a href="/wiki/Category:Racket" title="Category:Racket">Racket</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=37" title="Edit section: Racket">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>This image shows the output: <a rel="nofollow" class="external free" href="http://imgur.com/e3Wi8RJ">http://imgur.com/e3Wi8RJ</a> </p>
        <p>I gave up on uploading to Rosetta Code. </p> 
        <pre class="text highlighted_source">&nbsp;<br>#lang racket<br>(require racket/draw)<br>&nbsp;<br>(define (gray-&gt;color gray-bm)<br>  (define gray-dc (new bitmap-dc% [bitmap gray-bm]))<br>  (define-values (w h) (send gray-dc get-size))<br>  (define width (exact-floor w))<br>  (define height (exact-floor h))<br>  (define color-bm (make-bitmap width height))<br>  (define color-dc (new bitmap-dc% [bitmap color-bm]))<br>  (define pixels (make-bytes (* 4 width height)))<br>  (send gray-dc get-argb-pixels 0 0 width height pixels)<br>  (send color-dc set-argb-pixels 0 0 width height pixels)<br>  color-bm)<br>&nbsp;<br>(define (color-&gt;gray color-bm)<br>  (define color-dc (new bitmap-dc% [bitmap color-bm]))<br>  (define-values (w h) (send color-dc get-size))<br>  (define width (exact-floor w))<br>  (define height (exact-floor h))<br>  (define gray-bm (make-bitmap width height))<br>  (define gray-dc (new bitmap-dc% [bitmap gray-bm]))<br>  (define pixels (make-bytes (* 4 width height)))<br>  (send color-dc get-argb-pixels 0 0 width height pixels)<br>  (for ([i (in-range 0 (* 4 width height) 4)])<br>    (define ? (bytes-ref pixels i))<br>    (define r (bytes-ref pixels (+ i 1)))<br>    (define g (bytes-ref pixels (+ i 2)))<br>    (define b (bytes-ref pixels (+ i 3)))<br>    (define l (exact-floor (+ (* 0.2126 r) (* 0.7152 g) (* 0.0722 b))))    <br>    (bytes-set! pixels (+ i 1) l)<br>    (bytes-set! pixels (+ i 2) l)<br>    (bytes-set! pixels (+ i 3) l))<br>  (send gray-dc set-argb-pixels 0 0 width height pixels)<br>  gray-bm)<br>&nbsp;<br>(require images/icons/symbol)<br>(define rosetta (text-icon "Rosetta Code" #:color "red" #:height 80))<br>rosetta<br>(color-&gt;gray rosetta)<br>(gray-&gt;color (color-&gt;gray rosetta))<br>&nbsp;</pre> 
        <h2><span class="mw-headline" id="REXX"><a href="/wiki/Category:REXX" title="Category:REXX">REXX</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=38" title="Edit section: REXX">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>Note: &nbsp; REXX uses characters instead of binary for storing numbers, so there is no rounding &nbsp; (using characters to </p> 
        <dl>
         <dd>
          <dl>
           <dd>
             store numbers is almost the same as using decimal floating point).
           </dd>
          </dl>
         </dd>
        </dl> 
        <pre class="rexx highlighted_source"><span class="coMULTI">/*REXX program converts a   RGB  (red?green?blue)   image to a  grayscale  image.       */</span><br>  blue= <span class="st0">'00 00 ff'</span>x                              <span class="coMULTI">/*define the blue color  (hexadecimal).*/</span><br>    @<span class="sy0">.</span>= blue                                     <span class="coMULTI">/*set the entire  image  to blue color.*/</span><br> width=  <span class="nu0">60</span>                                      <span class="coMULTI">/* width of the   image  (in pixels).  */</span><br>height= <span class="nu0">100</span>                                      <span class="coMULTI">/*height  "  "      "      "   "       */</span><br>&nbsp;<br>  <span class="kw1">do</span>    col=<span class="nu0">1</span>  <span class="kw2">for</span> width<br>     <span class="kw1">do</span> row=<span class="nu0">1</span>  <span class="kw2">for</span> height                        <span class="coMULTI">/* [?]  C2D  convert  char ???&gt; decimal*/</span><br>     r=  <span class="kw6">left</span><span class="br0">(</span>@<span class="sy0">.</span>col<span class="sy0">.</span>row, <span class="nu0">1</span><span class="br0">)</span>   &nbsp;;    r=<span class="kw6">c2d</span><span class="br0">(</span>r<span class="br0">)</span>     <span class="coMULTI">/*extract the component red  &amp; convert.*/</span><br>     g=<span class="kw6">substr</span><span class="br0">(</span>@<span class="sy0">.</span>col<span class="sy0">.</span>row, <span class="nu0">2</span>, <span class="nu0">1</span><span class="br0">)</span>&nbsp;;    g=<span class="kw6">c2d</span><span class="br0">(</span>g<span class="br0">)</span>     <span class="coMULTI">/*   "     "      "    green "    "    */</span><br>     b= <span class="kw6">right</span><span class="br0">(</span>@<span class="sy0">.</span>col<span class="sy0">.</span>row, <span class="nu0">1</span><span class="br0">)</span>   &nbsp;;    b=<span class="kw6">c2d</span><span class="br0">(</span>b<span class="br0">)</span>     <span class="coMULTI">/*   "     "      "    blue  "    "    */</span><br>     @<span class="sy0">.</span>col<span class="sy0">.</span>row=<span class="kw6">d2c</span><span class="br0">(</span><span class="br0">(</span><span class="sy0">.</span>2126<span class="sy0">*</span>r+<span class="sy0">.</span>7152<span class="sy0">*</span>g +<span class="sy0">.</span>0722<span class="sy0">*</span>b<span class="br0">)</span>%1<span class="br0">)</span> <span class="coMULTI">/*convert RGB number  ????  grayscale. */</span><br>     <span class="kw3">end</span>   <span class="coMULTI">/*row*/</span>                               <span class="coMULTI">/* [?]  D2C  convert  decimal ???&gt; char*/</span><br>  <span class="kw3">end</span>      <span class="coMULTI">/*col*/</span>                               <span class="coMULTI">/* [?]  x%1   is the same as  TRUNC(x) */</span><br>                                                 <span class="coMULTI">/*stick a fork in it,  we're all done. */</span></pre> 
        <p>Other alternatives to express the &nbsp; <i>blue</i> &nbsp; color are: </p> 
        <pre class="rexx highlighted_source">  blue= <span class="st0">"00 00 ff"</span>x                              <span class="coMULTI">/*define the blue color  (hexadecimal).*/</span><br>  blue= <span class="st0">'00 00 ff'</span>x                              <span class="coMULTI">/*define the blue color  (hexadecimal).*/</span><br>  blue= <span class="st0">'0000ff'</span>x                                <span class="coMULTI">/*define the blue color  (hexadecimal).*/</span><br>&nbsp;<br>  blue= <span class="st0">'00000000 00000000 11111111'</span>b            <span class="coMULTI">/*define the blue color  (binary).     */</span><br>  blue= <span class="st0">'000000000000000011111111'</span>b              <span class="coMULTI">/*define the blue color  (binary)      */</span><br>&nbsp;<br>  blue= <span class="st0">'zzy'</span>                                    <span class="coMULTI">/*define the blue color  (character).  */</span><br>                                                 <span class="coMULTI">/*not recommended because of rendering.*/</span><br>                                                 <span class="coMULTI">/*where   Z   is the character  '00'x  */</span><br>                                                 <span class="coMULTI">/*where   Y   is the character  'ff'x  */</span><br>&nbsp;<br>                                                 <span class="coMULTI">/*Both  Z &amp; Y are normally not viewable*/</span><br>                                                 <span class="coMULTI">/*on most terminals (appear as blanks).*/</span></pre> 
        <h2><span class="mw-headline" id="Ruby"><a href="/wiki/Category:Ruby" title="Category:Ruby">Ruby</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=39" title="Edit section: Ruby">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>Extending <a href="/wiki/Basic_bitmap_storage#Ruby" title="Basic bitmap storage" class="mw-redirect">Basic_bitmap_storage#Ruby</a> </p> 
        <pre class="ruby highlighted_source"><span class="kw1">class</span> RGBColour<br>  <span class="kw1">def</span> to_grayscale<br>    luminosity = <span class="kw3">Integer</span><span class="br0">(</span><span class="nu0">0.2126</span><span class="sy0">*</span>@red <span class="sy0">+</span> <span class="nu0">0.7152</span><span class="sy0">*</span>@green <span class="sy0">+</span> <span class="nu0">0.0722</span><span class="sy0">*</span>@blue<span class="br0">)</span><br>    <span class="kw2">self</span>.<span class="kw1">class</span>.<span class="me1">new</span><span class="br0">(</span>luminosity, luminosity, luminosity<span class="br0">)</span><br>  <span class="kw1">end</span><br><span class="kw1">end</span><br>&nbsp;<br><span class="kw1">class</span> Pixmap<br>  <span class="kw1">def</span> to_grayscale<br>    gray = <span class="kw2">self</span>.<span class="kw1">class</span>.<span class="me1">new</span><span class="br0">(</span>@width, <span class="re1">@height</span><span class="br0">)</span><br>    <span class="re1">@width</span>.<span class="me1">times</span> <span class="kw1">do</span> <span class="sy0">|</span>x<span class="sy0">|</span><br>      <span class="re1">@height</span>.<span class="me1">times</span> <span class="kw1">do</span> <span class="sy0">|</span>y<span class="sy0">|</span><br>        gray<span class="br0">[</span>x,y<span class="br0">]</span> = <span class="kw2">self</span><span class="br0">[</span>x,y<span class="br0">]</span>.<span class="me1">to_grayscale</span><br>      <span class="kw1">end</span><br>    <span class="kw1">end</span><br>    gray<br>  <span class="kw1">end</span><br><span class="kw1">end</span></pre> 
        <h2><span class="mw-headline" id="Scala"><a href="/wiki/Category:Scala" title="Category:Scala">Scala</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=40" title="Edit section: Scala">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>Uses the <a href="/wiki/Basic_bitmap_storage#Scala" title="Basic bitmap storage" class="mw-redirect">Scala Basic Bitmap Storage</a> class. </p> 
        <pre class="scala highlighted_source"><a href="http://scala-lang.org"><span class="kw1">object</span></a> BitmapOps <span class="br0">{</span><br>   <a href="http://scala-lang.org"><span class="kw1">def</span></a> luminosity<span class="br0">(</span>c<span class="sy0">:</span>Color<span class="br0">)</span><span class="sy0">=</span><span class="br0">(</span><span class="nu0">0.2126</span><span class="sy0">*</span>c.<span class="me1">getRed</span> + <span class="nu0">0.7152</span><span class="sy0">*</span>c.<span class="me1">getGreen</span> + <span class="nu0">0.0722</span><span class="sy0">*</span>c.<span class="me1">getBlue</span>+<span class="nu0">0.5</span><span class="br0">)</span>.<span class="me1">toInt</span><br>&nbsp;<br>   <a href="http://scala-lang.org"><span class="kw1">def</span></a> grayscale<span class="br0">(</span>bm<span class="sy0">:</span>RgbBitmap<span class="br0">)</span><span class="sy0">=</span><span class="br0">{</span><br>      <a href="http://scala-lang.org"><span class="kw1">val</span></a> image<span class="sy0">=</span><a href="http://scala-lang.org"><span class="kw1">new</span></a> RgbBitmap<span class="br0">(</span>bm.<span class="me1">width</span>, bm.<span class="me1">height</span><span class="br0">)</span><br>      <a href="http://scala-lang.org"><span class="kw1">for</span></a><span class="br0">(</span>x <span class="sy0">&lt;</span>- <span class="nu0">0</span> until bm.<span class="me1">width</span><span class="sy0">;</span> y <span class="sy0">&lt;</span>- <span class="nu0">0</span> until bm.<span class="me1">height</span><span class="sy0">;</span> l<span class="sy0">=</span>luminosity<span class="br0">(</span>bm.<span class="me1">getPixel</span><span class="br0">(</span>x,y<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><br>         image.<span class="me1">setPixel</span><span class="br0">(</span>x, y, <a href="http://scala-lang.org"><span class="kw1">new</span></a> Color<span class="br0">(</span>l,l,l<span class="br0">)</span><span class="br0">)</span><br>      image<br>   <span class="br0">}</span><br><span class="br0">}</span></pre> 
        <h2><span class="mw-headline" id="Sidef"><a href="/wiki/Category:Sidef" title="Category:Sidef">Sidef</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=41" title="Edit section: Sidef">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <div class="examplemeta translation">
         <b>Translation of</b>: 
         <a href="#Perl">Perl</a>
        </div> 
        <pre class="ruby highlighted_source"><span class="kw3">require</span><span class="br0">(</span><span class="st0">'Image::Imlib2'</span><span class="br0">)</span><br>&nbsp;<br>func tograyscale<span class="br0">(</span>img<span class="br0">)</span> <span class="br0">{</span><br>    var <span class="br0">(</span>width, height<span class="br0">)</span> = <span class="br0">(</span>img.<span class="me1">width</span>, img.<span class="me1">height</span><span class="br0">)</span><br>    var gimg = <span class="sy0">%</span>s<span class="st0">'Image::Imlib2'</span>.<span class="me1">new</span><span class="br0">(</span>width, height<span class="br0">)</span><br>    <span class="kw1">for</span> y,x <span class="kw1">in</span> <span class="br0">(</span>^height ~X ^width<span class="br0">)</span> <span class="br0">{</span><br>        var <span class="br0">(</span>r, g, b<span class="br0">)</span> = img.<span class="me1">query_pixel</span><span class="br0">(</span>x, y<span class="br0">)</span><br>        var gray = int<span class="br0">(</span><span class="nu0">0.2126</span><span class="sy0">*</span>r <span class="sy0">+</span> <span class="nu0">0.7152</span><span class="sy0">*</span>g <span class="sy0">+</span> <span class="nu0">0.0722</span><span class="sy0">*</span>b<span class="br0">)</span><br>        gimg.<span class="me1">set_color</span><span class="br0">(</span>gray, gray, gray, <span class="nu0">255</span><span class="br0">)</span><br>        gimg.<span class="me1">draw_point</span><span class="br0">(</span>x, y<span class="br0">)</span><br>    <span class="br0">}</span><br>    <span class="kw2">return</span> gimg<br><span class="br0">}</span><br>&nbsp;<br>var <span class="br0">(</span>input=<span class="st0">'input.png'</span>, output=<span class="st0">'output.png'</span><span class="br0">)</span> = ARGV...<br><span class="me1">var</span> image = <span class="sy0">%</span>s<span class="st0">'Image::Imlib2'</span>.<span class="kw3">load</span><span class="br0">(</span>input<span class="br0">)</span><br>var gscale = tograyscale<span class="br0">(</span>image<span class="br0">)</span><br>gscale.<span class="me1">set_quality</span><span class="br0">(</span><span class="nu0">80</span><span class="br0">)</span><br>gscale.<span class="me1">save</span><span class="br0">(</span>output<span class="br0">)</span></pre> 
        <h2><span class="mw-headline" id="Tcl"><a href="/wiki/Category:Tcl" title="Category:Tcl">Tcl</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=42" title="Edit section: Tcl">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <div class="examplemeta libheader">
         <b>Library:</b> 
         <a href="/wiki/Category:Tk" title="Category:Tk">Tk</a>
        </div> 
        <pre class="tcl highlighted_source"><span class="kw2">package</span> require Tk<br>&nbsp;<br><span class="kw1">proc</span> grayscale image <span class="br0">{</span><br>    <span class="kw1">set</span> w <span class="br0">[</span>image width <span class="re0">$image</span><span class="br0">]</span><br>    <span class="kw1">set</span> h <span class="br0">[</span>image height <span class="re0">$image</span><span class="br0">]</span><br>    <span class="kw1">for</span> <span class="br0">{</span><span class="kw1">set</span> x <span class="nu0">0</span><span class="br0">}</span> <span class="br0">{</span><span class="re0">$x</span><span class="sy0">&lt;</span><span class="re0">$w</span><span class="br0">}</span> <span class="br0">{</span><span class="kw2">incr</span> x<span class="br0">}</span> <span class="br0">{</span><br>        <span class="kw1">for</span> <span class="br0">{</span><span class="kw1">set</span> y <span class="nu0">0</span><span class="br0">}</span> <span class="br0">{</span><span class="re0">$y</span><span class="sy0">&lt;</span><span class="re0">$h</span><span class="br0">}</span> <span class="br0">{</span><span class="kw2">incr</span> y<span class="br0">}</span> <span class="br0">{</span><br>            lassign <span class="br0">[</span><span class="re0">$image</span> get <span class="re0">$x</span> <span class="re0">$y</span><span class="br0">]</span> r g b<br>            <span class="kw1">set</span> l <span class="br0">[</span><span class="kw1">expr</span> <span class="br0">{</span>int<span class="br0">(</span><span class="nu0">0.2126</span><span class="sy0">*</span><span class="re0">$r</span> + <span class="nu0">0.7152</span><span class="sy0">*</span><span class="re0">$g</span> + <span class="nu0">0.0722</span><span class="sy0">*</span><span class="re0">$b</span><span class="br0">)</span><span class="br0">}</span><span class="br0">]</span><br>            <span class="re0">$image</span> put <span class="br0">[</span><span class="kw2">format</span> <span class="st0">"#%02x%02x%02x"</span> <span class="re0">$l</span> <span class="re0">$l</span> <span class="re0">$l</span><span class="br0">]</span> -to <span class="re0">$x</span> <span class="re0">$y</span><br>        <span class="br0">}</span><br>    <span class="br0">}</span><br><span class="br0">}</span></pre> 
        <p>Photo images are always 8-bits-per-channel RGBA. </p> 
        <h2><span class="mw-headline" id="Vedit_macro_language"><a href="/wiki/Category:Vedit_macro_language" title="Category:Vedit macro language">Vedit macro language</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=43" title="Edit section: Vedit macro language">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>Conversion to a grayscale image.<br> </p> 
        <pre class="vedit highlighted_source"><span class="co1">//  Convert RGB image to grayscale (8 bit/pixel)</span><br><span class="co1">//    #10 = buffer that contains image data</span><br><span class="co1">//  On return:</span><br><span class="co1">//    #20 = buffer for the new grayscale image</span><br>&nbsp;<br><span class="sy0">:</span>RGB_TO_GRAYSCALE<span class="sy0">:</span><br>File_Open<span class="br0">(</span><span class="st0">"|(VEDIT_TEMP)\gray.data"</span><span class="sy0">,</span> OVERWRITE<span class="sy0">+</span>NOEVENT<span class="sy0">+</span>NOMSG<span class="br0">)</span><br>#<span class="nu0">20</span> <span class="sy0">=</span> Buf_Num<br>BOF<br>Del_Char<span class="br0">(</span>ALL<span class="br0">)</span><br>Buf_Switch<span class="br0">(</span>#<span class="nu0">10</span><span class="br0">)</span><br><span class="kw1">Repeat</span><span class="br0">(</span>File_Size<span class="sy0">/</span><span class="nu0">3</span><span class="br0">)</span> <span class="br0">{</span><br>    #<span class="nu0">9</span> <span class="sy0">=</span>  Cur_Char<span class="br0">(</span><span class="br0">)</span> <span class="sy0">*</span> <span class="nu0">2126</span><br>    #<span class="nu0">9</span> <span class="sy0">+=</span> Cur_Char<span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span> <span class="sy0">*</span> <span class="nu0">7152</span><br>    #<span class="nu0">9</span> <span class="sy0">+=</span> Cur_Char<span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span> <span class="sy0">*</span> <span class="nu0">722</span><br>    Char<span class="br0">(</span><span class="nu0">3</span><span class="br0">)</span><br>    Buf_Switch<span class="br0">(</span>#<span class="nu0">20</span><span class="br0">)</span><br>    Ins_Char<span class="br0">(</span>#<span class="nu0">9</span> <span class="sy0">/</span> <span class="nu0">10000</span><span class="br0">)</span><br>    Buf_Switch<span class="br0">(</span>#<span class="nu0">10</span><span class="br0">)</span><br><span class="br0">}</span><br><span class="kw1">Return</span></pre> 
        <p>Conversion to a color image.<br> </p> 
        <pre class="vedit highlighted_source"><span class="co1">//  Convert grayscale image (8 bits/pixel) into RGB (24 bits/pixel)</span><br><span class="co1">//    #20 = buffer that contains image data</span><br><span class="co1">//  On return:</span><br><span class="co1">//    #10 = buffer for the new RGB image</span><br>&nbsp;<br><span class="sy0">:</span>GRAYSCALE_TO_RGB<span class="sy0">:</span><br>File_Open<span class="br0">(</span><span class="st0">"|(VEDIT_TEMP)\RGB.data"</span><span class="sy0">,</span> OVERWRITE<span class="sy0">+</span>NOEVENT<span class="sy0">+</span>NOMSG<span class="br0">)</span><br>#<span class="nu0">10</span> <span class="sy0">=</span> Buf_Num<br>BOF<br>Del_Char<span class="br0">(</span>ALL<span class="br0">)</span><br>Buf_Switch<span class="br0">(</span>#<span class="nu0">20</span><span class="br0">)</span>			<span class="co1">// input image (grayscale)</span><br>BOF<br><span class="kw1">Repeat</span><span class="br0">(</span>File_Size<span class="br0">)</span> <span class="br0">{</span><br>    #<span class="nu0">9</span> <span class="sy0">=</span>  Cur_Char<span class="br0">(</span><span class="br0">)</span><br>    Char<br>    Buf_Switch<span class="br0">(</span>#<span class="nu0">10</span><span class="br0">)</span>		<span class="co1">// output image (RGB)</span><br>    Ins_Char<span class="br0">(</span>#<span class="nu0">9</span><span class="sy0">,</span> COUNT<span class="sy0">,</span> <span class="nu0">3</span><span class="br0">)</span><br>    Buf_Switch<span class="br0">(</span>#<span class="nu0">20</span><span class="br0">)</span><br><span class="br0">}</span><br><span class="kw1">Return</span></pre> 
        <h2><span class="mw-headline" id="Visual_Basic_.NET"><a href="/wiki/Category:Visual_Basic_.NET" title="Category:Visual Basic .NET">Visual Basic .NET</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=44" title="Edit section: Visual Basic .NET">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>Convert a Bitmap to Grayscale. </p> 
        <pre class="vbnet highlighted_source">&nbsp;<br><span class="kw1">Imports</span> System<span class="sy0">.</span><span class="me1">Drawing</span><span class="sy0">.</span><span class="me1">Imaging</span><br>&nbsp;<br>  <span class="kw1">Public</span> <span class="kw1">Function</span> Grayscale<span class="br0">(</span><span class="kw1">ByVal</span> Map <span class="kw1">As</span> Bitmap<span class="br0">)</span> <span class="kw1">As</span> Bitmap<br>&nbsp;<br>    <span class="kw1">Dim</span> oData<span class="br0">(</span><span class="br0">)</span> <span class="kw1">As</span> <span class="kw2">Integer</span> <span class="sy0">=</span> GetData<span class="br0">(</span>Map<span class="br0">)</span><br>    <span class="kw1">Dim</span> oReturn <span class="kw1">As</span> <span class="kw1">New</span> Bitmap<span class="br0">(</span>Map<span class="sy0">.</span><span class="me1">Width</span>, Map<span class="sy0">.</span><span class="me1">Height</span>, Map<span class="sy0">.</span><span class="me1">PixelFormat</span><span class="br0">)</span><br>    <span class="kw1">Dim</span> a <span class="kw1">As</span> <span class="kw2">Integer</span> <span class="sy0">=</span> <span class="nu0">0</span><br>    <span class="kw1">Dim</span> r <span class="kw1">As</span> <span class="kw2">Integer</span> <span class="sy0">=</span> <span class="nu0">0</span><br>    <span class="kw1">Dim</span> g <span class="kw1">As</span> <span class="kw2">Integer</span> <span class="sy0">=</span> <span class="nu0">0</span><br>    <span class="kw1">Dim</span> b <span class="kw1">As</span> <span class="kw2">Integer</span> <span class="sy0">=</span> <span class="nu0">0</span><br>    <span class="kw1">Dim</span> l <span class="kw1">As</span> <span class="kw2">Integer</span> <span class="sy0">=</span> <span class="nu0">0</span><br>&nbsp;<br>    <span class="kw1">For</span> i <span class="kw1">As</span> <span class="kw2">Integer</span> <span class="sy0">=</span> <span class="nu0">0</span> <span class="kw1">To</span> oData<span class="sy0">.</span><span class="me1">GetUpperBound</span><span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><br>      a <span class="sy0">=</span> <span class="br0">(</span>oData<span class="br0">(</span>i<span class="br0">)</span> <span class="sy0">&gt;&gt;</span> <span class="nu0">24</span><span class="br0">)</span><br>      r <span class="sy0">=</span> <span class="br0">(</span>oData<span class="br0">(</span>i<span class="br0">)</span> <span class="sy0">&gt;&gt;</span> <span class="nu0">16</span><span class="br0">)</span> <span class="kw1">And</span> <span class="nu0">255</span><br>      g <span class="sy0">=</span> <span class="br0">(</span>oData<span class="br0">(</span>i<span class="br0">)</span> <span class="sy0">&gt;&gt;</span> <span class="nu0">8</span><span class="br0">)</span> <span class="kw1">And</span> <span class="nu0">255</span><br>      b <span class="sy0">=</span> oData<span class="br0">(</span>i<span class="br0">)</span> <span class="kw1">And</span> <span class="nu0">255</span><br>&nbsp;<br>      l <span class="sy0">=</span> <span class="kw4">CInt</span><span class="br0">(</span>r <span class="sy0">*</span> 0<span class="sy0">.</span>2126F <span class="sy0">+</span> g <span class="sy0">*</span> 0<span class="sy0">.</span>7152F <span class="sy0">+</span> b <span class="sy0">*</span> 0<span class="sy0">.</span>0722F<span class="br0">)</span><br>&nbsp;<br>      oData<span class="br0">(</span>i<span class="br0">)</span> <span class="sy0">=</span> <span class="br0">(</span>a <span class="sy0">&lt;&lt;</span> <span class="nu0">24</span><span class="br0">)</span> <span class="kw1">Or</span> <span class="br0">(</span>l <span class="sy0">&lt;&lt;</span> <span class="nu0">16</span><span class="br0">)</span> <span class="kw1">Or</span> <span class="br0">(</span>l <span class="sy0">&lt;&lt;</span> <span class="nu0">8</span><span class="br0">)</span> <span class="kw1">Or</span> l<br>    <span class="kw1">Next</span><br>&nbsp;<br>    SetData<span class="br0">(</span>oReturn, oData<span class="br0">)</span><br>&nbsp;<br>    <span class="kw1">Return</span> oReturn<br>&nbsp;<br>  <span class="kw1">End</span> <span class="kw1">Function</span><br>&nbsp;<br>  <span class="kw1">Private</span> <span class="kw1">Function</span> GetData<span class="br0">(</span><span class="kw1">ByVal</span> Map <span class="kw1">As</span> Bitmap<span class="br0">)</span> <span class="kw1">As</span> <span class="kw2">Integer</span><span class="br0">(</span><span class="br0">)</span><br>&nbsp;<br>    <span class="kw1">Dim</span> oBMPData <span class="kw1">As</span> BitmapData <span class="sy0">=</span> <span class="kw1">Nothing</span><br>    <span class="kw1">Dim</span> oData<span class="br0">(</span><span class="br0">)</span> <span class="kw1">As</span> <span class="kw2">Integer</span> <span class="sy0">=</span> <span class="kw1">Nothing</span><br>&nbsp;<br>    oBMPData <span class="sy0">=</span> Map<span class="sy0">.</span><span class="me1">LockBits</span><span class="br0">(</span><span class="kw1">New</span> Rectangle<span class="br0">(</span><span class="nu0">0</span>, <span class="nu0">0</span>, Map<span class="sy0">.</span><span class="me1">Width</span>, Map<span class="sy0">.</span><span class="me1">Height</span><span class="br0">)</span>, ImageLockMode<span class="sy0">.</span><span class="kw1">ReadOnly</span>, PixelFormat<span class="sy0">.</span><span class="me1">Format32bppArgb</span><span class="br0">)</span><br>&nbsp;<br>    Array<span class="sy0">.</span><span class="me1">Resize</span><span class="br0">(</span>oData, Map<span class="sy0">.</span><span class="me1">Width</span> <span class="sy0">*</span> Map<span class="sy0">.</span><span class="me1">Height</span><span class="br0">)</span><br>&nbsp;<br>    Runtime<span class="sy0">.</span><span class="me1">InteropServices</span><span class="sy0">.</span><span class="me1">Marshal</span><span class="sy0">.</span><span class="me1">Copy</span><span class="br0">(</span>oBMPData<span class="sy0">.</span><span class="me1">Scan0</span>, oData, <span class="nu0">0</span>, oData<span class="sy0">.</span><span class="me1">Length</span><span class="br0">)</span><br>&nbsp;<br>    Map<span class="sy0">.</span><span class="me1">UnlockBits</span><span class="br0">(</span>oBMPData<span class="br0">)</span><br>&nbsp;<br>    <span class="kw1">Return</span> oData<br>&nbsp;<br>  <span class="kw1">End</span> <span class="kw1">Function</span><br>&nbsp;<br>  <span class="kw1">Private</span> <span class="kw1">Sub</span> SetData<span class="br0">(</span><span class="kw1">ByVal</span> Map <span class="kw1">As</span> Bitmap, <span class="kw1">ByVal</span> Data <span class="kw1">As</span> <span class="kw2">Integer</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp;<br>    <span class="kw1">Dim</span> oBMPData <span class="kw1">As</span> BitmapData <span class="sy0">=</span> <span class="kw1">Nothing</span><br>&nbsp;<br>    oBMPData <span class="sy0">=</span> Map<span class="sy0">.</span><span class="me1">LockBits</span><span class="br0">(</span><span class="kw1">New</span> Rectangle<span class="br0">(</span><span class="nu0">0</span>, <span class="nu0">0</span>, Map<span class="sy0">.</span><span class="me1">Width</span>, Map<span class="sy0">.</span><span class="me1">Height</span><span class="br0">)</span>, ImageLockMode<span class="sy0">.</span><span class="kw1">WriteOnly</span>, PixelFormat<span class="sy0">.</span><span class="me1">Format32bppArgb</span><span class="br0">)</span><br>&nbsp;<br>    Runtime<span class="sy0">.</span><span class="me1">InteropServices</span><span class="sy0">.</span><span class="me1">Marshal</span><span class="sy0">.</span><span class="me1">Copy</span><span class="br0">(</span>Data, <span class="nu0">0</span>, oBMPData<span class="sy0">.</span><span class="me1">Scan0</span>, Data<span class="sy0">.</span><span class="me1">Length</span><span class="br0">)</span><br>&nbsp;<br>    Map<span class="sy0">.</span><span class="me1">UnlockBits</span><span class="br0">(</span>oBMPData<span class="br0">)</span><br>&nbsp;<br>  <span class="kw1">End</span> <span class="kw1">Sub</span></pre> 
        <h2><span class="mw-headline" id="zkl"><a href="/wiki/Category:Zkl" title="Category:Zkl">zkl</a></span><span class="mw-editsection"><span class="mw-editsection-bracket">[</span><a href="/mw/index.php?title=Grayscale_image&amp;action=edit&amp;section=45" title="Edit section: zkl">edit</a><span class="mw-editsection-bracket">]</span></span></h2> 
        <p>Does an in-place conversion from a color PPM image to a gray scale PPM image (ie rgb is down sampled but remains rgb vs one byte color). If you wish to write a bit map (or some other format), check out <a href="/wiki/Bitmap/PPM_conversion_through_a_pipe#zkl" title="Bitmap/PPM conversion through a pipe">Bitmap/PPM conversion through a pipe#zkl</a> </p>
        <p>Uses the PPM class from <a rel="nofollow" class="external free" href="http://rosettacode.org/wiki/Bitmap/Bresenham%27s_line_algorithm#zkl">http://rosettacode.org/wiki/Bitmap/Bresenham%27s_line_algorithm#zkl</a> </p> 
        <div class="examplemeta translation">
         <b>Translation of</b>: 
         <a href="#BASIC256">BASIC256</a>
        </div> 
        <pre class="text highlighted_source">fcn toGrayScale(img){  // in-place conversion<br>   foreach x,y in (img.w,img.h){<br>      r,g,b:=img[x,y].toBigEndian(3);<br>      lum:=(0.2126*r + 0.7152*g + 0.0722*b).toInt();<br>      img[x,y]=((lum*256) + lum)*256 + lum;<br>   }<br>}</pre> 
        <pre class="text highlighted_source">img:=PPM.readPPMFile("lena.ppm");<br>toGrayScale(img);<br>img.write(File("foo.ppm","wb"));</pre> 
        <div> 
         <dl>
          <dt>
           Output:
          </dt>
         </dl>
        </div> 
        <p><a rel="nofollow" class="external free" href="http://www.zenkinetic.com/Images/RosettaCode/lenaGray.jpg">http://www.zenkinetic.com/Images/RosettaCode/lenaGray.jpg</a> </p> 
       </div>
       <div class="printfooter">
         Retrieved from "
        <a dir="ltr" href="https://rosettacode.org/mw/index.php?title=Grayscale_image&amp;oldid=237790">https://rosettacode.org/mw/index.php?title=Grayscale_image&amp;oldid=237790</a>"
       </div> 
      </div> 
      <div id="catlinks" class="catlinks">
       <div id="mw-normal-catlinks" class="mw-normal-catlinks">
        <a href="/wiki/Special:Categories" title="Special:Categories">Categories</a>: 
        <ul>
         <li><a href="/wiki/Category:Programming_Tasks" title="Category:Programming Tasks">Programming Tasks</a></li>
         <li><a href="/wiki/Category:Image_processing" title="Category:Image processing">Image processing</a></li>
         <li><a href="/wiki/Category:Ada" title="Category:Ada">Ada</a></li>
         <li><a href="/wiki/Category:BASIC256" title="Category:BASIC256">BASIC256</a></li>
         <li><a href="/wiki/Category:Batch_File/Omit" title="Category:Batch File/Omit">Batch File/Omit</a></li>
         <li><a href="/wiki/Category:BBC_BASIC" title="Category:BBC BASIC">BBC BASIC</a></li>
         <li><a href="/wiki/Category:C" title="Category:C">C</a></li>
         <li><a href="/wiki/Category:C_sharp" title="Category:C sharp">C sharp</a></li>
         <li><a href="/wiki/Category:Clojure" title="Category:Clojure">Clojure</a></li>
         <li><a href="/wiki/Category:Common_Lisp" title="Category:Common Lisp">Common Lisp</a></li>
         <li><a href="/wiki/Category:D" title="Category:D">D</a></li>
         <li><a href="/wiki/Category:Euler_Math_Toolbox" title="Category:Euler Math Toolbox">Euler Math Toolbox</a></li>
         <li><a href="/wiki/Category:Erlang" title="Category:Erlang">Erlang</a></li>
         <li><a href="/wiki/Category:Euphoria" title="Category:Euphoria">Euphoria</a></li>
         <li><a href="/wiki/Category:FBSL" title="Category:FBSL">FBSL</a></li>
         <li><a href="/wiki/Category:Forth" title="Category:Forth">Forth</a></li>
         <li><a href="/wiki/Category:Fortran" title="Category:Fortran">Fortran</a></li>
         <li><a href="/wiki/Category:Go" title="Category:Go">Go</a></li>
         <li><a href="/wiki/Category:Haskell" title="Category:Haskell">Haskell</a></li>
         <li><a href="/wiki/Category:J" title="Category:J">J</a></li>
         <li><a href="/wiki/Category:Java" title="Category:Java">Java</a></li>
         <li><a href="/wiki/Category:JavaScript" title="Category:JavaScript">JavaScript</a></li>
         <li><a href="/wiki/Category:Julia" title="Category:Julia">Julia</a></li>
         <li><a href="/wiki/Category:Lingo" title="Category:Lingo">Lingo</a></li>
         <li><a href="/wiki/Category:Lua" title="Category:Lua">Lua</a></li>
         <li><a href="/wiki/Category:Mathematica" title="Category:Mathematica">Mathematica</a></li>
         <li><a href="/wiki/Category:Wolfram_Language" title="Category:Wolfram Language">Wolfram Language</a></li>
         <li><a href="/wiki/Category:MATLAB" title="Category:MATLAB">MATLAB</a></li>
         <li><a href="/wiki/Category:OCaml" title="Category:OCaml">OCaml</a></li>
         <li><a href="/wiki/Category:Octave" title="Category:Octave">Octave</a></li>
         <li><a href="/wiki/Category:Oz" title="Category:Oz">Oz</a></li>
         <li><a href="/wiki/Category:Perl" title="Category:Perl">Perl</a></li>
         <li><a href="/wiki/Category:Imlib2" title="Category:Imlib2">Imlib2</a></li>
         <li><a href="/wiki/Category:Perl_6" title="Category:Perl 6">Perl 6</a></li>
         <li><a href="/wiki/Category:Phix" title="Category:Phix">Phix</a></li>
         <li><a href="/wiki/Category:PHP" title="Category:PHP">PHP</a></li>
         <li><a href="/wiki/Category:PL/I" title="Category:PL/I">PL/I</a></li>
         <li><a href="/wiki/Category:PicoLisp" title="Category:PicoLisp">PicoLisp</a></li>
         <li><a href="/wiki/Category:PureBasic" title="Category:PureBasic">PureBasic</a></li>
         <li><a href="/wiki/Category:Python" title="Category:Python">Python</a></li>
         <li><a href="/wiki/Category:R" title="Category:R">R</a></li>
         <li><a href="/wiki/Category:Pixmap" title="Category:Pixmap">Pixmap</a></li>
         <li><a href="/wiki/Category:Racket" title="Category:Racket">Racket</a></li>
         <li><a href="/wiki/Category:REXX" title="Category:REXX">REXX</a></li>
         <li><a href="/wiki/Category:Ruby" title="Category:Ruby">Ruby</a></li>
         <li><a href="/wiki/Category:Scala" title="Category:Scala">Scala</a></li>
         <li><a href="/wiki/Category:Sidef" title="Category:Sidef">Sidef</a></li>
         <li><a href="/wiki/Category:Tcl" title="Category:Tcl">Tcl</a></li>
         <li><a href="/wiki/Category:Tk" title="Category:Tk">Tk</a></li>
         <li><a href="/wiki/Category:Vedit_macro_language" title="Category:Vedit macro language">Vedit macro language</a></li>
         <li><a href="/wiki/Category:Visual_Basic_.NET" title="Category:Visual Basic .NET">Visual Basic .NET</a></li>
         <li><a href="/wiki/Category:Zkl" title="Category:Zkl">Zkl</a></li>
         <li><a href="/wiki/Category:AWK/Omit" title="Category:AWK/Omit">AWK/Omit</a></li>
         <li><a href="/wiki/Category:Lotus_123_Macro_Scripting/Omit" title="Category:Lotus 123 Macro Scripting/Omit">Lotus 123 Macro Scripting/Omit</a></li>
         <li><a href="/wiki/Category:ML/I/Omit" title="Category:ML/I/Omit">ML/I/Omit</a></li>
         <li><a href="/wiki/Category:PARI/GP/Omit" title="Category:PARI/GP/Omit">PARI/GP/Omit</a></li>
         <li><a href="/wiki/Category:TI-83_BASIC/Omit" title="Category:TI-83 BASIC/Omit">TI-83 BASIC/Omit</a></li>
         <li><a href="/wiki/Category:TI-89_BASIC/Omit" title="Category:TI-89 BASIC/Omit">TI-89 BASIC/Omit</a></li>
        </ul>
       </div>
      </div> 
     </div> 
    </div> 
   </div> 
   <div class="row"> 
    <div class="col-lg-12"> 
     <nav class="navbar navbar-default p-tb " id="p-tb"> 
      <ul class="nav navbar-nav small"> 
       <li id="t-whatlinkshere"><a href="/wiki/Special:WhatLinksHere/Grayscale_image" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li> 
       <li id="t-recentchangeslinked"><a href="/wiki/Special:RecentChangesLinked/Grayscale_image" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li> 
       <li id="t-specialpages"><a href="/wiki/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li> 
       <li id="t-print"><a href="/mw/index.php?title=Grayscale_image&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li> 
       <li id="t-permalink"><a href="/mw/index.php?title=Grayscale_image&amp;oldid=237790" title="Permanent link to this revision of the page">Permanent link</a></li> 
       <li id="t-info"><a href="/mw/index.php?title=Grayscale_image&amp;action=info" title="More information about this page">Page information</a></li> 
       <li id="t-smwbrowselink"><a href="/wiki/Special:Browse/Grayscale_image" rel="smw-browse">Browse properties</a></li> 
      </ul> 
     </nav> 
    </div> 
   </div> 
   <div class="row"> 
    <div class="col-lg-12"> 
     <ul class="footer-info list-unstyled small" id="footer-info"> 
      <li> This page was last modified on 28 October 2016, at 01:14.</li> 
      <li>Content is available under <a class="external" rel="nofollow" href="http://www.gnu.org/licenses/fdl-1.2.html">GNU Free Documentation License 1.2</a> unless otherwise noted.</li> 
     </ul> 
    </div> 
   </div> 
   <div class="row"> 
    <div class="col-lg-6"> 
     <ul class="list-inline footer-places " id="footer-places"> 
      <li><small><a href="/wiki/Rosetta_Code:Privacy_policy" title="Rosetta Code:Privacy policy">Privacy policy</a></small></li> 
      <li><small><a href="/wiki/Rosetta_Code:About" title="Rosetta Code:About">About Rosetta Code</a></small></li> 
      <li><small><a href="/wiki/Rosetta_Code:General_disclaimer" title="Rosetta Code:General disclaimer">Disclaimers</a></small></li> 
     </ul> 
    </div> 
    <div class="col-lg-6"> 
     <ul class="list-inline pull-right footer-icons " id="footer-icons"> 
      <li><a href="http://www.gnu.org/licenses/fdl-1.2.html"><img src="/mw/resources/assets/licenses/gnu-fdl.png" alt="GNU Free Documentation License 1.2" width="88" height="31"></a></li> 
      <li><a href="//www.mediawiki.org/"><img src="/mw/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/mw/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /mw/resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"></a></li> 
      <li><a href="https://www.semantic-mediawiki.org/wiki/Semantic_MediaWiki"><img src="/mw/extensions/SemanticMediaWiki/includes/../resources/images/smw_button.png" alt="Powered by Semantic MediaWiki" width="88" height="31"></a></li> 
     </ul> 
    </div> 
   </div> 
  </div>
  <script>!function(e,t,r,n,c,a,l){function i(t,r){return r=e.createElement('div'),r.innerHTML='<a href="'+t.replace(/"/g,'&quot;')+'"></a>',r.childNodes[0].getAttribute('href')}function o(e,t,r,n){for(r='',n='0x'+e.substr(t,2)|0,t+=2;t<e.length;t+=2)r+=String.fromCharCode('0x'+e.substr(t,2)^n);return i(r)}try{for(c=e.getElementsByTagName('a'),l='/cdn-cgi/l/email-protection#',n=0;n<c.length;n++)try{(t=(a=c[n]).href.indexOf(l))>-1&&(a.href='mailto:'+o(a.href,t+l.length))}catch(e){}for(c=e.querySelectorAll('.__cf_email__'),n=0;n<c.length;n++)try{(a=c[n]).parentNode.replaceChild(e.createTextNode(o(a.getAttribute('data-cfemail'),0)),a)}catch(e){}}catch(e){}}(document);</script>
  <script type="text/rocketscript">window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.loader.state({"user":"ready","user.groups":"ready"});mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","ext.bootstrap.scripts"]);
} );</script> 
  <script type="text/rocketscript">
  var _gaq = _gaq || [];
  _gaq.push(["_setAccount", "UA-1219419-1"]);
  _gaq.push(["_trackPageview"]);

  (function() {
    var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;
    ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
    var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);
  })();

</script> 
  <script type="text/rocketscript">window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.config.set({"wgBackendResponseTime":647});
} );</script> 
 </body>
</html>