<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
  <title>Java Servlets - A Tutorial</title> 
  <link href="../css/programming_notes_v1.css" rel="stylesheet" type="text/css"> 
  <script type="text/javascript" src="../scripts/programming_notes_v1.js"></script> 
  <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
 </head> 
 <body> 
  <div id="wrap-outer"> 
   <!-- header filled by JavaScript --> 
   <div id="header" class="header-footer">
    <p>&nbsp;</p>
   </div> 
   <div id="wrap-inner"> 
    <div id="wrap-toc"> 
     <h5>TABLE OF CONTENTS <a id="show-toc" href="#show-toc">(HIDE)</a></h5> 
     <div id="toc"></div> 
     <!-- for showing the "Table of Content" --> 
    </div> 
    <div id="content-header"> 
     <h1>Java Server-Side Programming</h1> 
     <h2>Java Servlets</h2> 
    </div> 
    <div id="content-main"> 
     <h3>Introduction</h3> 
     <p>In the early days, web servers deliver <em>static</em> contents that are indifferent to users' requests. Java servlets are <em>server-side programs</em> (running inside a web server) that handle clients' requests and return a <em>customized</em> or <em>dynamic response</em> for each request. The dynamic response could be based on user's input (e.g., search, online shopping, online transaction) with data retrieved from databases or other applications, or time-sensitive data (such as news and stock prices).</p> 
     <p>Java servlets typically run on the HTTP protocol. HTTP is an <em>asymmetrical request-response protocol</em>. The client sends a <em>request message</em> to the server, and the server returns a <em>response message</em> as illustrated.</p> 
     <img class="image-center image-border" src="../howto/images/HTTP_ClientServerSystem.png" alt="HTTP_ClientServerSystem.png"> 
     <h5>Server-Side Technologies</h5> 
     <p>There are many (competing) server-side technologies available: Java-based (servlet, JSP, JSF, Struts, Spring, Hibernate), ASP, PHP, CGI Script, and many others.</p> 
     <p>Java servlet is the <em>foundation</em> of the Java server-side technology, JSP (JavaServer Pages), JSF (JavaServer Faces), Struts, Spring, Hibernate, and others, are extensions of the servlet technology.</p> 
     <h5>Pre-requisites</h5> 
     <p>HTML, Java Programming Language, HTTP and Apache Tomcat Server, SQL and MySQL Database System, and many others.</p> 
     <h5>Apache Tomcat Server</h5> 
     <p>Servlets are server-side programs run inside a <em>Java-capable</em> HTTP server. Apache Tomcat Server (@ <a href="http://tomcat.apache.org">http://tomcat.apache.org</a>) is the official Reference Implementation (RI) for Java servlet and JSP, provided free by open-source foundation Apache (@ <a href="http://www.apache.org">http://www.apache.org</a>).</p> 
     <p>You need to install Tomcat to try out Java servlets. Read "<a href="../howto/Tomcat_HowTo.html">How to Install Tomcat and Get Started Java Servlet Programming</a>".</p> 
     <p>I shall denote Tomcat's installed directory as <code>&lt;CATALINA_HOME&gt;</code>, and assume that Tomcat server is running in port 8080.</p> 
     <p>Tomcat provides many excellent servlet examples in "<code>&lt;CATALINA_HOME&gt;\webapps\examples\servlets</code>". You can run these examples by launching Tomcat and issuing URL <code>http://localhost:8080/examples</code>.</p> 
     <h5>Java Servlet Versions</h5> 
     <p>Java Servlet has these versions: [TODO features and what is new]</p> 
     <ul> 
      <li>J2EE 1.2 (December 12, 1999) (<strong>Java Servlet 2.2</strong>, JSP 1.1, EJB 1.1, JDBC 2.0)</li> 
      <li>J2EE 1.3 (September 24, 2001) (<strong>Java Servlet 2.3</strong>, JSP 1.2, EJB 2.0, JDBC 2.1)</li> 
      <li>J2EE 1.4 (November 11, 2003) (<strong>Java Servlet 2.4</strong>, JSP 2.0, EJB 2.1, JDBC 3.0)</li> 
      <li>Java EE 5 (May 11, 2006) (<strong>Java Servlet 2.5</strong>, JSP 2.1, JSTL 1.2, JSF 1.2, EJB 3.0, JDBC 3.0)</li> 
      <li>Java EE 6 (December 10, 2009) (<strong>Java Servlet 3.0</strong>, JSP 2.2/EL 2.2, JSTL 1.2, JSF 2.0, EJB 3.1, JDBC 4.0)</li> 
      <li>Java EE 7: expected in end of 2012.</li> 
     </ul> 
     <p>The Java Servlets Home Page is @ <a href="http://java.sun.com/products/servlet/">http://java.sun.com/products/servlet</a> (<a href="http://www.oracle.com/technetwork/java/javaee/servlet/index.html">http://www.oracle.com/technetwork/java/javaee/servlet/index.html</a>). For developers, check out the Servlet Developers @ <a href="http://java.net/projects/servlet/">http://java.net/projects/servlet/</a>.</p> 
     <p>Java Servlet is the <em>foundation</em> technology for Java server-side programming. You need to understand Servlet thoroughly before you could proceed to other Java server-side technologies such as JavaServer Pages (JSP) and JavaServer Faces (JSF).</p> 
     <h3>Review of HTTP</h3> 
     <p>A HTTP Servlet runs under the HTTP protocol. It is important to understanding the HTTP protocol in order to understand server-side programs (servlet, JSP, ASP, PHP, etc) running over the HTTP. Read "<a href="../webprogramming/HTTP_Basics.html">HTTP Basics</a>", if needed.</p> 
     <p>In brief, HTTP is a request-response protocol. The client sends a request message to the server. The server, in turn, returns a response message. The messages consists of two parts: header (information about the message) and body (contents). Header provides information about the messages. The data in header is organized in name-value pairs.</p> 
     <p>Read "<a href="../webprogramming/HTTP_Basics.html#http_mesages">HTTP Request and Response Messages</a>" for the format, syntax of request and response messages, and examples.</p> 
     <h3>First "Hello-world" Servlet</h3> 
     <p>Let us begin by writing a servlet that says hello in response to a client's request. We shall use JDK and Tomcat to understand the basics, instead of IDE such as Eclipse/NetBeans. Once you understand the basics, you should use Eclipse/NetBeans to develop your webapp for better productivity.</p> 
     <h4 id="helloservlet">Create a new Webapp "<span class="font-code">helloservlet</span>"</h4> 
     <p>We shall begin by defining a new webapp (web application) called "<code>helloservlet</code>" in Tomcat. A webapp, known as a <em>web context</em> in Tomcat, comprises a set of resources, such as HTML files, CSS, JavaScripts, images, programs and libraries.</p> 
     <img class="image-float-right" src="images/Servlet_HelloServletDirectory.png" alt="Servlet_HelloServletDirectory.png"> 
     <p> A Java webapp has a <em>standardized directory structure</em> for storing various types of resources.</p> 
     <p>Create a directory "<code>helloservlet</code>" under Tomcat's "<code>webapps</code>" directory (i.e., "<code>&lt;CATALINA_HOME&gt;\webapps\helloservlet</code>", where <code>&lt;CATALINA_HOME&gt;</code> denotes Tomcat's installed directory)<code></code>. Create sub-directories "<code>WEB-INF</code>" and "<code>META-INF</code>" under "<code>helloservlet</code>". Create sub-sub-directories "<code>classes</code>", "<code>lib</code>" and "<code>src</code>" under "<code>WEB-INF</code>". Take note that the directory names are case-sensitive.</p> 
     <p>The resources must be kept in the respective directories:</p> 
     <ul> 
      <li><span class="line-heading font-code">&lt;CATALINA_HOME&gt;\webapps\helloservlet</span>: This directory is known as <em>context root</em> for the web context "<code>helloservlet</code>". It contains the resources that are <em>accessible by the clients</em>, such as HTML, CSS, Scripts and images. These resources will be delivered to the clients <em>as it is</em>. You could create sub-directories such as <code>images</code>, <code>css</code> and <code>scripts</code>, to further categories the resources.</li> 
      <li><span class="line-heading font-code">&lt;CATALINA_HOME&gt;\webapps\helloservlet\WEB-INF</span>: This directory is NOT accessible by the clients directly. This is where you keep your application-specific configuration files (such as "<code>web.xml</code>"), and its sub-directories contain program classes, source files, and libraries. 
       <ul> 
        <li><span class="line-heading font-code">&lt;CATALINA_HOME&gt;\webapps\helloservlet\WEB-INF\src</span>: Keep the Java program source files. It is a good practice to separate the source files and classes to facilitate deployment.</li> 
        <li><span class="line-heading font-code">&lt;CATALINA_HOME&gt;\webapps\helloservlet\WEB-INF\classes</span>: Keep the Java classes (compiled from the source codes). Classes defined in packages must be kept according to the package directory structure.</li> 
        <li><span class="line-heading font-code">&lt;CATALINA_HOME&gt;\webapps\helloservlet\WEB-INF\lib</span>: keep the JAR files provided by external packages, available to this webapp only.</li> 
       </ul> </li> 
      <li><span class="line-heading font-code">&lt;CATALINA_HOME&gt;\webapps\helloservlet\META-INF</span>: This directory is also NOT accessible by the clients. It keeps resources and configurations (e.g., "<code>context.xml</code>") related to the particular server (e.g., Tomcat, Glassfish). In contrast, "<code>WEB-INF</code>" is for resources related to this webapp, independent of the server.</li> 
     </ul> 
     <h4>Write a Hello-world Java Servlet - "<span class="font-code">HelloServlet.java</span>"</h4> 
     <p>Servlets are Java programs that runs inside a Java-capable HTTP server. A user can invoke a servlet by issuing a specific URL from the browser (HTTP client). In this example, we shall write a servlet called "<code>HelloServlet.java</code>" and compiled into "<code>HelloServlet.class</code>". A client can invoke "<code>HelloServlet.class</code>" by issuing URL <code>http://hostname:port/helloServlet/sayhello</code> (i.e., "<code>sayhello</code>" relative to the webapp).</p> 
     <p>A servlet shall be kept inside a Java package (instead of the default <em>no-name</em> package) for proper deployment. Let's call our package "<code>mypkg</code>". Create a sub-directory called "<code>mypkg</code>" under "<code>WEB-INF\src</code>". Use a programming text editor to enter the following source codes, and save as "<code>HelloServlet.java</code>" in "<code>&lt;CATALINA_HOME&gt;</code>\<code>webapps\</code><code>helloservlet\WEB-INF\src\mypkg</code>".</p> 
     <table class="table-program"> 
      <colgroup>
       <col class="col-line-number"> 
       <col class="col-program"> 
      </colgroup>
      <tbody> 
       <tr> 
        <td> <pre class="text-right">
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre> </td> 
        <td> <pre>
<span class="color-comment">// To save as "&lt;CATALINA_HOME&gt;\webapps\helloservlet\WEB-INF\src\mypkg\HelloServlet.java"</span>
package mypkg;
 
import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;
 
public class <strong>HelloServlet</strong> extends HttpServlet {
   @Override
   public void <strong>doGet</strong>(HttpServletRequest <strong>request</strong>, HttpServletResponse <strong>response</strong>)
               throws IOException, ServletException {
      <span class="color-comment">// Set the response message's MIME type</span>
      response.setContentType("text/html;charset=UTF-8");
      <span class="color-comment">// Allocate a output writer to write the response message into the network socket</span>
      PrintWriter out = response.getWriter();
 
      <span class="color-comment">// Write the response message, in an HTML page</span>
      try {
         out.println("&lt;!DOCTYPE html&gt;");
         out.println("&lt;html&gt;&lt;head&gt;");
         out.println("&lt;meta http-equiv='Content-Type' content='text/html; charset=UTF-8'&gt;");
         out.println("&lt;title&gt;Hello, World&lt;/title&gt;&lt;/head&gt;");
         out.println("&lt;body&gt;");
         out.println("&lt;h1&gt;Hello, world!&lt;/h1&gt;");  <span class="color-comment">// says Hello</span>
         <span class="color-comment">// Echo client's request information</span>
         out.println("&lt;p&gt;Request URI: " + request.getRequestURI() + "&lt;/p&gt;");
         out.println("&lt;p&gt;Protocol: " + request.getProtocol() + "&lt;/p&gt;");
         out.println("&lt;p&gt;PathInfo: " + request.getPathInfo() + "&lt;/p&gt;");
         out.println("&lt;p&gt;Remote Address: " + request.getRemoteAddr() + "&lt;/p&gt;");
         <span class="color-comment">// Generate a random number upon each request</span>
         out.println("&lt;p&gt;A Random Number: &lt;strong&gt;" + <strong>Math.random()</strong> + "&lt;/strong&gt;&lt;/p&gt;");
         out.println("&lt;/body&gt;");
         out.println("&lt;/html&gt;");
      } finally {
         out.close();  <span class="color-comment">// Always close the output writer</span>
      }
   }
}</pre> </td> 
       </tr> 
      </tbody> 
     </table> 
     <h5>Dissecting the Program:</h5> 
     <ul> 
      <li>We define a Java class called <code>HelloServlet</code> (in Line 8). Line 2 places this class in a package called <code>mypkg</code>. Hence, we save the source file under "<code>mypkg</code>" of the "<code>helloservlet\WEB-INF\src</code>" directory, following the Java's standard package directory structure.</li> 
      <li>We need the Servlet API library to compile this program. Servlet API is not part of JDK or Java SE (but belongs to Java EE). Tomcat provides a copy of servlet API called <code>"servlet-api.jar</code>" in "<code>&lt;CATALINA_HOME&gt;\lib</code>". You could copy <code>"servlet-api.jar"</code> from "<code>&lt;CATALINA_HOME&gt;\lib</code>" to "<code>&lt;JAVA_HOME&gt;\jre\lib\ext</code>" (the JDK Extension Directory), or include the Servlet JAR file in your <code>CLASSPATH</code>.</li> 
      <li>To compile the program under JDK, we need to use the <code>-d</code> option to specify the output <em>destination</em> directory to place the compiled class in "<code>helloservlet\WEB-INF\class\mypkg</code>" directory. <pre class="color-command"><span class="color-comment">// Change directory to &lt;CATALINA_HOME&gt;\webapps\helloservlet\WEB-INF</span>
d:\...&gt; <strong>cd &lt;CATALINA_HOME&gt;\webapps\helloservlet\WEB-INF</strong>
<span class="color-comment">  
// Compile the source file and place the class in the specified destination directory</span>
d:\&lt;CATALINA_HOME&gt;\webapps\helloservlet\WEB-INF&gt; <strong>javac -d classes src\mypkg\HelloServlet.java</strong></pre> The option "<code>-d classes</code>" specifies the output destination directory, relative to the current directory. The output is <code>&lt;CATALINA_HOME&gt;\webapps\helloservlet\WEB-INF\<strong>classes\mypkg\HelloServlet.class</strong></code>. The compiler creates the package directory "<code>mypkg</code>" automatically.</li> 
      <li>We don't write a servlet from scratch. Instead, we create a servlet by sub-classing <code>javax.servlet.http.HttpServlet</code> (in Line 8).</li> 
      <li>As mentioned, a servlet is invoked in response to a request URL issued by a client. Specifically, a client issues an HTTP request, the server routes the request message to the servlet for processing. The servlet returns a response message to the client. </li> 
      <li>An HTTP request could use either GET or POST request methods, which will be processed by the servlet's <code>doGet()</code> or <code>doPost()</code> method, respectively.</li> 
      <li>In the <code>HelloServlet</code>, we override the <code>doGet()</code> method (as denoted by the annotation <code>@Override</code>). The <code>doGet()</code> runs in response to an HTTP GET request issued by a user via an URL. <code>doGet()</code> takes two arguments, an <code>HttpServletRequest</code> object and an <code>HttpServletResponse</code> object, corresponding to the request and response messages.</li> 
      <li>The <code>HttpServletRequest</code> object can be used to retrieve incoming HTTP <em>request headers</em> and <em>form data</em>. The <code>HttpServletResponse</code> object can be used to set the HTTP <em>response headers</em> (e.g., content-type) and the <em>response message body</em>.</li> 
      <li>In Line 13, we set the "MIME" type of the response message to "<code>text/html</code>". The client need to know the message type in order to correctly display the data received. (Other MIME types include <code>text/plain</code>, <code>image/jpeg</code>, <code>video/mpeg</code>, <code>application/xml</code>, and many others.) In Line 15, we retrieve a <code>Writer</code> object called <code>out</code> for writing the response message to the client over the network. We then use the <code>out.println()</code> to print out a proper HTML page containing the message "Hello, world!". This servlet also echoes some of the clients's request information, and prints a random number for each request.</li> 
     </ul> 
     <h4>Configure the Application Deployment Descriptor - "<span class="font-code">web.xml</span>"</h4> 
     <p>A web user invokes a servlet, which is kept in the web server, by issuing a specific URL from the browser. In this example, we shall configure the following request URL to trigger the "<code>HelloServlet</code>":</p> 
     <pre class="color-command">
http://<em>hostname</em>:<em>port</em>/<strong>helloservlet/sayhello</strong></pre> 
     <p>Create a configuration file called "<code>web.xml</code>", and save it under "<code>webapps\helloservlet\WEB-INF</code>", as follows:</p> 
     <table class="table-program"> 
      <colgroup>
       <col class="col-line-number"> 
       <col class="col-program"> 
      </colgroup>
      <tbody> 
       <tr> 
        <td> <pre class="text-right">
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre> </td> 
        <td> <pre>
&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;web-app version="3.0"
  xmlns="http://java.sun.com/xml/ns/javaee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"&gt;
 
  <span class="color-comment">&lt;!-- To save as &lt;CATALINA_HOME&gt;\webapps\helloservlet\WEB-INF\web.xml --&gt;</span>
 
   &lt;servlet&gt;
      &lt;servlet-name&gt;<strong>HelloWorldServlet</strong>&lt;/servlet-name&gt;
      &lt;servlet-class&gt;<strong>mypkg.HelloServlet</strong>&lt;/servlet-class&gt;
   &lt;/servlet&gt;
 
   <span class="color-comment">&lt;!-- Note: All &lt;servlet&gt; elements MUST be grouped together and
         placed IN FRONT of the &lt;servlet-mapping&gt; elements --&gt;</span>
 
   &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;<strong>HelloWorldServlet</strong>&lt;/servlet-name&gt;
      &lt;url-pattern&gt;<strong>/sayhello</strong>&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</pre> </td> 
       </tr> 
      </tbody> 
     </table> 
     <ul> 
      <li>The "<code>web.xml</code>" is called <em>web application deployment descriptor</em>. It provides the configuration options for that particular web application, such as defining the the <em>mapping</em> between URL and servlet class.</li> 
      <li>The above configuration defines a servlet named "<code>HelloWroldServlet</code>", implemented in "<code>mypkg.HelloServlet.class</code>" (written earlier), and maps to URL "<code>/sayhello</code>", where "<code>/</code>" denotes the context root of this webapp "<code>helloservlet</code>". In other words, the absolute URL for this servlet is <code>http://<em>hostname</em>:<em>port</em>/helloservlet<strong>/sayhello</strong></code>. <img class="image-center image-border" src="images/Servlet_HelloServletURL.png" alt="Servlet_HelloServletURL.png"> </li> 
      <li>Take note that EACH servlet requires a pair of <code>&lt;servlet&gt;</code> and <code>&lt;servlet-mapping&gt;</code> elements to do the mapping, via an arbitrary but unique <code>&lt;servlet-name&gt;</code>. Furthermore, all the <code>&lt;servlet&gt;</code> elements must be grouped together and placed before the <code>&lt;servlet-mapping&gt;</code> elements (as specified in the XML schema).</li> 
     </ul> 
     <h4>Run the Hello-world Servlet</h4> 
     <p>To run the servlet, first start the Tomcat server. Verify that the web context "<code>helloservlet</code>" has been deployed by observing the following messages in the Tomcat's console:</p> 
     <pre class="output">
xxx x, xxxx xx:xx:xx xx org.apache.catalina.startup.HostConfig deployDirectory
INFO: Deploying web application directory <strong>helloservlet</strong>
......</pre> 
     <p>Start a web browser (Firefox, IE or Chrome), and issue the following URL (as configured in the "<code>web.xml</code>"). Assume that Tomcat is running in port number 8080.</p> 
     <pre class="color-command">http://localhost:8080/helloservlet/sayhello</pre> 
     <p>We shall see the output "Hello, world!".</p> 
     <img class="image-center image-border" src="images/Servlet_HelloServletOutput.png" alt="Servlet_HelloServletOutput.png"> 
     <p>Try selecting "View Source" in your browser, which produces these output:</p> 
     <pre class="color-example">
&lt;!DOCTYPE html&gt;
&lt;html&gt;&lt;head&gt;
&lt;meta http-equiv='Content-Type' content='text/html; charset=UTF-8'&gt;
&lt;title&gt;Hello, World&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Hello, world!&lt;/h1&gt;
&lt;p&gt;Request URI: /helloservlet/sayhello&lt;/p&gt;
&lt;p&gt;Protocol: HTTP/1.1&lt;/p&gt;
&lt;p&gt;PathInfo: null&lt;/p&gt;
&lt;p&gt;Remote Address: 127.0.0.1&lt;/p&gt;
&lt;p&gt;A Random Number: &lt;strong&gt;0.4320795689818858&lt;/strong&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</pre> 
     <p>It is important to take note that users receive the <em>output</em> of the servlet. User does not receive the servlet's program codes, which are kept under a hidden directory "<code>WEB-INF</code>" and not directly accessible by web users.</p> 
     <br> 
     <p><span class="line-heading">Everything that can possibly go wrong will go wrong...</span> Read "<a href="../howto/ErrorMessages.html">Common Error Messages</a>". The likely errors are "404 File Not Found" and "500 Internal Server Error".</p> 
     <h3>Processing HTML Form Data</h3> 
     <h4>Write an HTML Form</h4> 
     <p>HTML provides a <code>&lt;form&gt;...&lt;/form&gt;</code> tag, which can be used to build a user input form containing elements such as text fields, password field, radio buttons, pull-down menu, checkboxes, text area, hidden field, submit and reset buttons. This allows web users to interact with the web server by submit data. For example,</p> 
     <img class="image-center" src="images/Servlet_SampleHTMLForm.png" alt="Servlet_SampleHTMLForm.png"> 
     <p>Create the following HTML script, and save as "<code>form_input.html</code>" under the context root "<code>helloservlet</code>".</p> 
     <table class="table-program"> 
      <colgroup>
       <col class="col-line-number"> 
       <col class="col-program"> 
      </colgroup>
      <tbody> 
       <tr> 
        <td> <pre class="text-right">
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre> </td> 
        <td> <pre>
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta http-equiv='Content-Type' content='text/html; charset=UTF-8'&gt;
  &lt;title&gt;User Input Form&lt;/title&gt;
&lt;/head&gt;
 
&lt;body&gt;
&lt;h2&gt;User Input Form&lt;/h2&gt;
<strong>&lt;form method="get" action="echo"&gt;</strong>
  &lt;fieldset&gt;
    &lt;legend&gt;Personal Particular&lt;/legend&gt;
    Name: <strong>&lt;input type="text" name="username" /&gt;</strong>&lt;br /&gt;&lt;br /&gt;
    Password: <strong>&lt;input type="password" name="password" /&gt;</strong>&lt;br /&gt;&lt;br /&gt;
    Gender: <strong>&lt;input type="radio" name="gender" value="m" checked /&gt;</strong>Male
    <strong>&lt;input type="radio" name="gender" value="f" /&gt;</strong>Female&lt;br /&gt;&lt;br /&gt;
    Age: <strong>&lt;select name = "age"&gt;
      &lt;option value="1"&gt;&amp;lt; 1 year old&lt;/option&gt;
      &lt;option value="99"&gt;1 to 99 years old&lt;/option&gt;
      &lt;option value="100"&gt;&amp;gt; 99 years old&lt;/option&gt;
    &lt;/select&gt;</strong>
  &lt;/fieldset&gt;
 
  &lt;fieldset&gt;
    &lt;legend&gt;Languages&lt;/legend&gt;
    <strong>&lt;input type="checkbox" name="language" value="java" checked /&gt;</strong>Java
    <strong>&lt;input type="checkbox" name="language" value="c" /&gt;</strong>C/C++
    <strong>&lt;input type="checkbox" name="language" value="cs" /&gt;</strong>C#
  &lt;/fieldset&gt;
 
  &lt;fieldset&gt;
    &lt;legend&gt;Instruction&lt;/legend&gt;
    <strong>&lt;textarea rows="5" cols="30" name="instruction"&gt;Enter your instruction here...&lt;/textarea&gt;</strong>
  &lt;/fieldset&gt;
 
  <strong>&lt;input type="hidden" name="secret" value="888" /&gt;
  &lt;input type="submit" value="SEND" /&gt;
  &lt;input type="reset" value="CLEAR" /&gt;</strong>
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</pre> </td> 
       </tr> 
      </tbody> 
     </table> 
     <p>Start the tomcat server. Issue the following URL to request for the HTML page:</p> 
     <pre class="color-command">
http://localhost:8080/helloservlet/<strong>form_input.html</strong></pre> 
     <h5>Explanation</h5> 
     <ul> 
      <li>The <code>&lt;fieldset&gt;...&lt;/fieldset&gt;</code> tag groups related elements and displays them in a box. The <code>&lt;legend&gt;...&lt;/legend&gt;</code> tag provides the legend for the box.</li> 
      <li>This HTML form (enclosed within <code>&lt;form&gt;...&lt;/form&gt;</code>) contains the following types of input elements: 
       <ol> 
        <li>Text field (<code>&lt;input type="text"&gt;</code>): for web users to enter text.</li> 
        <li>Radio buttons (<code>&lt;input type="radio"&gt;</code>): choose any one (and possibly none).</li> 
        <li>Pull-down menu (<code>&lt;select&gt;</code> and <code>&lt;option&gt;</code>): pull-down menu of options.</li> 
        <li>Checkboxes (<code>&lt;input type="checkbox"&gt;</code>): chose none or more.</li> 
        <li>Text area (<code>&lt;textarea&gt;...&lt;textarea&gt;</code>): for web users to enter multi-line text. (Text field for single line only.)</li> 
        <li>Hidden field (<code>&lt;input type="hidden"&gt;</code>): for submitting hidden <code>name=value</code> pair.</li> 
        <li>Submit button (<code>&lt;input type=submit&gt;</code>): user clicks this button to submit the form data to the server.</li> 
        <li>Reset button (<code>&lt;input type="reset"&gt;</code>): resets all the input field to their default value.</li> 
       </ol> Each of the input elements has an attribute "<code>name</code>", and an optional attribute "<code>value</code>". If an element is selected, its "<code>name=value</code>" pair will be submitted to the server for processing.</li> 
      <li>The &lt;form&gt; start-tag also specifies the URL for submission in the <code>action="<em>url</em></code>" attribute, and the request method in the <code>method="<span class="underline">get</span>|post"</code> attribute.</li> 
     </ul> 
     <br> 
     <p>For example, suppose that we enter "Alan Smith" in the text field, select "male", and click the "SEND" button, we will get a "404 page not found" error (because we have yet to write the processing script). BUT observe the destination URL:</p> 
     <pre class="color-command">
http://localhost:8080/helloservlet/echo<strong>?<span class="underline">username=Alan+Smith</span>&amp;<span class="underline">gender=m</span></strong>&amp;....</pre> 
     <p>Observe that:</p> 
     <ul> 
      <li>The URL <code>http://localhost:8080/helloservlet/echo</code> is retrieved from the attribute <code>action="echo"</code> of the <code>&lt;form&gt;</code> start-tag. <em>Relative</em> URL is used in this example. The <em>base</em> URL for the current page "<code>form_input.html</code>" is <code>http://localhost:8080/helloservlet/</code>. Hence, the relative URL "<code>echo</code>" resolves into <code>http://localhost:8080/helloservlet/echo</code>.</li> 
      <li>A <code>'?'</code> follows the URL, which separates the URL and the so-called <em>query string</em> (or <em>query parameters</em>, <em>request parameters</em>) followed.</li> 
      <li>The query string comprises the "<code>name=value</code>" pairs of the <em>selected</em> input elements (i.e., "<code>username=Alan+Smith</code>" and "<code>gender=m</code>"). The "<code>name=value</code>" pairs are separated by an <code>'&amp;'</code>. Also take note that the blank (in "<code>Alan Smith</code>") is replace by a <code>'+'</code>. This is because special characters are not permitted in the URL and have to be encoded (known as <em>URL-encoding)</em>. Blank is encoded as <code>'+'</code> (or <code>%20</code>). Other characters are encoded as <code>%<em>xx</em></code>, where <em><code>xx</code></em> is the ASCII code in hex. For example, <code>'&amp;'</code> as <code>%26</code>, <code>'?'</code> as <code>%3F</code>.</li> 
      <li> Some input elements such as checkboxes may trigger multiple parameter values, e.g., "<code>language=java&amp;language=c&amp;language=cs</code>" if all three boxes are checked.</li> 
      <li>HTTP provides two request methods: GET and POST. For GET request, the query parameters are appended behind the URL. For POST request, the query string are sent in the request message's body. POST request is often preferred, as users will not see the strange string in the URL and it can send an unlimited amount of data. The amount of data that can be sent via the GET request is limited by the length of the URL. The request method is specified in the <code>&lt;form method="<span class="underline">get</span>|post"...&gt;</code> start-tag. In this tutorial, we use the GET request, so that you can inspect the query string.</li> 
     </ul> 
     <h4>Write a Servlet to Process Form Data - "<span class="font-code">EchoServlet.java</span>"</h4> 
     <p>The form that we have written send its data to a server-side program having relative URL of "<code>echo</code>" (as specified in the <code>action="<em>url</em>"</code> attribute of the <code>&lt;form&gt;</code> start-tag). Let us write a servlet called <code>EchoServlet</code>, which shall be mapped to the URL "<code>echo</code>", to process the incoming form data. The servlet simply echoes the data back to the client.</p> 
     <p>Similar to the "<code>HelloServlet</code>", we define the "<code>EchoServlet</code>" under package "<code>mypkg</code>", and save the source file as "<code>&lt;CATALINA_HOME&gt;\webapps\helloservlet\WEB-INF\<strong>src\mypkg\EchoServlet.java</strong></code>".</p> 
     <table class="table-program"> 
      <colgroup>
       <col class="col-line-number"> 
       <col class="col-program"> 
      </colgroup>
      <tbody> 
       <tr> 
        <td> <pre class="text-right">
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153</pre> </td> 
        <td> <pre>
<span class="color-comment">// To save as "&lt;CATALINA_HOME&gt;\webapps\helloservlet\WEB-INF\src\mypkg\EchoServlet.java"</span>
package mypkg;
 
import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;
import java.util.*;
 
public class <strong>EchoServlet</strong> extends HttpServlet {
 
   @Override
   public void <strong>doGet</strong>(HttpServletRequest request, HttpServletResponse response)
               throws IOException, ServletException {
      <span class="color-comment">// Set the response message's MIME type</span>
      response.setContentType("text/html; charset=UTF-8");
      <span class="color-comment">// Allocate a output writer to write the response message into the network socket</span>
      PrintWriter out = response.getWriter();
 
      <span class="color-comment">// Write the response message, in an HTML page</span>
      try {
         out.println("&lt;!DOCTYPE html&gt;");
         out.println("&lt;html&gt;&lt;head&gt;");
         out.println("&lt;meta http-equiv='Content-Type' content='text/html; charset=UTF-8'&gt;");
         out.println("&lt;title&gt;Echo Servlet&lt;/title&gt;&lt;/head&gt;");
         out.println("&lt;body&gt;&lt;h2&gt;You have enter&lt;/h2&gt;");
 
         <span class="color-comment">// Retrieve the value of the query parameter "username" (from text field)</span>
         String username = <strong>request.getParameter("username")</strong>;
         <span class="color-comment">// Get null if the parameter is missing from query string.</span>
         <span class="color-comment">// Get empty string or string of white spaces if user did not fill in</span>
         if (username == null
               || (username = htmlFilter(username.trim())).length() == 0) {
            out.println("&lt;p&gt;Name: MISSING&lt;/p&gt;");
         } else {
            out.println("&lt;p&gt;Name: " + username + "&lt;/p&gt;");
         }
 
         <span class="color-comment">// Retrieve the value of the query parameter "password" (from password field)</span>
         String password = <strong>request.getParameter("password")</strong>;
         if (password == null
               || (password = htmlFilter(password.trim())).length() == 0) {
            out.println("&lt;p&gt;Password: MISSING&lt;/p&gt;");
         } else {
            out.println("&lt;p&gt;Password: " + password + "&lt;/p&gt;");
         }
 
         <span class="color-comment">// Retrieve the value of the query parameter "gender" (from radio button)</span>
         String gender = <strong>request.getParameter("gender")</strong>;
         <span class="color-comment">// Get null if the parameter is missing from query string.</span>
         if (gender == null) {
            out.println("&lt;p&gt;Gender: MISSING&lt;/p&gt;");
         } else if (gender.equals("m")) {
            out.println("&lt;p&gt;Gender: male&lt;/p&gt;");
         } else {
            out.println("&lt;p&gt;Gender: female&lt;/p&gt;");
         }
 
         <span class="color-comment">// Retrieve the value of the query parameter "age" (from pull-down menu)</span>
         String age = <strong>request.getParameter("age")</strong>;
         if (age == null) {
            out.println("&lt;p&gt;Age: MISSING&lt;/p&gt;");
         } else if (age.equals("1")) {
            out.println("&lt;p&gt;Age: &amp;lt; 1 year old&lt;/p&gt;");
         } else if (age.equals("99")) {
            out.println("&lt;p&gt;Age: 1 to 99 years old&lt;/p&gt;");
         } else {
            out.println("&lt;p&gt;Age: &amp;gt; 99 years old&lt;/p&gt;");
         }
 
         <span class="color-comment">// Retrieve the value of the query parameter "language" (from checkboxes).</span>
         <span class="color-comment">// Multiple entries possible.</span>
         <span class="color-comment">// Use getParameterValues() which returns an array of String.</span>
         String[] languages = <strong>request.getParameterValues("language")</strong>;
         <span class="color-comment">// Get null if the parameter is missing from query string.</span>
         if (languages == null || languages.length == 0) {
            out.println("&lt;p&gt;Languages: NONE&lt;/p&gt;");
         } else {
            out.println("&lt;p&gt;Languages: ");
            for (String language : languages) {
               if (language.equals("c")) {
                  out.println("C/C++ ");
               } else if (language.equals("cs")) {
                  out.println("C# ");
               } else if (language.equals("java")) {
                  out.println("Java ");
               }
            }
            out.println("&lt;/p&gt;");
         }
 
         <span class="color-comment">// Retrieve the value of the query parameter "instruction" (from text area)</span>
         String instruction = <strong>request.getParameter("instruction")</strong>;
         <span class="color-comment">// Get null if the parameter is missing from query string.</span>
         if (instruction == null
              || (instruction = htmlFilter(instruction.trim())).length() == 0
              || instruction.equals("Enter your instruction here...")) {
            out.println("&lt;p&gt;Instruction: NONE&lt;/p&gt;");
         } else {
            out.println("&lt;p&gt;Instruction: " + instruction + "&lt;/p&gt;");
         }
 
         <span class="color-comment">// Retrieve the value of the query parameter "secret" (from hidden field)</span>
         String secret = <strong>request.getParameter("secret")</strong>;
         out.println("&lt;p&gt;Secret: " + secret + "&lt;/p&gt;");
 
         <span class="color-comment">// Get all the names of request parameters</span>
         Enumeration names = <strong>request.getParameterNames()</strong>;
         out.println("&lt;p&gt;Request Parameter Names are: ");
         if (names.hasMoreElements()) {
            out.print(htmlFilter(names.nextElement().toString()));
         }
         do {
            out.print(", " + htmlFilter(names.nextElement().toString()));
         } while (names.hasMoreElements());
         out.println(".&lt;/p&gt;");
 
         <span class="color-comment">// Hyperlink "BACK" to input page</span>
         out.println("&lt;a href='form_input.html'&gt;BACK&lt;/a&gt;");
 
         out.println("&lt;/body&gt;&lt;/html&gt;");
      } finally {
         out.close();  <span class="color-comment">// Always close the output writer</span>
      }
   }
 
   <span class="color-comment">// Redirect POST request to GET request.</span>
   @Override
   public void <strong>doPost</strong>(HttpServletRequest request, HttpServletResponse response)
               throws IOException, ServletException {
      doGet(request, response);
   }
 
   <span class="color-comment">// Filter the string for special HTML characters to prevent</span>
   <span class="color-comment">// command injection attack</span>
   private static String <strong>htmlFilter</strong>(String message) {
      if (message == null) return null;
      int len = message.length();
      StringBuffer result = new StringBuffer(len + 20);
      char aChar;
 
      for (int i = 0; i &lt; len; ++i) {
         aChar = message.charAt(i);
         switch (aChar) {
             case '&lt;': result.append("&amp;lt;"); break;
             case '&gt;': result.append("&amp;gt;"); break;
             case '&amp;': result.append("&amp;amp;"); break;
             case '"': result.append("&amp;quot;"); break;
             default: result.append(aChar);
         }
      }
      return (result.toString());
   }
}</pre> </td> 
       </tr> 
      </tbody> 
     </table> 
     <h5>Dissecting the Program</h5> 
     <ul> 
      <li>The query string comprises <code>name=value</code> pairs. We can retrieve the query parameters from the request message (captured in <code>doGet()</code>'s argument <code>HttpServletRequest request</code>) via one of the following methods: <pre class="color-syntax">
request.getParameter("<em>paramName</em>")
  <span class="color-comment">// Returns the parameter value in a String.
  // Returns null if parameter name does not exist.
  // Returns the first parameter value for a multi-value parameter.</span>
 
request.getParameterValues("<em>paramName</em>")
  <span class="color-comment">// Return all the parameter values in a String[].
  // Return null if the parameter name does not exist.</span>
 
request.getParameterNames()
  <span class="color-comment">// Return all the parameter names in a java.util.Enumeration, possibly empty.</span></pre> </li> 
      <li>Take note that the parameter name is case sensitive.</li> 
      <li>We use <code>request.getParameter("<em>paramName</em>")</code> to retrieve the parameter value for most of the single-value input elements (such as text field, radio button, text area, etc). If the parameter is present (not <code>null</code>), we <code>trim()</code> the returned string to remove the leading and trailing white spaces.</li> 
      <li>We also replace the special HTML characters (<code>&gt;</code>, <code>&lt;</code>, <code>&amp;</code>, <code>"</code>) with the HTML escape sequences in the input strings, before we echo them back to the client via <code>out.println()</code>. This step is necessary to prevent the so-called <em>command-injection attack</em>, where user enters a script into the text field. The replacement is done via a <code>static</code> helper method <code>htmlFilter()</code>. [<br> Rule of thumb: Any text string taken from the client and echoing back via <code>out.println()</code> needs to be filtered!</li> 
      <li>If the parameter could possess multiple values (e.g., checkboxes), we use <code>request.getParameterValues()</code>, which returns an array of <code>String</code> or <code>null</code> if the parameter does not exist.</li> 
      <li>One of the nice features of Java servlet is that all the form data decoding (i.e., <em>URL-decoding</em>) is handled automatically. That is, <code>'+'</code> will be decoded to blank, <code>%<em>xx</em></code> decoded into the corresponding character.</li> 
     </ul> 
     <h4>Configure the Servlet URL mapping in "<span class="font-code">web.xml</span>"</h4> 
     <p>Our <code>&lt;form&gt;</code>'s <code>action</code> attribute refers to relative URL "<code>echo</code>", which has to be mapped to the <code>EchoServlet.class</code> in the web application deployment descriptor file "<code>WEB-INF\web.xml</code>":</p> 
     <pre class="color-example">
&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;web-app version="3.0"
  xmlns="http://java.sun.com/xml/ns/javaee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"&gt;
 
  <span class="color-comment">&lt;!-- To save as &lt;CATALINA_HOME&gt;\webapps\helloservlet\WEB-INF\web.xml --&gt;</span>
 
   &lt;servlet&gt;
      &lt;servlet-name&gt;HelloWorldServlet&lt;/servlet-name&gt;
      &lt;servlet-class&gt;mypkg.HelloServlet&lt;/servlet-class&gt;
   &lt;/servlet&gt;
 
   <span class="color-new">&lt;servlet&gt;
      &lt;servlet-name&gt;<strong>EchoServletExample</strong>&lt;/servlet-name&gt;
      &lt;servlet-class&gt;<strong>mypkg.EchoServlet</strong>&lt;/servlet-class&gt;
   &lt;/servlet&gt;</span>
 
   <span class="color-comment">&lt;!-- Note: All &lt;servlet&gt; elements MUST be grouped together and
         placed IN FRONT of the &lt;servlet-mapping&gt; elements --&gt;</span>
 
   &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;HelloWorldServlet&lt;/servlet-name&gt;
      &lt;url-pattern&gt;/sayhello&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;
 
   <span class="color-new">&lt;servlet-mapping&gt;
      &lt;servlet-name&gt;<strong>EchoServletExample</strong>&lt;/servlet-name&gt;
      &lt;url-pattern&gt;<strong>/echo</strong>&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;</span>
&lt;/web-app&gt;</pre> 
     <h4>Run the <span class="font-code">EchoServlet</span></h4> 
     <p>Start the Tomcat server. Issue URL <code>http://localhost:8080/helloservlet/form_input.html</code>. Fill up the form, click the submit button to trigger the servlet. Alternatively, you could issue a URL with query string.</p> 
     <h4>Form-Data Submission Methods: <span class="font-code">GET|POST</span></h4> 
     <p>Two request methods, GET and POST, are available for submitting form data, to be specified in the <code>&lt;form&gt;</code>'s attribute "<code>method=<span class="underline">GET</span>|POST</code>". GET and POST performs the same basic function. That is, gather the name-value pairs of the selected input elements, URL-encode, and pack them into a query string. However, in a GET request, the query string is appended behind the URL, separated by a <code>'?'</code>. Whereas in a POST request, the query string is kept in the request body (and not shown in the URL). The length of query string in a GET request is limited by the maximum length of URL permitted, whereas it is unlimited in a POST request. I recommend POST request for production, as it does not show the strange looking query string in the URL, even if the amount of data is limited. In this tutorial, I use GET method, so that you can inspect the query string on the URL.</p> 
     <p>To try out the POST request, modify the "<code>form_input.html</code>":</p> 
     <pre class="color-example">
&lt;form <span class="color-new"><strong>method="post"</strong></span> action="echo"&gt;
  ......
&lt;/form&gt;</pre> 
     <p> Inside the servlet, GET request is processed by the method <code>doGet()</code>, while POST request is processed by the method <code>doPost()</code>. Since they often perform identical operations, we re-direct <code>doPost()</code> to <code>doGet()</code> (or vice versa), as follows:</p> 
     <pre class="color-example">
public class MyServlet extends HttpServlet {
   <span class="color-comment">// doGet() handles GET request</span>
   @Override
   public void <strong>doGet</strong>(HttpServletRequest request, HttpServletResponse response)
               throws IOException, ServletException {
      ......
      ......
   }
   
   <span class="color-new"><span class="color-comment">// doPost() handles POST request</span>
   @Override
   public void <strong>doPost</strong>(HttpServletRequest request, HttpServletResponse response)
               throws IOException, ServletException {
      <strong>doGet(request, response);</strong>  <span class="color-comment">// call doGet()</span>
   }</span>
}</pre> 
     <h3>Request Header and Response Header</h3> 
     <p>HTTP is a request-response protocol. The client sends a request message to the server. The server, in turn, returns a response message. The request and response messages consists of two parts: header (information about the message) and body (contents). Header provides information about the messages. The data in header is organized in name-value pairs. Read "<a href="../webprogramming/HTTP_Basics.html#http_mesages">HTTP Request and Response Messages</a>" for the format, syntax of request and response messages.</p> 
     <h4><span class="font-code">HttpServletRequest</span></h4> 
     <p>The request message is encapsulated in an <code>HttpServletRequest</code> object, which is passed into the <code>doGet()</code> methods. <code>HttpServletRequest</code> provides many methods for you to retrieve the headers:</p> 
     <ul> 
      <li>General methods: <code>getHeader(<em>name</em>)</code>, <code>getHeaders(<em>name</em>)</code>, <code>getHeaderNames()</code>.</li> 
      <li>Specific methods: <code>getContentLength()</code>, <code>getContentType()</code>, <code>getCookies()</code>, <code>getAuthType()</code>, etc.</li> 
      <li>URL related: <code>getRequestURI()</code>, <code>getQueryString()</code>, <code>getProtocol()</code>, <code>getMethod()</code>.</li> 
     </ul> 
     <p>Example: Read "<a href="JavaServletExamples.html#ServletExample_RequestHeader">Request Header Example</a>".</p> 
     <h4><span class="font-code">HttpServletResponse</span></h4> 
     <p>The response message is encapsulated in the <code>HttpServletResponse</code>, which is passed into <code>doGet()</code> by reference for receiving the servlet output.</p> 
     <ul> 
      <li><code>setStatusCode(int statuscode)</code>, <code>sendError(int code, String message)</code>, <code>sendRedirect(url)</code>.</li> 
      <li><code>response.setHeader(String headerName, String headerValue)</code>. </li> 
      <li><code>setContentType(String mimeType)</code>, <code>setContentLength(int length)</code>, etc.</li> 
     </ul> 
     <p>Example: [TODO]</p> 
     <h3 id="Servlet_HTTPSession">Session Tracking</h3> 
     <p>HTTP is a <em>stateless</em> protocol. In other words, the current request does not know what has been done in the previous requests. This creates a problem for applications that runs over many requests, such as online shopping (or shopping cart). You need to maintain a so-called <em>session</em> to pass data among the multiple requests.</p> 
     <p>You can maintain a session via one of these three approaches:</p> 
     <ol> 
      <li>Cookie: A cookie is a small text file that is stored in the client's machine, which will be send to the server on each request. You can put your session data inside the cookie. The biggest problem in using cookie is clients may disable the cookie.</li> 
      <li>URL Rewriting: Passes data by appending a short text string at the end of every URL, e.g., <code>http://host/path/file.html<strong>;jsessionid=123456</strong></code>. You need to rewrite all the URLs (e.g., the "<code>action</code>" attribute of <code>&lt;form&gt;</code>) to include the session data.</li> 
      <li>Hidden field in an HTML form: pass data by using hidden field tag (<code>&lt;input type="hidden" name="session" value="...." /&gt;</code>). Again, you need to include the hidden field in all the pages.</li> 
     </ol> 
     <p>For detailed information, read "<a href="../webprogramming/HTTP_StateManagement.html">HTTP state and session management</a>".</p> 
     <h4><span class="font-code">HttpSession</span></h4> 
     <p>Programming your own session tracking (using the above approaches) is tedious and cumbersome. Fortunately, Java Servlet API provides a session tracking facility, via an interface called <code>javax.servlet.http.HttpSession</code>. It allows servlets to:</p> 
     <ul> 
      <li>View and manipulate information about a session, such as the session identifier, creation time, and last accessed time.</li> 
      <li>Bind objects to sessions, allowing user information to persist across multiple user requests.</li> 
     </ul> 
     <p>The procedure is as follows:</p> 
     <ol> 
      <li>Check if a session already exists. If so, use the existing session object; otherwise, create a new session object. Servlet API automates this step via the <code>getSession()</code> method of <code>HttpServletRequest</code>:<br> <pre class="color-example">
<span class="color-comment">// Retrieve the current session. Create one if not exists</span>
HttpSession session = request.getSession(true);
HttpSession session = request.getSession();  <span class="color-comment">// same as above</span>
 
<span class="color-comment">// Retrieve the current session. 
// Do not create new session if not exists but return null</span>
HttpSession session = request.getSession(false);</pre> The first statement returns the existing session if exists, and create a new <code>HttpSession</code> object otherwise. Each session is identified via a session ID. You can use <code>session.getID()</code> to retrieve the session ID string.<br> <code>HttpSession</code>, by default, uses cookie to pass the session ID in all the client's requests within a session. If cookie is disabled, <code>HttpSession</code> switches to URL-rewriting to append the session ID behind the URL. To ensure robust session tracking, all the URLs emitted from the server-side programs should pass thru the method <code>response.encodeURL(<em>url</em>)</code>. If cookie is used for session tracking, <code>encodeURL(<em>url</em>)</code> returns the <em><code>url</code></em> unchanged. If URL-rewriting is used, <code>encodeURL(<em>url</em>)</code> encodes the specified <code><em>url</em></code> by including the session ID.</li> 
      <li>The session object maintains data in the form of <em><code>key-value</code></em> pairs. You can use <code>session.getAttribute(<em>key</em>)</code> to retrieve the <em><code>value</code></em> of an existing key, <code>session.setAttribute(<em>key</em>, <em>value</em>)</code> to store new <em><code>key-value</code></em> pair, and <code>session.removeAttribute(<em>key</em>)</code> to remove an existing <em><code>key-value</code></em> pair. For example, <pre class="color-example">
<span class="color-comment">// Allocate a shopping cart (assume to be a list of String)</span>
List&lt;String&gt; shoppingCart = new ArrayList&lt;&gt;();
<span class="color-comment">// Populate the shopping cart</span>
shoppingCart.add("Item 1");
.....
<span class="color-comment">// Retrieve the current session, create one if not exists</span>
HttpSession session = request.getSession(true);
<span class="color-comment">// Place the shopping cart inside the session</span>
synchronized (session) {  <span class="color-comment">// synchronized to prevent concurrent updates</span>
   session.setAttribute("cart", shoppingCart);
}
.....</pre> Any page within the session can retrieve the shopping cart: <pre class="color-example">
<span class="color-comment">// Retrieve the current session, do not create new session</span>
HttpSession session = request.getSession(false);
if (session != null) {
   List&lt;String&gt; theCart = (List&lt;String&gt;)session.getAttribute("cart");
   if (theCart != null) {  <span class="color-comment">// cart exists?</span>
      for (String item : theCart) {
         ......
      }
   }
}</pre></li> 
      <li>You can use <code>session.invalidate()</code> to terminate and remove a session. You can use set <code>setMaxInactiveInterval()</code> and <code>getMaxInactiveInterval()</code> to set and get the inactive interval from the last client request, before the server invalidate the session.</li> 
     </ol> 
     <h4>Example</h4> 
     <p>The following servlet demonstrates the use of session, by counting the number of accesses within this session from a particular client. We also use <code>getID()</code> to retrieve the session ID, <code>getCreationTime()</code> and <code>getLastAccessedTime()</code> to get the session creation and last accessed times.</p> 
     <h5><span class="font-code">SessionServlet.java</span></h5> 
     <pre class="color-example">
<span class="color-comment">// To save as "&lt;CATALINA_HOME&gt;\webapps\helloservlet\WEB-INF\src\mypkg\SessionServlet.java"</span>
package mypkg;
 
import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;
import java.util.Date;
 
public class <strong>SessionServlet</strong> extends HttpServlet {
   @Override
   public void <strong>doGet</strong>(HttpServletRequest request, HttpServletResponse response)
               throws IOException, ServletException {
      <span class="color-comment">// Set the response message's MIME type</span>
      response.setContentType("text/html;charset=UTF-8");
      <span class="color-comment">// Allocate a output writer to write the response message into the network socket</span>
      PrintWriter out = response.getWriter();
 
      <span class="color-comment">// Return the existing session if there is one. Create a new session otherwise.</span>
      <strong>HttpSession session = request.getSession();</strong>
      Integer accessCount;
      synchronized(session) {
         accessCount = (Integer)<strong>session.getAttribute("accessCount")</strong>;
         if (accessCount == null) {
            accessCount = 0;   <span class="color-comment">// autobox int to Integer</span>
         } else {
            accessCount = new Integer(accessCount + 1);
         }
         <strong>session.setAttribute("accessCount", accessCount)</strong>;
      }
 
      <span class="color-comment">// Write the response message, in an HTML page</span>
      try {
         out.println("&lt;!DOCTYPE html&gt;");
         out.println("&lt;html&gt;");
         out.println("&lt;head&gt;&lt;meta http-equiv='Content-Type' content='text/html; charset=UTF-8'&gt;");
         out.println("&lt;title&gt;Session Test Servlet&lt;/title&gt;&lt;/head&gt;&lt;body&gt;");
         out.println("&lt;h2&gt;You have access this site " + <strong>accessCount</strong> + " times in this session.&lt;/h2&gt;");
         out.println("&lt;p&gt;(Session ID is " + <strong>session.getId()</strong> + ")&lt;/p&gt;");
 
         out.println("&lt;p&gt;(Session creation time is " +
               new Date(<strong>session.getCreationTime()</strong>) + ")&lt;/p&gt;");
         out.println("&lt;p&gt;(Session last access time is " +
               new Date(<strong>session.getLastAccessedTime()</strong>) + ")&lt;/p&gt;");
         out.println("&lt;p&gt;(Session max inactive interval  is " +
               <strong>session.getMaxInactiveInterval()</strong> + " seconds)&lt;/p&gt;");
 
         out.println("&lt;p&gt;&lt;a  href='" + <strong>request.getRequestURI()</strong> +  "'&gt;Refresh&lt;/a&gt;");
         out.println("&lt;p&gt;&lt;a  href='" + <strong>response.encodeURL(request.getRequestURI())</strong>  +
         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "'&gt;<strong>Refresh with  URL rewriting</strong>&lt;/a&gt;");
         out.println("&lt;/body&gt;&lt;/html&gt;");
      } finally {
         out.close();  <span class="color-comment">// Always close the output writer</span>
      }
   }
}</pre> 
     <h5><span class="font-code">web.xml</span></h5> 
     <pre class="color-example">
......
&lt;servlet&gt;
   &lt;servlet-name&gt;<strong>SessionTestServlet</strong>&lt;/servlet-name&gt;
   &lt;servlet-class&gt;<strong>mypkg.SessionServlet</strong>&lt;/servlet-class&gt;
&lt;/servlet&gt;
......
......
&lt;servlet-mapping&gt;
   &lt;servlet-name&gt;<strong>SessionTestServlet</strong>&lt;/servlet-name&gt;
   &lt;url-pattern&gt;<strong>/sessiontest</strong>&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</pre> 
     <h5>Running the Servlet</h5> 
     <p>You can use URL <code>http://localhost:8080/helloservlet/sessiontest</code> to access this servlet. Try refreshing the page. Try also closing and restart the browser, and issue the URL.</p> 
     <img class="image-center" src="images/Servlet_SessionOutput.png" alt="Servlet_SessionOutput.png"> 
     <p>Under Firefox, a cookie named <code>jsessionid</code> is created for this session. The value of the cookie is the same as the return value of <code>session.getID()</code>. By default, Servlet API uses a cookie for managing session, but will automatically switch into URL rewriting if cookie is disabled. To ensure robust session tracking, all the URLs emitted from the server-side programs should pass thru the method <code>response.encodeURL(<em>url</em>)</code>. If cookie is used for session tracking, <code>encodeURL(<em>url</em>)</code> returns the <em><code>url</code></em> unchanged. If URL-rewriting is used, <code>encodeURL(<em>url</em>)</code> encodes the specified <code><em>url</em></code> by including the session ID. The session data are kept in the server, only a session ID is passed to the client.</p> 
     <img class="image-center" src="images/Servlet_SessionCookie.png" alt="Servlet_SessionCookie.png"> 
     <p>Try disabling the cookie, and use (a) the refresh button (F5), (b) refresh and clear cache (Ctrl-F5), (c) the refresh link, and (d) the refresh with URL re-writing, to refresh the page.</p> 
     <h3><span class="font-code">ServletConfig</span> and <span class="font-code">ServletContext</span></h3> 
     <h5><span class="font-code">ServletConfig</span></h5> 
     <p><code>ServletConfig</code> is a servlet configuration object used by a servlet container (e.g., Tomcat, GlassFish) to pass information to a servlet during <em>initialization.</em> It is passed as the argument in the <code>init()</code> method. The init parameters are declared in the application-specific deployment descriptor "<code>web.xml</code>". You can retrieve the init parameters via <code>ServletConfig.getInitParam("paramName")</code> method. For example, suppose the application's "<code>web.xml</code>" declares these initialization parameters about database connection:</p> 
     <pre class="color-example">
&lt;web-app ...&gt;
  ...
  &lt;servlet&gt;
    ...
    &lt;init-param&gt;
      &lt;param-name&gt;<strong>databaseURL</strong>&lt;/param-name&gt;
      &lt;param-value&gt;<strong>jdbc:mysql://localhost:3306/ebookshop</strong>&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;<strong>user</strong>&lt;/param-name&gt;
      &lt;param-value&gt;<strong>myuser</strong>&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;<strong>password</strong>&lt;/param-name&gt;
      &lt;param-value&gt;<strong>xxxx</strong>&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/servlet&gt;
  ...
&lt;/web-app&gt;</pre> 
     <p>You can retrieve the init parameters in the servlet's <code>init()</code> method, as follow:</p> 
     <pre class="color-example">
@Override
public void <strong>init</strong>(ServletConfig config) throws ServletException {
   super.init(config);
   <span class="color-comment">// Read the init params and save them in web context for use by</span>
   <span class="color-comment">//  servlets and JSP within this web app.</span>
   <strong>ServletContext context = config.getServletContext();
   context.setAttribute("databaseURL", config.getInitParameter("databaseURL"));
   context.setAttribute("user", config.getInitParameter("user"));
   context.setAttribute("password", config.getInitParameter("password"));</strong>
   ......
}</pre> 
     <h5><span class="font-code">ServletContext</span></h5> 
     <p>Each <em>webapp</em> is represented in a single <em>context</em> within the servlet container (such as Tomcat, Glassfish). In Servlet API, this context is defined in <code>javax.servlet.ServletContext</code> interface (a better name is probably <code>WebappContext</code>). A webapp may use many servlets. Servlets deployed in the same webapp can share information between them using the shared <code>ServletContext</code> object.</p> 
     <p>There is one <code>ServletContext</code> per webapp (or web context). It can be retrieved via <code>ServletConfig.getServletContext()</code>. A servlet can use it to communicate with its servlet container (e.g., Tomcat, Glassfish), for example, to get the MIME type of a file, dispatch requests, or write to a log file. <code>ServletContext</code> has an "application" scope, and can also be used to pass information between servlets and JSPs within the same application, via methods <code>setAttribute("name", object)</code> and <code>getAttribute("name")</code>.</p> 
     <p>Example [TODO]</p> 
     <h3>Developing and Deploying Web Applications using IDE</h3> 
     <p>It is a lot more productive and efficient to use an IDE (such as Eclipse or NetBeans) to develop your web application. You could start/stop your servers from IDE directly. You could debug your web application in IDE, like debugging standalone application.</p> 
     <p><span class="line-heading">NetBeans</span>: Read "<a href="../howto/NetBeans_HowTo.html#NetBeans_WebApp">Developing and Deploying Web Applications in NetBeans</a>".</p> 
     <p><span class="line-heading">Eclipse</span>: Read "<a href="../howto/EclipseJava_HowTo.html#EclipseWebapp">Developing and Deploying Web Applications in Eclipse</a>".</p> 
     <h3>Tomcat's Servlet Examples</h3> 
     <p>Tomcat provides a number of <em>excellent</em> servlet examples in "<code>&lt;CATALINA_HOME&gt;\webapps\examples</code>". The servlet source files are kept under "<code>&lt;CATALINA_HOME&gt;\webapps\examples\WEB-INF\classes</code>", together with the compiled classes. To run the examples, start Tomcat server and issue URL <code>http://localhost:8080/examples</code>.</p> 
     <p>I strongly encourage you to study the examples, Read "<a href="JavaServletExamples.html">Tomcat's Java Servlet Examples Explained</a>".</p> 
     <h3>Database Servlet</h3> 
     <p>Read "<a href="JavaServletCaseStudy.html">Java Servlet Case Study</a>" and "<a href="JavaServletCaseStudyPart2.html">Java Servlet Case Study Continue</a>".</p> 
     <h3>Servlet API  A Deeper Look</h3> 
     <p>A servlet is a Java web component, managed by a servlet container (such as Apache Tomcat or Glassfish), which generates dynamic content in response to client's request. A servlet container (or servlet engine) is a web server extension which provides servlet functionality. A servlet container contains and manages servlets throughout their life cycle.</p> 
     <h4>Interface <span class="font-code">Servlet</span></h4> 
     <p>The <code>Servlet</code> interface is the central abstraction of the Java servlet API. <code>HttpServlet</code> - the most commonly servlet which handles HTTP requests, is a subclass of <code>GenericServlet</code> which implements <code>Servlet</code> interface.</p> 
     <p>The <code>Servlet</code> interface declares these <code>abstract</code> methods:</p> 
     <pre class="color-syntax">
<span class="color-comment">// Servlet's lifecycle</span>
void <strong>init</strong>(ServletConfig config)
void <strong>destroy</strong>()
void <strong>service</strong>(ServletRequest request, ServletResponse response)
 
<span class="color-comment">// Servlet configuration and information</span>
ServletConfig <strong>getServletConfig</strong>()
String <strong>getServletInfo</strong>()</pre> 
     <h4>A Servlet's Life cycle</h4> 
     <p>A servlet's life cycle is managed via the <code>init()</code>, <code>service()</code> and <code>destroy()</code> methods.</p> 
     <p><img class="image-center" src="images/Servlet_LifeCycle.png" alt="Servlet_LifeCycle.png"></p> 
     <h5>Loading and Initialization</h5> 
     <p>Servlet container (e.g., Tomcat or Glassfish) is responsible for loading and instantiating servlets.&nbsp; It may load and instantiate servlets when it is started, or delay until it determines that the servlet is needed to service a request (usually at the first request to the servlet).</p> 
     <p>The servlet container invokes the <code>init(ServletConfig)</code> method of the servlet, providing a <code>ServletConfig</code> object as an argument.&nbsp; <code>init()</code> runs only once.&nbsp; It is usually used to read persistent configuration data and initialize costly resource.</p> 
     <p>This <code>ServletConfig</code> object allows the servlet to access <em>initialization parameters</em> for this particular servlet. &nbsp;These parameters are defined in the <em>web application deployment descriptor file</em> (i.e., <code>web.xml</code>), under the servlet's name, as follows:</p> 
     <pre class="color-example">
&lt;servlet&gt;
   &lt;servlet-name&gt;<strong>ServletName</strong>&lt;/servlet-name&gt;
   &lt;servlet-class&gt;<strong>ServletClassFile</strong>&lt;/servlet-class&gt;
   &lt;init-param&gt;
      &lt;param-name&gt;initParam1&lt;/param-name&gt;
      &lt;param-value&gt;initParam1Value&lt;/param-value&gt;
   &lt;/init-param&gt;
   &lt;init-param&gt;
      &lt;param-name&gt;initParam2&lt;/param-name&gt;
      &lt;param-value&gt;initParam2Value&lt;/param-value&gt;
   &lt;/init-param&gt;
&lt;/servlet&gt;</pre> 
     <p>The <code>ServletConfig</code> interface defines these methods to retrieve the initialization parameters for this servlet.</p> 
     <pre class="color-syntax">
String <strong>getInitParameter</strong>(String name)
java.util.Enumeration <strong>getInitParameterNames</strong>()</pre> 
     <p>For example,</p> 
     <pre class="color-example">
public void init(ServletConfig config) throws ServletException {
   <span class="color-comment">// Read all the init parameters for this servlet</span>
   Enumeration e = config.getInitParameterNames();
   while (e.hasMoreElements()) {
      String initParamName = (String)e.nextElement();
      String initParamValue = config.getInitParameter(initParamName);
      ......
   }
}</pre> 
     <p>The <code>ServletConfig</code> interface is implemented by <code>HTTPServlet</code> and <code>GenericServlet</code>. Hence, the <code>getInitParameter()</code> and <code>getInitParameterNames()</code> method can be called directly within <code>init()</code> or <code>service()</code>.</p> 
     <p>The <code>ServletConfig</code> also gives servlet access to a <code>ServletContext</code> object that provides information about this web context (aka web application). <code>ServletContext</code> will be discussed later.</p> 
     <h5>In Service</h5> 
     <p>Once a servlet is initialized, the servlet container invokes its <code>service()</code> method to handle client requests. This method is called once for each request. Generally, the servlet container handle concurrent request to the same servlet by running <code>service()</code> on different threads (unless <code>SingleThreadModel</code> interface is declared).</p> 
     <p>For <code>HttpServlet</code>, <code>service()</code> dispatches <code>doGet()</code>, <code>doPost()</code>, <code>doHead()</code>, <code>doOptions()</code>, <code>doTrace()</code>, etc, to handle HTTP GET, POST, HEAD, OPTIONS, TRACE, etc, request respectively.</p> 
     <p>The <code>service()</code> method of an <code>HttpServlet</code> takes two arguments, an <code>HttpServletRequest</code> object and an <code>HttpServletResponse</code> object that corresponds to the HTTP request and response messages respectively.</p> 
     <h5>End of Service</h5> 
     <p>When the servlet container decides that a servlet should be removed from the container (e.g., shutting down the container or time-out, which is implementation-dependent), it calls the <code>destroy()</code> method to release any resource it is using and save any persistent state. Before the servlet container calls the <code>destroy()</code>, it must allow all <code>service()</code> threads to complete or time-out.</p> 
     <h4>Interface <span class="font-code">ServletContext</span></h4> 
     <p>The <code>ServletContext</code> interface defines a servlet's view of the webapp (or web context) in which it is running (a better name is actually <code>ApplicationContext</code>). Via the <code>ServletContext</code> object, a servlet can communicate with the container, e.g., write to event log, get the URL reference to resources, and get and set attributes that other servlets in the same context can access.</p> 
     <p>There is one <code>ServletContext</code> object for each web application deployed into a container. You can specify initialization parameters for a web context (that are available to all the servlet under the web context) in the web application deployment descriptor, e.g.,</p> 
     <pre class="color-example">
&lt;web-app ......&gt;
  &lt;context-param&gt;
    &lt;param-name&gt;jdbcDriver&lt;/param-name&gt;
    &lt;param-value&gt;com.mysql.jdbc.Driver&lt;/param-value&gt;
  &lt;/context-param&gt;
  &lt;context-param&gt;
    &lt;param-name&gt;databaseUrl&lt;/param-name&gt;
    &lt;param-value&gt;jdbc:mysql://localhost/eshop&lt;/param-value&gt;
  &lt;/context-param&gt;
......
&lt;/web-app&gt;</pre> 
     <p>Servlets under this web context can access the context's initialization parameters via the <code>ServletConfig</code>'s methods:</p> 
     <pre class="color-syntax">
<span class="color-comment">// ServletConfig</span>
String <strong>getInitParameter</strong>(String name)
java.util.Enumeration <strong>getInitParameterNames</strong>()</pre> 
     <p>A servlet can bind an attribute of name-value pair into the <code>ServletContext</code>, which will then be available to other servlet in the same web application. The methods available are:</p> 
     <pre class="color-syntax">
<span class="color-comment">// ServletContext</span>
Object <strong>getAttribute</strong>(String name)
void <strong>setAttribute</strong>(String name, Object value)
void <strong>removeAttribute</strong>(String name)
java.util.Enumeration <strong>getAttributeNames</strong>()</pre> 
     <p>Other methods in <code>ServletContext</code> are:</p> 
     <pre class="color-syntax">
<span class="color-comment">// Write message to event log</span>
void log(String message)
<span class="color-comment">// Get container info</span>
String <strong>getServerInfo</strong>()
int <strong>getMajorVersion</strong>()
int <strong>getMinorVersion</strong>()</pre> 
     <p>The <code>ServletContext</code> provides direct access to static content of the web application (such as HTML, GIF files), via the following methods:</p> 
     <pre class="color-syntax">
java.net.URL <strong>getResource</strong>(String path)
java.io.InputStream <strong>getResourceAsStream</strong>(String path)</pre> 
     <h4>Dispatch Request - <span class="font-code">RequestDispatcher</span></h4> 
     <p>When building a web application, it is often useful to forward a request to another servlet, or to include the output of another servlet in the response. The <code>RequestDispatcher</code> interface supports these. The <code>RequestDispatcher</code> can be obtained via <code>ServletContext</code>:</p> 
     <pre class="color-syntax">
<span class="color-comment">// ServletContext</span>
RequestDispatcher <strong>getRequestDispatcher</strong>(String servletPath)
RequestDispatcher <strong>getNamedDispatcher</strong>(String servletName)</pre> 
     <p>Once the servlet obtained a <code>RequestDispatcher</code> of another servlet within the same web application, it could include or forward the request to that servlet, e.g.,</p> 
     <pre class="color-example">
RequestDispatcher rd = context.getRequestDispatcher("/test.jsp?isbn=123");
rd.<strong>include</strong>(request, response);
<span class="color-comment">// or</span>
rd.<strong>forward</strong>(request, response);</pre> 
     <h4>Filtering</h4> 
     <p>A filter is a reusable piece of code that can transform the content of HTTP requests, responses, and header information. Examples of filtering components are:</p> 
     <ul> 
      <li>Authentication filters</li> 
      <li>Logging and auditing filters</li> 
      <li>Image conversion filters</li> 
      <li>Data compression filters</li> 
      <li>Encryption filters</li> 
      <li>Tokenizing filters</li> 
      <li>Filters that trigger resource access events</li> 
      <li>XSL/T filters that transform XML content</li> 
      <li>MIME-type chain filters</li> 
      <li>Caching filters</li> 
     </ul> 
     <p>[TODO] more</p> 
     <h3>Web Application Deployment Descriptor "<span class="font-code">web.xml</span>"</h3> 
     <p>The "<code>web.xml</code>" contains the web application <em>deployment descriptors</em>. Tomcat's has a system-wide (global) "<code>web.xml</code>" in "<code>&lt;CATALINA_HOME&gt;\conf</code>". Each web application has its own "<code>web.xml</code>" in "<em><code>ContextRoot</code></em><code>\WEB-INF</code>", which overrides the global settings. Tomcat monitors <code>web.xml</code> for all web applications and reloads the web application when <code>web.xml</code> changes, if <code>reloadable</code> is set to <code>true</code>.</p> 
     <h4>A Sample "<span class="font-code">web.xml</span>"</h4> 
     <table class="table-program"> 
      <colgroup>
       <col class="col-line-number"> 
       <col class="col-program"> 
      </colgroup>
      <tbody> 
       <tr> 
        <td> <pre class="text-right">
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></td> 
        <td><pre>
&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;web-app version="3.0"
  xmlns="http://java.sun.com/xml/ns/javaee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"&gt;
   
<span class="color-comment">  &lt;!-- General Description of the web application --&gt;</span>
   &lt;display-name&gt;Workshop Continue&lt;/display-name&gt;
   &lt;description&gt;We shall continue our e-bookstore...&lt;/description&gt;
 
   <span class="color-comment">&lt;!-- Context initialization parameters --&gt;
   &lt;!-- Provide the database related parameters --&gt;</span>
   &lt;context-param&gt;
      &lt;param-name&gt;jdbcDriver&lt;/param-name&gt;
      &lt;param-value&gt;com.mysql.jdbc.Driver&lt;/param-value&gt;
   &lt;/context-param&gt;
   &lt;context-param&gt;
      &lt;param-name&gt;databaseUrl&lt;/param-name&gt;
      &lt;param-value&gt;jdbc:mysql://localhost/eshop&lt;/param-value&gt;
   &lt;/context-param&gt;
 
   <span class="color-comment">&lt;!-- Define servlets --&gt;</span>
   &lt;servlet&gt;
       &lt;servlet-name&gt;BookQuery&lt;/servlet-name&gt;
       &lt;servlet-class&gt;BookQueryServlet&lt;/servlet-class&gt;
       &lt;init-param&gt;
         &lt;param-name&gt;popularAuthor&lt;/param-name&gt;
         &lt;param-value&gt;Kelvin Jones&lt;/param-value&gt;
       &lt;/init-param&gt;
   &lt;/servlet&gt;
 
   <span class="color-comment">&lt;!-- Define servlet's URL mapping --&gt;</span>
   &lt;servlet-mapping&gt;
       &lt;servlet-name&gt;BookQuery&lt;/servlet-name&gt;
       &lt;url-pattern&gt;/query&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;
 
   &lt;session-config&gt;
     &lt;session-timeout&gt;30&lt;/session-timeout&gt;
   &lt;/session-config&gt;
 
   &lt;mime-mapping&gt;
     &lt;extension&gt;pdf&lt;/extension&gt;
     &lt;mime-type&gt;application/pdf&lt;/mime-type&gt;
   &lt;/mime-mapping&gt;
 
   <span class="color-comment">&lt;!-- For directory request --&gt;</span>
   &lt;welcome-file-list&gt;
     &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
     &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
     &lt;welcome-file&gt;index.htm&lt;/welcome-file&gt;
   &lt;/welcome-file-list&gt;
 
   &lt;error-page&gt;
     &lt;error-code&gt;404&lt;/error-code&gt;
     &lt;location&gt;/404.html&lt;/location&gt;
   &lt;/error-page&gt;
&lt;/web-app&gt;</pre> </td> 
       </tr> 
      </tbody> 
     </table> 
     <h4>Syntax for "<span class="font-code">web.xml</span>"</h4> 
     <h5>Servlets 3.0 "<span class="font-code">web.xml</span>" Syntax</h5> 
     <p>Tomcat 7 and Glassfish 3.1 supports Servlet 3.0.</p> 
     <pre class="color-syntax">
&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;web-app <strong>version="3.0"</strong>
      xmlns="http://java.sun.com/xml/ns/javaee"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"
      metadata-complete="true"&gt;
  ......
&lt;/web-app&gt;</pre> 
     <h5>Servlets 2.5 "<span class="font-code">web.xml</span>" Syntax</h5> 
     <p>Tomcat 6 and Glassfish 3 supports Servlets 2.5, JSP 2.1 and JSF 2.0.</p> 
     <pre class="color-syntax">
&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;web-app <strong>version="2.5"</strong>
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns="http://java.sun.com/xml/ns/javaee"
      xmlns:web="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
      xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"&gt;
   .......
&lt;/web-app&gt;</pre> 
     <h5>Servlets 2.4 "<span class="font-code">web.xml</span>" Syntax</h5> 
     <pre class="color-syntax">
&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;web-app <strong>version="2.4"</strong>
      xmlns="http://java.sun.com/xml/ns/j2ee"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"&gt;
   .......
&lt;/web-app&gt;</pre> 
     <h4>Servlet Deployment Descriptor</h4> 
     <p>To deploy a servlet, you need to write one pair of <code>&lt;servlet&gt;</code> and <code>&lt;servlet-mapping&gt;</code> elements, with a matching (but arbitrary and unique) <code>&lt;servlet-name&gt;</code>. The <code>&lt;servlet-class&gt;</code> specifies the fully-qualified name of the servlet class. The <code>&lt;url-pattern&gt;</code> specifies the URL. For example,</p> 
     <pre class="color-example">
&lt;web-app ...&gt;
  &lt;servlet&gt;
    &lt;servlet-name&gt;<strong>ServletName</strong>&lt;/servlet-name&gt;
    &lt;servlet-class&gt;<strong>mypkg.MyServlet</strong>&lt;/servlet-class&gt;
  &lt;/servlet&gt;

  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;<strong>ServletName</strong>&lt;/servlet-name&gt;
    &lt;url-pattern&gt;<strong>/MyURL</strong>&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</pre> 
     <p>The resultant URL is <code>http://<em>hostname</em>:<em>port</em>/<em>WebContext</em><strong>/MyURL</strong></code>.</p> 
     <p>You can use wildcard '<code>*</code>' in the <code>&lt;url-pattern&gt;</code> for pattern matching. For example, <code>/MyURL.*</code> (which is matched by <code>/MyURL.html</code> and etc.), <code>/MyURL/*</code> (which is matched by <code>/MyURL/test</code>, and etc.)</p> 
     <p>Always use a custom URL for servlet, as you could choose a short and meaningful URL and include initialisation. parameters, filter, security setting in the deployment descriptor (see the next section).</p> 
     <h4>Servlet Initialization Parameters</h4> 
     <p>You can pass <em>initialization parameters</em> in the form of <em><code>name-value</code></em> pairs into a particular servlet from "<code>web.xml</code>". For example,</p> 
     <pre class="color-example">
&lt;web-app ...&gt;
  &lt;servlet&gt;
    &lt;servlet-name&gt;ServletName&lt;/servlet-name&gt;
    &lt;servlet-class&gt;mypkg.MyServlet&lt;/servlet-class&gt;
    <strong>&lt;init-param&gt;
      &lt;param-name&gt;debug&lt;/param-name&gt;
      &lt;param-value&gt;false&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;listing&lt;/param-name&gt;
      &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/init-param&gt;</strong>
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;ServletName&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/MyURL&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</pre> 
     <p>Inside the servlet, you can retrieve the init parameters via the <code>ServletConfig</code> object:</p> 
     <pre class="color-example">
package <strong>mypkg</strong>;
public class <strong>MyServlet</strong> extends HttpServlet {
  
   private boolean debug = false, listing = false;
   
   @Override
   public void <strong>init()</strong> {
      <strong>ServletConfig config = getServletConfig();</strong>
      String strDebug = <strong>config.getInitParameter("debug")</strong>;
      if (strDebug.equals("true")) debug = true;
      String strListing = <strong>config.getInitParameter("listing")</strong>;
      if (strListing.equals("true")) listing = true;
   }
   ......
}</pre> 
     <h4>Application Initialization Parameters</h4> 
     <p>Specified in webapp's "<code>WEB-INF\web.xml</code>", and available to all the servlets under this webapp. You can use the <code>getInitParameter()</code> method of <code>ServletContext</code> object to retrieve the init parameters.</p> 
     <pre class="color-example">
&lt;web-app ......&gt;
  &lt;context-param&gt;
    &lt;param-name&gt;email&lt;/param-name&gt;
    &lt;param-value&gt;query@abcde.com&lt;/param-value&gt;
  &lt;/context-param&gt;
  ......
&lt;/web-app&gt;</pre> 
     <h4>Server-wide Initialization Parameters</h4> 
     <p>Similar to application init parameters, but defined in the global "<code>&lt;CATALINA_HOME&gt;\conf\web.xml</code>".</p> 
     <pre class="color-example">
&lt;context-param&gt;
  &lt;param-name&gt;email&lt;/param-name&gt;
  &lt;param-value&gt;query@abcde.com&lt;/param-value&gt;
&lt;/context-param&gt;</pre> 
     <p>Use the <code>getInitParameter()</code> method of <code>ServletContext</code> object to retrieve the init parameters.</p> 
     <h4>Welcome Page</h4> 
     <p>Specifies the page to be displayed for request to web context root. For example,</p> 
     <pre class="color-example">
&lt;web-app ...&gt;
  ......
  &lt;welcome-file-list&gt;
    &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
    &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
    &lt;welcome-file&gt;test/index.html&lt;/welcome-file&gt;
  &lt;/welcome-file-list&gt;
&lt;/web-app&gt;</pre> 
     <h3>Servlet 3.0</h3> 
     <p>Servlet API 3.0 introduces these annotations to simplify deployment in <code>javax.servlet.annotation</code> package:</p> 
     <ul> 
      <li><code>@WebServlet</code>: Define a servlet component</li> 
      <li><code>@WebInitParam</code>: Define initialization parameters for a servlet</li> 
      <li><code>@WebListener</code>: Define a listener</li> 
      <li><code>@WebFilter</code>: Define a filter</li> 
      <li><code>@MultipartConfig</code>: For multipart file upload</li> 
     </ul> 
     <p>For example,</p> 
     <pre class="color-example">
<strong>@WebServlet(
    name = "HelloServletExample",
    urlPatterns = {"/sayhello"},
    initParams = {
        @WebInitParam(name = "param1", value = "value1"),
        @WebInitParam(name = "param2", value = "value2")}
)</strong>
public class HelloServlet extends HttpServlet { ...... }</pre> 
     <p>The above is equivalent to the following configuration in "<code>web.xml</code>" prior to Servlet 3.0. The web application deployment descriptor "<code>web.xml</code>" has become optional in Servlet 3.0. Instead, the container at run time will process the annotations of the classes in <code>WEB-INF/classes</code> and JAR files in <code>lib</code> directory.</p> 
     <pre class="color-example">
<span class="color-comment">// web.xml</span>
&lt;servlet&gt;
  &lt;servlet-name&gt;HelloServletExample&lt;/servlet-name&gt;
  &lt;servlet-class&gt;hello.HelloServlet&lt;/servlet-class&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;param1&lt;/param-name&gt;
    &lt;param-value&gt;value1&lt;/param-value&gt;
  &lt;/init-param&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;param2&lt;/param-name&gt;
    &lt;param-value&gt;value2&lt;/param-value&gt;
  &lt;/init-param&gt;
&lt;/servlet&gt;
 
&lt;servlet-mapping&gt;
  &lt;servlet-name&gt;HelloServletExample&lt;/servlet-name&gt;
  &lt;url-pattern&gt;/sayhello&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
</pre> 
     <h4><span class="font-code">@WebServlet</span></h4> 
     <p><code>@WebServlet</code> defines a servlet component and its metadata, with the following attributes:</p> 
     <ul> 
      <li><code>String[] urlPatterns</code>: An array of String declaring the <code>url-pattern</code> for <code>servlet-mapping</code>. Default is an empty array <code>{}</code>.</li> 
      <li><code>String[] value</code>: <code>urlPatterns</code>.</li> 
      <li><code>String name</code>: <code>servlet-name</code>, default is empty string <code>""</code>.</li> 
      <li><code>loadOnStartup</code>: The <code>load-on-startup</code> order of the servlet, default is -1.</li> 
      <li><code>WebInitParam[] initParams</code>: The init parameters of the servlet, default is an empty array <code>{}</code>.</li> 
      <li><code>boolean asyncSupported</code>: Declares whether the servlet supports asynchronous operation mode, default is false.</li> 
      <li><code>String smallIcon</code>, <code>String largeIcon</code>, <code>String description</code>: icon and description of the servlet.</li> 
     </ul> 
     <p>Example:</p> 
     <pre class="color-example"><span class="color-example"><strong>@WebServlet("/sayHello") </strong>public class Hello1Servlet extends HttpServlet { ...... }</span>
  <span class="color-comment">// One URL pattern</span>
  
<span class="color-example"><strong>@WebServlet(urlPatterns = {"/sayhello", "/sayhi"}) </strong>public class Hello2Servlet extends HttpServlet { ...... }</span>
  <span class="color-comment">// More than one URL patterns</span> </pre> 
     <h4><span class="font-code">@WebInitParam</span></h4> 
     <p><code>@WebInitParam</code> is Used to declare init params in servlet, with the following attributes:</p> 
     <ul> 
      <li><code>String name</code> and <code>String value</code> (required): Declare the name and value of the init parameter.</li> 
      <li><code>String description</code> (optional) description, default empty string <code>""</code>.</li> 
     </ul> 
     <p>See the above example.</p> 
     <h4><span class="font-code">@WebFilter</span></h4> 
     <p><code>@WebFilter</code> defines a filter (which implements <code>javax.servlet.Filter</code> interface). </p> 
     <p>For example, the following filter log the request time for all the requests (<code>urlPattern="/*"</code>).</p> 
     <table class="table-program"> 
      <colgroup>
       <col class="col-line-number"> 
       <col class="col-program"> 
      </colgroup>
      <tbody> 
       <tr> 
        <td> <pre class="text-right">
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre> </td> 
        <td> <pre>
package mypkg;
 
import java.io.*;
import java.util.logging.Logger;
import javax.servlet.*;
import javax.servlet.annotation.*;
import javax.servlet.http.*;
 
<strong>@WebFilter(urlPatterns={"/*"})</strong>
public class RequestTimerFilter implements Filter {
   private static final Logger logger
           = Logger.getLogger(RequestTimerFilter.class.getName());
 
   @Override
   public void init(FilterConfig config) throws ServletException {
      logger.info("RequestTimerFilter initialized");
   }
 
   @Override
   public void doFilter(ServletRequest request, ServletResponse response,
           FilterChain chain)
           throws IOException, ServletException {
      long before = System.currentTimeMillis();
      chain.doFilter(request, response);
      long after = System.currentTimeMillis();
      String path = ((HttpServletRequest)request).getRequestURI();
      logger.info(path + ": " + (after - before) + " msec");
   }
 
   @Override
   public void destroy() {
      logger.info("RequestTimerFilter destroyed");
   }
}</pre> </td> 
       </tr> 
      </tbody> 
     </table> 
     <h4><span class="font-code">@WebListener</span></h4> 
     <p><code>@WebListener</code> defines a listener (which extends <code>ServletContexListner</code>, <code>ServletRequestListner</code> or <code>HttpSessionListner</code>). For example,</p> 
     <pre class="color-example">
<strong>@WebListener()</strong>
public class MyContextListner extends ServletContextListner { ...... }</pre> 
     <h4><span class="font-code">@MultipartConfig</span></h4> 
     <p>For uploading file using <code>multipart/form-data</code> POST Request. Read "<a href="JavaServletCaseStudyPart2.html#FileUpload">Uploading Files in Servlet 3.0</a>".</p> 
     <p class="references">REFERENCES &amp; RESOURCES</p> 
     <ol> 
      <li>Java Servlets Home Page @ <a href="http://java.sun.com/products/servlet/">http://java.sun.com/products/servlet</a>. Servlet Developers @ <a href="http://java.net/projects/servlet/">http://java.net/projects/servlet/</a>.</li> 
      <li>Java Servlet 2.2, 2.3, 2.4, 2.5, 3.0 API Specifications.</li> 
      <li>Apache Tomcat Server @ <a href="http://tomcat.apache.org/">http://tomcat.apache.org</a>.</li> 
      <li>RFC2616 "Hypertext Transfer Protocol HTTP 1.1", W3C, June 1999.</li> 
      <li>HTML 4.01 Specification, W3C Recommendation, 24 Dec 1999 @ <a href="http://www.w3.org/TR/html401/">http://www.w3.org/TR/html401</a>, and HTML 5 Draft Specification @ <a href="http://www.w3.org/TR/html5/">http://www.w3.org/TR/html5</a>.</li> 
      <li>The Java EE 6 Tutorial, Chapter 10 Java Servlet Technology, December 2009 @ <a href="http://java.sun.com/javaee/6/docs/tutorial/doc/bnafd.html">http://java.sun.com/javaee/6/docs/tutorial/doc/bnafd.html</a>.</li> 
      <li>The Java EE 5 Tutorial, Chapter 4 Java Servlet Technology, October 2008 @ <a href="http://java.sun.com/javaee/5/docs/tutorial/doc/bnafd.html">http://java.sun.com/javaee/5/docs/tutorial/doc/bnafd.html</a>.</li> 
      <li>The J2EE 1.4 Tutorial, Chapter 11 Java Servlet Technology, December, 2005 @ <a href="http://java.sun.com/j2ee/1.4/docs/tutorial/doc/">http://java.sun.com/j2ee/1.4/docs/tutorial/doc/</a>.</li> 
      <li>The J2EE 1.3 Tutorial "Java Servlet Technology" @ <a href="http://java.sun.com/j2ee/tutorial/1_3-fcs/doc/Servlets.html">http://java.sun.com/j2ee/tutorial/1_3-fcs/doc/Servlets.html</a>.</li> 
      <li>Java EE 6 Technologies @ <a href="http://www.oracle.com/technetwork/java/javaee/tech/index-jsp-142185.html">http://www.oracle.com/technetwork/java/javaee/tech/index-jsp-142185.html</a>.</li> 
      <li>Java EE 5 Technologies @ <a href="http://www.oracle.com/technetwork/java/javaee/tech/javaee5-jsp-135162.html">http://www.oracle.com/technetwork/java/javaee/tech/javaee5-jsp-135162.html</a>.</li> 
      <li>Marty Hall, "Core Servlets and JavaServer Pages", vol.1 (2nd eds, 2003) and vol. 2 (2nd eds, 2006), Prentice Hall.</li> 
      <li>java.net - The Source for Java Technology Collaboration @ <a href="http://www.java.net">http://www.java.net</a>.</li> 
     </ol> 
    </div> 
    <!-- End the content-main division --> 
    <div id="content-footer"> 
     <p>Latest version tested: Apache Tomcat 7.0.32, JDK 1.7.0_07<br> Last modified: October, 2012</p> 
    </div> 
   </div> 
   <!-- End the wrap-inner division --> 
   <!-- footer filled by JavaScript --> 
   <div id="footer" class="header-footer">
    <p>&nbsp;</p>
   </div> 
  </div> 
  <!-- End the wrap-outer division -->   
 </body>
</html>