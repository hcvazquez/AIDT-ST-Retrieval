<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml">
 <head> 
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"> 
  <title>Building Web APIs with Node.js and MongoDB</title> 
  <link rel="shortcut icon" type="image/x-icon" href="/Images/CodeIcon.png"> 
  <meta property="fb:page_id" content="218352335971"> 
  <meta property="fb:app_id" content="225285904297383"> 
  <meta name="Description" content="Node.js by itself is a blank canvas. However, the Express.js web framework for Node.js provides programmers with a clear, concise development platform t..."> 
  <meta name="Keywords" content="Java Script, JavaScript, node.js, NOSQL, Web Development (general)"> 
  <meta name="Author" content="CODE Magazine, EPS Software Corp., Donn Felker"> 
  <meta name="Robots" content="all"> 
  <meta property="og:title" content="Building Web APIs with Node.js and MongoDB"> 
  <meta property="og:type" content="article"> 
  <meta property="og:description" content="Node.js by itself is a blank canvas. However, the Express.js web framework for Node.js provides programmers with a clear, concise development platform t..."> 
  <meta property="og:url" content="http://www.codemag.com/article/1210041"> 
  <meta property="og:image" content="http://www.codemag.com/Magazine/CoverLarge/ff09319a-75c8-40de-b038-29ee723fb730"> 
  <meta name="twitter:title" content="Building Web APIs with Node.js and MongoDB"> 
  <meta name="twitter:description" content="Node.js by itself is a blank canvas. However, the Express.js web framework for Node.js provides programmers with a clear, concise development platform t..."> 
  <meta name="twitter:image" value="http://www.codemag.com/Magazine/CoverLarge/ff09319a-75c8-40de-b038-29ee723fb730"> 
  <link rel="publisher" href="https://plus.google.com/103030867107221566748/"> 
  <link href="/Content/Reset.css" type="text/css" rel="stylesheet"> 
  <link href="/Content/2015/MicroFormats.css" type="text/css" rel="stylesheet"> 
  <link href="/Content/2015/Default.css" type="text/css" rel="stylesheet"> 
  <link href="/Content/2015/Desktop.css" type="text/css" rel="stylesheet"> 
  <style>
        .areaForeground { color: rgb(66, 182, 74); } .areaBackground { background: rgb(66, 182, 74); } a.areaLink { color: rgb(66, 182, 74); } a.areaLink:hover { color: rgb(66, 182, 74); } a.areaLink:active { color: rgb(66, 182, 74); } a.areaLink:visited { color: rgb(66, 182, 74); }
    </style> 
  <link href="/Content/ViewStyles/Article/ShowArticle.css" type="text/css" rel="stylesheet"> 
  <style>
        h1, h2, h3, h4, h5 {
            color: rgb(8, 57, 129);
        }
        a.areaLink {
            color: rgb(8, 57, 129);
        }
        a.areaLink:visited {
            color: rgb(8, 57, 129);
        }
        figure {
            color: rgb(8, 57, 129);
        }
        #contentColumnSingle .article-tables table th {
            background-color: rgb(8, 57, 129);
        }
        #contentColumnSingle .article-listings h1 {
            background-color: rgb(8, 57, 129);
        }
        #contentColumnSingle .article-tables h1 {
            color: rgb(8, 57, 129);
        }
        .article-pullquote {
            background: rgb(8, 57, 129);
        }
        .article-pullquote-arrow {
            background-image: url("/Images/Styles/SpeechBubbleArrow_8_57_129.png");
        }
        .side-info h1 {
            color: rgb(8, 57, 129);
        }
        .side-info h2 {
            color: rgb(8, 57, 129);
        }
        .tech-list li {
            background-color: rgb(8, 57, 129);
        }
        #menu ul li.magazineMenuSelected a {
            border-bottom: 3px solid rgb(8, 57, 129);
        }
        .download1ColumnButton {
            display: none;
        }                                                                          
        .codeDownloadButton {
            color: white;
            background: rgb(8, 57, 129);
            padding: 10px;
            margin-bottom: 50px;
            font-size: 1.5em;
        }
        .codeDownloadButton a {
            color: white;
            text-decoration: none;
        }
        .codeDownloadButton a:hover {
            color: white;
            text-decoration: none;
        }
        .codeDownloadButton a:visited {
            color: white;
            text-decoration: none;
        }
                
                h1.title {
                    font-family: "Segoe UI", "Helvetica Neue", Helvetica, Arial, Verdana, sans-serif;
                    font-weight: 300;
                }
                .article-body h1 {
                    font-family: "Segoe UI", "Helvetica Neue", Helvetica, Arial, Verdana, sans-serif;
                    font-weight: 300;
                }
                .article-body h2 {
                    font-family: "Segoe UI", "Helvetica Neue", Helvetica, Arial, Verdana, sans-serif;
                    font-weight: 300;
                }
                .article-body h3 {
                    font-family: "Segoe UI", "Helvetica Neue", Helvetica, Arial, Verdana, sans-serif;
                    font-weight: 300;
                }
            

        @media only screen and ( min-device-width : 320px ) and ( max-device-width : 480px ) {
            .download1ColumnButton {
                display: inherit;
            }                                                                          
        }
    </style> 
  <script src="/Scripts/jquery-1.8.2.min.js" type="text/javascript"></script> 
  <script src="/Scripts/jquery.unobtrusive-ajax.min.js" type="text/javascript"></script> 
  <script src="/Scripts/jquery.validate.min.js" type="text/javascript"></script> 
  <script src="/Scripts/jquery.validate.unobtrusive.min.js" type="text/javascript"></script> 
  <script src="/Scripts/jquery.popupWindow.js" type="text/javascript"></script> 
  <script src="/Scripts/Ads/Ads.js" type="text/javascript"></script> 
  <script language="javascript" type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-44188652-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script> 
  <script type="text/javascript">
        function setPageHeight() {
            var windowHeight = $(window).height();
            var pageHeight = $('#page').height();
            var headerHeight = $('#header').height();
            if (windowHeight > pageHeight + headerHeight + 1)
                $('#page').height(windowHeight - headerHeight - 1);
        }

        $(function () {
            setPageHeight();
            $(window).on('resize', setPageHeight);
            $(document).on('scroll', function () {
                $('.subMenu').removeClass('visibleSubMenu');
                if ($(document).scrollTop() > 60) {
                    $('#header').removeClass('headerLarge').addClass('headerSmall');
                } else {
                    $('#header').removeClass('headerSmall').addClass('headerLarge');
                }
                setPageHeight();
            });
            $('#header').on('click', function() {
                $('.subMenu').removeClass('visibleSubMenu');
            });
            $('#menu>ul>li').on('mouseenter', function () {
                $('.subMenu').removeClass('visibleSubMenu');
                $(this).find('.subMenu').addClass('visibleSubMenu');
            });
            $('#main').on('mouseenter', function () {
                $('.subMenu').removeClass('visibleSubMenu');
            });
            $('#mobileMenuIcon').on('click', function () {
                if (!$('#page').hasClass('showMobileMenu')) {
                    $('#page').addClass('showMobileMenu');
                    $('#header').addClass('showMobileMenu');
                    $('#mobileMenu').addClass('showMobileMenu');
                    $('#mobileMenu').css('display', 'block');
                    setTimeout(function () {
                        $('#mobileMenu').css('z-index', 100);
                    }, 300);
                } else {
                    $('#mobileMenu').css('z-index', -1);
                    $('#page').removeClass('showMobileMenu');
                    $('#header').removeClass('showMobileMenu');
                    $('#mobileMenu').removeClass('showMobileMenu');
                    setTimeout(function () {
                        $('#mobileMenu').css('display', 'none');
                    }, 300);
                }
            });
        })
    </script> 
  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script> 
 </head>
 <body>
  <div id="fb-root"></div> 
  <script>
        (function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s);
            js.id = id;
            js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=225285904297383";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script> 
  <script language="javascript" type="text/javascript">
        $(function() {
            // Making the code snippets look pretty
            $('pre').addClass('prettyprint');
                        
            // Adding a bunch of additional formatting to article sections
            $('<p class="article-pullquote-arrow"></p>').insertAfter('.article-pullquote');
            $('figcaption').html(function(i, html) {
                return html.replace(/(\w+\s\w+)/, '<b>$1</b>');
            });
            $('.article-listings h1').html(function(i, html) {
                return html.replace(/(\w+\s\w+)/, '<b>$1</b>');
            });
            $('.article-tables h1').html(function(i, html) {
                return html.replace(/(\w+\s\w+)/, '<b>$1</b>');
            });

            //$('#largerText').click(function() {
            //    $('.article-body').css('font-size','2em');
            //});

            // Serving up some ads
            var adIndex = 0;
            var firstAdPass = true;
            var ads = [
                { nameFirst: 'Magazine_Article_Rectangle_First', nameSubsequent: 'Magazine_Article_Rectangle_Subsequent', sizes: [[300, 250], [336, 280]], cssClass: 'rectangle-ad' },
                { nameFirst: 'Magazine_Article_Banner_First', nameSubsequent: 'Magazine_Article_Banner_Subsequent', sizes: [468, 60], cssClass: 'banner-ad' }
            ];
            var childIndex = 3;
            var paragraphsBetweenAds = 13;
            var totalParagraphs = $('div.article-body p').length;
            if (totalParagraphs > 100) paragraphsBetweenAds = 17;
            else if (totalParagraphs > 90) paragraphsBetweenAds = 16;
            else if (totalParagraphs > 80) paragraphsBetweenAds = 15;
            else if (totalParagraphs > 70) paragraphsBetweenAds = 14;

            for (var counter = 0; counter < 1000; counter++) {
                var set = $('div.article-body p:nth-of-type(' + childIndex + ')');
                if (set == undefined) break;
                if (set.length < 1) break;

                if (set[0].className == '') {
                    var previousSet = set.prev();
                    var previousIsOk = false;
                    if (previousSet.length > 0) {
                        if (previousSet[0].localName == 'p') {
                            previousIsOk = true;
                        }
                    }
                    var nextIsOk = false;
                    if (previousIsOk) {
                        var nextSet = set.next();
                        if (nextSet.length > 0) {
                            var nextSet2 = nextSet.next();
                            if (nextSet2.length > 0) {
                                var elementName = nextSet[0].localName;
                                if ((elementName == 'p' && nextSet[0].className == '') || elementName == 'h1' || elementName == 'h2' || elementName == 'h3') {
                                    nextIsOk = true;
                                }
                            }
                        }
                    }
                    if (!previousIsOk || !nextIsOk) {
                        childIndex++;
                    } else {
                        if (firstAdPass) {
                            DisplaySelfRefreshingDoubleClickAd(set, ads[adIndex].nameFirst, ads[adIndex].sizes, 'Advertisement', 'after', ads[adIndex].cssClass);
                        } else {
                            DisplaySelfRefreshingDoubleClickAd(set, ads[adIndex].nameSubsequent, ads[adIndex].sizes, 'Advertisement', 'after', ads[adIndex].cssClass);
                        }
                        childIndex += paragraphsBetweenAds;
                        adIndex++;
                        if (adIndex >= ads.length) {
                            firstAdPass = false;
                            adIndex = 0;
                        }
                    }
                } else {
                    childIndex++;
                }
            }
        });
    </script>   
  <div id="mobileMenu"> 
   <ul>
    <li class="neutralMenu"><a href="/">Home</a></li>
    <li class="consultingMenu"><a href="/Consulting">Consulting</a></li>
    <li class="staffingMenu"><a href="/Staffing">Staffing</a></li>
    <li class="magazineMenuSelected"><a href="/Magazine">Magazine</a>
     <div class="subMenu">
      <ul>
       <li><a class="areaLink" href="/Magazine">Magazine Home</a></li>
       <li><a class="areaLink" href="/Magazine/AllIssues">All Issues</a></li>
       <li><a class="areaLink" href="/Magazine/Subscribe">Subscribe</a></li>
       <li><a class="areaLink" href="/My/Magazines">My (Digital) Magazines</a></li>
       <li><a class="areaLink" href="/My/Fulfillment">Where is my Magazine?</a></li>
       <li><a class="areaLink" href="/My">My Subscriber Account</a></li>
       <li><a class="areaLink" href="/Advertise">Advertise</a></li>
       <li><a class="areaLink" href="/Write">Write</a></li>
      </ul>
     </div></li>
    <li class="frameworkMenu"><a href="/Framework">Framework</a></li>
    <li class="trainingMenu"><a href="/Training">Training</a></li>
    <li class="vfpconversionMenu"><a href="/VFPConversion">VFP Conversion</a></li>
    <li class="neutralMenu"><a href="/logon">Sign in!</a></li>
   </ul> 
  </div> 
  <div id="header" class="headerLarge"> 
   <div id="logo"> 
    <img src="/Images/Logos/CODEMagazine_Small_Blue.png">
    <br> 
   </div> 
   <div id="menu"> 
    <ul>
     <li class="neutralMenu"><a href="/">Home</a>
      <div class="subMenu article">
       <ul>
        <li><a class="areaLink" href="/">CODE Home</a></li>
        <li><a class="areaLink" href="/About">About Us</a></li>
        <li><a class="areaLink" href="/videos">Videos</a></li>
        <li><a class="areaLink" href="/Press">Press Releases</a></li>
        <li><a class="areaLink" href="/People">People</a></li>
        <li><a class="areaLink" href="/Jobs">Careers</a></li>
        <li><a class="areaLink" href="/Home/Privacy">Privacy Policy</a></li>
        <li><a class="areaLink" href="/contact">Contact Us</a></li>
       </ul>
      </div></li>
     <li class="consultingMenu"><a href="/Consulting">Consulting</a>
      <div class="subMenu">
       <ul>
        <li><a class="areaLink" href="/Consulting">Consulting Home</a></li>
        <li><a class="areaLink" href="/Consulting/Services">Services &amp; Technologies</a></li>
        <li><a class="areaLink" href="/VFPConversion">VFP Conversion</a></li>
        <li><a class="areaLink" href="/Cloud">Azure &amp; Other Clouds</a></li>
        <li><a class="areaLink" href="/Energy">Energy Software</a></li>
        <li><a class="areaLink" href="/contact">Contact Us</a></li>
       </ul>
      </div></li>
     <li class="staffingMenu"><a href="/Staffing">Staffing</a>
      <div class="subMenu">
       <ul>
        <li><a class="areaLink" href="/Staffing">Staffing Home</a></li>
        <li><a class="areaLink" href="/Staffing">Looking for Staff?</a></li>
        <li><a class="areaLink" href="/Staffing/Apply">Looking for Work?</a></li>
        <li><a class="areaLink" href="/contact">Contact Us</a></li>
       </ul>
      </div></li>
     <li class="magazineMenuSelected"><a href="/Magazine">Magazine</a>
      <div class="subMenu">
       <ul>
        <li><a class="areaLink" href="/Magazine">Magazine Home</a></li>
        <li><a class="areaLink" href="/Magazine/AllIssues">All Issues</a></li>
        <li><a class="areaLink" href="/Magazine/Subscribe">Subscribe</a></li>
        <li><a class="areaLink" href="/My/Magazines">My (Digital) Magazines</a></li>
        <li><a class="areaLink" href="/My/Fulfillment">Where is my Magazine?</a></li>
        <li><a class="areaLink" href="/My">My Subscriber Account</a></li>
        <li><a class="areaLink" href="/Advertise">Advertise</a></li>
        <li><a class="areaLink" href="/Write">Write</a></li>
       </ul>
      </div></li>
     <li class="frameworkMenu"><a href="/Framework">Framework</a>
      <div class="subMenu">
       <ul>
        <li><a class="areaLink" href="/Framework">Framework Home</a></li>
        <li><a class="areaLink" href="/Framework/GetStarted">Get Started &amp; Documentation</a></li>
        <li><a class="areaLink" href="/Framework/Download">Download</a></li>
        <li><a class="areaLink" href="/Framework/Support">Support &amp; Services</a></li>
       </ul>
      </div></li>
     <li class="trainingMenu"><a href="/Training">Training</a>
      <div class="subMenu">
       <ul>
        <li><a class="areaLink" href="/Training">Training Home</a></li>
        <li><a class="areaLink" href="/Training">Classes</a></li>
        <li><a class="areaLink" href="/Training/Mentoring">Mentoring</a></li>
        <li><a class="areaLink" href="/StateOfDotNet">State of .NET</a></li>
        <li><a class="areaLink" href="/Lunch">Lunch with CODE</a></li>
        <li><a class="areaLink" href="/CodeCamps">Code Camps</a></li>
        <li><a class="areaLink" href="/Training/TopicSpecificTraining">ASP.NET MVC</a></li>
        <li><a class="areaLink" href="/DevNet/DevNetTraining">DevNet Training</a></li>
       </ul>
      </div></li>
     <li class="vfpconversionMenu"><a href="/VFPConversion">VFP Conversion</a>
      <div class="subMenu">
       <ul>
        <li><a class="areaLink" href="/VFPConversion">VFP Conversion Home</a></li>
        <li><a class="areaLink" href="/VFPConversion/VFPServices">Services</a></li>
        <li><a class="areaLink" href="/VFPConversion/Tools">Tools</a></li>
        <li><a class="areaLink" href="/VFPConversion/Articles">Articles</a></li>
        <li><a class="areaLink" href="/VFPConversion/History">Fox End of Life</a></li>
        <li><a class="areaLink" href="/contact">Contact Us</a></li>
       </ul>
      </div></li>
     <li class="neutralMenu"><a href="/logon">Sign in!</a></li>
    </ul> 
   </div> 
   <div id="mobileMenuIcon">
    <img src="/Images/MobileMenu.png">
   </div> 
  </div> 
  <div id="page"> 
   <div id="main"> 
    <div id="contentColumnSingle"> 
     <div class="advertisement leaderboard-ad" style="width: 728px; margin-left: auto; margin-right: auto;">
       Advertisement: 
      <div id="div-gpt-ad-1378457852955-1" style="width:728px; height:90px;"> 
       <script type="text/javascript">
                googletag.cmd.push(function () {
                    var slot1 = googletag.defineSlot("/36824843/Magazine_Article_Leaderboard_Top", [728, 90], "div-gpt-ad-1378457852955-1").addService(googletag.pubads());
                    googletag.enableServices();
                    googletag.display("div-gpt-ad-1378457852955-1");
                    setInterval(function () { googletag.pubads().refresh([slot1]); }, 60000);
                });
            </script> 
      </div> 
     </div> 
     <h1 class="title">Building Web APIs with Node.js and MongoDB</h1> 
     <p>By <b>Donn Felker</b></p> 
     <div class="download1ColumnButton" style="padding-top: 25px; padding-bottom: 25px;"> 
     </div> 
     <div class="side-info"> 
      <p><a href="https://www.codemag.com/subscribe/freearticle6b1?utm_source=articleviewer&amp;utm_medium=banner&amp;utm_campaign=Article-Viewer-Free-Subs"></a><img src="/Images/Logos/DoodleFreeSubscriptionBanner.png" alt="CODE Magazine"></p> 
      <div style="margin-bottom: 20px; overflow: no-display;"> 
       <div class="fb-share-button" style="float: left;" data-href="http://www.codemag.com/article/1210041" data-type="button"></div> 
       <div style="margin-left: 5px; margin-top: 0; float: left;"> 
        <a href="https://twitter.com/share" class="twitter-share-button" data-via="codemagazine" data-count="none">Tweet</a> 
        <script>!function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + '://platform.twitter.com/widgets.js'; fjs.parentNode.insertBefore(js, fjs); } }(document, 'script', 'twitter-wjs');</script> 
       </div> 
       <div style="margin-left: 5px; margin-top: 0; float: left;"> 
        <script src="//platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script> 
        <script type="IN/Share"></script> 
       </div> 
       <div class="clearfix"></div> 
      </div> 
      <p class="author-image"><img src="/Article/AuthorPhotoSmall/01c02f01-c5bc-4a4b-a556-88ac5f65fe8d"></p> 
      <h1 class="author-name">Donn Felker</h1> 
      <p>Donn Felker is the Principal for Agilevent, a Microsoft Partner he founded in Minneapolis, Minnesota. He is an experienced Software Architect/Developer with over nine years of professional experience in various markets that include: entertainment, health, retail, insurance, financial, and real estate.<br> <br> <br> He is a Microsoft ASP Insider who currently holds certifications as an MCTS in Web Client Development for the ASP.NET 3.5 Framework, Certified Scrum Master and ITIL Foundation v2. He also holds a bachelors of science in Software Engineering. He writes, presents and consults on various topics ranging from architecture to agile practices to patterns and practices. He is the founder/coordinator of the Twin Cities Give Camp, President of the Twin Cities Developers Guild and the founder of Twin Cities Pragmatic Beer.<br> <br> <br> You can read Donn’s blog at http://blog.donnfelker.com</p> 
      <div> 
       <h2>This article was published in:</h2> 
       <a href="/Magazine/Issue/ff09319a-75c8-40de-b038-29ee723fb730"><img src="/Magazine/Cover/ff09319a-75c8-40de-b038-29ee723fb730"></a> 
      </div> 
      <div> 
       <h2>This article was filed under:</h2> 
       <ul class="tech-list"> 
        <li><a href="/Magazine/ByCategory/Java%20Script">Java Script</a></li> 
        <li><a href="/Magazine/ByCategory/JavaScript">JavaScript</a></li> 
        <li><a href="/Magazine/ByCategory/node.js">node.js</a></li> 
        <li><a href="/Magazine/ByCategory/NOSQL">NOSQL</a></li> 
        <li><a href="/Magazine/ByCategory/Web%20Development%20(general)">Web Development (general)</a></li> 
       </ul> 
       <div class="clearfix"></div> 
      </div> 
      <div class="advertisement skyscraper-ad">
        Advertisement: 
       <div id="div-gpt-ad-1378457852954-1" style="width:160px; height:600px;"> 
        <script type="text/javascript">
                    googletag.cmd.push(function () {
                        var slot1 = googletag.defineSlot("/36824843/Magazine_Article_Skyscraper_Right", [160, 600], "div-gpt-ad-1378457852954-1").addService(googletag.pubads());
                        googletag.enableServices();
                        googletag.display("div-gpt-ad-1378457852954-1");
                        setInterval(function () { googletag.pubads().refresh([slot1]); }, 60000);
                    });
                </script> 
       </div> 
      </div> 
     </div> 
     <div class="article-body">
      <p>Node.js by itself is a blank canvas. However, the Express.js web framework for Node.js provides programmers with a clear, concise development platform to build high performance Web APIs.</p>
      <p>In this article, I’ll illustrate what it takes to build a simple Web API using Node.js and the Express.js web framework with MongoDB as the persistence mechanism. Under the hood I’ll use MongoDB and Mongoose to persist the data. </p>
      <p><i>NOTE: You can find the complete source code for this article at: https://github.com/donnfelker/workout-tracker</i></p>
      <p>The Node.js product is still in its infancy yet it’s already being touted in many tech circles as the quickest way to develop scalable APIs (and applications) that can handle a large load directly out of the box. The main benefit of Node.js is that any existing JavaScript knowledge you have instantly transfers over to Node.js as it is a JavaScript framework. While this is a net gain, the unfortunate consequence of a new framework like Node.js is that you’re left with a blank canvas to start your development from. Building a Web API from the ground floor is not only time consuming but it is also very error prone in the long run. Thankfully, Express, the high performance web framework for Node.js, exists. Express allows you to quickly create applications that have a majority of the common boilerplate code already written for you. In this article, you’ll learn how to use the Express web framework for Node.js by building a simple Web API for a sample application known as the Workout Tracker. </p>
      <p>Persistence in any Web API is the cornerstone of development. A common problem in API development is that the inserts or reads are far too slow due to the normalization of the data in a typical relational database. While there are ways to improve these queries (and insertions) with proper tuning of the database, one alternative up and coming approach is to use MongoDB as the backing store for APIs that require high throughput. Modeling the data in a document-oriented fashion (as MongoDB does) allows the developer to tackle the issue from a different angle - allowing the developer to store the data for the model in a complete entity in a MongoDB document. I’m not advocating that one approach is better than another, only that options from one approach might make more sense than another. In this article, I will show you how you can integrate MongoDB with Node.js to create a simple Web API using the Mongoose package. </p>
      <h2>Standing on the Shoulders of Giants</h2>
      <p>Node.js has not been around long - a mere three years - not even hitting an official version 1.0 (for this article I’ll use Node v0.8.0). During the last three years, various companies have started to adopt Node.js as part of their core business strategy. One of the alluring aspects of Node.js is the ability to share JavaScript between the client and the server.</p>
      <p>While many web developers already know JavaScript and want to learn Node.js, some are turned off at the thought of working with Node.js because there is not a web framework built into the core of Node.js. I was no exception. Upon my first glance at version v0.2.x of Node.js, I thought the feature set was somewhat bare and the landscape of available packages (and documentation and examples) was sparse to say the least. It was frustrating to see that I might have to spend a large amount of time building core components simply to be productive in this new environment. This was also of major concern to a lot of other developers (and sometimes still is). Most developers are concerned with how productive they will be. If you want a solution that makes working in Node.js easier, you’ll want to look at one of the few various web frameworks for Node.js. Some of those include Express, Flatiron and Geddy. In this article I will work with Express because Express is the most popular Node.js web framework at the moment. </p>
      <h3>Creating Your First Express App</h3>
      <p>In order to develop an Express application you must install Express first. To install Express, you need to have Node installed (I’m using v0.8.0 - get Node.js at nodejs.org). To install Express from the command prompt, type: </p>
      <pre><code>npm install -g express

</code></pre>
      <p>This command instructs NPM (Node Package Manager) to install Express. After a moment of some values streaming across the screen you will have installed Express! Using the -g switch instructs NPM to install the package globally inside of your current Node.js installation - meaning that you can access Express anywhere, not just in your current project.</p>
      <p>To create your first Express app, navigate to the destination where you’d like your application files to reside (e.g., <i>/development </i>or <i>C:\development </i>if you’re on Windows). Next, issue the following command from the command prompt: </p>
      <pre><code>express ./workout-tracker

</code></pre>
      <p>This will execute the express command that will create the Express application inside of a folder called <i>workout-tracker</i>. I will build this application during the course of this article. The Workout Tracker Express application is an API that will allow a user to keep track of the workouts they have performed through API commands.</p>
      <p>Once the command above finishes you will need to change directories and install the dependencies that the application needs.</p>
      <pre><code>cd ./workout-tracker
npm install -d

</code></pre>
      <p>The -d switch on the npm install command informs npm to provide an information-level log output during the installation process of the dependencies that npm is installing.</p>
      <p>How does NPM know what the dependencies are? If no argument is supplied to the npm install command then npm will look for a file called package.json in the current directory and will read that file for all of the dependencies that need to be installed. Express created the package.json file during the express application generation process. The package.json file is very similar to the Gemfile featured in Rubygems in the Ruby language. The npm install command walks the package.json file and installs each of the dependencies.</p>
      <h3>Exploring the Express Application Assets</h3>
      <p>During the Express application generation process, Express generates a file structure similar to what is present in <b>Figure 1</b>.</p>
      <figure>
       <img src="/Article/Image/1210041/Felker_fig01.png">
       <figcaption>
         Figure 1: The file structure that Express generates. 
       </figcaption>
      </figure>
      <p>The list below explains the important folders and files: </p>
      <ul>
       <li><b>node_modules: </b>Contains the downloaded dependencies that were installed through npm install. </li>
       <li><b>Public: </b>Contains any assets that will be available to the public-facing part of the application such as images, JavaScript files and style sheets. </li>
       <li><b>Routes: </b>The routes for the application. </li>
       <li><b>Views: </b>The view templates for the application. You will not be using these in this article as you will be building a JSON APS. </li>
       <li><b>app.js: </b>The entry point of your application. </li>
       <li><b>package.json: </b>The file which includes the dependency declarations for your application.</li>
      </ul>
      <p>You are not limited to only the folders listed above. You can create alternate folders (as you will do later in this article). However, the folders above are the default folders that Express creates. This style of folder nomenclature and project structure is somewhat of an opinionated approach - very similar to how Rails conventions and project structure are considered very opinionated. Following, not fighting, the conventions will usually help speed up development of Node.js web applications and APIs significantly.</p>
      <p>An Express application is comprised of views, routes and assets. Between these various parts of the application you can create compelling applications that maintain a separated architecture. Views contain HTML, routes are responsible for URL routing, and assets such as images are available for download and viewing to the client. </p>
      <p>Views are responsible for rendering HTML to the client and maintaining markup for web applications. You will not be using views in this article, as you will be building a Web API that exposes JSON endpoints. However, it is important to note that Express does not use simple bracket tax syntax as Rails ERB or classic .NET WebForms uses. Instead, Express uses the Jade view engine that is very similar to the Haml view development.</p>
      <p>Routes in an Express application are responsible for handling the URL mapping to actual code that you write. This could be a route such as /workouts/:id where :id maps to the particular ID which associates with a workout that you’re trying to locate, such as /workouts/134. Express would translate that into a route that is defined in our app.js file:</p>
      <pre><code>app.get('/workouts/:id', workouts.show);

</code></pre>
      <p>which would execute the code in the workouts show method as shown below.</p>
      <pre><code>exports.show = function(req, res) {
  // ... code that would get executed ...
}

</code></pre>
      <p>In this article, you’ll work very closely with routes as this is where the majority of your code will be placed. While this is not a pure MVC approach to developing, you can view an example of how to develop with an MVC approach via the examples folder on the Express GitHub repository located at: https://github.com/visionmedia/express.</p>
      <p>The assets of your application include your style sheets, images and JavaScript files. You typically include these files as static files to your application that would most likely be downloaded by the user when viewing an application via a HTML view (again, you will not be using these assets as you will be developing a JSON API with Express).</p>
      <p>The file that you should be most concerned with is the app.js file. This is the entry point to your application. You can see the contents of this file in <b>Listing 1</b>.</p>
      <p>The app.js file is the file that Node.js will use to bootstrap the Express application. This file contains the proper require statements to create the Express application. After the require statements the Express app is created through the var app = express(); function call. </p>
      <p>Immediately after the app variable is initialized, the Express application is configured via the app.configure(…) call. The configure method initializes the Express application, which allows configuration to the current desired runtime environment. You can configure different runtime environments by providing the first parameter to the configure method - such as <i>development </i>or <i>production </i>(or any other environment you may need). I will demonstrate this in <b>Listing 1</b>. In the first instance of the configure method, notice that it does not provide an environment parameter. Any configure method that does not provide the environment parameter will configure the entire Express application. In this method call, the application is configured with the following: </p>
      <ul>
       <li><b>Default Port: </b>Sets the current environment port or port 3000.</li>
       <li><b>View Directory: </b>Sets the directory that contains the views.</li>
       <li><b>View Engine: </b>Sets the view engine that will be used by the Express application.</li>
       <li><b>Favicon: </b>Provides a fast path to the favicon.</li>
       <li><b>Logger: </b>The logger to use.</li>
       <li><b>Body Parser: </b>A parser that parses out the BODY data from HTTP Request.</li>
       <li><b>Method Overrides: </b>Checks the request.body method for the HTTP method overrides.</li>
       <li><b>The Router: </b>The router that is used for routing in the Express application.</li>
       <li><b>Public Directory: </b>Specifies the public directory for static assets such as images, style sheets and JavaScript files.</li>
      </ul>
      <p>In the second configure method, the first parameter, <i>development</i>, is provided to configure the current runtime environment for development. In this instance, the errorHandler Connect middleware is activated.</p>
      <p>Connect is a middleware framework for Node.js that provides over 18 different bundled middleware components that simplify the usage of Node.js.</p>
      <p>The next step in the configuration of the Express application is the set up of the routes. In the current configuration, the only route that is available is the root route, which routes to the default view. This is done via the app.get('/', routes.index);. This route configuration uses the routes located in the routes module in /routes/index.js. You will build five routes in this article.</p>
      <p>The last line of the app.js file contains the function call that creates the HTTP Server using the provided port in the first configure method.</p>
      <h3>Starting the App</h3>
      <p>Starting your first Node.js application is as simple as executing one command. Navigate to the directory that contains your application and type the following command:</p>
      <pre><code>node app

</code></pre>
      <p>After executing this command, you should see the following on the command line:</p>
      <pre><code>Express server listening on port 3000 in development
mode.

</code></pre>
      <p>Open your web browser and visit the http://localhost:3000 location. <b>Figure 2 </b>shows what you should see.</p>
      <figure>
       <img src="/Article/Image/1210041/Felker_fig02.png">
       <figcaption>
         Figure 2: The Express application running the default index route.
       </figcaption>
      </figure>
      <h2>Writing Your First Route</h2>
      <p>Now that you have the app running, open the terminal window that started the Node application and press CTRL+C to close the application. Each time you make changes to the application you will need to stop and start the Node.js server so that each change can be reloaded. Next, you will create your first route and return JSON from the route. </p>
      <p>Create a new file with the name <i>workout.js </i>in the <i>/routes </i>folder of your application.</p>
      <p>In the workouts.js file, type the following code and save the file. </p>
      <pre><code>exports.index = function(req, res) {
  res.json(200, { message: "My first route"});
}

</code></pre>
      <p>When executed, this route will return an HTTP 200 status code with the application/json content type with JSON data as the result (shown below when you render it via the browser).</p>
      <p>In the workouts.js file, a function with the name <i>index </i>is exported using the exports object. For an in-depth understanding of the <i>require </i>function and <i>exports </i>object in Node.js, please see the article located at this address: http://goo.gl/FMxdK.</p>
      <p>In order to use the new index route, you will need to require the module in the app.js file. Open the app.js file and add the workouts.js file to the require statements as shown below:</p>
      <pre><code>var express = require('express')
  , routes = require('./routes')
  , http = require('http')
  , workouts = require('./routes/workouts');

</code></pre>
      <p>This will load the workouts.js file into a workouts variable in the app.js module. You can learn more about the Node.js module loading system here: http://nodejs.org/api/modules.html.</p>
      <p>Further down in the app.js file you will have to add a new route entry to expose this endpoint. To do so, add the following code after the index route:</p>
      <pre><code>app.get('/', routes.index);
app.get('/workouts', workouts.index);

</code></pre>
      <p>This route definition creates a route which is accessible via the /workouts url location. Using the local workouts variable you can access the <i>index </i>member (which was created via the exports call in the workouts.js file) that exposes the route.</p>
      <p>Save the file. Start the Node.js application by issuing the node app command via your terminal client. Open your web browser and visit http://localhost:3000/workouts and you should see something similar to <b>Figure 3</b>. (<i>NOTE: </i>The JSON result in <b>Figure 3 </b>is formatted with the JSONView extension for Chrome. Available here: http://goo.gl/ryn5R. This extension makes it much easier to view JSON results in the browser.)</p>
      <figure>
       <img src="/Article/Image/1210041/Felker_fig03.png">
       <figcaption>
         Figure 3: Your JSON endpoint!
       </figcaption>
      </figure>
      <p>Congratulations you’ve created your first JSON endpoint with Node.js and Express!</p>
      <h2>Persisting Data with MongoDB</h2>
      <p>As I’ve said before, for this article you’ll build a simple workout tracking application. The application will track some very simple metadata about a workout such as its name, description and the date the workout was entered.</p>
      <p>In this application you will persist data with MongoDB, therefore you will need to have MongoDB installed locally or be using a service such as MongoHQ for a hosted solution (mongohq.com). To install MongoDB, follow the installation instructions here: <a href="http://www.mongodb.org/">http://www.mongodb.org/</a>.</p>
      <p>In order to communicate with MongoDB you will need to use one of many different drivers or plug-ins. For this article, I’ll use the Mongoose object modeling tool to connect to MongoDB. Mongoose is an object modeling tool (very similar to an ORM) for MongoDB Node.js written in JavaScript. Mongoose object modeling definitions contain validators, defaults, getters, setters, indexes, middleware, methods, statics, plugins and DB Refs. For a complete reference on Mongoose, visit <a href="http://www.mongoosejs.com">http://www.mongoosejs.com</a>.</p>
      <p>To install Mongoose, you will use NPM with the following command: </p>
      <pre><code>npm install mongoose --save

</code></pre>
      <p>Using the <i>--save </i>switch with NPM will update the package.json file with a dependency on Mongoose. This allows future developers on your team to download the source code for your application and then issue the npm install command that will install all the dependencies for the Express application. At that point, Mongoose would be installed as it is listed as a dependency in the package.json file.</p>
      <p>Once the installation of Mongoose is complete, create a folder in the project with the name <i>models</i>. In that folder, create a file with the name <i>workout.js</i>. This is the file in which you will define the workout object model.</p>
      <p>Though MongoDB is a schema-less document storage system, Mongoose provides the ability to provide a schema for your object model to simplify the creation, retrieval and updating of documents. In the workout.js file, type the code shown in <b>Listing 2</b>.</p>
      <p>The first two lines set the Mongoose variable and Schema variable from the require function. This is needed in order to work with Mongoose. </p>
      <p>The first variable declaration, workoutSchema, is created using the Schema function call with a JSON object which defines the object model. This object model is defined as follows: </p>
      <ul>
       <li><b>Name: </b>The type of the property is <i>String</i>. The required option is included, which if true creates a validation rule that requires this value to be present before saving can occur. This value is also Trimmed before saving by calling the .trim() method. Last, but certainly not least, is the index that is created on the name. This index specifies that the name must be unique in the MongoDB collection.</li>
       <li><b>Description: </b>Of type String and the value is required.</li>
       <li><b>date_created: </b>This type of property is <i>Date </i>and it is required prior to saving. The default value of Date.now is provided in the schema definition to provide a default value if nothing is provided. This ensures that there is always a value present in the MongoDB document when saved.</li>
      </ul>
      <p>The last variable created is the actual workout model. This model is created with the model method on the Mongoose object. Simply providing the model name and the schema for the model creates the workout model.</p>
      <p>Once the workout is created it is exported from the current module using the module.exports object. At this point, you have defined the object model and the only thing left is to connect to MongoDB. Once connected you can query, update, save and remove documents using Mongoose through your Express application.</p>
      <h2>Integrating Express and Mongoose</h2>
      <p>Using your Mongoose object model in your Express application is quite simple. Connect to the MongoDB instance and then perform your queries. You are now going to connect to MongoDB and then change your default route to query MongoDB for the workouts that are saved in the collection.</p>
      <p>Open the app.js file and add one require statement to the list of require statements.</p>
      <pre><code>var express = require('express')
  , routes = require('./routes')
  , http = require('http')
  , workouts = require('./routes/workouts')
  , mongoose = require('mongoose');

</code></pre>
      <p>Add the following line after the require statements.</p>
      <pre><code>mongoose.connect('mongodb://localhost/workout_tracker');

</code></pre>
      <p>This line connects to the local MongoDB instance you have set up. <i>NOTE: </i>MongoDB must be running (mongod or mongos command) in order to connect to MongoDB from the application you are building. Notice how you have never created a database with the name <i>workout-tracker</i>. This is because as soon as Mongoose attempts to query the database, Mongoose will create the <i>workout-tracker </i>database for you. That’s it! Save the file and close it.</p>
      <p>The querying of the workout documents should be done in the workout routes. Open the /routes/workout.js file and replace the contents of the file with the code shown in <b>Listing 3</b>. </p>
      <p>The code in <b>Listing 3 </b>queries the MongoDB workout collection using the Mongoose object modeling tool. The Workout.find(…) method accepts two parameters: the query and the callback for when the query completes. The first parameter is empty because no filter is to be applied - this route requests all workouts to be returned. </p>
      <p>The callback function has parameters that are returned. An error object, err, and the documents that are returned if no error occurred. The JSON object that is returned is returned as a JSON object with one field - <i>workouts</i>. This contains an array of JSON objects that are returned from MongoDB if documents are found. If no documents are found, an empty array is returned. An HTTP 200 status code is returned when no error is found. When an error is found, an HTTP 500 status code is returned with a message that includes the error object as a JSON object. </p>
      <p>Save the file. Press CTRL+C in the terminal window that is currently running the node application. Type node app once again and hit ENTER. Once the application starts, visit the route http://localhost:3000/workouts and you should see something similar to <b>Figure 4</b>. At this time, there are no documents in the MongoDB collection. You will now add a route to add a document.</p>
      <figure>
       <img src="/Article/Image/1210041/Felker_fig04.png">
       <figcaption>
         Figure 4: An empty array returned from Mongoose on the default workouts route.
       </figcaption>
      </figure>
      <p>In the workout.js file, add the code shown in <b>Listing 4</b>. </p>
      <p>The create export in <b>Listing 4 </b>will attempt to find a workout with the same name. If it finds a workout with the same name (case insensitive search) it will return an error. If no duplicate is found and no error occurs than save the new workout, otherwise, return the error that occurred.</p>
      <p>The first method call performs a query to find one match based upon the name of the workout, but using a case insensitive search. Providing a regular expression as a query option to the findOne method call performs the case insensitive search. Upon completion of the findOne call, a Boolean check on the document and error is performed. If no document is returned and no error has occurred, a new document will be created. If an error has not occurred but a document is found than an HTTP 403 status code is returned, along with a JSON object that contains a message informing the user of what happened. Finally, if an error has occurred, the error will be returned to the user as a JSON object with an HTTP 500 status code. </p>
      <p>Creating the document is as simple as creating a new workout object model, setting the values and then calling the save(…) method on the workout Mongoose object model. This method accepts one parameter - the callback that is performed when the save completes. If no error has occurred, than the save is considered a success and an HTTP 201 status code is returned with a JSON object informing the user that the workout has been created. If an error has occurred, an HTTP 500 status code is returned with a JSON object containing the error. Save the file.</p>
      <p>Users of MongoDB may see a glaring cause for the usage of MongoDB’s upsert command. You can use upsert in Mongoose as shown here: http://goo.gl/Jmsfw, however, this was not done in this instance for ease of understanding the integration between Node.js and MongoDB.</p>
      <p>In order to be able to access the export that you just created you will need to add the route to the app.js file. In the app.js file, add the following route to the route declarations:</p>
      <pre><code>app.post('/workouts', workouts.create);

</code></pre>
      <p>This route declaration uses the post method and informs Express that when a user POSTs to the /workouts URI, the workouts.create export should be called (the method you just created).</p>
      <p>Save the file. In the command terminal type CTRL+C and press ENTER to stop the execution of the current node application. Restart the application type node app then press ENTER. The app is now ready to accept new workouts via the endpoint you just created.</p>
      <p>Since working with endpoints that require different HTTP VERBs to be initiated can be quite tricky, I tend to work with a REST client of some sort. Since I use Chrome as my main browser, I have found the Advanced Rest Client to be very useful. This is the Chrome extension that I will use for the remainder of this article. You can get this extension here: http://goo.gl/Fw5I4.</p>
      <p>Open the Advanced Rest Client extension and fill out the fields as shown in <b>Figure 5</b>. </p>
      <figure>
       <img src="/Article/Image/1210041/Felker_fig05.png">
       <figcaption>
         Figure 5: Advanced Rest Client. Crafting an HTTP POST with a workout_name and workout_description.
       </figcaption>
      </figure>
      <p>Notice that you are adding body values. These are going to be parsed by the bodyParser in Express and made available to the request object in the route that accepts them. Press the <i>Send Request </i>button. You should now see what is shown in <b>Figure 6 </b>at the bottom of the Advanced Rest Client window.</p>
      <figure>
       <img src="/Article/Image/1210041/Felker_fig06.png">
       <figcaption>
         Figure 6: The HTTP status code 201 informing you that the workout was created.
       </figcaption>
      </figure>
      <p>Now, return to the workouts tab on your browser and reload the page (URL: http://localhost:3000/workouts) and you should see the workout you just created returned in the list as shown in <b>Figure 7</b>.</p>
      <figure>
       <img src="/Article/Image/1210041/Felker_fig07.png">
       <figcaption>
         Figure 7: The result of the workout call after creating a workout via the HTTP POST.
       </figcaption>
      </figure>
      <p>Return to the Advanced Rest Client and press the <i>Send Request </i>button again (do not change any of the values). You should see that an HTTP Status code 403 is returned as shown in <b>Figure 8</b>. </p>
      <figure>
       <img src="/Article/Image/1210041/Felker_fig08.png">
       <figcaption>
         Figure 8: The HTTP result of when an attempt to create a workout with the same name occurs.
       </figcaption>
      </figure>
      <h3>Creating the Show Route</h3>
      <p>There are a total of five routes that need to be created. Two of those have been created - view all workouts and create a workout. Sometimes in applications it is necessary to view the details of a particular record. To do that you will normally access a URL that has some sort of identifier. That identifier will be an id in a database and it will be used to query the database for the particular record in question.</p>
      <p>You will create a route and then create the route to handle that query. First, open the app.js file and add the following route after the existing routes:</p>
      <pre><code>app.get('/workouts/:id', workouts.show);

</code></pre>
      <p>This route allows an HTTP get on the /workouts/:id route. The <i>:id </i>segment of the URI is a placeholder that is parsed using regular expressions under the hood. This allows routes such as /workouts/1234 to be translated in the route function parameters. The id parameter in this case would be 1234.</p>
      <p>To create the show route, open the /routes/workout.js file and add the code shown in <b>Listing 5</b>.</p>
      <p>The show function takes the ID from the request parameters and uses the Mongoose object model to locate the document in the MongoDB collection. If no error occurs and a document is found, the document is returned as a JSON object with an HTTP 200 status code. If an error occurs, the error is returned as a JSON object with an HTTP 500 status code. If an error does not occur and no matching document is found than an HTTP 404 is returned along with a message informing the user that the document could not be found. </p>
      <p>In order to utilize this new route you will need to stop and restart the node application. Once started, visit the /workouts route and then copy the _id value of one of the workouts you’ve created. Now take that value and append it to the URL. For example, you might have an URL like this: http://localhost:3000/workouts/4ff089f17ba1cce99a000003 where 4ff089f17ba1cce99a000003 is the id of the MongoDB document. Now press ENTER - this will execute the show route that you just created. You should see the MongoDB document as shown in <b>Figure 9</b>.</p>
      <figure>
       <img src="/Article/Image/1210041/Felker_fig09.png">
       <figcaption>
         Figure 9: The result of looking up a valid document via the show route.
       </figcaption>
      </figure>
      <p>If you issue a request with an invalid id you will receive an HTTP 404 status code and a message stating that the workout could not be found. You can use Advanced Rest Client to verify this. </p>
      <h3>Creating the Delete Route</h3>
      <p>Just as you would like to insert a new workout into your application, you also may need to delete a workout from the application as well. To do so you will need to add another route to the application.</p>
      <p>Open the app.js file and add the following route to the routes declarations: </p>
      <pre><code>app.del('/workouts', workouts.delete);

</code></pre>
      <p>This route uses the <i>del </i>method, which is short for the DELETE HTTP VERB. Anytime a DELETE request is issued to the /workouts route the <i>workouts.delete </i>method will be invoked. Save the file.</p>
      <p>Open the /routes/workout.js file and add the code shown in <b>Listing 6</b>. </p>
      <p>This method grabs the id off of the body of the request and then uses it to find a workout through the workout object model. The findById method is a convenience method for finding a MongoDB document by the id of the document. Simply supply the id of the document and the callback (the second parameter of the findById call) will be initiated when the find is done. If an error does not occur and a document is found than you can remove the document by calling the remove() method on the document. This will remove the document from the MongoDB collection. Once that is complete, an HTTP 200 status code is returned to the client along with a message informing them that the delete has occurred. If an error has not occurred, a document is not found, and then an HTTP 404 status code is returned informing the user that the workout was not found. If an error occurs, an HTTP 403 status code is returned with a message informing the user that the workout could not be deleted along with the error code. </p>
      <p>To test this, open Advanced Rest Client and enter the values as shown in <b>Figure 10 </b>(replace the id value with a valid id that you have grabbed from the /workouts route, viewed through a browser). </p>
      <figure>
       <img src="/Article/Image/1210041/Felker_fig10.png">
       <figcaption>
         Figure 10: Setting up the DELETE HTTP call to delete a workout.
       </figcaption>
      </figure>
      <p>Click <i>Send Request </i>and you should see the same result as <b>Figure 11 </b>(if you used a valid id of a document). Issue the same request again and you’ll notice that you now receive a 403 because the document could not be deleted; this is because you just deleted it in the previous action. Some API developers feel that in this instance the API should return a 404; however, that is up to each API developer and the instance they are working within. </p>
      <figure>
       <img src="/Article/Image/1210041/Felker_fig11.png">
       <figcaption>
         Figure 11: A successful DELETE request performed via Advanced Rest Client.
       </figcaption>
      </figure>
      <p>View the /workouts URL via the browser again and you’ll see that the workout you just deleted is not visible in the workout list. </p>
      <h3>Creating the Update Route</h3>
      <p>Last but certainly not least is the update route used to update the workout in MongoDB. You may realize that you have misspelled a workout and that you need to rename it. This route will allow you to do that.</p>
      <p>First, create the route. To do this, open the app.js file and add the following route:</p>
      <pre><code>app.put('/workouts', workouts.update);

</code></pre>
      <p>This route uses the put() method of the app object which utilizes the HTTP PUT verb. Anytime a PUT HTTP request is issued, the call will invoke the workouts.update method. Save the file.</p>
      <p>Open the /routes/workout.js file and add the route to the file as shown in <b>Listing 7</b>.</p>
      <p>In the update function, the body contains the workout name and workout description and id of the workout. Using the id, you use the findById method of the Mongoose object model attempting to find the MongoDB document. The callback function of the findById call performs all the necessary logic for the update.</p>
      <p>If an error does not occur and a document is found than the document is updated using the values that were present in the HTTP body. Once the document is updated through the document properties, the document is saved using the save function, which also takes a callback as a parameter. Upon a successful save, that second callback is executed and the user is presented with a result that the document is updated with the workout name. If an error occurs during the save of the document, an HTTP 500 status code is returned with the error as a JSON object.</p>
      <p>If a document cannot be found by the findById than an HTTP 404 status code is returned with a message informing the user that the workout could not be found, therefore it cannot be updated. If a document is not found and an error is present, an HTTP 500 status code will be returned with the error that occurred.</p>
      <p>To issue an update, craft a PUT request in Advanced Rest Client as shown in <b>Figure 12</b>. Click the <i>Send Request </i>and you should see the same value as shown in <b>Figure 13</b>. Visit the /workouts route in your browser to view the updated document in the workouts JSON array. If you provide an invalid id in the PUT request a 404 will be returned. You can test this in Advanced Rest Client by changing the id to an invalid id that does not exist.</p>
      <figure>
       <img src="/Article/Image/1210041/Felker_fig12.png">
       <figcaption>
         Figure 12: Advanced Rest Client - Crafting an update request with an HTTP PUT.
       </figcaption>
      </figure>
      <figure>
       <img src="/Article/Image/1210041/Felker_fig13.png">
       <figcaption>
         Figure 13: Advanced Rest Client - Result of a successful HTTP PUT update.
       </figcaption>
      </figure>
      <p>Thankfully, during the short life of ASP.NET MVC you’ve been introduced to many view engines - WebForms (default in version 1 and 2 of ASP.NET MVC), Spark, NHaml, NVelocity and many others. The big question you’re probably asking is - why do I need another view engine? The simple answer is - iteration.</p>
      <h2>Conclusion</h2>
      <p>Creating Web APIs in Node.js can be radically simplified using pre-built packages such as Express and Mongoose. With a minimal amount of upfront development effort and time, a developer can have a decent Web API up and running very quickly. If you don’t use MongoDB you can use other packages found in NPM for Redis, MySql, SQL Server, Oracle and other persistence mechanisms. Additional tools that can help in testing while in development are the <i>should.js </i>and <i>mocha.js </i>packages. You’ll find these available at https://github.com/visionmedia/should.js and <a href="http://visionmedia.github.com/mocha/">http://visionmedia.github.com/mocha/</a>.</p>
      <p>You can download the full source for the application at the public Git repository here: https://github.com/donnfelker/workout-tracker.</p>
     </div>
     <div class="article-sidebars">
      <h1>Cross Platform</h1>
      <p>The CLI commands illustrated in this article are UNIX oriented. Thankfully, Node.js is cross platform and will also run on Windows. To run the same commands in Windows simply replace the forward slashes with back slashes and change the root slash to a c:\ directive. </p>
     </div>
     <div class="article-listings">
      <h1>Listing 1: The app.js file. The contents may differ depdending on the version of Express you have.</h1>
      <pre><code>var express = require('express')
  , routes = require('./routes')
  , http = require('http');
      
var app = express();
      
app.configure(function(){
  app.set('port', process.env.PORT || 3000);
  app.set('views', __dirname + '/views');
  app.set('view engine', 'jade');
  app.use(express.favicon());
  app.use(express.logger('dev'));
  app.use(express.bodyParser());
  app.use(express.methodOverride());
  app.use(app.router);
  app.use(express.static(__dirname + '/public'));
});
      
app.configure('development', function(){
  app.use(express.errorHandler());
});
      
app.get('/', routes.index);
      
http.createServer(app).listen(app.get('port'), function(){
  console.log("Express server listening on port %s in %s mode.",
app.get('port'), app.settings.env);
});

</code></pre>
      <h1>Listing 2: The workout object model schema</h1>
      <pre><code>var mongoose = require('mongoose')
  , Schema = mongoose.Schema;
      
var workoutSchema = new Schema({
    name : { type: String, required: true, trim: true,
index: { unique: true } }
  , description : { type: String, required: true }
  , date_created : { type: Date, required: true, default: Date.now
}
});
      
var workout = mongoose.model('workout', workoutSchema);
      
module.exports = {
  Workout: workout
};

</code></pre>
      <h1>Listing 3: Query MongoDB for the workouts, using Mongoose</h1>
      <pre><code>var Workout = require('../models/workout').Workout;
      
exports.index = function(req, res) {
  Workout.find({}, function(err, docs) {
    if(!err) {
      res.json(200, { workouts: docs });
    } else {
      res.json(500, { message: err });
    }
  });
}

</code></pre>
      <h1>Listing 4: Method to allow creation of a workout via Mongoose</h1>
      <pre><code>exports.create = function(req, res) {
      
  var workout_name = req.body.workout_name; // Name of workout.
  var description = req.body.workout_description; // Description
of the workout
      
Workout.findOne({ name: { $regex: new RegExp(workout_name, "i") } },
function(err, doc) { // Using RegEx - search is case insensitive
    if(!err &amp;&amp; !doc) {
      
      var newWorkout = new Workout();
      
      newWorkout.name = workout_name;
      newWorkout.description = description;
      
      newWorkout.save(function(err) {
      
        if(!err) {
          res.json(201, {message: "Workout created with name: " +
newWorkout.name });
        } else {
          res.json(500, {message: "Could not create workout.
Error: " + err});
        }
      
      });
      
    } else if(!err) {
      
      // User is trying to create a workout with a name that
      // already exists.
      res.json(403, {message: "Workout with that name already
exists, please update instead of create or create a new workout
with a different name."});
      
    } else {
      res.json(500, { message: err});
    }
  });
      
}

</code></pre>
      <h1>Listing 5: The show function</h1>
      <pre><code>exports.show = function(req, res) {
  
  var id = req.params.id; // The id of the workout the user wants
to look up.
  Workout.findById(id, function(err, doc) {
    if(!err &amp;&amp; doc) {
      res.json(200, doc);
    } else if(err) {
      res.json(500, { message: "Error loading workout." + err});
    } else {
      res.json(404, { message: "Workout not found."});
    }
  });
}

</code></pre>
      <h1>Listing 6: The delete function used for deleting existing workouts</h1>
      <pre><code>exports.delete = function(req, res) {
      
  var id = req.body.id;
  Workout.findById(id, function(err, doc) {
    if(!err &amp;&amp; doc) {
      doc.remove();
      res.json(200, { message: "Workout removed."});
    } else if(!err) {
      res.json(404, { message: "Could not find workout."});
    } else {
      res.json(403, {message: "Could not delete workout. " + err});
    }
  });
}

</code></pre>
      <h1>Listing 7: The update method call that updates a workout</h1>
      <pre><code>exports.update = function(req, res) {
  
  var id = req.body.id;
  var workout_name = req.body.workout_name;
  var workout_description = req.body.workout_description;
      
  Workout.findById(id, function(err, doc) {
      if(!err &amp;&amp; doc) {
        doc.name = workout_name;
        doc.description = workout_description;
        doc.save(function(err) {
          if(!err) {
            res.json(200, {message: "Workout updated: " +
workout_name});
          } else {
            res.json(500, {message: "Could not update workout. " +
err});
          }
        });
      } else if(!err) {
        res.json(404, { message: "Could not find workout."});
      } else {
        res.json(500, { message: "Could not update workout. " +
err});
      }
    });
}

</code></pre>
     </div> 
     <div class="side-info2"> 
      <p class="author-image"><img src="/Article/AuthorPhotoSmall/01c02f01-c5bc-4a4b-a556-88ac5f65fe8d"> </p> 
      <h1 class="author-name">Donn Felker</h1> 
      <p>Donn Felker is the Principal for Agilevent, a Microsoft Partner he founded in Minneapolis, Minnesota. He is an experienced Software Architect/Developer with over nine years of professional experience in various markets that include: entertainment, health, retail, insurance, financial, and real estate.<br> <br> <br> He is a Microsoft ASP Insider who currently holds certifications as an MCTS in Web Client Development for the ASP.NET 3.5 Framework, Certified Scrum Master and ITIL Foundation v2. He also holds a bachelors of science in Software Engineering. He writes, presents and consults on various topics ranging from architecture to agile practices to patterns and practices. He is the founder/coordinator of the Twin Cities Give Camp, President of the Twin Cities Developers Guild and the founder of Twin Cities Pragmatic Beer.<br> <br> <br> You can read Donn’s blog at http://blog.donnfelker.com</p> 
      <div> 
       <h2>This article was filed under:</h2> 
       <ul class="tech-list"> 
        <li><a href="/Magazine/ByCategory/Java%20Script">Java Script</a></li> 
        <li><a href="/Magazine/ByCategory/JavaScript">JavaScript</a></li> 
        <li><a href="/Magazine/ByCategory/node.js">node.js</a></li> 
        <li><a href="/Magazine/ByCategory/NOSQL">NOSQL</a></li> 
        <li><a href="/Magazine/ByCategory/Web%20Development%20(general)">Web Development (general)</a></li> 
       </ul> 
       <div class="clearfix"></div> 
      </div> 
      <div> 
       <h2>This article was published in:</h2> 
       <a href="/Magazine/Issue/ff09319a-75c8-40de-b038-29ee723fb730"><img src="/Magazine/Cover/ff09319a-75c8-40de-b038-29ee723fb730"></a> 
      </div> 
     </div> 
     <div style="padding-top: 25px;"> 
      <a href="https://www.codemag.com/subscribe/freearticle6b1?utm_source=articleviewer&amp;utm_medium=end_banner_d&amp;utm_campaign=Article-Viewer-Free-Subs"><img style="text-align: center;" src="/Images/Banners/Red End of Article Banner v2.png"></a> 
     </div> 
     <div style="padding-top: 25px;"> 
      <h4>Have additional technical questions?</h4> 
      <p style="margin-top: 10px;">Get help from the experts at <i>CODE Magazine</i> - sign up for our free hour of consulting!</p> 
      <p>Contact CODE Consulting at <a href="mailto:techhelp@codemag.com">techhelp@codemag.com</a>.</p> 
     </div> 
     <div> 
      <h4 style="margin-top: 50px; margin-bottom: 20px;">Got something to say? Leave a comment!</h4> 
      <div class="fb-comments" data-href="http://www.codemag.com/article/1210041" data-width="550"></div> 
     </div> 
    </div> 
    <div class="clearfix"></div> 
   </div> 
   <div id="footer"> 
    <div class="copyright">
     (c) by EPS Software Corp. 1993 - 2017
    </div> 
    <div class="vcard"> 
     <!-- EPS company address using adr MicroFormat standard --> 
     <div class="adr"> 
      <div class="street-address">
       6605 Cypresswood Dr.
      </div> 
      <div class="extended-address">
       Suite 300
      </div> 
      <span class="locality">Houston</span> 
      <span class="region">TX</span> 
      <span class="postal-code">77379</span> 
      <div class="country-name">
       USA
      </div> 
     </div> 
     <!-- Phone/fax in MicroFormat standard --> 
     <div class="tel">
      <div class="type">
       Voice
      </div>
      <div class="value">
       +1 (832) 717-4445
      </div>
     </div> 
     <div class="tel">
      <div class="type">
       Fax
      </div>
      <div class="value">
       +1 (832) 717-4460
      </div>
     </div> 
     <div class="email">
      Email: 
      <a class="email" href="mailto:info@codemag.com">info@codemag.com</a>
     </div> 
    </div> 
   </div> 
  </div> 
  <!-- the following div tags are there so custom CSS can associated generic elements, such as graphics anywhere in the body content --> 
  <div id="bodyAdorner1"> 
   <span></span> 
  </div> 
  <div id="bodyAdorner2"> 
   <span></span> 
  </div> 
  <div id="bodyAdorner3"> 
   <span></span> 
  </div> 
  <!-- OLD CODE - Wasn't working and Google helped me by adding the code below 8/1/16.  Google Code for Remarketing Tag --> 
  <!--
    Remarketing tags may not be associated with personally identifiable information or placed on pages related to sensitive categories. See more information and instructions on how to setup the tag on: http://google.com/ads/remarketingsetup
    ---------------------------------------------------> 
  <!-- Google Code for Remarketing Tag --> 
  <!--
    Remarketing tags may not be associated with personally identifiable information or placed on pages related to sensitive categories. See more information and instructions on how to setup the tag on: http://google.com/ads/remarketingsetup
    ---------------------------------------------------> 
  <script type="text/javascript">
    /* <![CDATA[ */
    var google_conversion_id = 1067389305;
    var google_custom_params = window.google_tag_params;
    var google_remarketing_only = true;
    /* ]]> */
        </script> 
  <script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js">
        </script> 
  <noscript> 
   <div style="display:inline;"> 
    <img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1067389305/?value=0&amp;guid=ON&amp;script=0"> 
   </div> 
  </noscript>   
 </body>
</html>