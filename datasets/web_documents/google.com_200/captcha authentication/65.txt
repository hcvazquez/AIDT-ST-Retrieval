<!doctype html>
<html lang="en">
 <head> 
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" title="Default" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/default.min.css">
  <style type="text/css" media="screen">
   @import url(https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,300,400,600,700,800);@import url(https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css);@import url(https://cdnjs.cloudflare.com/ajax/libs/jquery.colorbox/1.4.33/example1/colorbox.css);@import url(https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css);html,body{height:100%}body{color:#333;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:14px;line-height:1.42857}#doc-content a{color:#2b6ea6;text-decoration:underline dotted}#doc-content a:hover{color:darkblue;text-decoration:underline dotted}#doc-content a.self-link,a.self-link:hover,a.self-link:active{color:inherit;text-decoration:none}#doc-content a[href].self-link:hover::after{-moz-osx-font-smoothing:grayscale;content:"\e144";color:#2b6ea6;display:inline-block;font-family:"Glyphicons Halflings";font-size:75%;font-style:normal;line-height:1;padding-left:5px;position:relative;top:1px}li.L0,li.L1,li.L2,li.L3,li.L5,li.L6,li.L7,li.L8{list-style-type:decimal !important}.bold{font-weight:bold}.strong{font-weight:bold !important}.btn-primary{background-color:#519387;border-color:#488378;color:#fff}.btn-default{background-color:#fff;border-color:#ccc;color:#333}.btn-default:hover,.btn-default:focus,.btn-default.focus,.btn-default:active,.btn-default.active,.open>.dropdown-toggle.btn-default{background-color:#e6e6e6;border-color:#adadad;color:#333}.tooltip.in{opacity:.95}.tooltip.bottom .tooltip-arrow{border-bottom-color:#519387}.tooltip-inner{background-color:#519387}.dl-horizontal dt{white-space:normal;padding:0 3px 0 0;width:200px}.dl-horizontal dd{border-bottom:1px dotted #7db3a8;border-bottom:1px dotted rgba(125,179,168,0.8);margin-bottom:18px;margin-left:210px}.dl-horizontal{border-top:1px dotted #7db3a8;border-top:1px dotted rgba(125,179,168,0.9);padding-top:10px}.variablelist dt{margin:0 0 5px 15px;padding-top:10px}.variablelist>dt:not(:first-of-type){border-top:1px dotted rgba(125,179,168,0.8)}.variablelist dd{margin:5px 0 5px 30px}.variablelist>dl{border-top:1px dotted rgba(125,179,168,0.8);margin-bottom:10px}.panel-warning{border-color:brown}.panel-warning>.panel-heading{background-color:brown;border-color:brown;color:white}.navbar-brand{float:left;font-size:18px;height:50px;line-height:20px;padding:16px 16px 0 16px}.navbar-brand>a{color:#bb3d11}.navbar-right.navbar-form{margin-top:4px}.navbar-default .navbar-text{color:#777}.navbar-text{margin-bottom:6px;margin-top:1em;float:left;margin-left:0;margin-right:6px;font-size:18px;line-height:1em;max-width:55%}.navbar-secondary .navbar-brand{font-weight:bold}.navbar-text a.dropdown-toggle:not(.page-title),.navbar-text a.dropdown-toggle:hover:not(.page-title){color:#333}nav .navbar-text .text-muted a,nav .navbar-text small a,nav .navbar-text .text-muted a:hover,nav .navbar-text small a:hover{color:#777}.toolbar-icon{display:inline-block;margin:0 5px}nav.backstage-site-header{background:rgba(0,0,0,0.9) none repeat scroll 0 0}.backstage-site-header-brand.backstage-site-header>a.backstage-site-header>img.backstage-site-header{max-height:27px}.navbar.navbar-default.navbar-secondary.navbar-fixed-top{box-shadow:0 0 4px rgba(0,0,0,0.14),0 4px 8px rgba(0,0,0,0.28);top:50px}.navbar-form{border-top:0;border-bottom:0}#secondHeaderSearchForm{display:inline-block;width:100%}.dropdown-menu>li{font-size:9pt;padding:0 10px}.dropdown-menu>li>a{font-size:9pt;padding:1px 10px 2px 5px}.dropdown-menu>li.dropdown-header{font-style:italic;padding:2px 0 1px 10px}.toolbar-icons{display:inline-block;margin-top:10px}.btn-link{cursor:pointer}.toolbar-icons a,.toolbar-icons .btn-link{color:rgba(30,63,75,0.75)}.toolbar-icons a:hover,.toolbar-icons .btn-link:hover{color:#1e3f4b}.btn.btn-default.btn-sm{height:30px}form.form-inline{margin-bottom:0}.navbar-collapse.collapse.in .nav.navbar-text{width:100%}.navbar-collapse.collapse.in .navbar-right.navbar-form{width:100%}.navbar-collapse.collapse.in .open>.dropdown-menu{width:100%;background-color:transparent;border:0;border-radius:0;box-shadow:none;position:relative}.nav .open>a,.nav .open>a:focus,.nav .open>a:hover{background-color:transparent;border-color:transparent}.navbar-collapse.collapse.in .open>.dropdown-menu>li>a:focus,.dropdown-menu>li>a:hover{background-color:#337ab7;color:white}.affix-top{position:absolute;top:116px}.affix{top:116px;height:calc(100vh - 166px)}.affix-bottom{position:absolute;height:calc(100vh - 166px)}#sidebar .displayVersion{font-size:12px;margin-bottom:5px;padding:2px 0 9px 2px}#sidebar .displayVersion .updatelabel{font-style:italic;font-weight:bold;color:#777}#sidebar .nav .nav{margin-left:16px}#sidebar .nav a{color:#666;font-size:13px;font-weight:400;margin-right:10px;padding:2px 10px 2px 2px}#sidebar .nav .nav a{padding-top:2px;padding-bottom:2px;font-size:13px}#sidebar .nav .nav .nav a{font-size:12px}#sidebar .nav .nav .nav .nav a{font-size:11px}#sidebar .nav .nav .nav .nav .nav a{font-size:11px}#sidebar .nav>.active>a,#sidebar .nav>.locked-active>a,#sidebar .nav>li>a:hover,#sidebar .nav>li>a:focus{border-right:2px solid;color:#bb3d11;text-decoration:none}#sidebar .nav>.active>a,#sidebar .nav>.active:hover>a,#sidebar .nav>.active:focus>a{font-weight:bolder}#sidebar .nav ul.nav{display:none}#sidebar .nav>.active>ul.nav{display:block}#sidebar{overflow-y:auto}#doc-content{min-height:100%;margin-bottom:-375px;margin-top:100px}#doc-content:after{content:"";display:block;height:375px}h1{font-size:36px !important;font-weight:500 !important}h1 span{margin-right:.3em}#doc-content h1,#doc-content .h1{font-size:36px;margin-top:24px;padding-bottom:5px}h2{font-size:32px !important;font-weight:500 !important}h4{margin-top:14px}h5,.h5{font-size:16px;padding-bottom:4px;font-style:italic}#doc-content-abstract{border-left:5px solid #bb3d11;color:#666;font-size:18px;font-weight:400;padding:4px 0 1px 10px;margin-top:24px}#doc-content-abstract p{margin-bottom:9px;font-style:italic}.example-title{font-size:18px;font-weight:500;margin:10px 0 8px}.anchorjs-link .anchorjs-icon{color:#a1a8ad;text-decoration:none}.anchorjs-link:hover .anchorjs-icon{color:#519387;text-decoration:none}h1:hover>.anchorjs-link,h2:hover>.anchorjs-link,h3:hover>.anchorjs-link,h4:hover>.anchorjs-link,h5:hover>.anchorjs-link,.anchorjs-link:focus{opacity:1 !important;transition:color .16s linear 0;text-decoration:none}.preface>.titlepage+p:first-of-type,.preface>.indexterm+p:first-of-type,.preface>.titlepage+.itemizedlist>p:first-child,.preface>.indexterm+.itemizedlist>p:first-child{font-size:18px;font-weight:300;line-height:1.4;margin-bottom:15px}#doc-content{overflow:auto;padding:0 10px 10px 10px}div.procedure-title,div.table-title{margin:6px 0 8px}div.procedure-inner{border-color:lightslategray;background-color:rgba(253,253,255,0.7);border-style:dotted dotted dotted solid;border-width:1px 1px 1px 6px;margin:15px 0 10px;padding:8px 15px 10px 10px}.author{display:inline}.table{font-size:14px;table-layout:fixed}.simplelist{width:100%;font-size:14px}table.simplelist{margin-bottom:10px}table.simplelist td{padding-bottom:2px}.procedure-title>a,.procedure-title>a:hover{font-size:17px;font-weight:700}.itemizedlist-title{font-size:17px;font-weight:700;margin:12px 0 6px}.figure-title{font-size:17px;font-weight:700;margin:16px 0 4px;text-align:center;font-style:italic}.table-title{font-size:17px;font-weight:700;text-align:center;font-style:italic}.variablelist-title{font-size:17px;font-weight:700;margin:10px 0;text-decoration:underline}code{font-size:10pt;padding:0}code.literal,code.filename{padding:2px 4px;overflow-wrap:break-word;word-wrap:break-word;-ms-word-break:break-all;word-break:break-all;word-break:break-word}.command{color:#333;font-family:Menlo,Monaco,Consolas,"Courier New",monospace;font-size:.925em}.literallayout>p{background-color:#f9f2f4;border-radius:4px;color:#c7254e;font-family:Menlo,Monaco,Consolas,"Courier New",monospace;font-size:.925em;margin:0;max-width:100%;padding:4px 2px 8px 6px;white-space:pre-wrap}.btn-copy-cmdline,.btn-copy-codelisting{background-color:white;color:#999;display:block;font-size:10pt;padding:1px 3px 1px;position:absolute;right:1px;top:1px;z-index:10;border-left:1px solid #ccc;border-bottom:1px solid #ccc;border-radius:0 2px 0 4px}pre.prettyprint{border:1px solid #ccc;padding:9px 26px 9px 9px;font-size:12px;font-family:Menlo,Monaco,Consolas,"Courier New",monospace;white-space:pre-wrap;word-break:keep-all}.zero-clipboard{display:block;position:relative}.zeroclipboard-is-hover{background-color:#6faa9b;border-color:#6faa9b;color:#fff;cursor:pointer}.zero-clipboard>span:hover{color:#2b6ea6}.zero-clipboard>span{cursor:pointer}.ui-effects-transfer{border:1px dotted black;background-color:yellow;opacity:.4}#docConfig,#aboutModal{margin-top:80px}#aboutModal .modal-body{font-size:12px}#aboutModal .modal-header,#aboutModal .modal-body{padding:10px 15px 5px}#aboutModal #about-title{font-size:24px !important;font-weight:500 !important;margin:0}#aboutModal #about-subtitle{color:#777;font-size:15px;font-style:italic;font-weight:400;margin:0}#aboutModal #about-authorgroup{margin:0 0 8px 0}#aboutModal div.author{margin:4px 10px 5px 0}#aboutModal h3.author{margin:0;font-size:12px !important;font-style:italic;font-weight:100 !important}#aboutModal #about-abstract{margin:10px 0 10px 0;font-size:16px !important;font-weight:200 !important}#aboutModal #about-buildRevision{font-weight:300;margin:5px 0}#aboutModal #about-buildRevision>span{font-weight:400;color:#777}#aboutModal #about-buildDateTime{font-weight:300;margin:5px 0}#aboutModal #about-buildDateTime>span{font-weight:400;color:#777}#aboutModal #about-legalnotice{font-weight:400}#aboutModal .affiliation{display:none}#aboutModal .about-copyright{color:#777;font-size:14px;margin:15px 0 5px}.fancybox>img{cursor:zoom-in}a.fancybox{text-decoration:none}#cboxTitle{color:#519387;font-size:14px;font-weight:700}#cboxOverlay{background:none repeat scroll 0 0 rgba(66,130,116,0.6)}img.img-responsive{margin-bottom:20px}@media only screen and (min--moz-device-pixel-ratio:2),only screen and (-o-min-device-pixel-ratio:2/1),only screen and (-webkit-min-device-pixel-ratio:2),only screen and (min-device-pixel-ratio:2){img.img-responsive{max-height:500px}}.indexdiv>h3{border-bottom:2px dotted lightgrey;padding-bottom:5px}.indexdiv>dl{margin-left:30px}.indexdiv dl{margin-bottom:5px}.indexdiv dt{margin:5px 0 2px}.indexdiv dd{margin-left:35px}.indexdiv .indexterm{font-weight:200}.refnamediv h2{display:none}.refsect1 h2,.refsynopsisdiv h2{font-size:20px !important;font-weight:400 !important}.refsect2 h3,.refsynopsisdiv h3{font-size:18px !important;font-weight:300 !important}.refnamediv p{font-size:32px !important;font-weight:700 !important}tr.question>*:first-child{padding-right:15px}tr.question{border-top:1px dotted #789}tr.question td{font-weight:bold;padding-top:10px}.qandaset table{font-size:14px}.back-to-top{position:fixed;bottom:55px;right:5px;display:none;z-index:15}#footer{display:none}.footer{background-color:#ededed;border-top:1px solid rgba(0,0,0,0.1);color:#777;bottom:0;font-size:13px;height:30px;padding:3px 0 4px;position:fixed;width:100%;z-index:100}.footer h3{margin:0}.footer a:hover{text-decoration:none}.footer-item{line-height:22px;margin-left:10px}.footer-item.highlighted{color:#f7a540}.footer-item.highlighted:hover{color:#c97208}.footer .footer-left{float:left}.footer .footer-right{float:right}.footer-version span{padding-left:2pt}footer.backstage-site-footer{position:relative}#alternateBar{bottom:-20px;padding:5px 15px;position:fixed;text-align:center;width:100%;display:none}.mr-1{display:inline-block;margin-right:20px}#alternate-titles>a{color:#66512c;font-weight:bold;margin-right:15px}.alert-dismissable .close,.alert-dismissible .close{color:inherit;position:relative;right:0;top:-2px}
  </style>
  <style type="text/css" media="print">
   @import url(https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css);*{-webkit-transition:none !important;transition:none !important}@page{size:auto portrait;margin:20mm 10mm;orphans:3;widows:2}.hidden-print,#index{display:none}html,body{margin:0;width:100%}body{font-family:serif;color:black;background:white;font-size:12pt;line-height:1.2;padding:0}p{margin:0 0 7px 0}.navbar-header{padding:15px}.table{border-collapse:collapse;width:100%}th{font-family:sans-serif}.table th,.table td{border-bottom:1px solid lightgray;padding:4px;text-align:left}img{max-width:100% !important}.navbar-brand img{-webkit-filter:brightness(0);filter:brightness(0)}#doc-content{position:relative;float:none !important}.chapter,.glossary,.appendix,.index,.preface{float:none !important;position:relative;break-before:always;page-break-after:always}.panel,.mediaobject,.table .cmdline,.codelisting,.figure{float:none !important;position:relative;-webkit-column-break-inside:avoid;page-break-inside:avoid;break-inside:avoid}#doc-content h1{font-size:3em;margin:1em 0 .5em 0;bookmark-level:1;bookmark-label:content(text)}#doc-content h2{font-size:1.5em;margin:.5em 0 .25em 0;bookmark-level:2;bookmark-label:content(text)}#doc-content h3{font-size:1.17em;margin:.3em 0 .1em 0;bookmark-level:3;bookmark-label:content(text)}#doc-content h4{font-size:1.12em;margin:.3em 0 .1em 0}#doc-content h5{font-size:.83em;margin:.3em 0 .1em 0}#doc-content h6{font-size:.75em;margin:.3em 0 .1em 0}.title{font-family:sans-serif}.figure-title,.table-title{font-weight:bold;margin:5px 0;text-align:center;font-style:italic;font-family:sans-serif}.procedure{margin:5px 0 10px}.procedure-title,.variablelist-title{font-weight:bold;margin:5px 0 3px;text-align:left;font-family:sans-serif}.jumbotron{border-bottom:1px solid grey;margin:0;padding:0 0 12px 15px}.jumbotron h1{font-family:sans-serif;font-size:3em !important;font-weight:600 !important}.jumbotron small{color:#333;display:block}.jumbotron p{font-size:1.2em;font-weight:400;margin-bottom:5px;margin-top:20px}a{color:black;text-decoration:none}p a.link:after{content:" (" attr(href) ")";font-size:80%}a.link[href^="http"],.olink{background-image:none;margin-right:0;padding-right:0}a.self-link[href]:hover::after{line-height:1;padding-left:0;position:relative;top:1px}.panel{box-shadow:none;border-left:4px solid grey;border-width:0 0 0 4px;padding:0 0 0 10px;margin:0 0 10px}.panel-heading{border:0;padding:2px 0}.panel-body{padding:2px 0}.panel-body p{margin:0}.panel-title{margin:0;font-size:.9em !important;font-family:sans-serif}.panel-info{border-color:#d1e9f5}.panel-warning{border-color:#921a20}.panel-danger{border-color:#eed6d6}.panel-success{border-color:#d8eecf}.panel-primary{border-color:#2965a8}.term{text-decoration:underline}.variablelist>dt{margin:2px 0 3px 0}code,kbd,pre,samp{font-family:monospace;font-size:.9em}pre.prettyprint{border:1px dotted lightgrey;padding:2px}li.L0,li.L1,li.L2,li.L3,li.L5,li.L6,li.L7,li.L8{list-style-type:decimal !important}
  </style>
  <title>Developer's Guide</title>
  <script src="https://code.jquery.com/jquery-1.11.2.min.js" type="text/javascript"></script>
  <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js" type="text/javascript"></script>
  <script src="https://cdn.forgerock.com/webcomponentsjs/0.7.23/webcomponents-lite.min.js" type="text/javascript"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/dockerfile.min.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/dos.min.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/groovy.min.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/ldif.min.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/yaml.min.js" type="text/javascript"></script>
  <meta name="generator" content="DocBook XSL Stylesheets V1.79.1">
  <meta name="description" content="Guide to developing OpenAM client applications and service providers. OpenAM provides open source Authentication, Authorization, Entitlement and Federation software.">
  <script type="application/javascript">
     /*!
 * The contents of this file are subject to the terms of the Common Development and
 * Distribution License (the License). You may not use this file except in compliance with the
 * License.
 *
 * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the
 * specific language governing permission and limitations under the License.
 *
 * When distributing Covered Software, include this CDDL Header Notice in each file and include
 * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL
 * Header, with the fields enclosed by brackets [] replaced by your own identifying
 * information: "Portions copyright [year] [name of copyright owner]".
 *
 * Copyright 2015-2017 ForgeRock AS.
 */
;
/*!  */
;
/*!
 * jQuery throttle / debounce - v1.1 - 3/7/2010
 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(d,g){var f=d.jQuery||d.Cowboy||(d.Cowboy={}),e;f.throttle=e=function(m,l,a,b){var c,n=0;if(typeof l!=="boolean"){b=a;a=l;l=g}function k(){var p=this,h=+new Date()-n,q=arguments;function i(){n=+new Date();a.apply(p,q)}function j(){c=g}if(b&&!c){i()}c&&clearTimeout(c);if(b===g&&h>m){i()}else{if(l!==true){c=setTimeout(b?j:i,b===g?m-h:m)}}}if(f.guid){k.guid=a.guid=a.guid||f.guid++}return k};f.debounce=function(c,b,a){return a===g?e(c,b,false):e(c,a,b!==false)}})(this);var frDocRedirectEndpoint="/doc-redirect/api/v1/docredirect";var frFeedbackEmailUsername="docs";var frDocsBase="/docs/";var frSearchBase="/docs/search";var frLegalNoticeUrl="https://backstage.forgerock.com/knowledge/backstagehelp/article/a81642400";var getBackstageConfig=function(){$.getJSON("../../../fr-docs-bs-globals.json").done(function(a){$.each(a,function(b,c){if(window[b]){window[b]=c}});updateConfig()}).fail(function(c,d,a){var b=d+", "+a;updateConfig()})};var updateConfig=function(){$("#secondHeaderSearchForm").attr("action",frSearchBase);$("#about-legalnotice").attr("href",frLegalNoticeUrl)};var loadJavaScriptsFN=function(){$.ajaxSetup({cache:true});$.getScript("https://cdnjs.cloudflare.com/ajax/libs/jquery.colorbox/1.6.4/jquery.colorbox-min.js",function(){enableColorboxFN()});$.getScript("https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js",function(){enableCopyToClipboardFN()})};var enableCopyToClipboardFN=function(){if(Clipboard.isSupported()){addCopyButtonFN();var a=new Clipboard(".zero-clipboard",{text:function(b){var c="";var d=$(b.nextElementSibling);if(d.hasClass("cmdline")){d.find("strong.userinput").each(function(e){c+=$(this).text()+"\n"})}else{c=d.text()}return(c)}});a.on("success",function(c){var b=$(c.trigger.nextElementSibling);if(b.hasClass("cmdline")){console.info("Is a cmdline");b.find("strong.userinput").each(function(d){$(this).effect("transfer",{to:b.prev().children("span").first()},750)})}else{b.effect("transfer",{to:b.prev().children("span").first()},750)}c.clearSelection()});a.on("error",function(b){})}};var highlightJS=function(){hljs.configure({languages:["bash","cpp","css","dos","dockerfile","diff","groovy","html","http","ini","json","java","javascript","ldif","makefile","markdown","nginx","php","perl","python","ruby","sql","shell","xml","yaml"]});$(".prettyprint").each(function(a,b){hljs.highlightBlock(b)})};var wrapConfigurablesFn=function(){$('*:contains("https://openam.example.com:8443")').each(function(){if($(this).children().length<1){$(this).html($(this).text().replace(new RegExp("https://openam.example.com:8443","g"),'<span class="exampleUrl">https://openam.example.com:8443</span>'))}});$('*:contains("amadmin")').each(function(){if($(this).children().length<1){$(this).html($(this).text().replace(new RegExp("amadmin","g"),'<span class="exampleAdmin">amadmin</span>'))}});$('*:contains("iPlanetDirectoryPro")').each(function(){if($(this).children().length<1){$(this).html($(this).text().replace(new RegExp("iPlanetDirectoryPro","g"),'<span class="exampleSsoCookieName">iPlanetDirectoryPro</span>'))}})};function switchCodeStyle(a){$("link[rel*=alternate][title]").each(function(b){this.disabled=true;if(this.getAttribute("title")===a){this.disabled=false}});if(storage){storage.setItem("fr-docs-snippet-theme",a);storage.getItem("fr-docs-snippet-theme")}$("#themeDropDown").val(a)}var btnClickHandler=function(){$("#themeDropDown").on("change",function(){switchCodeStyle($("#themeDropDown").val())});$("button#applyDocUpdate").click(function(){$("span.exampleUrl").fadeOut("slow",function(){$("span.exampleUrl").text($("input#exampleUrl").val()).fadeIn("slow")});$("span.exampleAdmin").fadeOut("slow",function(){$("span.exampleAdmin").text($("input#exampleAdmin").val()).fadeIn("slow")});$("span.exampleSsoCookieName").fadeOut("slow",function(){$("span.exampleSsoCookieName").text($("input#exampleSsoCookieName").val()).fadeIn("slow")});$("#docConfig").modal("hide")})};var applyThemeFromLocalStorage=function(){if(storage){var a=storage.getItem("fr-docs-snippet-theme");if(a){switchCodeStyle(a)}}};var addCopyButtonFN=function(){$(".cmdline").each(function(){$(this).before('<div class="zero-clipboard hidden-xs hidden-print" title="Copy command to clipboard"><span class="btn-copy-cmdline"><span class="glyphicon glyphicon-duplicate"></span></span></div>')});$(".codelisting").each(function(){$(this).before('<div class="zero-clipboard hidden-xs hidden-print" title="Copy code to clipboard"><span class="btn-copy-codelisting"><span class="glyphicon glyphicon-duplicate"></span></span></div>')})};var versionsRequest="";var currentTitle="";var enableScrollSpyFN=function(){$("body").scrollspy({target:"#sidebar",offset:130});var a="preface";var b="";$("#sidebar").on("activate.bs.scrollspy",$.debounce(200,function(d){if($("#alternateBar").length){a=$("#sidebar > .nav > li.active > a").attr("href");if(typeof a!=="undefined"){a=a.replace("#","")}else{a=""}var c=$(".active > a").last();b=c.attr("href");currentTitle=c.text();b=b.replace("#","");if(docSet!==""&&docEdition!==""&&docId!==""){versionsRequest=docSet.replace(/\s/g,"-").toLowerCase()+"/"+docEdition+"/"+docId+"/"+a;if(a!==b){versionsRequest+="/"+b}$.getJSON(frDocRedirectEndpoint,{path:versionsRequest,callback:"?",format:"jsonp",jsonp:"?"},function(f){var e=[];$.each(f.data,function(g,h){e.push(h)});if(e.length>1){populateAlternativesBar(e)}}).error(function(){$("#alternateBar").hide()})}}}))};var populateAlternativesBar=function(a){$("#alternate-titles").empty();$("#current-title").text(currentTitle);$.each(a,function(c,d){var e=d.split("/");if(versionsRequest!==d){var b="<a class='alert-link' href='"+frDocsBase+e[0]+"/"+e[1]+"/"+e[2]+"/"+e[3];if(e.length>5){b+="#"+e[4]}b+="'>"+e[1]+"</a>";$("#alternate-titles").append($(b))}});$("#alternateBar").fadeIn()};var enableToolTipFN=function(){$(function(){$("[data-toggle='tooltip']").tooltip({placement:"bottom"})})};var enableBackToTopFadeInFN=function(){var b=220;var a=500;$(window).scroll(function(){if($(this).scrollTop()>b){$(".back-to-top").fadeIn(a)}else{$(".back-to-top").fadeOut(a)}});$(".back-to-top").click(function(c){c.preventDefault();$("html, body").animate({scrollTop:0},a);return false})};var enableClampedWidthsFN=function(){$("[data-clampedwidth]").each(function(){var b=$(this);var a=b.data("clampedwidth");var c=function(){if(b.is(":visible")){var d=$(a).width()-parseInt(b.css("paddingLeft"))-parseInt(b.css("paddingRight"))-parseInt(b.css("marginLeft"))-parseInt(b.css("marginRight"))-parseInt(b.css("borderLeftWidth"))-parseInt(b.css("borderRightWidth"));b.css("width",d)}};c();$(window).resize(c)})};var affixToCFN=function(){$("#sidebar").affix({offset:{top:0}});$(window).on("load resize",function(){$(window).trigger("scroll")})};var attachAnchorsToHeadings=function(){$("#doc-content .title, #doc-content .procedure-title").each(function(){var a=$(this).closest("div[id]").attr("id");if(a===undefined||a===""){return}$(this).wrapInner('<a class="self-link" href="#'+a+'"></a>')})};var enableColorboxFN=function(){$(".fancybox").colorbox({title:function(){return $(this).children("img").attr("alt")},opacity:1,transition:"elastic",initialWidth:0,initialHeight:0,maxWidth:"95%",maxHeight:"85%",top:"65px",scalePhotos:true,fixed:true})};var trackSearchTermsFN=function(){var a=document.getElementById("secondHeaderSearchForm");$(".search-panel .dropdown-menu").find("a").click(function(c){c.preventDefault();var d=$(this).attr("href").replace("#","");var b=$(this).text();$(".search-panel span#search_concept").text(b);$("input").remove(".querystring");productIdField=$('<input type="hidden" class="querystring" id="fieldproductId" name="productId" value="'+docSet.replace(/\s/g,"-").toLowerCase()+'">');versionField=$('<input type="hidden" class="querystring" id="fieldversion" name="version" value="'+docEdition.toLowerCase()+'">');bookIdField=$('<input type="hidden" class="querystring" id="fieldbookId" name="bookId" value="'+docId.toLowerCase()+'">');switch($(this).attr("href")){case"#book":$("#secondHeaderSearchForm").append(productIdField,versionField,bookIdField);break;case"#version":$("#secondHeaderSearchForm").append(productIdField,versionField);break;case"#product":$("#secondHeaderSearchForm").append(productIdField);break;case"#all":default:break}});a.addEventListener("submit",function(e){e.preventDefault();setTimeout(b,1000);var d=false;function b(){if(!d){d=true;a.submit()}}var c=$("#q").val();if(c!==""){var f="/docs-search-virtual.html?q="+encodeURI(c);ga("set","page",f);ga("send","pageview",{hitCallback:function(){b}})}else{b}})};var trackPageViewsFN=function(){var a=location.pathname+location.search+location.hash;var b=$(".active > a").last().text();ga("send",{hitType:"pageview",page:a,title:b})};var trackPageEventsFN=function(){$("#downloadPDFLink").on("click",function(){var a="Downloaded "+$(this).attr("href");ga("send","event","PDF","Download",a)})};var enableZeroClipboardFN=function(){ZeroClipboard.config({swfPath:"includes/swf/ZeroClipboard.swf",trustedDomains:["*"],forceEnhancedClipboard:false,forceHandCursor:true,debug:false});addCopyButtonFN();addZeroClipboardToCmdlineButtonsFN();addZeroClipboardToCodeButtonsFN()};var hideDraftAlertFN=function(){$("#draft_alert").delay(10000).slideUp(200,function(){$(this).alert("close")})};var hideIncorrectDisplayVersionFN=function(){var a="#";a+="displayVersion";if($("div.displayVersion>span.badge").first().text()===a){$("div.displayVersion").hide()}};var enableDocFeedback=function(){$("#mailFeedbackIcon").on("click",function(){var a="";if(docSet!==""&&docEdition!==""&&docId!==""){a=docSet+"/"+docEdition+"/"+docId}if(currentTitle!==""){a=a+"/"+currentTitle}if(a!==""){a=" about "+a}window.location="mailto:"+frFeedbackEmailUsername+"@forgerock.com?subject=Feedback"+a+"&body=Hi ForgeRock Documentation Team,%0D%0A%0D%0AI have some feedback regarding the documentation at this URL:%0D%0A%0D%0A    "+location.href+":%0D%0A%0D%0AMy browser reports itself as:%0D%0A%0D%0A    "+navigator.userAgent+"%0D%0A%0D%0AMy feedback is:%0D%0A%0D%0A...";ga("send","event","Feedback","Report","Feedback sent"+a)})};var adjustAnchor=function(){var a=$(":target");var b=120;if(a.length>0){$("html, body").stop().animate({scrollTop:a.offset().top-b},200)}};var unCollapseNavs=function(){$(window).on("resize",function(){if(window.innerWidth>768){$(".navbar-collapse").removeClass("in")}})};$(window).on("hashchange",function(){adjustAnchor();trackPageViewsFN()});$(function(){loadJavaScriptsFN();getBackstageConfig();attachAnchorsToHeadings();enableToolTipFN();enableBackToTopFadeInFN();$("#sidebar a[href^='#'], #doc-content a[href^='#']").on("click",function(){adjustAnchor()})});$(window).on("load",function(){enableClampedWidthsFN();affixToCFN();enableScrollSpyFN();trackPageEventsFN();trackSearchTermsFN();unCollapseNavs();highlightJS();hideDraftAlertFN();hideIncorrectDisplayVersionFN();enableDocFeedback();adjustAnchor()});
/*!  */;
    </script>
  <link rel="import" href="https://cdn.forgerock.com/backstage-web-components/latest/backstage-site-header.html">
  <link rel="import" href="https://cdn.forgerock.com/backstage-web-components/latest/backstage-site-footer.html">
  <script type="text/javascript">var docSet = "OpenAM";
var docEdition = "13";
var docId = "dev-guide";</script>
  <link rel="shortcut icon" href="https://www.forgerock.com/favicon.ico"> 
  <meta content="Fri, 28 Jul 2017 18:48:12 UTC" http-equiv="date">
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-23412190-17', 'auto');
  ga('send', 'pageview', location.pathname + location.search + location.hash);

</script>
 </head>   
 <body id="top" bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
  <backstage-site-header active-item="docs"></backstage-site-header>
  <nav class="navbar navbar-default navbar-secondary navbar-fixed-top" bs-affix="true" offset-top="35">
   <div class="container">
    <div class="navbar-header">
     <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#docs-secondary-navbar-collapse" aria-expanded="false"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>
     <div class="navbar-brand hidden-sm hidden-md hidden-xs">
      <a href="/docs/"><i class="glyphicon glyphicon-file"></i> Docs</a>
     </div>
    </div>
    <div class="collapse navbar-collapse" id="docs-secondary-navbar-collapse">
     <div class="nav navbar-text">
      <span class="text-muted nowrap hidden-sm hidden-md hidden-xs"><a href="../">OpenAM 13</a> › </span>
      <span class="dropdown" style=""><a class="strong dropdown-toggle nowrap" href="#" data-toggle="dropdown" data-placement="bottom" title="Choose a different book" role="button" aria-haspopup="true" aria-expanded="false"><span data-toggle="tooltip" data-placement="bottom" title="Choose a different book">Developer's Guide<span class="caret"></span></span></a>
       <!--
 * The contents of this file are subject to the terms of the Common Development and
 * Distribution License (the License). You may not use this file except in compliance with the
 * License.
 *
 * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the
 * specific language governing permission and limitations under the License.
 *
 * When distributing Covered Software, include this CDDL Header Notice in each file and include
 * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL
 * Header, with the fields enclosed by brackets [] replaced by your own identifying
 * information: "Portions copyright [year] [name of copyright owner]".
 *
 * Copyright 2017 ForgeRock AS.
--> 
       <ul class="dropdown-menu"> 
        <li><a href="../release-notes/index.html">Release Notes</a></li> 
        <li><a href="../getting-started/index.html">Getting Started</a></li> 
        <li><a href="../install-guide/index.html">Installation Guide</a></li> 
        <li><a href="../upgrade-guide/index.html">Upgrade Guide</a></li> 
        <li><a href="../admin-guide/index.html">Administration Guide</a></li> 
        <li><a href="../dev-guide/index.html">Developer's Guide</a></li> 
        <li><a href="../deployment-planning/index.html">Deployment Planning Guide</a></li> 
        <li><a href="../reference/index.html">Reference</a></li> 
        <li><a href="../apidocs/index.html">API Javadoc</a></li> 
       </ul></span>
     </div>
     <div class="navbar-right navbar-form">
      <form id="secondHeaderSearchForm" role="search" class="form-inline" target="_blank" action="">
       <div class="form-group">
        <div class="input-group input-group-sm">
         <div class="input-group-btn hidden-sm search-panel">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span id="search_concept">Search in</span>&nbsp;<span class="caret"></span></button>
          <ul class="dropdown-menu" role="menu">
           <li><a href="#all">All books</a></li>
           <li class="divider"></li>
           <li><a href="#book">This book</a></li>
           <li><a href="#version">This version</a></li>
           <li><a href="#product">This product</a></li>
          </ul>
         </div>
         <label for="q" class="sr-only">Search</label>
         <input id="q" name="q" placeholder="Search for..." class="input-sm form-control" type="text">
         <span class="input-group-btn"><button type="submit" class="btn btn-default btn-sm" data-toggle="tooltip" data-placement="bottom" title="Search the documentation"><i class="fa fa-search"></i></button></span>
        </div>
        <div class="toolbar-icons">
         <div class="toolbar-icon">
          <div class="btn-link" id="mailFeedbackIcon" data-toggle="tooltip" data-placement="bottom" title="Report documentation feedback" data-mail="docs">
           <i class="fa fa-envelope-open-o"></i>
          </div>
         </div>
         <div class="toolbar-icon">
          <a id="downloadPDFLink" target="_blank" href="../OpenAM-13-Dev-Guide.pdf" data-toggle="tooltip" data-placement="bottom" title="Download PDF"><i class="fa fa-file-pdf-o"></i></a>
         </div>
         <div class="toolbar-icon">
          <div class="btn-link" onclick="window.print()" data-toggle="tooltip" data-placement="bottom" title="Print / export to PDF">
           <i class="fa fa-print"></i>
          </div>
         </div>
         <div class="toolbar-icon" data-placement="bottom" title="About this Document" data-toggle="tooltip">
          <a target="_blank" href="#" data-toggle="modal" data-target="#aboutModal"><i class="fa fa-info-circle"></i></a>
         </div>
        </div>
       </div>
      </form>
     </div>
    </div>
   </div>
  </nav>
  <div class="left-shape-content"></div>
  <div class="container" id="main-content">
   <div class="row">
    <div class="col-sm-3 hidden-xs hidden-print">
     <div id="sidebar" data-clampedwidth=".col-sm-3">
      <div class="displayVersion">
       <span class="updatelabel">Latest update: </span>
       <span class="badge">13.0.0</span>
      </div>
      <ul class="nav nav-stacked hidden-print">
       <li><a href="#preface">Preface</a>
        <ul class="nav nav-stacked hidden-print">
         <li><a href="#who-should-use">1. Who Should Use This Guide</a></li>
         <li><a href="#formatting-conventions">2. Formatting Conventions</a></li>
         <li><a href="#accessing-doc-online">3. Accessing Documentation Online</a></li>
         <li><a href="#joining-the-community">4. Using the ForgeRock.org Site</a></li>
         <li><a href="#sec-support-contact">5. Getting Support and Contacting ForgeRock</a></li>
        </ul></li>
       <li><a href="#chap-api-overview">1. OpenAM APIs and Protocols</a>
        <ul class="nav nav-stacked hidden-print">
         <li><a href="#openam-apis">1.1. OpenAM APIs</a></li>
         <li><a href="#openam-spis">1.2. OpenAM SPIs</a></li>
         <li><a href="#openam-ipv">1.3. OpenAM, IPv4, and IPv6</a></li>
        </ul></li>
       <li><a href="#chap-client-dev">2. Developing Client Applications</a>
        <ul class="nav nav-stacked hidden-print">
         <li><a href="#sec-rest">2.1. Using the REST API</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#about-openam-rest-api">2.1.1. About the RESTful APIs</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#rest-api-versioning">2.1.1.1. REST API Versioning</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#rest-api-versioning-supported-versions">2.1.1.1.1. Supported REST API Versions</a></li>
               <li><a href="#rest-api-explicit-version">2.1.1.1.2. Specifying an Explicit REST API Version</a></li>
               <li><a href="#rest-api-versioning-messages">2.1.1.1.3. REST API Versioning Messages</a></li>
              </ul></li>
             <li><a href="#c66-encoding">2.1.1.2. Token Encoding</a></li>
             <li><a href="#realms-rest">2.1.1.3. Specifying Realms in REST API Calls</a></li>
             <li><a href="#rest-api-auth">2.1.1.4. Authentication &amp; Logout</a></li>
             <li><a href="#rest-api-ssotoken">2.1.1.5. Using the Session Token After Authentication</a></li>
             <li><a href="#rest-api-filter-sort-page">2.1.1.6. Filtering, Sorting, and Paging Results</a></li>
             <li><a href="#rest-api-serverinfo">2.1.1.7. Server Information</a></li>
             <li><a href="#rest-api-tokens">2.1.1.8. Token Validation and Session Information</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#rest-api-token-validation">2.1.1.8.1. Session Token Validation</a></li>
               <li><a href="#rest-api-session-information">2.1.1.8.2. Session Information</a></li>
               <li><a href="#rest-api-session-properties">2.1.1.8.3. Session Properties</a></li>
              </ul></li>
             <li><a href="#rest-api-logging">2.1.1.9. Logging</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#common-audit-logging">2.1.1.9.1. Common Audit Logging of REST API Calls</a></li>
               <li><a href="#legacy-logging">2.1.1.9.2. Legacy Logging of REST API Calls</a></li>
              </ul></li>
             <li><a href="#rest-api-status-codes">2.1.1.10. REST Status Codes</a></li>
            </ul></li>
           <li><a href="#sec-rest-authz-policy">2.1.2. RESTful Authorization and Policy Management Services</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#rest-api-authz">2.1.2.1. About the REST Policy Endpoints</a></li>
             <li><a href="#rest-api-authz-policy-decisions">2.1.2.2. Requesting Policy Decisions</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#rest-api-authz-policy-decision-concrete">2.1.2.2.1. Requesting Policy Decisions For Specific Resources</a></li>
               <li><a href="#rest-api-authz-policy-decision-advice">2.1.2.2.2. Policy Decision Advice</a></li>
               <li><a href="#rest-api-authz-policy-decision-subtree">2.1.2.2.3. Requesting Policy Decisions For a Tree of Resources</a></li>
              </ul></li>
             <li><a href="#rest-api-authz-resource-types">2.1.2.3. Managing Resource Types</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#rest-api-authz-resource-types-query">2.1.2.3.1. Querying Resource Types</a></li>
               <li><a href="#rest-api-authz-resource-types-read">2.1.2.3.2. Reading a Specific Resource Type</a></li>
               <li><a href="#rest-api-authz-resource-types-create">2.1.2.3.3. Creating a Resource Type</a></li>
               <li><a href="#rest-api-authz-resource-types-update">2.1.2.3.4. Updating a Resource Type</a></li>
               <li><a href="#rest-api-authz-resource-types-delete">2.1.2.3.5. Deleting a Specific Resource Type</a></li>
              </ul></li>
             <li><a href="#rest-api-authz-application-types">2.1.2.4. Managing Application Types</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#rest-api-authz-application-types-query">2.1.2.4.1. Querying Application Types</a></li>
               <li><a href="#rest-api-authz-application-types-read">2.1.2.4.2. Reading a Specific Application Type</a></li>
              </ul></li>
             <li><a href="#rest-api-authz-applications">2.1.2.5. Managing Policy Sets</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#rest-api-authz-applications-query">2.1.2.5.1. Querying Policy Sets</a></li>
               <li><a href="#rest-api-authz-applications-read">2.1.2.5.2. Reading a Specific Policy Set</a></li>
               <li><a href="#rest-api-authz-applications-create">2.1.2.5.3. Creating Policy Sets</a></li>
               <li><a href="#rest-api-authz-applications-update">2.1.2.5.4. Updating Policy Sets</a></li>
               <li><a href="#rest-api-authz-applications-delete">2.1.2.5.5. Deleting Policy Sets</a></li>
              </ul></li>
             <li><a href="#rest-api-authz-policies">2.1.2.6. Managing Policies</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#rest-api-authz-policies-query">2.1.2.6.1. Querying Policies</a></li>
               <li><a href="#rest-api-authz-policies-read">2.1.2.6.2. Reading a Specific Policy</a></li>
               <li><a href="#rest-api-authz-policies-create">2.1.2.6.3. Creating Policies</a></li>
               <li><a href="#rest-api-authz-policies-update">2.1.2.6.4. Updating Policies</a></li>
               <li><a href="#rest-api-authz-policies-delete">2.1.2.6.5. Deleting Policies</a></li>
               <li><a href="#rest-api-authz-policies-copy-move-policies">2.1.2.6.6. Copying and Moving Policies</a></li>
              </ul></li>
             <li><a href="#rest-api-manage-xacml">2.1.2.7. Importing and Exporting XACML 3.0</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#xacml-export">2.1.2.7.1. Exporting from OpenAM to XACML</a></li>
               <li><a href="#xacml-import">2.1.2.7.2. Importing from XACML to OpenAM</a></li>
              </ul></li>
             <li><a href="#rest-api-authz-condition-types">2.1.2.8. Managing Environment Condition Types</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#rest-api-authz-condition-types-query">2.1.2.8.1. Querying Environment Condition Types</a></li>
               <li><a href="#rest-api-authz-condition-types-read">2.1.2.8.2. Reading a Specific Environment Condition Type</a></li>
              </ul></li>
             <li><a href="#rest-api-authz-subject-types">2.1.2.9. Managing Subject Condition Types</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#rest-api-authz-subject-types-query">2.1.2.9.1. Querying Subject Condition Types</a></li>
               <li><a href="#rest-api-authz-subject-types-read">2.1.2.9.2. Reading a Specific Subject Condition Type</a></li>
              </ul></li>
             <li><a href="#rest-api-authz-subject-attributes">2.1.2.10. Managing Subject Attributes</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#rest-api-authz-subject-attributes-query">2.1.2.10.1. Querying Subject Attributes</a></li>
              </ul></li>
             <li><a href="#rest-api-authz-decision-combiners">2.1.2.11. Managing Decision Combiners</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#rest-api-authz-decision-combiner-query">2.1.2.11.1. Querying Decision Combiners</a></li>
               <li><a href="#rest-api-authz-decision-combiner-read">2.1.2.11.2. Reading a Specific Decision Combiner</a></li>
              </ul></li>
            </ul></li>
           <li><a href="#sec-rest-oauth2-oidc">2.1.3. RESTful OAuth 2.0, OpenID Connect 1.0 and UMA 1.0 Services</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#rest-api-oauth2">2.1.3.1. OAuth 2.0</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#rest-api-oauth2-client-endpoints">2.1.3.1.1. OAuth 2.0 Client and Resource Server Endpoints</a></li>
               <li><a href="#rest-api-oauth2-device-flow">2.1.3.1.2. Using REST for OAuth 2.0 Device Flow</a></li>
               <li><a href="#rest-api-oauth2-resourceset-endpoint">2.1.3.1.3. OAuth 2.0 Resource Set Endpoint</a></li>
               <li><a href="#rest-api-oauth2-token-admin-endpoint">2.1.3.1.4. OAuth 2.0 Token Administration Endpoint</a></li>
               <li><a href="#rest-api-oauth2-client-admin-endpoint">2.1.3.1.5. OAuth 2.0 Client Administration Endpoint</a></li>
              </ul></li>
             <li><a href="#rest-api-openid-connect">2.1.3.2. OpenID Connect 1.0</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#rest-api-openid-connect-discovery">2.1.3.2.1. Discovering OpenID Connect 1.0 Configuration</a></li>
               <li><a href="#rest-api-openid-connect-dynamic-registration">2.1.3.2.2. Registering OpenID Connect 1.0 Clients</a></li>
               <li><a href="#rest-api-openid-connect-authorization">2.1.3.2.3. Performing OpenID Connect 1.0 Client Authorization</a></li>
               <li><a href="#rest-api-openid-connect-session">2.1.3.2.4. Managing OpenID Connect 1.0 Sessions</a></li>
              </ul></li>
             <li><a href="#sec-rest-uma">2.1.3.3. User-Managed Access (UMA)</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#rest-api-uma-well-known">2.1.3.3.1. Discovering UMA Configuration</a></li>
               <li><a href="#rest-api-uma-resource-set-registration">2.1.3.3.2. Managing UMA Resource Sets</a></li>
               <li><a href="#rest-api-uma-policies">2.1.3.3.3. Managing UMA Policies</a></li>
               <li><a href="#rest-api-uma-access-protected-resources">2.1.3.3.4. Accessing UMA Protected Resources</a></li>
              </ul></li>
            </ul></li>
           <li><a href="#sec-rest-user-services">2.1.4. RESTful User Self-Service</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#common-self-registration">2.1.4.1. Registering Users</a></li>
             <li><a href="#common-forgotten-username">2.1.4.2. Retrieving Forgotten Usernames</a></li>
             <li><a href="#common-forgotten-password">2.1.4.3. Replacing Forgotten Passwords</a></li>
             <li><a href="#rest-dashboard">2.1.4.4. Displaying Dashboard Applications</a></li>
             <li><a href="#rest-api-device-profile-reset">2.1.4.5. Resetting Device Profiles</a></li>
            </ul></li>
           <li><a href="#sec-rest-identity-realm-mgmt">2.1.5. RESTful Identity and Realm Management Services</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#rest-api-crud-identity">2.1.5.1. Identity Management</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#rest-api-create-identity">2.1.5.1.1. Creating Identities</a></li>
               <li><a href="#rest-api-read-identity">2.1.5.1.2. Reading Identities</a></li>
               <li><a href="#rest-api-update-identity">2.1.5.1.3. Updating Identities</a></li>
               <li><a href="#rest-api-delete-identity">2.1.5.1.4. Deleting Identities</a></li>
               <li><a href="#rest-api-query-identity">2.1.5.1.5. Listing Identities</a></li>
               <li><a href="#rest-api-retrieve-identity-using-session-cookie">2.1.5.1.6. Retrieving Identities Using the Session Cookie</a></li>
               <li><a href="#rest-api-change-password">2.1.5.1.7. Changing Passwords</a></li>
              </ul></li>
             <li><a href="#rest-api-crud-realm">2.1.5.2. Realm Management</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#rest-api-parameters-realm">2.1.5.2.1. Default Parameters for Realms</a></li>
               <li><a href="#rest-api-create-realm">2.1.5.2.2. Creating Realms</a></li>
               <li><a href="#rest-api-read-realm">2.1.5.2.3. Reading Realms</a></li>
               <li><a href="#rest-api-list-realm">2.1.5.2.4. Listing Realms</a></li>
               <li><a href="#rest-api-update-realm">2.1.5.2.5. Updating Realms</a></li>
               <li><a href="#rest-api-delete-realm">2.1.5.2.6. Deleting Realms</a></li>
              </ul></li>
            </ul></li>
           <li><a href="#sec-manage-scripts-rest">2.1.6. RESTful Script Management</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#rest-api-scripts-query">2.1.6.1. Querying Scripts</a></li>
             <li><a href="#rest-api-scripts-read">2.1.6.2. Reading a Script</a></li>
             <li><a href="#rest-api-scripts-validate">2.1.6.3. Validating a Script</a></li>
             <li><a href="#rest-api-scripts-create">2.1.6.4. Creating a Script</a></li>
             <li><a href="#rest-api-scripts-update">2.1.6.5. Updating a Script</a></li>
             <li><a href="#rest-api-scripts-delete">2.1.6.6. Deleting a Script</a></li>
            </ul></li>
           <li><a href="#sec-rest-api-recording">2.1.7. RESTful Troubleshooting Information Recording</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#rest-api-records-start">2.1.7.1. Starting a Recording Event</a></li>
             <li><a href="#rest-api-records-get-status">2.1.7.2. Getting the Status of a Recording Event</a></li>
             <li><a href="#rest-api-records-stop">2.1.7.3. Stopping a Recording Event</a></li>
            </ul></li>
          </ul></li>
         <li><a href="#sec-sdk">2.2. Using the OpenAM Java SDK</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#install-sdk-samples">2.2.1. Installing OpenAM Client SDK Samples</a></li>
           <li><a href="#about-sdk">2.2.2. About the OpenAM Java SDK</a></li>
           <li><a href="#sec-authentication">2.2.3. Authenticating Using OpenAM Java SDK</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#encoding-pwds">2.2.3.1. Encoding Passwords and Password Reset Questions and Answers</a></li>
            </ul></li>
           <li><a href="#sec-session">2.2.4. Handling Single Sign-On Using OpenAM Java SDK</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#session-receiving-notifications">2.2.4.1. Receiving Notifications</a></li>
            </ul></li>
           <li><a href="#sec-policy-decisions">2.2.5. Requesting Policy Decisions Using OpenAM Java SDK</a></li>
           <li><a href="#sec-xacml">2.2.6. Requesting a XACML Policy Decision Using OpenAM Java SDK</a></li>
          </ul></li>
         <li><a href="#sec-csdk">2.3. Using the OpenAM C SDK</a></li>
        </ul></li>
       <li><a href="#chap-fedlets">3. Building SAML v2.0 Service Providers With Fedlets</a>
        <ul class="nav nav-stacked hidden-print">
         <li><a href="#sec-fedlet-java">3.1. Using Fedlets in Java Web Applications</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#create-install-java-fedlet">3.1.1. Creating &amp; Installing a Java Fedlet</a></li>
           <li><a href="#fedlet-signing-encryption">3.1.2. Signing &amp; Encryption For a Fedlet</a></li>
           <li><a href="#customize-java-fedlet">3.1.3. Customizing a Java Fedlet</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#fedlet-perform-sso">3.1.3.1. Performing Single Sign-On</a></li>
             <li><a href="#fedlet-perform-slo">3.1.3.2. Performing Single Logout</a></li>
             <li><a href="#fedlet-perform-attr-query">3.1.3.3. Performing Attribute Queries</a></li>
             <li><a href="#fedlet-perform-xacml-query">3.1.3.4. Performing XACML Queries</a></li>
            </ul></li>
          </ul></li>
         <li><a href="#sec-fedlet-unconfigured">3.2. Configuring Java Fedlets By Hand</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#unconfigured-fedlet-conf">3.2.1. Java Fedlet Layout</a></li>
           <li><a href="#unconfigured-fedlet-properties">3.2.2. Configuring Java Fedlet Properties</a></li>
           <li><a href="#unconfigured-fedlet-cot">3.2.3. Configuring Circles of Trust</a></li>
           <li><a href="#unconfigured-fedlet-idp">3.2.4. Configuring the Identity Providers</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#unconfigured-fedlet-idp-standard">3.2.4.1. Identity Provider Standard XML</a></li>
             <li><a href="#unconfigured-fedlet-idp-extended">3.2.4.2. Identity Provider Extended XML</a></li>
            </ul></li>
           <li><a href="#unconfigured-fedlet-sp">3.2.5. Configuring the Service Providers</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#unconfigured-fedlet-sp-standard">3.2.5.1. Service Provider Standard XML</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#unconfigured-fedlet-sp-standard-sso">3.2.5.1.1. Single Sign-On and Logout: SPSSODescriptor Element</a></li>
               <li><a href="#unconfigured-fedlet-sp-standard-attr-query">3.2.5.1.2. Attribute Queries: RoleDescriptor Element</a></li>
               <li><a href="#unconfigured-fedlet-sp-standard-xacml">3.2.5.1.3. XACML Requests: XACMLAuthzDecisionQueryDescriptor Element</a></li>
              </ul></li>
             <li><a href="#unconfigured-fedlet-sp-extended">3.2.5.2. Service Provider Extended XML</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#unconfigured-fedlet-sp-extended-spssoconfig">3.2.5.2.1. Service Provider Extended XML: SPSSOConfig Settings</a></li>
               <li><a href="#unconfigured-fedlet-sp-extended-attributequeryconfig">3.2.5.2.2. Service Provider Extended XML: AttributeQueryConfig Settings</a></li>
               <li><a href="#unconfigured-fedlet-sp-extended-xacmlauthzdecisionqueryconfig">3.2.5.2.3. Service Provider Extended XML: XACMLAuthzDecisionQueryConfig Settings</a></li>
              </ul></li>
            </ul></li>
           <li><a href="#unconfigured-fedlet-embedding">3.2.6. Embedding the Java Fedlet in a Web Application</a></li>
          </ul></li>
        </ul></li>
       <li><a href="#chap-customizing">4. Customizing OpenAM</a>
        <ul class="nav nav-stacked hidden-print">
         <li><a href="#sec-custom-attr">4.1. Customizing Profile Attributes</a></li>
         <li><a href="#sec-oauth2-scopes">4.2. Customizing OAuth 2.0 Scope Handling</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#design-oauth2-scopes-plugin">4.2.1. Designing an OAuth 2.0 Scope Validator Plugin</a></li>
           <li><a href="#build-oauth2-scopes-plugin">4.2.2. Building the OAuth 2.0 Scope Validator Sample Plugin</a></li>
           <li><a href="#configure-oauth2-scopes-plugin">4.2.3. Configuring OpenAM to Use the Plugin</a></li>
           <li><a href="#try-oauth2-scopes-plugin">4.2.4. Trying the Sample Plugin</a></li>
          </ul></li>
         <li><a href="#sec-auth-spi">4.3. Customizing Authentication Modules</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#about-custom-auth-module">4.3.1. About the Sample Authentication Module</a></li>
           <li><a href="#properties-sample-auth-module">4.3.2. Sample Auth Properties</a></li>
           <li><a href="#callbacks-file-sample-auth-module">4.3.3. Sample Auth Callbacks</a></li>
           <li><a href="#authentication-logic-sample-auth-module">4.3.4. The Sample Authentication Logic</a></li>
           <li><a href="#principal-sample-auth-module">4.3.5. The Sample Auth Principal</a></li>
           <li><a href="#service-conf-sample-auth-module">4.3.6. The Sample Auth Service Configuration</a></li>
           <li><a href="#build-config-sample-auth-module">4.3.7. Building &amp; Installing the Sample Auth Module</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#building-sample-auth-module">4.3.7.1. Building the Module</a></li>
             <li><a href="#installing-sample-auth-module">4.3.7.2. Installing the Module</a></li>
            </ul></li>
           <li><a href="#configuring-testing-sample-auth-module">4.3.8. Configuring &amp; Testing the Sample Auth Module</a></li>
          </ul></li>
         <li><a href="#sec-custom-quota-exhaustion-action">4.4. Customizing Session Quota Exhaustion Actions</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#create-custom-quota-exhaustion-action">4.4.1. Creating &amp; Installing a Custom Session Quota Exhaustion Action</a></li>
           <li><a href="#list-custom-quota-exhaustion-actions">4.4.2. Listing Session Quota Exhaustion Actions</a></li>
           <li><a href="#remove-custom-quota-exhaustion-actions">4.4.3. Removing a Session Quota Exhaustion Action</a></li>
          </ul></li>
         <li><a href="#sec-policy-spi">4.5. Customizing Policy Evaluation</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#about-sample-policy-plugins">4.5.1. About the Sample Plugin</a></li>
           <li><a href="#add-custom-policy-impl-to-existing-apps">4.5.2. Adding Custom Policy Implementations to Existing Policy Applications</a></li>
           <li><a href="#trying-sample-policy-plugin">4.5.3. Trying the Sample Subject and Environment Conditions</a></li>
           <li><a href="#trying-custom-policy-resource-attributes">4.5.4. Trying the Sample Resource Attributes</a></li>
           <li><a href="#extend-ssoadm-classpath">4.5.5. Extending the ssoadm Classpath</a></li>
          </ul></li>
         <li><a href="#sec-identity-repo-spi">4.6. Customizing Identity Data Storage</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#about-idrepo-plugin">4.6.1. About the Identity Repository Plugin</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#idrepo-plugin-inheritance">4.6.1.1. IdRepo Inheritance</a></li>
             <li><a href="#idrepo-plugin-lifecycle">4.6.1.2. IdRepo Lifecycle</a></li>
             <li><a href="#idrepo-plugin-capabilities">4.6.1.3. IdRepo Plugin Capabilities</a></li>
            </ul></li>
           <li><a href="#idrepo-plugin-implementation">4.6.2. Identity Repository Plugin Implementation</a></li>
           <li><a href="#idrepo-plugin-deployment">4.6.3. Identity Repository Plugin Deployment</a></li>
          </ul></li>
        </ul></li>
       <li><a href="#chap-extending">5. Extending OpenAM</a>
        <ul class="nav nav-stacked hidden-print">
         <li><a href="#sec-post-auth">5.1. Creating a Post Authentication Plugin</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#design-post-authentication-plugin">5.1.1. Designing Your Post Authentication Plugin</a></li>
           <li><a href="#build-post-authentication-plugin">5.1.2. Building Your Sample Post Authentication Plugin</a></li>
           <li><a href="#configure-post-authentication-plugin">5.1.3. Configuring Your Post Authentication Plugin</a></li>
           <li><a href="#test-post-authentication-plugin">5.1.4. Testing Your Post Authentication Plugin</a></li>
          </ul></li>
         <li><a href="#sec-uma-extension-points">5.2. Extending UMA Workflow with Extension Points</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#ext-resource-registration">5.2.1. Resource Set Registration Extension Point</a></li>
           <li><a href="#ext-permission-requests">5.2.2. Permission Request Extension Point</a></li>
           <li><a href="#ext-authorization-requests">5.2.3. Authorization Request Extension Point</a></li>
           <li><a href="#ext-resource-delegation">5.2.4. Resource Sharing Extension Point</a></li>
          </ul></li>
        </ul></li>
       <li><a href="#chap-scripting">6. Scripting OpenAM</a>
        <ul class="nav nav-stacked hidden-print">
         <li><a href="#script-env">6.1. The Scripting Environment</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#script-engine-security">6.1.1. Security</a></li>
           <li><a href="#script-engine-thread-pool">6.1.2. Thread Pools</a></li>
          </ul></li>
         <li><a href="#scripting-api">6.2. The Scripting API</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#scripting-api-global">6.2.1. Global API Functionality</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#scripting-api-global-http-client">6.2.1.1. Accessing HTTP Services</a></li>
             <li><a href="#scripting-api-global-logger">6.2.1.2. Debug Logging</a></li>
            </ul></li>
           <li><a href="#scripting-api-authn">6.2.2. Authentication API Functionality</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#scripting-api-authn-state">6.2.2.1. Accessing Authentication State</a></li>
             <li><a href="#scripting-api-authn-id-repo">6.2.2.2. Accessing Profile Data</a></li>
             <li><a href="#scripting-api-authn-client-data">6.2.2.3. Accessing Client-Side Script Output Data</a></li>
             <li><a href="#scripting-api-authn-request-data">6.2.2.4. Accessing Request Data</a></li>
            </ul></li>
           <li><a href="#scripting-api-authz">6.2.3. Authorization API Functionality</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#scripted-api-authz-state">6.2.3.1. Accessing Authorization State</a></li>
             <li><a href="#scripting-api-authz-id-repo">6.2.3.2. Accessing Profile Data</a></li>
             <li><a href="#scripting-api-authz-session">6.2.3.3. Accessing Session Data</a></li>
             <li><a href="#scripting-api-authz-response">6.2.3.4. Setting Authorization Responses</a></li>
            </ul></li>
           <li><a href="#scripting-api-oidc-claims">6.2.4. OIDC Claims API Functionality</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#scripted-api-oidc-request">6.2.4.1. Accessing OpenID Connect Requests</a></li>
            </ul></li>
          </ul></li>
         <li><a href="#sec-scripting-default-scripts">6.3. Using the Default Scripts</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#sec-scripted-auth-module">6.3.1. Default Server-side Authentication Script</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#sec-scripted-auth-module-prepare">6.3.1.1. Preparing OpenAM</a></li>
             <li><a href="#scripted-auth-module-try-it-out">6.3.1.2. Trying the Default Server-side Authentication Script</a></li>
            </ul></li>
           <li><a href="#sec-scripted-policy-condition">6.3.2. Default Policy Condition Script</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#sec-scripted-policy-condition-prepare">6.3.2.1. Preparing OpenAM</a></li>
             <li><a href="#sec-scripted-policy-condition-evaluate">6.3.2.2. Trying the Default Policy Condition Script</a></li>
            </ul></li>
           <li><a href="#sec-scripted-oidc-claims">6.3.3. Default OIDC Claims Script</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#sec-scripted-oidc-claims-prepare">6.3.3.1. Preparing OpenAM</a></li>
             <li><a href="#scripted-oidc-claims-try-it-out">6.3.3.2. Trying the Default OIDC Claims Script</a></li>
            </ul></li>
          </ul></li>
        </ul></li>
       <li><a href="#chap-sts">7. Working With the Security Token Service</a>
        <ul class="nav nav-stacked hidden-print">
         <li><a href="#sts-publish">7.1. Publishing STS Instances</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#sts-publish-service">7.1.1. The Publish Service</a></li>
           <li><a href="#sts-publish-rest">7.1.2. Publishing REST STS Instances</a></li>
           <li><a href="#sts-publish-soap">7.1.3. Publishing SOAP STS Instances</a></li>
          </ul></li>
         <li><a href="#sts-consume">7.2. Consuming STS Instances</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#sts-consume-rest">7.2.1. Consuming REST STS Instances</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#sts-consume-rest-endpoint">7.2.1.1. REST STS Instance Endpoint</a></li>
             <li><a href="#sts-consume-json-payload">7.2.1.2. JSON Representation of Token Transformations</a></li>
             <li><a href="#sts-consume-rest-cli">7.2.1.3. Command-Line Example</a></li>
             <li><a href="#sts-consume-rest-programmatic">7.2.1.4. Java Example</a></li>
            </ul></li>
           <li><a href="#sts-consume-soap">7.2.2. Consuming SOAP STS Instances</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#sts-consume-soap-endpoint">7.2.2.1. SOAP STS Instance URL</a></li>
             <li><a href="#sts-consume-soap-messages">7.2.2.2. Consuming SOAP STS Instances Using SOAP Messages</a></li>
             <li><a href="#sts-consume-soap-client-sdk">7.2.2.3. Consuming SOAP STS Instances Using the OpenAM SOAP STS Client SDK</a>
              <ul class="nav nav-stacked hidden-print">
               <li><a href="#sts-consume-soap-client-sdk-about">7.2.2.3.1. About the SOAP STS Client SDK</a></li>
               <li><a href="#sts-consume-soap-client-sdk-build">7.2.2.3.2. Building a SOAP STS Client SDK .jar File</a></li>
              </ul></li>
            </ul></li>
          </ul></li>
         <li><a href="#sts-query-validate-cancel">7.3. Querying, Validating, and Canceling Tokens</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#sts-query-validate-cancel-sts-tokengen">7.3.1. Invoking the sts-tokengen Endpoint</a>
            <ul class="nav nav-stacked hidden-print">
             <li><a href="#sts-query-validate-cancel-sts-tokengen-query">7.3.1.1. Querying Tokens</a></li>
             <li><a href="#sts-query-validate-cancel-sts-tokengen-cancel">7.3.1.2. Cancelling Tokens</a></li>
            </ul></li>
           <li><a href="#query-validate-cancel-rest-sts-instance">7.3.2. Validating and Cancelling Tokens by Invoking a REST STS Instance</a></li>
           <li><a href="#query-validate-cancel-soap-sts-instance">7.3.3. Validating and Cancelling Tokens by Invoking a SOAP STS Instance</a></li>
          </ul></li>
         <li><a href="#sts-custom-token-types">7.4. Extending STS to Support Custom Token Types</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#sts-consume-rest-custom-validator">7.4.1. Developing Custom Token Type Validator Classes</a></li>
           <li><a href="#sts-consume-rest-custom-provider">7.4.2. Developing Custom Token Type Provider Classes</a></li>
           <li><a href="#sts-consume-rest-custom-using">7.4.3. Using Custom Token Type Validators and Providers</a></li>
          </ul></li>
        </ul></li>
       <li><a href="#chap-sae">8. Using Secure Attribute Exchange</a>
        <ul class="nav nav-stacked hidden-print">
         <li><a href="#sae-install-prerequisites">8.1. Installing the Samples</a></li>
         <li><a href="#sae-security-prerequisites">8.2. Preparing to Secure SAE Communications</a></li>
         <li><a href="#sae-secure-idp">8.3. Securing the Identity Provider Side</a></li>
         <li><a href="#sae-secure-sp">8.4. Securing the Service Provider Side</a></li>
         <li><a href="#sae-trying-it-out">8.5. Trying It Out</a></li>
        </ul></li>
       <li><a href="#appendix-deprecated-apis">A. Deprecated REST APIs</a>
        <ul class="nav nav-stacked hidden-print">
         <li><a href="#deprecated-session-apis-auth">A.1. Deprecated Session Information APIs</a></li>
         <li><a href="#deprecated-self-service">A.2. Deprecated Self-Service APIs</a>
          <ul class="nav nav-stacked hidden-print">
           <li><a href="#deprecated-rest-api-self-registration">A.2.1. Legacy User Self-Registration</a></li>
           <li><a href="#deprecated-rest-api-password-reset">A.2.2. Legacy Forgotten Password Reset</a></li>
          </ul></li>
        </ul></li>
       <li><a href="#index">Index</a></li>
      </ul>
     </div>
    </div>
    <div id="doc-content" class="col-sm-9">
     <div id="doc-content-abstract">
      <p>Guide to developing OpenAM client applications and service providers. OpenAM provides open source Authentication, Authorization, Entitlement and Federation software.</p>
     </div>
     <div lang="" class="preface" id="preface">
      <div class="titlepage">
       <div>
        <div>
         <h1 class="title">Preface</h1>
        </div>
       </div>
      </div>
      <p> This guide demonstrates how to handle sessions to permit single sign-on and single logout in OpenAM client applications. This guide further demonstrates how to use the OpenAM APIs including both APIs for client applications, and also SPIs for authentication, policy, service management, delegation, and identity storage. Finally, this guide demonstrates how to write your own web policy agent. </p>
      <div class="section" id="who-should-use">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">1.&nbsp;Who Should Use This Guide</h2>
         </div>
        </div>
       </div>
       <p> This guide is written for developers who adapt client applications to use OpenAM access management capabilities. It is also written for designers and developers extending and integrating OpenAM services for their organizations. </p>
       <p> You do not need to be an OpenAM wizard to learn something from this guide, though a background in access management and developing web applications or developing for web and application servers can help. You can nevertheless get started with this guide, and then learn more as you go along. </p>
      </div>
      <div lang="en" class="section" id="formatting-conventions">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">2.&nbsp;Formatting Conventions</h2>
         </div>
        </div>
       </div>
       <p> Most examples in the documentation are created in GNU/Linux or Mac OS X operating environments. If distinctions are necessary between operating environments, examples are labeled with the operating environment name in parentheses. To avoid repetition file system directory names are often given only in UNIX format as in <code class="filename">/path/to/server</code>, even if the text applies to <code class="filename">C:\path\to\server</code> as well. </p>
       <p> Absolute path names usually begin with the placeholder <code class="filename">/path/to/</code>. This path might translate to <code class="filename">/opt/</code>, <code class="filename">C:\Program Files\</code>, or somewhere else on your system. </p>
       <p> Command-line, terminal sessions are formatted as follows: </p>
       <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">echo $JAVA_HOME</strong>
<em class="computeroutput">/path/to/jdk</em></pre>
       <p> Command output is sometimes formatted for narrower, more readable output even though formatting parameters are not shown in the command. </p>
       <p> Program listings are formatted as follows: </p>
       <pre class="codelisting prettyprint java">class Test {
    public static void main(String [] args)  {
        System.out.println("This is a program listing.");
    }
}</pre>
      </div>
      <div lang="en" class="section" id="accessing-doc-online">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">3.&nbsp;Accessing Documentation Online</h2>
         </div>
        </div>
       </div>
       <div class="itemizedlist">
        <p> ForgeRock publishes comprehensive documentation online: </p>
        <ul class="itemizedlist" style="list-style-type: disc; ">
         <li class="listitem"><p> The ForgeRock <a class="link" href="https://backstage.forgerock.com/knowledge/kb" target="_blank">Knowledge Base</a> offers a large and increasing number of up-to-date, practical articles that help you deploy and manage ForgeRock software. </p><p> While many articles are visible to community members, ForgeRock customers have access to much more, including advanced information for customers using ForgeRock software in a mission-critical capacity. </p></li>
         <li class="listitem"><p> ForgeRock product documentation, such as this document, aims to be technically accurate and complete with respect to the software documented. It is visible to everyone and covers all product features and examples of how to use them. </p></li>
        </ul>
       </div>
      </div>
      <div lang="en" class="section" id="joining-the-community">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">4.&nbsp;Using the ForgeRock.org Site</h2>
         </div>
        </div>
       </div>
       <p> The <a class="link" href="https://forgerock.org" target="_blank">ForgeRock.org site</a> has links to source code for ForgeRock open source software, as well as links to the ForgeRock forums and technical blogs. </p>
       <p> If you are a <span class="emphasis"><em>ForgeRock customer</em></span>, raise a support ticket instead of using the forums. ForgeRock support professionals will get in touch to help you. </p>
      </div>
      <div lang="en" class="section" id="sec-support-contact">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">5.&nbsp;Getting Support and Contacting ForgeRock</h2>
         </div>
        </div>
       </div>
       <p> ForgeRock provides support services, professional services, classes through ForgeRock University, and partner services to assist you in setting up and maintaining your deployments. For a general overview of these services, see <a class="link" href="https://www.forgerock.com" target="_blank">https://www.forgerock.com</a>. </p>
       <p> ForgeRock has staff members around the globe who support our international customers and partners. For details, visit <a class="link" href="https://www.forgerock.com" target="_blank">https://www.forgerock.com</a>, or send an email to ForgeRock at <a class="link" href="mailto:info@forgerock.com" target="_blank">info@forgerock.com</a>. </p>
      </div>
     </div>
     <div lang="" class="chapter" id="chap-api-overview">
      <div class="titlepage">
       <div>
        <div>
         <h1 class="title">Chapter&nbsp;1.&nbsp;OpenAM APIs and Protocols</h1>
        </div>
       </div>
      </div>
      <p> Although policy agents and standards support make it possible for applications to use OpenAM for access management without changing your code, some deployments require tighter integration, or direct use of supported protocols and OpenAM APIs. </p>
      <p> OpenAM supports a range of protocols and APIs that allow you not only to define specifically how access is managed in your client applications, but also to extend OpenAM capabilities to meet even those deployment requirements not yet covered in OpenAM. </p>
      <p> This short chapter presents an overview of the APIs and protocols that OpenAM supports. </p>
      <div class="mediaobject" align="center" id="figure-openam-apis-overview">
       <a class="fancybox" href="images/openam-apis-overview.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openam-apis-overview.png" align="middle" alt="High-level view of OpenAM APIs and SPIs" title="OpenAM APIs and SPIs are shown in this diagram in orange, and
   briefly described in the following sections."></a>
      </div>
      <p> This guide primarily covers the OpenAM client APIs and SPIs, with an emphasis on the Java APIs. </p>
      <div class="section" id="openam-apis">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">1.1.&nbsp;OpenAM APIs</h2>
         </div>
        </div>
       </div>
       <p> OpenAM provides client application programming interfaces for a variety of needs. </p>
       <div class="itemizedlist">
        <ul class="itemizedlist" style="list-style-type: disc; ">
         <li class="listitem"><p> The OpenAM Java APIs provided through the OpenAM Java SDK let your Java and Java EE applications call on OpenAM for authentication, and authorization in both OpenAM and federated environments.</p><p>Detailed reference information is provided in the <a class="link" href="https://backstage.forgerock.com/static/docs/openam/13/apidocs/" target="_blank"><em class="citetitle">OpenAM Java SDK API Specification</em></a>. </p></li>
         <li class="listitem"><p> The C SDK also provides APIs for native applications, such as new web server policy agents. The C SDK is delivered with OpenAM for Linux, Solaris, and Windows platforms. </p></li>
         <li class="listitem"><p> OpenAM exposes a RESTful API that can return JSON or XML over HTTP, allowing you to access authentication, authorization, and identity services from your web applications using REST clients in the language of your choice. </p></li>
        </ul>
       </div>
      </div>
      <div class="section" id="openam-spis">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">1.2.&nbsp;OpenAM SPIs</h2>
         </div>
        </div>
       </div>
       <p> OpenAM provides Java based service provider interfaces to let you extend services for the requirements of your particular deployment. </p>
       <div class="itemizedlist">
        <p> Some examples of the plugins you can write follow in the list below. This guide demonstrates how to implement such plugins. </p>
        <ul class="itemizedlist" style="list-style-type: disc; ">
         <li class="listitem"><p> Custom OAuth 2.0 scopes plugins define how OpenAM, when playing the role of authorization server, handles scopes, including which token information to return for scopes set when authorization was granted. </p></li>
         <li class="listitem"><p> Custom authentication plugins let OpenAM authenticate users against a new authentication service or an authentication service specific to your deployment </p></li>
         <li class="listitem"><p> Post authentication plugins perform additional processing at the end of the authentication process, but before the subject is authenticated. Post authentication plugins can, for example, store information about the authentication in the user's profile, or call another system for audit logging purposes. </p></li>
         <li class="listitem"><p> Policy evaluation plugins implement new policy conditions, send attributes from the user profile as part of a policy response, extend the definition of the subjects to whom the policy applies, or customize how policy management is delegated. </p></li>
         <li class="listitem"><p> Identity repository plugins let OpenAM employ a new or custom user data store, other than a directory server or JDBC-accessible database. </p></li>
        </ul>
       </div>
      </div>
      <div class="section" id="openam-ipv">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">1.3.&nbsp;OpenAM, IPv4, and IPv6</h2>
         </div>
        </div>
       </div>
       <p> OpenAM provides functionality for IPv4, IPv6, and a hybrid of the two. While the majority of the interaction is done on the backend, there are a few places where the GUI requires some inputs, such as setting up policy conditions. These areas follow the same standard that applies to IPv4 and IPv6. IPv4 uses a 32-bit integer value, with a dot-decimal system. IPv6 uses a hexadecimal system, and the eight groups of hexadecimal digits are separated by a colon. </p>
      </div>
     </div>
     <div lang="" class="chapter" id="chap-client-dev">
      <div class="titlepage">
       <div>
        <div>
         <h1 class="title">Chapter&nbsp;2.&nbsp;Developing Client Applications</h1>
        </div>
       </div>
      </div>
      <p> Client applications access OpenAM services for authentication, authorization, and single sign-on/single logout through the use of sessions. Client applications can also be allowed to manage authorization policies. </p>
      <p> Client application integration with OpenAM can be coupled loosely, as in the case of an application running in a web server with an OpenAM policy agent to handle interaction with OpenAM service, more directly, as in the case where the client interacts with OpenAM over protocol, or tightly, as in the case of an application using the OpenAM Java or C API to interact with OpenAM services. </p>
      <p> This chapter covers client interaction with OpenAM using OpenAM APIs over supported protocols. </p>
      <div class="section" id="sec-rest">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">2.1.&nbsp;Using the REST API</h2>
         </div>
        </div>
       </div>
       <a class="indexterm" name="d14232e380"></a>
       <p> This section shows how to use the OpenAM RESTful interfaces for direct integration between web client applications and OpenAM. </p>
       <div class="section" id="about-openam-rest-api">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">2.1.1.&nbsp;About the RESTful APIs</h3>
          </div>
         </div>
        </div>
        <p> <a class="link" href="http://en.wikipedia.org/wiki/Representational_state_transfer" target="_blank">Representational State Transfer</a> (REST) is an architectural style that sets certain constraints for designing and building large-scale distributed hypermedia systems. </p>
        <p> As an architectural style, REST has very broad applications. The designs of both HTTP 1.1 and URIs follow RESTful principles. The World Wide Web is no doubt the largest and best known REST application. Many other web services also follow the REST architectural style. Examples include OAuth 2.0, OpenID Connect 1.0, and User-Managed Access (UMA) 1.0. </p>
        <p> ForgeRock Common REST (CREST) applies RESTful principles to define common verbs for HTTP-based APIs that access web resources and collections of web resources. </p>
        <p> Native OpenAM REST APIs in version 11.0.0 and later use the CREST verbs. (In contrast, OAuth 2.0, OpenID Connect 1.0 and UMA 1.0 APIs follow their respective standards.) APIs covered in <a href="../dev-guide/index.html#appendix-deprecated-apis" class="link">Deprecated REST APIs</a> predate CREST, do not use the CREST verbs, and are deprecated in OpenAM 13. </p>
        <p> When using a CREST API, you use the common verbs as query string parameters in resource and resource collection URIs. </p>
        <div class="variablelist">
         <p> CREST APIs use these verbs: </p>
         <dl class="variablelist">
          <dt>
           <span class="term">create</span>
          </dt>
          <dd>
           <p> Add a new resource. </p>
           <p> Create maps to HTTP POST (or PUT). </p>
          </dd>
          <dt>
           <span class="term">read</span>
          </dt>
          <dd>
           <p> Retrieve a single resource. </p>
           <p> Read maps to HTTP GET. </p>
          </dd>
          <dt>
           <span class="term">update</span>
          </dt>
          <dd>
           <p> Replace an existing resource. </p>
           <p> Update maps to HTTP PUT. </p>
          </dd>
          <dt>
           <span class="term">delete</span>
          </dt>
          <dd>
           <p> Remove an existing resource. </p>
           <p> Delete maps to HTTP DELETE. </p>
          </dd>
          <dt>
           <span class="term">patch</span>
          </dt>
          <dd>
           <p> Modify part of an existing resource </p>
           <p> Patch maps to HTTP PATCH. </p>
          </dd>
          <dt>
           <span class="term">_action</span>
          </dt>
          <dd>
           <p> Perform a predefined action. </p>
           <p> Action maps to HTTP POST. </p>
           <p> The generic <code class="literal">_action</code> verb extends the API's capabilities where none of the other standard CREST verbs fit, as in <code class="literal">_action=logout</code>. </p>
          </dd>
          <dt>
           <span class="term">query</span>
          </dt>
          <dd>
           <p> Search a collection of resources. </p>
           <p> Query maps to HTTP GET. </p>
          </dd>
         </dl>
        </div>
        <p> <acronym class="acronym">CRUDPAQ</acronym> is an acronym for the verbs. Notice that reserved words in CREST, such as the verbs, start with underscores (<code class="literal">_</code>). </p>
        <p> In CREST, you can address resources in collections of resources by their unique identifiers, their IDs. IDs are exposed in the resource URIs as in <code class="literal">/users/<em class="replaceable">id</em></code> and <code class="literal">/groups/<em class="replaceable">id</em></code>. The ID is also in the <code class="literal">_id</code> field of the resource. </p>
        <p> In CREST, resources are versioned using revision numbers. A revision is specified in the resource's <code class="literal">_rev</code> field. Revisions make it possible to figure out whether to apply changes without resource locking and without distributed transactions. </p>
        <p> In CREST, you can explicitly request API versions. This means that OpenAM can continue to support older API versions as well as newer API versions as developers migrate their applications to take advantage of capabilities provided by newer APIs. </p>
        <p> Interface Stability: <a href="../admin-guide/index.html#interface-stability" class="olink">Evolving</a> </p>
        <p> OpenAM offers RESTful APIs for access and identity management as follows: </p>
        <div class="itemizedlist">
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p><a class="xref" href="#rest-api-auth" title="2.1.1.4.&nbsp;Authentication &amp; Logout">Authentication &amp; Logout</a></p></li>
          <li class="listitem"><p><a class="xref" href="#rest-api-tokens" title="2.1.1.8.&nbsp;Token Validation and Session Information">Token Validation and Session Information</a></p></li>
          <li class="listitem"><p><a class="xref" href="#rest-api-logging" title="2.1.1.9.&nbsp;Logging">Logging</a></p></li>
          <li class="listitem"><p><a class="xref" href="#sec-rest-authz-policy" title="2.1.2.&nbsp;RESTful Authorization and Policy Management Services">RESTful Authorization and Policy Management Services</a></p></li>
          <li class="listitem"><p><a class="xref" href="#rest-api-oauth2" title="2.1.3.1.&nbsp;OAuth 2.0">OAuth 2.0</a></p></li>
          <li class="listitem"><p><a class="xref" href="#rest-api-openid-connect" title="2.1.3.2.&nbsp;OpenID Connect 1.0">OpenID Connect 1.0</a></p></li>
          <li class="listitem"><p><a class="xref" href="#sec-rest-uma" title="2.1.3.3.&nbsp;User-Managed Access (UMA)">User-Managed Access (UMA)</a></p></li>
          <li class="listitem"><p><a class="xref" href="#common-self-registration" title="2.1.4.1.&nbsp;Registering Users">Registering Users</a></p></li>
          <li class="listitem"><p><a class="xref" href="#common-forgotten-username" title="2.1.4.2.&nbsp;Retrieving Forgotten Usernames">Retrieving Forgotten Usernames</a></p></li>
          <li class="listitem"><p><a class="xref" href="#common-forgotten-password" title="2.1.4.3.&nbsp;Replacing Forgotten Passwords">Replacing Forgotten Passwords</a></p></li>
          <li class="listitem"><p><a class="xref" href="#rest-dashboard" title="2.1.4.4.&nbsp;Displaying Dashboard Applications">Displaying Dashboard Applications</a></p></li>
          <li class="listitem"><p><a class="xref" href="#rest-api-device-profile-reset" title="2.1.4.5.&nbsp;Resetting Device Profiles">Resetting Device Profiles</a></p></li>
          <li class="listitem"><p><a class="xref" href="#rest-api-crud-identity" title="2.1.5.1.&nbsp;Identity Management">Identity Management</a></p></li>
          <li class="listitem"><p><a class="xref" href="#rest-api-crud-realm" title="2.1.5.2.&nbsp;Realm Management">Realm Management</a></p></li>
          <li class="listitem"><p><a class="link" href="#sec-manage-scripts-rest" title="2.1.6.&nbsp;RESTful Script Management">Script Management</a></p></li>
          <li class="listitem"><p><a class="link" href="#sec-rest-api-recording" title="2.1.7.&nbsp;RESTful Troubleshooting Information Recording">Troubleshooting Information Recording</a></p></li>
         </ul>
        </div>
        <p>This section also covers <a class="link" href="#rest-api-status-codes" title="2.1.1.10.&nbsp;REST Status Codes">REST Status Codes</a>.</p>
        <p>In this section, long URLs are wrapped to fit the printed page, as some of the output is formatted for easier reading.</p>
        <div class="section" id="rest-api-versioning">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.1.1.&nbsp;REST API Versioning</h4>
           </div>
          </div>
         </div>
         <p> In OpenAM 12.0.0 and later, REST API features are assigned version numbers. </p>
         <p>Providing version numbers in the REST API helps ensure compatibility between OpenAM releases. The version number of a feature increases when OpenAM introduces a non-backwards-compatible change that affects clients making use of the feature.</p>
         <div class="variablelist">
          <p> OpenAM provides versions for the following aspects of the REST API. </p>
          <dl class="variablelist">
           <dt>
            <span class="term"><span class="emphasis"><em>resource</em></span></span>
           </dt>
           <dd>
            <p> Any changes to the structure or syntax of a returned response will incur a <span class="emphasis"><em>resource</em></span> version change. For example changing <code class="literal">errorMessage</code> to <code class="literal">message</code> in a JSON response. </p>
           </dd>
           <dt>
            <span class="term"><span class="emphasis"><em>protocol</em></span></span>
           </dt>
           <dd>
            <p> Any changes to the methods used to make REST API calls will incur a <span class="emphasis"><em>protocol</em></span> version change. For example changing <code class="literal">_action</code> to <code class="literal">$action</code> in the required parameters of an API feature. </p>
           </dd>
          </dl>
         </div>
         <div class="section" id="rest-api-versioning-supported-versions">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.1.1.1.&nbsp;Supported REST API Versions</h5>
            </div>
           </div>
          </div>
          <p>The REST API version numbers supported in OpenAM 13 are as follows:</p>
          <div class="variablelist">
           <dl class="variablelist">
            <dt>
             <span class="term"><span class="emphasis"><em>Supported protocol versions</em></span></span>
            </dt>
            <dd>
             <p>The <span class="emphasis"><em>protocol</em></span> versions supported in OpenAM 13 are:</p>
             <table border="0" summary="Simple list" class="simplelist">
              <tbody>
               <tr>
                <td><code class="literal">1.0</code></td>
               </tr>
              </tbody>
             </table>
            </dd>
            <dt>
             <span class="term"><span class="emphasis"><em>Supported resource versions</em></span></span>
            </dt>
            <dd>
             <p>The <span class="emphasis"><em>resource</em></span> versions supported in OpenAM 13 are shown in the following table.</p>
             <div class="table" id="rest-api-supported-resource-versions">
              <div class="table-title">
               Table&nbsp;2.1.&nbsp;Supported 
               <span class="emphasis"><em>resource</em></span> Versions
              </div>
              <div class="table-contents">
               <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Supported resource Versions" width="100%" border="0">
                <colgroup>
                 <col width="33%">
                 <col width="33%">
                 <col width="34%">
                </colgroup>
                <thead>
                 <tr>
                  <th>Base</th>
                  <th>End Point</th>
                  <th>Supported Versions</th>
                 </tr>
                </thead>
                <tbody>
                 <tr>
                  <td>/json</td>
                  <td>/authenticate</td>
                  <td>1.1, 2.0</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/users</td>
                  <td>1.1, 1.2, 2.0, 2.1, 3.0</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/groups</td>
                  <td>1.1, 2.0, 2.1, 3.0</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/agents</td>
                  <td>1.1, 2.0, 2.1, 3.0</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/realms</td>
                  <td>1.0</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/dashboard</td>
                  <td>1.0</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/sessions</td>
                  <td>1.1</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/serverinfo/*</td>
                  <td>1.1</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/users/<span class="emphasis"><em>{user}</em></span>/devices/trusted</td>
                  <td>1.0</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/users/<span class="emphasis"><em>{user}</em></span>/uma/policies</td>
                  <td>1.0</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/applications</td>
                  <td>1.0, 2.0</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/resourcetypes</td>
                  <td>1.0</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/policies</td>
                  <td>1.0, 2.0</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/applicationtypes</td>
                  <td>1.0</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/conditiontypes</td>
                  <td>1.0</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/subjecttypes</td>
                  <td>1.0</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/subjectattributes</td>
                  <td>1.0</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/decisioncombiners</td>
                  <td>1.0</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/subjectattributes</td>
                  <td>1.0</td>
                 </tr>
                 <tr>
                  <td>/xacml</td>
                  <td>/policies</td>
                  <td>1.0</td>
                 </tr>
                 <tr>
                  <td>/frrest</td>
                  <td>/token</td>
                  <td>1.0</td>
                 </tr>
                 <tr>
                  <td> </td>
                  <td>/client</td>
                  <td>1.0</td>
                 </tr>
                </tbody>
               </table>
              </div>
             </div>
             <br class="table-break">
            </dd>
           </dl>
          </div>
          <p>The <em class="citetitle">OpenAM Release Notes</em> section, <a href="../release-notes/index.html#chap-compatibility" class="olink">Chapter&nbsp;4, "Changes and Deprecated Functionality"</a> in the <em>Release Notes</em> describes the differences between API versions.</p>
         </div>
         <div class="section" id="rest-api-explicit-version">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.1.1.2.&nbsp;Specifying an Explicit REST API Version</h5>
            </div>
           </div>
          </div>
          <p>You can specify which version of the REST API to use by adding an <code class="literal">Accept-API-Version</code> header to the request, as in the following example, which is requesting <span class="emphasis"><em>resource</em></span> version 2.0 and <span class="emphasis"><em>protocol</em></span> version 1.0:</p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "X-OpenAM-Username: demo" \
 --header "X-OpenAM-Password: changeit" \
 --header "Accept-API-Version: resource=2.0, protocol=1.0" \
 https://openam.example.com:8443/openam/json/authenticate</strong>
</pre>
          <p>You can configure the default behavior OpenAM will take when a REST call does not specify explicit version information. For more information, see <a href="../admin-guide/index.html#sec-rest" class="olink">Chapter&nbsp;20, "Configuring REST APIs"</a> in the <em>Administration Guide</em>.</p>
         </div>
         <div class="section" id="rest-api-versioning-messages">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.1.1.3.&nbsp;REST API Versioning Messages</h5>
            </div>
           </div>
          </div>
          <p>OpenAM provides REST API version messages in the JSON response to a REST API call. You can also configure OpenAM to return version messages in the response headers. See <a href="../admin-guide/index.html#sec-rest" class="olink">Chapter&nbsp;20, "Configuring REST APIs"</a> in the <em>Administration Guide</em>.</p>
          <p>Messages include:</p>
          <div class="itemizedlist">
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p>Details of the REST API versions used to service a REST API call.</p></li>
            <li class="listitem"><p>Warning messages if REST API version information is not specified or is incorrect in a REST API call.</p></li>
           </ul>
          </div>
          <p>The <code class="literal">resource</code> and <code class="literal">protocol</code> version used to service a REST API call are returned in the <code class="literal">Content-API-Version</code> header, as shown below:</p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 -i \
 --request POST \
 --header "Content-Type: application/json" \
 --header "X-OpenAM-Username: demo" \
 --header "X-OpenAM-Password: changeit" \
 --header "Accept-API-Version: resource=2.0, protocol=1.0" \
 https://openam.example.com:8443/openam/json/authenticate</strong>

<em class="computeroutput">HTTP/1.1 200 OK
Content-API-Version: protocol=1.0,resource=2.0
Server: Restlet-Framework/2.1.7
Content-Type: application/json;charset=UTF-8

{
 "tokenId":"AQIC5wM...TU3OQ*",
 "successUrl":"/openam/console"
}</em>
</pre>
          <p>If the default REST API version behavior is set to <code class="literal">None</code>, and a REST API call does not include the <code class="literal">Accept-API-Version</code> header, or does not specify a <code class="literal">resource</code> version, then a <code class="literal">400 Bad Request</code> status code is returned, as shown below:</p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "Content-Type: application/json" \
 --header "Accept-API-Version: protocol=1.0" \
 https://openam.example.com:8443/openam/json/serverinfo/*</strong>

<em class="computeroutput">{
 "code":400,
 "reason":"Bad Request",
 "message":"No requested version specified and behavior set to NONE."
}</em>
</pre>
          <p>If a REST API call does include the <code class="literal">Accept-API-Version</code> header, but the specified <code class="literal">resource</code> or <code class="literal">protocol</code> version does not exist in OpenAM, then a <code class="literal">404 Not Found</code> status code is returned, as shown below:</p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "Content-Type: application/json" \
 --header "Accept-API-Version: protocol=1.0, resource=999.0" \
 https://openam.example.com:8443/openam/json/serverinfo/*</strong>

<em class="computeroutput">{
 "code":404,
 "reason":"Not Found",
 "message":"Accept-API-Version: Requested version \"999.0\" does not match any routes."
}</em>
</pre>
          <div class="panel panel-success">
           <div class="panel-heading">
            <h3 class="panel-title">Tip</h3>
           </div>
           <div class="panel-body">
            <p>For more information on setting the default REST API version behavior, see <a href="../admin-guide/index.html#sec-rest" class="olink">Chapter&nbsp;20, "Configuring REST APIs"</a> in the <em>Administration Guide</em>.</p>
           </div>
          </div>
         </div>
        </div>
        <div class="section" id="c66-encoding">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.1.2.&nbsp;Token Encoding</h4>
           </div>
          </div>
         </div>
         <p>Valid tokens in OpenAM requires configuration either in percent encoding or in <span class="emphasis"><em>C66Encode</em></span> format. C66Encode format is encouraged. It is the default token format for OpenAM, and is used in this section. The following is an example token that has not been encoded:</p>
         <pre class="literallayout">AQIC5wM2LY4SfczntBbXvEAOuECbqMY3J4NW3byH6xwgkGE=@AAJTSQACMDE=#</pre>
         <p>This token includes reserved characters such as <code class="literal">+</code>, <code class="literal">/</code>, and <code class="literal">=</code> (The <code class="literal">@</code>, <code class="literal">#</code>, and <code class="literal">*</code> are not reserved characters per se, but substitutions are still required). To c66encode this token, you would substitute certain characters for others, as follows:</p>
         <table border="0" summary="Simple list" class="simplelist">
          <tbody>
           <tr>
            <td><kbd>+</kbd> is replaced with <kbd>-</kbd></td>
           </tr>
           <tr>
            <td><kbd>/</kbd> is replaced with <kbd>_</kbd></td>
           </tr>
           <tr>
            <td><kbd>=</kbd> is replaced with <kbd>.</kbd></td>
           </tr>
           <tr>
            <td><kbd>@</kbd> is replaced with <kbd>*</kbd></td>
           </tr>
           <tr>
            <td><kbd>#</kbd> is replaced with <kbd>*</kbd></td>
           </tr>
           <tr>
            <td><kbd>*</kbd> (first instance) is replaced with <kbd>@</kbd></td>
           </tr>
           <tr>
            <td><kbd>*</kbd> (subsequent instances) is replaced with <kbd>#</kbd></td>
           </tr>
          </tbody>
         </table>
         <p>In this case, the translated token would appear as shown here:</p>
         <pre class="literallayout">AQIC5wM2LY4SfczntBbXvEAOuECbqMY3J4NW3byH6xwgkGE.*AAJTSQACMDE.*</pre>
        </div>
        <div class="section" id="realms-rest">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.1.3.&nbsp;Specifying Realms in REST API Calls</h4>
           </div>
          </div>
         </div>
         <a class="indexterm" name="d14232e1015"></a>
         <p>This section describes how to work with realms when making REST API calls to OpenAM.</p>
         <p>Realms can be specified in three ways when making a REST API call to OpenAM:</p>
         <div class="variablelist">
          <dl class="variablelist">
           <dt>
            <span class="term">DNS Alias</span>
           </dt>
           <dd>
            <p>When making a REST API call, the DNS alias of a realm can be specified in the subdomain and domain name components of the REST endpoint.</p>
            <p>To list all users in the top-level realm use the DNS alias of the OpenAM instance, for example the REST endpoint would be: </p>
            <pre class="cmdline prettyprint nohighlight">https://openam.example.com:8443/openam/json/users?_queryId=*</pre>
            <p> </p>
            <p>To list all users in a realm with DNS alias <code class="literal">suppliers.example.com</code> the REST endpoint would be: </p>
            <pre class="cmdline prettyprint nohighlight">https://<em><strong class="replaceable">suppliers.example.com</strong></em>:8443/openam/json/users?_queryId=*</pre>
            <p> </p>
           </dd>
           <dt>
            <span class="term">Path</span>
           </dt>
           <dd>
            <p>When making a REST API call, the realm, or realm alias, can be specified in the path component of the REST endpoint.</p>
            <p>To authenticate a user in the top-level realm the REST endpoint would be: </p>
            <pre class="cmdline prettyprint nohighlight">https://openam.example.com:8443/openam/json/authenticate</pre>
            <p> </p>
            <p>To authenticate a user in a realm named <code class="literal">customers</code> the REST endpoint would be: </p>
            <pre class="cmdline prettyprint nohighlight">https://openam.example.com:8443/openam/json<em><strong class="replaceable">/customers</strong></em>/authenticate</pre>
            <p> </p>
            <p>Subrealms are supported and should be separated with a forward slash (<kbd>/</kbd>).</p>
            <p>For example, to authenticate to a subrealm named <code class="literal">europe</code> of a realm named <code class="literal">partners</code>, the REST endpoint would be: </p>
            <pre class="cmdline prettyprint nohighlight">https://openam.example.com:8443/openam/json<em><strong class="replaceable">/partners/europe</strong></em>/authenticate</pre>
           </dd>
           <dt>
            <span class="term">Query Parameter</span>
           </dt>
           <dd>
            <p>When making a REST API call the realm, or realm alias, can be specified as the value of a query parameter named <code class="literal">realm</code>.</p>
            <p>To list the groups in the top-level realm the REST endpoint would be: </p>
            <pre class="cmdline prettyprint nohighlight">https://openam.example.com:8443/openam/json/groups?_queryId=*</pre>
            <p> </p>
            <p>To list the groups in a realm named <code class="literal">partners</code> the REST endpoint would be: </p>
            <pre class="cmdline prettyprint nohighlight">https://openam.example.com:8443/openam/json/groups?<em><strong class="replaceable">realm=/partners</strong></em>&amp;_queryId=*</pre>
            <p> </p>
            <div class="panel panel-primary">
             <div class="panel-heading">
              <h3 class="panel-title">Important</h3>
             </div>
             <div class="panel-body">
              <p>When working with a named subrealm of the top-level realm a forward slash preceeding the realm name is required. You should not use a forward slash when using a realm alias.</p>
             </div>
            </div>
            <p>Subrealms are supported and should be separated with a forward slash (<kbd>/</kbd>).</p>
            <p>To authenticate a user in a subrealm named <code class="literal">europe</code> of a realm named <code class="literal">partners</code> the REST endpoint would be: </p>
            <pre class="cmdline prettyprint nohighlight">https://openam.example.com:8443/openam/json/authenticate?<em><strong class="replaceable">realm=/partners/europe</strong></em></pre>
           </dd>
          </dl>
         </div>
         <p>If more than one of the above methods is used to specify realms in a REST endpoint, OpenAM applies the following rules to determine the realm to use. </p>
         <div class="orderedlist">
          <ol class="orderedlist" type="1">
           <li class="listitem"><p>If realms are specified using both the DNS alias and path methods, they are concatenated together.</p><p>For example, the following REST endpoint returns users in a subrealm named <code class="literal">europe</code> of a realm with DNS alias <code class="literal">suppliers</code>. </p><pre class="cmdline prettyprint nohighlight">https://<em><strong class="replaceable">suppliers.example.com</strong></em>:8443/openam/json<em><strong class="replaceable">/europe</strong></em>/users?_queryId=*</pre></li>
           <li class="listitem"><p>If realms are specified using the <code class="literal">realm</code> query parameter, they override anything specified in either the DNS alias or path method.</p><p>For example, the following REST endpoint returns users in a subrealm of the <code class="literal">customers</code> realm, named <code class="literal">asia</code>. </p><pre class="cmdline prettyprint nohighlight">https://<em><strong class="replaceable">suppliers.example.com</strong></em>:8443/openam/json<em><strong class="replaceable">/europe</strong></em>/users?<em><strong class="replaceable">realm=/customers/asia</strong></em>&amp;_queryId=*</pre></li>
          </ol>
         </div>
        </div>
        <div class="section" id="rest-api-auth">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.1.4.&nbsp;Authentication &amp; Logout</h4>
           </div>
          </div>
         </div>
         <a class="indexterm" name="d14232e1192"></a>
         <a class="indexterm" name="d14232e1197"></a>
         <p> You can use REST-like APIs under <code class="literal">/json/authenticate</code> and <code class="literal">/json/sessions</code> for authentication and for logout. </p>
         <p> The <code class="literal">/json/authenticate</code> endpoint does not support the CRUDPAQ verbs and therefore does not technically satisfy REST architectural requirements. The term <span class="emphasis"><em>REST-like</em></span> describes this endpoint better than <span class="emphasis"><em>REST</em></span>. </p>
         <div class="panel panel-success">
          <div class="panel-heading">
           <h3 class="panel-title">Tip</h3>
          </div>
          <div class="panel-body">
           <p> When authentication depends on the client IP address, and OpenAM lies behind a load balancer or proxy layer, configure the load balancer or proxy to send the address by using the <code class="literal">X-Forwarded-For</code> header, and configure OpenAM to consume and forward the header as necessary. For details, see <a href="../install-guide/index.html#handle-request-headers" class="olink">Section&nbsp;4.4, "Handling HTTP Request Headers"</a> in the <em>Installation Guide</em>. </p>
          </div>
         </div>
         <p> The simplest user name/password authentication returns a <code class="literal">tokenId</code> that applications can present as a cookie value for other operations that require authentication. The type of <code class="literal">tokenId</code> returned varies depending on whether stateless sessions are enabled in the realm to which the user authenticates: </p>
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p> If stateless sessions are not enabled, the <code class="literal">tokenId</code> is an OpenAM SSO token. </p></li>
           <li class="listitem"><p> If stateless sessions are enabled, the <code class="literal">tokenId</code> is an OpenAM SSO token that includes an encoded OpenAM session. </p></li>
          </ul>
         </div>
         <p> Developers should be aware that the size of the <code class="literal">tokenId</code> for stateless sessions—2000 bytes or greater—is considerably longer than for stateful sessions—approximately 100 bytes. For more information about stateful and stateless session tokens, see <a href="../admin-guide/index.html#session-state-cookies" class="olink">Section&nbsp;9.2, "Session Cookies"</a> in the <em>Administration Guide</em>. </p>
         <p> When authenticating with a user name and password, use HTTP POST to prevent the web container from logging the credentials. Pass the user name in an <code class="literal">X-OpenAM-Username</code> header, and the password in an <code class="literal">X-OpenAM-Password</code> header: </p>
         <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "X-OpenAM-Username: demo" \
 --header "X-OpenAM-Password: changeit" \
 --header "Content-Type: application/json" \
 --data "{}" \
 https://openam.example.com:8443/openam/json/authenticate</strong>
<em class="computeroutput">{ "tokenId": "AQIC5w...NTcy*", "successUrl": "/openam/console" }</em></pre>
         <div class="panel panel-success">
          <div class="panel-heading">
           <h3 class="panel-title">Tip</h3>
          </div>
          <div class="panel-body">
           <p> When authenticating with Windows Desktop SSO, add an <code class="literal">Authorization</code> header containing the string <code class="literal">Basic </code>, followed by a Base64-encoded string of the username, a colon character, and the password. In the following example, the credentials <code class="literal">demo:changeit</code> are base64 encoded into the string <code class="literal">ZGVtbzpjaGFuZ2VpdA==</code>: </p>
           <pre class="cmdline prettyprint nohighlight">
 $ <strong class="userinput">curl \
 --request POST \
 --header "X-OpenAM-Username: demo" \
 --header "X-OpenAM-Password: changeit" \
 --header "Authorization: Basic ZGVtbzpjaGFuZ2VpdA==" \
 --header "Content-Type: application/json" \
 --data "{}" \
 https://openam.example.com:8443/openam/json/authenticate</strong>
 <em class="computeroutput">{ "tokenId": "AQIC5w...NTcy*", "successUrl": "/openam/console" }</em></pre>
          </div>
         </div>
         <p> This zero page login mechanism works only for name/password authentication. If you include a POST body with the request, it must be an empty JSON string as shown in the example. Alternatively, you can leave the POST body empty. Otherwise, OpenAM interprets the body as a continuation of an existing authentication attempt, one that uses a supported callback mechanism. </p>
         <p> The authentication service at <code class="literal">/json/authenticate</code> supports callback mechanisms that make it possible to perform other types of authentication in addition to simple user name/password login. </p>
         <p> Callbacks that are not completed based on the content of the client HTTP request are returned in JSON as a response to the request. Each callback has an array of output suitable for displaying to the end user, and input which is what the client must complete and send back to OpenAM. The default is still user name/password authentication: </p>
         <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 https://openam.example.com:8443/openam/json/authenticate</strong>
<em class="computeroutput">
{
    "authId": "...jwt-value...",
    "template": "",
    "stage": "DataStore1",
    "callbacks": [
        {
            "type": "NameCallback",
            "output": [
                {
                    "name": "prompt",
                    "value": " User Name: "
                }
            ],
            "input": [
                {
                    "name": "IDToken1",
                    "value": ""
                }
            ]
        },
        {
            "type": "PasswordCallback",
            "output": [
                {
                    "name": "prompt",
                    "value": " Password: "
                }
            ],
            "input": [
                {
                    "name": "IDToken2",
                    "value": ""
                }
            ]
        }
    ]
}</em></pre>
         <p> The <code class="literal">authID</code> value is a JSON Web Token (JWT) that uniquely identifies the authentication context to OpenAM, and so must also be sent back with the requests. </p>
         <p> To respond to the callback, send back the JSON object with the missing values filled, as in this case where the user name is <code class="literal">demo</code> and the password is <code class="literal">changeit</code>: </p>
         <div class="informalexample">
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --data '{ "authId": "...jwt-value...", "template": "", "stage": "DataStore1",
   "callbacks": [ { "type": "NameCallback", "output": [ { "name": "prompt",
   "value": " User Name: " } ], "input": [ { "name": "IDToken1", "value": "demo" } ] },
   { "type": "PasswordCallback", "output": [ { "name": "prompt", "value": " Password: " } ],
   "input": [ { "name": "IDToken2", "value": "changeit" } ] } ] }' \
 https://openam.example.com:8443/openam/json/authenticate</strong>
<em class="computeroutput">
{ "tokenId": "AQIC5wM2...U3MTE4NA..*", "successUrl": "/openam/console" }</em></pre>
         </div>
         <p> The response is a token ID holding the SSO token value. </p>
         <p> Alternatively, you can authenticate without requesting a session using the <code class="literal">noSession</code> query string parameter: </p>
         <div class="informalexample">
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --data '{ "authId": "...jwt-value...", "template": "", "stage": "DataStore1",
   "callbacks": [ { "type": "NameCallback", "output": [ { "name": "prompt",
   "value": " User Name: " } ], "input": [ { "name": "IDToken1", "value": "demo" } ] },
   { "type": "PasswordCallback", "output": [ { "name": "prompt", "value": " Password: " } ],
   "input": [ { "name": "IDToken2", "value": "changeit" } ] } ] }' \
 https://openam.example.com:8443/openam/json/authenticate?noSession=true</strong>
<em class="computeroutput">
{ "message": "Authentication Successful", "successUrl": "/openam/console" }</em></pre>
         </div>
         <p> OpenAM can be configured to return a failure URL value when authentication fails. No failure URL is configured by default. The Default Failure Login URL can be configured for the <a href="../admin-guide/index.html#core-module-conf-hints" class="olink">Section&nbsp;2.4.5, "Hints for the Core Authentication Module"</a> in the <em>Administration Guide</em> authentication module. Alternatively, failure URLs can be configured per authentication chain, which your client can specify using the <code class="literal">service</code> parameter described below. On failure OpenAM then returns HTTP status code 401 Unauthorized, and the JSON in the reply indicates the failure URL: </p>
         <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "X-OpenAM-Username: demo" \
 --header "X-OpenAM-Password: badpassword" \
 https://openam.example.com:8443/openam/json/authenticate</strong>
<em class="computeroutput">{
  "code":401,
  "reason":"Unauthorized",
  "message":"Invalid Password!!",
  "failureUrl": "http://www.example.com/401.html"
}</em></pre>
         <p> To specify a realm in your request, first make sure that the name of your realm does not match an endpoint name to avoid any potential routing errors. Then, specify the realm in one of two ways. For example, if you have a realm titled <code class="literal">myRealm</code>, you can use it in your request as follows: </p>
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p> Using the realm in the URI to the endpoint (preferred method): </p><pre class="literallayout">https://openam.example.com:8443/openam/json/<code class="literal">myRealm</code>/authenticate</pre></li>
           <li class="listitem"><p> Using the realm query string parameter: </p><pre class="literallayout">https://openam.example.com:8443/openam/json/authenticate?realm=<code class="literal">myRealm</code></pre></li>
          </ul>
         </div>
         <div class="variablelist">
          <p> You can use the <code class="literal">authIndexType</code> and <code class="literal">authIndexValue</code> query string parameters as a pair to provide additional information about how you are authenticating. The <code class="literal">authIndexType</code> can be one of the following types: </p>
          <dl class="variablelist">
           <dt>
            <span class="term">composite</span>
           </dt>
           <dd>
            <p>Set the value to a composite advice string.</p>
           </dd>
           <dt>
            <span class="term">level</span>
           </dt>
           <dd>
            <p>Set the value to the authentication level.</p>
           </dd>
           <dt>
            <span class="term">module</span>
           </dt>
           <dd>
            <p>Set the value to the name of an authentication module.</p>
           </dd>
           <dt>
            <span class="term">resource</span>
           </dt>
           <dd>
            <p>Set the value to a URL protected by an OpenAM policy.</p>
           </dd>
           <dt>
            <span class="term">role</span>
           </dt>
           <dd>
            <p>Set the value to an OpenAM role.</p>
           </dd>
           <dt>
            <span class="term">service</span>
           </dt>
           <dd>
            <p>Set the value to the name of an authentication chain.</p>
           </dd>
           <dt>
            <span class="term">user</span>
           </dt>
           <dd>
            <p>Set the value to an OpenAM user ID.</p>
           </dd>
          </dl>
         </div>
         <p> You can use the query string parameter, <code class="literal">sessionUpgradeSSOTokenId=<em class="replaceable">tokenId</em></code>, to request session upgrade. For an explanation of session upgrade, see <a href="../admin-guide/index.html#session-upgrade" class="olink">Section&nbsp;2.9, "Authentication Levels and Session Upgrade"</a> in the <em>Administration Guide</em>. </p>
         <div class="itemizedlist">
          <p> OpenAM uses the following callback types depending on the authentication module in use: </p>
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p> <code class="literal">ChoiceCallback</code>: Used to display a list of choices and retrieve the selected choice. </p></li>
           <li class="listitem"><p> <code class="literal">ConfirmationCallback</code>: Used to ask for a confirmation such as Yes, No, or Cancel and retrieve the selection. </p></li>
           <li class="listitem"><p> <code class="literal">HiddenValueCallback</code>: Used to return form values that are not visually rendered to the end user. </p></li>
           <li class="listitem"><p> <code class="literal">HttpCallback</code>: Used for HTTP handshake negotiations. </p></li>
           <li class="listitem"><p> <code class="literal">LanguageCallback</code>: Used to retrieve the locale for localizing text presented to the end user. </p></li>
           <li class="listitem"><p> <code class="literal">NameCallback</code>: Used to retrieve a name string. </p></li>
           <li class="listitem"><p> <code class="literal">PasswordCallback</code>: Used to retrieve a password value. </p></li>
           <li class="listitem"><p> <code class="literal">RedirectCallback</code>: Used to redirect the client user-agent. </p></li>
           <li class="listitem"><p> <code class="literal">ScriptTextOutputCallback</code>: Used to insert a script into the page presented to the end user. The script can, for example, collect data about the user's environment. </p></li>
           <li class="listitem"><p> <code class="literal">TextInputCallback</code>: Used to retrieve text input from the end user. </p></li>
           <li class="listitem"><p> <code class="literal">TextOutputCallback</code>: Used to display a message to the end user. </p></li>
           <li class="listitem"><p> <code class="literal">X509CertificateCallback</code>: Used to retrieve the content of an x.509 certificate. </p></li>
          </ul>
         </div>
         <p> Authenticated users can log out with the token cookie value and an HTTP POST to <code class="literal">/json/sessions/?_action=logout</code>: </p>
         <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "iplanetDirectoryPro: AQIC5wM2...U3MTE4NA..*" \
 --header "Content-Type: application/json" \
 "https://openam.example.com:8443/openam/json/sessions/?_action=logout"</strong>
<em class="computeroutput">
{"result":"Successfully logged out"}</em></pre>
        </div>
        <div class="section" id="rest-api-ssotoken">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.1.5.&nbsp;Using the Session Token After Authentication</h4>
           </div>
          </div>
         </div>
         <a class="indexterm" name="d14232e1539"></a>
         <p> The following is a common scenario when accessing OpenAM by using REST API calls: </p>
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p> First, call the <code class="literal">/json/authenticate</code> endpoint to log a user in to OpenAM. This REST API call returns a <code class="literal">tokenID</code> value, which is used in subsequent REST API calls to identify the user: </p><pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
 --request POST \
 --header "X-OpenAM-Username: demo" \
 --header "X-OpenAM-Password: changeit" \
 --header "Content-Type: application/json" \
 --data "{}" \
 https://openam.example.com:8443/openam/json/authenticate</strong>
 <em class="computeroutput">{ "tokenId": "AQIC5w...NTcy*", "successUrl": "/openam/console" }</em>
</pre><p> The returned <code class="literal">tokenID</code> is known as a session token (also referred to as an SSO token). REST API calls made after successful authentication to OpenAM must present the session token in the HTTP header as proof of authentication. </p></li>
           <li class="listitem"><p> Next, call one or more additional REST APIs on behalf of the logged-in user. Each REST API call passes the user's <code class="literal">tokenID</code> back to OpenAM in the HTTP header as proof of previous authentication. </p><p> The following is a <span class="emphasis"><em>partial</em></span> example of a <span class="command"><strong>curl</strong></span> command that inserts the token ID returned from a prior successful OpenAM authentication attempt into the HTTP header: </p><pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
    --request POST \
    --header "iPlanetDirectoryPro: AQIC5w...NTcy*" \
    --header "Content-Type: application/json" \
    --data '{
    ...
</strong></pre><p> Observe that the session token is inserted into a header field named <code class="literal">iPlanetDirectoryPro</code>. This header field name must correspond to the name of the OpenAM session cookie—by default, <code class="literal">iPlanetDirectoryPro</code>. You can find the cookie name by navigating to Configuration &gt; Servers and Sites &gt; <em class="replaceable">Server Name</em> &gt; Security and locating the Cookie Name field in the OpenAM console. </p><p> Once a user has authenticated, it is <span class="emphasis"><em>not</em></span> necessary to insert login credentials in the HTTP header in subsequent REST API calls. Note the absence of <code class="literal">X-OpenAM-Username</code> and <code class="literal">X-OpenAM-Password</code> headers in the preceding example. </p><p> Users are required to have appropriate privileges in order to access OpenAM functionality using the REST API. For example, users who lack administrative privileges cannot create OpenAM realms. For more information on the OpenAM privilege model, see <a href="../admin-guide/index.html#manage-realms" class="olink">Section&nbsp;4.1, "Managing Realms"</a> in the <em>Administration Guide</em>. </p></li>
           <li class="listitem"><p> Finally, call the REST API to log the user out of OpenAM as described in <a class="xref" href="#rest-api-auth" title="2.1.1.4.&nbsp;Authentication &amp; Logout">Section&nbsp;2.1.1.4, "Authentication &amp; Logout"</a>. As with other REST API calls made after a user has authenticated, the REST API call to log out of OpenAM requires the user's <code class="literal">tokenID</code> in the HTTP header. </p></li>
          </ul>
         </div>
        </div>
        <div class="section" id="rest-api-filter-sort-page">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.1.6.&nbsp;Filtering, Sorting, and Paging Results</h4>
           </div>
          </div>
         </div>
         <p>Some OpenAM endpoints support additional query string parameters when querying the REST APIs to manipulate the returned data. </p>
         <div class="variablelist">
          <p>The query string parameters for manipulating returned results are:</p>
          <dl class="variablelist">
           <dt>
            <span class="term"><code class="literal">_queryFilter</code></span>
           </dt>
           <dd>
            <p> The <code class="literal">_queryFilter</code> parameter can take <code class="literal">true</code> to return every result, <code class="literal">false</code> to return no results, or a filter of the following form to match field values: <code class="literal"><em class="replaceable">field</em> <em class="replaceable">operator</em> <em class="replaceable">value</em></code> where <em class="replaceable">field</em> represents the field name, <em class="replaceable">operator</em> is the operator code, <em class="replaceable">value</em> is the value to match, and the entire filter is URL-encoded.</p>
            <div class="panel panel-info">
             <div class="panel-heading">
              <h3 class="panel-title">Note</h3>
             </div>
             <div class="panel-body">
              <p>Supported fields and operator codes vary depending on the endpoint.</p>
             </div>
            </div>
            <p> The operators codes are as follows: </p>
            <div class="itemizedlist">
             <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem"><p> <code class="literal">co</code>: contains </p></li>
              <li class="listitem"><p> <code class="literal">eq</code>: equals </p><p>Used for matching strings, and supports regular expression pattern matching.</p></li>
              <li class="listitem"><p> <code class="literal">ge</code>: greater than or equal to </p></li>
              <li class="listitem"><p> <code class="literal">gt</code>: greater than </p></li>
              <li class="listitem"><p> <code class="literal">le</code>: less than or equal to </p></li>
              <li class="listitem"><p> <code class="literal">lt</code>: less than </p></li>
              <li class="listitem"><p> <code class="literal">pr</code>: <em class="replaceable">field</em> exists, <em class="replaceable">field</em> is present </p>
               <div class="panel panel-info">
                <div class="panel-heading">
                 <h3 class="panel-title">Note</h3>
                </div>
                <div class="panel-body">
                 <p> Do not set a <em class="replaceable">value</em> when using this operator. </p>
                </div>
               </div></li>
              <li class="listitem"><p> <code class="literal">sw</code>: starts with </p></li>
             </ul>
            </div>
            <p> Filters can be composed of multiple expressions by a using boolean operator <code class="literal">AND</code>, <code class="literal">OR</code>, or <code class="literal">!</code> (NOT) and by using parentheses, <code class="literal">(<em class="replaceable">expression</em>)</code> to group expressions.</p>
            <p>Regular expressions are implemented for some operators, so you can create a filter that includes or excludes certain records.</p>
            <p>You must URL-encode the <em class="replaceable">filter</em> expression in <code class="literal">_queryFilter=<em class="replaceable">filter</em></code>. </p>
            <p>The following example returns resource types with a <span class="emphasis"><em>name</em></span> that contains <code class="literal">Service</code> and also has a <span class="emphasis"><em>pattern</em></span> that starts with <code class="literal">http</code>:</p>
            <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
--get \
--data-urlencode \
'_queryFilter=name co "Service" and patterns sw "http"' \
https://openam.example.com:8443/openam/json/resourcetypes</strong></pre>
           </dd>
           <dt>
            <span class="term"><code class="literal">_fields</code></span>
           </dt>
           <dd>
            <p>You can use <code class="literal">_fields=<em class="replaceable">field-name</em>[,<em class="replaceable">field-name</em>...]</code> to limit the fields returned in the output. </p>
            <p>The following example returns the <span class="emphasis"><em>name</em></span> and <span class="emphasis"><em>creationDate</em></span> of all policies in the top level realm:</p>
            <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
--get \
--data-urlencode '_queryFilter=true' \
--data-urlencode '_fields=name,creationDate' \
https://openam.example.com:8443/openam/json/policies</strong></pre>
           </dd>
           <dt>
            <span class="term"><code class="literal">_prettyPrint</code></span>
           </dt>
           <dd>
            <p> You can use the query string parameters <code class="literal">_prettyPrint=true</code> to make the output easier to read. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">_pageSize</code></span>
           </dt>
           <dd>
            <p> You can use <code class="literal">_pageSize=<em class="replaceable">integer</em></code> to limit the number of results returned. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">_pagedResultsOffset</code></span>
           </dt>
           <dd>
            <p> You can use <code class="literal">_pagedResultsOffset=<em class="replaceable">integer</em></code> to return results starting at a specified result when using paged results.</p>
           </dd>
           <dt>
            <span class="term"><code class="literal">_sortKeys</code></span>
           </dt>
           <dd>
            <p> You can use <code class="literal">_sortKeys=[+-]<em class="replaceable">field-name</em>[,<em class="replaceable">field-name</em>...]</code> to sort the results returned, where <em class="replaceable">field-name</em> represents a field in the returned JSON. Optionally use the <code class="literal">+</code> prefix to sort in ascending order (the default), or <code class="literal">-</code> to sort in descending order. </p>
            <p>The following example returns all applications in the top level realm, sorted in descending <span class="emphasis"><em>creationDate</em></span> order: </p>
            <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
--get \
--data-urlencode '_queryFilter=true' \
--data-urlencode '_sortKeys=-creationDate' \
https://openam.example.com:8443/openam/json/applications</strong></pre>
           </dd>
          </dl>
         </div>
        </div>
        <div class="section" id="rest-api-serverinfo">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.1.7.&nbsp;Server Information</h4>
           </div>
          </div>
         </div>
         <p>You can retrieve OpenAM server information by using HTTP GET on <code class="literal">/json/serverinfo/*</code> as follows:</p>
         <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl https://openam.example.com:8443/openam/json/serverinfo/*</strong>
<em class="computeroutput">{
    "domains": [
        ".example.com"
    ],
    "protectedUserAttributes": [],
    "cookieName": "iPlanetDirectoryPro",
    "secureCookie": false,
    "forgotPassword": "false",
    "forgotUsername": "false",
    "kbaEnabled": "false",
    "selfRegistration": "false",
    "lang": "en-US",
    "successfulUserRegistrationDestination": "default",
    "socialImplementations": [
        {
            "iconPath": "XUI/images/logos/facebook.png",
            "authnChain": "FacebookSocialAuthenticationService",
            "displayName": "Facebook",
            "valid": true
        }
    ],
    "referralsEnabled": "false",
    "zeroPageLogin": {
        "enabled": false,
        "refererWhitelist": [
            ""
        ],
        "allowedWithoutReferer": true
    },
    "realm": "/",
    "xuiUserSessionValidationEnabled": true,
    "FQDN": "openam.example.com"
}</em>
</pre>
        </div>
        <div class="section" id="rest-api-tokens">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.1.8.&nbsp;Token Validation and Session Information</h4>
           </div>
          </div>
         </div>
         <a class="indexterm" name="d14232e1899"></a>
         <a class="indexterm" name="d14232e1904"></a>
         <p> OpenAM provides REST APIs under <code class="literal">/json/sessions</code> for validating SSO tokens and getting information about active sessions. </p>
         <div class="section" id="rest-api-token-validation">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.1.8.1.&nbsp;Session Token Validation</h5>
            </div>
           </div>
          </div>
          <p> To check over REST whether a session token is valid, perform an HTTP POST to the resource URL, <code class="literal">/json/sessions/<em class="replaceable">tokenId</em></code>, using the <code class="literal">validate</code> action as shown in the following example: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 http://openam.example.com:8080/openam/json/sessions/AQIC5...?_action=validate</strong>
<em class="computeroutput">{"valid":true,"uid":"demo","realm":"/myRealm"}</em>
   </pre>
          <p> An invalid session token returns only information about the validity: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 http://openam.example.com:8080/openam/json/sessions/AQIC5...?_action=validate</strong>
<em class="computeroutput">{"valid":false}</em>
   </pre>
          <p> Validating a session token has the tangential effect of resetting the idle timeout for a stateful session. If session failover is enabled in your deployment, validating session tokens can trigger write operations to the Core Token Service token store. See <a class="xref" href="#rest-api-session-information" title="2.1.1.8.2.&nbsp;Session Information">Section&nbsp;2.1.1.8.2, "Session Information"</a> for information about how to validate a session token without resetting the idle timeout, thereby avoiding the overhead of writes to the token store. </p>
          <p> Note that OpenAM does not reset the idle timeout for a stateless session. </p>
         </div>
         <div class="section" id="rest-api-session-information">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.1.8.2.&nbsp;Session Information</h5>
            </div>
           </div>
          </div>
          <p> You can use REST API calls to: </p>
          <div class="itemizedlist">
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p> Identify whether a session is active </p></li>
            <li class="listitem"><p> Check the maximum remaining amount of time a session has left before the user is required to reauthenticate </p></li>
            <li class="listitem"><p> Determine the length of time a stateful session has been idle </p></li>
            <li class="listitem"><p> Reset a stateful session's idle time to 0 </p></li>
           </ul>
          </div>
          <p> </p>
          <p> For these REST endpoints, specify two token IDs. Provide the token ID for the current authenticated user as the value of a header whose name is the name of the SSO token cookie, by default <code class="literal">iPlanetDirectoryPro</code>. Specify the token ID you want information about as the <code class="literal">tokenId</code> query string parameter of the REST URL. In the examples in this section, <code class="literal">AQIC5w...NTcy*</code> is the token ID for the current authenticated user, while <code class="literal">BXCCq...NX*1*</code> is the token being queried. </p>
          <p> To determine whether a session is active, perform an HTTP POST to the resource URL, <code class="literal">/json/sessions/</code>, using the <code class="literal">isActive</code> action as shown in the following example: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 http://openam.example.com:8080/openam/json/sessions/?_action=isActive&amp;tokenId=BXCCq...NX*1*
  </strong>
<em class="computeroutput">{"active":true}</em>
</pre>
          <p> To check the maximum remaining time (in seconds) of a session, perform an HTTP POST to the resource URL, <code class="literal">/json/sessions/</code>, using the <code class="literal">getTimeLeft</code> action as shown in the following example: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 http://openam.example.com:8080/openam/json/sessions/?_action=getTimeLeft&amp;tokenId=BXCCq...NX*1*
  </strong>
<em class="computeroutput">{"maxtime":7022}</em>
</pre>
          <p> To check the time (in minutes) configured for sessions, perform an HTTP POST to the resource URL, <code class="literal">/json/sessions/</code>, using the <code class="literal">getMaxSessionTime</code> action as shown in the following example: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 http://openam.example.com:8080/openam/json/sessions/?_action=getMaxSessionTime
  </strong>
<em class="computeroutput">{"maxsessiontime":120}</em>
</pre>
          <p> To check the idle time (in minutes) configured for sessions, perform an HTTP POST to the resource URL, <code class="literal">/json/sessions/</code>, using the <code class="literal">getMaxIdle</code> action as shown in the following example: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 http://openam.example.com:8080/openam/json/sessions/?_action=getMaxIdle
  </strong>
<em class="computeroutput">{"maxidletime":30}</em>
</pre>
          <p> To check the amount of time (in seconds) that a stateful session has been idle, perform an HTTP POST to the resource URL, <code class="literal">/json/sessions/</code>, using the <code class="literal">getIdle</code> action as shown in the following example: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 http://openam.example.com:8080/openam/json/sessions/?_action=getIdle&amp;tokenId=BXCCq...NX*1*
  </strong>
<em class="computeroutput">{"idletime":355}</em>
</pre>
          <p> Because OpenAM does not monitor idle time for stateless sessions, do not use the <code class="literal">tokenId</code> of a stateless session when using the <code class="literal">getIdle</code> action. </p>
          <p> To reset a stateful session's idle time, perform an HTTP POST to the resource URL, <code class="literal">/json/sessions/</code>, using the <code class="literal">isActive</code> action with the <code class="literal">refresh=true</code> option as shown in the following example: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 http://openam.example.com:8080/openam/json/sessions/?_action=isActive&amp;refresh=true&amp;tokenId=BXCCq...NX*1*
  </strong>
<em class="computeroutput">{"active":true}</em>
</pre>
          <p> REST API calls to retrieve session information do not reset a stateful session's idle time if you specify the <code class="literal">refresh=false</code> parameter, which is the default. </p>
          <p> If you specify the <code class="literal">refresh=true</code> parameter, OpenAM resets the idle time for stateful sessions. If session failover is enabled in your deployment, resetting a stateful session's idle time can trigger write operations to the Core Token Service token store. Therefore, to avoid the overhead of writes to the token store, be careful to use the <code class="literal">refresh=true</code> parameter only if you want to reset a stateful session's idle time. </p>
          <p> Because OpenAM does not monitor idle time for stateless sessions, do not use the <code class="literal">tokenId</code> of a stateless session when refreshing a session's idle time. </p>
         </div>
         <div class="section" id="rest-api-session-properties">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.1.8.3.&nbsp;Session Properties</h5>
            </div>
           </div>
          </div>
          <p> OpenAM lets you set, read, and delete properties on users' sessions using REST API calls. </p>
          <p> Before you can perform operations on session properties using the REST API, you must first define the properties you want to set in the Session Property Whitelist Service configuration. For information on whitelisting session properties, see <a href="../reference/index.html#session-whitelist" class="olink">Section&nbsp;1.4.19, "Session Property Whitelist"</a> in the <em>Reference</em>. </p>
          <p> You can use REST API calls for the following purposes: </p>
          <div class="itemizedlist">
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p> To retrieve the names of the properties that you can read, set, or delete. This is the same set of properties configured in the Session Property Whitelist Service. </p></li>
            <li class="listitem"><p> To set property values. </p></li>
            <li class="listitem"><p> To read property values. </p></li>
            <li class="listitem"><p> To delete property values. Deleting a property value sets the property to an empty string. </p></li>
           </ul>
          </div>
          <p> Session state affects the ability to set and delete properties as follows: </p>
          <div class="itemizedlist">
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p> You can set and delete properties on a stateful session at any time during the session's lifetime. </p></li>
            <li class="listitem"><p> You can only set and delete properties on a stateless session during the authentication process, before the user receives the session token from OpenAM. For example, you could set or delete properties on a stateless session from within a post-authentication plugin. </p></li>
           </ul>
          </div>
          <p> Differentiate the user who performs the operation on session properties from the session affected by the operation as follows: </p>
          <div class="itemizedlist">
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p> Specify the session token of the user performing the operation on session properties in the <code class="literal">iPlanetDirectoryPro</code> header. </p></li>
            <li class="listitem"><p> Specify the session token of the user whose session is to be read or modified as the <code class="literal">tokenId</code> parameter to the REST API call. </p></li>
            <li class="listitem"><p> Omit the <code class="literal">tokenId</code> parameter from the REST API call if the session of the user performing the operation is the session that you want to read or modify. </p></li>
           </ul>
          </div>
          <p> The following examples assume that you configured a property named <code class="literal">LoginLocation</code> in the Session Property Whitelist Service configuration. </p>
          <p> To retrieve the names of the properties you can get or set, perform an an HTTP POST to the resource URL, <code class="literal">/json/sessions/</code>, using the <code class="literal">getPropertyNames</code> action as shown in the following example: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 http://openam.example.com:8080/openam/json/sessions/?_action=getPropertyNames
  </strong>
<em class="computeroutput">{"properties":["LoginLocation"]}</em>
</pre>
          <p> To set the value of a session property, perform an HTTP POST to the resource URL, <code class="literal">/json/sessions/</code>, using the <code class="literal">setProperty</code> action. Because no <code class="literal">tokenId</code> parameter is present in the REST API call, the session affected by the operation is the session specified in the <code class="literal">iPlanetDirectoryPro</code> header: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 --data '{"LoginLocation":"40.748440, -73.984559"}' \
 http://openam.example.com:8080/openam/json/sessions/?_action=setProperty
  </strong>
<em class="computeroutput">{"success":true}</em>
</pre>
          <p> You can set multiple properties in a single REST API call by specifying a set of fields and their values in the JSON data. For example, <code class="literal">--data '{"property1":"value1", "property2":"value2"}'</code>. </p>
          <p> To set the value of a session property on another user's session, specify the session token of the user performing the <code class="literal">setProperty</code> action in the <code class="literal">iPlanetDirectoryPro</code>, and specify the session token to be modified as the value of the <code class="literal">tokenId</code> parameter: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 --data '{"LoginLocation":"40.748440, -73.984559"}' \
 http://openam.example.com:8080/openam/json/sessions/?_action=setProperty&amp;tokenId=BXCCq...NX*1*
  </strong>
<em class="computeroutput">{"success":true}</em>
</pre>
          <p> If the user attempting to modify the session does not have sufficient access privileges, the preceding example results in a 403 Forbidden error. </p>
          <p> To read the value of a session property, perform an HTTP POST to the resource URL, <code class="literal">/json/sessions/</code>, using the <code class="literal">getProperty</code> action: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 --data '{"properties": ["LoginLocation"]}' \
 http://openam.example.com:8080/openam/json/sessions/?_action=getProperty
  </strong>
<em class="computeroutput">{"LoginLocation":"40.748440, -73.984559"}</em>
</pre>
          <p> You can read multiple properties in a single REST API call by specifying an array of fields in the JSON data. For example, <code class="literal">--data '{"properties": ["property1", "property2"]}'</code>. </p>
          <p> To delete the value of a session property, perform an HTTP POST to the resource URL, <code class="literal">/json/sessions/</code>, using the <code class="literal">deleteProperty</code> action: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 --data '{"properties": ["LoginLocation"]}' \
 http://openam.example.com:8080/openam/json/sessions/?_action=deleteProperty
  </strong>
<em class="computeroutput">{"success":true}</em>
</pre>
          <p> You can not read or set properties internal to OpenAM sessions. If you specify an internal property in a REST API call, a 403 Forbidden error is returned. For example: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 --data '{"properties": ["AuthLevel"]}' \
 http://openam.example.com:8080/openam/json/sessions/?_action=getProperty
  </strong>
<em class="computeroutput">{"code":403,"reason":"Forbidden","message":"Forbidden"}</em>
</pre>
         </div>
        </div>
        <div class="section" id="rest-api-logging">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.1.9.&nbsp;Logging</h4>
           </div>
          </div>
         </div>
         <p> OpenAM 13 supports two Audit Logging Services: a new common REST-based Audit Logging Service, and the legacy Logging Service, which is based on a Java SDK and is available in OpenAM versions prior to OpenAM 13. The legacy Logging Service is deprecated in OpenAM 13. </p>
         <p> Both audit facilities log OpenAM REST API calls. </p>
         <div class="section" id="common-audit-logging">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.1.9.1.&nbsp;Common Audit Logging of REST API Calls</h5>
            </div>
           </div>
          </div>
          <p> OpenAM logs information about all REST API calls to the <code class="filename">access</code> topic. For more information about OpenAM audit topics, see <a href="../admin-guide/index.html#audit-log-topics" class="olink">Section&nbsp;6.2, "Audit Log Topics"</a> in the <em>Administration Guide</em>. </p>
          <p> Locate specific REST endpoints in the <code class="literal">http.path</code> log file property. </p>
         </div>
         <div class="section" id="legacy-logging">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.1.9.2.&nbsp;Legacy Logging of REST API Calls</h5>
            </div>
           </div>
          </div>
          <p> OpenAM logs information about REST API calls to two files: </p>
          <div class="itemizedlist">
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p><span class="bold"><strong>amRest.access</strong></span>. Records accesses to a CREST endpoint, regardless of whether the request successfully reached the endpoint through policy authorization. </p><p> An <code class="literal">amRest.access</code> example is as follows: </p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cat openam/openam/log/amRest.access</strong>

<em class="computeroutput">#Version: 1.0
#Fields: time  Data  LoginID  ContextID  IPAddr  LogLevel  Domain  LoggedBy  MessageID  ModuleName
NameID  HostName
"2011-09-14 16:38:17"   /home/user/openam/openam/log/ "cn=dsameuser,ou=DSAME Users,o=openam"
aa307b2dcb721d4201 "Not Available" INFO  o=openam   "cn=dsameuser,ou=DSAME Users,o=openam"
LOG-1  amRest.access  "Not Available"  192.168.56.2
"2011-09-14 16:38:17"  "Hello World"  id=bjensen,ou=user,o=openam 8a4025a2b3af291d01  "Not Available"
INFO  o=openam id=amadmin,ou=user,o=openam "Not Available" amRest.access "Not Available"
192.168.56.2</em></pre></li>
            <li class="listitem"><p><span class="bold"><strong>amRest.authz</strong></span>. Records all CREST authorization results regardless of success. If a request has an entry in the <code class="literal">amRest.access</code> log, but no corresponding entry in <code class="literal">amRest.authz</code>, then that endpoint was not protected by an authorization filter and therefore the request was granted access to the resource. </p><p> The <code class="literal">amRest.authz</code> file contains the <code class="literal">Data</code> field, which specifies the authorization decision, resource, and type of action performed on that resource. The <code class="literal">Data</code> field has the following syntax: </p><pre class="codelisting prettyprint nohighlight">
("GRANT"||"DENY") &gt; "RESOURCE | ACTION"

where
  "GRANT &gt; " is prepended to the entry if the request was allowed
  "DENY  &gt; " is prepended to the entry if the request was not allowed
  "RESOURCE" is "ResourceLocation | ResourceParameter"
     where
       "ResourceLocation" is the endpoint location (e.g., subrealm/applicationtypes)
       "ResourceParameter" is the ID of the resource being touched
        (e.g., myApplicationType) if applicable. Otherwise, this field is empty
        if touching the resource itself, such as in a query.

  "ACTION" is "ActionType | ActionParameter"
     where
       "ActionType" is "CREATE||READ||UPDATE||DELETE||PATCH||ACTION||QUERY"
       "ActionParameter" is one of the following depending on the ActionType:
          For CREATE: the new resource ID
          For READ: empty
          For UPDATE: the revision of the resource to update
          For DELETE: the revision of the resource to delete
          For PATCH: the revision of the resource to patch
          For ACTION: the actual action performed (e.g., "forgotPassword")
          For QUERY: the query ID if any</pre><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cat openam/openam/log/amRest.authz</strong>

<em class="computeroutput">#Version: 1.0
#Fields: time   Data  ContextID  LoginID  IPAddr  LogLevel  Domain  MessageID  LoggedBy  NameID
ModuleName    HostName
"2014-09-16 14:17:28"   /var/root/openam/openam/log/   7d3af9e799b6393301
"cn=dsameuser,ou=DSAME Users,dc=openam,dc=forgerock,dc=org" "Not Available" INFO
dc=openam,dc=forgerock,dc=org  LOG-1  "cn=dsameuser,ou=DSAME Users,dc=openam,dc=forgerock,dc=org"
"Not Available" amRest.authz    10.0.1.5
"2014-09-16 15:56:12"  "GRANT &gt; sessions|ACTION|logout|AdminOnlyFilter"  d3977a55a2ee18c201
id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org "Not Available" INFO  dc=openam,dc=forgerock,dc=org
OAuth2Provider-2  "cn=dsameuser,ou=DSAME Users,dc=openam,dc=forgerock,dc=org"  "Not Available"
amRest.authz    127.0.0.1
"2014-09-16 15:56:40"   "GRANT &gt; sessions|ACTION|logout|AdminOnlyFilter"  eedbc205bf51780001
id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org  "Not Available" INFO dc=openam,dc=forgerock,dc=org
OAuth2Provider-2  "cn=dsameuser,ou=DSAME Users,dc=openam,dc=forgerock,dc=org"  "Not Available"
amRest.authz    127.0.0.1</em></pre></li>
           </ul>
          </div>
          <p> OpenAM also provides additional information in its debug notifications for accesses to any endpoint, depending on the message type (error, warning or message) including realm, user, and result of the operation. </p>
         </div>
        </div>
        <div class="section" id="rest-api-status-codes">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.1.10.&nbsp;REST Status Codes</h4>
           </div>
          </div>
         </div>
         <p>OpenAM REST APIs respond to successful requests with HTTP status codes in the 2xx range. OpenAM REST APIs respond to error conditions with HTTP status codes in the 4xx and 5xx range. Status codes used are described in the following list:</p>
         <div class="variablelist">
          <dl class="variablelist">
           <dt>
            <span class="term">200 OK</span>
           </dt>
           <dd>
            <p>The request was successful and a resource returned, depending on the request. For example, a successful HTTP GET on <code class="literal">/users/myUser</code> returns a user profile and status code 200, whereas a successful HTTP DELETE returns <code class="literal">{"success","true"}</code> and status code 200.</p>
           </dd>
           <dt>
            <span class="term">201 Created</span>
           </dt>
           <dd>
            <p>The request succeeded and the resource was created.</p>
           </dd>
           <dt>
            <span class="term">400 Bad Request</span>
           </dt>
           <dd>
            <p>The request was malformed. Either parameters required by the action were missing, or as in the following example incorrect data was sent in the payload for the action:</p>
            <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --data '{"bad":"data"}' \
 https://openam.example.com:8443/openam/json/users?_action=forgotPassword
</strong>
<em class="computeroutput">{
 "code":400,
 "reason":"Bad Request",
 "message":"Username or email not provided in request"
}</em>
</pre>
           </dd>
           <dt>
            <span class="term">401 Unauthorized</span>
           </dt>
           <dd>
            <p>The request requires user authentication as in the following example, which is missing an SSO Token value:</p>
            <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 https://openam.example.com:8443/openam/json/sessions?_action=logout
</strong>
<em class="computeroutput">{
 "code": 401,
 "reason": "Unauthorized",
 "message": "Access denied"
}</em>
</pre>
           </dd>
           <dt>
            <span class="term">403 Forbidden</span>
           </dt>
           <dd>
            <p>Access was forbidden during an operation on a resource as in the following example, which has a regular user trying to read the OpenAM administrator profile:</p>
            <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "X-OpenAM-Username: demo" \
 --header "X-OpenAM-Password: changeit" \
 https://openam.example.com:8443/openam/json/authenticate
</strong>
<em class="computeroutput">{ "tokenId": "AQIC5w...YyMA..*" }</em>

$ <strong class="userinput">curl \
 --header "iplanetDirectoryPro: AQIC5w...YyMA..*" \
 https://openam.example.com:8443/openam/json/users/amadmin
</strong>
<em class="computeroutput">{
 "code": 403,
 "reason": "Forbidden",
 "message": "Permission to perform the read operation denied to
             id=demo,ou=user,dc=openam,dc=forgerock,dc=org"
}</em>
</pre>
           </dd>
           <dt>
            <span class="term">404 Not Found</span>
           </dt>
           <dd>
            <p>The specified resource could not be found as in the following example, which is attempting to read a nonexistent user's profile:</p>
            <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 https://openam.example.com:8443/openam/json/users/missing
</strong>
<em class="computeroutput">{
 "code":404,
 "reason":"Not Found",
 "message":"Resource cannot be found."
}</em>
</pre>
           </dd>
           <dt>
            <span class="term">405 Method Not Allowed</span>
           </dt>
           <dd>
            <p>The HTTP method is not allowed for the requested resource.</p>
           </dd>
           <dt>
            <span class="term">406 Not Acceptable</span>
           </dt>
           <dd>
            <p>The request contains parameters that are not acceptable as in the following example, which specifies an API version parameter that is not supported by OpenAM:</p>
            <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "X-OpenAM-Username: demo" \
 --header "X-OpenAM-Password: changeit" \
 --header "Accept-API-Version: protocol=1.0, resource=999.0" \
 https://openam.example.com:8443/openam/json/authenticate</strong>

<em class="computeroutput">{
 "code":406,
 "reason":"Not Acceptable",
 "message":"Accept-API-Version: Requested version \"999.0\" does not match any routes."
}</em>
</pre>
           </dd>
           <dt>
            <span class="term">409 Conflict</span>
           </dt>
           <dd>
            <p>The request would have resulted in a conflict with the current state of the resource. For example using the Forgot Password feature and specifying the user's email address as in the following example, where multiple users have the same email address:</p>
            <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --data '{"email":"demo@example.com"}' \
 https://openam.example.com:8443/openam/json/users?_action=forgotPassword
</strong>
<em class="computeroutput">{
 "code":409,
 "reason":"Conflict",
 "message":"Multiple users found"
}</em>
</pre>
           </dd>
           <dt>
            <span class="term">410 Gone</span>
           </dt>
           <dd>
            <p>The requested resource is no longer available, and will not become available again. The URI returned for resetting a password may have expired as in the following example:</p>
            <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --data '{"username": "demo"}' \
 https://openam.example.com:8443/openam/json/users/?_action=forgotPassword
</strong>
<em class="computeroutput">{
 "code":410,
 "reason":"Gone",
 "message":"Token not found"
}</em>
</pre>
           </dd>
           <dt>
            <span class="term">415 Unsupported Media Type</span>
           </dt>
           <dd>
            <p>The request is in a format not supported by the requested resource for the requested method as in the following example, which is attempting to pass basic authentication credentials as form-encoded data rather than query string parameters:</p>
            <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --data "username=demo&amp;password=changeit" \
 https://openam.example.com:8443/openam/json/authenticate
</strong>
<em class="computeroutput">...
HTTP Status 415
...
The server refused this request because the request entity is in a
format not supported by the requested resource for the requested method
...</em>
</pre>
           </dd>
           <dt>
            <span class="term">500 Internal Server Error</span>
           </dt>
           <dd>
            <p>The server encountered an unexpected condition which prevented it from fulfilling the request. This could be caused by an invalid configuration in the Email Service, or as in the following example the specified user account not having an associated email address to send the Forgot Password URI to:</p>
            <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --data '{"username": "demo"}' \
 https://openam.example.com:8443/openam/json/users/?_action=forgotPassword
</strong>
<em class="computeroutput">{
 "code":500,
 "reason":"Internal Server Error",
 "message":"No email provided in profile."
}</em>
</pre>
           </dd>
           <dt>
            <span class="term">501 Not Implemented</span>
           </dt>
           <dd>
            <p>The resource does not support the functionality required to fulfill the request as in the following example, which is attempting to delete an entry as a delete action instead of using an HTTP DELETE request:</p>
            <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 https://openam.example.com:8443/openam/json/users/demo?_action=delete
</strong>
<em class="computeroutput">{
 "code": 501,
 "reason": "Not Implemented",
 "message": "Actions are not supported for resource instances"
}</em>
</pre>
           </dd>
           <dt>
            <span class="term">503 Service Unavailable</span>
           </dt>
           <dd>
            <p>The requested resource was temporarily unavailable. The service may have been disabled, as in the following example, where the Forgot Password functionality has been disabled:</p>
            <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --data '{"username": "demo"}' \
 https://openam.example.com:8443/openam/json/users/?_action=forgotPassword
</strong>
<em class="computeroutput">{
 "code":503,
 "reason":"Service Unavailable",
 "message":"Forgot password is not accessible."
}</em>
</pre>
           </dd>
          </dl>
         </div>
        </div>
       </div>
       <div class="section" id="sec-rest-authz-policy">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">2.1.2.&nbsp;RESTful Authorization and Policy Management Services</h3>
          </div>
         </div>
        </div>
        <a class="indexterm" name="d14232e2581"></a>
        <p>This section shows how to use the OpenAM RESTful interfaces for authorization and policy management. </p>
        <div class="section" id="rest-api-authz">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.2.1.&nbsp;About the REST Policy Endpoints</h4>
           </div>
          </div>
         </div>
         <a class="indexterm" name="d14232e2589"></a>
         <p> OpenAM provides REST APIs both for requesting policy decisions, and also for administering policy definitions. </p>
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p> Under <code class="literal">/json{/<em class="replaceable">realm</em>}/resourcetypes</code>, you find a JSON-based API for managing resource types. </p></li>
           <li class="listitem"><p> Under <code class="literal">/json{/<em class="replaceable">realm</em>}/applications</code> and <code class="literal">/json/applicationtypes</code> you find JSON-based APIs for administering policy sets and reading application types. </p></li>
           <li class="listitem"><p> Under <code class="literal">/json{/<em class="replaceable">realm</em>}/policies</code>, you find a JSON-based API for policy management and evaluation. </p></li>
           <li class="listitem"><p> Under <code class="literal">/json/conditiontypes</code> you find a JSON-based API for viewing what types of conditions you can use when defining policies. </p></li>
           <li class="listitem"><p> Under <code class="literal">/json/subjecttypes</code> you find a JSON-based API for viewing what types of subjects you can use when defining policies. </p></li>
           <li class="listitem"><p> Under <code class="literal">/json/subjectattributes</code> you find a JSON-based API for viewing subjects' attributes you can use when defining response attributes in policies. </p></li>
           <li class="listitem"><p> Under <code class="literal">/json/decisioncombiners</code> you find a JSON-based API for viewing implementations you can use when defining policies to specify how to combine results when multiple policies apply. </p></li>
          </ul>
         </div>
         <p> Before making a REST API call to request a policy decision or manage a policy component, make sure that you have: </p>
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p> Authenticated successfully to OpenAM as a user with sufficient privileges to make the REST API call </p></li>
           <li class="listitem"><p> Obtained the session token returned after successful authentication </p></li>
          </ul>
         </div>
         <p> When making the REST API call, pass the session token in the HTTP header. For more information about the OpenAM session token and its use in REST API calls, see <a class="xref" href="#rest-api-ssotoken" title="2.1.1.5.&nbsp;Using the Session Token After Authentication">Section&nbsp;2.1.1.5, "Using the Session Token After Authentication"</a>. </p>
        </div>
        <div class="section" id="rest-api-authz-policy-decisions">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.2.2.&nbsp;Requesting Policy Decisions</h4>
           </div>
          </div>
         </div>
         <p> You can request policy decisions from OpenAM by using the REST APIs described in this section. OpenAM evaluates requests based on the context and the policies configured, and returns decisions that indicate what actions are allowed or denied, as well as any attributes or advice for the resources specified. </p>
         <p> To request decisions for specific resources, see <a class="xref" href="#rest-api-authz-policy-decision-concrete" title="2.1.2.2.1.&nbsp;Requesting Policy Decisions For Specific Resources">Section&nbsp;2.1.2.2.1, "Requesting Policy Decisions For Specific Resources"</a>. </p>
         <p> To request decisions for a resource and all resources beneath it, see <a class="xref" href="#rest-api-authz-policy-decision-subtree" title="2.1.2.2.3.&nbsp;Requesting Policy Decisions For a Tree of Resources">Section&nbsp;2.1.2.2.3, "Requesting Policy Decisions For a Tree of Resources"</a>. </p>
         <div class="section" id="rest-api-authz-policy-decision-concrete">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.2.1.&nbsp;Requesting Policy Decisions For Specific Resources</h5>
            </div>
           </div>
          </div>
          <p> This section shows how you can request a policy decision over REST for specific resources. </p>
          <p> To request policy decisions for specific resources, perform an HTTP POST using the evaluation action to the appropriate path under the URI where OpenAM is deployed, <code class="literal">/json{/<em class="replaceable">realm</em>}{/<em class="replaceable">subrealm</em>}/policies?_action=evaluate</code>, where <em class="replaceable">realm</em> and <em class="replaceable">subrealm</em> optionally specifies the realm. The payload for the HTTP POST is a JSON object that specifies at least the resources, and takes the following form. </p>
          <pre class="codelisting prettyprint javascript">{
    "resources": [
        "resource1",
        "resource2",
        ...,
        "resourceN"
    ],
    "application": "defaults to iPlanetAMWebAgentService if not specified",
    "subject": {
        "ssoToken": "SSO token ID string",
        "jwt": "JSON Web Token string",
        "claims": {
            "key": "value",
            ...
        }
    },
    "environment": {
        "optional key1": [
            "value",
            "another value",
            ...
        ],
        "optional key2": [
            "value",
            "another value",
            ...
        ],
        ...
    }
}</pre>
          <div class="variablelist">
           <p> The values for the fields shown above are explained below: </p>
           <dl class="variablelist">
            <dt>
             <span class="term"><code class="literal">"resources"</code></span>
            </dt>
            <dd>
             <p> This required field specifies the list of resources for which to return decisions. </p>
             <p> For example, when using the default policy set, <code class="literal">"iPlanetAMWebAgentService"</code>, you can request decisions for resource URLs. </p>
             <pre class="codelisting prettyprint javascript">{
    "resources": [
        "http://www.example.com/index.html",
        "http://www.example.com/do?action=run"
    ]
}</pre>
            </dd>
            <dt>
             <span class="term"><code class="literal">"application"</code></span>
            </dt>
            <dd>
             <p> This field holds the name of the policy set, and defaults to <code class="literal">"iPlanetAMWebAgentService"</code> if not specified. </p>
             <p> For more on policy sets, see <a class="xref" href="#rest-api-authz-applications" title="2.1.2.5.&nbsp;Managing Policy Sets">Section&nbsp;2.1.2.5, "Managing Policy Sets"</a>. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">"subject"</code></span>
            </dt>
            <dd>
             <p> </p>
             <div class="variablelist">
              <p> This optional field holds an object that represents the subject. You can specify one or more of the following keys. If you specify multiple keys, the subject can have multiple associated principals, and you can use subject conditions corresponding to any type in the request. </p>
              <dl class="variablelist">
               <dt>
                <span class="term"><code class="literal">"ssoToken"</code></span>
               </dt>
               <dd>
                <p> The value is the SSO token ID string for the subject, returned for example on successful authentication as described in <a class="xref" href="#rest-api-auth" title="2.1.1.4.&nbsp;Authentication &amp; Logout">Section&nbsp;2.1.1.4, "Authentication &amp; Logout"</a>. </p>
               </dd>
               <dt>
                <span class="term"><code class="literal">"jwt"</code></span>
               </dt>
               <dd>
                <p> The value is a JWT string. </p>
               </dd>
               <dt>
                <span class="term"><code class="literal">"claims"</code></span>
               </dt>
               <dd>
                <p> The value is an object (map) of JWT claims to their values. </p>
               </dd>
              </dl>
             </div>
             <p> If you do not specify the subject, OpenAM uses the SSO token ID of the subject making the request. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">"environment"</code></span>
            </dt>
            <dd>
             <p> This optional field holds a map of keys to lists of values. </p>
             <p> If you do not specify the environment, the default is an empty map. </p>
            </dd>
           </dl>
          </div>
          <p> The example below requests policy decisions for two URL resources. The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token for a user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "iPlanetDirectoryPro: AQIC5..." \
 --header "Content-Type: application/json" \
 --data '{
    "resources": [
        "http://www.example.com/index.html",
        "http://www.example.com/do?action=run"
    ],
    "application": "iPlanetAMWebAgentService"
 }' \
 https://openam.example.com:8443/openam/json/policies?_action=evaluate</strong>
<em class="computeroutput">[ {
  "resource" : "http://www.example.com/do?action=run",
  "actions" : {
  },
  "attributes" : {
  },
  "advices" : {
    "AuthLevelConditionAdvice" : [ "3" ]
  }
}, {
  "resource" : "http://www.example.com/index.html",
  "actions" : {
    "POST" : false,
    "GET" : true
  },
  "attributes" : {
    "cn" : [ "demo" ]
  },
  "advices" : {
  }
} ]</em>
     </pre>
          <div class="variablelist">
           <p> In the JSON list of decisions returned for each resource, OpenAM includes these fields. </p>
           <dl class="variablelist">
            <dt>
             <span class="term"><code class="literal">"resource"</code></span>
            </dt>
            <dd>
             <p> A resource specified in the request. </p>
             <p> The decisions returned are not guaranteed to be in the same order as the resources were requested. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">"actions"</code></span>
            </dt>
            <dd>
             <p> A map of action name keys to Boolean values that indicate whether the action is allowed (<code class="literal">true</code>) or denied (<code class="literal">false</code>) for the specified resource. </p>
             <p> In the example, for resource <code class="literal">http://www.example.com:80/index.html</code> HTTP GET is allowed, whereas HTTP POST is denied. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">"attributes"</code></span>
            </dt>
            <dd>
             <p> A map of attribute names to their values, if any response attributes are returned according to applicable policies. </p>
             <p> In the example, the policy that applies to <code class="literal">http://www.example.com:80/index.html</code> causes that the value of the subject's "cn" profile attribute to be returned. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">"advices"</code></span>
            </dt>
            <dd>
             <p> A map of advice names to their values, if any advice is returned according to applicable policies. </p>
             <p> The <code class="literal">"advices"</code> field can provide hints regarding what OpenAM needs to take the authorization decision. </p>
             <p> In the example, the policy that applies to <code class="literal">http://www.example.com:80/do?action=run</code> requests that the subject be authenticated at an authentication level of at least 3. </p>
             <pre class="codelisting prettyprint javascript">{
    "advices": {
        "AuthLevelConditionAdvice": [
            "3"
        ]
    }
}</pre>
             <p> See <a class="xref" href="#rest-api-authz-policy-decision-advice" title="2.1.2.2.2.&nbsp;Policy Decision Advice">Section&nbsp;2.1.2.2.2, "Policy Decision Advice"</a> for details. </p>
            </dd>
           </dl>
          </div>
          <p> You can use the query string parameters <code class="literal">_prettyPrint=true</code> to make the output easier to read, and <code class="literal">_fields=<em class="replaceable">field-name</em>[,<em class="replaceable">field-name</em>...]</code> to limit the fields returned in the output. </p>
         </div>
         <div class="section" id="rest-api-authz-policy-decision-advice">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.2.2.&nbsp;Policy Decision Advice</h5>
            </div>
           </div>
          </div>
          <p> When OpenAM returns a policy decision, the JSON for the decision can include an "advices" field. This field contains hints for the policy enforcement point. </p>
          <pre class="codelisting prettyprint javascript">{
    "advices": {
        "type": [
            "advice"
        ]
    }
}</pre>
          <p> The "advices" returned depend on policy conditions. For more information about OpenAM policy conditions, see <a class="xref" href="#rest-api-authz-policies" title="2.1.2.6.&nbsp;Managing Policies">Section&nbsp;2.1.2.6, "Managing Policies"</a>. </p>
          <p> This section shows examples of the different types of policy decision advice and the conditions that cause OpenAM to return the advice. </p>
          <p> <code class="literal">"AuthLevel"</code> and <code class="literal">"LEAuthLevel"</code> condition failures can result in advice showing the expected or maximum possible authentication level. For example, failure against the following condition: </p>
          <pre class="codelisting prettyprint javascript">{
    "type": "AuthLevel",
    "authLevel": 2
}</pre>
          <p> Leads to this advice: </p>
          <pre class="codelisting prettyprint javascript">{
    "AuthLevelConditionAdvice": [
        "2"
    ]
}</pre>
          <p> An <code class="literal">"AuthScheme"</code> condition failure can result in advice showing one or more required authentication modules. For example, failure against the following condition: </p>
          <pre class="codelisting prettyprint javascript">{
    "type": "AuthScheme",
    "authScheme": [
        "HOTP"
    ],
    "applicationName": "iPlanetAMWebAgentService",
    "applicationIdleTimeout": 10
}</pre>
          <p> Leads to this advice: </p>
          <pre class="codelisting prettyprint javascript">{
    "AuthSchemeConditionAdvice": [
        "HOTP"
    ]
}</pre>
          <p> An <code class="literal">"AuthenticateToRealm"</code> condition failure can result in advice showing the name of the realm to which authentication is required. For example, failure against the following condition: </p>
          <pre class="codelisting prettyprint javascript">{
    "type": "AuthenticateToRealm",
    "authenticateToRealm": "MyRealm"
}</pre>
          <p> Leads to this advice: </p>
          <pre class="codelisting prettyprint javascript">{
    "AuthenticateToRealmConditionAdvice": [
        "/myRealm"
    ]
}</pre>
          <p> An <code class="literal">"AuthenticateToService"</code> condition failure can result in advice showing the name of the required authentication chain. For example, failure against the following condition: </p>
          <pre class="codelisting prettyprint javascript">{
    "type": "AuthenticateToService",
    "authenticateToService": "MyAuthnChain"
}</pre>
          <p> Leads to this advice: </p>
          <pre class="codelisting prettyprint javascript">{
    "AuthenticateToServiceConditionAdvice": [
        "MyAuthnChain"
    ]
}</pre>
          <p> A <code class="literal">"ResourceEnvIP"</code> condition failure can result in advice showing that indicates corrective action to be taken to resolve the problem. The advice varies, depending on what the condition tests. For example, failure against the following condition: </p>
          <pre class="codelisting prettyprint javascript">{
    "type": "ResourceEnvIP",
    "resourceEnvIPConditionValue": [
        "IF IP=[127.0.0.12] THEN authlevel=4"
    ]
}</pre>
          <p> Leads to this advice: </p>
          <pre class="codelisting prettyprint javascript">{
    "AuthLevelConditionAdvice": [
        "4"
    ]
}</pre>
          <p> Failure against a different type of <code class="literal">"ResourceEnvIP"</code> condition such as the following: </p>
          <pre class="codelisting prettyprint javascript">{
    "type": "ResourceEnvIP",
    "resourceEnvIPConditionValue": [
        "IF IP=[127.0.0.11] THEN service=MyAuthnChain"
    ]
}</pre>
          <p> Leads to this advice: </p>
          <pre class="codelisting prettyprint javascript">{
    "AuthenticateToServiceConditionAdvice": [
        "MyAuthnChain"
    ]
}</pre>
          <p> A <code class="literal">"Session"</code> condition failure can result in advice showing that access has been denied because the user's stateful or stateless session has been active longer than allowed by the condition. The advice will also show if the user's session was terminated and reauthentication is required. For example, failure against the following condition: </p>
          <pre class="codelisting prettyprint javascript">{
    "type": "Session",
    "maxSessionTime": "10",
    "terminateSession": false
}</pre>
          <p> Leads to this advice: </p>
          <pre class="codelisting prettyprint javascript">{
    "SessionConditionAdvice": [
        "deny"
    ]
}</pre>
          <p> When policy evaluation denials occur against the following conditions, OpenAM does not return any advice: </p>
          <div class="itemizedlist">
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p> <code class="literal">IPv4</code> </p></li>
            <li class="listitem"><p> <code class="literal">IPv6</code> </p></li>
            <li class="listitem"><p> <code class="literal">LDAPFilter</code> </p></li>
            <li class="listitem"><p> <code class="literal">OAuth2Scope</code> </p></li>
            <li class="listitem"><p> <code class="literal">SessionProperty</code> </p></li>
            <li class="listitem"><p> <code class="literal">SimpleTime</code> </p></li>
           </ul>
          </div>
          <p> </p>
         </div>
         <div class="section" id="rest-api-authz-policy-decision-subtree">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.2.3.&nbsp;Requesting Policy Decisions For a Tree of Resources</h5>
            </div>
           </div>
          </div>
          <p> This section shows how you can request policy decisions over REST for a resource and all other resources in the subtree beneath it. </p>
          <p> To request policy decisions for a tree of resources, perform an HTTP POST using the evaluation action to the appropriate path under the URI where OpenAM is deployed, <code class="literal">/json{/<em class="replaceable">realm</em>}/policies?_action=evaluateTree</code>, where <em class="replaceable">realm</em> optionally specifies the realm. The payload for the HTTP POST is a JSON object that specifies at least the root resource, and takes the following form. </p>
          <pre class="codelisting prettyprint javascript">{
    "resource": "resource string",
    "application": "defaults to iPlanetAMWebAgentService if not specified",
    "subject": {
        "ssoToken": "SSO token ID string",
        "jwt": "JSON Web Token string",
        "claims": {
            "key": "value",
            ...
        }
    },
    "environment": {
        "optional key1": [
            "value",
            "another value",
            ...
        ],
        "optional key2": [
            "value",
            "another value",
            ...
        ],
        ...
    }
}</pre>
          <div class="variablelist">
           <p> The values for the fields shown above are explained below: </p>
           <dl class="variablelist">
            <dt>
             <span class="term"><code class="literal">"resource"</code></span>
            </dt>
            <dd>
             <p> This required field specifies the root resource for the decisions to return. </p>
             <p> For example, when using the default policy set, <code class="literal">"iPlanetAMWebAgentService"</code>, you can request decisions for resource URLs. </p>
             <pre class="codelisting prettyprint javascript">{
    "resource": "http://www.example.com/"
}</pre>
            </dd>
            <dt>
             <span class="term"><code class="literal">"application"</code></span>
            </dt>
            <dd>
             <p> This field holds the name of the policy set, and defaults to <code class="literal">"iPlanetAMWebAgentService"</code> if not specified. </p>
             <p> For more on policy sets, see <a class="xref" href="#rest-api-authz-applications" title="2.1.2.5.&nbsp;Managing Policy Sets">Section&nbsp;2.1.2.5, "Managing Policy Sets"</a>. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">"subject"</code></span>
            </dt>
            <dd>
             <p> </p>
             <div class="variablelist">
              <p> This optional field holds an object that represents the subject. You can specify one or more of the following keys. If you specify multiple keys, the subject can have multiple associated principals, and you can use subject conditions corresponding to any type in the request. </p>
              <dl class="variablelist">
               <dt>
                <span class="term"><code class="literal">"ssoToken"</code></span>
               </dt>
               <dd>
                <p> The value is the SSO token ID string for the subject, returned for example on successful authentication as described in, <a class="xref" href="#rest-api-auth" title="2.1.1.4.&nbsp;Authentication &amp; Logout">Section&nbsp;2.1.1.4, "Authentication &amp; Logout"</a>. </p>
               </dd>
               <dt>
                <span class="term"><code class="literal">"jwt"</code></span>
               </dt>
               <dd>
                <p> The value is a JWT string. </p>
               </dd>
               <dt>
                <span class="term"><code class="literal">"claims"</code></span>
               </dt>
               <dd>
                <p> The value is an object (map) of JWT claims to their values. </p>
               </dd>
              </dl>
             </div>
             <p> If you do not specify the subject, OpenAM uses the SSO token ID of the subject making the request. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">"environment"</code></span>
            </dt>
            <dd>
             <p> This optional field holds a map of keys to lists of values. </p>
             <p> If you do not specify the environment, the default is an empty map. </p>
            </dd>
           </dl>
          </div>
          <p> The example below requests policy decisions for <code class="literal">http://www.example.com/</code>. The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token for a user who has access to perform the operation, and the subject takes the SSO token of the user who wants to access a resource. </p>
          <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
 --request POST \
 --header "iPlanetDirectoryPro: AQIC5...NDU1*" \
 --header "Content-Type: application/json" \
 --data '{
    "resource": "http://www.example.com/",
    "subject": { "ssoToken": "AQIC5...zE4*" }
 }' \
 https://openam.example.com:8443/openam/json/policies?_action=evaluateTree</strong>
<em class="computeroutput">[ {
  "resource" : "http://www.example.com/",
  "actions" : {
    "GET" : true,
    "OPTIONS" : true,
    "HEAD" : true
  },
  "attributes" : {
  },
  "advices" : {
  }
}, {
  "resource" : "http://www.example.com/*",
  "actions" : {
    "POST" : false,
    "PATCH" : false,
    "GET" : true,
    "DELETE" : true,
    "OPTIONS" : true,
    "HEAD" : true,
    "PUT" : true
  },
  "attributes" : {
    "myStaticAttr" : [ "myStaticValue" ]
  },
  "advices" : {
  }
}, {
  "resource" : "http://www.example.com/*?*",
  "actions" : {
    "POST" : false,
    "PATCH" : false,
    "GET" : false,
    "DELETE" : false,
    "OPTIONS" : true,
    "HEAD" : false,
    "PUT" : false
  },
  "attributes" : {
  },
  "advices" : {
    "AuthLevelConditionAdvice" : [ "3" ]
  }
} ]</em></pre>
          <p> Notice that OpenAM returns decisions not only for the specified resource, but also for matching resource names in the tree whose root is the specified resource. </p>
          <div class="variablelist">
           <p> In the JSON list of decisions returned for each resource, OpenAM includes these fields. </p>
           <dl class="variablelist">
            <dt>
             <span class="term"><code class="literal">"resource"</code></span>
            </dt>
            <dd>
             <p> A resource name whose root is the resource specified in the request. </p>
             <p> The decisions returned are not guaranteed to be in the same order as the resources were requested. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">"actions"</code></span>
            </dt>
            <dd>
             <p> A map of action name keys to Boolean values that indicate whether the action is allowed (<code class="literal">true</code>) or denied (<code class="literal">false</code>) for the specified resource. </p>
             <p> In the example, for matching resources with a query string only HTTP OPTIONS is allowed according to the policies configured. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">"attributes"</code></span>
            </dt>
            <dd>
             <p> A map of attribute names to their values, if any response attributes are returned according to applicable policies. </p>
             <p> In the example, the policy that applies to <code class="literal">http://www.example.com:80/*</code> causes a static attribute to be returned. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">"advices"</code></span>
            </dt>
            <dd>
             <p> A map of advice names to their values, if any advice is returned according to applicable policies. </p>
             <p> The <code class="literal">"advices"</code> field can provide hints regarding what OpenAM needs to take the authorization decision. </p>
             <p> In the example, the policy that applies to resources with a query string requests that the subject be authenticated at an authentication level of at least 3. </p>
             <p> Notice that with the <code class="literal">"advices"</code> field present, no <code class="literal">"advices"</code> appear in the JSON response. </p>
             <pre class="codelisting prettyprint javascript">{
    "advices": {
        "AuthLevelConditionAdvice": [ "3" ]
    }
}</pre>
            </dd>
           </dl>
          </div>
          <p> You can use the query string parameters <code class="literal">_prettyPrint=true</code> to make the output easier to read, and <code class="literal">_fields=<em class="replaceable">field-name</em>[,<em class="replaceable">field-name</em>...]</code> to limit the fields returned in the output. </p>
         </div>
        </div>
        <div class="section" id="rest-api-authz-resource-types">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.2.3.&nbsp;Managing Resource Types</h4>
           </div>
          </div>
         </div>
         <a class="indexterm" name="d14232e3217"></a>
         <p> This section describes the process of using the OpenAM REST API for managing resource types, which define a template for the resources that <a class="link" href="#rest-api-authz-policies" title="2.1.2.6.&nbsp;Managing Policies">policies</a> apply to, and the actions associated with those resources. </p>
         <p>For information on creating resource types by using the OpenAM console, see <a href="../admin-guide/index.html#what-is-authz-policies" class="olink">Section&nbsp;3.1.1, "OpenAM Resource Types, Policy Sets, and Policies"</a> in the <em>Administration Guide</em>.</p>
         <div class="itemizedlist">
          <p>OpenAM provides the <code class="literal">resourcetypes</code> REST endpoint for the following:</p>
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-resource-types-query" title="2.1.2.3.1.&nbsp;Querying Resource Types">Section&nbsp;2.1.2.3.1, "Querying Resource Types"</a></p></li>
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-resource-types-read" title="2.1.2.3.2.&nbsp;Reading a Specific Resource Type">Section&nbsp;2.1.2.3.2, "Reading a Specific Resource Type"</a></p></li>
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-resource-types-create" title="2.1.2.3.3.&nbsp;Creating a Resource Type">Section&nbsp;2.1.2.3.3, "Creating a Resource Type"</a></p></li>
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-resource-types-update" title="2.1.2.3.4.&nbsp;Updating a Resource Type">Section&nbsp;2.1.2.3.4, "Updating a Resource Type"</a></p></li>
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-resource-types-delete" title="2.1.2.3.5.&nbsp;Deleting a Specific Resource Type">Section&nbsp;2.1.2.3.5, "Deleting a Specific Resource Type"</a></p></li>
          </ul>
         </div>
         <p> Resource types are realm specific, hence the URI for the resource types API can contain a realm component, such as <code class="literal">/json{<em class="replaceable">/realm</em>}/resourcetypes</code>. If the realm is not specified in the URI, the top level realm is used.</p>
         <p> Resource types are represented in JSON and take the following form. Resource types are built from standard JSON objects and values (strings, numbers, objects, sets, arrays, <code class="literal">true</code>, <code class="literal">false</code>, and <code class="literal">null</code>). Each resource type has a unique, system-generated UUID, which must be used when modifying existing resource types. Renaming a resource type will not affect the UUID. </p>
         <pre class="codelisting prettyprint json">{
    "uuid": "12345a67-8f0b-123c-45de-6fab78cd01e2",
    "name": "URL",
    "description": "The built-in URL Resource Type available to OpenAM Policies.",
    "patterns": [
        "*://*:*/*?*",
        "*://*:*/*"
    ],
    "actions": {
        "POST": true,
        "PATCH": true,
        "GET": true,
        "DELETE": true,
        "OPTIONS": true,
        "HEAD": true,
        "PUT": true
    },
    "createdBy": "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "creationDate": 1422892465848,
    "lastModifiedBy": "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedDate": 1422892465848
}</pre>
         <div class="variablelist">
          <p> The values for the fields shown in the description are explained below: </p>
          <dl class="variablelist">
           <dt>
            <span class="term"><code class="literal">"uuid"</code></span>
           </dt>
           <dd>
            <p> String matching the unique identifier OpenAM generated for the resource type when created. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"name"</code></span>
           </dt>
           <dd>
            <p> The name provided for the resource type. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"description"</code></span>
           </dt>
           <dd>
            <p> An optional text string to help identify the resource type. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"patterns"</code></span>
           </dt>
           <dd>
            <p> An array of resource patterns specifying individual URLs or resource names to protect. </p>
            <p>For more information on patterns in resource types and policies, see <a href="../admin-guide/index.html#policy-patterns-wildcards" class="olink">Section&nbsp;3.3.4, "Specifying Resource Patterns with Wildcards"</a> in the <em>Administration Guide</em></p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"actions"</code></span>
           </dt>
           <dd>
            <p> Set of string action names, each set to a boolean indicating whether the action is allowed. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"createdBy"</code></span>
           </dt>
           <dd>
            <p> A string containing the universal identifier DN of the subject that created the resource type. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"creationDate"</code></span>
           </dt>
           <dd>
            <p> An integer containing the creation date and time, in ISO 8601 format. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"lastModifiedBy"</code></span>
           </dt>
           <dd>
            <p> A string containing the universal identifier DN of the subject that most recently updated the resource type. </p>
            <p>If the resource type has not been modified since it was created, this will be the same value as <code class="literal">createdBy</code>.</p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"lastModifiedDate"</code></span>
           </dt>
           <dd>
            <p> An string containing the last modified date and time, in ISO 8601 format. </p>
            <p>If the resource type has not been modified since it was created, this will be the same value as <code class="literal">creationDate</code>. </p>
           </dd>
          </dl>
         </div>
         <div class="section" id="rest-api-authz-resource-types-query">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.3.1.&nbsp;Querying Resource Types</h5>
            </div>
           </div>
          </div>
          <p> To list all the resource types in a realm, perform an HTTP GET to the <code class="literal">/json{<em class="replaceable">/realm</em>}/resourcetypes</code> endpoint, with a <code class="literal">_queryFilter</code> parameter set to <code class="literal">true</code>. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p>If the realm is not specified in the URL, OpenAM returns resource types in the top level realm.</p>
           </div>
          </div>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
https://openam.example.com:8443/openam/json/myrealm/resourcetypes?_queryFilter=true</strong>
<em class="computeroutput">{
    "result": [
    {
        "uuid": "12345a67-8f0b-123c-45de-6fab78cd01e3",
        "name": "LIGHTS",
        "description": "",
        "patterns": [
            "light://*/*"
        ],
        "actions": {
            "switch_off": true,
            "switch_on": true
        },
        "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
        "creationDate": 1431013059131,
        "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
        "lastModifiedDate": 1431013069803
    }
    ],
    "resultCount": 1,
    "pagedResultsCookie": null,
    "remainingPagedResults": 0
}</em></pre>
          <p> Additional query strings can be specified to alter the returned results. For more information, see <a class="xref" href="#rest-api-filter-sort-page" title="2.1.1.6.&nbsp;Filtering, Sorting, and Paging Results">Section&nbsp;2.1.1.6, "Filtering, Sorting, and Paging Results"</a>. </p>
          <div class="table" id="d14232e3388">
           <div class="table-title">
            Table&nbsp;2.2.&nbsp;Supported _queryFilter Fields and Operators
           </div>
           <div class="table-contents">
            <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Supported _queryFilter Fields and
     Operators" border="0">
             <colgroup>
              <col width="50%">
              <col width="50%">
             </colgroup>
             <thead>
              <tr>
               <th>Field</th>
               <th>Supported Operators</th>
              </tr>
             </thead>
             <tbody>
              <tr>
               <td><code class="literal">uuid</code></td>
               <td> Equals (<code class="literal">eq</code>), Contains (<code class="literal">co</code>), Starts with (<code class="literal">sw</code>) </td>
              </tr>
              <tr>
               <td><code class="literal">name</code></td>
               <td> Equals (<code class="literal">eq</code>), Contains (<code class="literal">co</code>), Starts with (<code class="literal">sw</code>) </td>
              </tr>
              <tr>
               <td><code class="literal">description</code></td>
               <td> Equals (<code class="literal">eq</code>), Contains (<code class="literal">co</code>), Starts with (<code class="literal">sw</code>) </td>
              </tr>
              <tr>
               <td><code class="literal">patterns</code></td>
               <td> Equals (<code class="literal">eq</code>), Contains (<code class="literal">co</code>), Starts with (<code class="literal">sw</code>) </td>
              </tr>
              <tr>
               <td><code class="literal">actions</code></td>
               <td> Equals (<code class="literal">eq</code>), Contains (<code class="literal">co</code>), Starts with (<code class="literal">sw</code>) </td>
              </tr>
             </tbody>
            </table>
           </div>
          </div>
          <br class="table-break">
         </div>
         <div class="section" id="rest-api-authz-resource-types-read">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.3.2.&nbsp;Reading a Specific Resource Type</h5>
            </div>
           </div>
          </div>
          <p> To read an individual resource types in a realm, perform an HTTP GET to the <code class="literal">/json{<em class="replaceable">/realm</em>}/resourcetypes</code> endpoint, and specify the UUID in the URL. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p>If the realm is not specified in the URL, OpenAM uses the top level realm.</p>
           </div>
          </div>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
https://openam.example.com:8443/openam/json/myrealm/resourcetypes/12345a67-8f0b-123c-45de-6fab78cd01e3</strong>
<em class="computeroutput">{
    "uuid": "12345a67-8f0b-123c-45de-6fab78cd01e3",
    "name": "LIGHTS",
    "description": "",
    "patterns": [
        "light://*/*"
    ],
    "actions": {
        "switch_off": true,
        "switch_on": true
    },
    "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "creationDate": 1431013059131,
    "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedDate": 1431013069803
}</em></pre>
         </div>
         <div class="section" id="rest-api-authz-resource-types-create">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.3.3.&nbsp;Creating a Resource Type</h5>
            </div>
           </div>
          </div>
          <p> To create a resource type in a realm, perform an HTTP POST to the <code class="literal">/json{<em class="replaceable">/realm</em>}/resourcetypes</code> endpoint, with an <code class="literal">_action</code> parameter set to <code class="literal">create</code>. Include a JSON representation of the resource type in the POST data. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p>If the realm is not specified in the URL, OpenAM creates the resource type in the top level realm.</p>
           </div>
          </div>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <p lang="en"> Do not use special characters within resource type, policy, or policy set names (for example, "my+resource+type") when using the console or REST endpoints. Using the special characters listed below causes OpenAM to return a 400 Bad Request error. The special characters are: double quotes (<kbd>"</kbd>), plus sign (<kbd>+</kbd>), comma (<kbd>,</kbd>), less than (<kbd>&lt;</kbd>), equals (<kbd>=</kbd>), greater than (<kbd>&gt;</kbd>), backslash (<kbd>\</kbd>), forward slash (<kbd>/</kbd>), semicolon (<kbd>;</kbd>), and null (<kbd>\u0000</kbd>). </p>
          <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
--request POST \
--header "Content-Type: application/json" \
--data '{
    "name": "My Resource Type",
    "actions": {
        "LEFT": true,
        "RIGHT": true,
        "UP": true,
        "DOWN": true
    },
    "patterns": [
        "http://device/location/*"
    ]
}' \
https://openam.example.com:8443/openam/json/myrealm/resourcetypes/?_action=create</strong>
<em class="computeroutput">{
    "uuid": "12345a67-8f0b-123c-45de-6fab78cd01e4",
    "name": "My Resource Type",
    "description": null,
    "patterns": [
        "http://device/location/*"
    ],
    "actions": {
        "RIGHT": true,
        "DOWN": true,
        "UP": true,
        "LEFT": true
    },
    "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "creationDate": 1431099940616,
    "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedDate": 1431099940616
}</em></pre>
         </div>
         <div class="section" id="rest-api-authz-resource-types-update">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.3.4.&nbsp;Updating a Resource Type</h5>
            </div>
           </div>
          </div>
          <p> To update an individual resource type in a realm, perform an HTTP PUT to the <code class="literal">/json{<em class="replaceable">/realm</em>}/resourcetypes </code> endpoint, and specify the UUID in both the URL and the PUT body. Include a JSON representation of the updated resource type in the PUT data, alongside the UUID. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p>If the realm is not specified in the URL, OpenAM uses the top level realm.</p>
           </div>
          </div>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <p lang="en"> Do not use special characters within resource type, policy, or policy set names (for example, "my+resource+type") when using the console or REST endpoints. Using the special characters listed below causes OpenAM to return a 400 Bad Request error. The special characters are: double quotes (<kbd>"</kbd>), plus sign (<kbd>+</kbd>), comma (<kbd>,</kbd>), less than (<kbd>&lt;</kbd>), equals (<kbd>=</kbd>), greater than (<kbd>&gt;</kbd>), backslash (<kbd>\</kbd>), forward slash (<kbd>/</kbd>), semicolon (<kbd>;</kbd>), and null (<kbd>\u0000</kbd>). </p>
          <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
--request PUT \
--header "Content-Type: application/json" \
--data '{
    "uuid": "12345a67-8f0b-123c-45de-6fab78cd01e4",
    "name": "My Updated Resource Type",
    "actions": {
        "LEFT": false,
        "RIGHT": false,
        "UP": false,
        "DOWN": false
    },
    "patterns": [
        "http://device/location/*"
    ]
}' \
https://openam.example.com:8443/openam/json/myrealm/resourcetypes/12345a67-8f0b-123c-45de-6fab78cd01e4</strong>
<em class="computeroutput">{
    "uuid": "12345a67-8f0b-123c-45de-6fab78cd01e4",
    "name": "My Updated Resource Type",
    "description": null,
    "patterns": [
        "http://device/location/*"
    ],
    "actions": {
        "RIGHT": false,
        "DOWN": false,
        "UP": false,
        "LEFT": false
    },
    "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "creationDate": 1431099940616,
    "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedDate": 1431101016427
}</em></pre>
         </div>
         <div class="section" id="rest-api-authz-resource-types-delete">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.3.5.&nbsp;Deleting a Specific Resource Type</h5>
            </div>
           </div>
          </div>
          <p> To delete an individual resource types in a realm, perform an HTTP DELETE to the <code class="literal">/json{<em class="replaceable">/realm</em>}/resourcetypes</code> endpoint, and specify the UUID in the URL. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p>If the realm is not specified in the URL, OpenAM uses the top level realm.</p>
           </div>
          </div>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--request DELETE \
--header "iPlanetDirectoryPro: AQIC5..." \
https://openam.example.com:8443/openam/json/myrealm/resourcetypes/12345a67-8f0b-123c-45de-6fab78cd01e4</strong>
<em class="computeroutput">{}</em></pre>
          <p>You can only delete resource types that are not being used by a policy set or policy. Trying to delete a resource type that is in use will return an HTTP 409 Conflict status code, with a message such as: </p>
          <pre class="cmdline prettyprint nohighlight"><em class="computeroutput">{
    "code": 409,
    "reason": "Conflict",
    "message": "Unable to remove resource type 12345a67-8f0b-123c-45de-6fab78cd01e4 because it is
                referenced in the policy model."
}</em></pre>
          <p>Remove the resource type from any associated policy sets or policies to be able to delete it.</p>
         </div>
        </div>
        <div class="section" id="rest-api-authz-application-types">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.2.4.&nbsp;Managing Application Types</h4>
           </div>
          </div>
         </div>
         <p> Application types act as templates for policy sets, and define how to compare resources and index policies. OpenAM provides a default application type that represents web resources called <code class="literal">iPlanetAMWebAgentService</code>. OpenAM policy agents use a default policy set that is based on this type, which is also called <code class="literal">iPlanetAMWebAgentService</code>. </p>
         <div class="itemizedlist">
          <p>OpenAM provides the <code class="literal">applicationtypes</code> REST endpoint for the following:</p>
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-application-types-query" title="2.1.2.4.1.&nbsp;Querying Application Types">Section&nbsp;2.1.2.4.1, "Querying Application Types"</a></p></li>
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-application-types-read" title="2.1.2.4.2.&nbsp;Reading a Specific Application Type">Section&nbsp;2.1.2.4.2, "Reading a Specific Application Type"</a></p></li>
          </ul>
         </div>
         <p> Applications types are server-wide, and do not differ by realm. Hence the URI for the application types API does not contain a realm component, but is <code class="literal">/json/applicationtypes</code>. </p>
         <p> Application type resources are represented in JSON and take the following form. Application type resources are built from standard JSON objects and values (strings, numbers, objects, arrays, <code class="literal">true</code>, <code class="literal">false</code>, and <code class="literal">null</code>). </p>
         <pre class="codelisting prettyprint javascript">{
    "name": "iPlanetAMWebAgentService",
    "actions": {
        "POST": true,
        "PATCH": true,
        "GET": true,
        "DELETE": true,
        "OPTIONS": true,
        "PUT": true,
        "HEAD": true
    },
    "resourceComparator": "com.sun.identity.entitlement.URLResourceName",
    "saveIndex": "org.forgerock.openam.entitlement.indextree.TreeSaveIndex",
    "searchIndex": "org.forgerock.openam.entitlement.indextree.TreeSearchIndex",
    "applicationClassName": "com.sun.identity.entitlement.Application"
}</pre>
         <div class="variablelist">
          <p> The values for the fields shown in the description are explained below: </p>
          <dl class="variablelist">
           <dt>
            <span class="term"><code class="literal">"name"</code></span>
           </dt>
           <dd>
            <p> The name provided for the application type. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"actions"</code></span>
           </dt>
           <dd>
            <p> Set of string action names, each set to a boolean indicating whether the action is allowed. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"resourceComparator"</code></span>
           </dt>
           <dd>
            <p> Class name of the resource comparator implementation used in the context of this application type. </p>
            <p> The following implementations are available: </p>
            <table border="0" summary="Simple list" class="simplelist">
             <tbody>
              <tr>
               <td><code class="literal">"com.sun.identity.entitlement.ExactMatchResourceName"</code></td>
              </tr>
              <tr>
               <td><code class="literal">"com.sun.identity.entitlement.PrefixResourceName"</code></td>
              </tr>
              <tr>
               <td><code class="literal">"com.sun.identity.entitlement.RegExResourceName"</code></td>
              </tr>
              <tr>
               <td><code class="literal">"com.sun.identity.entitlement.URLResourceName"</code></td>
              </tr>
             </tbody>
            </table>
           </dd>
           <dt>
            <span class="term"><code class="literal">"saveIndex"</code></span>
           </dt>
           <dd>
            <p> Class name of the implementation for creating indexes for resource names, such as <code class="literal">"com.sun.identity.entitlement.util.ResourceNameIndexGenerator"</code> for URL resource names. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"searchIndex"</code></span>
           </dt>
           <dd>
            <p> Class name of the implementation for searching indexes for resource names, such as <code class="literal">"com.sun.identity.entitlement.util.ResourceNameSplitter"</code> for URL resource names. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"applicationClassName"</code></span>
           </dt>
           <dd>
            <p> Class name of the application type implementation, such as <code class="literal">"com.sun.identity.entitlement.Application"</code>. </p>
           </dd>
          </dl>
         </div>
         <div class="section" id="rest-api-authz-application-types-query">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.4.1.&nbsp;Querying Application Types</h5>
            </div>
           </div>
          </div>
          <p> To list all application types, perform an HTTP GET to the <code class="literal">/json/applicationtypes</code> endpoint, with a <code class="literal">_queryFilter</code> parameter set to <code class="literal">true</code>. </p>
          <p>The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
https://openam.example.com:8443/openam/json/applicationtypes?_queryFilter=true</strong>
<em class="computeroutput">{
    "result" : [ ... application types ... ],
    "resultCount" : 8,
    "pagedResultsCookie" : null,
    "remainingPagedResults" : -1
}</em></pre>
          <p> Additional query strings can be specified to alter the returned results. For more information, see <a class="xref" href="#rest-api-filter-sort-page" title="2.1.1.6.&nbsp;Filtering, Sorting, and Paging Results">Section&nbsp;2.1.1.6, "Filtering, Sorting, and Paging Results"</a>. </p>
         </div>
         <div class="section" id="rest-api-authz-application-types-read">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.4.2.&nbsp;Reading a Specific Application Type</h5>
            </div>
           </div>
          </div>
          <p> To read an individual application type, perform an HTTP GET to the <code class="literal">/json/applicationtypes</code> endpoint, and specify the application type name in the URL. </p>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
https://openam.example.com:8443/openam/json/applicationtypes/iPlanetAMWebAgentService</strong>
<em class="computeroutput">{
    "name": "iPlanetAMWebAgentService",
    "actions": {
        "POST": true,
        "PATCH": true,
        "GET": true,
        "DELETE": true,
        "OPTIONS": true,
        "PUT": true,
        "HEAD": true
    },
    "resourceComparator": "com.sun.identity.entitlement.URLResourceName",
    "saveIndex": "org.forgerock.openam.entitlement.indextree.TreeSaveIndex",
    "searchIndex": "org.forgerock.openam.entitlement.indextree.TreeSearchIndex",
    "applicationClassName": "com.sun.identity.entitlement.Application"
}</em></pre>
         </div>
        </div>
        <div class="section" id="rest-api-authz-applications">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.2.5.&nbsp;Managing Policy Sets</h4>
           </div>
          </div>
         </div>
         <p> This section describes the process of using the OpenAM REST API for managing policy sets. </p>
         <p> Policy set definitions set constraints for defining <a class="link" href="#rest-api-authz-policies" title="2.1.2.6.&nbsp;Managing Policies">policies</a>. The default built-in policy set is called <code class="literal">iPlanetAMWebAgentService</code>, which OpenAM policy agents use to allow policy management through the console. </p>
         <p>For information on creating policy sets by using the OpenAM console, see <a href="../admin-guide/index.html#what-is-authz-policies" class="olink">Section&nbsp;3.1.1, "OpenAM Resource Types, Policy Sets, and Policies"</a> in the <em>Administration Guide</em>.</p>
         <div class="itemizedlist">
          <p>OpenAM provides the <code class="literal">applications</code> REST endpoint for the following:</p>
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-applications-query" title="2.1.2.5.1.&nbsp;Querying Policy Sets">Section&nbsp;2.1.2.5.1, "Querying Policy Sets"</a></p></li>
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-applications-read" title="2.1.2.5.2.&nbsp;Reading a Specific Policy Set">Section&nbsp;2.1.2.5.2, "Reading a Specific Policy Set"</a></p></li>
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-applications-create" title="2.1.2.5.3.&nbsp;Creating Policy Sets">Section&nbsp;2.1.2.5.3, "Creating Policy Sets"</a></p></li>
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-applications-update" title="2.1.2.5.4.&nbsp;Updating Policy Sets">Section&nbsp;2.1.2.5.4, "Updating Policy Sets"</a></p></li>
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-applications-delete" title="2.1.2.5.5.&nbsp;Deleting Policy Sets">Section&nbsp;2.1.2.5.5, "Deleting Policy Sets"</a></p></li>
          </ul>
         </div>
         <p> Policy sets are realm specific, hence the URI for the policy set API can contain a realm component, such as <code class="literal">/json{<em class="replaceable">/realm</em>}/applications</code>. If the realm is not specified in the URI, the top level realm is used.</p>
         <p> Policy sets are represented in JSON and take the following form. Policy sets are built from standard JSON objects and values (strings, numbers, objects, arrays, <code class="literal">true</code>, <code class="literal">false</code>, and <code class="literal">null</code>). </p>
         <pre class="codelisting prettyprint javascript">{
    "creationDate": 1431351677264,
    "lastModifiedDate": 1431351677264,
    "conditions": [
        "AuthenticateToService",
        "Script",
        "AuthScheme",
        "IPv6",
        "SimpleTime",
        "OAuth2Scope",
        "IPv4",
        "AuthenticateToRealm",
        "OR",
        "AMIdentityMembership",
        "LDAPFilter",
        "AuthLevel",
        "SessionProperty",
        "LEAuthLevel",
        "Session",
        "NOT",
        "AND",
        "ResourceEnvIP"
    ],
    "applicationType": "iPlanetAMWebAgentService",
    "subjects": [
        "JwtClaim",
        "AuthenticatedUsers",
        "Identity",
        "NOT",
        "AND",
        "NONE",
        "OR"
    ],
    "entitlementCombiner": "DenyOverride",
    "saveIndex": null,
    "searchIndex": null,
    "resourceComparator": null,
    "resourceTypeUuids": [
        "12345a67-8f0b-123c-45de-6fab78cd01e4"
    ],
    "attributeNames": [ ],
    "editable": true,
    "createdBy": "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedBy": "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "description": "The built-in Application used by OpenAM Policy Agents.",
    "realm": "/",
    "name": "iPlanetAMWebAgentService"
}</pre>
         <div class="variablelist">
          <p> The values for the fields shown in the description are explained below: </p>
          <dl class="variablelist">
           <dt>
            <span class="term"><code class="literal">"conditions"</code></span>
           </dt>
           <dd>
            <p> Condition types allowed in the context of this policy set. </p>
            <p> For information on condition types, see <a class="xref" href="#rest-api-authz-policies" title="2.1.2.6.&nbsp;Managing Policies">Section&nbsp;2.1.2.6, "Managing Policies"</a> and <a class="xref" href="#rest-api-authz-condition-types" title="2.1.2.8.&nbsp;Managing Environment Condition Types">Section&nbsp;2.1.2.8, "Managing Environment Condition Types"</a>. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"applicationType"</code></span>
           </dt>
           <dd>
            <p> Name of the application type used as a template for this policy set. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"subjects"</code></span>
           </dt>
           <dd>
            <p> Subject types allowed in the context of this policy set. </p>
            <p> For information on subject types, see <a class="xref" href="#rest-api-authz-policies" title="2.1.2.6.&nbsp;Managing Policies">Section&nbsp;2.1.2.6, "Managing Policies"</a> and <a class="xref" href="#rest-api-authz-subject-types" title="2.1.2.9.&nbsp;Managing Subject Condition Types">Section&nbsp;2.1.2.9, "Managing Subject Condition Types"</a>. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"entitlementCombiner"</code></span>
           </dt>
           <dd>
            <p> Name of the decision combiner, such as <code class="literal">"DenyOverride"</code>. </p>
            <p> For more on decision combiners, see <a class="xref" href="#rest-api-authz-decision-combiners" title="2.1.2.11.&nbsp;Managing Decision Combiners">Section&nbsp;2.1.2.11, "Managing Decision Combiners"</a>. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"saveIndex"</code></span>
           </dt>
           <dd>
            <p> Class name of the implementation for creating indexes for resource names, such as <code class="literal">"com.sun.identity.entitlement.util.ResourceNameIndexGenerator"</code> for URL resource names. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"searchIndex"</code></span>
           </dt>
           <dd>
            <p> Class name of the implementation for searching indexes for resource names, such as <code class="literal">"com.sun.identity.entitlement.util.ResourceNameSplitter"</code> for URL resource names. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"resourceComparator"</code></span>
           </dt>
           <dd>
            <p> Class name of the resource comparator implementation used in the context of this policy set. </p>
            <p> The following implementations are available: </p>
            <table border="0" summary="Simple list" class="simplelist">
             <tbody>
              <tr>
               <td><code class="literal">"com.sun.identity.entitlement.ExactMatchResourceName"</code></td>
              </tr>
              <tr>
               <td><code class="literal">"com.sun.identity.entitlement.PrefixResourceName"</code></td>
              </tr>
              <tr>
               <td><code class="literal">"com.sun.identity.entitlement.RegExResourceName"</code></td>
              </tr>
              <tr>
               <td><code class="literal">"com.sun.identity.entitlement.URLResourceName"</code></td>
              </tr>
             </tbody>
            </table>
           </dd>
           <dt>
            <span class="term"><code class="literal">"resourceTypeUuids"</code></span>
           </dt>
           <dd>
            <p> A list of the UUIDs of the resource types associated with the policy set. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"attributeNames"</code></span>
           </dt>
           <dd>
            <p> A list of attribute names such as <code class="literal">cn</code>. The list is used to aid policy indexing and lookup. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"description"</code></span>
           </dt>
           <dd>
            <p> String describing the policy set. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"realm"</code></span>
           </dt>
           <dd>
            <p> Name of the realm where this policy set is defined. You must specify the realm in the policy set JSON even though it can be derived from the URL that is used when creating the policy set. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"name"</code></span>
           </dt>
           <dd>
            <p> String matching the name in the URL used when creating the policy set by HTTP PUT or in the body when creating the policy set by HTTP POST. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"createdBy"</code></span>
           </dt>
           <dd>
            <p> A string containing the universal identifier DN of the subject that created the policy set. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"creationDate"</code></span>
           </dt>
           <dd>
            <p> An integer containing the creation date and time, in number of seconds since the Unix epoch (1970-01-01T00:00:00Z). </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"lastModifiedBy"</code></span>
           </dt>
           <dd>
            <p> A string containing the universal identifier DN of the subject that most recently updated the policy set. </p>
            <p>If the policy set has not been modified since it was created, this will be the same value as <code class="literal">createdBy</code>.</p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"lastModifiedDate"</code></span>
           </dt>
           <dd>
            <p> An integer containing the last modified date and time, in number of seconds since the Unix epoch (1970-01-01T00:00:00Z). </p>
            <p>If the policy set has not been modified since it was created, this will be the same value as <code class="literal">creationDate</code>. </p>
           </dd>
          </dl>
         </div>
         <div class="section" id="rest-api-authz-applications-query">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.5.1.&nbsp;Querying Policy Sets</h5>
            </div>
           </div>
          </div>
          <p> To list all the policy sets in a realm, perform an HTTP GET to the <code class="literal">/json{<em class="replaceable">/realm</em>}/applications</code> endpoint, with a <code class="literal">_queryFilter</code> parameter set to <code class="literal">true</code>. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p>If the realm is not specified in the URL, OpenAM returns policy sets in the top level realm.</p>
           </div>
          </div>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
https://openam.example.com:8443/openam/json/applications?_queryFilter=true
</strong><em class="computeroutput">{
    "result": [
        {
            "creationDate": 1431360678810,
            "lastModifiedDate": 1431360678810,
            "conditions": [
                "AuthenticateToService",
                "AuthScheme",
                "IPv6",
                "SimpleTime",
                "OAuth2Scope",
                "IPv4",
                "AuthenticateToRealm",
                "OR",
                "AMIdentityMembership",
                "LDAPFilter",
                "SessionProperty",
                "AuthLevel",
                "LEAuthLevel",
                "Session",
                "NOT",
                "AND",
                "ResourceEnvIP"
            ],
            "applicationType": "iPlanetAMWebAgentService",
            "subjects": [
                "JwtClaim",
                "AuthenticatedUsers",
                "Identity",
                "NOT",
                "AND",
                "OR"
            ],
            "entitlementCombiner": "DenyOverride",
            "saveIndex": null,
            "searchIndex": null,
            "resourceComparator": "com.sun.identity.entitlement.URLResourceName",
            "resourceTypeUuids": [
                "12345a67-8f0b-123c-45de-6fab78cd01e2"
            ],
            "attributeNames": [ ],
            "editable": true,
            "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
            "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
            "description": "My example policy set.",
            "realm": "/",
            "name": "mypolicyset"
        }
    ],
    "resultCount": 1,
    "pagedResultsCookie": null,
    "remainingPagedResults": 0
}</em>
   </pre>
          <p> Additional query strings can be specified to alter the returned results. For more information, see <a class="xref" href="#rest-api-filter-sort-page" title="2.1.1.6.&nbsp;Filtering, Sorting, and Paging Results">Section&nbsp;2.1.1.6, "Filtering, Sorting, and Paging Results"</a>. </p>
          <div class="table" id="d14232e4087">
           <div class="table-title">
            Table&nbsp;2.3.&nbsp;Supported _queryFilter Fields and Operators
           </div>
           <div class="table-contents">
            <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Supported _queryFilter Fields and
     Operators" border="0">
             <colgroup>
              <col width="50%">
              <col width="50%">
             </colgroup>
             <thead>
              <tr>
               <th>Field</th>
               <th>Supported Operators</th>
              </tr>
             </thead>
             <tbody>
              <tr>
               <td><p><code class="literal">name</code></p></td>
               <td><p>Equals (<code class="literal">eq</code>)</p></td>
              </tr>
              <tr>
               <td><p><code class="literal">description</code></p></td>
               <td><p>Equals (<code class="literal">eq</code>)</p></td>
              </tr>
              <tr>
               <td><p><code class="literal">createdBy</code></p></td>
               <td><p>Equals (<code class="literal">eq</code>)</p></td>
              </tr>
              <tr>
               <td><p><code class="literal">creationDate</code></p></td>
               <td> <p> Equals (<code class="literal">eq</code>), Greater than or equal to (<code class="literal">ge</code>), Greater than (<code class="literal">gt</code>), Less than or equal to (<code class="literal">le</code>), Less than (<code class="literal">lt</code>) </p> 
                <div class="panel panel-info">
                 <div class="panel-heading">
                  <h3 class="panel-title">Note</h3>
                 </div>
                 <div class="panel-body">
                  <p>The implementation of <code class="literal">eq</code> for this date field does not use regular expression pattern matching.</p>
                 </div>
                </div></td>
              </tr>
              <tr>
               <td><p><code class="literal">lastModifiedBy</code></p></td>
               <td><p>Equals (<code class="literal">eq</code>)</p></td>
              </tr>
              <tr>
               <td><p><code class="literal">lastModifiedDate</code></p></td>
               <td><p> Equals (<code class="literal">eq</code>), Greater than or equal to (<code class="literal">ge</code>), Greater than (<code class="literal">gt</code>), Less than or equal to (<code class="literal">le</code>), Less than (<code class="literal">lt</code>) </p> 
                <div class="panel panel-info">
                 <div class="panel-heading">
                  <h3 class="panel-title">Note</h3>
                 </div>
                 <div class="panel-body">
                  <p>The implementation of <code class="literal">eq</code> for this date field does not use regular expression pattern matching.</p>
                 </div>
                </div></td>
              </tr>
             </tbody>
            </table>
           </div>
          </div>
          <br class="table-break">
         </div>
         <div class="section" id="rest-api-authz-applications-read">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.5.2.&nbsp;Reading a Specific Policy Set</h5>
            </div>
           </div>
          </div>
          <p> To read an individual policy set in a realm, perform an HTTP GET to the <code class="literal">/json{<em class="replaceable">/realm</em>}/applications </code> endpoint, and specify the policy set name in the URL. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p>If the realm is not specified in the URL, OpenAM uses the top level realm.</p>
           </div>
          </div>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
https://openam.example.com:8443/openam/json/applications/mypolicyset</strong>
<em class="computeroutput">{
    "creationDate": 1431360678810,
    "lastModifiedDate": 1431360678810,
    "conditions": [
        "AuthenticateToService",
        "AuthScheme",
        "IPv6",
        "SimpleTime",
        "OAuth2Scope",
        "IPv4",
        "AuthenticateToRealm",
        "OR",
        "AMIdentityMembership",
        "LDAPFilter",
        "SessionProperty",
        "AuthLevel",
        "LEAuthLevel",
        "Session",
        "NOT",
        "AND",
        "ResourceEnvIP"
    ],
    "applicationType": "iPlanetAMWebAgentService",
    "subjects": [
        "JwtClaim",
        "AuthenticatedUsers",
        "Identity",
        "NOT",
        "AND",
        "OR"
    ],
    "entitlementCombiner": "DenyOverride",
    "saveIndex": null,
    "searchIndex": null,
    "resourceComparator": "com.sun.identity.entitlement.URLResourceName",
    "resourceTypeUuids": [
        "12345a67-8f0b-123c-45de-6fab78cd01e2"
    ],
    "attributeNames": [ ],
    "editable": true,
    "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "description": "My example policy set.",
    "realm": "/",
    "name": "mypolicyset"
}</em></pre>
          <p> You can use the query string parameters <code class="literal">_prettyPrint=true</code> to make the output easier to read, and <code class="literal">_fields=<em class="replaceable">field-name</em>[,<em class="replaceable">field-name</em>...]</code> to limit the fields returned in the output. </p>
         </div>
         <div class="section" id="rest-api-authz-applications-create">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.5.3.&nbsp;Creating Policy Sets</h5>
            </div>
           </div>
          </div>
          <p> To create a policy set in a realm, perform an HTTP POST to the <code class="literal">/json{<em class="replaceable">/realm</em>}/applications</code> endpoint, with an <code class="literal">_action</code> parameter set to <code class="literal">create</code>. Include a JSON representation of the policy set in the POST data. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p>If the realm is not specified in the URL, OpenAM creates the policy set in the top level realm.</p>
           </div>
          </div>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <p lang="en"> Do not use special characters within resource type, policy, or policy set names (for example, "my+resource+type") when using the console or REST endpoints. Using the special characters listed below causes OpenAM to return a 400 Bad Request error. The special characters are: double quotes (<kbd>"</kbd>), plus sign (<kbd>+</kbd>), comma (<kbd>,</kbd>), less than (<kbd>&lt;</kbd>), equals (<kbd>=</kbd>), greater than (<kbd>&gt;</kbd>), backslash (<kbd>\</kbd>), forward slash (<kbd>/</kbd>), semicolon (<kbd>;</kbd>), and null (<kbd>\u0000</kbd>). </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
--request POST \
--header "iPlanetDirectoryPro: AQIC5..." \
--header "Content-Type: application/json" \
--data '{
    "name": "mypolicyset",
    "resourceTypeUuids": [
        "12345a67-8f0b-123c-45de-6fab78cd01e2"
    ],
    "realm": "/",
    "conditions": [
        "AND",
        "OR",
        "NOT",
        "AMIdentityMembership",
        "AuthLevel",
        "AuthScheme",
        "AuthenticateToRealm",
        "AuthenticateToService",
        "IPv4",
        "IPv6",
        "LDAPFilter",
        "LEAuthLevel",
        "OAuth2Scope",
        "ResourceEnvIP",
        "Session",
        "SessionProperty",
        "SimpleTime"
    ],
    "applicationType": "iPlanetAMWebAgentService",
    "description": "My example policy set.",
    "resourceComparator": "com.sun.identity.entitlement.URLResourceName",
    "subjects": [
        "AND",
        "OR",
        "NOT",
        "AuthenticatedUsers",
        "Identity",
        "JwtClaim"
    ],
    "entitlementCombiner": "DenyOverride",
    "saveIndex": null,
    "searchIndex": null,
    "attributeNames": []
}' \
https://openam.example.com:8443/openam/json/applications/?_action=create</strong>
<em class="computeroutput">{
    "creationDate": 1431360678810,
    "lastModifiedDate": 1431360678810,
    "conditions": [
        "AuthenticateToService",
        "AuthScheme",
        "IPv6",
        "SimpleTime",
        "OAuth2Scope",
        "IPv4",
        "AuthenticateToRealm",
        "OR",
        "AMIdentityMembership",
        "LDAPFilter",
        "SessionProperty",
        "AuthLevel",
        "LEAuthLevel",
        "Session",
        "NOT",
        "AND",
        "ResourceEnvIP"
    ],
    "applicationType": "iPlanetAMWebAgentService",
    "subjects": [
        "JwtClaim",
        "AuthenticatedUsers",
        "Identity",
        "NOT",
        "AND",
        "OR"
    ],
    "entitlementCombiner": "DenyOverride",
    "saveIndex": null,
    "searchIndex": null,
    "resourceComparator": "com.sun.identity.entitlement.URLResourceName",
    "resourceTypeUuids": [
        "12345a67-8f0b-123c-45de-6fab78cd01e2"
    ],
    "attributeNames": [ ],
    "editable": true,
    "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "description": "My example policy set.",
    "realm": "/",
    "name": "mypolicyset"
}</em></pre>
          <p> You can use the query string parameters <code class="literal">_prettyPrint=true</code> to make the output easier to read, and <code class="literal">_fields=<em class="replaceable">field-name</em>[,<em class="replaceable">field-name</em>...]</code> to limit the fields returned in the output. </p>
         </div>
         <div class="section" id="rest-api-authz-applications-update">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.5.4.&nbsp;Updating Policy Sets</h5>
            </div>
           </div>
          </div>
          <p> To update an individual policy set in a realm, perform an HTTP PUT to the <code class="literal">/json{<em class="replaceable">/realm</em>}/applications </code> endpoint, and specify the policy set name in the URL. Include a JSON representation of the updated policy set in the PUT data. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p>If the realm is not specified in the URL, OpenAM uses the top level realm.</p>
           </div>
          </div>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <p lang="en"> Do not use special characters within resource type, policy, or policy set names (for example, "my+resource+type") when using the console or REST endpoints. Using the special characters listed below causes OpenAM to return a 400 Bad Request error. The special characters are: double quotes (<kbd>"</kbd>), plus sign (<kbd>+</kbd>), comma (<kbd>,</kbd>), less than (<kbd>&lt;</kbd>), equals (<kbd>=</kbd>), greater than (<kbd>&gt;</kbd>), backslash (<kbd>\</kbd>), forward slash (<kbd>/</kbd>), semicolon (<kbd>;</kbd>), and null (<kbd>\u0000</kbd>). </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
--request PUT \
--header "iPlanetDirectoryPro: AQIC5..." \
--header "Content-Type: application/json" \
--data '{
    "name": "myupdatedpolicyset",
    "description": "My updated policy set - new name and fewer allowable conditions/subjects.",
    "conditions": [
        "NOT",
        "SimpleTime"
    ],
    "subjects": [
        "AND",
        "OR",
        "NOT",
        "AuthenticatedUsers",
        "Identity"
    ],
    "applicationType": "iPlanetAMWebAgentService",
    "entitlementCombiner": "DenyOverride",
    "resourceTypeUuids": [
        "76656a38-5f8e-401b-83aa-4ccb74ce88d2"
    ]
}' \
https://openam.example.com:8443/openam/json/applications/mypolicyset</strong>
<em class="computeroutput">{
    "creationDate": 1431362370739,
    "lastModifiedDate": 1431362390817,
    "conditions": [
        "NOT",
        "SimpleTime"
    ],
    "resourceComparator": "com.sun.identity.entitlement.URLResourceName",
    "resourceTypeUuids": [
        "76656a38-5f8e-401b-83aa-4ccb74ce88d2"
    ],
    "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "applicationType": "iPlanetAMWebAgentService",
    "subjects": [
        "AuthenticatedUsers",
        "Identity",
        "NOT",
        "AND",
        "OR"
    ],
    "entitlementCombiner": "DenyOverride",
    "saveIndex": null,
    "searchIndex": null,
    "attributeNames": [ ],
    "editable": true,
    "description": "My updated policy set - new name and fewer allowable conditions/subjects.",
    "realm": "/",
    "name": "myupdatedpolicyset"
}</em></pre>
          <p> You can use the query string parameters <code class="literal">_prettyPrint=true</code> to make the output easier to read, and <code class="literal">_fields=<em class="replaceable">field-name</em>[,<em class="replaceable">field-name</em>...]</code> to limit the fields returned in the output. </p>
         </div>
         <div class="section" id="rest-api-authz-applications-delete">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.5.5.&nbsp;Deleting Policy Sets</h5>
            </div>
           </div>
          </div>
          <p> To delete an individual policy set in a realm, perform an HTTP DELETE to the <code class="literal">/json{<em class="replaceable">/realm</em>}/applications </code> endpoint, and specify the policy set name in the URL. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p>If the realm is not specified in the URL, OpenAM uses the top level realm.</p>
           </div>
          </div>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">
    $ <strong class="userinput">curl \
    --request DELETE \
    --header "iPlanetDirectoryPro: AQIC5..." \
    https://openam.example.com:8443/openam/json/applications/myupdatedpolicyset</strong>
    <em class="computeroutput">{}</em></pre>
         </div>
        </div>
        <div class="section" id="rest-api-authz-policies">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.2.6.&nbsp;Managing Policies</h4>
           </div>
          </div>
         </div>
         <p> This section describes the process of using the OpenAM REST API for managing policies. </p>
         <p>For information on creating policies by using the OpenAM console, see <a href="../admin-guide/index.html#what-is-authz-policies" class="olink">Section&nbsp;3.1.1, "OpenAM Resource Types, Policy Sets, and Policies"</a> in the <em>Administration Guide</em>.</p>
         <div class="itemizedlist">
          <p>OpenAM provides the <code class="literal">policies</code> REST endpoint for the following:</p>
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-policies-query" title="2.1.2.6.1.&nbsp;Querying Policies">Section&nbsp;2.1.2.6.1, "Querying Policies"</a></p></li>
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-policies-read" title="2.1.2.6.2.&nbsp;Reading a Specific Policy">Section&nbsp;2.1.2.6.2, "Reading a Specific Policy"</a></p></li>
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-policies-create" title="2.1.2.6.3.&nbsp;Creating Policies">Section&nbsp;2.1.2.6.3, "Creating Policies"</a></p></li>
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-policies-update" title="2.1.2.6.4.&nbsp;Updating Policies">Section&nbsp;2.1.2.6.4, "Updating Policies"</a></p></li>
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-policies-delete" title="2.1.2.6.5.&nbsp;Deleting Policies">Section&nbsp;2.1.2.6.5, "Deleting Policies"</a></p></li>
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-policies-copy-move-policies" title="2.1.2.6.6.&nbsp;Copying and Moving Policies">Section&nbsp;2.1.2.6.6, "Copying and Moving Policies"</a></p></li>
          </ul>
         </div>
         <p> Policies are realm specific, hence the URI for the policies API can contain a realm component, such as <code class="literal">/json{<em class="replaceable">/realm</em>}/policies</code>. If the realm is not specified in the URI, the top level realm is used.</p>
         <p> Policy resources are represented in JSON and take the following form. Policy resources are built from standard JSON objects and values (strings, numbers, objects, arrays, <code class="literal">true</code>, <code class="literal">false</code>, and <code class="literal">null</code>). </p>
         <pre class="codelisting prettyprint javascript">{
    "name": "mypolicy",
    "active": true,
    "description": "My Policy.",
    "applicationName": "iPlanetAMWebAgentService",
    "actionValues": {
        "POST": true,
        "GET": true
    },
    "resources": [
        "http://www.example.com:80/*",
        "http://www.example.com:80/*?*"
    ],
    "subject": {
        "type": "AuthenticatedUsers"
    },
    "condition": {
        "type": "SimpleTime",
        "startTime": "09:00",
        "endTime": "17:00",
        "startDay": "mon",
        "endDay": "fri",
        "enforcementTimeZone": "GMT"
    },
    "resourceTypeUuid": "76656a38-5f8e-401b-83aa-4ccb74ce88d2",
    "resourceAttributes": [
        {
            "type": "User",
            "propertyName": "givenName",
            "propertyValues": [ ]
        }
    ],
    "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedDate": "2015-05-11T17:39:09.393Z",
    "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "creationDate": "2015-05-11T17:37:24.556Z"
}</pre>
         <div class="variablelist">
          <p> The values for the fields shown in the example are explained below: </p>
          <dl class="variablelist">
           <dt>
            <span class="term"><code class="literal">"name"</code></span>
           </dt>
           <dd>
            <p> String matching the name in the URL used when creating the policy by HTTP PUT or in the body when creating the policy by HTTP POST. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"active"</code></span>
           </dt>
           <dd>
            <p> Boolean indicating whether OpenAM considers the policy active for evaluation purposes, defaults to <code class="literal">false</code>. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"description"</code></span>
           </dt>
           <dd>
            <p> String describing the policy. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"resources"</code></span>
           </dt>
           <dd>
            <p> List of the resource name pattern strings to which the policy applies. Must conform to the pattern templates provided by the associated <a class="link" href="#rest-api-authz-resource-types" title="2.1.2.3.&nbsp;Managing Resource Types">resource type</a>. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"applicationName"</code></span>
           </dt>
           <dd>
            <p> String containing the policy set name, such as <code class="literal">"iPlanetAMWebAgentService"</code>, or <code class="literal">"mypolicyset"</code>. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"actionValues"</code></span>
           </dt>
           <dd>
            <p> Set of string action names, each set to a boolean indicating whether the action is allowed. Chosen from the available actions provided by the associated <a class="link" href="#rest-api-authz-resource-types" title="2.1.2.3.&nbsp;Managing Resource Types">resource type</a>. </p>
            <div class="panel panel-success">
             <div class="panel-heading">
              <h3 class="panel-title">Tip</h3>
             </div>
             <div class="panel-body">
              <p> Action values can also be expressed as numeric values. When using numeric values, use the value <code class="literal">0</code> for <code class="literal">false</code> and use any non-zero numeric value for <code class="literal">true</code>.</p>
             </div>
            </div>
           </dd>
           <dt>
            <span class="term"><code class="literal">"subject"</code></span>
           </dt>
           <dd>
            <p> Specifies the subject conditions to which the policy applies, where subjects can be combined by using the built-in types <code class="literal">"AND"</code>, <code class="literal">"OR"</code>, and <code class="literal">"NOT"</code>, and where subject implementations are pluggable. </p>
            <p> Subjects are shown as JSON objects with <code class="literal">"type"</code> set to the name of the implementation (using a short name for all registered subject implementations), and also other fields depending on the implementation. The subject types registered by default include the following: </p>
            <div class="itemizedlist">
             <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem"><p> <code class="literal">"AuthenticatedUsers"</code>, meaning any user that has successfully authenticated to OpenAM. </p><pre class="codelisting prettyprint javascript">{
    "type": "AuthenticatedUsers"
}       </pre>
               <div class="panel panel-warning">
                <div class="panel-heading">
                 <h3 class="panel-title">Warning</h3>
                </div>
                <div class="panel-body">
                 <p> The <code class="literal">AuthenticatedUsers</code> subject condition does not take into account the realm to which a user authenticated. Any user that has authenticated successfully to any realm passes this subject condition.</p>
                 <p>To test whether a user has authenticated successfully to a specific realm, also add the <code class="literal">AuthenticateToRealm</code> environment condition. </p>
                </div>
               </div></li>
              <li class="listitem"><p> <code class="literal">"Identity"</code> to specify one or more users from an OpenAM identity repository: </p><pre class="codelisting prettyprint javascript">{
   "type": "Identity",
   "subjectValues": [
       "uid=scarter,ou=People,dc=example,dc=com",
       "uid=ahall,ou=People,dc=example,dc=com"
   ]
}</pre><p> You can also use the <code class="literal">"Identity"</code> subject type to specify one or more groups from an identity repository: </p><pre class="codelisting prettyprint javascript">{
    "type": "Identity",
    "subjectValues": [
        "cn=HR Managers,ou=Groups,dc=example,dc=com"
    ]
}</pre></li>
              <li class="listitem"><p> <code class="literal">"JwtClaim"</code> to specify a claim in a user's JSON web token (JWT). </p><pre class="codelisting prettyprint javascript">{
    "type": "JwtClaim",
    "claimName": "sub",
    "claimValue": "scarter"
}</pre></li>
              <li class="listitem"><p> <code class="literal">"NONE"</code>, meaning never match any subject. The result is not that access is denied, but rather that the policy itself does not match and therefore cannot be evaluated in order to allow access. </p></li>
             </ul>
            </div>
            <p> The following example defines the subject either as the user Sam Carter from an OpenAM identity repository, or as a user with a JWT claim with a subject claim with the value scarter: </p>
            <pre class="codelisting prettyprint javascript">"subject": {
    "type": "OR",
    "subjects": [
       {
           "type": "Identity",
           "subjectValues": [
               "uid=scarter,ou=People,dc=example,dc=com"
           ]
       },
       {
           "type": "JwtClaim",
           "claimName": "sub",
           "claimValue": "scarter"
       }
   ]
}</pre>
            <p> To read a single subject type description, or to list all the available subject types, see <a class="xref" href="#rest-api-authz-subject-types" title="2.1.2.9.&nbsp;Managing Subject Condition Types">Section&nbsp;2.1.2.9, "Managing Subject Condition Types"</a>. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"condition"</code></span>
           </dt>
           <dd>
            <p> Specifies environment conditions, where conditions can be combined by using the built-in types <code class="literal">"AND"</code>, <code class="literal">"OR"</code>, and <code class="literal">"NOT"</code>, and where condition implementations are pluggable. </p>
            <p> Conditions are shown as JSON objects with <code class="literal">"type"</code> set to the name of the implementation (using a short name for all registered condition implementations), and also other fields depending on the implementation. The condition types registered by default include the following. </p>
            <div class="itemizedlist">
             <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem"><p> <code class="literal">"AMIdentityMembership"</code> to specify a list of OpenAM users and groups. </p><pre class="codelisting prettyprint javascript">{
    "type": "AMIdentityMembership",
    "amIdentityName": [
        "id=scarter,ou=People,dc=example,dc=com"
    ]
}</pre></li>
              <li class="listitem"><p> <code class="literal">"AuthLevel"</code> to specify the authentication level. </p><pre class="codelisting prettyprint javascript">{
    "type": "AuthLevel",
    "authLevel": 2
}</pre></li>
              <li class="listitem"><p> <code class="literal">"AuthScheme"</code> to specify the authentication module used to authenticate and the policy set name, and to set a timeout for authentication. </p><pre class="codelisting prettyprint javascript">{
    "type": "AuthScheme",
    "authScheme": [
        "DataStore"
    ],
    "applicationName": "iPlanetAMWebAgentService",
    "applicationIdleTimeout": 10
}</pre></li>
              <li class="listitem"><p> <code class="literal">"AuthenticateToRealm"</code> to specify the realm to which the user authenticated. </p><pre class="codelisting prettyprint javascript">{
    "type": "AuthenticateToRealm",
    "authenticateToRealm": "MyRealm"
}</pre></li>
              <li class="listitem"><p> <code class="literal">"AuthenticateToService"</code> to specify the authentication chain that was used to authenticate. </p><pre class="codelisting prettyprint javascript">{
    "type": "AuthenticateToService",
    "authenticateToService": "MyAuthnChain"
}</pre></li>
              <li class="listitem"><p> <code class="literal">"IPv4"</code> or <code class="literal">"IPv6"</code> to specify an IP address range from which the request originated. </p><pre class="codelisting prettyprint javascript">{
   "type": "IPv4",
   "startIp": "127.0.0.1",
   "endIp": "127.0.0.255"
}</pre><p> You can also use the <code class="literal">"IPv4"</code> and <code class="literal">"IPv6"</code> conditions with the <code class="literal">"dnsName"</code> field to specify domain names from which the request originated. Omit <code class="literal">"startIp"</code> and <code class="literal">"endIp"</code> when using <code class="literal">"dnsName"</code>. </p><pre class="codelisting prettyprint javascript">{
    "type": "IPv4",
    "dnsName": [
        "*.example.com"
    ]
}</pre></li>
              <li class="listitem"><p> <code class="literal">"LDAPFilter"</code> to specify an LDAP search filter. The user's entry is tested against the search filter in the directory configured in the Policy Configuration Service. </p><pre class="codelisting prettyprint javascript">{
    "type": "LDAPFilter",
    "ldapFilter": "(&amp;(c=US)(preferredLanguage=en-us))"
}</pre></li>
              <li class="listitem"><p> <code class="literal">"LEAuthLevel"</code> to specify a maximum acceptable authentication level. </p><pre class="codelisting prettyprint javascript">
{
    "type": "LEAuthLevel",
    "authLevel": 2
}
       </pre></li>
              <li class="listitem"><p> <code class="literal">"OAuth2Scope"</code> to specify a list of attributes that must be present in the user profile. </p><pre class="codelisting prettyprint javascript">{
    "type": "OAuth2Scope",
    "requiredScopes": [
        "name",
        "address",
        "email"
    ]
}</pre></li>
              <li class="listitem"><p> <code class="literal">"ResourceEnvIP"</code> to specify a complex condition such as whether the user is making a request from a given host and has authenticated with a given authentication level. For example: </p><pre class="codelisting prettyprint javascript">{
    "type": "ResourceEnvIP",
    "resourceEnvIPConditionValue": [
        "IF IP=[127.168.10.*] THEN authlevel=4"
    ]
}</pre><p> Entries must take the form of one or more IF...ELSE statements. If the IF statement is true, the THEN statement must also be true for the condition to be fulfilled. The IF statement can specify either IP to match the user's IP address, or dnsName to match their DNS name. The IP address can be IPv4 or IPv6 format, or a hybrid of the two, and can include wildcard characters. </p><p> The available parameters for the THEN statement are as follows: </p>
               <div class="variablelist">
                <dl class="variablelist">
                 <dt>
                  <span class="term"> <code class="literal">module</code> </span>
                 </dt>
                 <dd>
                  <p> The module that was used to authenticate the user, for example DataStore. </p>
                 </dd>
                 <dt>
                  <span class="term"> <code class="literal">service</code> </span>
                 </dt>
                 <dd>
                  <p> The authentication chain that was used to authenticate the user. </p>
                 </dd>
                 <dt>
                  <span class="term"> <code class="literal">authlevel</code> </span>
                 </dt>
                 <dd>
                  <p> The minimum required authentication level. </p>
                 </dd>
                 <dt>
                  <span class="term"> <code class="literal">role</code> </span>
                 </dt>
                 <dd>
                  <p> The role of the authenticated user. </p>
                 </dd>
                 <dt>
                  <span class="term"> <code class="literal">user</code> </span>
                 </dt>
                 <dd>
                  <p> The name of the authenticated user. </p>
                 </dd>
                 <dt>
                  <span class="term"> <code class="literal">redirectURL</code> </span>
                 </dt>
                 <dd>
                  <p> The URL from which the user was redirected. </p>
                 </dd>
                 <dt>
                  <span class="term"> <code class="literal">realm</code> </span>
                 </dt>
                 <dd>
                  <p> The realm to which the user authenticated. </p>
                 </dd>
                </dl>
               </div></li>
              <li class="listitem"><p> <code class="literal">"Session"</code> to specify how long the user's stateful or stateless session has been active, and to terminate the session if deemed too old, such that the user must authenticate again. Note that OpenAM terminates stateless sessions only if session blacklisting is in effect. For more information about session blacklisting, see <a href="../admin-guide/index.html#session-state-session-termination" class="olink">Section&nbsp;9.4, "Session Termination"</a> in the <em>Administration Guide</em>. </p><pre class="codelisting prettyprint javascript">{
    "type": "Session",
    "maxSessionTime": "10",
    "terminateSession": false
}</pre></li>
              <li class="listitem"><p> <code class="literal">"SessionProperty"</code> to specify attributes set in the user's stateful or stateless session. </p><pre class="codelisting prettyprint javascript">{
    "type": "SessionProperty",
    "ignoreValueCase": true,
    "properties": {
        "CharSet": [
            "UTF-8"
        ],
        "clientType": [
            "genericHTML"
        ]
    }
}</pre></li>
              <li class="listitem"><p> <code class="literal">"SimpleTime"</code> to specify a time range, where <code class="literal">"type"</code> is the only required field. </p><pre class="codelisting prettyprint javascript">{
    "type": "SimpleTime",
    "startTime": "07:00",
    "endTime": "19:00",
    "startDay": "mon",
    "endDay": "fri",
    "startDate": "2015:01:01",
    "endDate": "2015:12:31",
    "enforcementTimeZone": "GMT+0:00"
}</pre></li>
             </ul>
            </div>
            <p> The following example defines the condition as neither Saturday or Sunday, nor certain client IP addresses. </p>
            <pre class="codelisting prettyprint javascript">{
    "type": "NOT",
    "condition": {
        "type": "OR",
        "conditions": [
            {
                "type": "SimpleTime",
                "startDay": "sat",
                "endDay": "sun",
                "enforcementTimeZone": "GMT+8:00"
            },
            {
                "type": "IPv4",
                "startIp": "192.168.0.1",
                "endIp": "192.168.0.255"
            }
        ]
    }
}</pre>
            <p> To read a single condition type description, or to list all the available condition types, see <a class="xref" href="#rest-api-authz-condition-types" title="2.1.2.8.&nbsp;Managing Environment Condition Types">Section&nbsp;2.1.2.8, "Managing Environment Condition Types"</a>. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"resourceTypeUuid"</code></span>
           </dt>
           <dd>
            <p>The UUIDs of the resource type associated with the policy.</p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"resourceAttributes"</code></span>
           </dt>
           <dd>
            <p> List of attributes to return with decisions. These attributes are known as <em class="firstterm">response attributes</em>. </p>
            <p>The response attribute provider is pluggable. The default implementation provides for statically defined attributes and for attributes retrieved from user profiles. </p>
            <p> Attributes are shown as JSON objects with <code class="literal">"type"</code> set to the name of the implementation (by default either <code class="literal">"Static"</code> for statically defined attributes or <code class="literal">"User"</code> for attributes from the user profile), <code class="literal">"propertyName"</code> set to the attribute names. For static attributes, <code class="literal">"propertyValues"</code> holds the attribute values. For user attributes, <code class="literal">"propertyValues"</code> is not used; the property values are determined at evaluation time. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"createdBy"</code></span>
           </dt>
           <dd>
            <p> A string containing the universal identifier DN of the subject that created the policy. </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"creationDate"</code></span>
           </dt>
           <dd>
            <p> An integer containing the creation date and time, in number of seconds since the Unix epoch (1970-01-01T00:00:00Z). </p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"lastModifiedBy"</code></span>
           </dt>
           <dd>
            <p> A string containing the universal identifier DN of the subject that most recently updated the policy. </p>
            <p>If the policy has not been modified since it was created, this will be the same value as <code class="literal">createdBy</code>.</p>
           </dd>
           <dt>
            <span class="term"><code class="literal">"lastModifiedDate"</code></span>
           </dt>
           <dd>
            <p> An integer containing the last modified date and time, in number of seconds since the Unix epoch (1970-01-01T00:00:00Z). </p>
            <p>If the policy has not been modified since it was created, this will be the same value as <code class="literal">creationDate</code>. </p>
           </dd>
          </dl>
         </div>
         <div class="section" id="rest-api-authz-policies-query">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.6.1.&nbsp;Querying Policies</h5>
            </div>
           </div>
          </div>
          <p> To list all the policies in a realm, perform an HTTP GET to the <code class="literal">/json{<em class="replaceable">/realm</em>}/policies</code> endpoint, with a <code class="literal">_queryFilter</code> parameter set to <code class="literal">true</code>. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p>If the realm is not specified in the URL, OpenAM returns policies in the top level realm.</p>
           </div>
          </div>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iPlanetDirectoryPro: AQIC5w..." \
 https://openam.example.com:8443/openam/json/myrealm/policies?_queryFilter=true</strong>
<em class="computeroutput">{
    "result": [
        {
        "name": "example",
        "active": true,
        "description": "Example Policy",
        "applicationName": "iPlanetAMWebAgentService",
        "actionValues": {
            "POST": false,
            "GET": true
        },
        "resources": [
            "http://www.example.com:80/*",
            "http://www.example.com:80/*?*"
        ],
        "subject": {
            "type": "Identity",
            "subjectValues": [
                "uid=demo,ou=People,dc=example,dc=com"
            ]
        },
        "resourceTypeUuid": "12345a67-8f0b-123c-45de-6fab78cd01e4",
        "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
        "lastModifiedDate": "2015-05-11T14:48:08.711Z",
        "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
        "creationDate": "2015-05-11T14:48:08.711Z"
        }
    ],
    "resultCount": 1,
    "pagedResultsCookie": null,
    "remainingPagedResults": 0
}</em></pre>
          <p> Additional query strings can be specified to alter the returned results. For more information, see <a class="xref" href="#rest-api-filter-sort-page" title="2.1.1.6.&nbsp;Filtering, Sorting, and Paging Results">Section&nbsp;2.1.1.6, "Filtering, Sorting, and Paging Results"</a>. </p>
          <div class="table" id="d14232e4992">
           <div class="table-title">
            Table&nbsp;2.4.&nbsp;Supported _queryFilter Fields and Operators
           </div>
           <div class="table-contents">
            <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Supported _queryFilter Fields and
     Operators" border="0">
             <colgroup>
              <col width="50%">
              <col width="50%">
             </colgroup>
             <thead>
              <tr>
               <th>Field</th>
               <th>Supported Operators</th>
              </tr>
             </thead>
             <tbody>
              <tr>
               <td><p><code class="literal">name</code></p></td>
               <td><p>Equals (<code class="literal">eq</code>)</p></td>
              </tr>
              <tr>
               <td><p><code class="literal">description</code></p></td>
               <td><p>Equals (<code class="literal">eq</code>)</p></td>
              </tr>
              <tr>
               <td><p><code class="literal">applicationName</code></p></td>
               <td><p>Equals (<code class="literal">eq</code>)</p></td>
              </tr>
              <tr>
               <td><p><code class="literal">createdBy</code></p></td>
               <td><p>Equals (<code class="literal">eq</code>)</p></td>
              </tr>
              <tr>
               <td><p><code class="literal">creationDate</code></p></td>
               <td> <p> Equals (<code class="literal">eq</code>), Greater than or equal to (<code class="literal">ge</code>), Greater than (<code class="literal">gt</code>), Less than or equal to (<code class="literal">le</code>), Less than (<code class="literal">lt</code>) </p> 
                <div class="panel panel-info">
                 <div class="panel-heading">
                  <h3 class="panel-title">Note</h3>
                 </div>
                 <div class="panel-body">
                  <p>The implementation of <code class="literal">eq</code> for this date field does not use regular expression pattern matching.</p>
                 </div>
                </div></td>
              </tr>
              <tr>
               <td><p><code class="literal">lastModifiedBy</code></p></td>
               <td><p>Equals (<code class="literal">eq</code>)</p></td>
              </tr>
              <tr>
               <td><p><code class="literal">lastModifiedDate</code></p></td>
               <td><p> Equals (<code class="literal">eq</code>), Greater than or equal to (<code class="literal">ge</code>), Greater than (<code class="literal">gt</code>), Less than or equal to (<code class="literal">le</code>), Less than (<code class="literal">lt</code>) </p> 
                <div class="panel panel-info">
                 <div class="panel-heading">
                  <h3 class="panel-title">Note</h3>
                 </div>
                 <div class="panel-body">
                  <p>The implementation of <code class="literal">eq</code> for this date field does not use regular expression pattern matching.</p>
                 </div>
                </div></td>
              </tr>
             </tbody>
            </table>
           </div>
          </div>
          <br class="table-break">
         </div>
         <div class="section" id="rest-api-authz-policies-read">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.6.2.&nbsp;Reading a Specific Policy</h5>
            </div>
           </div>
          </div>
          <p> To read an individual policy in a realm, perform an HTTP GET to the <code class="literal">/json{<em class="replaceable">/realm</em>}/policies </code> endpoint, and specify the policy name in the URL. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p>If the realm is not specified in the URL, OpenAM uses the top level realm.</p>
           </div>
          </div>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
https://openam.example.com:8443/openam/json/policies/example
</strong>
<em class="computeroutput">{
    "result": [
        {
        "name": "example",
        "active": true,
        "description": "Example Policy",
        "applicationName": "iPlanetAMWebAgentService",
        "actionValues": {
            "POST": false,
            "GET": true
        },
        "resources": [
            "http://www.example.com:80/*",
            "http://www.example.com:80/*?*"
        ],
        "subject": {
            "type": "Identity",
            "subjectValues": [
                "uid=demo,ou=People,dc=example,dc=com"
            ]
        },
        "resourceTypeUuid": "12345a67-8f0b-123c-45de-6fab78cd01e4",
        "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
        "lastModifiedDate": "2015-05-11T14:48:08.711Z",
        "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
        "creationDate": "2015-05-11T14:48:08.711Z"
        }
    ],
    "resultCount": 1,
    "pagedResultsCookie": null,
    "remainingPagedResults": 0
}</em></pre>
          <p> You can use the query string parameters <code class="literal">_prettyPrint=true</code> to make the output easier to read, and <code class="literal">_fields=<em class="replaceable">field-name</em>[,<em class="replaceable">field-name</em>...]</code> to limit the fields returned in the output. </p>
         </div>
         <div class="section" id="rest-api-authz-policies-create">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.6.3.&nbsp;Creating Policies</h5>
            </div>
           </div>
          </div>
          <p> To create a policy in a realm, perform an HTTP POST to the <code class="literal">/json{<em class="replaceable">/realm</em>}/policies</code> endpoint, with an <code class="literal">_action</code> parameter set to <code class="literal">create</code>. Include a JSON representation of the policy in the POST data. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p>If the realm is not specified in the URL, OpenAM uses the top level realm.</p>
           </div>
          </div>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <p lang="en"> Do not use special characters within resource type, policy, or policy set names (for example, "my+resource+type") when using the console or REST endpoints. Using the special characters listed below causes OpenAM to return a 400 Bad Request error. The special characters are: double quotes (<kbd>"</kbd>), plus sign (<kbd>+</kbd>), comma (<kbd>,</kbd>), less than (<kbd>&lt;</kbd>), equals (<kbd>=</kbd>), greater than (<kbd>&gt;</kbd>), backslash (<kbd>\</kbd>), forward slash (<kbd>/</kbd>), semicolon (<kbd>;</kbd>), and null (<kbd>\u0000</kbd>). </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "iPlanetDirectoryPro: AQIC5..." \
 --header "Content-Type: application/json" \
 --data '{
    "name": "mypolicy",
    "active": true,
    "description": "My Policy.",
    "applicationName": "iPlanetAMWebAgentService",
    "actionValues": {
        "POST": false,
        "GET": true
    },
    "resources": [
        "http://www.example.com:80/*",
        "http://www.example.com:80/*?*"
    ],
    "subject": {
        "type": "Identity",
        "subjectValues": [
            "uid=demo,ou=People,dc=example,dc=com"
        ]
    },
    "resourceTypeUuid": "12345a67-8f0b-123c-45de-6fab78cd01e4"
 }' \
 https://openam.example.com:8443/openam/json/policies?_action=create
      </strong>
<em class="computeroutput">{
    "name": "mypolicy",
    "active": true,
    "description": "My Policy.",
    "applicationName": "iPlanetAMWebAgentService",
    "actionValues": {
        "POST": false,
        "GET": true
    },
    "resources": [
        "http://www.example.com:80/*",
        "http://www.example.com:80/*?*"
    ],
    "subject": {
        "type": "Identity",
        "subjectValues": [
            "uid=demo,ou=People,dc=example,dc=com"
        ]
    },
    "resourceTypeUuid": "12345a67-8f0b-123c-45de-6fab78cd01e4",
    "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedDate": "2015-05-11T14:48:08.711Z",
    "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "creationDate": "2015-05-11T14:48:08.711Z"
}</em></pre>
          <p> You can use the query string parameters <code class="literal">_prettyPrint=true</code> to make the output easier to read, and <code class="literal">_fields=<em class="replaceable">field-name</em>[,<em class="replaceable">field-name</em>...]</code> to limit the fields returned in the output. </p>
         </div>
         <div class="section" id="rest-api-authz-policies-update">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.6.4.&nbsp;Updating Policies</h5>
            </div>
           </div>
          </div>
          <p> To update an individual policy in a realm, perform an HTTP PUT to the <code class="literal">/json{<em class="replaceable">/realm</em>}/policies </code> endpoint, and specify the policy name in the URL. Include a JSON representation of the updated policy in the PUT data. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p>If the realm is not specified in the URL, OpenAM uses the top level realm.</p>
           </div>
          </div>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <p lang="en"> Do not use special characters within resource type, policy, or policy set names (for example, "my+resource+type") when using the console or REST endpoints. Using the special characters listed below causes OpenAM to return a 400 Bad Request error. The special characters are: double quotes (<kbd>"</kbd>), plus sign (<kbd>+</kbd>), comma (<kbd>,</kbd>), less than (<kbd>&lt;</kbd>), equals (<kbd>=</kbd>), greater than (<kbd>&gt;</kbd>), backslash (<kbd>\</kbd>), forward slash (<kbd>/</kbd>), semicolon (<kbd>;</kbd>), and null (<kbd>\u0000</kbd>). </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request PUT \
 --header "iPlanetDirectoryPro: AQIC5w..." \
 --header "Content-Type: application/json" \
 --data '{
    "name": "myupdatedpolicy",
    "active": true,
    "description": "My Updated Policy.",
    "resources": [
        "http://www.example.com:80/*",
        "http://www.example.com:80/*?*"
    ],
    "actionValues": {
        "POST": true,
        "GET": true
    },
    "subject": {
        "type": "Identity",
        "subjectValues": [
            "uid=scarter,ou=People,dc=example,dc=com",
            "uid=bjenson,ou=People,dc=example,dc=com"
        ]
    },
    "resourceTypeUuid": "12345a67-8f0b-123c-45de-6fab78cd01e4"
}' \
 https://openam.example.com:8443/openam/json/policies/mypolicy
</strong>
<em class="computeroutput">{
    "name": "myupdatedpolicy",
    "active": true,
    "description": "My Updated Policy.",
    "applicationName": "iPlanetAMWebAgentService",
    "actionValues": {
        "POST": true,
        "GET": true
    },
    "resources": [
        "http://www.example.com:80/*",
        "http://www.example.com:80/*?*"
    ],
    "subject": {
        "type": "Identity",
        "subjectValues": [
            "uid=bjenson,ou=People,dc=example,dc=com",
            "uid=scarter,ou=People,dc=example,dc=com"
        ]
    },
    "resourceTypeUuid": "12345a67-8f0b-123c-45de-6fab78cd01e4",
    "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedDate": "2015-05-11T17:26:59.116Z",
    "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "creationDate": "2015-05-11T17:25:18.632Z"
}</em></pre>
          <p> You can use the query string parameters <code class="literal">_prettyPrint=true</code> to make the output easier to read, and <code class="literal">_fields=<em class="replaceable">field-name</em>[,<em class="replaceable">field-name</em>...]</code> to limit the fields returned in the output. </p>
         </div>
         <div class="section" id="rest-api-authz-policies-delete">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.6.5.&nbsp;Deleting Policies</h5>
            </div>
           </div>
          </div>
          <p> To delete an individual policy in a realm, perform an HTTP DELETE to the <code class="literal">/json{<em class="replaceable">/realm</em>}/policies </code> endpoint, and specify the policy name in the URL. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p>If the realm is not specified in the URL, OpenAM uses the top level realm.</p>
           </div>
          </div>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
  --header "iPlanetDirectoryPro: AQIC5w..." \
  --request DELETE \
  https://openam.example.com:8443/openam/json/policies/myupdatedpolicy</strong>
<em class="computeroutput">{}</em></pre>
         </div>
         <div class="section" id="rest-api-authz-policies-copy-move-policies">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.6.6.&nbsp;Copying and Moving Policies</h5>
            </div>
           </div>
          </div>
          <p> You can copy or move an individual policy by performing an HTTP POST to the <code class="literal">/json{<em class="replaceable">/realm</em>}/policies/<em class="replaceable">policyName</em></code> endpoint as follows: </p>
          <div class="itemizedlist">
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p> Specify the <code class="literal">_action=copy</code> or <code class="literal">_action=move</code> URL parameter. </p></li>
            <li class="listitem"><p> Specify the realm in which the input policy resides in the URL. If the realm is not specified in the URL, OpenAM copies or moves a policy from the top level realm. </p></li>
            <li class="listitem"><p> Specify the policy to be copied or moved in the URL. </p></li>
            <li class="listitem"><p> Specify the SSO token of an administrative user who has access to perform the operation in the <code class="literal">iPlanetDirectoryPro</code> header. </p></li>
           </ul>
          </div>
          <p> Specify JSON input data as follows: </p>
          <div class="table" id="rest-api-authz-policies-copy-move-policies-json">
           <div class="table-title">
            Table&nbsp;2.5.&nbsp;JSON Input Data for Copying or Moving Individual Policies
           </div>
           <div class="table-contents">
            <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="JSON Input Data for Copying or Moving Individual Policies" border="0">
             <colgroup>
              <col width="33%">
              <col width="22%">
              <col width="45%">
             </colgroup>
             <thead>
              <tr>
               <th>Object</th>
               <th>Property</th>
               <th>Description</th>
              </tr>
             </thead>
             <tbody>
              <tr>
               <td><code class="literal">to</code></td>
               <td><code class="literal">name</code></td>
               <td> <p> The name of the output policy. </p> <p> Required unless you are copying or moving a policy to a different realm and you want the output policy to have the same name as the input policy. </p> </td>
              </tr>
              <tr>
               <td><code class="literal">to</code></td>
               <td><code class="literal">application</code></td>
               <td> <p> The policy set in which to place the output policy. </p> <p> Required when copying or moving a policy to a different policy set. </p> </td>
              </tr>
              <tr>
               <td><code class="literal">to</code></td>
               <td><code class="literal">realm</code></td>
               <td> <p> The realm in which to place the output policy. If not specified, OpenAM copies or moves the policy within the realm identified in the URL. </p> <p> Required when copying or moving a policy to a different realm. </p> </td>
              </tr>
              <tr>
               <td><code class="literal">to</code></td>
               <td><code class="literal">resourceType</code></td>
               <td> <p> The UUID of the output policy's resource type. </p> <p> Required when copying or moving a policy to a different realm. </p> </td>
              </tr>
             </tbody>
            </table>
           </div>
          </div>
          <br class="table-break">
          <p> The follow example copies the policy <code class="literal">myPolicy</code> to <code class="literal">myNewPolicy</code>. The output policy is placed in the <code class="literal">myRealm</code> realm, in the same policy set as the input policy: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
  --header "iPlanetDirectoryPro: AQIC5w..." \
  --header "Content-Type: application/json" \
  --request POST \
  --data '{
      "to": {
          "name": "myNewPolicy"
      }
  }' \
  https://openam.example.com:8443/openam/json/myRealm/policies/myPolicy?_action=copy</strong>
<em class="computeroutput">{
    "name":"myNewPolicy",
    "active":true,
    "description":"",
    "applicationName":"iPlanetAMWebAgentService",
    "actionValues":{},
    "resources":['"*://*:*/*"],
    "subject":{"type":"NONE"},
    "resourceTypeUuid":"d98e59c9-766a-4934-b5de-8a28a9edc158",
    "lastModifiedBy":"id=amadmin,ou=user,dc=example,dc=com",
    "lastModifiedDate":"2015-12-19T15:22:44.861Z",
    "createdBy":"id=amadmin,ou=user,dc=example,dc=com",
    "creationDate":"2015-12-19T15:22:44.861Z"
}</em></pre>
          <p> The following example moves a policy named <code class="literal">myPolicy</code> in the <code class="literal">myRealm</code> realm to <code class="literal">myMovedPolicy</code> in the <code class="literal">myOtherRealm</code> realm. The output policy is placed in the <code class="literal">iPlanetAMWebAgentService</code> policy set, which is the policy set in which the input policy is located. </p>
          <p> The realm <code class="literal">myOtherRealm</code> must be configured as follows for the example to run successfully: </p>
          <div class="itemizedlist">
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p> It must have a resource type that has the same resources as the resource type configured for the <code class="literal">myPolicy</code> policy. </p></li>
            <li class="listitem"><p> It must have a policy set named <code class="literal">iPlanetAMWebAgentService</code>. </p></li>
           </ul>
          </div>
          <p> </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
  --header "iPlanetDirectoryPro: AQIC5w..." \
  --header "Content-Type: application/json" \
  --request POST \
  --data '{
      "to": {
          "name": "myMovedPolicy",
          "realm": "/myOtherRealm",
          "resourceType: "616b3d02-7a8d-4422-b6a7-174f62afd065"
      }
  }' \
  https://openam.example.com:8443/openam/json/myRealm/policies/myPolicy?_action=move</strong>
<em class="computeroutput">{
    "name":"myMovedPolicy",
    "active":true,
    "description":"",
    "actionValues":{},
    "applicationName":"iPlanetAMWebAgentService",
    "resources":["*://*:*/*"],
    "subject":{"type":"NONE"},
    "resourceTypeUuid":"616b3d02-7a8d-4422-b6a7-174f62afd065",
    "lastModifiedBy":"id=amadmin,ou=user,dc=example,dc=com",
    "lastModifiedDate":"2015-12-21T19:32:59.502Z",
    "createdBy":"id=amadmin,ou=user,dc=example,dc=com",
    "creationDate":"2015-12-21T19:32:59.502Z"
 }</em></pre>
          <p> You can also copy and move multiple policies—all the policies in a policy set—in a single operation by performing an HTTP POST to the <code class="literal">/json{<em class="replaceable">/realm</em>}/policies</code> endpoint as follows: </p>
          <div class="itemizedlist">
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p> Specify the <code class="literal">_action=copy</code> or <code class="literal">_action=move</code> URL parameter. </p></li>
            <li class="listitem"><p> Specify the realm in which the input policies reside as part of the URL. If no realm is specified in the URL, OpenAM copies or moves policies within the top level realm. </p></li>
            <li class="listitem"><p> Specify the SSO token of an administrative user who has access to perform the operation in the <code class="literal">iPlanetDirectoryPro</code> header. </p></li>
           </ul>
          </div>
          <p> Specify JSON input data as follows: </p>
          <div class="table" id="rest-api-authz-policies-copy-move-multiple-policies-json">
           <div class="table-title">
            Table&nbsp;2.6.&nbsp;JSON Input Data for Copying or Moving Multiple Policies
           </div>
           <div class="table-contents">
            <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="JSON Input Data for Copying or Moving Multiple Policies" border="0">
             <colgroup>
              <col width="33%">
              <col width="22%">
              <col width="45%">
             </colgroup>
             <thead>
              <tr>
               <th>Object</th>
               <th>Property</th>
               <th>Description</th>
              </tr>
             </thead>
             <tbody>
              <tr>
               <td><code class="literal">from</code></td>
               <td><code class="literal">application</code></td>
               <td> <p> The policy set in which the input policies are located. </p> <p> Required. </p> </td>
              </tr>
              <tr>
               <td><code class="literal">to</code></td>
               <td><code class="literal">application</code></td>
               <td> <p> The policy set in which to store output policies. </p> <p> Required when copying or moving policies to a different policy set. </p> </td>
              </tr>
              <tr>
               <td><code class="literal">to</code></td>
               <td><code class="literal">realm</code></td>
               <td> <p> The realm in which to store output policies. </p> <p> Required when copying or moving policies to a different realm. </p> </td>
              </tr>
              <tr>
               <td><code class="literal">to</code></td>
               <td><code class="literal">namePostfix</code></td>
               <td> <p> A value appended to output policy names in order to prevent name clashes. </p> <p> Required. </p> </td>
              </tr>
              <tr>
               <td><code class="literal">resourceTypeMapping</code></td>
               <td>Varies; see Description</td>
               <td> <p> One or more resource types mappings, where the left side of the mapping specifies the UUID of a resource type used by the input policies and the right side of the mapping specifies the UUID of a resource type used by the output policies. The two resource types should have the same resource patterns. </p> <p> Required when copying or moving policies to a different realm. </p> </td>
              </tr>
             </tbody>
            </table>
           </div>
          </div>
          <br class="table-break">
          <p> The following example copies all the policies in the <code class="literal">iPlanetAMWebAgentService</code> policy set in the <code class="literal">myRealm</code> realm to the <code class="literal">iPlanetAMWebAgentService</code> policy set in the <code class="literal">myOtherRealm</code> realm, appending the string <code class="literal">-copy</code> to the output policy names. </p>
          <p> The realm <code class="literal">myOtherRealm</code> must be configured as follows for the example to run successfully: </p>
          <div class="itemizedlist">
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p> It must have a resource type that maps to the <code class="literal">ccb50c1a-206d-4946-9106-4164e8f2b35b</code> resource type. The two resource types should have the same resource patterns. </p></li>
            <li class="listitem"><p> It must have a policy set named <code class="literal">iPlanetAMWebAgentService</code>. </p></li>
           </ul>
          </div>
          <p> </p>
          <p> The JSON output shows that a single policy is copied. The policy <code class="literal">myNewPolicy</code> is copied to realm <code class="literal">myOtherRealm</code>. The copied policy receives the name <code class="literal">myOtherRealm-copy</code>: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
  --header "iPlanetDirectoryPro: AQIC5w..." \
  --header "Content-Type: application/json" \
  --request POST \
  --data '{
      "from": {
          "application": "iPlanetAMWebAgentService"
      },
      "to": {
          "realm": "/myOtherRealm",
          "namePostfix": "-copy"
      },
      "resourceTypeMapping": {
          "ccb50c1a-206d-4946-9106-4164e8f2b35b": "616b3d02-7a8d-4422-b6a7-174f62afd065"
      }

  }' \
https://openam.example.com:8443/openam/json/myRealm/policies?_action=copy</strong>
<em class="computeroutput">{
    "name":"myNewPolicy-copy",
    "active":true,
    "description":"",
    "actionValues":{},
    "applicationName":"iPlanetAMWebAgentService",
    "resources":["*://*:*/*"],"subject":{"type":"NONE"},
    "resourceTypeUuid":"616b3d02-7a8d-4422-b6a7-174f62afd065",
    "lastModifiedBy":"id=amadmin,ou=user,dc=example,dc=com",
    "lastModifiedDate":"2015-12-21T20:01:42.410Z",
    "createdBy":"id=amadmin,ou=user,dc=example,dc=com",
    "creationDate":"2015-12-21T20:01:42.410Z"
}</em></pre>
         </div>
        </div>
        <div class="section" id="rest-api-manage-xacml">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.2.7.&nbsp;Importing and Exporting XACML 3.0</h4>
           </div>
          </div>
         </div>
         <p> OpenAM supports the ability to export policies to eXtensible Access Control Markup Language (XACML) 3.0-based formatted policy sets through its <code class="literal">/xacml/policies</code> REST endpoint. You can also import XACML 3.0 policy sets back into OpenAM by using the same endpoint. The endpoint's functionally is identical to that of the <span class="command"><strong>ssoadm create-xacml</strong></span> and <span class="command"><strong>ssoadm list-xacml</strong></span> commands. For more information, see <a href="../admin-guide/index.html#script-policy" class="olink">Section&nbsp;3.3.5, "Importing and Exporting Policies"</a> in the <em>Administration Guide</em> </p>
         <div class="panel panel-info">
          <div class="panel-heading">
           <h3 class="panel-title">Note</h3>
          </div>
          <div class="panel-body">
           <p> OpenAM can only import XACML 3.0 policy sets that were either created by an OpenAM instance, or that have had minor manual modifications, due to the reuse of some XACML 3.0 parameters for non-standard information. </p>
          </div>
         </div>
         <p> When exporting OpenAM policies to XACML 3.0 policy sets, OpenAM maps its policies to XACML 3.0 policy elements. The mappings are as follows: </p>
         <div class="table" id="xacml-mappings">
          <div class="table-title">
           Table&nbsp;2.7.&nbsp;OpenAM Policies to XACML Mappings
          </div>
          <div class="table-contents">
           <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="OpenAM Policies to XACML Mappings" border="0">
            <colgroup>
             <col width="50%">
             <col width="50%">
            </colgroup>
            <thead>
             <tr>
              <th>OpenAM Policy</th>
              <th>XACML Policy</th>
             </tr>
            </thead>
            <tbody>
             <tr>
              <td>Policy Name</td>
              <td>Policy ID</td>
             </tr>
             <tr>
              <td>Description</td>
              <td>Description</td>
             </tr>
             <tr>
              <td>Current Time (yyyy.MM.dd.HH.mm.ss.SSS)</td>
              <td>Version</td>
             </tr>
             <tr>
              <td>xacml rule target</td>
              <td>entitlement excluded resource names</td>
             </tr>
             <tr>
              <td>Rule Deny Overrides</td>
              <td>Rule Combining Algorithm ID</td>
             </tr>
             <tr>
              <td> <p>Any of: </p>
               <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; ">
                 <li class="listitem"><p>Entitlement Subject</p></li>
                 <li class="listitem"><p>Resource Names</p></li>
                 <li class="listitem"><p>Policy Set Names</p></li>
                 <li class="listitem"><p>Action Values</p></li>
                </ul>
               </div><p> </p> </td>
              <td>Target</td>
             </tr>
             <tr>
              <td> <p>Any of: </p>
               <div class="itemizedlist">
                <ul class="itemizedlist" style="list-style-type: disc; ">
                 <li class="listitem"><p>Policy Set Name</p></li>
                 <li class="listitem"><p>Entitlement Name</p></li>
                 <li class="listitem"><p>Privilege Created By</p></li>
                 <li class="listitem"><p>Privilege Modified By</p></li>
                 <li class="listitem"><p>Privilege Creation Date</p></li>
                 <li class="listitem"><p>Privilege Last Modification Date</p></li>
                </ul>
               </div><p> </p> </td>
              <td>Variable Definitions</td>
             </tr>
             <tr>
              <td> Single Level Permit/Deny Actions converted to Policy Rules </td>
              <td>Rules</td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
         <br class="table-break">
         <div class="panel panel-info">
          <div class="panel-heading">
           <h3 class="panel-title">Note</h3>
          </div>
          <div class="panel-body">
           <p> XACML obligation is not supported. Also, only one XACML match is defined for each privilege action, and only one XACML rule for each privilege action value. </p>
          </div>
         </div>
         <div class="section" id="xacml-export">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.7.1.&nbsp;Exporting from OpenAM to XACML</h5>
            </div>
           </div>
          </div>
          <p> OpenAM supports exporting policies into XACML 3.0 format. OpenAM only exports a policy set that contains policy definitions. No other types can be included in the policy set, such as sub-policy sets or rules. The policy set mapping is as follows: </p>
          <div class="table" id="xacml-export-mappings">
           <div class="table-title">
            Table&nbsp;2.8.&nbsp;Policy Set Mappings
           </div>
           <div class="table-contents">
            <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Policy Set Mappings" border="0">
             <colgroup>
              <col width="33%">
              <col width="67%">
             </colgroup>
             <thead>
              <tr>
               <th>OpenAM</th>
               <th>XACML</th>
              </tr>
             </thead>
             <tbody>
              <tr>
               <td>Realm:&lt;timestamp&gt;(yyyy.MM.dd.HH.mm.ss.SSS)</td>
               <td>PolicySet ID</td>
              </tr>
              <tr>
               <td>Current Time (yyyy.MM.dd.HH.mm.ss.SSS)</td>
               <td>Version</td>
              </tr>
              <tr>
               <td>Deny Overrides</td>
               <td>Policy Combining Algorithm ID</td>
              </tr>
              <tr>
               <td>No targets defined</td>
               <td>Target</td>
              </tr>
             </tbody>
            </table>
           </div>
          </div>
          <br class="table-break">
          <p> The export service is accessible at the <code class="literal">/xacml/policies</code> endpoint using a HTTP GET request at the following endpoint for the root realm or a specific realm: </p>
          <pre class="codelisting prettyprint nohighlight">
http://openam.example.com:8080/openam/xacml/policies
http://openam.example.com:8080/openam/xacml/{realm}/policies

  where {realm} is the name of a specific realm
   </pre>
          <p> You can filter your XACML exports using query search filters. Note the following points about the search filters: </p>
          <div class="itemizedlist">
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p><span class="bold"><strong>LDAP-based Searches</strong></span>. The search filters follow the standard guidelines for LDAP searches as they are applied to the entitlements index in the LDAP configuration backend, located at: <code class="literal">ou=default,ou=OrganizationalConfig,ou=1.0,ou=sunEntitlementIndexes, ou=services,dc=openam,dc=forgerock,dc=org</code>. </p></li>
            <li class="listitem"><p> <span class="bold"><strong>Search Filter Format</strong></span>. You can specify a single search filter or multiple filters in the HTTP URL parameters. The format for the search filter is as follows: </p><pre class="codelisting prettyprint nohighlight">
[attribute name][operator][attribute value]
    </pre><p> If you specify multiple search filters, they are logically ANDed: the search results meet the criteria specified in all the search filters. </p>
             <div class="table" id="export-search-filter-format">
              <div class="table-title">
               Table&nbsp;2.9.&nbsp;XACML Export Search Filter Format
              </div>
              <div class="table-contents">
               <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="XACML Export Search Filter Format" border="0">
                <colgroup>
                 <col width="33%">
                 <col width="67%">
                </colgroup>
                <thead>
                 <tr>
                  <th>Element</th>
                  <th>Description</th>
                 </tr>
                </thead>
                <tbody>
                 <tr>
                  <td>Attribute Name</td>
                  <td> <p> The name of the attribute to be searched for. The only permissible values are: <code class="literal">application</code> (keyword for policy set), <code class="literal">createdby</code>, <code class="literal">lastmodifiedby</code>, <code class="literal">creationdate</code>, <code class="literal">lastmodifieddate</code>, <code class="literal">name</code>, <code class="literal">description</code>. </p> </td>
                 </tr>
                 <tr>
                  <td>Operator</td>
                  <td> <p>The type of comparison operation to perform.</p> 
                   <div class="itemizedlist">
                    <ul class="itemizedlist" style="list-style-type: circle; ">
                     <li class="listitem"><p>= Equals (text)</p></li>
                     <li class="listitem"><p>&lt; Less Than or Equal To (numerical)</p></li>
                     <li class="listitem"><p>&gt; Greater Than or Equal To (numerical)</p></li>
                    </ul>
                   </div> </td>
                 </tr>
                 <tr>
                  <td>Attribute Value</td>
                  <td> <p> The matching value. Asterisk wildcards are supported. </p> </td>
                 </tr>
                </tbody>
               </table>
              </div>
             </div><br class="table-break"></li>
           </ul>
          </div>
          <div class="procedure" id="export-policies">
           <div class="procedure-inner">
            <div class="procedure-title">
             Procedure&nbsp;2.1.&nbsp;To Export Policies
            </div>
            <ul class="procedure">
             <li class="step"><p> Use the <code class="literal">/xacml/policies</code> endpoint to export the OpenAM entitlement policies into XACML 3.0 format. The following curl command exports the policies and returns the XACML response (truncated for display purposes). </p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
  --request GET \
  --header "iPlanetDirectoryPro: AQIC5..." \
  --header "Content-Type: application/json" \
  http://openam.example.com:8080/openam/xacml/policies
  </strong>
  <em class="computeroutput">
&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;PolicySet xmlns="urn:oasis:names:tc:xacml:3.0:core:schema:wd-17"
 PolicyCombiningAlgId="urn:oasis:names:tc:xacml:3.0:rule-combining-algorithm:deny-overrides"
 Version="2014.10.08.21.59.39.231" PolicySetId="/:2014.10.08.21.59.39.231"&gt;
 &lt;Target/&gt;
 &lt;Policy RuleCombiningAlgId="urn:oasis:names:tc:xacml:3.0:rule-combining-algorithm:deny-overrides"
  Version="2014.10.08.18.01.03.626"
  PolicyId="Rockshop_Checkout_https://forgerock-rockshop.openrock.org:443/wp-login.php*?*"&gt;
  ...</em>
    </pre></li>
            </ul>
           </div>
          </div>
          <div class="procedure" id="export-policies-search-filter">
           <div class="procedure-inner">
            <div class="procedure-title">
             Procedure&nbsp;2.2.&nbsp;To Export Policies with Search Filters
            </div>
            <ol class="procedure" type="1">
             <li class="step"><p> Use the <code class="literal">/xacml/policies</code> endpoint to export the policies into XACML 3.0 format with a search filter. This command only exports policies that were created by "amadmin". </p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
  --request GET \
  --header "iPlanetDirectoryPro: AQIC5..." \
  --header "Content-Type: application/json" \
  http://openam.example.com:8080/openam/xacml/policies?filter=createdby=amadmin
  </strong>
   </pre></li>
             <li class="step"><p> You can also specify more than one search filter by logically ANDing the filters as follows: </p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
  --request GET \
  --header "iPlanetDirectoryPro: AQIC5..." \
  --header "Content-Type: application/json" \
  http://openam.example.com:8080/openam/xacml/policies?filter=createdby=amadmin&amp;
  filter=creationdate=135563832</strong>
    </pre></li>
            </ol>
           </div>
          </div>
         </div>
         <div class="section" id="xacml-import">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.7.2.&nbsp;Importing from XACML to OpenAM</h5>
            </div>
           </div>
          </div>
          <p> OpenAM supports the import of XACML 3.0-based policy sets into OpenAM policies using the REST <code class="literal">/xacml/policies</code> endpoint. To test an import, OpenAM provides a dry-run feature that runs an import without saving the changes to the database. The dry-run feature provides a summary of the import so that you can troubleshoot any potential mismatches prior to the actual import. </p>
          <p> You can import a XACML policy using an HTTP POST request for the root realm or a specific realm at the following endpoints: </p>
          <pre class="codelisting prettyprint nohighlight">
http://openam.example.com:8080/openam/xacml/policies
http://openam.example.com:8080/openam/xacml/{realm}/policies

where {realm} is the name of a specific realm
   </pre>
          <div class="procedure" id="procedure-xacml-import">
           <div class="procedure-inner">
            <div class="procedure-title">
             Procedure&nbsp;2.3.&nbsp;To Import a XACML 3.0 Policy
            </div>
            <ol class="procedure" type="1">
             <li class="step"><p>You can do a dry run using the <code class="literal">dryrun=true</code> query to test the import. The dry-run option outputs in JSON format and displays the status of each import policy, where "U" indicates "Updated"; "A" for "Added". The dry-run does not actually update to the database. When you are ready for an actual import, you need to re-run the command without the <code class="literal">dryrun=true</code> query. </p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
  --request POST \
  --header "iPlanetDirectoryPro: AQIC5..." \
  --header "Content-Type: application/xml" \
  --data @xacml-policy.xml \
  http://openam.example.com:8080/openam/xacml/policies?dryrun=true</strong>
<em class="computeroutput">[
 {
   "status":"A",
   "name":"aNewPolicy"
 },
 {
   "status":"U",
   "name":"anExistingPolicy"
 },
 {
   "status":"U",
   "name":"anotherExistingPolicy"
 }
]</em>
     </pre></li>
             <li class="step"><p> Use the <code class="literal">/xacml/policies</code> endpoint to import a XACML policy: </p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
  --request POST \
  --header "iPlanetDirectoryPro: AQIC5..." \
  --header "Content-Type: application/xml" \
  --data @xacml-policy.xml \
  http://openam.example.com:8080/openam/xacml/policies</strong>
     </pre></li>
            </ol>
           </div>
          </div>
          <div class="panel panel-success">
           <div class="panel-heading">
            <h3 class="panel-title">Tip</h3>
           </div>
           <div class="panel-body">
            <p>You can import a XACML policy into a realm as follows:</p>
            <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
  --request POST \
  --header "iPlanetDirectoryPro: AQIC5..." \
  --header "Content-Type: application/xml" \
  --data @xacml-policy.xml \
  http://openam.example.com:8080/openam/xacml/{realm}/policies</strong>
     </pre>
           </div>
          </div>
         </div>
        </div>
        <div class="section" id="rest-api-authz-condition-types">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.2.8.&nbsp;Managing Environment Condition Types</h4>
           </div>
          </div>
         </div>
         <p> Environment condition types describe the JSON representation of environment conditions that you can use in policy definitions. </p>
         <div class="itemizedlist">
          <p>OpenAM provides the <code class="literal">conditiontypes</code> REST endpoint for the following:</p>
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-condition-types-query" title="2.1.2.8.1.&nbsp;Querying Environment Condition Types">Section&nbsp;2.1.2.8.1, "Querying Environment Condition Types"</a></p></li>
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-condition-types-read" title="2.1.2.8.2.&nbsp;Reading a Specific Environment Condition Type">Section&nbsp;2.1.2.8.2, "Reading a Specific Environment Condition Type"</a></p></li>
          </ul>
         </div>
         <p> Environment condition types are server-wide, and do not differ by realm. Hence the URI for the condition types API does not contain a realm component, but is <code class="literal">/json/conditiontypes</code>. </p>
         <p> Environment condition types are represented in JSON and take the following form. Environment condition types are built from standard JSON objects and values (strings, numbers, objects, arrays, <code class="literal">true</code>, <code class="literal">false</code>, and <code class="literal">null</code>). </p>
         <pre class="codelisting prettyprint nohighlight">{
    "title": "IPv4",
    "logical": false,
    "config": {
        "type": "object",
        "properties": {
            "startIp": {
                "type": "string"
            },
            "endIp": {
                "type": "string"
            },
            "dnsName": {
                "type": "array",
                "items": {
                    "type": "string"
                }
            }
        }
    }
}</pre>
         <p> Notice that the environment condition type has a title, a "logical" field that indicates whether the type is a logical operator or takes a predicate, and a configuration specification. The configuration specification in this case indicates that an IPv4 environment condition has two properties, "startIp" and "endIp", that each take a single string value, and a third property, "dnsName," that takes an array of string values. In other words, a concrete IP environment condition specification without a DNS name constraint could be represented in a policy definition as in the following example: </p>
         <pre class="codelisting prettyprint javascript">{
   "type": "IPv4",
   "startIp": "127.0.0.1",
   "endIp": "127.0.0.255"
}</pre>
         <p> The configuration is what differs the most across environment condition types. The NOT condition, for example, takes a single condition object as the body of its configuration. </p>
         <pre class="codelisting prettyprint nohighlight">{
  "title" : "NOT",
  "logical" : true,
  "config" : {
    "type" : "object",
    "properties" : {
      "condition" : {
        "type" : "object",
        "properties" : {
        }
      }
    }
  }
}</pre>
         <p> The concrete NOT condition therefore takes the following form. </p>
         <pre class="codelisting prettyprint javascript">{
    "type": "NOT",
    "condition": {
        ...
    }
}</pre>
         <p> The OR condition takes an array of conditions. </p>
         <pre class="codelisting prettyprint nohighlight">{
  "title" : "OR",
  "logical" : true,
  "config" : {
    "type" : "object",
    "properties" : {
      "conditions" : {
        "type" : "array",
        "items" : {
          "type" : "any"
        }
      }
    }
  }
}</pre>
         <p> A corresponding concrete OR condition thus takes the following form. </p>
         <pre class="codelisting prettyprint javascript">{
    "type": "OR",
    "conditions": [
        {
            ...
        },
        {
            ...
        },
        ...
    ]
}</pre>
         <div class="section" id="rest-api-authz-condition-types-query">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.8.1.&nbsp;Querying Environment Condition Types</h5>
            </div>
           </div>
          </div>
          <p> To list all environment condition types, perform an HTTP GET to the <code class="literal">/json/conditiontypes</code> endpoint, with a <code class="literal">_queryFilter</code> parameter set to <code class="literal">true</code>. </p>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/conditiontypes?_queryFilter=true</strong>
<em class="computeroutput">{
    "result" : [
        {
            "title": "IPv4",
            "logical": false,
            "config": {
                "type": "object",
                "properties": {
                    "startIp": {
                        "type": "string"
                    },
                    "endIp": {
                        "type": "string"
                    },
                    "dnsName": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        {
            "title": "NOT",
            "logical": true,
            "config": {
                "type": "object",
                "properties": {
                    "condition": {
                        "type": "object",
                        "properties": { }
                    }
                }
            }
        },
        {...},
        {...},
        {...}
    ],
    "resultCount" : 18,
    "pagedResultsCookie" : null,
    "remainingPagedResults" : 0
}</em></pre>
          <p> Additional query strings can be specified to alter the returned results. For more information, see <a class="xref" href="#rest-api-filter-sort-page" title="2.1.1.6.&nbsp;Filtering, Sorting, and Paging Results">Section&nbsp;2.1.1.6, "Filtering, Sorting, and Paging Results"</a>. </p>
         </div>
         <div class="section" id="rest-api-authz-condition-types-read">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.8.2.&nbsp;Reading a Specific Environment Condition Type</h5>
            </div>
           </div>
          </div>
          <p> To read an individual environment condition type, perform an HTTP GET to the <code class="literal">/json/conditiontypes</code> endpoint, and specify the environment condition type name in the URL. </p>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/conditiontypes/IPv4</strong>
<em class="computeroutput">{
  "title" : "IPv4",
  "logical" : false,
  "config" : {
    "type" : "object",
    "properties" : {
      "startIp" : {
        "type" : "string"
      },
      "endIp" : {
        "type" : "string"
      },
      "dnsName" : {
        "type" : "array",
        "items" : {
          "type" : "string"
        }
      }
    }
  }
}</em></pre>
         </div>
        </div>
        <div class="section" id="rest-api-authz-subject-types">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.2.9.&nbsp;Managing Subject Condition Types</h4>
           </div>
          </div>
         </div>
         <p> Subject condition types describe the JSON representation of subject conditions that you can use in policy definitions. </p>
         <div class="itemizedlist">
          <p>OpenAM provides the <code class="literal">subjecttypes</code> REST endpoint for the following:</p>
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-subject-types-query" title="2.1.2.9.1.&nbsp;Querying Subject Condition Types">Section&nbsp;2.1.2.9.1, "Querying Subject Condition Types"</a></p></li>
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-subject-types-read" title="2.1.2.9.2.&nbsp;Reading a Specific Subject Condition Type">Section&nbsp;2.1.2.9.2, "Reading a Specific Subject Condition Type"</a></p></li>
          </ul>
         </div>
         <p> Environment condition types are server-wide, and do not differ by realm. Hence the URI for the condition types API does not contain a realm component, but is <code class="literal">/json/subjecttypes</code>. </p>
         <p> Subject condition types are represented in JSON and take the following form. Subject condition types are built from standard JSON objects and values (strings, numbers, objects, arrays, <code class="literal">true</code>, <code class="literal">false</code>, and <code class="literal">null</code>). </p>
         <pre class="codelisting prettyprint nohighlight">{
    "title" : "Identity",
    "logical" : false,
    "config" : {
        "type" : "object",
        "properties" : {
            "subjectValues" : {
                "type" : "array",
                "items" : {
                    "type" : "string"
                }
            }
        }
    }
}</pre>
         <p> Notice that the subject type has a title, a "logical" field that indicates whether the type is a logical operator or takes a predicate, and a configuration specification. The configuration specification in this case indicates that an Identity subject condition has one property, "subjectValues", which takes an array of string values. In other words, a concrete Identity subject condition specification is represented in a policy definition as in the following example: </p>
         <pre class="codelisting prettyprint nohighlight">{
   "type": "Identity",
   "subjectValues": [
       "uid=scarter,ou=People,dc=example,dc=com"
   ]
}</pre>
         <p> The configuration is what differs the most across subject condition types. The AND condition, for example, takes an array of subject condition objects as the body of its configuration. </p>
         <pre class="codelisting prettyprint nohighlight">{
    "title" : "AND",
    "logical" : true,
    "config" : {
        "type" : "object",
        "properties" : {
            "subjects" : {
                "type" : "array",
                "items" : {
                    "type" : "any"
                }
            }
        }
    }
}</pre>
         <p> The concrete AND subject condition therefore takes the following form. </p>
         <pre class="codelisting prettyprint javascript">{
    "type": "AND",
    "subject": [
      {...},
      {...},
      {...},
      {...}
    ]
}</pre>
         <div class="section" id="rest-api-authz-subject-types-query">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.9.1.&nbsp;Querying Subject Condition Types</h5>
            </div>
           </div>
          </div>
          <p> To list all environment condition types, perform an HTTP GET to the <code class="literal">/json/subjecttypes</code> endpoint, with a <code class="literal">_queryFilter</code> parameter set to <code class="literal">true</code>. </p>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
  --header "iPlanetDirectoryPro: AQIC5..." \
  https://openam.example.com:8443/openam/json/subjecttypes?_queryFilter=true</strong>
<em class="computeroutput">{
    "result" : [
        {
            "title": "JwtClaim",
            "logical": false,
            "config": {
                "type": "object",
                "properties": {
                    "claimName": {
                        "type": "string"
                    },
                    "claimValue": {
                        "type": "string"
                    }
                }
            }
        },
        {
            "title": "NOT",
            "logical": true,
            "config": {
                "type": "object",
                "properties": {
                    "subject": {
                        "type": "object",
                        "properties": { }
                    }
                }
            }
        },
        {...},
        {...},
        {...}
    ],
    "resultCount" : 5,
    "pagedResultsCookie" : null,
    "remainingPagedResults" : 0
}</em>
   </pre>
          <p> Additional query strings can be specified to alter the returned results. For more information, see <a class="xref" href="#rest-api-filter-sort-page" title="2.1.1.6.&nbsp;Filtering, Sorting, and Paging Results">Section&nbsp;2.1.1.6, "Filtering, Sorting, and Paging Results"</a>. </p>
         </div>
         <div class="section" id="rest-api-authz-subject-types-read">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.9.2.&nbsp;Reading a Specific Subject Condition Type</h5>
            </div>
           </div>
          </div>
          <p> To read an individual subject condition type, perform an HTTP GET to the <code class="literal">/json/subjecttypes</code> endpoint, and specify the subject condition type name in the URL. </p>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/subjecttypes/Identity</strong>
<em class="computeroutput">{
    "title" : "Identity",
    "logical" : false,
    "config" : {
        "type" : "object",
        "properties" : {
            "subjectValues" : {
                "type" : "array",
                "items" : {
                    "type" : "string"
                }
            }
        }
    }
}</em></pre>
         </div>
        </div>
        <div class="section" id="rest-api-authz-subject-attributes">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.2.10.&nbsp;Managing Subject Attributes</h4>
           </div>
          </div>
         </div>
         <p> When you define a policy subject condition, the condition can depend on values of subject attributes stored in a user's profile. The list of possible subject attributes that you can use depends on the LDAP User Attributes configured for the Identity data store where OpenAM looks up the user's profile. </p>
         <div class="itemizedlist">
          <p>OpenAM provides the <code class="literal">subjectattributes</code> REST endpoint for the following:</p>
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-subject-attributes-query" title="2.1.2.10.1.&nbsp;Querying Subject Attributes">Section&nbsp;2.1.2.10.1, "Querying Subject Attributes"</a></p></li>
          </ul>
         </div>
         <p> Subject attributes derive from the list of LDAP user attributes configured for the Identity data store. For more information, see <a href="../admin-guide/index.html#config-data-store" class="olink">Section&nbsp;4.3, "Configuring Data Stores"</a> in the <em>Administration Guide</em>. </p>
         <div class="section" id="rest-api-authz-subject-attributes-query">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.10.1.&nbsp;Querying Subject Attributes</h5>
            </div>
           </div>
          </div>
          <p> To list all subject attributes, perform an HTTP GET to the <code class="literal">/json/subjectattributes</code> endpoint, with a <code class="literal">_queryFilter</code> parameter set to <code class="literal">true</code>. </p>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
https://openam.example.com:8443/openam/json/subjectattributes/?_queryFilter=true</strong>
<em class="computeroutput">
{
    "result" : [
        "sunIdentityServerPPInformalName",
        "sunIdentityServerPPFacadeGreetSound",
        "uid",
        "manager",
        "sunIdentityServerPPCommonNameMN",
        "sunIdentityServerPPLegalIdentityGender",
        "preferredLocale",
        "...",
        "...",
        "..."
    ],
    "resultCount": 87,
    "pagedResultsCookie": null,
    "remainingPagedResults": 0
}</em></pre>
          <p> Note that no pagination cookie is set and the subject attribute names are all returned as part of the "result" array. </p>
         </div>
        </div>
        <div class="section" id="rest-api-authz-decision-combiners">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.2.11.&nbsp;Managing Decision Combiners</h4>
           </div>
          </div>
         </div>
         <p> Decision combiners describe how to resolve policy decisions when multiple policies apply. </p>
         <div class="itemizedlist">
          <p>OpenAM provides the <code class="literal">decisioncombiners</code> REST endpoint for the following:</p>
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-decision-combiner-query" title="2.1.2.11.1.&nbsp;Querying Decision Combiners">Section&nbsp;2.1.2.11.1, "Querying Decision Combiners"</a></p></li>
           <li class="listitem"><p><a class="xref" href="#rest-api-authz-decision-combiner-read" title="2.1.2.11.2.&nbsp;Reading a Specific Decision Combiner">Section&nbsp;2.1.2.11.2, "Reading a Specific Decision Combiner"</a></p></li>
          </ul>
         </div>
         <p> Decision combiners are server-wide, and do not differ by realm. Hence the URI for the condition types API does not contain a realm component, but is <code class="literal">/json/decisioncombiners</code>. </p>
         <div class="section" id="rest-api-authz-decision-combiner-query">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.11.1.&nbsp;Querying Decision Combiners</h5>
            </div>
           </div>
          </div>
          <p> To list all decision combiners, perform an HTTP GET to the <code class="literal">/json/decisioncombiners</code> endpoint, with a <code class="literal">_queryFilter</code> parameter set to <code class="literal">true</code>. </p>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/decisioncombiners?_queryFilter=true</strong>
<em class="computeroutput">{
    "result": [
        {
            "title": "DenyOverride"
        }
    ],
    "resultCount": 1,
    "pagedResultsCookie": null,
    "remainingPagedResults": 0
}</em></pre>
          <p> Additional query strings can be specified to alter the returned results. For more information, see <a class="xref" href="#rest-api-filter-sort-page" title="2.1.1.6.&nbsp;Filtering, Sorting, and Paging Results">Section&nbsp;2.1.1.6, "Filtering, Sorting, and Paging Results"</a>. </p>
         </div>
         <div class="section" id="rest-api-authz-decision-combiner-read">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.2.11.2.&nbsp;Reading a Specific Decision Combiner</h5>
            </div>
           </div>
          </div>
          <p> To view an individual decision combiner, perform an HTTP GET on its resource. </p>
          <p> To read an individual decision combiner, perform an HTTP GET to the <code class="literal">/json/decisioncombiners</code> endpoint, and specify the decision combiner name in the URL. </p>
          <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation. </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/decisioncombiners/DenyOverride</strong>
<em class="computeroutput">{
  "title" : "DenyOverride"
}</em></pre>
         </div>
        </div>
       </div>
       <div class="section" id="sec-rest-oauth2-oidc">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">2.1.3.&nbsp;RESTful OAuth 2.0, OpenID Connect 1.0 and UMA 1.0 Services</h3>
          </div>
         </div>
        </div>
        <a class="indexterm" name="d14232e6387"></a>
        <p> This section shows how to use the OpenAM RESTful interfaces for OAuth 2.0, OpenID Connect 1.0, and UMA 1.0. </p>
        <p> In this section, long URLs are wrapped to fit the printed page, as some of the output is formatted for easier reading. </p>
        <div class="section" id="rest-api-oauth2">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.3.1.&nbsp;OAuth 2.0</h4>
           </div>
          </div>
         </div>
         <a class="indexterm" name="d14232e6397"></a>
         <div class="itemizedlist">
          <p> OpenAM exposes the following REST endpoints for different OAuth 2.0 purposes: </p>
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p> Endpoints for <a class="link" href="#rest-api-oauth2-client-endpoints" title="2.1.3.1.1.&nbsp;OAuth 2.0 Client and Resource Server Endpoints">OAuth 2.0 clients and resource servers</a>, mostly defined in RFC 6749, <a class="link" href="http://tools.ietf.org/html/rfc6749" target="_blank"><em class="citetitle">The OAuth 2.0 Authorization Framework</em></a>, with additional <code class="literal">tokeninfo</code> and <code class="literal">introspect</code> endpoints useful to resource servers and clients. </p></li>
           <li class="listitem"><p> An endpoint for <a class="link" href="#rest-api-oauth2-resourceset-endpoint" title="2.1.3.1.3.&nbsp;OAuth 2.0 Resource Set Endpoint">reading OAuth 2.0 resource sets</a>. This is specific to OpenAM. </p></li>
           <li class="listitem"><p> An endpoint for <a class="link" href="#rest-api-oauth2-token-admin-endpoint" title="2.1.3.1.4.&nbsp;OAuth 2.0 Token Administration Endpoint">OAuth 2.0 token administration</a>. This is specific to OpenAM.</p></li>
           <li class="listitem"><p>An endpoint for <a class="link" href="#rest-api-oauth2-client-admin-endpoint" title="2.1.3.1.5.&nbsp;OAuth 2.0 Client Administration Endpoint">OAuth 2.0 client administration</a>. This is specific to OpenAM.</p></li>
          </ul>
         </div>
         <p> When accessing the APIs, browser-based REST clients can rely on OpenAM to handle the session as usual. First authenticate with OpenAM. Then perform the operations in the browser session. </p>
         <p> Clients not running in a browser can authenticate as described in <a class="xref" href="#rest-api-auth" title="2.1.1.4.&nbsp;Authentication &amp; Logout">Section&nbsp;2.1.1.4, "Authentication &amp; Logout"</a>, whereby OpenAM returns a <code class="literal">token.id</code> value. Clients pass the <code class="literal">token.id</code> value in a header named after the authentication cookie, by default <code class="literal">iplanetDirectoryPro</code>. </p>
         <div class="section" id="rest-api-oauth2-client-endpoints">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.3.1.1.&nbsp;OAuth 2.0 Client and Resource Server Endpoints</h5>
            </div>
           </div>
          </div>
          <p> OpenAM exposes REST endpoints for making calls to OpenAM acting as an authorization server, as described in <a href="../admin-guide/index.html#chap-oauth2" class="olink">Chapter&nbsp;13, "Managing OAuth 2.0 Authorization"</a> in the <em>Administration Guide</em>. </p>
          <div class="variablelist">
           <p>In addition to the standard authorization and token endpoints described in RFC 6749, OpenAM also exposes a token information endpoint for resource servers to get information about access tokens so they can determine how to respond to requests for protected resources, and an introspection endpoint to retrieve metadata about a token, such as approved scopes and the context in which the token was issued. OpenAM as authorization server exposes the following endpoints for clients and resource servers.</p>
           <dl class="variablelist">
            <dt>
             <span class="term"><code class="literal">/oauth2/authorize</code></span>
            </dt>
            <dd>
             <p>Authorization endpoint defined in RFC 6749, used to obtain an authorization grant from the resource owner.</p>
             <p> The <code class="literal">/oauth2/authorize</code> endpoint is protected by the policy created during OAuth 2.0 authorization server configuration, which grants all authenticated users access. </p>
             <p>Example:</p>
             <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
    https://openam.example.com:8443/openam/oauth2/authorize\
    ?client_id=myClient\
    &amp;response_type=code\
    &amp;scope=profile\
    &amp;redirect_uri=https://www.example.com</strong></pre>
             <p>If creating your own consent page, you can create a POST request to the endpoint with the following additional parameters:</p>
             <div class="variablelist">
              <dl class="variablelist">
               <dt>
                <span class="term"><code class="literal">decision</code></span>
               </dt>
               <dd>
                <p>Whether the resource owner consents to the requested access, or denies consent.</p>
                <p>Valid values are <code class="literal">allow</code> or <code class="literal">deny</code>.</p>
               </dd>
               <dt>
                <span class="term"><code class="literal">save_consent</code></span>
               </dt>
               <dd>
                <p>Updates the resource owner's profile to avoid having to prompt the resource owner to grant authorization when the client issues subsequent authorization requests.</p>
                <p>To save consent, set the <code class="literal">save_consent</code> property to <code class="literal">on</code>. </p>
                <p>You must provide the <span class="emphasis"><em>Saved Consent Attribute Name</em></span> property with a profile attribute in which to store the resource owner's consent decision.</p>
                <p>For more information on setting this property in the OAuth2 Provider service, see <a href="../reference/index.html#oauth2-provider-configuration" class="olink">Section&nbsp;1.4.10, "OAuth2 Provider"</a> in the <em>Reference</em>.</p>
               </dd>
               <dt>
                <span class="term"><code class="literal">csrf</code></span>
               </dt>
               <dd>
                <p>Duplicates the contents of the <code class="literal">iPlanetDirectoryPro</code> cookie, which contains the SSO token of the resource owner giving consent.</p>
                <p>Duplicating the cookie value helps prevent against Cross-Site Request Forgery (CSRF) attacks. </p>
               </dd>
              </dl>
             </div>
             <p>Example:</p>
             <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
 --request POST \
 --header  "Content-Type: application/x-www-form-urlencoded" \
 --Cookie "iPlanetDirectoryPro=AQIC5w...*" \
 --data "redirect_uri=http://www.example.net" \
 --data "scope=profile" \
 --data "response_type=code" \
 --data "client_id=myClient" \
 --data "csrf=AQIC5w...*" \
 --data "decision=allow" \
 --data "save_consent=on" \
 "https://openam.example.com:8443/openam/oauth2/authorize?response_type=code&amp;client_id=myClient"\
 "&amp;realm=/&amp;scope=profile&amp;redirect_uri=http://www.example.net"</strong></pre>
             <p> The <code class="literal">/oauth2/authorize</code> endpoint can take additional parameters. In particular, you must specify the realm if the OpenAM OAuth 2.0 provider is configured for a subrealm rather than the top-level realm. For example, if the OAuth 2.0 provider is configured for the <code class="literal">/customers</code> realm, then use <code class="literal">/oauth2/realms/root/realms/customers/authorize</code>. </p>
             <p> The <code class="literal">/oauth2/authorize</code> endpoint can also take <code class="literal">module</code> and <code class="literal">service</code> parameters. Use either as described in <a href="../admin-guide/index.html#authn-from-browser" class="olink">Section&nbsp;2.7, "Authenticating To OpenAM"</a> in the <em>Administration Guide</em>, where <code class="literal">module</code> specifies the authentication module instance to use or <code class="literal">service</code> specifies the authentication chain to use when authenticating the resource owner. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">/oauth2/access_token</code></span>
            </dt>
            <dd>
             <p>Token endpoint defined in RFC 6749, used to obtain an access token from the authorization server</p>
             <p>Example: <code class="literal">https://openam.example.com:8443/openam/oauth2/access_token</code></p>
             <p> The <code class="literal">/oauth2/access_token</code> endpoint can take an additional parameter, <code class="literal">auth_chain=<em class="replaceable">authentication-chain</em></code>, which allows client to specify the authentication chain to use for Password Grant Type. </p>
             <p> The following example shows how a client can specify the authentication chain, <code class="literal">myAuthChain</code>: </p>
             <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--request POST \
--user "myClientID:password" \
--data "grant_type=password&amp;username=amadmin&amp;password=cangetinam&amp;scope=profile&amp;auth_chain=myAuthChain" \
https://openam.example.com:8443/openam/oauth2/access_token</strong></pre>
             <p> The <code class="literal">/oauth2/access_token</code> endpoint can take additional parameters. In particular, you must specify the realm if the OpenAM OAuth 2.0 provider is configured for a subrealm rather than the top-level realm. </p>
             <p>For example, if the OAuth 2.0 provider is configured for the <code class="literal">/customers</code> realm, then use <code class="literal">/oauth2/realms/root/realms/customers/access_token</code>. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">/oauth2/device</code></span>
            </dt>
            <dd>
             <p>Device flow endpoint as defined by the <a class="link" href="https://datatracker.ietf.org/doc/draft-denniss-oauth-device-flow/" target="_top">Internet-Draft OAuth 2.0 Device Flow</a>, used by a client device to obtain a device code or an access token.</p>
             <p>Example: <code class="literal">https://openam.example.com:8443/openam/oauth2/device/code</code> </p>
             <p>For more information, see <a href="../dev-guide/index.html#rest-api-oauth2-device-flow" class="olink">Section&nbsp;2.1.3.1.2, "Using REST for OAuth 2.0 Device Flow"</a>.</p>
            </dd>
            <dt>
             <span class="term"><code class="literal">/oauth2/token/revoke</code></span>
            </dt>
            <dd>
             <p> When a user logs out of an application, the application revokes any OAuth 2.0 tokens (access and refresh tokens) that are associated with the user. The client can also revoke a token without the need of an <code class="literal">SSOToken</code> by sending a request to the <code class="literal">/oauth2/token/revoke</code> endpoint as follows: </p>
             <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--request POST \
--data "token=d06ab31e-9cdb-403e-855f-bd77652add84" \
--data "client_id=MyClientID" \
--data "client_secret=password" \
https://openam.example.com:8443/openam/oauth2/realms/root/token/revoke</strong></pre>
             <p> </p>
             <p> If you are revoking an access token, then that token will be revoked. If you are revoking a refresh token, then both the refresh token and any other associated access tokens will also be revoked. <span class="emphasis"><em>Associated access tokens</em></span> means that any other tokens that have come out of the same authorization grant will also be revoked. For cases where a client has multiple access tokens for a single user that were obtained via different authorization grants, then the client will have to make multiple calls to the <code class="literal">/oauth2/token/revoke</code> endpoint to invalidate each token. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">/oauth2/tokeninfo</code></span>
            </dt>
            <dd>
             <p>Endpoint <span class="emphasis"><em>not</em></span> defined in RFC 6749, used to validate tokens, and to retrieve information, such as scopes.</p>
             <p> The <code class="literal">/oauth2/tokeninfo</code> endpoint takes an HTTP GET on <code class="literal">/oauth2/tokeninfo?access_token=<em class="replaceable">token-id</em></code>, and returns information about the token. </p>
             <p> Resource servers — or any party having the token ID — can get token information through this endpoint without authenticating. This means any application or user can validate the token without having to be registered with ${am.abbr}. </p>
             <p>Given an access token, a resource server can perform an HTTP GET on <code class="literal">/oauth2/tokeninfo?access_token=<em class="replaceable">token-id</em></code> to retrieve a JSON object indicating <code class="literal">token_type</code>, <code class="literal">expires_in</code>, <code class="literal">scope</code>, and the <code class="literal">access_token</code> ID.</p>
             <p>Example: <code class="literal">https://openam.example.com:8443/openam/oauth2/tokeninfo</code></p>
             <p> The following example shows ${am.abbr} issuing an access token, and then returning token information: </p>
             <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--request POST \
--user "myClientID:password" \
--data "grant_type=password&amp;username=demo&amp;password=changeit&amp;scope=cn%20mail" \
https://openam.example.com:8443/openam/oauth2/realms/root/access_token</strong>
    <em class="computeroutput">{
     "expires_in": 599,
     "token_type": "Bearer",
     "refresh_token": "f6dcf133-f00b-4943-a8d4-ee939fc1bf29",
     "access_token": "f9063e26-3a29-41ec-86de-1d0d68aa85e9"
     }</em>

$ <strong class="userinput">curl https://openam.example.com:8443/openam/oauth2/realms/root/tokeninfo\
  ?access_token=f9063e26-3a29-41ec-86de-1d0d68aa85e9</strong>
    <em class="computeroutput">{
  "mail": "demo@example.com",
  "grant_type":"password",
  "scope": [
     "mail",
     "cn"
  ],
  "cn": "demo",
  "realm": "/",
  "cnf": {
     "jwk": {
        "alg": "RS512",
        "e": "AQAB",
        "n": "k7qLlj...G2oucQ",
        "kty": "RSA",
        "use": "sig",
        "kid": "myJWK"
     }
  }
  "token_type": "Bearer",
  "expires_in": 577,
  "client_id": "MyClientID",
  "access_token": "f9063e26-3a29-41ec-86de-1d0d68aa85e9"
}</em></pre>
             <div class="panel panel-info">
              <div class="panel-heading">
               <h3 class="panel-title">Note</h3>
              </div>
              <div class="panel-body">
               <p> Running a GET method to the <code class="literal">/oauth2/tokeninfo</code> endpoint as shown in the previous example writes the token ID to the access log. To not expose the token ID in the logs, send the OAuth 2.0 access token as part of the authorization bearer header: </p>
               <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--request GET \
--header "Authorization Bearer aec6b050-b0a4-4ece-a86f-bd131decbb9c" \
"https://openam.example.com:8443/openam/oauth2/tokeninfo"</strong></pre>
              </div>
             </div>
             <p> The resource server making decisions about whether the token is valid can thus use the <code class="literal">/oauth2/tokeninfo</code> endpoint to retrieve expiration information about the token. Depending on the scopes implementation, the JSON response about the token can also contain scope information. As described in <a href="../admin-guide/index.html#oauth2-byo-client" class="olink">Section&nbsp;13.1.3, "Using Your Own Client and Resource Server"</a> in the <em>Administration Guide</em>, the default scopes implementation in ${am.abbr} considers scopes to be names of attributes in the resource owner's user profile. Notice that the JSON response contains the values for those attributes from the user's profile, as in the preceding example, with scopes set to <code class="literal">mail</code> and <code class="literal">cn</code>. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">/oauth2/introspect</code></span>
            </dt>
            <dd>
             <p>Endpoint defined in <a class="link" href="http://tools.ietf.org/html/draft-ietf-oauth-introspection-04" target="_top">draft-ietf-oauth-introspection-04</a>, used to retrieve metadata about a token, such as approved scopes and the context in which the token was issued.</p>
             <p>Given an access token, a client can perform an HTTP POST on <code class="literal">/oauth2/introspect?token=<em class="replaceable">access_token</em></code> to retrieve a JSON object indicating the following: </p>
             <div class="variablelist">
              <dl class="variablelist">
               <dt>
                <span class="term"><code class="literal">active</code></span>
               </dt>
               <dd>
                <p>Is the token active.</p>
               </dd>
               <dt>
                <span class="term"><code class="literal">scope</code></span>
               </dt>
               <dd>
                <p>A space-separated list of the scopes associated with the token.</p>
               </dd>
               <dt>
                <span class="term"><code class="literal">client_id</code></span>
               </dt>
               <dd>
                <p>Client identifier of the client that requested the token.</p>
               </dd>
               <dt>
                <span class="term"><code class="literal">user_id</code></span>
               </dt>
               <dd>
                <p>The user who authorized the token.</p>
               </dd>
               <dt>
                <span class="term"><code class="literal">token_type</code></span>
               </dt>
               <dd>
                <p>The type of token.</p>
               </dd>
               <dt>
                <span class="term"><code class="literal">exp</code></span>
               </dt>
               <dd>
                <p>When the token expires, in seconds since January 1 1970 UTC.</p>
               </dd>
               <dt>
                <span class="term"><code class="literal">sub</code></span>
               </dt>
               <dd>
                <p>Subject of the token.</p>
               </dd>
               <dt>
                <span class="term"><code class="literal">iss</code></span>
               </dt>
               <dd>
                <p>Issuer of the token.</p>
               </dd>
              </dl>
             </div>
             <p>The <code class="literal">/oauth2/introspect</code> endpoint requires authentication, and supports basic authorization (a base64-encoded string of <code class="literal"><em class="replaceable">client_id</em>:<em class="replaceable">client_secret</em></code>), <code class="literal"><em class="replaceable">client_id</em></code> and <code class="literal"><em class="replaceable">client_secret</em></code> passed as header values, or a JWT bearer token.</p>
             <p>The following example demonstrates the <code class="literal">/oauth2/introspect</code> endpoint with basic authorization:</p>
             <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
 --request POST \
 --header "Authorization: Basic ZGVtbzpjaGFuZ2VpdA==" \
 https://openam.example.com:8443/openam/oauth2/introspect \
 ?token=f9063e26-3a29-41ec-86de-1d0d68aa85e9</strong>
 <em class="computeroutput">{
  "active": true,
  "scope": "mail cn",
  "client_id": "myOAuth2Client",
  "user_id": "demo",
  "token_type": "Bearer",
  "exp": 1419356238,
  "sub": "https://resources.example.com/",
  "iss": "https://openam.example.com/"
  }</em></pre>
             <div class="panel panel-info">
              <div class="panel-heading">
               <h3 class="panel-title">Note</h3>
              </div>
              <div class="panel-body">
               <p> Running a POST method to the <code class="literal">/oauth2/introspect</code> endpoint as shown in the previous example writes the token ID to the access log. To hide the token ID in the logs, send the OAuth 2.0 access token as part of the POST body: </p>
               <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \</strong>
--request POST \
--header "Authorization Basic ZGVtbzpjaGFuZ2VpdA==" \
--data "token=f9063e26-3a29-41ec-86de-1d0d68aa85e9" \
"https://openam.example.com:8443/openam/oauth2/introspect"</pre>
              </div>
             </div>
            </dd>
           </dl>
          </div>
          <p> The <code class="literal">/oauth2/authorize</code>, and <code class="literal">/oauth2/access_token</code> endpoints function as described in RFC 6749. </p>
          <p> The <code class="literal">/oauth2/authorize</code> endpoint is protected by the policy created during OAuth 2.0 authorization server configuration, which grants all authenticated users access. </p>
          <p> The <code class="literal">/oauth2/tokeninfo</code> endpoint takes an HTTP GET on <code class="literal">/oauth2/tokeninfo?access_token=<em class="replaceable">token-id</em></code>, and returns information about the token. </p>
          <p> Resource servers — or any party having the token ID — can get token information through this endpoint without authenticating. This means any application or user can validate the token without having to be registered with OpenAM. </p>
          <p> The following example shows OpenAM issuing an access token, and then returning token information: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --user "myClientID:password" \
 --data "grant_type=password&amp;username=demo&amp;password=changeit&amp;scope=cn%20mail" \
 https://openam.example.com:8443/openam/oauth2/access_token</strong>
<em class="computeroutput">{
    "expires_in": 599,
    "token_type": "Bearer",
    "refresh_token": "f6dcf133-f00b-4943-a8d4-ee939fc1bf29",
    "access_token": "f9063e26-3a29-41ec-86de-1d0d68aa85e9"
}</em>

$ <strong class="userinput">curl https://openam.example.com:8443/openam/oauth2/tokeninfo\
?access_token=f9063e26-3a29-41ec-86de-1d0d68aa85e9</strong>
<em class="computeroutput">{
    "mail": "demo@example.com",
    "scope": [
        "mail",
        "cn"
    ],
    "cn": "demo",
    "realm": "/",
    "token_type": "Bearer",
    "expires_in": 577,
    "access_token": "f9063e26-3a29-41ec-86de-1d0d68aa85e9"
}</em>
   </pre>
          <p> The resource server making decisions about whether the token is valid can thus use the <code class="literal">/oauth2/tokeninfo</code> endpoint to retrieve expiration information about the token. Depending on the scopes implementation, the JSON response about the token can also contain scope information. As described in <a href="../admin-guide/index.html#oauth2-byo-client" class="olink">Section&nbsp;13.1.3, "Using Your Own Client and Resource Server"</a> in the <em>Administration Guide</em>, the default scopes implementation in OpenAM considers scopes to be names of attributes in the resource owner's user profile. Notice that the JSON response contains the values for those attributes from the user's profile, as in the preceding example, with scopes set to <code class="literal">mail</code> and <code class="literal">cn</code>. </p>
          <p> Both the <code class="literal">/oauth2/authorize</code> and <code class="literal">/oauth2/access_token</code> endpoints can take additional parameters. In particular you must specify the realm using the <code class="literal">realm=<em class="replaceable">realm-name</em></code> parameter if the OpenAM OAuth 2.0 provider is configured for a subrealm rather than / (Top Level Realm). For example, if the OAuth 2.0 provider is configured for the <code class="literal">/customers</code> realm, then use <code class="literal">/oauth2/authorize?realm=/customers</code> and <code class="literal">/oauth2/access_token?realm=/customers</code>. </p>
          <p> The <code class="literal">/oauth2/authorize</code> endpoint can also take <code class="literal">module</code> and <code class="literal">service</code> parameters. Use either as described in <a href="../admin-guide/index.html#authn-from-browser" class="olink">Section&nbsp;2.7, "Authenticating To OpenAM"</a> in the <em>Administration Guide</em>, where <code class="literal">module</code> specifies the authentication module instance to use or <code class="literal">service</code> specifies the authentication chain to use when authenticating the resource owner. </p>
         </div>
         <div class="section" id="rest-api-oauth2-device-flow">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.3.1.2.&nbsp;Using REST for OAuth 2.0 Device Flow</h5>
            </div>
           </div>
          </div>
          <p>If a client device has a limited user interface, it can obtain an OAuth 2.0 device code and ask a user to authorize the client on a more full-featured user agent, such as an Internet browser.</p>
          <p>OpenAM provides the <code class="literal">/oauth2/device/code</code> and <code class="literal">/oauth2/access_token</code> REST endpoints to support the OAuth 2.0 Device Flow.</p>
          <div class="procedure" id="d14232e6979">
           <div class="procedure-inner">
            <div class="procedure-title">
             Procedure&nbsp;2.4.&nbsp;To Use the OAuth 2.0 Device Flow
            </div>
            <ol class="procedure" type="1">
             <li class="step"><p>Ensure that an OAuth 2.0/OpenID Connect client Agent profile is configured in OpenAM, as described in <a href="../admin-guide/index.html#configure-oauth2-client" class="olink">Section&nbsp;5.8, "Configuring OAuth 2.0 and OpenID Connect 1.0 Clients"</a> in the <em>Administration Guide</em>.</p></li>
             <li class="step"><p>Create a POST request to the <code class="literal">/oauth2/device/code</code> endpoint to acquire a device code. The following URL parameters are required:</p>
              <div class="variablelist">
               <dl class="variablelist">
                <dt>
                 <span class="term"><code class="literal">response_type</code></span>
                </dt>
                <dd>
                 <p>Specifies the response type required by the request. Must be set to <code class="literal">token</code>.</p>
                </dd>
                <dt>
                 <span class="term"><code class="literal">scope</code></span>
                </dt>
                <dd>
                 <p>Specifies the list of scopes requested by the client, separated by URL-encoded space characters.</p>
                </dd>
                <dt>
                 <span class="term"><code class="literal">client_id</code></span>
                </dt>
                <dd>
                 <p>Specifies the name of the client agent profile in OpenAM.</p>
                </dd>
               </dl>
              </div><pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--data response_type=token \
--data scope=phone%20email%20profile%20address \
--data client_id=myDeviceAgentProfile \
http://openam.example.com:8080/openam/oauth2/device/code
</strong><em class="computeroutput">{
    "interval": 5,
    "device_code": "7a95a0a4-6f13-42e3-ac3e-d3d159c94c55",
    "verification_url": "http://openam.example.com:8080/openam/oauth2/device/user",
    "user_code": "VAL12e0v",
    "expires_in": 300
}</em></pre><p>On success, OpenAM returns a verification URL that the user should visit, and a user code they must enter at that URL. OpenAM also returns an interval, in seconds, that the client device must wait for in between requests for an access token. </p></li>
             <li class="step"><p>The user should visit the verification URL and enter the user code.</p>
              <div class="figure" id="figure-oauth2-user-code">
               <div class="figure-title">
                Figure&nbsp;2.1.&nbsp;OAuth 2.0 User Code
               </div>
               <div class="figure-contents">
                <div class="mediaobject" align="center">
                 <a class="fancybox" href="shared/images/oauth2-device-user-code.png"><img class="img-responsive center-block" data-toggle="tooltip" src="shared/images/thumb_oauth2-device-user-code.png" align="middle" alt="OAuth 2.0 user code." title="Visit the verification URL to enter the user code."></a>
                </div>
               </div>
              </div><br class="figure-break"></li>
             <li class="step"><p>The user should then authorize the device flow client by allowing the requested scopes: </p>
              <div class="figure" id="figure-oauth2-device-flow-allow">
               <div class="figure-title">
                Figure&nbsp;2.2.&nbsp;OAuth 2.0 Consent Page
               </div>
               <div class="figure-contents">
                <div class="mediaobject" align="center">
                 <a class="fancybox" href="images/oauth2-device-consent.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_oauth2-device-consent.png" align="middle" alt="OAuth 2.0 consent page." title="OpenAM lists the scopes requested by the client
        device, and their values."></a>
                </div>
               </div>
              </div><br class="figure-break"></li>
             <li class="step"><p>On the client device, create a POST request to poll the <code class="literal">/oauth2/access_token</code> endpoint to request an access token. Include the client ID, client secret, and the device code as query parameters in the request. You must also specify a <code class="literal">grant_type</code> of <code class="literal">http://oauth.net/grant_type/device/1.0</code>.</p><p>The client device must wait for the number of seconds previously provided as the value of <code class="literal">interval</code> between polling OpenAM for an access token.</p><pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--data client_id=myDeviceAgentProfile \
--data client_secret=password \
--data grant_type=http://oauth.net/grant_type/device/1.0 \
--data code=7a95a0a4-6f13-42e3-ac3e-d3d159c94c55 \
http://openam.example.com:8080/openam/oauth2/access_token</strong>
<em class="computeroutput">{
    "scope": "phone email address profile",
    "code": "20c1fc0c-3153-4a11-8d1f-d815c1a522b5"
}</em></pre><p>If the user has authorized the client device, an HTTP 200 status code is returned, with an access token that can be used to request resources, and a list of the requested scopes.</p><p>OpenAM adds the client device to the user's profile page in the <span class="emphasis"><em>Authorized Apps</em></span> section. For more information, see <a href="../admin-guide/index.html#oauth2-user-consent" class="olink">Section&nbsp;13.4.3, "User Consent Management"</a> in the <em>Administration Guide</em>.</p><p>If the user has not yet authorized the client device, an HTTP 403 status code is returned, with the following error message:</p><pre class="cmdline prettyprint nohighlight"><em class="computeroutput">{
    "error": "authorization_pending",
    "error_description": "The user has not yet completed authorization"
}</em></pre><p>If the client device is polling faster than the specified interval, an HTTP 400 status code is returned, with the following error message:</p><pre class="cmdline prettyprint nohighlight"><em class="computeroutput">{
    "error": "slow_down",
    "error_description": "The polling interval has not elapsed since the last request"
}</em></pre></li>
            </ol>
           </div>
          </div>
         </div>
         <div class="section" id="rest-api-oauth2-resourceset-endpoint">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.3.1.3.&nbsp;OAuth 2.0 Resource Set Endpoint</h5>
            </div>
           </div>
          </div>
          <p> OpenAM provides a read-only REST endpoint for viewing a resource set registered to a particular user. The endpoint is <code class="literal">/json<em class="replaceable">{/realm}</em>/users/<em class="replaceable">user</em>/oauth2/resourcesets/<em class="replaceable">resource_set_ID</em></code>, so for example <code class="literal">https://openam.example.com:8443/openam/json/myrealm/users/demo/oauth2/resourcesets/43225628-4c5b-4206-b7cc-5164da81decd0</code>. </p>
          <p> To read a resource set, either the resource set owner or an administrator such as <code class="literal">amadmin</code> must have logged in to OpenAM (the authorization server) and have been issued an SSO token. </p>
          <div class="procedure" id="read-user-oauth2-resource-set">
           <div class="procedure-inner">
            <div class="procedure-title">
             Procedure&nbsp;2.5.&nbsp;To Read an OAuth 2.0 Resource Set
            </div>
            <ul class="procedure">
             <li class="step"><p> Create a GET request to the <code class="literal">resourcesets</code> endpoint, including the SSO token in a header based on the configured session cookie name (for example: <code class="literal">iPlanetDirectoryPro</code>), and with the resource set ID in the URL. </p><p> The following example uses an SSO token acquired by the <code class="literal">amadmin</code> user to view a resource set, and related policy, belonging to the <code class="literal">demo</code> user in the top level realm: </p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5wM2LY4Sfcxs...EwNDU2NjE0*" \
https://openam.example.com:8443/openam/json/users/demo\
/oauth2/resourcesets/43225628-4c5b-4206-b7cc-5164da81decd0</strong>
<em class="computeroutput">{
    "scopes": [
         "http://photoz.example.com/dev/scopes/view",
         "http://photoz.example.com/dev/scopes/comment"
    ],
    "_id": "43225628-4c5b-4206-b7cc-5164da81decd0",
    "resourceServer": "UMA-Resource-Server",
    "name": "My Videos",
    "icon_uri": "http://www.example.com/icons/cinema.png",
    "policy": {
        "permissions": [
            {
                "subject": "user.1",
                "scopes": [
                    "http://photoz.example.com/dev/scopes/view"
                ]
            },
            {
                "subject": "user.2",
                "scopes": [
                    "http://photoz.example.com/dev/scopes/comment",
                    "http://photoz.example.com/dev/scopes/view"
                ]
            }
        ]
    },
    "type": "http://www.example.com/rsets/videos"
}</em>
     </pre>
              <div class="panel panel-success">
               <div class="panel-heading">
                <h3 class="panel-title">Tip</h3>
               </div>
               <div class="panel-body">
                <p> You can specify the fields that are returned with the <code class="literal">_fields</code> query string filter. For example <code class="literal">?_fields=scopes, resourceServer, name</code> </p>
               </div>
              </div><p> On success, an HTTP 200 OK status code is returned, with a JSON body representing the resource set. If a policy relating to the resource set exists, a representation of the policy is also returned in the JSON. </p><p> If the specified resource set does not exist, an HTTP 404 Not Found status code is returned, as follows: </p><pre class="cmdline prettyprint nohighlight"><em class="computeroutput">{
    "code": 404,
    "reason": "Not Found",
    "message": "No resource set with id, bad-id-3e28-4c19-8a2b-36fc24c899df0, found."
}</em></pre><p>If the SSO token used is not that of the resource set owner or an administrator, an HTTP 403 Forbidden status code is returned, as follows: </p><pre class="cmdline prettyprint nohighlight"><em class="computeroutput">{
    "code": 403,
    "reason": "Forbidden",
    "message": "User, user.1, not authorized."
}</em></pre><p> </p></li>
            </ul>
           </div>
          </div>
         </div>
         <div class="section" id="rest-api-oauth2-token-admin-endpoint">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.3.1.4.&nbsp;OAuth 2.0 Token Administration Endpoint</h5>
            </div>
           </div>
          </div>
          <p> The OpenAM-specific OAuth 2.0 token administration endpoint lets administrators read, list, and delete OAuth 2.0 tokens. OAuth 2.0 clients can also manage their own tokens. </p>
          <p> OpenAM exposes the token administration endpoint at <code class="literal">/frrest/oauth2/token</code>, such as <code class="literal">https://openam.example.com:8443/openam/frrest/oauth2/token</code>. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p>This endpoint location is likely to change in the future.</p>
           </div>
          </div>
          <p> To get a token, perform an HTTP GET on <code class="literal">/frrest/oauth2/token/<em class="replaceable">token-id</em></code>, as in the following example: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --user "myClientID:password" \
 --data "grant_type=password&amp;username=demo&amp;password=changeit&amp;scope=cn" \
 https://openam.example.com:8443/openam/oauth2/access_token</strong>
<em class="computeroutput">{
    "scope": "cn",
    "expires_in": 60,
    "token_type": "Bearer",
    "access_token": "f5fb4833-ba3d-41c8-bba4-833b49c3fe2c"
}</em>

$ <strong class="userinput">curl \
 --header "iplanetDirectoryPro: AQIC5wM2LY4Sfcxs...EwNDU2NjE0*" \
 https://openam.example.com:8443/openam/frrest/oauth2/token/f5fb4833-ba3d-41c8-bba4-833b49c3fe2c</strong>
<em class="computeroutput">{
    "expireTime": [
        "1418818601396"
    ],
    "tokenName": [
        "access_token"
    ],
    "scope": [
        "cn"
    ],
    "grant_type": [
        "password"
    ],
    "clientID": [
        "myClientID"
    ],
    "parent": [],
    "id": [
        "f5fb4833-ba3d-41c8-bba4-833b49c3fe2c"
    ],
    "tokenType": [
        "Bearer"
    ],
    "redirectURI": [],
    "nonce": [],
    "realm": [
        "/"
    ],
    "userName": [
        "demo"
    ]
}</em>
   </pre>
          <p> To list tokens, perform an HTTP GET on <code class="literal">/frrest/oauth2/token/?_queryId=<em class="replaceable">string</em></code>, where <em class="replaceable">string</em> is either <code class="literal">access_token</code> to request the list of access tokens for the current user or all users if requested by <code class="literal">amAdmin</code>, or any other string to request the list of access tokens and refresh tokens. </p>
          <p> The following example shows a search for the demo user's access tokens: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iplanetDirectoryPro: AQIC5wM2LY4Sfcw..." \
 https://openam.example.com:8443/openam/frrest/oauth2/token/?_queryId=access_token</strong>
<em class="computeroutput">{
    "result": [
        {
            "expireTime": "Dec 17, 2014 1:02 PM",
            "tokenName": [
                "access_token"
            ],
            "scope": [
                "cn"
            ],
            "grant_type": [
                "password"
            ],
            "clientID": [
                "myClientID"
            ],
            "parent": [],
            "id": [
                "d2bbd4f9-955f-4683-bb83-bc0d7523b0f9"
            ],
            "tokenType": [
                "Bearer"
            ],
            "redirectURI": [],
            "nonce": [],
            "realm": [
                "/"
            ],
            "userName": [
                "demo"
            ],
            "display_name": "",
            "scopes": "cn"
        },
        {
            "expireTime": "Dec 17, 2014 1:02 PM",
            "tokenName": [
                "access_token"
            ],
            "scope": [
                "cn"
            ],
            "grant_type": [
                "password"
            ],
            "clientID": [
                "myClientID"
            ],
            "parent": [],
            "id": [
                "12f9907f-dbfb-4c4c-a231-2b24964fee8b"
            ],
            "tokenType": [
                "Bearer"
            ],
            "redirectURI": [],
            "nonce": [],
            "realm": [
                "/"
            ],
            "userName": [
                "demo"
            ],
            "display_name": "",
            "scopes": "cn"
        }
    ],
    "resultCount": 2,
    "pagedResultsCookie": null,
    "remainingPagedResults": -1
}</em>
   </pre>
          <p> To delete a token, perform an HTTP DELETE on <code class="literal">/frrest/oauth2/token/<em class="replaceable">token-id</em></code>, as in the following example: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --data "grant_type=client_credentials&amp;username=demo&amp;password=changeit\
&amp;client_id=myClientID&amp;client_secret=password&amp;scope=cn%20mail" \
 https://openam.example.com:8443/openam/oauth2/access_token</strong>
<em class="computeroutput">{
    "expires_in": 599,
    "token_type": "Bearer",
    "access_token": "867aaab2-61d7-4b78-9b80-4f9098034540"
}</em>

$ <strong class="userinput">curl \
 --request DELETE \
 --header "iplanetDirectoryPro: AQIC5wM2LY4Sfcxs...EwNDU2NjE0*" \
 https://openam.example.com:8443/openam/frrest/oauth2/token/867aaab2..098034540</strong>
<em class="computeroutput">{
    "success": "true"
}</em>
   </pre>
         </div>
         <div class="section" id="rest-api-oauth2-client-admin-endpoint">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.3.1.5.&nbsp;OAuth 2.0 Client Administration Endpoint</h5>
            </div>
           </div>
          </div>
          <p> The OAuth 2.0 administration endpoint lets OpenAM administrators and agent administrators create (that is, register) and delete OAuth 2.0 clients. </p>
          <p> OpenAM exposes this endpoint at <code class="literal">/frrest/oauth2/client</code>, such as <code class="literal">https://openam.example.com:8443/openam/frrest/oauth2/client</code>. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p>This endpoint location is likely to change in the future.</p>
           </div>
          </div>
          <p> To create an OAuth 2.0 client, perform an HTTP POST to <code class="literal">/frrest/oauth2/client/?_action=create</code> with a JSON object fully specifying the client, as in the following example: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "iplanetDirectoryPro: AQIC5wM...3MTYxOA..*" \
 --header "Content-Type: application/json" \
 --data \
 '{"client_id":["testClient"],
   "realm":["/"],
   "userpassword":["secret12"],
   "com.forgerock.openam.oauth2provider.clientType":["Confidential"],
   "com.forgerock.openam.oauth2provider.redirectionURIs":
     ["www.client.com","www.example.com"],
   "com.forgerock.openam.oauth2provider.scopes":["cn","sn"],
   "com.forgerock.openam.oauth2provider.defaultScopes":["cn"],
   "com.forgerock.openam.oauth2provider.name":["My Test Client"],
   "com.forgerock.openam.oauth2provider.description":["OAuth 2.0 Client"]
  }' \
 https://openam.example.com:8443/openam/frrest/oauth2/client/?_action=create</strong>
<em class="computeroutput">{"success":"true"}</em>
   </pre>
          <div class="variablelist">
           <p> When creating an OAuth 2.0 client, use the following fields in your JSON object: </p>
           <dl class="variablelist">
            <dt>
             <span class="term"><code class="literal">client_id</code></span>
            </dt>
            <dd>
             <p> (Required) This field takes an array containing the client identifier as defined in RFC 6749. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">realm</code></span>
            </dt>
            <dd>
             <p> (Required) This field takes an array containing the OpenAM realm in which to create the client as defined in RFC 6749. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">userpassword</code></span>
            </dt>
            <dd>
             <p> (Required) This field takes an array containing the client secret as defined in RFC 6749. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">com.forgerock.openam.oauth2provider.clientType</code></span>
            </dt>
            <dd>
             <p> (Required) This field takes an array containing the client type, either <code class="literal">"Confidential"</code> or <code class="literal">"Public"</code> as defined in RFC 6749. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">com.forgerock.openam.oauth2provider.redirectionURIs</code></span>
            </dt>
            <dd>
             <p> (Optional for confidential clients) This field takes an array of client redirection endpoints as defined in RFC 6749. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">com.forgerock.openam.oauth2provider.scopes</code></span>
            </dt>
            <dd>
             <p> (Optional) This field takes an array of scopes as defined in RFC 6749. The default scopes implementation takes scopes to be names of attributes in the resource owner profile. </p>
             <p> Specify localized scopes in <code class="literal"><em class="replaceable">scope</em>|<em class="replaceable">locale</em>|<em class="replaceable">localized description</em></code> format. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">com.forgerock.openam.oauth2provider.defaultScopes</code></span>
            </dt>
            <dd>
             <p> (Optional) This field takes an array of default scopes set automatically when tokens are issued. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">com.forgerock.openam.oauth2provider.name</code></span>
            </dt>
            <dd>
             <p> (Optional) This field takes an array containing the client name to display to the resource owner when the resource owner must authorize client access to protected resources. </p>
             <p> Specify localized names in <code class="literal"><em class="replaceable">locale</em>|<em class="replaceable">localized name</em></code> format. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">com.forgerock.openam.oauth2provider.description</code></span>
            </dt>
            <dd>
             <p> (Optional) This field takes an array containing the description to display to the resource owner when the resource owner must authorize client access to protected resources. </p>
             <p> Specify localized descriptions in <code class="literal"><em class="replaceable">locale</em>|<em class="replaceable">localized description</em></code> format. </p>
            </dd>
           </dl>
          </div>
          <p> To delete an OAuth 2.0 client, perform an HTTP DELETE on <code class="literal">/frrest/oauth2/client/<em class="replaceable">client-id</em></code>, as in the following example: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request DELETE \
 --header "iplanetDirectoryPro: AQIC5wM...3MTYxOA..*" \
 https://openam.example.com:8443/openam/frrest/oauth2/client/myClient</strong>
<em class="computeroutput">{"success":"true"}</em>
   </pre>
          <div class="panel panel-success">
           <div class="panel-heading">
            <h3 class="panel-title">Tip</h3>
           </div>
           <div class="panel-body">
            <p>To delete an OAuth 2.0 client from a subrealm, add the name of the subrealm in a query parameter named <code class="literal">realm</code>, as in the following example:</p>
            <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request DELETE \
 --header "iplanetDirectoryPro: AQIC5wM...3MTYxOA..*" \
 https://openam.example.com:8443/openam/frrest/oauth2/client/myClient?realm=myRealm</strong>
<em class="computeroutput">{"success":"true"}</em></pre>
           </div>
          </div>
         </div>
        </div>
        <div class="section" id="rest-api-openid-connect">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.3.2.&nbsp;OpenID Connect 1.0</h4>
           </div>
          </div>
         </div>
         <a class="indexterm" name="d14232e7428"></a>
         <p> OpenID Connect 1.0 extends OAuth 2.0 so the client can verify claims about the identity of the end user, get profile information about the end user, and log the user out at the end of the OpenAM session. </p>
         <div class="itemizedlist">
          <p> OpenAM exposes the following REST endpoints for <a class="link" href="http://openid.net/connect/" target="_blank">OpenID Connect 1.0</a> purposes: </p>
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p> Endpoints for <a class="link" href="#rest-api-openid-connect-discovery" title="2.1.3.2.1.&nbsp;Discovering OpenID Connect 1.0 Configuration">discovering information</a>. </p></li>
           <li class="listitem"><p> An endpoint for <a class="link" href="#rest-api-openid-connect-dynamic-registration" title="2.1.3.2.2.&nbsp;Registering OpenID Connect 1.0 Clients">registering client applications</a>. </p></li>
           <li class="listitem"><p> Endpoints for <a class="link" href="#rest-api-openid-connect-authorization" title="2.1.3.2.3.&nbsp;Performing OpenID Connect 1.0 Client Authorization">client authorization</a>. </p></li>
           <li class="listitem"><p> Endpoints for <a class="link" href="#rest-api-openid-connect-session" title="2.1.3.2.4.&nbsp;Managing OpenID Connect 1.0 Sessions">session management</a>. </p></li>
          </ul>
         </div>
         <div class="section" id="rest-api-openid-connect-discovery">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.3.2.1.&nbsp;Discovering OpenID Connect 1.0 Configuration</h5>
            </div>
           </div>
          </div>
          <p> OpenAM exposes endpoints for discovering information about the provider configuration, and about the provider for a given end user: </p>
          <div class="itemizedlist">
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p> <code class="literal">/oauth2/.well-known/openid-configuration</code> allows clients to retrieve OpenID Provider configuration by HTTP GET as specified by OpenID Connect Discovery 1.0. </p></li>
            <li class="listitem"><p> <code class="literal">/oauth2/.well-known/webfinger</code> allows clients to retrieve the provider URL for an end user by HTTP GET as specified by OpenID Connect Discovery 1.0. </p></li>
           </ul>
          </div>
          <p> For examples, see <a href="../admin-guide/index.html#configure-openid-connect-discovery" class="link"><em class="citetitle">Configuring OpenAM For OpenID Connect Discovery</em></a> in the <em>Administration Guide</em>. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p> OpenAM supports a provider service that allows the realm to have a configured option for obtaining the base URL (including protocol) for components that need to return a URL to the client. This service is used to provide the URL base that is used in the <code class="literal">.well-known</code> endpoints used in OpenID Connect 1.0 and UMA. </p>
            <p> For more information, see <a href="../admin-guide/index.html#configure-base-url-source" class="olink">Section&nbsp;14.4, "Configuring the Base URL Source Service"</a> in the <em>Administration Guide</em>. </p>
           </div>
          </div>
         </div>
         <div class="section" id="rest-api-openid-connect-dynamic-registration">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.3.2.2.&nbsp;Registering OpenID Connect 1.0 Clients</h5>
            </div>
           </div>
          </div>
          <p> OpenAM allows both static and dynamic registration of OpenID Connect client applications. For dynamic registration according to the OpenID Connect Dynamic Client Registration 1.0 specification, the endpoint is <code class="literal">/oauth2/connect/register</code>. See <a href="../admin-guide/index.html#register-openid-connect-client-dynamic" class="olink">Procedure&nbsp;14.4, "To Register a Relying Party Dynamically"</a> in the <em>Administration Guide</em> for details. </p>
         </div>
         <div class="section" id="rest-api-openid-connect-authorization">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.3.2.3.&nbsp;Performing OpenID Connect 1.0 Client Authorization</h5>
            </div>
           </div>
          </div>
          <p>Registered clients can request authorization through OpenAM.</p>
          <p> OpenID Connect 1.0 supports both a Basic Client Profile using the OAuth 2.0 authorization code grant, and an Implicit Client Profile using the OAuth 2.0 implicit grant. These client profiles rely on the OAuth 2.0 endpoints for authorization. Those endpoints are described in <a class="xref" href="#rest-api-oauth2-client-endpoints" title="2.1.3.1.1.&nbsp;OAuth 2.0 Client and Resource Server Endpoints">Section&nbsp;2.1.3.1.1, "OAuth 2.0 Client and Resource Server Endpoints"</a>. </p>
          <p> In addition, authorized clients can access end user information through the OpenID Connect 1.0 specific endpoint <code class="literal">/oauth2/userinfo</code>. </p>
          <p> For examples, see <a href="../admin-guide/index.html#openid-connect-examples" class="olink">Section&nbsp;14.7, "Relying Party Examples"</a> in the <em>Administration Guide</em>. </p>
         </div>
         <div class="section" id="rest-api-openid-connect-session">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.3.2.4.&nbsp;Managing OpenID Connect 1.0 Sessions</h5>
            </div>
           </div>
          </div>
          <p> Registered clients can use OpenID Connect Session Management 1.0 to handle end user logout actions. </p>
          <div class="itemizedlist">
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p> <code class="literal">/oauth2/connect/checkSession</code> allows clients to retrieve session status notifications. </p></li>
            <li class="listitem"><p> <code class="literal">/oauth2/connect/endSession</code> allows clients to terminate end user sessions. </p></li>
           </ul>
          </div>
          <p> For an example, see <a href="../admin-guide/index.html#manage-sessions-openid-connect" class="olink">Section&nbsp;14.6, "Managing OpenID Connect User Sessions"</a> in the <em>Administration Guide</em>. </p>
         </div>
        </div>
        <div class="section" id="sec-rest-uma">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.3.3.&nbsp;User-Managed Access (UMA)</h4>
           </div>
          </div>
         </div>
         <a class="indexterm" name="d14232e7554"></a>
         <p>User-Managed Access (UMA) is a profile of OAuth 2.0 that lets resource owners control access to protected resources on any number of resource servers from arbitrary requesting parties.</p>
         <p>OpenAM acts as the centralized authorization server and governs access using policies created by resource owners.</p>
         <div class="itemizedlist">
          <p>OpenAM exposes the following REST endpoints for <a class="link" href="https://kantarainitiative.org/confluence/display/uma/Home" target="_blank">User-Managed Access</a> purposes:</p>
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p>An endpoint for <a class="link" href="#rest-api-uma-well-known" title="2.1.3.3.1.&nbsp;Discovering UMA Configuration">automatic configuration and registration of the Authorization Server</a>. </p></li>
           <li class="listitem"><p>An endpoint for <a class="link" href="#rest-api-uma-resource-set-registration" title="2.1.3.3.2.&nbsp;Managing UMA Resource Sets">registering sets of resources</a>. </p></li>
           <li class="listitem"><p>An endpoint for <a class="link" href="#rest-api-uma-policies" title="2.1.3.3.3.&nbsp;Managing UMA Policies">managing UMA policies</a>. </p></li>
           <li class="listitem"><p>Endpoints for <a class="link" href="#rest-api-uma-access-protected-resources" title="2.1.3.3.4.&nbsp;Accessing UMA Protected Resources">requesting and granting authorization for access to resources</a>. </p></li>
          </ul>
         </div>
         <div class="section" id="rest-api-uma-well-known">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.3.3.1.&nbsp;Discovering UMA Configuration</h5>
            </div>
           </div>
          </div>
          <p>OpenAM exposes an endpoint for discovering information about the UMA provider configuration.</p>
          <p>A resource server or client can perform an HTTP GET on <code class="literal">/uma<em class="replaceable">{/realm}</em>/.well-known/uma-configuration</code> to retrieve a JSON object indicating the UMA configuration.</p>
          <p>For an example, see <a href="../admin-guide/index.html#configure-uma-discovery" class="link">Configuring OpenAM For UMA Discovery</a> in the <em>Administration Guide</em>.</p>
         </div>
         <div class="section" id="rest-api-uma-resource-set-registration">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.3.3.2.&nbsp;Managing UMA Resource Sets</h5>
            </div>
           </div>
          </div>
          <p>UMA uses the <a class="link" href="https://docs.kantarainitiative.org/uma/draft-oauth-resource-reg-v1_0_1.html" target="_blank"><em class="citetitle">OAuth 2.0 Resource Set Registration standard</em></a> for registration and management of resources. The endpoint is <code class="literal">/oauth2/resource_set/</code>. For details, see <a href="../admin-guide/index.html#managing-uma-resource-sets" class="olink">Section&nbsp;15.4, "Managing UMA Resource Sets"</a> in the <em>Administration Guide</em>.</p>
          <p>OpenAM also provides a read-only endpoint for viewing a user's resource sets, and if available policy definitions. For more information, see <a class="xref" href="#rest-api-oauth2-resourceset-endpoint" title="2.1.3.1.3.&nbsp;OAuth 2.0 Resource Set Endpoint">Section&nbsp;2.1.3.1.3, "OAuth 2.0 Resource Set Endpoint"</a>.</p>
         </div>
         <div class="section" id="rest-api-uma-policies">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.3.3.3.&nbsp;Managing UMA Policies</h5>
            </div>
           </div>
          </div>
          <p>OpenAM exposes the following endpoint for managing UMA policies:</p>
          <div class="variablelist">
           <dl class="variablelist">
            <dt>
             <span class="term"> <code class="literal">/json/users/<em class="replaceable">username</em>/uma/policies</code> </span>
            </dt>
            <dd>
             <p>For managing UMA policies. For details, see <a href="../admin-guide/index.html#sec-uma-policies" class="olink">Section&nbsp;15.6, "Managing UMA Policies"</a> in the <em>Administration Guide</em>.</p>
            </dd>
           </dl>
          </div>
         </div>
         <div class="section" id="rest-api-uma-access-protected-resources">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.3.3.4.&nbsp;Accessing UMA Protected Resources</h5>
            </div>
           </div>
          </div>
          <p>OpenAM exposes the following endpoints for managing UMA workflow and accessing protected resources:</p>
          <div class="variablelist">
           <dl class="variablelist">
            <dt>
             <span class="term"> <code class="literal">/uma/permission_request</code> </span>
            </dt>
            <dd>
             <p>For registering permission requests. For more information, see <a href="../admin-guide/index.html#to-register-an-uma-permission-request" class="olink">Procedure&nbsp;15.22, "To Register an UMA Permission Request"</a> in the <em>Administration Guide</em>.</p>
            </dd>
            <dt>
             <span class="term"><code class="literal">/uma/authz_request</code></span>
            </dt>
            <dd>
             <p>For acquiring requesting party tokens. For more information, see <a href="../admin-guide/index.html#uma-acquire-rpt" class="olink">Procedure&nbsp;15.24, "To Acquire a Requesting Party Token"</a> in the <em>Administration Guide</em>.</p>
            </dd>
           </dl>
          </div>
         </div>
        </div>
       </div>
       <div class="section" id="sec-rest-user-services">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">2.1.4.&nbsp;RESTful User Self-Service</h3>
          </div>
         </div>
        </div>
        <a class="indexterm" name="d14232e7679"></a>
        <p>This section shows how to use the OpenAM RESTful interfaces for user self-service functionality: user self-registration, forgotten password reset, forgotten username retrieval, dashboard configuration, and device profile reset. </p>
        <p>The steps to perform user self-service via the REST APIs varies depending on the configured user self-service process flow. For more information, see <a href="../admin-guide/index.html#user-self-service-flows" class="olink">Section&nbsp;8.2, "User Self-Service Process Flows"</a> in the <em>Administration Guide</em>.</p>
        <p>When performing user self-service functions, you can enable one or more security methods, such as email validation, Google reCAPTCHA, knowledge-based authentication, or custom plugins. Each configured security method requires requests to be sent from OpenAM to the client, and completed responses returned to OpenAM to verify. </p>
        <div class="panel panel-primary">
         <div class="panel-heading">
          <h3 class="panel-title">Important</h3>
         </div>
         <div class="panel-body">
          <p>At least one security method should be enabled for each self-service feature.</p>
         </div>
        </div>
        <p>A unique token is provided in the second request to the client that must be used in any subsequent responses, so that OpenAM can maintain the state of the self-service process.</p>
        <p>In this section, long URLs are wrapped to fit the printed page, and some of the output is formatted for easier reading.</p>
        <div class="section" id="common-self-registration">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.4.1.&nbsp;Registering Users</h4>
           </div>
          </div>
         </div>
         <p> This section explains how to use the REST APIs for registering a user in OpenAM. </p>
         <div class="procedure" id="d14232e7704">
          <div class="procedure-inner">
           <div class="procedure-title">
            Procedure&nbsp;2.6.&nbsp;To Register a User with the REST APIs
           </div>
           <ol class="procedure" type="1">
            <li class="step"><p>Create a GET request to the <code class="literal">/selfservice/userRegistration</code> endpoint. Notice that the request does not require any form of authentication.</p><pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
https://openam.example.com:8443/openam/json/selfservice/userRegistration</strong>
<em class="computeroutput">{
    "type": "emailValidation",
    "tag": "initial",
    "requirements": {
        "$schema": "http://json-schema.org/draft-04/schema#",
        "description": "Verify your email address",
        "type": "object",
        "required": [
            "mail"
        ],
        "properties": {
            "mail": {
                "description": "Email address",
                "type": "string"
            }
        }
    }
}</em></pre><p>OpenAM sends the first request for security information. In this example, the first request is of type <code class="literal">emailValidation</code>, but other types include <code class="literal">captcha</code> if the Google reCAPTCHA plugin is enabled, and <code class="literal">kbaSecurityAnswerDefinitionStage</code> if knowledge-based authentication is required.</p><p>The <code class="literal">required</code> array defines the data that must be returned to OpenAM to progress past this step of the registration.</p><p>The <code class="literal">properties</code> element contains additional information about the required response, such as a description of the required field, or the site key required to generate a reCAPTCHA challenge.</p></li>
            <li class="step"><p> Create a POST response back to the <code class="literal">/selfservice/userRegistration</code> endpoint with a query string containing <code class="literal">_action=submitRequirements</code>. In the POST data, include an <code class="literal">input</code> element in the JSON structure, which should contain values for each element in the <code class="literal">required</code> array of the request. </p><p>In this example, a <code class="literal">mail</code> value was requested.</p><pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--request POST \
--header "Content-Type: application/json" \
--data \
'{
    "input": {
        "mail": "demo.user@example.com"
    }
}' \
https://openam.example.com:8443/openam/json/selfservice/userRegistration?_action=submitRequirements</strong>
<em class="computeroutput">{
    "type": "emailValidation",
    "tag": "validateCode",
    "requirements": {
        "$schema": "http://json-schema.org/draft-04/schema#",
        "description": "Verify emailed code",
        "type": "object",
        "required": [
            "code"
        ],
        "properties": {
            "code": {
                "description": "Enter code emailed",
                "type": "string"
            }
        }
    },
    "token": "eyAicHis...PIF-lN4s"
}</em></pre><p>If the response was accepted, OpenAM continues with the registration process and sends the next request for information. In this example, the email address was accepted and a code was emailed to the address, which OpenAM requires in the response in an element named <code class="literal">code</code> before continuing. </p><p>The value of the <code class="literal">token</code> element should be included in this and any subsequent responses to OpenAM for this registration.</p></li>
            <li class="step"><p>Continue returning POST data to OpenAM containing the requested information, in the format specified in the request. Also return the <code class="literal">token</code> value in the POST data, so that OpenAM can track which stage of the registration process is being completed.</p><pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--request POST \
--header "Content-Type: application/json" \
--data \
'{
    "input": {
        "code": "cf53fcb6-3bf2-44eb-a437-885296899699"
    },
    "token": "eyAicHis...PIF-lN4s"
}' \
https://openam.example.com:8443/openam/json/selfservice/userRegistration?_action=submitRequirements</strong>
<em class="computeroutput">{
   "type": "userDetails",
   "tag": "initial",
   "requirements": {
       "$schema": "http://json-schema.org/draft-04/schema#",
       "description": "New user details",
       "type": "object",
       "required": [
           "user"
       ],
       "properties": {
           "user": {
               "description": "User details",
               "type": "object"
           }
       }
   },
   "token": "eyAicHis...PIF-lN4s"
}</em></pre></li>
            <li class="step"><p>When requested—when the <code class="literal">type</code> value in the request is <code class="literal">userDetails</code>—supply the details of the new user as an object in the POST data.</p><pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--request POST \
--header "Content-Type: application/json" \
--data \
'{
    "input": {
        "user": {
            "username": "demo",
            "givenName": "Demo User",
            "sn": "User",
            "userPassword": "d3m0",
            "inetUserStatus": "Active"
        }
    },
    "token": "eyAicHis...PIF-lN4s"
}' \
https://openam.example.com:8443/openam/json/selfservice/userRegistration?_action=submitRequirements</strong>
<em class="computeroutput">{
    "type": "selfRegistration",
    "tag": "end",
    "status": {
        "success": true
    },
    "additions": {}
    }
</em></pre><p>When the process is complete, the <code class="literal">tag</code> element has a value of <code class="literal">end</code>. If the <code class="literal">success</code> element in the <code class="literal">status</code> element has a value of <code class="literal">true</code>, then self-registration is complete and the user account was created.</p></li>
           </ol>
          </div>
         </div>
        </div>
        <div class="section" id="common-forgotten-username">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.4.2.&nbsp;Retrieving Forgotten Usernames</h4>
           </div>
          </div>
         </div>
         <p> This section explains how to use the REST APIs to retrieve a forgotten username. </p>
         <div class="procedure" id="d14232e7833">
          <div class="procedure-inner">
           <div class="procedure-title">
            Procedure&nbsp;2.7.&nbsp;To Retrieve a Forgotten Username with the REST APIs
           </div>
           <ol class="procedure" type="1">
            <li class="step"><p>Create a GET request to the <code class="literal">/selfservice/forgottenUsername</code> endpoint. Notice that the request does not require any form of authentication.</p><pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
https://openam.example.com:8443/openam/json/selfservice/forgottenUsername</strong>
<em class="computeroutput">{
  "type": "captcha",
  "tag": "initial",
  "requirements": {
    "$schema": "http://json-schema.org/draft-04/schema#",
    "description": "Captcha stage",
    "type": "object",
    "required": [
      "response"
    ],
    "properties": {
      "response": {
        "recaptchaSiteKey": "6Lfr1...cIqbd",
        "description": "Captcha response",
        "type": "string"
      }
    }
  }
}</em></pre><p>In this example, the Google reCAPTCHA plugin is enabled, so the first request is of the <code class="literal">captcha</code> type.</p></li>
            <li class="step"><p> Create a POST response back to the <code class="literal">/selfservice/forgottenUsername</code> endpoint with a query string containing <code class="literal">_action=submitRequirements</code>. In the POST data, include an <code class="literal">input</code> element in the JSON structure, which should contain values for each element in the <code class="literal">required</code> array of the request. </p><p>In this example, a <code class="literal">response</code> value was requested, which should be the user input as provided after completing the Google reCAPTCHA challenge.</p><pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--request POST \
--header "Content-Type: application/json" \
--data \
'{
    "input": {
        "response": "03AHJ...qiE1x4"
    }
}' \
https://openam.example.com:8443/openam/json/selfservice/forgottenUsername?_action=submitRequirements</strong>
<em class="computeroutput">{
    "type": "userQuery",
    "tag": "initial",
    "requirements": {
        "$schema": "http://json-schema.org/draft-04/schema#",
        "description": "Find your account",
        "type": "object",
        "required": [
            "queryFilter"
        ],
        "properties": {
            "queryFilter": {
                "description": "filter string to find account",
                "type": "string"
            }
        }
    },
    "token": "eyAicHis...PIF-lN4s"
}</em></pre><p>If the response was accepted, OpenAM continues with the username retrieval process and sends the next request for information. In this example, the Google reCAPTCHA was verified and OpenAM is requesting details about the account name to retrieve, which must be provided in a <code class="literal">queryFilter</code> element.</p><p>The value of the <code class="literal">token</code> element should be included in this and all subsequent responses to OpenAM for this retrieval process.</p></li>
            <li class="step"><p>Create a POST response to OpenAM with a <code class="literal">queryFilter</code> value in the POST data containing the user's email address associated with their account.</p><p>For more information on query filters, see <a class="xref" href="#rest-api-filter-sort-page" title="2.1.1.6.&nbsp;Filtering, Sorting, and Paging Results">Section&nbsp;2.1.1.6, "Filtering, Sorting, and Paging Results"</a>.</p><pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--request POST \
--header "Content-Type: application/json" \
--data \
'{
    "input": {
        "queryFilter": "mail eq \"demo.user@example.com\""
    },
    "token": "eyAicHis...PIF-lN4s"
}' \
https://openam.example.com:8443/openam/json/selfservice/forgottenUsername?_action=submitRequirements</strong>
<em class="computeroutput">{
  "type": "kbaSecurityAnswerVerificationStage",
  "tag": "initial",
  "requirements": {
    "$schema": "http://json-schema.org/draft-04/schema#",
    "description": "Answer security questions",
    "type": "object",
    "required": [
      "answer1"
    ],
    "properties": {
      "answer1": {
        "systemQuestion": {
          "en": "What was the model of your first car?"
        },
        "type": "string"
      }
    }
  },
  "token": "eyAicHis...PIF-lN4s"
}</em></pre><p>If a single subject is located that matches the provided query filter, the retrieval process continues.</p><p>If KBA is enabled, OpenAM requests answers to the configured number of KBA questions, as in this example.</p><p>If a subject is not found, an HTTP 400 Bad Request status is returned, and an error message in the JSON data:</p><pre class="cmdline prettyprint nohighlight">{
    "code": 400,
    "reason": "Bad Request",
    "message": "Unable to find account"
}</pre></li>
            <li class="step"><p>Return a POST response with the answers as values of the elements specified in the <code class="literal">required</code> array, in this example <code class="literal">answer1</code>. Ensure the same <code class="literal">token</code> value is sent with each response.</p><pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--request POST \
--header "Content-Type: application/json" \
--data \
'{
    "input": {
        "answer1": "Mustang"
    },
    "token": "eyAicHis...PIF-lN4s"
}' \
https://openam.example.com:8443/openam/json/selfservice/forgottenUsername?_action=submitRequirements</strong>
<em class="computeroutput">{
    "type": "retrieveUsername",
    "tag": "end",
    "status": {
        "success": true
    },
    "additions": {
        "userName": "demo"
    }
}</em></pre><p>When the process is complete, the <code class="literal">tag</code> element has a value of <code class="literal">end</code>. If the <code class="literal">success</code> element in the <code class="literal">status</code> element has a value of <code class="literal">true</code>, then username retrieval is complete and the username is emailed to the registered address.</p><p>If the Show Username option is enabled for username retrieval, the username retrieved is also returned in the JSON response as the value of the <code class="literal">userName</code> element, as in the example above.</p></li>
           </ol>
          </div>
         </div>
        </div>
        <div class="section" id="common-forgotten-password">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.4.3.&nbsp;Replacing Forgotten Passwords</h4>
           </div>
          </div>
         </div>
         <p> This section explains how to use the REST APIs to replace a forgotten password. </p>
         <div class="procedure" id="d14232e7966">
          <div class="procedure-inner">
           <div class="procedure-title">
            Procedure&nbsp;2.8.&nbsp;To Replace a Forgotten Password with the REST APIs
           </div>
           <ol class="procedure" type="1">
            <li class="step"><p>Create a GET request to the <code class="literal">/selfservice/forgottenPassword</code> endpoint. Notice that the request does not require any form of authentication.</p><pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
https://openam.example.com:8443/openam/json/selfservice/forgottenPassword</strong>
<em class="computeroutput">{
  "type": "captcha",
  "tag": "initial",
  "requirements": {
    "$schema": "http://json-schema.org/draft-04/schema#",
    "description": "Captcha stage",
    "type": "object",
    "required": [
      "response"
    ],
    "properties": {
      "response": {
        "recaptchaSiteKey": "6Lfr1...cIqbd",
        "description": "Captcha response",
        "type": "string"
      }
    }
  }
}</em></pre><p>In this example the Google reCAPTCHA plugin is enabled, so the first request is of the <code class="literal">captcha</code> type.</p></li>
            <li class="step"><p> Create a POST response back to the <code class="literal">/selfservice/forgottenPassword</code> endpoint with a query string containing <code class="literal">_action=submitRequirements</code>. In the POST data, include an <code class="literal">input</code> element in the JSON structure, which should contain values for each element in the <code class="literal">required</code> array of the request. </p><p>In this example, a <code class="literal">response</code> value was requested, which should be the user input as provided after completing the Google reCAPTCHA challenge.</p><pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--request POST \
--header "Content-Type: application/json" \
--data \
'{
    "input": {
        "response": "03AHJ...qiE1x4"
    }
}' \
https://openam.example.com:8443/openam/json/selfservice/forgottenPassword?_action=submitRequirements</strong>
<em class="computeroutput">{
    "type": "userQuery",
    "tag": "initial",
    "requirements": {
        "$schema": "http://json-schema.org/draft-04/schema#",
        "description": "Find your account",
        "type": "object",
        "required": [
            "queryFilter"
        ],
        "properties": {
            "queryFilter": {
                "description": "filter string to find account",
                "type": "string"
            }
        }
    },
    "token": "eyAicHis...PIF-lN4s"
}</em></pre><p>If the response was accepted, OpenAM continues with the password reset process and sends the next request for information. In this example, the Google reCAPTCHA was verified and OpenAM is requesting details about the account with the password to replace, which must be provided in a <code class="literal">queryFilter</code> element.</p><p>The value of the <code class="literal">token</code> element should be included in this and all subsequent responses to OpenAM for this reset process.</p></li>
            <li class="step"><p>Create a POST response to OpenAM with a <code class="literal">queryFilter</code> value in the POST data containing the username of the subject with the password to replace.</p><p>For more information on query filters, see <a class="xref" href="#rest-api-filter-sort-page" title="2.1.1.6.&nbsp;Filtering, Sorting, and Paging Results">Section&nbsp;2.1.1.6, "Filtering, Sorting, and Paging Results"</a>.</p><pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--request POST \
--header "Content-Type: application/json" \
--data \
'{
    "input": {
        "queryFilter": "uid eq \"demo\""
    },
    "token": "eyAicHis...PIF-lN4s"
}' \
https://openam.example.com:8443/openam/json/selfservice/forgottenPassword?_action=submitRequirements</strong>
<em class="computeroutput">{
  "type": "kbaSecurityAnswerVerificationStage",
  "tag": "initial",
  "requirements": {
    "$schema": "http://json-schema.org/draft-04/schema#",
    "description": "Answer security questions",
    "type": "object",
    "required": [
      "answer1"
    ],
    "properties": {
      "answer1": {
        "systemQuestion": {
          "en": "What was the model of your first car?"
        },
        "type": "string"
      }
    }
  },
  "token": "eyAicHis...PIF-lN4s"
}</em></pre><p>If a single subject is located that matches the provided query filter, the password reset process continues.</p><p>If a subject is not found, an HTTP 400 Bad Request status is returned, and an error message in the JSON data:</p><pre class="cmdline prettyprint nohighlight">{
     "code": 400,
     "reason": "Bad Request",
     "message": "Unable to find account"
     }</pre></li>
            <li class="step"><p>Continue returning POST data to OpenAM containing the requested information, in the format specified in the request. Also return the <code class="literal">token</code> value in the POST data, so that OpenAM can track which stage of the password reset process is being completed.</p><pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--request POST \
--header "Content-Type: application/json" \
--data \
'{
    "input": {
        "answer1": "Mustang"
    },
    "token": "eyAicHis...PIF-lN4s"
}' \
https://openam.example.com:8443/openam/json/selfservice/forgottenPassword?_action=submitRequirements</strong>
<em class="computeroutput">{
  "type": "resetStage",
  "tag": "initial",
  "requirements": {
      "$schema": "http://json-schema.org/draft-04/schema#",
      "description": "Reset password",
      "type": "object",
      "required": [
           "password"
      ],
      "properties": {
          "password": {
              "description": "Password",
              "type": "string"
          }
      }
  },
   "token": "eyAicHis...PIF-lN4s"
}</em></pre></li>
            <li class="step"><p>When requested—when the <code class="literal">type</code> value in the request is <code class="literal">resetStage</code>—supply the new password in the POST data.</p><pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--request POST \
--header "Content-Type: application/json" \
--data \
'{
    "input": {
        "password": "User1234"
    },
    "token": "eyAicHis...PIF-lN4s"
}' \
https://openam.example.com:8443/openam/json/selfservice/forgottenPassword?_action=submitRequirements</strong>
<em class="computeroutput">{
    "type": "resetStage",
    "tag": "end",
    "status": {
        "success": true
    },
    "additions": {}
}</em></pre><p>When the process is complete, the <code class="literal">tag</code> element has a value of <code class="literal">end</code>. If the <code class="literal">success</code> element in the <code class="literal">status</code> element has a value of <code class="literal">true</code>, then password reset is complete and the new password is now active.</p><p>If the password is not accepted, an HTTP 400 Bad Request status is returned, and an error message in the JSON data:</p><pre class="cmdline prettyprint nohighlight">{
    "code": 400,
    "reason": "Bad Request",
    "message": "Minimum password length is 8."
}</pre></li>
           </ol>
          </div>
         </div>
        </div>
        <div class="section" id="rest-dashboard">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.4.4.&nbsp;Displaying Dashboard Applications</h4>
           </div>
          </div>
         </div>
         <a class="indexterm" name="d14232e8106"></a>
         <p>OpenAM lets administrators configure online applications to display applications on user Dashboards. You can used exposed REST API to display information about the online applications.</p>
         <div class="variablelist">
          <dl class="variablelist">
           <dt>
            <span class="term"><code class="literal">/dashboard/assigned</code></span>
           </dt>
           <dd>
            <p>This endpoint retrieves the list of applications assigned to the authenticated user.</p>
            <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iplanetDirectoryPro: AQIC5w...2NzEz*" \
 https://openam.example.com:8443/openam/json/dashboard/assigned</strong>
<em class="computeroutput">{
  "google": {
      "dashboardIcon": [
          "Google.gif"
      ],
      "dashboardName": [
          "Google"
      ],
      "dashboardLogin": [
          "http://www.google.com"
      ],
      "ICFIdentifier": [
          ""
      ],
      "dashboardDisplayName": [
          "Google"
      ],
      "dashboardClassName": [
          "SAML2ApplicationClass"
      ]
   }
}</em>
      </pre>
           </dd>
           <dt>
            <span class="term"><code class="literal">/dashboard/available</code></span>
           </dt>
           <dd>
            <p>This endpoint retrieves the list of applications available in the authenticated user's realm. The example is based on two of the default Dashboard applications: Google and Salesforce.</p>
            <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iplanetDirectoryPro: AQIC5w...2NzEz*" \
 https://openam.example.com:8443/openam/json/dashboard/available</strong>
<em class="computeroutput">{
  "google": {
      "dashboardIcon": [
          "Google.gif"
      ],
      "dashboardName": [
          "Google"
      ],
      "dashboardLogin": [
          "http://www.google.com"
      ],
      "ICFIdentifier": [
          ""
      ],
      "dashboardDisplayName": [
          "Google"
      ],
      "dashboardClassName": [
          "SAML2ApplicationClass"
      ]
  }
  "salesforce": {
      "dashboardIcon": [
          "salesforce.gif"
      ],
      "dashboardName": [
          "Salesforce"
      ],
      "dashboardLogin": [
          "http://salesforce.com"
      ],
      "ICFIdentifier": [
          ""
      ],
      "dashboardDisplayName": [
          "Salesforce"
      ],
      "dashboardClassName": [
          "SAML2ApplicationClass"
      ]
  }
}</em></pre>
           </dd>
           <dt>
            <span class="term"><code class="literal">/dashboard/defined</code></span>
           </dt>
           <dd>
            <p>This endpoint retrieves the list of all applications available defined for the OpenAM Dashboard service. The example is based on the three default Dashboard applications: Google, Salesforce, and Zendesk.</p>
            <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iplanetDirectoryPro: AQIC5w...2NzEz*" \
 https://openam.example.com:8443/openam/json/dashboard/defined</strong>
<em class="computeroutput">{
    "google": {
        "dashboardIcon": [
            "Google.gif"
        ],
        "dashboardName": [
            "Google"
        ],
        "dashboardLogin": [
            "http://www.google.com"
        ],
        "ICFIdentifier": [
            "idm magic 34"
        ],
        "dashboardDisplayName": [
            "Google"
        ],
        "dashboardClassName": [
            "SAML2ApplicationClass"
        ]
    },
    "salesforce": {
        "dashboardIcon": [
            "salesforce.gif"
        ],
        "dashboardName": [
            "SalesForce"
        ],
        "dashboardLogin": [
            "http://www.salesforce.com"
        ],
        "ICFIdentifier": [
            "idm magic 12"
        ],
        "dashboardDisplayName": [
            "Salesforce"
        ],
        "dashboardClassName": [
            "SAML2ApplicationClass"
        ]
    },
    "zendesk": {
        "dashboardIcon": [
            "ZenDesk.gif"
        ],
        "dashboardName": [
            "ZenDesk"
        ],
        "dashboardLogin": [
            "http://www.ZenDesk.com"
        ],
        "ICFIdentifier": [
            "idm magic 56"
        ],
        "dashboardDisplayName": [
            "ZenDesk"
        ],
        "dashboardClassName": [
            "SAML2ApplicationClass"
        ]
    }
}</em>
      </pre>
           </dd>
          </dl>
         </div>
         <p>If your application runs in a user-agent such as a browser, you can rely on OpenAM to handle authentication.</p>
        </div>
        <div class="section" id="rest-api-device-profile-reset">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.4.5.&nbsp;Resetting Device Profiles</h4>
           </div>
          </div>
         </div>
         <a class="indexterm" name="d14232e8162"></a>
         <p> The OpenAM REST API provides an action that lets a user reset their own profile for a registered device running an authenticator app used for two step verification. Administrators can also use this REST API to reset a user's registered device profile. </p>
         <p> Resetting a device profile deletes information about a user's registered device from OpenAM. </p>
         <p> Resetting a device profile is useful when: </p>
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p> A user loses a registered device—for example, a mobile phone—but had not saved the device recovery codes available in the OpenAM dashboard. </p></li>
           <li class="listitem"><p> A user loses a registered device and has no device recovery codes remaining. </p></li>
          </ul>
         </div>
         <p> </p>
         <p> An administrator or a user can perform an HTTP POST on <code class="literal">/json/<em class="replaceable">subrealm</em>/users/<em class="replaceable">user</em>/devices/2fa/oath?_action=reset</code> to reset the user's device profile: </p>
         <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "iplanetDirectoryPro: AQIC5w...2NzEz*" \
 --data '{}' \
 https://openam.example.com:8443/openam/json/<em><strong class="replaceable">mySubrealm</strong></em>/users/<em><strong class="replaceable">myUser</strong></em>/devices/2fa/oath?_action=reset</strong>
<em class="computeroutput">{"result":true}</em></pre>
         <p> For more information about device registration, see <a href="../admin-guide/index.html#authn-2sv-using-initiating-first-attempt" class="olink">Section&nbsp;2.8.2.2, "Authenticating for the First Time From a New Device"</a> in the <em>Administration Guide</em>. </p>
        </div>
       </div>
       <div class="section" id="sec-rest-identity-realm-mgmt">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">2.1.5.&nbsp;RESTful Identity and Realm Management Services</h3>
          </div>
         </div>
        </div>
        <a class="indexterm" name="d14232e8214"></a>
        <p> This section shows how to use the OpenAM RESTful interfaces for identity and realm management. </p>
        <p> In this section, long URLs are wrapped to fit the printed page, as some of the output is formatted for easier reading. </p>
        <p> Before making a REST API call to manage a realm or an identity, make sure that you have: </p>
        <div class="itemizedlist">
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p> Authenticated successfully to OpenAM as a user with sufficient privileges to make the REST API call </p></li>
          <li class="listitem"><p> Obtained the session token returned after successful authentication </p></li>
         </ul>
        </div>
        <p> When making the REST API call, pass the session token in the HTTP header. For more information about the OpenAM session token and its use in REST API calls, see <a class="xref" href="#rest-api-ssotoken" title="2.1.1.5.&nbsp;Using the Session Token After Authentication">Section&nbsp;2.1.1.5, "Using the Session Token After Authentication"</a>. </p>
        <div class="section" id="rest-api-crud-identity">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.5.1.&nbsp;Identity Management</h4>
           </div>
          </div>
         </div>
         <a class="indexterm" name="d14232e8236"></a>
         <p> This section shows how to create, read, update, delete, and list identities using the RESTful APIs. </p>
         <div class="panel panel-primary">
          <div class="panel-heading">
           <h3 class="panel-title">Important</h3>
          </div>
          <div class="panel-body">
           <p> OpenAM is not primarily an identity data store, nor is it provisioning software. For storing identity data, consider <a class="link" href="http://forgerock.com/what-we-offer/open-identity-stack/opendj/" target="_blank">OpenDJ</a>. For provisioning, consider <a class="link" href="http://forgerock.com/what-we-offer/open-identity-stack/openidm/" target="_blank">OpenIDM</a>. Both of these products provide REST APIs as well. </p>
          </div>
         </div>
         <div class="itemizedlist">
          <p>OpenAM has two REST APIs for managing identities:</p>
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p> Under the <code class="literal">/json/agents</code>, <code class="literal">/json/groups</code>, and <code class="literal">/json/users</code>, you find the newer JSON-based APIs. The newer APIs follow the ForgeRock common REST pattern creating, reading, updating, deleting, and querying resources. </p><p> Examples in this section do not repeat the authentication shown in <a href="../dev-guide/index.html#rest-api-auth" class="link">Authorization and Policy Management</a>. For browser-based clients, you can rely on OpenAM cookies rather than construct the header in your application. Managing agent profiles, groups, realms, and users with these APIs of course require authorization. The examples shown in this section were performed with the token ID gained after authenticating as OpenAM administrator. </p><p> Although the examples here show user management, you can use <code class="literal">/json/agents</code>, <code class="literal">/json/groups</code>, <code class="literal">/json/realms</code> in similar fashion. See <a class="xref" href="#rest-api-crud-realm" title="2.1.5.2.&nbsp;Realm Management">Section&nbsp;2.1.5.2, "Realm Management"</a> for examples related to realms. </p>
            <div class="itemizedlist">
             <p>The following sections cover this JSON-based API:</p>
             <ul class="itemizedlist" style="list-style-type: circle; ">
              <li class="listitem"><p><a class="xref" href="#rest-api-create-identity" title="2.1.5.1.1.&nbsp;Creating Identities">Section&nbsp;2.1.5.1.1, "Creating Identities"</a></p></li>
              <li class="listitem"><p><a class="xref" href="#rest-api-read-identity" title="2.1.5.1.2.&nbsp;Reading Identities">Section&nbsp;2.1.5.1.2, "Reading Identities"</a></p></li>
              <li class="listitem"><p><a class="xref" href="#rest-api-update-identity" title="2.1.5.1.3.&nbsp;Updating Identities">Section&nbsp;2.1.5.1.3, "Updating Identities"</a></p></li>
              <li class="listitem"><p><a class="xref" href="#rest-api-delete-identity" title="2.1.5.1.4.&nbsp;Deleting Identities">Section&nbsp;2.1.5.1.4, "Deleting Identities"</a></p></li>
              <li class="listitem"><p><a class="xref" href="#rest-api-query-identity" title="2.1.5.1.5.&nbsp;Listing Identities">Section&nbsp;2.1.5.1.5, "Listing Identities"</a></p></li>
              <li class="listitem"><p><a class="xref" href="#rest-api-change-password" title="2.1.5.1.7.&nbsp;Changing Passwords">Section&nbsp;2.1.5.1.7, "Changing Passwords"</a></p></li>
             </ul>
            </div></li>
          </ul>
         </div>
         <div class="section" id="rest-api-create-identity">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.5.1.1.&nbsp;Creating Identities</h5>
            </div>
           </div>
          </div>
          <p> OpenAM lets administrators create a user profile by making an HTTP POST of the JSON representation of the profile to <code class="literal">/json/<em class="replaceable">subrealm</em>/users/?_action=create</code>. To add a user to the Top Level Realm, you do not need to specify the realm.</p>
          <p> The following example shows an administrator creating a new user. The only required fields are <code class="literal">username</code> and <code class="literal">userpassword</code>. If no other name is provided, the entry you make for <code class="literal">username</code> defaults to both the user id and the user's last name: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "iplanetDirectoryPro: AQIC5w...2NzEz*" \
 --header "Content-Type: application/json" \
 --data \
 '{
   "username": "bjensen",
   "userpassword": "secret12",
   "mail": "bjensen@example.com"
 }' \
 https://openam.example.com:8443/openam/json/users/?_action=create</strong>
<em class="computeroutput">{
    "username": "bjensen",
    "realm": "/",
    "uid": [
        "bjensen"
    ],
    "mail": [
        "bjensen@example.com"
    ],
    "sn": [
        "bjensen"
    ],
    "cn": [
        "bjensen"
    ],
    "inetuserstatus": [
        "Active"
    ],
    "dn": [
        "uid=bjensen,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "objectclass": [
        "person",
        "sunIdentityServerLibertyPPService",
        "sunFederationManagerDataStore",
        "inetorgperson",
        "iPlanetPreferences",
        "iplanet-am-auth-configuration-service",
        "organizationalperson",
        "sunFMSAML2NameIdentifier",
        "inetuser",
        "iplanet-am-managed-person",
        "sunAMAuthAccountLockout",
        "iplanet-am-user-service",
        "top"
    ],
    "universalid": [
        "id=bjensen,ou=user,dc=openam,dc=forgerock,dc=org"
    ]
}</em>
   </pre>
          <p> Alternatively, administrators can create user profiles with specific user IDs by doing an HTTP PUT of the JSON representation of the changes to <code class="literal">/json/users/<em class="replaceable">user-id</em></code>, as shown in the following example: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request PUT \
 --header "iplanetDirectoryPro: AQIC5w...2NzEz*" \
 --header "Content-Type: application/json" \
 --header "If-None-Match: *" \
 --data \
 '{
   "username": "janedoe",
   "userpassword": "secret12",
   "mail": "janedoe@example.com"
 }' \
 https://openam.example.com:8443/openam/json/users/janedoe</strong>
<em class="computeroutput">{
    "username": "janedoe",
    "realm": "/",
    "uid": [
        "janedoe"
    ],
    "mail": [
        "janedoe@example.com"
    ],
    "sn": [
        "janedoe"
    ],
    "cn": [
        "janedoe"
    ],
    "inetuserstatus": [
        "Active"
    ],
    "dn": [
        "uid=janedoe,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "objectclass": [
        "devicePrintProfilesContainer",
        "person",
        "sunIdentityServerLibertyPPService",
        "inetorgperson",
        "sunFederationManagerDataStore",
        "iPlanetPreferences",
        "iplanet-am-auth-configuration-service",
        "organizationalperson",
        "sunFMSAML2NameIdentifier",
        "inetuser",
        "forgerock-am-dashboard-service",
        "iplanet-am-managed-person",
        "iplanet-am-user-service",
        "sunAMAuthAccountLockout",
        "top"
    ],
    "universalid": [
        "id=janedoe,ou=user,dc=openam,dc=forgerock,dc=org"
    ]
}</em>
   </pre>
          <p> As shown in the examples, OpenAM returns the JSON representation of the profile on successful creation. On failure, OpenAM returns a JSON representation of the error including the <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>. For example, version 2.0 of the CREST <code class="literal">/json/users</code>, <code class="literal">/json/groups</code>, and <code class="literal">/json/agents</code> endpoints return 403 if the user making the request is not authorized to do so. </p>
          <p> The same HTTP POST and PUT mechanisms also work for other objects such as policy agent profiles and groups: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "iPlanetDirectoryPro: AQIC5w...2NzEz*" \
 --header "Content-Type: application/json" \
 --data \
 '{
    "username":"myAgent",
    "com.sun.identity.agents.config.fqdn.default":
      ["www.example.com"],
    "com.sun.identity.agents.config.repository.location":
      ["centralized"],
    "agenttype":["WebAgent"],
    "serverurl":["https://openam.example.com:8443/openam/"],
    "agenturl":["http://www.example.com:80/"],
    "userpassword":["password"],
    "com.sun.identity.agents.config.login.url":
      ["[0]=https://openam.example.com:8443/openam/UI/Login"],
    "com.sun.identity.agents.config.logout.url":
      ["[0]=https://openam.example.com:8443/openam/UI/Logout"],
    "sunidentityserverdevicestatus":["Active"]
 }' \
 https://openam.example.com:8443/openam/json/agents/?_action=create</strong>
<em class="computeroutput">{
    "username": "myAgent",
    "realm": "/",
    "com.sun.identity.agents.config.fqdn.default": [
        "www.example.com"
    ],
    "com.sun.identity.agents.config.repository.location": [
        "centralized"
    ],
    "AgentType": [
        "WebAgent"
    ],
    "com.sun.identity.agents.config.login.url": [
        "[0]=https://openam.example.com:8443/openam/UI/Login"
    ],
    "com.sun.identity.agents.config.login.url":
        ["[0]=https://openam.example.com:8443/openam/UI/Login"
    ],
    "com.sun.identity.agents.config.logout.url":
        ["[0]=https://openam.example.com:8443/openam/UI/Logout"
    ],
    "sunIdentityServerDeviceStatus": [
        "Active"
    ]
}</em>
   </pre>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p> The command output above has been truncated to be more readable. When you create a policy agent profile, OpenAM returns the full profile in JSON format. </p>
           </div>
          </div>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "iPlanetDirectoryPro: AQIC5w...2NzEz*" \
 --header "Content-Type: application/json" \
 --data '{
   "username":"newGroup",
   "uniquemember":["uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"]
 }' \
 https://openam.example.com:8443/openam/json/groups?_action=create</strong>
<em class="computeroutput">{
    "username": "newGroup",
    "realm": "/",
    "uniqueMember": [
        "uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "cn": [
        "newGroup"
    ],
    "dn": [
        "cn=newGroup,ou=groups,dc=openam,dc=forgerock,dc=org"
    ],
    "objectclass": [
        "groupofuniquenames",
        "top"
    ],
    "universalid": [
        "id=newGroup,ou=group,dc=openam,dc=forgerock,dc=org"
    ]
}</em>

$ <strong class="userinput">curl \
 --request PUT \
 --header "If-None-Match: *" \
 --header "iPlanetDirectoryPro: AQIC5w...2NzEz*" \
 --header "Content-Type: application/json" \
 --data '{
   "username":"anotherGroup",
   "uniquemember":["uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"]
 }' \
 https://openam.example.com:8443/openam/json/groups/anotherGroup</strong>
<em class="computeroutput">{
    "username": "anotherGroup",
    "realm": "/",
    "uniqueMember": [
        "uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "cn": [
        "anotherGroup"
    ],
    "dn": [
        "cn=anotherGroup,ou=groups,dc=openam,dc=forgerock,dc=org"
    ],
    "objectclass": [
        "groupofuniquenames",
        "top"
    ],
    "universalid": [
        "id=anotherGroup,ou=group,dc=openam,dc=forgerock,dc=org"
    ]
}</em>
   </pre>
         </div>
         <div class="section" id="rest-api-read-identity">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.5.1.2.&nbsp;Reading Identities</h5>
            </div>
           </div>
          </div>
          <p> OpenAM lets users and administrators read profiles by requesting an HTTP GET on <code class="literal">/json/<em class="replaceable">subrealm</em>/users/<em class="replaceable">user-id</em></code>. This allows users and administrators to verify user data, status, and directory. If users or administrators see missing or incorrect information, they can write down the correct information and add it using <a class="xref" href="#rest-api-update-identity" title="2.1.5.1.3.&nbsp;Updating Identities">Section&nbsp;2.1.5.1.3, "Updating Identities"</a>. To read a profile on the Top Level Realm, you do not need to specify the realm. </p>
          <p> Users can review the data associated with their own accounts, and administrators can also read other user's profiles. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p> If an administrator user is reading their own profile, an additional <code class="literal">roles</code> element, with a value of <code class="literal">ui-admin</code> is returned in the JSON response. The XUI verifies this element to grant or deny access to the OpenAM Console. </p>
           </div>
          </div>
          <p> The following example shows an administrator accessing user data belonging to <code class="literal">demo</code>: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iplanetDirectoryPro: AQIC5w...2NzEz*" \
 https://openam.example.com:8443/openam/json/users/demo</strong>
<em class="computeroutput">{
    "username": "demo",
    "realm": "dc=openam,dc=forgerock,dc=org",
    "uid": [
        "demo"
    ],
    "sn": [
        "demo"
    ],
    "cn": [
        "demo"
    ],
    "inetuserstatus": [
        "Active"
    ],
    "dn": [
        "uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "objectclass": [
        "devicePrintProfilesContainer",
        "person",
        "sunIdentityServerLibertyPPService",
        "inetorgperson",
        "sunFederationManagerDataStore",
        "iPlanetPreferences",
        "iplanet-am-auth-configuration-service",
        "organizationalperson",
        "sunFMSAML2NameIdentifier",
        "inetuser",
        "forgerock-am-dashboard-service",
        "iplanet-am-managed-person",
        "iplanet-am-user-service",
        "sunAMAuthAccountLockout",
        "top"
    ],
    "universalid": [
        "id=demo,ou=user,dc=openam,dc=forgerock,dc=org"
    ]
}</em>
   </pre>
          <p> Use the <code class="literal">_fields</code> query string parameter to restrict the list of attributes returned. This parameter takes a comma-separated list of JSON object fields to include in the result: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iPlanetDirectoryPro: AQIC5w...2NzEz*" \
 https://openam.example.com:8443/openam/json/users/demo?_fields=username,uid</strong>
<em class="computeroutput">{"username":"demo","uid":["demo"]}</em>
   </pre>
          <p> As shown in the examples, OpenAM returns the JSON representation of the profile on success. On failure, OpenAM returns a JSON representation of the error including the <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>. </p>
          <p> Using HTTP GET to read also works for other objects such as agent profiles and groups: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iplanetDirectoryPro: AQIC5w...2NzEz*" \
 https://openam.example.com:8443/openam/json/agents/myAgent</strong>
<em class="computeroutput">{
    "username": "myAgent",
    "realm": "/",
    "com.sun.identity.agents.config.fqdn.default": [
        "www.example.com"
    ],
    "com.sun.identity.agents.config.repository.location": [
        "centralized"
    ],
    "AgentType": [
        "WebAgent"
    ],
    "com.sun.identity.agents.config.login.url": [
        "[0]=https://openam.example.com:8443/openam/UI/Login"
    ],
    "com.sun.identity.agents.config.login.url":
    [
        "[0]=https://openam.example.com:8443/openam/UI/Login"
    ],
    "com.sun.identity.agents.config.logout.url":
    [
        "[0]=https://openam.example.com:8443/openam/UI/Logout"
    ],
    "sunIdentityServerDeviceStatus": [
        "Active"
    ]
}</em>
</pre>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p> The command output above has been truncated to be more readable. When you read a policy agent profile, OpenAM returns the full profile in JSON format. </p>
           </div>
          </div>
          <p> The <code class="literal">_prettyPrint</code> query string parameter can make the resulting JSON easier to read when you are viewing the resulting JSON directly: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iPlanetDirectoryPro: AQIC5w...2NzEz*" \
 https://openam.example.com:8443/openam/json/groups/newGroup?_prettyPrint=true</strong>
<em class="computeroutput">{
    "username": "newGroup",
    "realm": "dc=openam,dc=forgerock,dc=org",
    "uniquemember": [
        "uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "cn": [
        "newGroup"
    ],
    "dn": [
        "cn=newGroup,ou=groups,dc=openam,dc=forgerock,dc=org"
    ],
    "objectclass": [
        "groupofuniquenames",
        "top"
    ],
    "universalid": [
        "id=newGroup,ou=group,dc=openam,dc=forgerock,dc=org"
    ]
}</em>
   </pre>
         </div>
         <div class="section" id="rest-api-update-identity">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.5.1.3.&nbsp;Updating Identities</h5>
            </div>
           </div>
          </div>
          <p> OpenAM lets users update their own profiles, and lets administrators update other users' profiles. To update an identity do an HTTP PUT of the JSON representation of the changes to <code class="literal">/json/<em class="replaceable">subrealm</em>/users/<em class="replaceable">user-id</em></code>. To update a profile on the Top Level Realm, you do not need to specify the realm. </p>
          <p> The following example shows how users can update their own profiles: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request PUT \
 --header "iplanetDirectoryPro: AQIC5...Y3MTAx*" \
 --header "Content-Type: application/json" \
 --data '{ "mail": "demo@example.com" }' \
 https://openam.example.com:8443/openam/json/users/demo</strong>
<em class="computeroutput">{
    "username": "demo",
    "realm": "/",
    "uid": [
        "demo"
    ],
    "mail": [
        "demo@example.com"
    ],
    "sn": [
        "demo"
    ],
    "cn": [
        "demo"
    ],
    "inetuserstatus": [
        "Active"
    ],
    "dn": [
        "uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "objectclass": [
        "person",
        "sunIdentityServerLibertyPPService",
        "sunFederationManagerDataStore",
        "inetorgperson",
        "iPlanetPreferences",
        "iplanet-am-auth-configuration-service",
        "organizationalperson",
        "sunFMSAML2NameIdentifier",
        "inetuser",
        "iplanet-am-managed-person",
        "sunAMAuthAccountLockout",
        "iplanet-am-user-service",
        "top"
    ],
    "universalid": [
        "id=demo,ou=user,dc=openam,dc=forgerock,dc=org"
    ]
}</em>
   </pre>
          <p> As shown in the example, OpenAM returns the JSON representation of the profile on success. On failure, OpenAM returns a JSON representation of the error including the <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>. </p>
          <p> You can use HTTP PUT to update other objects as well, such as policy agent profiles and groups. </p>
          <p> The following example updates a web policy agent profile: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request PUT \
 --header "iPlanetDirectoryPro: AQIC5...Y3MTAx*" \
 --header "Content-Type: application/json" \
 --data '{
      "sunIdentityServerDeviceStatus" : [ "Inactive" ]
 }' \
 https://openam.example.com:8443/openam/json/agents/myAgent?_prettyPrint=true</strong>
 <em class="computeroutput">{
     "username": "myAgent",
     "realm": "/",
     "com.sun.identity.agents.config.fqdn.default": [
         "www.example.com"
     ],
     "com.sun.identity.agents.config.repository.location": [
         "centralized"
     ],
     "AgentType": [
         "WebAgent"
     ],
     "com.sun.identity.agents.config.login.url": [
         "[0]=https://openam.example.com:8443/openam/UI/Login"
     ],
     "com.sun.identity.agents.config.login.url":
     [
         "[0]=https://openam.example.com:8443/openam/UI/Login"
     ],
     "com.sun.identity.agents.config.logout.url":
     [
         "[0]=https://openam.example.com:8443/openam/UI/Logout"
     ],
     "sunIdentityServerDeviceStatus": [
         "Inactive"
     ]
 }</em>
   </pre>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p> The command output above has been truncated to be more readable. When you update a policy agent profile, OpenAM returns the full profile in JSON format. </p>
           </div>
          </div>
          <p> Notice in the following example that updates <code class="literal">newGroup</code> the object class value is not included in the JSON sent to OpenAM: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request PUT \
 --header "iPlanetDirectoryPro: AQIC5...Y3MTAx*" \
 --header "Content-Type: application/json" \
 --data '{
    "uniquemember":[
        "uid=newUser,ou=people,dc=openam,dc=forgerock,dc=org",
        "uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"
    ]
 }' \
 https://openam.example.com:8443/openam/json/groups/newGroup</strong>
<em class="computeroutput">{
    "name": "newGroup",
    "realm": "/",
    "uniqueMember": [
        "uid=newUser,ou=people,dc=openam,dc=forgerock,dc=org",
        "uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "cn": [
        "newGroup"
    ],
    "dn": [
        "cn=newGroup,ou=groups,dc=openam,dc=forgerock,dc=org"
    ],
    "objectclass": [
        "groupofuniquenames",
        "top"
    ],
    "universalid": [
        "id=newGroup,ou=group,dc=openam,dc=forgerock,dc=org"
    ]
}</em>
   </pre>
         </div>
         <div class="section" id="rest-api-delete-identity">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.5.1.4.&nbsp;Deleting Identities</h5>
            </div>
           </div>
          </div>
          <p> OpenAM lets administrators delete a user profile by making an HTTP DELETE call to <code class="literal">/json/<em class="replaceable">subrealm</em>/users/<em class="replaceable">user-id</em></code>. To delete a user from the Top Level Realm, you do not need to specify the realm. </p>
          <p> The following example removes a user from the top level realm. Only administrators should delete users. The user id is the only field required to delete a user: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request DELETE \
 --header "iplanetDirectoryPro: AQIC5w...2NzEz*" \
 https://openam.example.com:8443/openam/json/users/bjensen</strong>
<em class="computeroutput">{"success":"true"}</em>
   </pre>
          <p> On success, OpenAM returns a JSON object indicating success. On failure, OpenAM returns a JSON representation of the error including the <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>. </p>
          <p> You can use this same logic for other resources such as performing an HTTP DELETE of an agent profile or of a group: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request DELETE \
 --header "iplanetDirectoryPro: AQIC5w...2NzEz*" \
 https://openam.example.com:8443/openam/json/agents/myOAuth2ClientAgent</strong>
<em class="computeroutput">{"success":"true"}</em>
   </pre>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request DELETE \
 --header "iPlanetDirectoryPro: AQIC5w...2NzEz*" \
 https://openam.example.com:8443/openam/json/groups/newGroup</strong>
<em class="computeroutput">{"success":"true"}</em>
   </pre>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p> Deleting a user does not automatically remove any of the user's sessions. If you are using stateful sessions, you can remove a user's sessions by checking for any sessions for the user and then removing them using the console's Sessions tab. If you are using stateless sessions, you cannot remove users' sessions; you must wait for the sessions to expire. </p>
           </div>
          </div>
         </div>
         <div class="section" id="rest-api-query-identity">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.5.1.5.&nbsp;Listing Identities</h5>
            </div>
           </div>
          </div>
          <p> OpenAM lets administrators list identities by making an HTTP GET call to <code class="literal">/json/<em class="replaceable">subrealm</em>/users/?_queryId=*</code>. To query the Top Level Realm, you do not need to specify the realm: </p>
          <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5w...2NzEz*" \
"https://openam.example.com:8443/openam/json/users?_queryId=*"</strong>
<em class="computeroutput">{
  "result": [
    {
      "username": "amAdmin",
      "realm": "dc=openam,dc=forgerock,dc=org",
      "sunIdentityMSISDNNumber": [],
      "mail": [],
      "sn": [
        "amAdmin"
      ],
      "givenName": [
        "amAdmin"
      ],
      "universalid": [
        "id=amAdmin,ou=user,dc=openam,dc=forgerock,dc=org"
      ],
      "cn": [
        "amAdmin"
      ],
      "iplanet-am-user-success-url": [],
      "telephoneNumber": [],
      "roles": [
        "ui-global-admin",
        "ui-realm-admin"
      ],
      "iplanet-am-user-failure-url": [],
      "inetuserstatus": [
        "Active"
      ],
      "postalAddress": [],
      "dn": [
        "uid=amAdmin,ou=people,dc=openam,dc=forgerock,dc=org"
      ],
      "employeeNumber": [],
      "iplanet-am-user-alias-list": []
    },
    {
      "username": "demo",
      "realm": "dc=openam,dc=forgerock,dc=org",
      "uid": [
        "demo"
      ],
      "createTimestamp": [
        "20160108155628Z"
      ],
      "inetUserStatus": [
        "Active"
      ],
      "mail": [
        "demo.user@example.com"
      ],
      "sn": [
        "demo"
      ],
      "cn": [
        "demo"
      ],
      "objectClass": [
        "devicePrintProfilesContainer",
        "person",
        "sunIdentityServerLibertyPPService",
        "sunFederationManagerDataStore",
        "inetorgperson",
        "oathDeviceProfilesContainer",
        "iPlanetPreferences",
        "iplanet-am-auth-configuration-service",
        "sunFMSAML2NameIdentifier",
        "organizationalperson",
        "inetuser",
        "kbaInfoContainer",
        "forgerock-am-dashboard-service",
        "iplanet-am-managed-person",
        "iplanet-am-user-service",
        "sunAMAuthAccountLockout",
        "top"
      ],
      "kbaInfo": [
        {
          "questionId": "2",
          "answer": {
            "$crypto": {
              "value": {
                "algorithm": "SHA-256",
                "data": "VXGtsnjJMC...MQJ/goU5hkfF"
              },
              "type": "salted-hash"
            }
          }
        },
        {
          "questionId": "1",
          "answer": {
            "$crypto": {
              "value": {
                "algorithm": "SHA-256",
                "data": "cfYYzi9U...rVfFl0Tdw0iX"
              },
              "type": "salted-hash"
            }
          }
        }
      ],
      "dn": [
        "uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"
      ],
      "universalid": [
        "id=demo,ou=user,dc=openam,dc=forgerock,dc=org"
      ],
      "modifyTimestamp": [
        "20160113010610Z"
      ]
    }
  ],
  "resultCount": 2,
  "pagedResultsCookie": null,
  "totalPagedResultsPolicy": "NONE",
  "totalPagedResults": -1,
  "remainingPagedResults": -1
}</em></pre>
          <p> The <code class="literal">users</code> endpoint also supports the <code class="literal">_queryFilter</code> parameter to alter the returned results. For more information, see <a class="xref" href="#rest-api-filter-sort-page" title="2.1.1.6.&nbsp;Filtering, Sorting, and Paging Results">Section&nbsp;2.1.1.6, "Filtering, Sorting, and Paging Results"</a>. </p>
          <p> The <code class="literal">_queryId=*</code> parameter also works for other types of objects, such as agent profiles and groups: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iPlanetDirectoryPro: AQIC5w...2NzEz*" \
 "https://openam.example.com:8443/openam/json/agents?_queryId=*"</strong>
<em class="computeroutput">{
  "result" : [ "wsp", "wsc", "agentAuth", "SecurityTokenService" ],
  "resultCount" : 4,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : -1
}</em>
   </pre>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iPlanetDirectoryPro: AQIC5w...2NzEz*" \
 "https://openam.example.com:8443/openam/json/groups?_queryId=*"</strong>
<em class="computeroutput">{
  "result" : [ "newGroup", "anotherGroup" ],
  "resultCount" : 2,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : -1
}</em>
   </pre>
          <p> As the result lists include all objects, this capability to list identity names is mainly useful in testing. </p>
          <p> As shown in the examples, OpenAM returns the JSON representation of the resource list if successful. On failure, OpenAM returns a JSON representation of the error including the <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>. </p>
         </div>
         <div class="section" id="rest-api-retrieve-identity-using-session-cookie">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.5.1.6.&nbsp;Retrieving Identities Using the Session Cookie</h5>
            </div>
           </div>
          </div>
          <p> If you only have access to the <code class="literal">iPlanetDirectoryPro</code> session cookie, you can retrieve the user ID by performing an HTTP POST operation on the <code class="literal">/json/users</code> endpoint using the <code class="literal">idFromSession</code> action: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --verbose \
 --request POST \
 --header "iplanetdirectorypro: AQIC5wM2LY4SfczUFNs-TJwFrCVAKgR0NulIAyNaIkQmjis.*AAJTSQACMDEA
 AlNLABQtNTQ3NDE2Njc5ODk4MjYzMzA2MQ..*" \
 --header "Content-Type: application/json" http://openam.example.com:8080/openam/json/users?_action=idFromSession</strong>
<em class="computeroutput">
{
  "id":"demo",
  "realm":"/",
  "dn":"id=demo,ou=user,dc=openam,dc=forgerock,dc=org",
  "successURL":"/openam/console",
  "fullLoginURL":null
}</em>
   </pre>
         </div>
         <div class="section" id="rest-api-change-password">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.5.1.7.&nbsp;Changing Passwords</h5>
            </div>
           </div>
          </div>
          <a class="indexterm" name="d14232e8669"></a>
          <a class="indexterm" name="d14232e8674"></a>
          <p> <span class="emphasis"><em>Users</em></span> other than the top-level administrator can change their own passwords with an HTTP POST to <code class="literal">/json/<em class="replaceable">subrealm</em>/users/<em class="replaceable">username</em>?_action=changePassword</code> including the new password as the value of <code class="literal">userpassword</code> in the request data. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p> Changing the top-level administrator's password requires a more complex procedure. See <a href="../admin-guide/index.html#amadmin-changes" class="olink">Section&nbsp;27.5, "Administering the amadmin Account"</a> in the <em>Administration Guide</em> for more information. </p>
           </div>
          </div>
          <p> Users must provide the current password, which is set in the request as the value of the <code class="literal">currentpassword</code>. </p>
          <p> For cases where users have forgotten their password, see <a class="xref" href="#common-forgotten-username" title="2.1.4.2.&nbsp;Retrieving Forgotten Usernames">Section&nbsp;2.1.4.2, "Retrieving Forgotten Usernames"</a> instead. </p>
          <p> The following example shows a successful request to change the <code class="literal">demo</code> user's password to <code class="literal">password</code>: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "iPlanetDirectoryPro: AQIC5w...NTcy*" \
 --header "Content-Type: application/json" \
 --data '{
     "currentpassword":"changeit",
     "userpassword":"password"
 }' \
 https://openam.example.com:8443/openam/json/users/demo?_action=changePassword</strong>
<em class="computeroutput">{}</em></pre>
          <p> On success, the response is an empty JSON object {} as shown in the example. </p>
          <p> On failure, OpenAM returns a JSON representation of the error including the <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>. See also <a class="xref" href="#rest-api-status-codes" title="2.1.1.10.&nbsp;REST Status Codes">Section&nbsp;2.1.1.10, "REST Status Codes"</a> for more information. </p>
          <p> <span class="emphasis"><em>Administrators</em></span> can change non-administrative users' passwords with an HTTP PUT to <code class="literal">/json/<em class="replaceable">subrealm</em>/users/<em class="replaceable">username</em></code> including the new password as the value of <code class="literal">userpassword</code> in the request data. </p>
          <p> Unlike users, administrators do not provide users' current passwords when changing passwords. </p>
          <p> The following example shows a successful request by an administrator to change the <code class="literal">demo</code> user's password to <code class="literal">cangetin</code>: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request PUT \
 --header "iPlanetDirectoryPro: AQIC5w...NTcy*" \
 --header "Content-Type: application/json" \
 --data '{
     "userpassword":"cangetin"
 }' \
 https://openam.example.com:8443/openam/json/users/demo</strong>
<em class="computeroutput">{
    "username":"demo",
    "realm":"/",
    "uid":[
        "demo"
    ],
    "universalid":[
        "id=demo,ou=user,dc=example,dc=com"
    ],
    "objectClass":[
        "iplanet-am-managed-person",
        "inetuser","sunFederationManagerDataStore",
        "sunFMSAML2NameIdentifier",
        "devicePrintProfilesContainer",
        "inetorgperson",
        "sunIdentityServerLibertyPPService",
        "iPlanetPreferences",
        "iplanet-am-user-service",
        "forgerock-am-dashboard-service",
        "organizationalperson",
        "top",
        "sunAMAuthAccountLockout",
        "person",
        "oathDeviceProfilesContainer",
        "iplanet-am-auth-configuration-service"
    ],
    "inetUserStatus":[
        "Active"
    ],
    "dn":[
        "uid=demo,ou=people,dc=example,dc=com"
    ],
    "sn":[
        "demo"
    ],
    "cn":[
        "demo"
    ],
    "modifyTimestamp":[
        "20151006213634Z"
    ],
    "createTimestamp":[
        "20151005134244Z"
    ]
}</em></pre>
          <p> As shown in the example, OpenAM returns the JSON representation of the profile on success. On failure, OpenAM returns a JSON representation of the error including the <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>. See also <a class="xref" href="#rest-api-status-codes" title="2.1.1.10.&nbsp;REST Status Codes">Section&nbsp;2.1.1.10, "REST Status Codes"</a> for more information. </p>
         </div>
        </div>
        <div class="section" id="rest-api-crud-realm">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.5.2.&nbsp;Realm Management</h4>
           </div>
          </div>
         </div>
         <a class="indexterm" name="d14232e8778"></a>
         <p> This section shows how to create, read, update, and delete realms using the RESTful APIs: </p>
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p> Under the <code class="literal">/json/realms</code> endpoint, you find the newer JSON-based API: </p>
            <div class="itemizedlist">
             <p>The following sections cover this JSON-based API.</p>
             <ul class="itemizedlist" style="list-style-type: circle; ">
              <li class="listitem"><p><a class="xref" href="#rest-api-parameters-realm" title="2.1.5.2.1.&nbsp;Default Parameters for Realms">Section&nbsp;2.1.5.2.1, "Default Parameters for Realms"</a></p></li>
              <li class="listitem"><p><a class="xref" href="#rest-api-create-realm" title="2.1.5.2.2.&nbsp;Creating Realms">Section&nbsp;2.1.5.2.2, "Creating Realms"</a></p></li>
              <li class="listitem"><p><a class="xref" href="#rest-api-read-realm" title="2.1.5.2.3.&nbsp;Reading Realms">Section&nbsp;2.1.5.2.3, "Reading Realms"</a></p></li>
              <li class="listitem"><p><a class="xref" href="#rest-api-list-realm" title="2.1.5.2.4.&nbsp;Listing Realms">Section&nbsp;2.1.5.2.4, "Listing Realms"</a></p></li>
              <li class="listitem"><p><a class="xref" href="#rest-api-update-realm" title="2.1.5.2.5.&nbsp;Updating Realms">Section&nbsp;2.1.5.2.5, "Updating Realms"</a></p></li>
              <li class="listitem"><p><a class="xref" href="#rest-api-delete-realm" title="2.1.5.2.6.&nbsp;Deleting Realms">Section&nbsp;2.1.5.2.6, "Deleting Realms"</a></p></li>
             </ul>
            </div></li>
          </ul>
         </div>
         <div class="section" id="rest-api-parameters-realm">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.5.2.1.&nbsp;Default Parameters for Realms</h5>
            </div>
           </div>
          </div>
          <p> Realms have a number of fields entered with the default loading. The following table provides information on what the default realm settings are, and whether they can be updated, added, or deleted when updating a realm. </p>
          <div class="table" id="realm-parameter">
           <div class="table-title">
            Table&nbsp;2.10.&nbsp;Realm Parameters for JSON-based API
           </div>
           <div class="table-contents">
            <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Realm Parameters for JSON-based API" width="100%" border="0">
             <colgroup>
              <col width="33%">
              <col width="33%">
              <col width="34%">
             </colgroup>
             <thead>
              <tr>
               <th>Realm Parameter</th>
               <th>Default</th>
               <th>Purpose</th>
              </tr>
             </thead>
             <tbody>
              <tr>
               <td>realm</td>
               <td>None - the only required field to add a realm</td>
               <td><p>The name of the realm</p> <p>Example: <code class="literal">myRealm</code></p></td>
              </tr>
              <tr>
               <td>sunOrganizationStatus</td>
               <td>Active</td>
               <td><p>The status of the realm</p> <p><code class="literal">Active</code> or <code class="literal">Inactive</code></p></td>
              </tr>
              <tr>
               <td>sunOrganizationAliases</td>
               <td>None</td>
               <td> <p> Any applicable aliases associated with the realm. Be aware that an alias can only be used once. Entering an alias used by another realm will remove the alias from that realm and you will lose configuration. </p> <p>Example: <code class="literal">opensso.example.com</code></p></td>
              </tr>
              <tr>
               <td>serviceNames</td>
               <td><code class="literal">sunAMAuthHOTPService</code> <code class="literal">iPlanetAMAuthConfiguration</code> <code class="literal">sunAMAuthFederationService</code> <code class="literal">sunIdentityRepositoryService</code> <code class="literal">iPlanetAMPolicyConfigService</code> <code class="literal">iPlanetAMAuthService</code> <code class="literal">iPlanetAMAuthLDAPService</code> <code class="literal">sunAMAuthDataStoreService</code> <code class="literal">sunAMAuthSAEService</code> <code class="literal">sunAMDelegationService</code> <code class="literal">sunAMAuthWSSAuthModuleService</code> <code class="literal">iPlanetAMAuthOATHService</code> </td>
               <td>Services needed for the realm, including authentication modules</td>
              </tr>
             </tbody>
            </table>
           </div>
          </div>
          <br class="table-break">
         </div>
         <div class="section" id="rest-api-create-realm">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.5.2.2.&nbsp;Creating Realms</h5>
            </div>
           </div>
          </div>
          <p> OpenAM lets administrators create a realm by making an HTTP POST of the JSON representation of the profile to <code class="literal">/json/realms/?_action=create</code>. </p>
          <p> You can create realms using an HTTP POST of the JSON representation of the profile to <code class="literal">/json/realms/?_action=create</code>, as shown in the following example. The only required data field is <code class="literal">realm</code>: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "iplanetDirectoryPro: AQIC5w...2NzEz*" \
 --header "Content-Type: application/json" \
 --data '{ "realm": "myRealm" }' \
 https://openam.example.com:8443/openam/json/realms/?_action=create</strong>
<em class="computeroutput">{"realmCreated":"/myRealm"}</em>
   </pre>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p> Do not use the names of OpenAM REST endpoints as the name of a realm. The OpenAM REST endpoint names that should not be used includes: users, groups, realms, policies and applications. </p>
           </div>
          </div>
          <p> You can also set the <code class="literal">sunOrganizationAliases</code> parameter, but it can only be assigned to one realm (usually the top level realm). Before setting this parameter, make sure it is not already assigned elsewhere. If you remove it from another realm, you will lose your configuration. </p>
          <p> Alternatively, administrators can create realms by the specific realm name using the HTTP PUT of the JSON representation of the changes to <code class="literal">/json/realms/<em class="replaceable">realm-id</em></code>, as shown in the following example: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request PUT \
 --header "If-None-Match: *" \
 --header "iplanetDirectoryPro: AQIC5w...2NzEz*" \
 --header "Content-Type: application/json" \
 --data '{ }' \
 https://openam.example.com:8443/openam/json/realms/myRealm</strong>
<em class="computeroutput">
 {
  "realmCreated": "/myRealm"
 }
</em>
   </pre>
          <p> OpenAM returns an HTTP 201 Created status code, and the JSON representation of the realm on success. On failure, OpenAM returns a JSON representation of the error including the <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>. For example, if the <code class="literal">If-None-Match</code> header with a value of <code class="literal">*</code> is absent, an HTTP 404 Not Found status code is returned. </p>
         </div>
         <div class="section" id="rest-api-read-realm">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.5.2.3.&nbsp;Reading Realms</h5>
            </div>
           </div>
          </div>
          <p> OpenAM lets administrators read realms by requesting an HTTP GET on <code class="literal">/json/realms/<em class="replaceable">realm-id</em></code>. This allows administrators to review all active realm services for the realm, like policy configuration and modules. If users or administrators see missing information (such as Active status) or incorrect information, they can write down the correct information and add it using <a class="xref" href="#rest-api-update-realm" title="2.1.5.2.5.&nbsp;Updating Realms">Section&nbsp;2.1.5.2.5, "Updating Realms"</a>. </p>
          <p> The following example shows an administrator receiving information about a realm called <code class="literal">myRealm</code>: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iplanetDirectoryPro: AQIC5w...2NzEz*" \
 https://openam.example.com:8443/openam/json/realms/myRealm</strong>
<em class="computeroutput">{
    "serviceNames":[
      "sunAMAuthHOTPService",
      "iPlanetAMAuthConfiguration",
      "sunAMAuthFederationService",
      "sunIdentityRepositoryService",
      "iPlanetAMPolicyConfigService",
      "iPlanetAMAuthService",
      "iPlanetAMAuthLDAPService",
      "sunAMAuthDataStoreService",
      "sunAMAuthSAEService",
      "sunAMDelegationService",
      "sunAMAuthWSSAuthModuleService",
      "iPlanetAMAuthOATHService"
    ]
}</em>
   </pre>
          <p> As shown in the example, OpenAM returns the JSON representation of the profile on success. On failure, OpenAM returns a JSON representation of the error including the <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>. </p>
          <p> To read the top-level realm, use <code class="literal">toplevelrealm</code> with the <code class="literal">realms</code> endpoint: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iplanetDirectoryPro: AQIC5w...2NzEz*" \
 https://openam.example.com:8443/openam/json/realms/toplevelrealm</strong>
<em class="computeroutput">{
      "serviceNames" : [
       "sunAMAuthFederationService",
       "sunEntitlementIndexes",
       "iPlanetAMAuthService",
       "sunAMAuthDataStoreService",
       "sunAMAuthWSSAuthModuleService",
       "sunAMDelegationService",
       "iPlanetAMAuthOATHService",
       "iPlanetAMAuthConfiguration",
       "sunAMAuthHOTPService",
       "sunIdentityRepositoryService",
       "iPlanetAMPolicyConfigService",
       "iPlanetAMAuthLDAPService",
       "sunEntitlementService",
       "iPlanetAMPolicyService",
       "sunAMAuthSAEService",
       "AgentService" ]
}</em>
   </pre>
          <p> If the realm you want to read is not an immediate subrealm of the top-level realm, specify its parent realm to the left of <code class="literal">realms</code> in the URL, and specify the realm's final qualifier to the right of <code class="literal">realms</code>. For example, to read the <code class="literal">/myRealm/myRealmsChildRealm</code> realm: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iplanetDirectoryPro: AQIC5w...2NzEz*" \
 https://openam.example.com:8443/openam/json/myRealm/realms/myRealmsChildRealm</strong>
<em class="computeroutput">{
      "serviceNames" : [
       "sunAMAuthHOTPService",
       "iPlanetAMAuthConfiguration",
       "sunAMAuthFederationService",
       "sunIdentityRepositoryService",
       "iPlanetAMPolicyConfigService",
       "iPlanetAMAuthService",
       "iPlanetAMAuthLDAPService",
       "sunAMAuthDataStoreService",
       "sunAMAuthSAEService",
       "sunAMDelegationService",
       "sunAMAuthWSSAuthModuleService",
       "iPlanetAMAuthOATHService"
      ]
}</em>
   </pre>
         </div>
         <div class="section" id="rest-api-list-realm">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.5.2.4.&nbsp;Listing Realms</h5>
            </div>
           </div>
          </div>
          <p> To list a realm and its subrealms, perform an HTTP GET on the endpoint, set the <code class="literal">_queryFilter</code> query string parameter as in the following example, which lists the top-level realm and all of its subrealms: </p>
          <pre class="cmdline prettyprint nohighlight">
 $ <strong class="userinput">curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/realms?_queryFilter=true</strong>
 <em class="computeroutput">{
     "result" : [ "/", "/myRealm", "/myRealm/myRealmsChildRealm" ],
     "resultCount" : 3,
     "pagedResultsCookie" : null,
     "remainingPagedResults" : -1
 }</em>
   </pre>
          <p> You can start listing realms from below the top-level realm by placing the starting realm name in the URL. The following example lists the realm <code class="literal">myRealm</code> and all of its subrealms: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/myRealm/realms?_queryFilter=true</strong>
 <em class="computeroutput">{
     "result" : [ "/myRealm", "/myRealm/myRealmsChildRealm" ],
     "resultCount" : 2,
     "pagedResultsCookie" : null,
     "remainingPagedResults" : -1
 }</em>
   </pre>
         </div>
         <div class="section" id="rest-api-update-realm">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.5.2.5.&nbsp;Updating Realms</h5>
            </div>
           </div>
          </div>
          <p> OpenAM lets administrators update realms. To update a realm, do an HTTP PUT of the JSON representation of the changes to <code class="literal">/json/realms/<em class="replaceable">realm-id</em></code>. </p>
          <p> The following example shows how to update a realm called <code class="literal">myRealm</code>. The example command sets the realm's status to Inactive: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request PUT \
 --header "iplanetDirectoryPro: AQIC5...Y3MTAx*" \
 --header "Content-Type: application/json" \
 --data '{ "sunOrganizationStatus": "Inactive" }' \
 https://openam.example.com:8443/openam/json/realms/myRealm</strong>
   </pre>
          <p> OpenAM returns the JSON representation of the profile on success. On failure, OpenAM returns a JSON representation of the error including the <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>. </p>
         </div>
         <div class="section" id="rest-api-delete-realm">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">2.1.5.2.6.&nbsp;Deleting Realms</h5>
            </div>
           </div>
          </div>
          <p> OpenAM lets administrators delete a realm by making an HTTP DELETE call to <code class="literal">/json/realms/<em class="replaceable">realm-id</em></code>. </p>
          <p> The following example deletes a realm called <code class="literal">myRealm</code>. The top level realm cannot be deleted. Only administrators should delete realms. The name of the realm is the only field required to delete the realm. </p>
          <p> Make sure that you do not have any information you need within a realm before deleting it. Once a realm is deleted, the only way to restore it is to return to a backed up deployment of OpenAM: </p>
          <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request DELETE \
 --header "iplanetDirectoryPro: AQIC5w...2NzEz*" \
 https://openam.example.com:8443/openam/json/realms/myRealm</strong>
<em class="computeroutput">{"success":"true"}</em>
   </pre>
          <p> On success, OpenAM returns a JSON object indicating success. On failure, OpenAM returns a JSON representation of the error including the <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>. </p>
          <p> If the realm you want to delete is not an immediate subrealm of the top-level realm, specify its parent realm to the left of <code class="literal">realms</code> in the URL, and specify the realm's final qualifier to the right of <code class="literal">realms</code>. For example, to delete the <code class="literal">/myRealm/myRealmsChildRealm</code> realm: </p>
          <pre class="cmdline prettyprint nohighlight">
 $ <strong class="userinput">curl \
 --request DELETE
 --header "iplanetDirectoryPro: AQIC5w...2NzEz*" \
 https://openam.example.com:8443/openam/json/myRealm/realms/myRealmsChildRealm</strong>
 <em class="computeroutput">{ "success":"true" }</em>
   </pre>
         </div>
        </div>
       </div>
       <div class="section" id="sec-manage-scripts-rest">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">2.1.6.&nbsp;RESTful Script Management</h3>
          </div>
         </div>
        </div>
        <a class="indexterm" name="d14232e9156"></a>
        <p>This section shows you how to manage scripts used for client-side and server-side scripted authentication, custom policy conditions, and handling OpenID Connect claims by using the REST API.</p>
        <p>For information on managing scripts by using the OpenAM console, see <a href="../admin-guide/index.html#chap-manage-scripts" class="olink">Chapter&nbsp;22, "Managing Scripts"</a> in the <em>Administration Guide</em>. For information on configuring script settings, see <a href="../reference/index.html#scripting-configuration" class="olink">Section&nbsp;1.4.17, "Scripting"</a> in the <em>Reference</em>.</p>
        <div class="itemizedlist">
         <p>OpenAM provides the <code class="literal">scripts</code> REST endpoint for the following:</p>
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p><a class="xref" href="#rest-api-scripts-query" title="2.1.6.1.&nbsp;Querying Scripts">Section&nbsp;2.1.6.1, "Querying Scripts"</a></p></li>
          <li class="listitem"><p><a class="xref" href="#rest-api-scripts-read" title="2.1.6.2.&nbsp;Reading a Script">Section&nbsp;2.1.6.2, "Reading a Script"</a></p></li>
          <li class="listitem"><p><a class="xref" href="#rest-api-scripts-validate" title="2.1.6.3.&nbsp;Validating a Script">Section&nbsp;2.1.6.3, "Validating a Script"</a></p></li>
          <li class="listitem"><p><a class="xref" href="#rest-api-scripts-create" title="2.1.6.4.&nbsp;Creating a Script">Section&nbsp;2.1.6.4, "Creating a Script"</a></p></li>
          <li class="listitem"><p><a class="xref" href="#rest-api-scripts-update" title="2.1.6.5.&nbsp;Updating a Script">Section&nbsp;2.1.6.5, "Updating a Script"</a></p></li>
          <li class="listitem"><p><a class="xref" href="#rest-api-scripts-delete" title="2.1.6.6.&nbsp;Deleting a Script">Section&nbsp;2.1.6.6, "Deleting a Script"</a></p></li>
         </ul>
        </div>
        <p> User-created scripts are realm-specific, hence the URI for the scripts' API can contain a realm component, such as <code class="literal">/json{<em class="replaceable">/realm</em>}/scripts</code>. If the realm is not specified in the URI, the top level realm is used.</p>
        <div class="panel panel-success">
         <div class="panel-heading">
          <h3 class="panel-title">Tip</h3>
         </div>
         <div class="panel-body">
          <p>OpenAM includes some global example scripts that can be used in any realm.</p>
         </div>
        </div>
        <p> Scripts are represented in JSON and take the following form. Scripts are built from standard JSON objects and values (strings, numbers, objects, sets, arrays, <code class="literal">true</code>, <code class="literal">false</code>, and <code class="literal">null</code>). Each script has a system-generated <em class="firstterm">universally unique identifier</em> (UUID), which must be used when modifying existing scripts. Renaming a script will not affect the UUID: </p>
        <pre class="codelisting prettyprint json">{
    "_id": "7e3d7067-d50f-4674-8c76-a3e13a810c33",
    "name": "Scripted Module - Server Side",
    "description": "Default global script for server side Scripted Authentication Module",
    "script": "dmFyIFNUQVJUX1RJ...",
    "language": "JAVASCRIPT",
    "context": "AUTHENTICATION_SERVER_SIDE",
    "createdBy": "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "creationDate": 1433147666269,
    "lastModifiedBy": "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedDate": 1433147666269
}</pre>
        <div class="variablelist">
         <p> The values for the fields shown in the example above are explained below: </p>
         <dl class="variablelist">
          <dt>
           <span class="term"><code class="literal">_id</code></span>
          </dt>
          <dd>
           <p> The UUID that OpenAM generates for the script. </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">name</code></span>
          </dt>
          <dd>
           <p> The name provided for the script. </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">description</code></span>
          </dt>
          <dd>
           <p> An optional text string to help identify the script. </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">script</code></span>
          </dt>
          <dd>
           <p> The source code of the script. The source code is in UTF-8 format and encoded into Base64. </p>
           <p>For example, a script such as the following: </p>
           <pre class="codelisting prettyprint JavaScript">var a = 123;
var b = 456;</pre>
           <p>When encoded into Base64 becomes:</p>
           <pre class="codelisting prettyprint JavaScript">dmFyIGEgPSAxMjM7IA0KdmFyIGIgPSA0NTY7</pre>
          </dd>
          <dt>
           <span class="term"><code class="literal">language</code></span>
          </dt>
          <dd>
           <p> The language the script is written in - <code class="literal">JAVASCRIPT</code> or <code class="literal">GROOVY</code>. </p>
           <div class="table" id="d14232e9275">
            <div class="table-title">
             Table&nbsp;2.11.&nbsp;Language Support per Context
            </div>
            <div class="table-contents">
             <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Language Support per Context" border="0">
              <colgroup>
               <col class="c1" width="50%">
               <col class="c2" width="50%">
              </colgroup>
              <thead>
               <tr>
                <th>Script Context</th>
                <th>Supported Languages</th>
               </tr>
              </thead>
              <tbody>
               <tr>
                <td><code class="literal">POLICY_CONDITION</code></td>
                <td><code class="literal">JAVASCRIPT</code>, <code class="literal">GROOVY</code></td>
               </tr>
               <tr>
                <td><code class="literal">AUTHENTICATION_SERVER_SIDE</code></td>
                <td><code class="literal">JAVASCRIPT</code>, <code class="literal">GROOVY</code></td>
               </tr>
               <tr>
                <td><code class="literal">AUTHENTICATION_CLIENT_SIDE</code></td>
                <td><code class="literal">JAVASCRIPT</code></td>
               </tr>
               <tr>
                <td><code class="literal">OIDC_CLAIMS</code></td>
                <td><code class="literal">JAVASCRIPT</code>, <code class="literal">GROOVY</code></td>
               </tr>
              </tbody>
             </table>
            </div>
           </div>
           <br class="table-break">
          </dd>
          <dt>
           <span class="term"><code class="literal">context</code></span>
          </dt>
          <dd>
           <p> The context type of the script. </p>
           <p>Supported values are:</p>
           <div class="variablelist">
            <dl class="variablelist">
             <dt>
              <span class="term"><code class="literal">POLICY_CONDITION</code></span>
             </dt>
             <dd>
              <p>Policy Condition</p>
             </dd>
             <dt>
              <span class="term"><code class="literal">AUTHENTICATION_SERVER_SIDE</code></span>
             </dt>
             <dd>
              <p>Server-side Authentication</p>
             </dd>
             <dt>
              <span class="term"><code class="literal">AUTHENTICATION_CLIENT_SIDE</code></span>
             </dt>
             <dd>
              <p>Client-side Authentication</p>
              <div class="panel panel-info">
               <div class="panel-heading">
                <h3 class="panel-title">Note</h3>
               </div>
               <div class="panel-body">
                <p>Client-side scripts must be written in JavaScript.</p>
               </div>
              </div>
             </dd>
             <dt>
              <span class="term"><code class="literal">OIDC_CLAIMS</code></span>
             </dt>
             <dd>
              <p>OIDC Claims</p>
             </dd>
            </dl>
           </div>
          </dd>
          <dt>
           <span class="term"><code class="literal">createdBy</code></span>
          </dt>
          <dd>
           <p> A string containing the universal identifier DN of the subject that created the script. </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">creationDate</code></span>
          </dt>
          <dd>
           <p> An integer containing the creation date and time, in ISO 8601 format. </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">lastModifiedBy</code></span>
          </dt>
          <dd>
           <p> A string containing the universal identifier DN of the subject that most recently updated the resource type. </p>
           <p>If the script has not been modified since it was created, this property will have the same value as <code class="literal">createdBy</code>.</p>
          </dd>
          <dt>
           <span class="term"><code class="literal">lastModifiedDate</code></span>
          </dt>
          <dd>
           <p> A string containing the last modified date and time, in ISO 8601 format. </p>
           <p>If the script has not been modified since it was created, this property will have the same value as <code class="literal">creationDate</code>. </p>
          </dd>
         </dl>
        </div>
        <div class="section" id="rest-api-scripts-query">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.6.1.&nbsp;Querying Scripts</h4>
           </div>
          </div>
         </div>
         <p> To list all the scripts in a realm, as well as any global scripts, perform an HTTP GET to the <code class="literal">/json{<em class="replaceable">/realm</em>}/scripts</code> endpoint with a <code class="literal">_queryFilter</code> parameter set to <code class="literal">true</code>. </p>
         <div class="panel panel-info">
          <div class="panel-heading">
           <h3 class="panel-title">Note</h3>
          </div>
          <div class="panel-body">
           <p>If the realm is not specified in the URL, OpenAM returns scripts in the top level realm, as well as any global scripts.</p>
          </div>
         </div>
         <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation: </p>
         <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
https://openam.example.com:8443/openam/json/myrealm/scripts?_queryFilter=true</strong>
<em class="computeroutput">{
  "result": [
    {
      "_id": "9de3eb62-f131-4fac-a294-7bd170fd4acb",
      "name": "Scripted Policy Condition",
      "description": "Default global script for Scripted Policy Conditions",
      "script": "LyoqCiAqIFRoaXMg...",
      "language": "JAVASCRIPT",
      "context": "POLICY_CONDITION",
      "createdBy": "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
      "creationDate": 1433147666269,
      "lastModifiedBy": "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
      "lastModifiedDate": 1433147666269
    },
    {
      "_id": "7e3d7067-d50f-4674-8c76-a3e13a810c33",
      "name": "Scripted Module - Server Side",
      "description": "Default global script for server side Scripted Authentication Module",
      "script": "dmFyIFNUQVJUX1RJ...",
      "language": "JAVASCRIPT",
      "context": "AUTHENTICATION_SERVER_SIDE",
      "createdBy": "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
      "creationDate": 1433147666269,
      "lastModifiedBy": "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
      "lastModifiedDate": 1433147666269
    }
  ],
  "resultCount": 2,
  "pagedResultsCookie": null,
  "remainingPagedResults": -1
}</em></pre>
         <p> Additional query strings can be specified to alter the returned results. For more information, see <a class="xref" href="#rest-api-filter-sort-page" title="2.1.1.6.&nbsp;Filtering, Sorting, and Paging Results">Section&nbsp;2.1.1.6, "Filtering, Sorting, and Paging Results"</a>. </p>
         <div class="table" id="d14232e9441">
          <div class="table-title">
           Table&nbsp;2.12.&nbsp;Supported _queryFilter Fields and Operators
          </div>
          <div class="table-contents">
           <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Supported _queryFilter Fields and
     Operators" border="0">
            <colgroup>
             <col width="50%">
             <col width="50%">
            </colgroup>
            <thead>
             <tr>
              <th>Field</th>
              <th>Supported Operators</th>
             </tr>
            </thead>
            <tbody>
             <tr>
              <td><code class="literal">_id</code></td>
              <td> Equals (<code class="literal">eq</code>), Contains (<code class="literal">co</code>), Starts with (<code class="literal">sw</code>) </td>
             </tr>
             <tr>
              <td><code class="literal">name</code></td>
              <td> Equals (<code class="literal">eq</code>), Contains (<code class="literal">co</code>), Starts with (<code class="literal">sw</code>) </td>
             </tr>
             <tr>
              <td><code class="literal">description</code></td>
              <td> Equals (<code class="literal">eq</code>), Contains (<code class="literal">co</code>), Starts with (<code class="literal">sw</code>) </td>
             </tr>
             <tr>
              <td><code class="literal">script</code></td>
              <td> Equals (<code class="literal">eq</code>), Contains (<code class="literal">co</code>), Starts with (<code class="literal">sw</code>) </td>
             </tr>
             <tr>
              <td><code class="literal">language</code></td>
              <td> Equals (<code class="literal">eq</code>), Contains (<code class="literal">co</code>), Starts with (<code class="literal">sw</code>) </td>
             </tr>
             <tr>
              <td><code class="literal">context</code></td>
              <td> Equals (<code class="literal">eq</code>), Contains (<code class="literal">co</code>), Starts with (<code class="literal">sw</code>) </td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
         <br class="table-break">
        </div>
        <div class="section" id="rest-api-scripts-read">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.6.2.&nbsp;Reading a Script</h4>
           </div>
          </div>
         </div>
         <p> To read an individual script in a realm, perform an HTTP GET using the <code class="literal">/json{<em class="replaceable">/realm</em>}/scripts</code> endpoint, specifying the UUID in the URL. </p>
         <div class="panel panel-success">
          <div class="panel-heading">
           <h3 class="panel-title">Tip</h3>
          </div>
          <div class="panel-body">
           <p>To read a script in the top-level realm, or to read a built-in global script, do not specify a realm in the URL.</p>
          </div>
         </div>
         <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation: </p>
         <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
https://openam.example.com:8443/openam/json/myrealm/scripts/9de3eb62-f131-4fac-a294-7bd170fd4acb</strong>
<em class="computeroutput">{
    "_id": "9de3eb62-f131-4fac-a294-7bd170fd4acb",
    "name": "Scripted Policy Condition",
    "description": "Default global script for Scripted Policy Conditions",
    "script": "LyoqCiAqIFRoaXMg...",
    "language": "JAVASCRIPT",
    "context": "POLICY_CONDITION",
    "createdBy": "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "creationDate": 1433147666269,
    "lastModifiedBy": "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedDate": 1433147666269
}</em></pre>
        </div>
        <div class="section" id="rest-api-scripts-validate">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.6.3.&nbsp;Validating a Script</h4>
           </div>
          </div>
         </div>
         <p> To validate a script, perform an HTTP POST using the <code class="literal">/json{<em class="replaceable">/realm</em>}/scripts</code> endpoint, with an <code class="literal">_action</code> parameter set to <code class="literal">validate</code>. Include a JSON representation of the script and the script language, <code class="literal">JAVASCRIPT</code> or <code class="literal">GROOVY</code>, in the POST data. </p>
         <p>The value for <code class="literal">script</code> must be in UTF-8 format and then encoded into Base64.</p>
         <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation: </p>
         <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
--header "Content-Type: application/json" \
--request POST \
--data '{
    "script": "dmFyIGEgPSAxMjM7dmFyIGIgPSA0NTY7Cg==",
    "language": "JAVASCRIPT"
}' \
https://openam.example.com:8443/openam/json/myrealm/scripts/?_action=validate</strong>
<em class="computeroutput">{
  "success": true
}</em></pre>
         <p>If the script is valid the JSON response contains a <code class="literal">success</code> key with a value of <code class="literal">true</code>.</p>
         <p>If the script is invalid the JSON response contains a <code class="literal">success</code> key with a value of <code class="literal">false</code>, and an indication of the problem and where it occurs, as shown below:</p>
         <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
--header "Content-Type: application/json" \
--request POST \
--data '{
    "script": "dmFyIGEgPSAxMjM7dmFyIGIgPSA0NTY7ID1WQUxJREFUSU9OIFNIT1VMRCBGQUlMPQo=",
    "language": "JAVASCRIPT"
}' \
https://openam.example.com:8443/openam/json/myrealm/scripts/?_action=validate</strong>
<em class="computeroutput">{
    "success": false,
    "errors": [
        {
            "line": 1,
            "column": 27,
            "message": "syntax error"
        }
    ]
}</em></pre>
        </div>
        <div class="section" id="rest-api-scripts-create">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.6.4.&nbsp;Creating a Script</h4>
           </div>
          </div>
         </div>
         <p> To create a script in a realm, perform an HTTP POST using the <code class="literal">/json{<em class="replaceable">/realm</em>}/scripts</code> endpoint, with an <code class="literal">_action</code> parameter set to <code class="literal">create</code>. Include a JSON representation of the script in the POST data. </p>
         <p>The value for <code class="literal">script</code> must be in UTF-8 format and then encoded into Base64.</p>
         <div class="panel panel-info">
          <div class="panel-heading">
           <h3 class="panel-title">Note</h3>
          </div>
          <div class="panel-body">
           <p>If the realm is not specified in the URL, OpenAM creates the script in the top level realm.</p>
          </div>
         </div>
         <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation: </p>
         <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
--header "Content-Type: application/json" \
--request POST \
--data '{
    "name": "MyJavaScript",
    "script": "dmFyIGEgPSAxMjM7CnZhciBiID0gNDU2Ow==",
    "language": "JAVASCRIPT",
    "context": "POLICY_CONDITION",
    "description": "An example script"
}' \
https://openam.example.com:8443/openam/json/myrealm/scripts/?_action=create</strong>
<em class="computeroutput">{
    "_id": "0168d494-015a-420f-ae5a-6a2a5c1126af",
    "name": "MyJavaScript",
    "description": "An example script",
    "script": "dmFyIGEgPSAxMjM7CnZhciBiID0gNDU2Ow==",
    "language": "JAVASCRIPT",
    "context": "POLICY_CONDITION",
    "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "creationDate": 1436807766258,
    "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedDate": 1436807766258
}</em></pre>
        </div>
        <div class="section" id="rest-api-scripts-update">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.6.5.&nbsp;Updating a Script</h4>
           </div>
          </div>
         </div>
         <p> To update an individual script in a realm, perform an HTTP PUT using the <code class="literal">/json{<em class="replaceable">/realm</em>}/scripts </code> endpoint, specifying the UUID in both the URL and the PUT body. Include a JSON representation of the updated script in the PUT data, alongside the UUID. </p>
         <div class="panel panel-info">
          <div class="panel-heading">
           <h3 class="panel-title">Note</h3>
          </div>
          <div class="panel-body">
           <p>If the realm is not specified in the URL, OpenAM uses the top level realm.</p>
          </div>
         </div>
         <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation: </p>
         <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
--header "Content-Type: application/json" \
--request PUT \
--data '{
    "name": "MyUpdatedJavaScript",
    "script": "dmFyIGEgPSAxMjM7CnZhciBiID0gNDU2Ow==",
    "language": "JAVASCRIPT",
    "context": "POLICY_CONDITION",
    "description": "An updated example script configuration"
}' \
https://openam.example.com:8443/openam/json/myrealm/scripts/0168d494-015a-420f-ae5a-6a2a5c1126af</strong>
<em class="computeroutput">{
    "_id": "0168d494-015a-420f-ae5a-6a2a5c1126af",
    "name": "MyUpdatedJavaScript",
    "description": "An updated example script configuration",
    "script": "dmFyIGEgPSAxMjM7CnZhciBiID0gNDU2Ow==",
    "language": "JAVASCRIPT",
    "context": "POLICY_CONDITION",
    "createdBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "creationDate": 1436807766258,
    "lastModifiedBy": "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
    "lastModifiedDate": 1436808364681
}</em></pre>
        </div>
        <div class="section" id="rest-api-scripts-delete">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.6.6.&nbsp;Deleting a Script</h4>
           </div>
          </div>
         </div>
         <p> To delete an individual script in a realm, perform an HTTP DELETE using the <code class="literal">/json{<em class="replaceable">/realm</em>}/scripts</code> endpoint, specifying the UUID in the URL. </p>
         <div class="panel panel-info">
          <div class="panel-heading">
           <h3 class="panel-title">Note</h3>
          </div>
          <div class="panel-body">
           <p>If the realm is not specified in the URL, OpenAM uses the top level realm.</p>
          </div>
         </div>
         <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an Administrator user who has access to perform the operation: </p>
         <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--request DELETE \
--header "iPlanetDirectoryPro: AQIC5..." \
https://openam.example.com:8443/openam/json/myrealm/scripts/0168d494-015a-420f-ae5a-6a2a5c1126af</strong>
<em class="computeroutput">{}</em></pre>
        </div>
       </div>
       <div lang="en" class="section" id="sec-rest-api-recording">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">2.1.7.&nbsp;RESTful Troubleshooting Information Recording</h3>
          </div>
         </div>
        </div>
        <a class="indexterm" name="d14232e9731"></a>
        <p> This section shows you how to start, stop, and get the status of a troubleshooting recording event using the REST API. </p>
        <div class="itemizedlist">
         <p> OpenAM provides the <code class="literal">/json/records</code> REST endpoint for the following: </p>
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p> <span class="bold"><strong>Starting a recording event.</strong></span> See <a class="xref" href="#rest-api-records-start" title="2.1.7.1.&nbsp;Starting a Recording Event">Section&nbsp;2.1.7.1, "Starting a Recording Event"</a>. </p></li>
          <li class="listitem"><p> <span class="bold"><strong>Getting the status of a recording event.</strong></span> See <a class="xref" href="#rest-api-records-get-status" title="2.1.7.2.&nbsp;Getting the Status of a Recording Event">Section&nbsp;2.1.7.2, "Getting the Status of a Recording Event"</a>. </p></li>
          <li class="listitem"><p> <span class="bold"><strong>Stopping a recording event.</strong></span> See <a class="xref" href="#rest-api-records-stop" title="2.1.7.3.&nbsp;Stopping a Recording Event">Section&nbsp;2.1.7.3, "Stopping a Recording Event"</a>. </p></li>
         </ul>
        </div>
        <p> You must authenticate to OpenAM as an administrative user to obtain an SSO token prior to calling the <code class="literal">/json/records</code> REST endpoint. You then pass the SSO token in the <code class="literal">iPlanetDirectoryPro</code> header as proof of authentication. </p>
        <p> You can also record troubleshooting information by using the <span class="command"><strong>ssoadm</strong></span> command. For more information, see <a href="../admin-guide/index.html#recording" class="olink">Section&nbsp;24.5, "Recording Troubleshooting Information"</a> in the <em>Administration Guide</em>. </p>
        <div class="panel panel-info">
         <div class="panel-heading">
          <h3 class="panel-title">Note</h3>
         </div>
         <div class="panel-body">
          <p> The <span class="command"><strong>curl</strong></span> command output in the examples in this section is indented for ease of reading. The actual output is <span class="emphasis"><em>not</em></span> indented, and the actions available from the <code class="literal">/json/records</code> endpoint do not support the <code class="literal">_prettyPrint</code> parameter. </p>
         </div>
        </div>
        <div class="section" id="rest-api-records-start">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.7.1.&nbsp;Starting a Recording Event</h4>
           </div>
          </div>
         </div>
         <p> To start a recording event, perform an HTTP POST using the <code class="literal">/json/records</code> endpoint, specifying the <code class="literal">_action=start</code> parameter in the URL. Specify a JSON payload identical in format to the input file for the <span class="command"><strong>ssoadm start-recording</strong></span> command, as described in <a href="../admin-guide/index.html#recording-json" class="olink">Section&nbsp;24.5.2, "The Recording Control File"</a> in the <em>Administration Guide</em>: </p>
         <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
--header "Content-Type: application/json" \
--request POST \
--data ' {
  "issueID": 103572,
  "referenceID": "policyEvalFails",
  "description": "Troubleshooting artifacts in support of case 103572",
  "zipEnable": true,
  "configExport": {
   "enable": true,
   "password": "5x2RR70",
   "sharePassword": false
  },
  "debugLogs": {
   "debugLevel": "MESSAGE",
   "autoStop": {
    "time":  {
     "timeUnit": "SECONDS",
     "value": 15
    },
    "fileSize": {
     "sizeUnit": "GB",
     "value": 1
    }
   }
  },
  "threadDump" : {
   "enable": true,
   "delay" :  {
    "timeUnit": "SECONDS",
    "value": 5
   }
  }
 }' \
https://openam.example.com:8443/openam/json/records?_action=start</strong>
<em class="computeroutput">
{
 "recording":true,
 "record":{
  "issueID":103572,
  "referenceID":"policyEvalFails",
  "description":"Troubleshooting artifacts in support of case 103572",
  "zipEnable":true,
  "threadDump":{
   "enable":true,
   "delay":{
    "timeUnit":"SECONDS",
    "value":5
   }
  },
  "configExport":{
   "enable":true,
   "password":"xxxxxx",
   "sharePassword":false
  },
  "debugLogs":{
   "debugLevel":"message",
   "autoStop":{
    "time":{
     "timeUnit":"MILLISECONDS",
     "value":15000
    },
    "fileSize":{
     "sizeUnit":"KB",
     "value":1048576
    }
   }
  },
  "status":"RUNNING",
  "folder":"/opt/demo/openam/config/openam/debug/record/103572/policyEvalFails/"
 }
}</em></pre>
        </div>
        <div class="section" id="rest-api-records-get-status">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.7.2.&nbsp;Getting the Status of a Recording Event</h4>
           </div>
          </div>
         </div>
         <p> To get the status of a recording event, perform an HTTP POST using the <code class="literal">/json/records</code> endpoint, specifying the <code class="literal">_action=status</code> parameter in the URL: </p>
         <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
--header "Content-Type: application/json" \
--request POST \
https://openam.example.com:8443/openam/json/records?_action=status</strong></pre>
         <p> If there is no active recording event, the following output appears: </p>
         <pre class="cmdline prettyprint nohighlight"><em class="computeroutput">{
  "recording":false
}</em></pre>
         <p> If there is an active recording event, output similar to the following appears: </p>
         <pre class="cmdline prettyprint nohighlight"><em class="computeroutput">{
 "recording":true,
 "record":{
  "issueID":103572,
  "referenceID":"policyEvalFails",
  "description":"Troubleshooting artifacts in support of case 103572",
  "zipEnable":true,
  "threadDump":{
   "enable":true,
   "delay":{
    "timeUnit":"SECONDS",
    "value":5
   }
  },
  "configExport":{
   "enable":true,
   "password":"xxxxxx",
   "sharePassword":false
  },
  "debugLogs":{
   "debugLevel":"message",
   "autoStop":{
    "time":{
     "timeUnit":"MILLISECONDS",
     "value":15000
    },
    "fileSize":{
     "sizeUnit":"KB",
     "value":1048576
    }
   }
  },
  "status":"RUNNING",
  "folder":"/opt/demo/openam/config/openam/debug/record/103572/policyEvalFails/"
 }
}</em></pre>
        </div>
        <div class="section" id="rest-api-records-stop">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.1.7.3.&nbsp;Stopping a Recording Event</h4>
           </div>
          </div>
         </div>
         <p> To stop a recording event, perform an HTTP POST using the <code class="literal">/json/records</code> endpoint, specifying the <code class="literal">_action=stop</code> parameter in the URL: </p>
         <pre class="cmdline prettyprint nohighlight">$ <strong class="userinput">curl \
--header "iPlanetDirectoryPro: AQIC5..." \
--header "Content-Type: application/json" \
--request POST \
https://openam.example.com:8443/openam/json/records?_action=stop</strong></pre>
         <p> If there is no active recording event, OpenAM returns a 400 error code. </p>
         <p> If there is an active recording event, output similar to the following appears: </p>
         <pre class="cmdline prettyprint nohighlight"><em class="computeroutput">{
 "recording":false,
 "record":{
  "issueID":103572,
  "referenceID":"policyEvalFails",
  "description":"Troubleshooting artifacts in support of case 103572",
  "zipEnable":true,
  "threadDump":{
   "enable":true,
   "delay":{
    "timeUnit":"SECONDS",
    "value":5
   }
  },
  "configExport":{
   "enable":true,
   "password":"xxxxxx",
   "sharePassword":false
  },
  "debugLogs":{
   "debugLevel":"message",
   "autoStop":{
    "time":{
     "timeUnit":"MILLISECONDS",
     "value":15000
    },
    "fileSize":{
     "sizeUnit":"KB",
     "value":1048576
    }
   }
  },
  "status":"STOPPED",
  "folder":"/opt/demo/openam/config/openam/debug/record/103572/policyEvalFails/"
 }
}</em></pre>
        </div>
       </div>
      </div>
      <div class="section" id="sec-sdk">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">2.2.&nbsp;Using the OpenAM Java SDK</h2>
         </div>
        </div>
       </div>
       <p>This section introduces OpenAM Java SDK. OpenAM Java SDK is delivered with the full version of OpenAM, <code class="filename">OpenAM-13.0.0.zip</code>.</p>
       <div class="section" id="install-sdk-samples">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">2.2.1.&nbsp;Installing OpenAM Client SDK Samples</h3>
          </div>
         </div>
        </div>
        <a class="indexterm" name="d14232e9883"></a>
        <p>The full OpenAM download, <code class="filename">OpenAM-13.0.0.zip</code>, contains the Java Client SDK library, <code class="filename">ClientSDK-13.0.0.jar</code>, as well as samples for use on the command line in <code class="filename">ExampleClientSDK-CLI-13.0.0.zip</code>, and samples in a web application, <code class="filename">ExampleClientSDK-WAR-13.0.0.war</code>. The <a class="link" href="https://backstage.forgerock.com/static/docs/openam/13/apidocs/" target="_blank"><em class="citetitle">OpenAM Java SDK API Specification</em></a> provides a reference to the public APIs.</p>
        <div class="procedure" id="deploy-client-sdk-war">
         <div class="procedure-inner">
          <div class="procedure-title">
           Procedure&nbsp;2.9.&nbsp;To Deploy the Sample Web Application
          </div>
          <p>The sample web application deploys in your container to show you the client SDK samples in action.</p>
          <ol class="procedure" type="1">
           <li class="step"><p>Deploy the .war in your Java web application container such as Apache Tomcat or JBoss.</p><pre class="cmdline prettyprint nohighlight">
     $ <strong class="userinput">cp ExampleClientSDK-WAR-13.0.0.war /path/to/tomcat/webapps/client.war</strong>
    </pre></li>
           <li class="step"><p> If you have run this procedure before, make sure to deploy a fresh copy of the .war file to a different location, such as <code class="filename">/path/to/tomcat/webapps/client1.war</code> </p></li>
           <li class="step"><p>Browse to the location where you deployed the client, and configure the application to access OpenAM using the application user name, <code class="literal">UrlAccessAgent</code>, and password configured when you set up OpenAM.</p>
            <div class="mediaobject" align="center" id="figure-config-client-sdk-war">
             <a class="fancybox" href="images/config-client-sdk-war.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_config-client-sdk-war.png" align="middle" alt="Sample web app configuration screen" title="The sample web application configuration screen lets you
      configure access to OpenAM."></a>
            </div>
            <div class="variablelist">
             <p>Use the following hints to complete the configuration.</p>
             <dl class="variablelist">
              <dt>
               <span class="term">Server Protocol</span>
              </dt>
              <dd>
               <p>Protocol to access OpenAM (<code class="literal">http</code> or <code class="literal">https</code>)</p>
              </dd>
              <dt>
               <span class="term">Server Host</span>
              </dt>
              <dd>
               <p>Fully qualified domain name for OpenAM, such as <code class="literal">openam.example.com</code></p>
              </dd>
              <dt>
               <span class="term">Server Port</span>
              </dt>
              <dd>
               <p>OpenAM port number such as 8080 or 8443</p>
              </dd>
              <dt>
               <span class="term">Server Deployment URI</span>
              </dt>
              <dd>
               <p>URI entry point to OpenAM such as <code class="literal">/openam</code></p>
              </dd>
              <dt>
               <span class="term">Debug directory</span>
              </dt>
              <dd>
               <p>Where to write the debug messages for the client samples</p>
              </dd>
              <dt>
               <span class="term">Application user name</span>
              </dt>
              <dd>
               <p>An user agent configured to access OpenAM, such as <code class="literal">UrlAccessAgent</code> set up when OpenAM was installed</p>
              </dd>
              <dt>
               <span class="term">Application user password</span>
              </dt>
              <dd>
               <p>The user agent password</p>
              </dd>
             </dl>
            </div><p>The sample client writes configuration information under <code class="filename">$HOME/OpenAMClient/</code>, where $HOME is that of the user running the web application container.</p></li>
           <li class="step"><p>Verify that you have properly configured the sample web application.</p>
            <ol type="a" class="substeps">
             <li class="step"><p>In another browser tab page of the same browser instance, login to OpenAM as the OpenAM Administrator, <code class="literal">amadmin</code>.</p><p>This signs you into OpenAM, storing the cookie in your browser.</p></li>
             <li class="step"><p>On the Samples tab page, click the link under Single Sign On Token Verification Servlet.</p><p>If the sample web application is properly configured, you should see something like the following text in your browser.</p><pre class="codelisting prettyprint none">SSOToken host name: 127.0.0.1
       SSOToken Principal name: id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org
       Authentication type used: DataStore
       IPAddress of the host: 127.0.0.1
       SSO Token validation test succeeded
       The token id is AQIC5...CMDEAAlNLABQtODY0Mjc5MDUwNDQzOTA2MzYxNg..*
       ...
       User Attributes: {... givenName=[amAdmin], ...roles=[Top-level Admin Role], ...}</pre></li>
            </ol></li>
          </ol>
         </div>
        </div>
        <div class="procedure" id="build-cli-samples">
         <div class="procedure-inner">
          <div class="procedure-title">
           Procedure&nbsp;2.10.&nbsp;To Build the Command-Line Sample Applications
          </div>
          <p>Follow these steps to set up the command-line examples.</p>
          <ol class="procedure" type="1">
           <li class="step"><p>Unpack the sample applications and related libraries.</p><pre class="cmdline prettyprint nohighlight">
     $ <strong class="userinput">mkdir sdk &amp;&amp; cd sdk</strong>
     $ <strong class="userinput">unzip ~/Downloads/ExampleClientSDK-CLI-13.0.0.zip</strong>
    </pre></li>
           <li class="step"><p>Configure the samples to access OpenAM.</p><pre class="cmdline prettyprint nohighlight">
     $ <strong class="userinput">sh scripts/setup.sh</strong>
     <em class="computeroutput">Debug directory (make sure this directory exists):</em> <strong class="userinput">/Users/me/openam/openam/debug</strong>
     <em class="computeroutput">Application user (e.g. URLAccessAgent) password:</em> <strong class="userinput">secret12</strong>
     <em class="computeroutput">Protocol of the server:</em> <strong class="userinput">http</strong>
     <em class="computeroutput">Host name of the server:</em> <strong class="userinput">openam.example.com</strong>
     <em class="computeroutput">Port of the server:</em> <strong class="userinput">8080</strong>
     <em class="computeroutput">Server's deployment URI:</em> <strong class="userinput">openam</strong>
     <em class="computeroutput">Naming URL (hit enter to accept default value,
      http://openam.example.com:8080/openam/namingservice):</em>
     $</pre></li>
           <li class="step"><p>Verify that you have properly configured the samples.</p><pre class="cmdline prettyprint nohighlight">
     $ <strong class="userinput">sh scripts/Login.sh</strong>
     <em class="computeroutput">Realm (e.g. /):</em> <strong class="userinput">/</strong>
     <em class="computeroutput">Login module name (e.g. DataStore or LDAP):</em> <strong class="userinput">DataStore</strong>
     <em class="computeroutput">Login locale (e.g. en_US or fr_FR):</em> <strong class="userinput">fr_FR</strong>
     <em class="computeroutput">DataStore: Obtained login context</em>
     <em class="computeroutput">Nom d'utilisateur :</em><strong class="userinput">demo</strong>
     <em class="computeroutput">Mot de passe :</em><strong class="userinput">changeit</strong>
     <em class="computeroutput">Login succeeded.
      Logged Out!!</em></pre></li>
          </ol>
         </div>
        </div>
       </div>
       <div class="section" id="about-sdk">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">2.2.2.&nbsp;About the OpenAM Java SDK</h3>
          </div>
         </div>
        </div>
        <div class="itemizedlist">
         <p>After installing the Java SDK command line samples, you see the following content.</p>
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p><code class="filename">lib/</code>: SDK and other libraries</p></li>
          <li class="listitem"><p><code class="filename">resources/</code>: properties configuration files for the SDK and samples</p></li>
          <li class="listitem"><p><code class="filename">scripts/</code>: scripts to run the samples</p></li>
          <li class="listitem"><p><code class="filename">source/</code>: sample code</p></li>
         </ul>
        </div>
        <p>After deploying the Java SDK web application archive, you find the following content where the .war file was unpacked.</p>
        <div class="itemizedlist">
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p><code class="filename">META-INF/</code>: build information</p></li>
          <li class="listitem"><p><code class="filename">WEB-INF/</code>: sample classes and libraries</p></li>
          <li class="listitem"><p><code class="filename">console/</code>: images for sample UI</p></li>
          <li class="listitem"><p><code class="filename">index.html</code>: sample home page</p></li>
          <li class="listitem"><p><code class="filename">keystore.jks</code>: OpenAM test certificate, alias: <code class="literal">test</code>, keystore password: <code class="literal">changeit</code></p></li>
          <li class="listitem"><p><code class="filename">policy/</code>: Policy Evaluator Client Sample page</p></li>
          <li class="listitem"><p><code class="filename">saml2/</code>: Secure Attribute Exchange example</p></li>
          <li class="listitem"><p><code class="filename">sample.css</code>: sample styles</p></li>
          <li class="listitem"><p><code class="filename">sm/</code>: Service Configuration sample</p></li>
          <li class="listitem"><p><code class="filename">um/</code>: User Profile sample</p></li>
         </ul>
        </div>
        <div class="itemizedlist" id="sdk-shutdown-hooks">
         <div class="itemizedlist-title">
          Registering Your Java SDK Client to Shut Down Gracefully
         </div>
         <p>When writing a client using the OpenAM Java SDK, make sure you register hooks to make sure the application can be shut down gracefully. How you register for shutdown depends on the type of application.</p>
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p>For Java EE applications, make sure the OpenAM client SDK shuts down successfully by including the following context listener in your application's <code class="filename">web.xml</code> file.</p><pre class="codelisting prettyprint xml">&lt;listener&gt;
     &lt;listener-class&gt;
     com.sun.identity.common.ShutdownServletContextListener
     &lt;/listener-class&gt;
     &lt;/listener&gt;</pre></li>
          <li class="listitem"><p>For standalone applications, set the following JVM property.</p><pre class="literallayout">-Dopenam.runtime.shutdown.hook.enabled=true</pre></li>
         </ul>
        </div>
       </div>
       <div class="section" id="sec-authentication">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">2.2.3.&nbsp;Authenticating Using OpenAM Java SDK</h3>
          </div>
         </div>
        </div>
        <a class="indexterm" name="d14232e10237"></a>
        <p>This section looks at authentication with the OpenAM Java SDK and at the sample client, <code class="filename">Login.java</code>, which demonstrates authenticating to OpenAM from a client application, provided a realm, user name, and password. This is the sample you ran to test installation of the command-line SDK samples. The class shown in this section is <code class="literal">com.sun.identity.samples.authentication.Login</code>.</p>
        <p>Before you continue, make sure that the packages described in <a class="xref" href="#install-sdk-samples" title="2.2.1.&nbsp;Installing OpenAM Client SDK Samples">Section&nbsp;2.2.1, "Installing OpenAM Client SDK Samples"</a> are installed.</p>
        <div class="orderedlist">
         <p>With OpenAM, your client application performs the following steps to handle authentication.</p>
         <ol class="orderedlist" type="1">
          <li class="listitem"><p>Sets up an <code class="literal">AuthContext</code>, based on the realm in which the user authenticates.</p></li>
          <li class="listitem"><p>Starts the login process by calling the <code class="literal">AuthContext</code> <code class="literal">login()</code> method.</p></li>
          <li class="listitem"><p>Handling authentication callbacks to retrieve credentials from the user who is authenticating.</p><p>Your application loops through the authentication callbacks by using the <code class="literal">AuthContext</code> <code class="literal">getRequirements()</code> and <code class="literal">hasMoreRequirements()</code> methods. Each time it finishes populating a callback with the credentials retrieved, your application calls <code class="literal">submitRequirements()</code> to send the credentials to OpenAM's Authentication Service.</p></li>
          <li class="listitem"><p>After handling all authentication callbacks, your application calls the <code class="literal">AuthContext</code> <code class="literal">getStatus()</code> method.</p><p>On login success, OpenAM sets up an SSO token that holds information about the authentication, and also about the user's environment and session.</p></li>
          <li class="listitem"><p>When the user logs out, your application can end the session by calling the <code class="literal">AuthContext</code> <code class="literal">logout()</code> method.</p></li>
         </ol>
        </div>
        <p>The <code class="literal">AuthContext</code> class is provided by the <code class="literal">com.sun.identity.authentication</code> package, part of the OpenAM client API. Callback classes are provided by the <code class="literal">javax.security.auth.callback</code> package, which provides callbacks for choices, confirmations, locales, names, passwords, text input, and text output.</p>
        <p>See the <a class="link" href="https://backstage.forgerock.com/static/docs/openam/13/apidocs/" target="_blank"><em class="citetitle">OpenAM Public API JavaDoc</em></a> for reference.</p>
        <p>As the sample client gets the realm (called organization in the sample), locale, and authentication module to set up the authentication context, there is not need for a language callback to get the local afterwards. The <code class="filename">Login.java</code> example does, however, show simple ways of handling callbacks for the command-line context. The implementation of the sample client follows.</p>
        <pre class="codelisting prettyprint java">package com.sun.identity.samples.authentication;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.io.IOException;
import javax.security.auth.callback.Callback;
import javax.security.auth.callback.ChoiceCallback;
import javax.security.auth.callback.NameCallback;
import javax.security.auth.callback.PasswordCallback;
import javax.security.auth.callback.TextInputCallback;
import javax.security.auth.callback.TextOutputCallback;
import javax.security.auth.callback.UnsupportedCallbackException;
import com.sun.identity.authentication.AuthContext;
import com.sun.identity.authentication.spi.AuthLoginException;
import com.sun.identity.shared.debug.Debug;

public class Login {
    private String loginIndexName;
    private String orgName;
    private String locale;
    
    private Login(String loginIndexName, String orgName) {
        this.loginIndexName = loginIndexName;
        this.orgName = orgName;
    }
    
    private Login(String loginIndexName, String orgName, String locale) {
        this.loginIndexName = loginIndexName;
        this.orgName = orgName;
        this.locale = locale;
    }
    
    protected AuthContext getAuthContext()
        throws AuthLoginException {
        AuthContext lc = new AuthContext(orgName);
        AuthContext.IndexType indexType = AuthContext.IndexType.MODULE_INSTANCE;
        if (locale == null || locale.length() == 0) {
            lc.login(indexType, loginIndexName);
        } else {
            lc.login(indexType, loginIndexName, locale);
        }
        debugMessage(loginIndexName + ": Obtained login context");
        return lc;
    }
    
    private void addLoginCallbackMessage(Callback[] callbacks)
    throws UnsupportedCallbackException {
        int i = 0;
        try {
            for (i = 0; i &lt; callbacks.length; i++) {
                if (callbacks[i] instanceof TextOutputCallback) {
                    handleTextOutputCallback((TextOutputCallback)callbacks[i]);
                } else if (callbacks[i] instanceof NameCallback) {
                    handleNameCallback((NameCallback)callbacks[i]);
                } else if (callbacks[i] instanceof PasswordCallback) {
                    handlePasswordCallback((PasswordCallback)callbacks[i]);
                } else if (callbacks[i] instanceof TextInputCallback) {
                    handleTextInputCallback((TextInputCallback)callbacks[i]);
                } else if (callbacks[i] instanceof ChoiceCallback) {
                    handleChoiceCallback((ChoiceCallback)callbacks[i]);
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
            throw new UnsupportedCallbackException(callbacks[i],e.getMessage());
        }
    }
    
    private void handleTextOutputCallback(TextOutputCallback toc) {
        debugMessage("Got TextOutputCallback");
        // display the message according to the specified type
        
        switch (toc.getMessageType()) {
            case TextOutputCallback.INFORMATION:
                debugMessage(toc.getMessage());
                break;
            case TextOutputCallback.ERROR:
                debugMessage("ERROR: " + toc.getMessage());
                break;
            case TextOutputCallback.WARNING:
                debugMessage("WARNING: " + toc.getMessage());
                break;
            default:
                debugMessage("Unsupported message type: " +
                    toc.getMessageType());
        }
    }
    
    private void handleNameCallback(NameCallback nc)
        throws IOException {
        // prompt the user for a username
        System.out.print(nc.getPrompt());
        System.out.flush();
        nc.setName((new BufferedReader
            (new InputStreamReader(System.in))).readLine());
    }
    
    private void handleTextInputCallback(TextInputCallback tic)
        throws IOException {
        // prompt for text input
        System.out.print(tic.getPrompt());
        System.out.flush();
        tic.setText((new BufferedReader
            (new InputStreamReader(System.in))).readLine());
    }
    
    private void handlePasswordCallback(PasswordCallback pc)
        throws IOException {
        // prompt the user for sensitive information
        System.out.print(pc.getPrompt());
        System.out.flush();
        String passwd = (new BufferedReader(new InputStreamReader(System.in))).
            readLine();
        pc.setPassword(passwd.toCharArray());
    }
    
    private void handleChoiceCallback(ChoiceCallback cc)
        throws IOException {
        // ignore the provided defaultValue
        System.out.print(cc.getPrompt());
        
        String[] strChoices = cc.getChoices();
        for (int j = 0; j &lt; strChoices.length; j++) {
            System.out.print("choice[" + j + "] : " + strChoices[j]);
        }
        System.out.flush();
        cc.setSelectedIndex(Integer.parseInt((new BufferedReader
            (new InputStreamReader(System.in))).readLine()));
    }
    
    protected boolean login(AuthContext lc)
        throws UnsupportedCallbackException {
        boolean succeed = false;
        Callback[] callbacks = null;
        
        // get information requested from module
        while (lc.hasMoreRequirements()) {
            callbacks = lc.getRequirements();
            if (callbacks != null) {
                addLoginCallbackMessage(callbacks);
                lc.submitRequirements(callbacks);
            }
        }
        
        if (lc.getStatus() == AuthContext.Status.SUCCESS) {
            System.out.println("Login succeeded.");
            succeed = true;
        } else if (lc.getStatus() == AuthContext.Status.FAILED) {
            System.out.println("Login failed.");
        } else {
            System.out.println("Unknown status: " + lc.getStatus());
        }
        
        return succeed;
    }
    
    protected void logout(AuthContext lc)
        throws AuthLoginException {
        lc.logout();
        System.out.println("Logged Out!!");
    }
    
    static void debugMessage(String msg) {
        System.out.println(msg);
    }
    
    public static void main(String[] args) {
        try {
            System.out.print("Realm (e.g. /): ");
            String orgName = (new BufferedReader(
                new InputStreamReader(System.in))).readLine();

            System.out.print("Login module name (e.g. DataStore or LDAP): ");
            String moduleName = (new BufferedReader(
                new InputStreamReader(System.in))).readLine();
            
            System.out.print("Login locale (e.g. en_US or fr_FR): ");
            String locale = (new BufferedReader(
                new InputStreamReader(System.in))).readLine();
            
            Login login = new Login(moduleName, orgName, locale);
            AuthContext lc = login.getAuthContext();
            if (login.login(lc)) {
                login.logout(lc);
            }
        } catch (IOException e) {
            e.printStackTrace();
        } catch (AuthLoginException e) {
            e.printStackTrace();
        } catch (UnsupportedCallbackException e) {
            e.printStackTrace();
        }
        System.exit(0);
    }
}</pre>
        <div class="section" id="encoding-pwds">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.2.3.1.&nbsp;Encoding Passwords and Password Reset Questions and Answers</h4>
           </div>
          </div>
         </div>
         <p> OpenAM uses symmetric encryption algorithms to encrypt and decrypt stored passwords, so that they can be retrieved or modified at later date if necessary. The OpenAM Java SDK provides the capability to encode passwords using the <code class="literal">EncodeAction</code> class in standalone applications. For example, you can encrypt and decrypt a password as follows: </p>
         <pre class="codelisting prettyprint java">String plainText = "helloworld";
   String encrypted = AccessController.doPrivileged(new EncodeAction(plainText));
   String decrypted = AccessController.doPrivileged(new DecodeAction(encrypted));
   assert plainText.equals(decrypted);</pre>
         <p> To use this class, you must ensure that the symmetric encryption key has the same value as configured in the server instances. You can run <code class="literal">ssoadm</code> to retrieve the password encryption key as follows: </p>
         <pre class="cmdline prettyprint nohighlight">
   ssoadm am.encryption.pwd
  </pre>
         <p> Next, in your application's <code class="literal">AMConfig.properties</code> file, replace the <code class="literal">@ENCRYPTION_KEY@</code> with the value of the password encryption key. The property ensures that OpenAM can decrypt the password. </p>
         <pre class="cmdline prettyprint nohighlight">
   am.encryption.pwd=@ENCRYPTION_KEY@
  </pre>
         <p> OpenAM's password reset question and answer also uses symmetric key encryption in its configuration. You can use the <code class="literal">encodeAction</code> class to encrypt a password reset question and answer: </p>
         <pre class="codelisting prettyprint nohighlight">
   String encrypted = AccessController.doPrivileged(new EncodeAction(question + "\t" + \
   answer "+" "1"));
  </pre>
         <p>The last number in the previous example indicates whether the question/answer is enabled or disabled:</p>
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p>0 = default question/answer that is disabled</p></li>
           <li class="listitem"><p>1 = default question/answer that is enabled</p></li>
           <li class="listitem"><p>2 = personal question/answer that is disabled</p></li>
           <li class="listitem"><p>3 = personal question/answer that is enabled</p></li>
          </ul>
         </div>
         <p> To encrypt or decrypt the password reset question and answer, you must retrieve the password encryption key using <code class="literal">ssoadm am.encryption.key</code>, and then set the <code class="literal">am.encryption.key</code> property with the value of the password encryption key in the <code class="literal">AMConfig.properties</code> file. </p>
         <p> For additional information, see <a class="link" href="https://backstage.forgerock.com/static/docs/openam/13/apidocs/index.html?com/sun/identity/security/EncodeAction.html" target="_blank"><em class="citetitle">EncodeAction</em></a>. </p>
        </div>
       </div>
       <div class="section" id="sec-session">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">2.2.4.&nbsp;Handling Single Sign-On Using OpenAM Java SDK</h3>
          </div>
         </div>
        </div>
        <a class="indexterm" name="d14232e10407"></a>
        <p>This section looks at handling session tokens with the OpenAM Java SDK. The class shown in this section is <code class="literal">com.sun.identity.samples.sso.SSOTokenSample</code>.</p>
        <p>When a user authenticates successfully, OpenAM sets up a single sign-on (SSO) session for the user. The session is associated with an SSO token that holds information about the authentication, and also about the user's environment and session. OpenAM deletes the session when the authentication context <code class="literal">logout()</code> method is called, or when a session timeout is reached. At that point the SSO token is no longer valid.</p>
        <p>Before you continue, make sure that the packages described in the <a class="xref" href="#install-sdk-samples" title="2.2.1.&nbsp;Installing OpenAM Client SDK Samples">Section&nbsp;2.2.1, "Installing OpenAM Client SDK Samples"</a> chapter are installed.</p>
        <p>When your application has an <code class="literal">AuthContext</code> after successful authentication, you can retrieve the SSO token from the context. You also can get the token as shown in the sample client by passing an SSO token ID from OpenAM to an <code class="literal">SSOTokenManager</code>.</p>
        <p>If your application needs to be notified of changes, you can register an <code class="literal">SSOTokenListener</code> on the token by using the token's <code class="literal">addSSOTokenListener()</code> method. OpenAM then calls your <code class="literal">SSOTokenListener</code> <code class="literal">ssoTokenChanged()</code> method when the session times out, is disposed of, or has a property that changes. Applications can receive notifications about changes to <span class="emphasis"><em>stateful sessions only</em></span>. Adding an <code class="literal">SSOTokenListener</code> for a stateless session token does <span class="emphasis"><em>not</em></span> generate notifications. </p>
        <p>The sample client takes an SSO token ID to get the token from OpenAM, and then displays some information from the SSO token. The implementation of the sample client follows.</p>
        <pre class="codelisting prettyprint java">package com.sun.identity.samples.sso;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.io.IOException;
import java.net.InetAddress;
import com.iplanet.sso.SSOException;
import com.iplanet.sso.SSOToken;
import com.iplanet.sso.SSOTokenID;
import com.iplanet.sso.SSOTokenManager;

public class SSOTokenSample {
    private SSOTokenManager manager;
    private SSOToken token;

    private SSOTokenSample(String tokenID)
        throws SSOException
    {
        if (validateToken(tokenID)) {
            setGetProperties(token);
        }
    }

    private boolean validateToken(String tokenID)
        throws SSOException
    {
        boolean validated = false;
        manager = SSOTokenManager.getInstance();
        token = manager.createSSOToken(tokenID);

        // isValid method returns true for valid token.
        if (manager.isValidToken(token)) {
                // let us get all the values from the token
            String host = token.getHostName();
            java.security.Principal principal = token.getPrincipal();
            String authType = token.getAuthType();
            int level = token.getAuthLevel();
            InetAddress ipAddress = token.getIPAddress();
            long maxTime = token.getMaxSessionTime();
            long idleTime = token.getIdleTime();
            long maxIdleTime = token.getMaxIdleTime();
                
            System.out.println("SSOToken host name: " + host);
            System.out.println("SSOToken Principal name: " +
                principal.getName());
            System.out.println("Authentication type used: " + authType);
            System.out.println("IPAddress of the host: " +
                ipAddress.getHostAddress());
            validated = true;
        }

        return validated;
    }

    private void setGetProperties(SSOToken token)
        throws SSOException
    {
        /*
         * Validate the token again, with another method
         * if token is invalid, this method throws an exception
         */
        manager.validateToken(token);
        System.out.println("SSO Token validation test Succeeded.");
            
        // Get the SSOTokenID associated with the token and print it.
        SSOTokenID id = token.getTokenID();
        String tokenId = id.toString();
        System.out.println("Token ID: " + tokenId);

        // Set and get properties in the token.
        token.setProperty("TimeZone", "PST");
        token.setProperty("County", "SantaClara");
        String tZone = token.getProperty("TimeZone");
        String county = token.getProperty("County");

        System.out.println("Property: TimeZone: " + tZone); 
        System.out.println("Property: County: " + county); 
    }

    public static void main(String[] args) {
        try {
            System.out.print("Enter SSOToken ID: ");
            String ssoTokenID = (new BufferedReader(
                new InputStreamReader(System.in))).readLine();
            new SSOTokenSample(ssoTokenID.trim());
        } catch (SSOException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }
        System.exit(0);
    }

}</pre>
        <p>Before you run the script that calls the sample, authenticate to OpenAM in order to have OpenAM generate the SSO token ID. To see the SSO token ID, use the RESTful <code class="literal">authenticate</code> command as shown in the following example, or alternatively run the <code class="literal">SSOTokenSampleServlet</code> web-based sample.</p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --data "username=demo&amp;password=changeit" \
 http://openam.example.com:8080/openam/identity/authenticate</strong>
<em class="computeroutput">token.id=AQIC5wM2LY4Sfcyy10grl...AlNLABQtNjI4OTkyNTUxNTc4MDQ3NzEzOQ..*</em>
$ <strong class="userinput">sh scripts/SSOTokenSample.sh</strong>
<em class="computeroutput">Enter SSOToken ID:</em> <strong class="userinput">AQIC5wM2LY4Sfcyy10grl...AlNLABQtNjI4OTkyNTUxNTc4MDQ3NzEzOQ..*</strong>
<em class="computeroutput">SSOToken host name: 172.16.203.239
SSOToken Principal name: id=demo,ou=user,dc=openam,dc=forgerock,dc=org
Authentication type used: DataStore
IPAddress of the host: 172.16.203.239
SSO Token validation test Succeeded.
Token ID: AQIC5wM2LY4Sfcyy10grl...AlNLABQtNjI4OTkyNTUxNTc4MDQ3NzEzOQ..*
Property: TimeZone: PST
Property: County: SantaClara</em>
 </pre>
        <p>Notice both the properties populated by OpenAM, and also the two properties, <code class="literal">TimeZone</code> and <code class="literal">County</code>, that are set by the sample client.</p>
        <div class="section" id="session-receiving-notifications">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">2.2.4.1.&nbsp;Receiving Notifications</h4>
           </div>
          </div>
         </div>
         <p>If your application implements a listener for change notification, such as a <code class="literal">SessionListener</code> to handle notification when a stateful session is invalidated, then you must configure the following settings in the <code class="filename">AMConfig.properties</code> configuration file for your application.</p>
         <div class="variablelist">
          <dl class="variablelist">
           <dt>
            <span class="term">com.iplanet.am.notification.url</span>
           </dt>
           <dd>
            <p>Set this parameter to <code class="literal">http://<em class="replaceable">host</em>:<em class="replaceable">port</em>/<em class="replaceable">context</em>/notificationservice</code>.</p>
           </dd>
           <dt>
            <span class="term">com.iplanet.am.sdk.caching.enabled</span>
           </dt>
           <dd>
            <p>Set this parameter to <code class="literal">true</code>.</p>
           </dd>
           <dt>
            <span class="term">com.iplanet.am.serverMode</span>
           </dt>
           <dd>
            <p>Set this parameter to <code class="literal">false</code>.</p>
           </dd>
           <dt>
            <span class="term">com.sun.identity.client.notification.url</span>
           </dt>
           <dd>
            <p>Set this parameter to <code class="literal">http://<em class="replaceable">host</em>:<em class="replaceable">port</em>/<em class="replaceable">context</em>/notificationservice</code>.</p>
           </dd>
           <dt>
            <span class="term">com.sun.identity.idm.cache.enabled</span>
           </dt>
           <dd>
            <p>Set this parameter to <code class="literal">true</code>.</p>
           </dd>
           <dt>
            <span class="term">com.sun.identity.idm.remote.notification.enabled</span>
           </dt>
           <dd>
            <p>Set this parameter to <code class="literal">true</code>.</p>
           </dd>
           <dt>
            <span class="term">com.sun.identity.sm.cache.enabled</span>
           </dt>
           <dd>
            <p>Set this parameter to <code class="literal">true</code>.</p>
           </dd>
           <dt>
            <span class="term">com.sun.identity.sm.enableDataStoreNotification</span>
           </dt>
           <dd>
            <p>Set this parameter to <code class="literal">true</code>.</p>
           </dd>
          </dl>
         </div>
         <p>The above configuration to access the notification service also applies for other types of listeners, such as <code class="literal">ServiceListener</code>, and <code class="literal">IdEventListener</code> implementations. See the <a class="link" href="https://backstage.forgerock.com/static/docs/openam/13/apidocs/" target="_blank"><em class="citetitle">OpenAM Java SDK API Specification</em></a> for details on the available listener interfaces.</p>
        </div>
       </div>
       <div class="section" id="sec-policy-decisions">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">2.2.5.&nbsp;Requesting Policy Decisions Using OpenAM Java SDK</h3>
          </div>
         </div>
        </div>
        <a class="indexterm" name="d14232e10616"></a>
        <p>This section shows how to request policy decision by using OpenAM Java SDK. The chapter focuses on the sample client, <code class="filename">source/samples/policy/PolicyEvaluationSample.java</code>, which demonstrates making a request to OpenAM for a policy decision about access to a web resource.</p>
        <p>Before you continue, make sure that the packages described in <a class="xref" href="#install-sdk-samples" title="2.2.1.&nbsp;Installing OpenAM Client SDK Samples">Section&nbsp;2.2.1, "Installing OpenAM Client SDK Samples"</a> are installed.</p>
        <p>OpenAM centralizes policy administration, policy evaluation, and policy decision making so that your applications do not have to do so. In many deployments, OpenAM policy agents and the Open Identity gateway can handle policy enforcement independently from your application code.</p>
        <p>If your application does need to request a policy decision from OpenAM, then your application can retrieve a <code class="literal">PolicyEvaluator</code> from a client-side <code class="literal">PolicyEvaluatorFactory</code>, and then call the <code class="literal">PolicyEvaluator</code> <code class="literal">getPolicyDecision()</code> method. For boolean decisions such as allow or deny, your application can also call the <code class="literal">isAllowed()</code> method.</p>
        <p>To make a policy decision, OpenAM needs an SSO token, the resource to access, the action the user wants to perform on the resource such as HTTP <code class="literal">GET</code> or <code class="literal">POST</code>, and a <code class="literal">Map</code> of environment settings you can use to specify conditions and attributes in the session or can pass back as an empty <code class="literal">Map</code> if your policy does not include conditions and response attributes.</p>
        <p>The <code class="literal">PolicyEvaluationSample</code> class takes as its configuration the user credentials, service name, resource, and action that you provide in a Java properties file. It then authenticates the user to get an SSO token using the <code class="filename">TokenUtils.java</code> helper methods. At that point it has sufficient information to request a policy decision.</p>
        <p>The implementation of the sample client follows.</p>
        <pre class="codelisting prettyprint java">package samples.policy;

import com.iplanet.sso.SSOToken;
import com.iplanet.sso.SSOTokenManager;

import com.sun.identity.policy.PolicyDecision;
import com.sun.identity.policy.client.PolicyEvaluator;
import com.sun.identity.policy.client.PolicyEvaluatorFactory;

import samples.policy.TokenUtils;

import java.util.Enumeration;
import java.util.HashMap;
import java.util.Map;
import java.util.HashSet;
import java.util.Properties;
import java.util.MissingResourceException;
import java.util.ResourceBundle;
import java.util.Set;

public class PolicyEvaluationSample {


    public PolicyEvaluationSample() {
    }

    public static void main(String[] args) throws Exception {
        PolicyEvaluationSample clientSample = new PolicyEvaluationSample();
        clientSample.runSample(args);
        System.exit(0);
    }

    public void runSample(String[] args) throws Exception {
        if (args.length == 0 || args.length &gt; 1) {
            System.out.println("Missing argument:"
                    + "properties file name not specified");
        } else {
            System.out.println("Using properties file:" + args[0]);
            Properties sampleProperties = getProperties(args[0]);
            SSOToken ssoToken = getSSOToken(
                (String)sampleProperties.get("user.name"),
                (String)sampleProperties.get("user.password")
            );
            getPolicyDecision(
                ssoToken,
                (String)sampleProperties.get("service.name"),
                (String)sampleProperties.get("resource.name"),
                (String)sampleProperties.get("action.name")
            );
        }
    }

    private SSOToken getSSOToken(
            String userName, String password) throws Exception {
        System.out.println("Entering getSSOToken():"
                + "userName=" + userName + ","
                + "password=" + password);
        SSOToken ssoToken = TokenUtils.getSessionToken("/",
                userName, password);
        System.out.println("TokenID:" + ssoToken.getTokenID().toString());
        System.out.println("returning from getSSOToken()");
        return ssoToken;
    }

    private void getPolicyDecision(
            SSOToken ssoToken,
            String serviceName,
            String resourceName,
            String actionName)
            throws Exception {

        System.out.println("Entering getPolicyDecision():"
                + "resourceName=" + resourceName + ","
                + "serviceName=" + serviceName + ","
                + "actionName=" + actionName);
        PolicyEvaluator pe = PolicyEvaluatorFactory.getInstance().
                    getPolicyEvaluator(serviceName);

        Map env = new HashMap();
        Set attrSet = new HashSet();
        Set actions = new HashSet();
        actions.add(actionName);
        PolicyDecision pd = pe.getPolicyDecision(ssoToken, resourceName,
                actions, env);
        System.out.println("policyDecision:" + pd.toXML());

        System.out.println("returning from getPolicyDecision()");
    }

    private Properties getProperties(String file)
      throws MissingResourceException {
        Properties properties = new Properties();
        ResourceBundle bundle = ResourceBundle.getBundle(file);
        Enumeration e = bundle.getKeys();
        System.out.println("sample properties:");
        while (e.hasMoreElements()) {
            String key = (String) e.nextElement();
            String value = bundle.getString(key);
            properties.put(key, value);
            System.out.println(key + ":" + value);
        }
        return properties;
    }
}</pre>
        <p>Before you run the script that calls the sample, edit the properties file, <code class="filename">resources/policyEvaluationSample.properties</code>, to indicate the user credentials, resource to access, and HTTP method to use. You can use a resource that might not exist for the purposes of this example, but you will need to set up a policy for that resource to get meaningful results.</p>
        <pre class="codelisting prettyprint java">user.name=demo
user.password=changeit
service.name=iPlanetAMWebAgentService
resource.name=http://www.example.com:80/banner.html
action.name=GET</pre>
        <p>Also, set up a policy in OpenAM that corresponds to the resource in question. You can set up the policy in OpenAM console under Realms &gt; <em class="replaceable">Realm Name</em> &gt; Authorization. Concerning the <em class="replaceable">Realm Name</em>, notice that unless you change the code, the sample uses the top-level realm, <code class="literal">/</code> to authenticate the user.</p>
        <p>With the properties configured and policy in place, get the decision from OpenAM using the script, <code class="filename">scripts/run-policy-evaluation-sample.sh</code>.</p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">sh scripts/run-policy-evaluation-sample.sh</strong>
<em class="computeroutput">Using properties file:policyEvaluationSample
sample properties:
user.password:changeit
service.name:iPlanetAMWebAgentService
user.name:demo
resource.name:http://www.example.com:80/banner.html
action.name:GET
------------------------------------------------------------------------------:
Entering getSSOToken():userName=demo,password=changeit
TokenID:AQIC5wM2LY4Sfcx3aQGFRKu5-r1a-Vfyjb...5ODM4NDY0MzE0ODYzODQ1*
returning from getSSOToken()
Entering getPolicyDecision():resourceName=http://www.example.com:80/banner.html,
 serviceName=iPlanetAMWebAgentService,actionName=GET
policyDecision:&lt;PolicyDecision&gt;
&lt;ResponseAttributes&gt;
&lt;/ResponseAttributes&gt;
&lt;ActionDecision timeToLive="9223372036854775807"&gt;
&lt;AttributeValuePair&gt;
&lt;Attribute name="GET"/&gt;
&lt;Value&gt;allow&lt;/Value&gt;
&lt;/AttributeValuePair&gt;
&lt;Advices&gt;
&lt;/Advices&gt;
&lt;/ActionDecision&gt;
&lt;/PolicyDecision&gt;

returning from getPolicyDecision()</em>
 </pre>
        <p>As you see, the policy decision response is formatted here as an XML document.<a href="#ftn.d14232e10710" class="footnote"><sup class="footnote" id="d14232e10710">[1]</sup></a> Notice here the line showing that OpenAM has allowed access to the resource.</p>
        <pre class="literallayout">&lt;Value&gt;allow&lt;/Value&gt;</pre>
       </div>
       <div class="section" id="sec-xacml">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">2.2.6.&nbsp;Requesting a XACML Policy Decision Using OpenAM Java SDK</h3>
          </div>
         </div>
        </div>
        <p>This section shows how to request a XACML policy decision with OpenAM Java SDK, using the sample client, <code class="filename">source/samples/xacml/XACMLClientSample.java</code>. The sample client relies on an OpenAM server acting as a policy decision point and another OpenAM server acting as a policy enforcement point.</p>
        <p>Before you continue, make sure that the packages described in the <a class="xref" href="#install-sdk-samples" title="2.2.1.&nbsp;Installing OpenAM Client SDK Samples">Section&nbsp;2.2.1, "Installing OpenAM Client SDK Samples"</a> chapter are installed.</p>
        <p>The sample client uses the XACML <code class="literal">ContextFactory</code> to create the XACML request. It then uses the <code class="literal">XACMLRequestProcessor</code> to get a decision as XACML <code class="literal">Response</code> from OpenAM. Most of the work in the sample is done setting up the request.</p>
        <p>The implementation of the <code class="literal">XACMLClientSample</code> class follows.</p>
        <pre class="codelisting prettyprint java">package samples.xacml;

import com.sun.identity.saml2.common.SAML2Exception;

import com.sun.identity.xacml.client.XACMLRequestProcessor;
import com.sun.identity.xacml.common.XACMLConstants;
import com.sun.identity.xacml.common.XACMLException;
import com.sun.identity.xacml.context.ContextFactory;
import com.sun.identity.xacml.context.Action;
import com.sun.identity.xacml.context.Attribute;
import com.sun.identity.xacml.context.Environment;
import com.sun.identity.xacml.context.Request;
import com.sun.identity.xacml.context.Resource;
import com.sun.identity.xacml.context.Response;
import com.sun.identity.xacml.context.Subject;

import java.net.URI;
import java.net.URISyntaxException;

import java.io.PrintWriter;

import java.util.ArrayList;
import java.util.Enumeration;
import java.util.List;
import java.util.MissingResourceException;
import java.util.Properties;
import java.util.ResourceBundle;

public class XACMLClientSample {


    public XACMLClientSample() {
    }

    public static void main(String[] args) throws Exception {
        XACMLClientSample clientSample = new XACMLClientSample();
        clientSample.runSample(args);
        System.exit(0);
    }

    public void runSample(String[] args) throws Exception {
        if (args.length == 0 || args.length &gt; 1) {
            System.out.println("Missing argument:"
                    + "properties file name not specified");
        } else {
            System.out.println("Using properties file:" + args[0]);
            Properties sampleProperties = getProperties(args[0]);
            testProcessRequest(
                (String)sampleProperties.get("pdp.entityId"),
                (String)sampleProperties.get("pep.entityId"),
                (String)sampleProperties.get("subject.id"),
                (String)sampleProperties.get("subject.id.datatype"),
                (String)sampleProperties.get("subject.category"),
                (String)sampleProperties.get("resource.id"),
                (String)sampleProperties.get("resource.id.datatype"),
                (String)sampleProperties.get("resource.servicename"),
                (String)sampleProperties.get("resource.servicename.datatype"),
                (String)sampleProperties.get("action.id"),
                (String)sampleProperties.get("action.id.datatype")
            );
        }
    }

    private void testProcessRequest(
            String pdpEntityId, String pepEntityId,
            String subjectId, String subjectIdType,
            String subjectCategory,
            String resourceId, String resourceIdType,
            String serviceName, String serviceNameType,
            String actionId, String actionIdType) 
            throws XACMLException, SAML2Exception, 
            URISyntaxException, Exception {

        Request xacmlRequest = createSampleXacmlRequest(
            subjectId, subjectIdType,
            subjectCategory,
            resourceId, resourceIdType,
            serviceName, serviceNameType,
            actionId, actionIdType); 

        System.out.println("\ntestProcessRequest():xacmlRequest:\n" 
                + xacmlRequest.toXMLString(true, true));

        Response xacmlResponse = XACMLRequestProcessor.getInstance()
                .processRequest(xacmlRequest, pdpEntityId, pepEntityId);

        System.out.println("testProcessRequest():xacmlResponse:\n"
                + xacmlResponse.toXMLString(true, true));
    }

    private Request createSampleXacmlRequest(
            String subjectId, String subjectIdType,
            String subjectCategory,
            String resourceId, String resourceIdType,
            String serviceName, String serviceNameType,
            String actionId, String actionIdType) 
            throws XACMLException, URISyntaxException {

        Request request = ContextFactory.getInstance().createRequest();

        //Subject
        Subject subject = ContextFactory.getInstance().createSubject();
        subject.setSubjectCategory(new URI(subjectCategory));

        //set subject id
        Attribute attribute = ContextFactory.getInstance().createAttribute();
        attribute.setAttributeId(new URI(XACMLConstants.SUBJECT_ID));
        attribute.setDataType(new URI(subjectIdType));
        List valueList = new ArrayList();
        valueList.add(subjectId); 
        attribute.setAttributeStringValues(valueList);
        List attributeList = new ArrayList();
        attributeList.add(attribute);
        subject.setAttributes(attributeList);


        //set Subject in Request
        List subjectList = new ArrayList();
        subjectList.add(subject);
        request.setSubjects(subjectList);

        //Resource
        Resource resource = ContextFactory.getInstance().createResource();

        //set resource id
        attribute = ContextFactory.getInstance().createAttribute();
        attribute.setAttributeId(new URI(XACMLConstants.RESOURCE_ID));
        attribute.setDataType( new URI(resourceIdType));
        valueList = new ArrayList();
        valueList.add(resourceId);
        attribute.setAttributeStringValues(valueList);
        attributeList = new ArrayList();
        attributeList.add(attribute);

        //set serviceName
        attribute = ContextFactory.getInstance().createAttribute();
        attribute.setAttributeId(new URI(XACMLConstants.TARGET_SERVICE));
        attribute.setDataType(new URI(serviceNameType));
        valueList = new ArrayList();
        valueList.add(serviceName);
        attribute.setAttributeStringValues(valueList);
        attributeList.add(attribute);
        resource.setAttributes(attributeList);

        //set Resource in Request
        List resourceList = new ArrayList();
        resourceList.add(resource);
        request.setResources(resourceList);

        //Action
        Action action = ContextFactory.getInstance().createAction();
        attribute = ContextFactory.getInstance().createAttribute();
        attribute.setAttributeId(new URI(XACMLConstants.ACTION_ID));
        attribute.setDataType(new URI(actionIdType));

        //set actionId
        valueList = new ArrayList();
        valueList.add(actionId);
        attribute.setAttributeStringValues(valueList);
        attributeList = new ArrayList();
        attributeList.add(attribute);
        action.setAttributes(attributeList);

        //set Action in Request
        request.setAction(action);

        //Environment, our PDP does not use environment now
        Environment environment = ContextFactory.getInstance()
            .createEnvironment();
        request.setEnvironment(environment);
        return request;
    }

    private Properties getProperties(String file)
        throws MissingResourceException {
        Properties properties = new Properties();
        ResourceBundle bundle = ResourceBundle.getBundle(file);
        Enumeration e = bundle.getKeys();
        System.out.println("sample properties:");
        while (e.hasMoreElements()) {
            String key = (String) e.nextElement();
            String value = bundle.getString(key);
            properties.put(key, value);
            System.out.println(key + ":" + value);
        }
        return properties;
    }
}</pre>
        <p>Before running the sample client, you must set up the configuration as described in the comments at the outset of the <code class="filename">scripts/run-xacml-client-sample.sh</code> script.</p>
        <div class="itemizedlist">
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p> Check <code class="filename">resources/AMConfig.properties</code> to see which OpenAM server the SDK is configured to use. </p><p> The relevant settings from <code class="filename">resources/AMConfig.properties</code> specify the server protocol, host, port and deployment URI. </p><pre class="codelisting prettyprint ini">com.iplanet.am.server.protocol=http
com.iplanet.am.server.host=openam.example.com
com.iplanet.am.server.port=8080
com.iplanet.am.services.deploymentDescriptor=openam</pre><p> For the purpose of this example, the XACML policy decision point (PDP) and the XACML policy enforcement point (PEP) are configured on this server. </p></li>
          <li class="listitem"><p>Edit <code class="filename">resources/xacmlClientSample.properties</code> and <code class="filename">resources/policyEvaluationSample.properties</code> to set up the configuration for the sample client.</p><p>The relevant settings from <code class="filename">resources/xacmlClientSample.properties</code> are the following.</p><pre class="codelisting prettyprint ini">pdp.entityId=xacmlPdpEntity
pep.entityId=xacmlPepEntity
subject.id=id=demo,ou=user,dc=openam,dc=forgerock,dc=org
subject.id.datatype=urn:oasis:names:tc:xacml:1.0:data-type:x500Name
subject.category=urn:oasis:names:tc:xacml:1.0:subject-category:access-subject
resource.id=http://www.example.com:80/banner.html
resource.id.datatype=http://www.w3.org/2001/XMLSchema#string
resource.servicename=iPlanetAMWebAgentService
resource.servicename.datatype=http://www.w3.org/2001/XMLSchema#string
action.id=GET
action.id.datatype=http://www.w3.org/2001/XMLSchema#string</pre><p>The relevant settings from <code class="filename">resources/policyEvaluationSample.properties</code> are the following.</p><pre class="codelisting prettyprint ini">user.name=demo
user.password=changeit
service.name=iPlanetAMWebAgentService
resource.name=http://www.example.com:80/banner.html
action.name=GET</pre><p> These settings use the default <code class="literal">demo</code> user as the subject, who has ID <code class="literal">id=demo,ou=user,dc=openam,dc=forgerock,dc=org</code>, and password <code class="literal">changeit</code>. If you choose a different subject, then change the <code class="literal">subject.id</code> value in <code class="filename">resources/xacmlClientSample.properties</code>, and the <code class="literal">user.name</code> and <code class="literal">user.password</code> values in <code class="filename">resources/policyEvaluationSample.properties</code>. </p></li>
          <li class="listitem"><p>The client accesses an OpenAM server acting as the policy enforcement point, configured in a circle of trust with the OpenAM server acting as the policy decision point. When you set up the sample clients, you pointed them to an OpenAM server. For this example, configure that server to function as a policy enforcement point and also as a policy decision point.</p>
           <div class="orderedlist">
            <ol class="orderedlist" type="1">
             <li class="listitem"><p>In OpenAM console, browse to Configuration &gt; Global &gt; SAMLv2 SOAP Binding, and configure a new request handler with Key <code class="literal">/xacmlPdpEntity</code> and Class <code class="literal">com.sun.identity.xacml.plugins.XACMLAuthzDecisionQueryHandler</code>.</p></li>
             <li class="listitem"><p>Set up the circle of trust, and then create and import the metadata for the policy enforcement point and the policy decision point. In the following simplified example, both the policy enforcement point and policy decision point are hosted on the same OpenAM server. You could also set up the policy enforcement point and policy decision point on separate servers, as long as the circles of trust on both servers each include both the policy enforcement point and the policy decision point. You can set up the trust relationship between the two entities either by using the <span class="command"><strong>ssoadm</strong></span> command as shown below, or by using the <code class="literal">ssoadm.jsp</code> page, which you can activate as described in <a href="../admin-guide/index.html#openam-ssoadm-jsp-overview" class="olink">Section&nbsp;1.3, "OpenAM ssoadm.jsp"</a> in the <em>Administration Guide</em>.</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">ssoadm \
 create-cot \
 --adminid amadmin \
 --password-file /tmp/pwd.txt \
 --cot cot</strong>

<em class="computeroutput">Circle of trust, cot was created.</em>
$ <strong class="userinput">ssoadm \
 create-metadata-templ \
 --adminid amadmin \
 --password-file /tmp/pwd.txt \
 --entityid xacmlPepEntity \
 --xacmlpep /xacmlPepEntity \
 --meta-data-file xacmlPep.xml \
 --extended-data-file xacmlPep-extended.xml</strong>

<em class="computeroutput">Hosted entity configuration was written to xacmlPep-extended.xml.
Hosted entity descriptor was written to xacmlPep.xml.</em>
$ <strong class="userinput">ssoadm \
 import-entity \
 --adminid amadmin \
 --password-file /tmp/pwd.txt \
 --cot cot \
 --meta-data-file xacmlPep.xml \
 --extended-data-file xacmlPep-extended.xml</strong>

<em class="computeroutput">Import file, xacmlPep.xml.
Import file, xacmlPep-extended.xml.</em>
$ <strong class="userinput">ssoadm \
 create-metadata-templ \
 --adminid amadmin \
 --password-file /tmp/pwd.txt \
 --entityid xacmlPdpEntity \
 --xacmlpdp /xacmlPdpEntity \
 --meta-data-file xacmlPdp.xml \
 --extended-data-file xacmlPdp-extended.xml</strong>

<em class="computeroutput">Hosted entity configuration was written to xacmlPdp-extended.xml.
Hosted entity descriptor was written to xacmlPdp.xml.</em>
$ <strong class="userinput">ssoadm \
 import-entity \
 --adminid amadmin \
 --password-file /tmp/pwd.txt \
 --cot cot \
 --meta-data-file xacmlPdp.xml \
 --extended-data-file xacmlPdp-extended.xml</strong>

<em class="computeroutput">Import file, xacmlPdp.xml.
Import file, xacmlPdp-extended.xml.</em>
      </pre></li>
            </ol>
           </div></li>
          <li class="listitem"><p>Create a policy that allows authenticated users to perform an HTTP <code class="literal">GET</code> on the sample <code class="literal">resource.id</code> URL you configured, such as <code class="literal">http://www.example.com:80/banner.html</code>.</p><p>See <a href="../admin-guide/index.html#chap-authz-policy" class="olink">Chapter&nbsp;3, "Defining Authorization Policies"</a> in the <em>Administration Guide</em> for details.</p></li>
         </ul>
        </div>
        <p>After you have configured OpenAM and the properties files, run the sample client script, and observe the XACML request and response.</p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">sh scripts/run-xacml-client-sample.sh</strong>
<em class="computeroutput">Using properties file:xacmlClientSample
sample properties:
subject.id.datatype:urn:oasis:names:tc:xacml:1.0:data-type:x500Name
pdp.entityId:xacmlPdpEntity
resource.servicename.datatype:http://www.w3.org/2001/XMLSchema#string
resource.id:http://www.example.com:80/banner.html
resource.servicename:iPlanetAMWebAgentService
action.id.datatype:http://www.w3.org/2001/XMLSchema#string
resource.id.datatype:http://www.w3.org/2001/XMLSchema#string
action.id:GET
subject.category:urn:oasis:names:tc:xacml:1.0:subject-category:access-subject
pep.entityId:xacmlPepEntity
subject.id:id=demo,ou=user,dc=openam,dc=forgerock,dc=org

testProcessRequest():xacmlRequest:

&lt;xacml-context:Request
 xmlns:xacml-context="urn:oasis:names:tc:xacml:2.0:context:schema:os"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="urn:oasis:names:tc:xacml:2.0:context:schema:os
  http://docs.oasis-open.org/xacml/access_control-xacml-2.0-context-schema-os.xsd"&gt;
&lt;Subject SubjectCategory=
 "urn:oasis:names:tc:xacml:1.0:subject-category:access-subject"&gt;
&lt;Attribute
 AttributeId="urn:oasis:names:tc:xacml:1.0:subject:subject-id"
 DataType="urn:oasis:names:tc:xacml:1.0:data-type:x500Name" &gt;
&lt;AttributeValue
 &gt;id=demo,ou=user,dc=openam,dc=forgerock,dc=org&lt;/AttributeValue&gt;
&lt;/Attribute&gt;
&lt;/Subject&gt;
&lt;xacml-context:Resource&gt;
&lt;Attribute
 AttributeId="ResourceId"
 DataType="http://www.w3.org/2001/XMLSchema#string" &gt;
&lt;AttributeValue&gt;http://www.example.com:80/banner.html&lt;/AttributeValue&gt;
&lt;/Attribute&gt;
&lt;Attribute
  AttributeId="urn:sun:names:xacml:2.0:resource:target-service"
  DataType="http://www.w3.org/2001/XMLSchema#string" &gt;
&lt;AttributeValue&gt;iPlanetAMWebAgentService&lt;/AttributeValue&gt;
&lt;/Attribute&gt;
&lt;/xacml-context:Resource&gt;
&lt;xacml-context:Action&gt;
&lt;Attribute
 AttributeId="urn:oasis:names:tc:xacml:1.0:action:action-id"
 DataType="http://www.w3.org/2001/XMLSchema#string" &gt;
&lt;AttributeValue&gt;GET&lt;/AttributeValue&gt;
&lt;/Attribute&gt;
&lt;/xacml-context:Action&gt;
&lt;xacml-context:Environment&gt;&lt;/xacml-context:Environment&gt;
&lt;/xacml-context:Request&gt;

testProcessRequest():xacmlResponse:
&lt;xacml-context:Response
 xmlns:xacml-context="urn:oasis:names:tc:xacml:2.0:context:schema:os" &gt;
&lt;xacml-context:Result ResourceId="http://www.example.com:80/banner.html"&gt;
&lt;xacml-context:Decision&gt;Permit&lt;/xacml-context:Decision&gt;
&lt;xacml-context:Status&gt;
&lt;xacml-context:StatusCode
 Value="urn:oasis:names:tc:xacml:1.0:status:ok"&gt;
&lt;/xacml-context:StatusCode&gt;
&lt;xacml-context:StatusMessage&gt;ok&lt;/xacml-context:StatusMessage&gt;
&lt;xacml-context:StatusDetail
 xmlns:xacml-context="urn:oasis:names:tc:xacml:2.0:context:schema:cd:04"&gt;
&lt;xacml-context:StatusDetail/&gt;&lt;/xacml-context:StatusDetail&gt;
&lt;/xacml-context:Status&gt;
&lt;/xacml-context:Result&gt;
&lt;/xacml-context:Response&gt;</em>
 </pre>
       </div>
      </div>
      <div class="section" id="sec-csdk">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">2.3.&nbsp;Using the OpenAM C SDK</h2>
         </div>
        </div>
       </div>
       <a class="indexterm" name="d14232e10917"></a>
       <p>This section introduces OpenAM C SDK. OpenAM C SDK is available for selected platforms on the OpenAM <a class="link" href="http://forgerock.org/openam.html" target="_blank">nightly builds page</a>. Contact <a class="link" href="mailto:info@forgerock.com" target="_top">info@forgerock.com</a> if you need OpenAM C SDK support.</p>
       <p>To prepare to install OpenAM C SDK, first download the version for your platform and unpack the archive as in the following example.</p>
       <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">mkdir -p /path/to/openam-client</strong>
$ <strong class="userinput">cd /path/to/openam-client</strong>
$ <strong class="userinput">unzip ~/Downloads/common_3_0_Linux_64bit.zip</strong>
 </pre>
       <p>All C SDK deliveries are .zip files, and the filenames are self-explanatory. The <code class="filename">SunOS</code> in some of the .zip files refer to the Solaris OS.</p>
       <div class="itemizedlist">
        <ul class="itemizedlist" style="list-style-type: disc; ">
         <li class="listitem"><p><code class="filename">common_3_0_Linux.zip</code></p></li>
         <li class="listitem"><p><code class="filename">common_3_0_Linux_64bit.zip</code></p></li>
         <li class="listitem"><p><code class="filename">common_3_0_windows.zip</code></p></li>
         <li class="listitem"><p><code class="filename">common_3_0_windows_64bit.zip</code></p></li>
         <li class="listitem"><p><code class="filename">common_3_0_SunOS_x86.zip</code></p></li>
         <li class="listitem"><p><code class="filename">common_3_0_SunOS_64bit.zip</code></p></li>
         <li class="listitem"><p><code class="filename">common_3_0_SunOS_sparc.zip</code></p></li>
         <li class="listitem"><p><code class="filename">common_3_0_SunOS_sparc_64bit.zip</code></p></li>
        </ul>
       </div>
       <div class="variablelist">
        <p>Once unpacked, you have several directories that include the SDK, and also sample client applications.</p>
        <dl class="variablelist">
         <dt>
          <span class="term"><code class="filename">bin/</code></span>
         </dt>
         <dd>
          <p>The <span class="command"><strong>crypt_util</strong></span> or <span class="command"><strong>cryptit.exe</strong></span> command for encrypting passwords</p>
         </dd>
         <dt>
          <span class="term"><code class="filename">config/</code></span>
         </dt>
         <dd>
          <p>Configuration data for the SDK</p>
         </dd>
         <dt>
          <span class="term"><code class="filename">include/</code></span>
         </dt>
         <dd>
          <p>Header files for the SDK</p>
         </dd>
         <dt>
          <span class="term"><code class="filename">lib/</code></span>
         </dt>
         <dd>
          <p>SDK and other required libraries</p>
         </dd>
         <dt>
          <span class="term"><code class="filename">samples/</code></span>
         </dt>
         <dd>
          <p>Sample code</p>
         </dd>
        </dl>
       </div>
       <div class="procedure" id="build-openam-csdk-client">
        <div class="procedure-inner">
         <div class="procedure-title">
          Procedure&nbsp;2.11.&nbsp;To Build OpenAM C SDK Samples
         </div>
         <ol class="procedure" type="1">
          <li class="step"><p>Review the <code class="filename">samples/README.TXT</code> file to complete any specific instructions required for your platform. The two commands shown here confirm that the specified system is a 64-bit Linux OS. Make sure it matches the C SDK package that you have downloaded.</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">uname -s</strong>
<em class="computeroutput">Linux</em>
$ <strong class="userinput">uname -m</strong>
<em class="computeroutput">x86_64</em>
   </pre></li>
          <li class="step"><p>Set up <code class="filename">OpenSSOAgentBootstrap.properties</code> and <code class="filename">OpenSSOAgentConfiguration.properties</code> as appropriate for your environment.</p><p>Base your work on the template files in the <code class="filename">config/</code> directory. You can find the Password Encryption Key in the OpenAM console under Configuration &gt; Servers and Sites &gt; <em class="replaceable">Server Name</em> &gt; Security.</p></li>
          <li class="step"><p>Try one of the samples you built to test your build.</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">LD_LIBRARY_PATH=../lib \
 ./am_auth_test \
 -f ../config/OpenSSOAgentBootstrap.properties \
 -u demo \
 -p changeit \
 -o /</strong>
<em class="computeroutput">   Login  1 Succeeded!
      SSOToken = AQIC5wM2LY4SfcxZfk4EzC9Y46P9cXG9ogwf2ixnYOeZ0K0.*AAJTSQACMDE.*
      Organization = /
      Module Instance Name [0] = SAE
      Module Instance Name [1] = LDAP
      Module Instance Name [2] = WSSAuthModule
      Module Instance Name [3] = Federation
      Module Instance Name [4] = HOTP
      Module Instance Name [5] = DataStore
   Logout 1 Succeeded!</em>
   </pre></li>
         </ol>
        </div>
       </div>
      </div>
      <div class="footnotes">
       <br>
       <hr class="footnote-hr">
       <div id="ftn.d14232e10710" class="footnote">
        <p><a href="#d14232e10710" class="para"><sup class="para">[1] </sup></a>The <code class="literal">PolicyDecision</code> element is defined in <code class="filename"><em class="replaceable">openam</em>/WEB-INF/remoteInterface.dtd</code> where <em class="replaceable">openam</em> is the location where the OpenAM web application is deployed.</p>
       </div>
      </div>
     </div>
     <div lang="" class="chapter" id="chap-fedlets">
      <div class="titlepage">
       <div>
        <div>
         <h1 class="title">Chapter&nbsp;3.&nbsp;Building SAML v2.0 Service Providers With Fedlets</h1>
        </div>
       </div>
      </div>
      <a class="indexterm" name="d14232e11084"></a>
      <p> This chapter introduces OpenAM Fedlets, and shows how to use the Fedlet as part of your Java web application. </p>
      <p> An OpenAM <em class="firstterm">Fedlet</em> is a small web application that that acts as a lightweight SAML v2.0 service provider. </p>
      <p> Fedlets are easy to integrate into Java web applications. The Fedlet does not require an entire OpenAM installation alongside your application, but instead can redirect to OpenAM for single sign-on, and to retrieve SAML assertions. </p>
      <div class="section" id="sec-fedlet-java">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">3.1.&nbsp;Using Fedlets in Java Web Applications</h2>
         </div>
        </div>
       </div>
       <a class="indexterm" name="d14232e11102"></a>
       <p>This chapter introduces OpenAM Fedlets, and shows how to use the Fedlet as part of your Java web application.</p>
       <div class="section" id="create-install-java-fedlet">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">3.1.1.&nbsp;Creating &amp; Installing a Java Fedlet</h3>
          </div>
         </div>
        </div>
        <p>The process for creating and installing a Java Fedlet is divided into several procedures.</p>
        <div class="itemizedlist">
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p><a class="xref" href="#create-a-java-fedlet" title="Procedure&nbsp;3.1.&nbsp;To Create a Fedlet">Procedure&nbsp;3.1, "To Create a Fedlet"</a></p></li>
          <li class="listitem"><p><a class="xref" href="#install-fedlet-as-demo" title="Procedure&nbsp;3.2.&nbsp;To Install the Fedlet as a Demo Application">Procedure&nbsp;3.2, "To Install the Fedlet as a Demo Application"</a></p></li>
          <li class="listitem"><p><a class="xref" href="#try-fedlet-attribute-query" title="Procedure&nbsp;3.3.&nbsp;To Try the Fedlet Attribute Query">Procedure&nbsp;3.3, "To Try the Fedlet Attribute Query"</a></p></li>
          <li class="listitem"><p><a class="xref" href="#try-fedlet-xacml-query" title="Procedure&nbsp;3.4.&nbsp;To Try the Fedlet XACML Query">Procedure&nbsp;3.4, "To Try the Fedlet XACML Query"</a></p></li>
         </ul>
        </div>
        <div class="procedure" id="create-a-java-fedlet">
         <div class="procedure-inner">
          <div class="procedure-title">
           Procedure&nbsp;3.1.&nbsp;To Create a Fedlet
          </div>
          <p>The OpenAM administrator running the identity provider server creates a <code class="filename">Fedlet.zip</code> file for your service provider application, and then sends you the .zip.</p>
          <ol class="procedure" type="1">
           <li class="step"><p>Before creating the Fedlet, create a Hosted Identity Provider if you have not already done so, using the test certificate for the signing key.</p><p>The single sign-on and single logout features that the Java Fedlet demonstrates do work with the Hosted Identity Provider you create starting from Realms &gt; <em class="replaceable">Realm Name</em> &gt; Dashboard. The Java Fedlet Attribute Query and XACML Query tests require additional configuration, however.</p><p>See <a class="xref" href="#try-fedlet-attribute-query" title="Procedure&nbsp;3.3.&nbsp;To Try the Fedlet Attribute Query">Procedure&nbsp;3.3, "To Try the Fedlet Attribute Query"</a> and <a class="xref" href="#try-fedlet-xacml-query" title="Procedure&nbsp;3.4.&nbsp;To Try the Fedlet XACML Query">Procedure&nbsp;3.4, "To Try the Fedlet XACML Query"</a> for details.</p></li>
           <li class="step"><p>Under Realms &gt; <em class="replaceable">Realm Name</em> &gt; Dashboard, click Create Fedlet.</p></li>
           <li class="step"><p>Note that the Circle of Trust includes your hosted identity provider, and that Identity Provider is set to your to hosted identity provider.</p></li>
           <li class="step"><p>Name the Fedlet, and also set the Destination URL.</p><p>You can use the deployment URL, such as <code class="literal">http://openam.example.com:8080/fedlet</code> as both the name and the destination URL.</p></li>
           <li class="step"><p>Click create to generate the Fedlet.zip file, such as <code class="filename">$HOME/openam/myfedlets/httpopenamexamplecom8080fedlet/Fedlet.zip</code>.</p></li>
           <li class="step"><p>Provide the Fedlet to the service provider, or install it yourself to demonstrate the Fedlet's features.</p></li>
          </ol>
         </div>
        </div>
        <div class="procedure" id="install-fedlet-as-demo">
         <div class="procedure-inner">
          <div class="procedure-title">
           Procedure&nbsp;3.2.&nbsp;To Install the Fedlet as a Demo Application
          </div>
          <p><code class="filename">Fedlet.zip</code> includes the <code class="filename">fedlet.war</code> archive corresponding to the identity provider, and a <code class="filename">README</code> file.</p>
          <div class="itemizedlist">
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p>The <code class="filename">fedlet.war</code> archive contains both the Fedlet as a demo web application, and also the files you use to include the Fedlet in your service provider application.</p></li>
            <li class="listitem"><p>The README file describes how to use the Fedlet.</p></li>
           </ul>
          </div>
          <p>Perform the following steps to try single sign-on and single logout tests. For the attribute query and XACML query tests, additional configuration is required.</p>
          <ol class="procedure" type="1">
           <li class="step"><p>Deploy the Fedlet in your web container.</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">unzip Fedlet.zip</strong>
$ <strong class="userinput">mv fedlet.war /path/to/tomcat/webapps</strong>
    </pre></li>
           <li class="step"><p>Browse to the Fedlet URL, and then click the links to set up the configuration directory in <code class="filename">$HOME/fedlet</code>, where $HOME corresponds to the user running the web application container.</p></li>
           <li class="step"><p>Try one or more examples from the Fedlet home page to validate Fedlet setup.</p>
            <div class="mediaobject" align="center" id="figure-fedlet-demo">
             <a class="fancybox" href="images/fedlet-demo.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_fedlet-demo.png" align="middle" alt="Home page for demo Fedlet" title="The home page for the demo Fedlet lets you try Fedlet (SP)
      initiated and IDP initiated single sign on and single logout."></a>
            </div><p>After setting up OpenAM with the default subjects, you can login on the identity provider with user name <code class="literal">demo</code> and password <code class="literal">changeit</code>.</p></li>
          </ol>
         </div>
        </div>
        <div class="procedure" id="try-fedlet-attribute-query">
         <div class="procedure-inner">
          <div class="procedure-title">
           Procedure&nbsp;3.3.&nbsp;To Try the Fedlet Attribute Query
          </div>
          <p>To try the Fedlet Attribute Query test, the Identity Provider must be configured with the Attribute Authority (<code class="literal">AttrAuth</code>) type and should sign responses. The Fedlet must be configured to deal with signed responses. Furthermore, map the attributes to request in both the Identity Provider and the Fedlet configurations.</p>
          <ol class="procedure" type="1">
           <li class="step"><p>Add the Attribute Authority type to the hosted Identity Provider.</p>
            <ol type="a" class="substeps">
             <li class="step"><p>On OpenAM where the Identity Provider is hosted, log in to OpenAM console as <code class="literal">amadmin</code>.</p></li>
             <li class="step"><p>Under Federation &gt; Entity Providers, select the Identity Provider, and then click New..., even though you plan to change the configuration rather than create a new provider.</p></li>
             <li class="step"><p>Select the protocol of the provider: SAMLv2.</p></li>
             <li class="step"><p>In the Create SAMLv2 Entity Provider page, do the following.</p>
              <div class="itemizedlist">
               <ul class="itemizedlist" style="list-style-type: disc; ">
                <li class="listitem"><p>Set the Realm.</p></li>
                <li class="listitem"><p>Set the Entity Identifier to the same entity identifier you selected in the previous screen.</p></li>
                <li class="listitem"><p>In the Attribute Authority section, set the Meta Alias for example to <code class="literal">/attra</code>, and set the Signing certificate alias and Encryption certificate alias values to <code class="literal">test</code> (to use the test certificate).</p></li>
                <li class="listitem"><p>Click Create to save your changes.</p><p>Disregard any error messages stating that the entity already exists.</p></li>
               </ul>
              </div><p><code class="literal">AttrAuth</code> now appears in the list of Types for your Identity Provider.</p></li>
            </ol></li>
           <li class="step"><p>Under Federation &gt; Entity Providers, click the Identity Provider link to open the provider's configuration.</p></li>
           <li class="step"><p>Make sure attributes for the query are mapped on the Identity Provider.</p><p>Under IDP &gt; Attribute Mapper, add the following values to the Attribute Map if they are not yet present.</p>
            <div class="itemizedlist">
             <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem"><p><code class="literal">cn=cn</code></p></li>
              <li class="listitem"><p><code class="literal">sn=sn</code></p></li>
              <li class="listitem"><p><code class="literal">uid=uid</code></p></li>
             </ul>
            </div>
            <div class="panel panel-info">
             <div class="panel-heading">
              <h3 class="panel-title">Note</h3>
             </div>
             <div class="panel-body">
              <p>Make sure to use thread-safe code if you implement the AttributeAuthorityMapper. You can use the attributes on the HttpRequest instead of synchronizing them. The default AttributeAuthorityMapper uses an attribute on the HttpServletRequest to pass information to the AttributeQueryUtil.</p>
             </div>
            </div><p>Click Save to save your changes.</p></li>
           <li class="step"><p>Create the Fedlet as described in <a class="xref" href="#create-a-java-fedlet" title="Procedure&nbsp;3.1.&nbsp;To Create a Fedlet">Procedure&nbsp;3.1, "To Create a Fedlet"</a>, making sure you map the attributes.</p>
            <div class="itemizedlist">
             <ul class="itemizedlist" style="list-style-type: disc; ">
              <li class="listitem"><p><code class="literal">cn=cn</code></p></li>
              <li class="listitem"><p><code class="literal">sn=sn</code></p></li>
              <li class="listitem"><p><code class="literal">uid=uid</code></p></li>
             </ul>
            </div><p>This step creates a Fedlet with updated Identity Provider metadata. If you already created a Fedlet, either use a different name, or delete the existing Fedlet.</p></li>
           <li class="step"><p>Deploy the new Fedlet .war as described in <a class="xref" href="#install-fedlet-as-demo" title="Procedure&nbsp;3.2.&nbsp;To Install the Fedlet as a Demo Application">Procedure&nbsp;3.2, "To Install the Fedlet as a Demo Application"</a>.</p></li>
           <li class="step"><p>Edit the new Fedlet configuration to request signing and encryption, and replace the existing configuration in OpenAM with the edited configuration.</p>
            <ol type="a" class="substeps">
             <li class="step"><p>Copy the test keystore from OpenAM, and prepare password files.</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">scp user@openam:/home/user/openam/openam/keystore.jks ~/fedlet/</strong>
      </pre><p>The Fedlet uses password files when accessing the keystore. These password files contain encoded passwords, where the encoding is specific to the Fedlet.</p><p>To encode the password, use <code class="literal">fedletEncode.jsp</code>. <code class="literal">fedletEncode.jsp</code> is in the deployed Fedlet, for example <code class="literal">http://openam.example.com:8080/fedlet/fedletEncode.jsp</code>. The only password to encode for OpenAM's test keystore is <code class="literal">changeit</code>, because the keystore and private key passwords are both the same.</p><p>Use the encoded value to create the password files as in the following example.</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">echo AQIC5BHNSjLwT303GqndmHbyYvzP9Tz7OAnK &gt; ~/fedlet/.storepass</strong>
$ <strong class="userinput">echo AQIC5BHNSjLwT303GqndmHbyYvzP9Tz7OAnK &gt; ~/fedlet/.keypass</strong>
      </pre></li>
             <li class="step"><p> Edit <code class="filename">~/fedlet/sp.xml</code>. </p><p> To use the test certificate for the attribute query feature, add a <code class="literal">RoleDescriptor</code> to the <code class="literal">EntityDescriptor</code> after the <code class="literal">SSODescriptor</code>. The <code class="literal">RoleDescriptor</code> describes the certificates that are used for signing and encryption. The attribute authority encrypts the response with the Fedlet's public key, and the Fedlet decrypts the response with its private key. </p><p>Change the following:</p><pre class="codelisting prettyprint xml">&lt;RoleDescriptor xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:query="urn:oasis:names:tc:SAML:metadata:ext:query"
    xsi:type="query:AttributeQueryDescriptorType"
    protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
 &lt;/RoleDescriptor&gt;</pre><p>To:</p><pre class="codelisting prettyprint xml"> &lt;RoleDescriptor xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:query="urn:oasis:names:tc:SAML:metadata:ext:query"
    xsi:type="query:AttributeQueryDescriptorType"
    protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
  &lt;KeyDescriptor use="signing"&gt;
   &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
    &lt;ds:X509Data&gt;
     &lt;ds:X509Certificate&gt;
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==
     &lt;/ds:X509Certificate&gt;
    &lt;/ds:X509Data&gt;
   &lt;/ds:KeyInfo&gt;
  &lt;/KeyDescriptor&gt;
  &lt;KeyDescriptor use="encryption"&gt;
   &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
    &lt;ds:X509Data&gt;
     &lt;ds:X509Certificate&gt;
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==
     &lt;/ds:X509Certificate&gt;
    &lt;/ds:X509Data&gt;
   &lt;/ds:KeyInfo&gt;
   &lt;EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#aes128-cbc"&gt;
    &lt;xenc:KeySize xmlns:xenc="http://www.w3.org/2001/04/xmlenc#"
      &gt;128&lt;/xenc:KeySize&gt;
   &lt;/EncryptionMethod&gt;
  &lt;/KeyDescriptor&gt;
 &lt;/RoleDescriptor&gt;</pre></li>
             <li class="step"><p>Edit <code class="filename">~/fedlet/sp-extended.xml</code> to use the test certificate for the attribute query.</p><p>Change the following, assuming your Circle of Trust is called <code class="literal">cot</code>:</p><pre class="codelisting prettyprint xml">&lt;AttributeQueryConfig metaAlias="/attrQuery"&gt;
    &lt;Attribute name="signingCertAlias"&gt;
        &lt;Value&gt;&lt;/Value&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="encryptionCertAlias"&gt;
        &lt;Value&gt;&lt;/Value&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="wantNameIDEncrypted"&gt;
        &lt;Value&gt;&lt;/Value&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="cotlist"&gt;
        &lt;Value&gt;cot&lt;/Value&gt;
    &lt;/Attribute&gt;
&lt;/AttributeQueryConfig&gt;</pre><p>To:</p><pre class="codelisting prettyprint xml">&lt;AttributeQueryConfig metaAlias="/attrQuery"&gt;
    &lt;Attribute name="signingCertAlias"&gt;
        &lt;Value&gt;test&lt;/Value&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="encryptionCertAlias"&gt;
        &lt;Value&gt;test&lt;/Value&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="wantNameIDEncrypted"&gt;
        &lt;Value&gt;true&lt;/Value&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="cotlist"&gt;
        &lt;Value&gt;cot&lt;/Value&gt;
    &lt;/Attribute&gt;
&lt;/AttributeQueryConfig&gt;</pre></li>
             <li class="step"><p>In OpenAM Console, under Federation &gt; Entity Providers, delete the existing configuration for your new Fedlet.</p></li>
             <li class="step"><p> Make a copy of <code class="filename">sp-extended.xml</code> called <code class="filename">sp-extended-copy.xml</code> and set <code class="literal">hosted="0"</code> in the root element of the copy. </p><p> Use the copy, <code class="filename">sp-extended-copy.xml</code>, when importing the Fedlet configuration into OpenAM. OpenAM must register the Fedlet as a <span class="emphasis"><em>remote</em></span> service provider. </p></li>
             <li class="step"><p>Under Federation &gt; Entity Providers, click Import Entity... and import your updated Fedlet configuration.</p><p>This ensures OpenAM has the correct service provider configuration for your new Fedlet.</p></li>
             <li class="step"><p>Restart the Fedlet or the container where it is deployed.</p></li>
            </ol></li>
           <li class="step"><p>Try the Attribute Query test.</p>
            <ol type="a" class="substeps">
             <li class="step"><p>Access the Fedlet.</p>
              <div class="mediaobject" align="center" id="figure-fedlet-sso-request">
               <a class="fancybox" href="images/fedlet-sso-request.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_fedlet-sso-request.png" align="middle" alt="Home page for demo Fedlet" title="The home page for the demo Fedlet lets you try Fedlet (SP)
        initiated and IDP initiated single sign on and single logout."></a>
              </div></li>
             <li class="step"><p>Try SSO with user name <code class="literal">demo</code>, password <code class="literal">changeit</code>.</p>
              <div class="mediaobject" align="center" id="figure-fedlet-sso-response">
               <a class="fancybox" href="images/fedlet-sso-response.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_fedlet-sso-response.png" align="middle" alt="Fedlet SSO response page" title="After signing in, you should see information about the
        authentication and also other tests to try."></a>
              </div></li>
             <li class="step"><p>Click Fedlet Attribute Query, set the attributes in the Attribute Query page to match the mapped attributes, and then click Submit.</p>
              <div class="mediaobject" align="center" id="figure-fedlet-attr-query-request">
               <a class="fancybox" href="images/fedlet-attr-query-request.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_fedlet-attr-query-request.png" align="middle" alt="Fedlet Attribute Query request page" title="After signing in, you can try the Attribute Query demo."></a>
              </div></li>
             <li class="step"><p>Check that you see the attribute values in the response.</p>
              <div class="mediaobject" align="center" id="figure-fedlet-attr-query-response">
               <a class="fancybox" href="images/fedlet-attr-query-response.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_fedlet-attr-query-response.png" align="middle" alt="Fedlet Attribute Query response page" title="The responses for each attribute value in this case should be
        demo."></a>
              </div></li>
            </ol></li>
          </ol>
         </div>
        </div>
        <div class="procedure" id="try-fedlet-xacml-query">
         <div class="procedure-inner">
          <div class="procedure-title">
           Procedure&nbsp;3.4.&nbsp;To Try the Fedlet XACML Query
          </div>
          <p>To try the Fedlet XACML Query test, the Identity Provider must have a policy configured, must be configured with the Policy Decision Point (<code class="literal">XACML PDP</code>) type, and must have a SAML v2.0 SOAP Binding PDP handler configured.</p>
          <ol class="procedure" type="1">
           <li class="step"><p>Configure a policy on the hosted Identity Provider.</p><p>OpenAM uses the policy to make the decision whether to permit or deny access to a resource. For the purpose of the demonstration, configure a simple policy that allows all authenticated users HTTP GET access on <code class="literal">http://www.example.com/</code>.</p>
            <ol type="a" class="substeps">
             <li class="step"><p>Log in to OpenAM console as <code class="literal">amadmin</code>.</p></li>
             <li class="step"><p> Access the policy editor under Realms &gt; <em class="replaceable">Realm Name</em> &gt; Authorization. </p></li>
             <li class="step"><p> Choose an application that allows the resource pattern <code class="literal">http://www.example.com/*</code>, and HTTP GET as an action. </p><p> If no application exists in the realm, add a new application for the resource pattern <code class="literal">http://www.example.com/*</code>. </p></li>
             <li class="step"><p> Add a new policy with the following characteristics. </p>
              <div class="itemizedlist">
               <ul class="itemizedlist" style="list-style-type: disc; ">
                <li class="listitem"><p> Resource pattern: <code class="literal">http://www.example.com/*</code> </p></li>
                <li class="listitem"><p> Actions: allow <code class="literal">GET</code> </p></li>
                <li class="listitem"><p> Subject conditions: <code class="literal">Authenticated Users</code> </p></li>
               </ul>
              </div></li>
            </ol></li>
           <li class="step"><p>Add the Policy Decision Point type to the Identity Provider.</p>
            <ol type="a" class="substeps">
             <li class="step"><p>Under Federation &gt; Entity Providers, select the Identity Provider, and then click New..., even though you plan to change the configuration rather than create a new provider.</p></li>
             <li class="step"><p>Select the protocol of the provider: SAMLv2.</p></li>
             <li class="step"><p>In the Create SAMLv2 Entity Provider page, do the following.</p>
              <div class="itemizedlist">
               <ul class="itemizedlist" style="list-style-type: disc; ">
                <li class="listitem"><p>Set the Realm.</p></li>
                <li class="listitem"><p>Set the Entity Identifier to the entity identifier for the hosted Identity Provider.</p></li>
                <li class="listitem"><p>In the XACML Policy Decision Point section, set the Meta Alias for example to <code class="literal">/pdp</code>.</p></li>
                <li class="listitem"><p>Click Create to save your changes.</p><p>Disregard any error messages stating that the entity already exists.</p></li>
               </ul>
              </div><p><code class="literal">XACML PDP</code> now appears in the list of Types for your identity provider.</p></li>
            </ol></li>
           <li class="step"><p>Add the PDP handler for the SAML v2.0 SOAP Binding.</p>
            <ol type="a" class="substeps">
             <li class="step"><p>Under Configuration &gt; Global &gt; SAMLv2 SOAP Binding, click New...</p></li>
             <li class="step"><p>Set the new key to match the meta alias you used when adding the XACML PDP type to the Identity Provider configuration, for example <code class="literal">/pdp</code>.</p>
              <div class="itemizedlist">
               <ul class="itemizedlist" style="list-style-type: disc; ">
                <li class="listitem"><p>Key: <code class="literal">/pdp</code></p></li>
                <li class="listitem"><p>Class: <code class="literal">com.sun.identity.xacml.plugins.XACMLAuthzDecisionQueryHandler</code></p></li>
               </ul>
              </div><p>Click OK. (Your changes are not saved, yet.)</p></li>
             <li class="step"><p>Click Save to actually save the new Key:Class pair.</p></li>
            </ol></li>
           <li class="step"><p>Create the Fedlet as described in <a class="xref" href="#create-a-java-fedlet" title="Procedure&nbsp;3.1.&nbsp;To Create a Fedlet">Procedure&nbsp;3.1, "To Create a Fedlet"</a>.</p><p>This step creates a Fedlet with updated identity provider metadata. If you already created a Fedlet, either use a different name, or delete the existing Fedlet.</p></li>
           <li class="step"><p>Deploy the new Fedlet .war as described in <a class="xref" href="#install-fedlet-as-demo" title="Procedure&nbsp;3.2.&nbsp;To Install the Fedlet as a Demo Application">Procedure&nbsp;3.2, "To Install the Fedlet as a Demo Application"</a>.</p></li>
           <li class="step"><p>Try the XACML Query test.</p>
            <ol type="a" class="substeps">
             <li class="step"><p>Access the Fedlet.</p>
              <div class="mediaobject" align="center" id="figure-fedlet-sso-request-xacml">
               <a class="fancybox" href="images/fedlet-sso-request.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_fedlet-sso-request.png" align="middle" alt="Home page for demo Fedlet" title="The home page for the demo Fedlet lets you try Fedlet (SP)
        initiated and IDP initiated single sign on and single logout."></a>
              </div></li>
             <li class="step"><p>Try SSO with user name <code class="literal">demo</code>, password <code class="literal">changeit</code>.</p>
              <div class="mediaobject" align="center" id="figure-fedlet-sso-response-xacml">
               <a class="fancybox" href="images/fedlet-sso-response.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_fedlet-sso-response.png" align="middle" alt="Fedlet SSO response page" title="After signing in, you should see information about the
        authentication and also other tests to try."></a>
              </div></li>
             <li class="step"><p>Click XACML Attribute Query, set the Resource URL in the XACML Query page to <code class="literal">http://www.example.com/</code>, and then click Submit.</p>
              <div class="mediaobject" align="center" id="figure-fedlet-xacml-query-request">
               <a class="fancybox" href="images/fedlet-xacml-query-request.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_fedlet-xacml-query-request.png" align="middle" alt="Fedlet XACML Query request page" title="After signing in, you can try the XACML Query demo."></a>
              </div></li>
             <li class="step"><p>Check that you see the permit decision in the response.</p>
              <div class="mediaobject" align="center" id="figure-fedlet-xacml-query-response">
               <a class="fancybox" href="images/fedlet-xacml-query-response.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_fedlet-xacml-query-response.png" align="middle" alt="Fedlet XACML Query response page" title="The response is to permit the user to access the resource."></a>
              </div></li>
            </ol></li>
          </ol>
         </div>
        </div>
       </div>
       <div class="section" id="fedlet-signing-encryption">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">3.1.2.&nbsp;Signing &amp; Encryption For a Fedlet</h3>
          </div>
         </div>
        </div>
        <p>By default when you create the Java Fedlet, signing and encryption are not configured. You can however set up OpenAM and the fedlet to sign and to verify XML signatures and to encrypt and to decrypt data such as SAML assertions. If you have tried the Attribute Query demonstration, then you have already configured the Fedlet to request signing and encryption using the test keys from the identity provider.</p>
        <div class="itemizedlist">
         <p>Enable signing and encryption for the Java Fedlet involves the following high level stages.</p>
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p>Before you create the Fedlet, configure the IDP to sign and encrypt data. See Federation &gt; Entity Providers &gt; <em class="replaceable">IDP Name</em> &gt; Signing and Encryption in the OpenAM console.</p><p>For evaluation, you can use the <code class="literal">test</code> certificate delivered with OpenAM.</p></li>
          <li class="listitem"><p>Initially deploy and configure the Fedlet, but do not use the Fedlet until you finish.</p></li>
          <li class="listitem"><p>On the Fedlet side set up a JKS keystore used for signing and encryption. For evaluation, you can use copy the <code class="filename">keystore.jks</code> file delivered with OpenAM. You can find the file under the configuration directory for OpenAM, such as <code class="filename">$HOME/openam/openam/</code> for a server instance with base URI <code class="literal">openam</code>. The built-in keystore includes the <code class="literal">test</code> certificate.</p><p>You must also set up <code class="filename">.storepass</code> and <code class="filename">.keypass</code> files using the <code class="filename">fedletEncode.jsp</code> page, such as <code class="literal">http://openam.example.com:8080/fedlet/fedletEncode.jsp</code>, to encode passwords on the Fedlet side. The passwords for the test keystore and private key are both <code class="literal">changeit</code>.</p></li>
          <li class="listitem"><p>Configure the Fedlet to perform signing and encryption by ensuring the Fedlet has access to the keystore, and by updating the SP metadata for the Fedlet.</p></li>
          <li class="listitem"><p>Import the updated SP metadata into the IDP to replace the default Fedlet configuration.</p></li>
          <li class="listitem"><p>Restart the Fedlet or container in which the Fedlet runs for the changes you made on the Fedlet side to take effect.</p></li>
         </ul>
        </div>
        <div class="procedure" id="fedlet-conf-signing-encryption">
         <div class="procedure-inner">
          <div class="procedure-title">
           Procedure&nbsp;3.5.&nbsp;To Configure the Fedlet For Signing &amp; Encryption
          </div>
          <p>The <code class="filename">FederationConfig.properties</code> file specifies the paths to the JKS keystore holding the signing or encryption keys for the Fedlet, the keystore password file, and the private key password file.</p>
          <ol class="procedure" type="1">
           <li class="step"><p>After setting up your keystore and password files as described above, edit the properties file in the configuration directory, such as <code class="filename">$HOME/fedlet/FederationConfig.properties</code>, to point to the keystore and password files.</p></li>
           <li class="step"><p>Export the certificate to use for signing and encryption purposes.</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">keytool -export -rfc -keystore keystore.jks -alias test</strong>
<em class="computeroutput">Enter keystore password:
-----BEGIN CERTIFICATE-----
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==</em>
    </pre></li>
           <li class="step"><p>Edit the standard metadata file for the Fedlet, such as <code class="filename">$HOME/fedlet/sp.xml</code>, to include the certificate in KeyDescriptor elements, that are children of the SPSSODescriptor element.</p><pre class="codelisting prettyprint xml">&lt;EntityDescriptor
 xmlns="urn:oasis:names:tc:SAML:2.0:metadata"
 entityID="http://www.example.com:8080/fedlet"&gt;
 &lt;SPSSODescriptor
  AuthnRequestsSigned="true"
  WantAssertionsSigned="true"
  protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
  &lt;KeyDescriptor use="signing"&gt;
   &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
    &lt;ds:X509Data&gt;
     &lt;ds:X509Certificate&gt;
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==
     &lt;/ds:X509Certificate&gt;
    &lt;/ds:X509Data&gt;
   &lt;/ds:KeyInfo&gt;
  &lt;/KeyDescriptor&gt;
  &lt;KeyDescriptor use="encryption"&gt;
   &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
    &lt;ds:X509Data&gt;
     &lt;ds:X509Certificate&gt;
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==
     &lt;/ds:X509Certificate&gt;
    &lt;/ds:X509Data&gt;
   &lt;/ds:KeyInfo&gt;
   &lt;EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#aes128-cbc"&gt;
    &lt;xenc:KeySize xmlns:xenc="http://www.w3.org/2001/04/xmlenc#"&gt;
     128
    &lt;/xenc:KeySize&gt;
   &lt;/EncryptionMethod&gt;
  &lt;/KeyDescriptor&gt;
  &lt;SingleLogoutService
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
   Location="http://www.example.com:8080/fedlet/fedletSloRedirect"
   ResponseLocation="http://www.example.com:8080/fedlet/fedletSloRedirect" /&gt;
  &lt;SingleLogoutService
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
   Location="http://www.example.com:8080/fedlet/fedletSloPOST"
   ResponseLocation="http://www.example.com:8080/fedlet/fedletSloPOST" /&gt;
  &lt;SingleLogoutService
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:SOAP"
   Location="http://www.example.com:8080/fedlet/fedletSloSoap" /&gt;
  &lt;NameIDFormat&gt;
   urn:oasis:names:tc:SAML:2.0:nameid-format:transient
  &lt;/NameIDFormat&gt;
  &lt;AssertionConsumerService
   index="0"
   isDefault="true"
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
   Location="http://www.example.com:8080/fedlet/fedletapplication" /&gt;
  &lt;AssertionConsumerService
   index="1"
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact"
   Location="http://www.example.com:8080/fedlet/fedletapplication" /&gt;
 &lt;/SPSSODescriptor&gt;
 &lt;RoleDescriptor
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:query="urn:oasis:names:tc:SAML:metadata:ext:query"
  xsi:type="query:AttributeQueryDescriptorType"
  protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
 &lt;/RoleDescriptor&gt;
 &lt;XACMLAuthzDecisionQueryDescriptor
  WantAssertionsSigned="false"
  protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol" /&gt;
&lt;/EntityDescriptor&gt;</pre></li>
           <li class="step"><p>Edit the extended metadata file for the Fedlet, such as <code class="filename">$HOME/fedlet/sp-extended.xml</code>, to set the certificate alias names to the alias for the Fedlet certificate, and the <code class="literal">want*Signed</code> and <code class="literal">want*Encrypted</code> values to <code class="literal">true</code>.</p><p>If you reformat the file, take care not to add white space around string values in elements.</p><pre class="codelisting prettyprint xml">
&lt;EntityConfig xmlns="urn:sun:fm:SAML:2.0:entityconfig"
 xmlns:fm="urn:sun:fm:SAML:2.0:entityconfig" hosted="1"
 entityID="http://www.example.com:8080/fedlet"&gt;
 &lt;SPSSOConfig metaAlias="/sp"&gt;
  &lt;Attribute name="description"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="signingCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="encryptionCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthOn"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthUser"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthPassword"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="autofedEnabled"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="autofedAttribute"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="transientUser"&gt;
   &lt;Value&gt;anonymous&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAdapter"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAdapterEnv"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="fedletAdapter"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultFedletAdapter&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="fedletAdapterEnv"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAccountMapper"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultLibrarySPAccountMapper&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="useNameIDAsSPUserID"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAttributeMapper"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultSPAttributeMapper&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAuthncontextMapper"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultSPAuthnContextMapper&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAuthncontextClassrefMapping"&gt;
   &lt;Value
   &gt;urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport|0|default&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAuthncontextComparisonType"&gt;
   &lt;Value&gt;exact&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="attributeMap"&gt;
   &lt;Value&gt;*=*&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="saml2AuthModuleName"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="localAuthURL"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="intermediateUrl"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="defaultRelayState"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="appLogoutUrl"&gt;
   &lt;Value&gt;http://www.example.com:8080/fedlet/logout&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="assertionTimeSkew"&gt;
   &lt;Value&gt;300&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantAttributeEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantAssertionEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantNameIDEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantPOSTResponseSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantArtifactResponseSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantLogoutRequestSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantLogoutResponseSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantMNIRequestSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantMNIResponseSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="responseArtifactMessageEncoding"&gt;
   &lt;Value&gt;URI&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="cotlist"&gt;
   &lt;Value&gt;fedlet-cot&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="saeAppSecretList"&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="saeSPUrl"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="saeSPLogoutUrl"&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="ECPRequestIDPListFinderImpl"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.ECPIDPFinder&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="ECPRequestIDPList"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="ECPRequestIDPListGetComplete"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="enableIDPProxy"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="idpProxyList"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="idpProxyCount"&gt;
   &lt;Value&gt;0&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="useIntroductionForIDPProxy"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spSessionSyncEnabled"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="relayStateUrlList"&gt;
  &lt;/Attribute&gt;
 &lt;/SPSSOConfig&gt;
 &lt;AttributeQueryConfig metaAlias="/attrQuery"&gt;
  &lt;Attribute name="signingCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="encryptionCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantNameIDEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="cotlist"&gt;
   &lt;Value&gt;fedlet-cot&lt;/Value&gt;
  &lt;/Attribute&gt;
 &lt;/AttributeQueryConfig&gt;
 &lt;XACMLAuthzDecisionQueryConfig metaAlias="/pep"&gt;
  &lt;Attribute name="signingCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="encryptionCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthOn"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthUser"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthPassword"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantXACMLAuthzDecisionResponseSigned"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantAssertionEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="cotlist"&gt;
   &lt;Value&gt;fedlet-cot&lt;/Value&gt;
  &lt;/Attribute&gt;
 &lt;/XACMLAuthzDecisionQueryConfig&gt;
&lt;/EntityConfig&gt;</pre></li>
           <li class="step"><p> Make a copy of <code class="filename">sp-extended.xml</code> called <code class="filename">sp-extended-copy.xml</code> and set <code class="literal">hosted="0"</code> in the root element of the copy. </p><p> Use the copy, <code class="filename">sp-extended-copy.xml</code>, when importing the Fedlet configuration into OpenAM. OpenAM must register the Fedlet as a <span class="emphasis"><em>remote</em></span> service provider. </p></li>
           <li class="step"><p>In OpenAM console delete the original SP entity configuration for the Fedlet, and then import the updated metadata for the new configuration into OpenAM on the IDP side.</p></li>
           <li class="step"><p>Restart the Fedlet or the container in which it runs in order for the Fedlet to pick up the changes to the configuration properties and the metadata.</p></li>
          </ol>
         </div>
        </div>
       </div>
       <div class="section" id="customize-java-fedlet">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">3.1.3.&nbsp;Customizing a Java Fedlet</h3>
          </div>
         </div>
        </div>
        <p>You can customize the Java Fedlet to perform many of the SAML v2.0 service provider operations. The Java Fedlet has the SAML v2.0 capabilities identified in <a href="../admin-guide/index.html#fedlet-saml2-features" class="olink">Table&nbsp;12.2, "Fedlet Support for SAML v2.0 Features"</a> in the <em>Administration Guide</em>.</p>
        <div class="procedure" id="hello-world-with-fedlet">
         <div class="procedure-inner">
          <div class="procedure-title">
           Procedure&nbsp;3.6.&nbsp;To Add Your Application
          </div>
          <div class="variablelist">
           <p>The Fedlet includes the following files that you use when building your own service provider application based on the demo web application, including a set of JavaServer Pages (JSP) examples.</p>
           <dl class="variablelist">
            <dt>
             <span class="term"><code class="filename">conf/</code></span>
            </dt>
            <dd>
             <p>Configuration files copied to <code class="filename">$HOME/fedlet</code> when you first deploy and configure the Fedlet. When deploying your application, you can move these to an alternate location passed to the Java virtual machine for the web application container at startup. For example, if you store the configuration under <code class="filename">/export/fedlet/</code>, then you could pass the following property to the JVM.</p>
             <pre class="literallayout">-Dcom.sun.identity.fedlet.home=/export/fedlet/conf</pre>
             <p>You do not need to include these files in your application.</p>
            </dd>
            <dt>
             <span class="term"><code class="filename">fedletAttrQuery.jsp</code>, </span>
             <span class="term"><code class="filename">fedletAttrResp.jsp</code></span>
            </dt>
            <dd>
             <p>Sample SAML attribute query and response handlers.</p>
            </dd>
            <dt>
             <span class="term"><code class="filename">fedletEncode.jsp</code></span>
            </dt>
            <dd>
             <p>Utility JSP to encode a password, such as the password used to protect a Java keystore</p>
            </dd>
            <dt>
             <span class="term"><code class="filename">fedletSampleApp.jsp</code>, </span>
             <span class="term"><code class="filename">index.jsp</code></span>
            </dt>
            <dd>
             <p>Demo application. You can remove these before deployment to replace them with your application.</p>
            </dd>
            <dt>
             <span class="term"><code class="filename">fedletXACMLQuery.jsp</code>, </span>
             <span class="term"><code class="filename">fedletXACMLResp.jsp</code></span>
            </dt>
            <dd>
             <p>Sample SAML XACML query and response handlers.</p>
            </dd>
            <dt>
             <span class="term"><code class="filename">logout.jsp</code></span>
            </dt>
            <dd>
             <p>Utility page to perform single log out</p>
            </dd>
            <dt>
             <span class="term"><code class="filename">saml2/jsp/</code></span>
            </dt>
            <dd>
             <p>JSPs to initiate single sign on and single logout, and to handle errors, and also a JSP for obtaining Fedlet metadata, <code class="filename">saml2/jsp/exportmetadata.jsp</code></p>
            </dd>
            <dt>
             <span class="term"><code class="filename">WEB-INF/classes/</code></span>
            </dt>
            <dd>
             <p>Localized Java properties files for strings used in the Fedlet user interface</p>
            </dd>
            <dt>
             <span class="term"><code class="filename">WEB-INF/lib/</code></span>
            </dt>
            <dd>
             <p>Fedlet libraries required by your application</p>
            </dd>
            <dt>
             <span class="term"><code class="filename">WEB-INF/web.xml</code></span>
            </dt>
            <dd>
             <p>Fedlet web application configuration, showing how JSPs map to URLs used in the Fedlet. Add mappings for your application before deployment.</p>
             <p>In the <code class="filename">web.xml</code> mappings, your application must be mapped to <code class="literal">/fedletapplication</code>, as this is the assertion consumer URL set in the Fedlet metadata.</p>
             <pre class="codelisting prettyprint xml">&lt;servlet&gt;
    &lt;servlet-name&gt;yourApp&lt;/servlet-name&gt;
    &lt;jsp-file&gt;/fedletSampleApp.jsp&lt;/jsp-file&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;yourApp&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/fedletapplication&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</pre>
            </dd>
           </dl>
          </div>
          <p>Follow these steps for a very simple demonstration of how to customize the Fedlet.</p>
          <ol class="procedure" type="1">
           <li class="step"><p>Backup <code class="filename">fedletSampleApp.jsp</code>.</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cd /path/to/tomcat/webapps/fedlet/</strong>
$ <strong class="userinput">cp fedletSampleApp.jsp fedletSampleApp.jsp.orig</strong>
    </pre></li>
           <li class="step"><p>Edit <code class="filename">fedletSampleApp.jsp</code> to reduce it to a single redirection to <code class="filename">myapp.jsp</code>. An implementation of the &lt;html&gt; element of the file follows below.</p><pre class="codelisting prettyprint html">&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Fedlet Sample Application&lt;/title&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;%
    // BEGIN : following code is a must for Fedlet (SP) side application
    Map map;
    try {
        // invoke the Fedlet processing logic. this will do all the
        // necessary processing conforming to SAML v2.0 specifications,
        // such as XML signature validation, Audience and Recipient
        // validation etc.
        map = SPACSUtils.processResponseForFedlet(request, response,
            new PrintWriter(out, true));
        response.sendRedirect("myapp.jsp");
    } catch (SAML2Exception sme) {
        SAMLUtils.sendError(request, response,
            response.SC_INTERNAL_SERVER_ERROR, "failedToProcessSSOResponse",
            sme.getMessage());
        return;
    } catch (IOException ioe) {
        SAMLUtils.sendError(request, response,
            response.SC_INTERNAL_SERVER_ERROR, "failedToProcessSSOResponse",
            ioe.getMessage());
        return;
    } catch (SessionException se) {
        SAMLUtils.sendError(request, response,
            response.SC_INTERNAL_SERVER_ERROR, "failedToProcessSSOResponse",
            se.getMessage());
        return;
    } catch (ServletException se) {
        SAMLUtils.sendError(request, response,
            response.SC_BAD_REQUEST, "failedToProcessSSOResponse",
            se.getMessage());
        return;
    }
    // END : code is a must for Fedlet (SP) side application
%&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></li>
           <li class="step"><p>Add a <code class="filename">myapp.jsp</code> page to the Fedlet, such as the following.</p><pre class="codelisting prettyprint html">&lt;html&gt;
&lt;head&gt;
&lt;title&gt;My Application&lt;/title&gt;
&lt;meta http-equiv="Content-Type" content="text/html" /&gt;
&lt;/head&gt;

&lt;body&gt;

&lt;h1&gt;My Application&lt;/h1&gt;

&lt;p&gt;After you change the &lt;code&gt;fedletSampleApp.jsp&lt;/code&gt;,
   all it does is redirect to this home page after
   successful login.&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;</pre></li>
           <li class="step"><p>Browse to the Fedlet URL, such as <code class="literal">http://openam.example.com:8080/fedlet/</code>, and try one of the login methods.</p><p>After login you are redirected to <code class="filename">myapp.jsp</code>.</p></li>
          </ol>
         </div>
        </div>
        <div class="section" id="fedlet-perform-sso">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">3.1.3.1.&nbsp;Performing Single Sign-On</h4>
           </div>
          </div>
         </div>
         <p>The Java Fedlet includes a JSP file, <code class="filename">saml2/jsp/fedletSSOInit.jsp</code>, that you can call to initiate single sign-on from the Fedlet (SP) side. The Fedlet home page, <code class="filename">index.jsp</code>, calls this page when the user does Fedlet-initiated single sign-on.</p>
         <p>When calling this JSP, the parameters to use are those also used by <code class="filename">saml2/jsp/spSSOInit.jsp</code> in OpenAM. Those parameters are described in <a href="../admin-guide/index.html#spssoinit-parameters" class="olink">spSSOInit.jsp Parameters</a> in the <em>Administration Guide</em>.</p>
         <p>For IDP-initiated single sign-on, call the appropriate page on the Identity Provider. OpenAM's page is described in <a href="../admin-guide/index.html#idpssoinit-parameters" class="olink">idpSSOInit.jsp Parameters</a> in the <em>Administration Guide</em>.</p>
         <p>After single sign-on, the user-agent is directed by default to the assertion consumer URI set in the Fedlet metadata, which by default is <code class="literal">/fedletapplication</code>. Also by default that URI points to the JSP, <code class="filename">fedletSampleApp.jsp</code></p>
        </div>
        <div class="section" id="fedlet-perform-slo">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">3.1.3.2.&nbsp;Performing Single Logout</h4>
           </div>
          </div>
         </div>
         <p>The Java Fedlet includes a JSP file, <code class="filename">saml2/jsp/spSingleLogoutInit.jsp</code>, that you can call to initiate single logout from the Fedlet (SP) side. The Fedlet assertion consumer page, <code class="filename">fedletSampleApp.jsp</code>, calls this when the user does Fedlet-initiated single logout.</p>
         <p>When calling this JSP, the parameters to use are those also used by <code class="filename">saml2/jsp/spSingleLogoutInit.jsp</code> in OpenAM. Those parameters are described in <a href="../admin-guide/index.html#spsloinit-parameters" class="olink">spSingleLogoutInit.jsp Parameters</a> in the <em>Administration Guide</em>.</p>
         <p>For IDP-initiated single logout, call the appropriate page on the Identity Provider. OpenAM's page is described in <a href="../admin-guide/index.html#idpsloinit-parameters" class="olink">idpSingleLogoutInit.jsp Parameters</a> in the <em>Administration Guide</em>.</p>
         <p>Set the <code class="literal">RelayState</code> parameter when initiating logout to redirect the user-agent appropriately when the process is complete.</p>
        </div>
        <div class="section" id="fedlet-perform-attr-query">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">3.1.3.3.&nbsp;Performing Attribute Queries</h4>
           </div>
          </div>
         </div>
         <p>As seen in the procedure, <a class="xref" href="#try-fedlet-attribute-query" title="Procedure&nbsp;3.3.&nbsp;To Try the Fedlet Attribute Query">Procedure&nbsp;3.3, "To Try the Fedlet Attribute Query"</a>, an attribute query allows the Fedlet to get profile information about a subject from the Attribute Authority. The Fedlet must be configured to deal with responses from the Attribute Authority, including configuration for signing and encryption. Also, an Identity Provider and Attribute Authority is likely to share only those attributes that the Fedlet absolutely requires to provide service, such as, for example, a name to customize a page. The attributes must then be mapped in the Attribute Authority and Fedlet metadata.</p>
         <p>The Java Fedlet includes a JSP file, <code class="filename">fedletAttrQuery.jsp</code>, which is used in the procedure described above to prepare an attribute query using the transient subject identifier obtained during single sign-on. The <code class="filename">fedletAttrQuery.jsp</code> also supports using the Subject name from an X.509 identity certificate.</p>
         <p>Another JSP file, <code class="filename">fedletAttrResp.jsp</code>, sends the query to the Attribute Authority using <code class="literal">com.sun.identity.saml2.profile.AttributeQueryUtil.html.getAttributesForFedlet()</code>, and if successful processes the result, which is a <code class="literal">java.util.Map</code> of the attribute types and their values.</p>
        </div>
        <div class="section" id="fedlet-perform-xacml-query">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">3.1.3.4.&nbsp;Performing XACML Queries</h4>
           </div>
          </div>
         </div>
         <p>As seen in the procedure, <a class="xref" href="#try-fedlet-xacml-query" title="Procedure&nbsp;3.4.&nbsp;To Try the Fedlet XACML Query">Procedure&nbsp;3.4, "To Try the Fedlet XACML Query"</a>, a XACML query allows the Fedlet to request a policy decision from a XACML PDP. You can configure OpenAM to respond to such queries as described in that procedure.</p>
         <p>The Java Fedlet includes a JSP file, <code class="filename">fedletXACMLQuery.jsp</code>, which is used in the procedure described above to prepare a XACML query, identifying a resource URL and a type of HTTP operation to perform, and specifying the subject identifier obtained during single sign-on.</p>
         <p>Another JSP file, <code class="filename">fedletXACMLResp.jsp</code>, sends the query to the XACML PDP using <code class="literal">com.sun.identity.saml2.profile.XACMLQueryUtil.getPolicyDecisionForFedlet()</code>, and if successful processes the result, which is a <code class="literal">java.lang.String</code> representing the decision, such as <code class="literal">Permit</code> if the decision is to allow access, or <code class="literal">Deny</code> if the decision is to deny access.</p>
        </div>
       </div>
      </div>
      <div lang="en" class="section" id="sec-fedlet-unconfigured">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">3.2.&nbsp;Configuring Java Fedlets By Hand</h2>
         </div>
        </div>
       </div>
       <a class="indexterm" name="d14232e12133"></a>
       <p> An OpenAM Fedlet is a small web application that makes it easy to add SAML v2.0 Service Provider (SP) capabilities to your Java web application. The OpenAM console offers a wizard for configuring a Java Fedlet as a SAML v2.0 Service Provider with OpenAM as the Identity Provider (IDP). If that fits your purposes, then read the chapter <a class="xref" href="#sec-fedlet-java" title="3.1.&nbsp;Using Fedlets in Java Web Applications">Section&nbsp;3.1, "Using Fedlets in Java Web Applications"</a> instead. </p>
       <p> The full distribution file, <code class="filename">OpenAM-13.0.0.zip</code>, also includes a Java Fedlet <code class="filename">Fedlet-13.0.0.zip</code> that you can configure manually. This chapter covers how to configure a Java Fedlet using that distribution, by manually editing the Circle of Trust, Java properties, and IDP and SP XML configuration templates. </p>
       <div class="itemizedlist">
        <p> Seen from a high level, what you must do is this: </p>
        <ul class="itemizedlist" style="list-style-type: disc; ">
         <li class="listitem"><p> Determine the roles that the IDP(s) and Fedlet play in SAML v2.0 Circles of Trust. </p></li>
         <li class="listitem"><p> Unpack the unconfigured Fedlet from the full OpenAM distribution to access the Fedlet war and template configuration files. </p></li>
         <li class="listitem"><p> Begin preparing the Fedlet configuration, including setting up a configuration directory and keystore if needed. </p></li>
         <li class="listitem"><p> Obtain SAML v2.0 metadata configuration files from the IDP(s), and add them to the Fedlet configuration. </p><p> The IDP must provide at least the standard SAML v2.0 metadata. </p></li>
         <li class="listitem"><p> Finish preparing the Fedlet configuration by editing the remaining Fedlet template configuration files. </p></li>
         <li class="listitem"><p> Share the Fedlet SAML v2.0 configuration files at least for the standard SAML v2.0 metadata with the IDP(s). </p><p> An IDP relies on the standard SAML v2.0 metadata to communicate with the Fedlet. </p></li>
         <li class="listitem"><p> Deploy and test the Fedlet with each IDP. </p></li>
        </ul>
       </div>
       <div class="section" id="unconfigured-fedlet-conf">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">3.2.1.&nbsp;Java Fedlet Layout</h3>
          </div>
         </div>
        </div>
        <p> Unpack the Java Fedlet distribution into a working directory. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">mkdir fedlet &amp;&amp; cd fedlet</strong>
$ <strong class="userinput">unzip ../Fedlet-13.0.0.zip</strong>
  </pre>
        <div class="variablelist">
         <p> When you unpack the <code class="filename">Fedlet-13.0.0.zip</code> file, you find the following files. </p>
         <dl class="variablelist">
          <dt>
           <span class="term"><code class="filename">Fedlet-13.0.0.war</code></span>
          </dt>
          <dd>
           <p> This file contains a Java Fedlet web application that serves as an example, and that you can embed in your applications. </p>
          </dd>
          <dt>
           <span class="term"><code class="filename">README</code></span>
          </dt>
          <dd>
           <p> This file succinctly describes how to configure some Fedlet features. </p>
          </dd>
          <dt>
           <span class="term"><code class="filename">conf/</code></span>
          </dt>
          <dd>
           <p> This folder contains the Fedlet configuration templates that you edit as appropriate for your deployment. </p>
           <p> When editing the templates, place copies of the files in the Fedlet home directory on the system where you deploy the Fedlet. By default the Fedlet home directory is <code class="filename"><em class="replaceable">user.home</em>/<em class="replaceable">uri</em></code>, where <em class="replaceable">user.home</em> is the value of the Java system property <code class="literal">user.home</code> for the user running the web container where you deploy the Fedlet, and <em class="replaceable">uri</em> is the path of the URI where you deploy the Fedlet, such as <code class="literal">/fedlet</code>. </p>
           <p> For example, if <em class="replaceable">user.home</em> is <code class="filename">/home/user</code>, that user could have a <code class="filename">/home/user/fedlet</code> folder for Fedlet configuration files. </p>
           <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">mkdir ~/fedlet</strong>
     </pre>
           <p> To change the location, set the system property <code class="literal">com.sun.identity.fedlet.home</code> when starting the container where the Fedlet runs. </p>
           <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">java -Dcom.sun.identity.fedlet.home=/path/to/fedlet/conf ...</strong>
     </pre>
          </dd>
          <dt>
           <span class="term"><code class="filename">conf/FederationConfig.properties</code></span>
          </dt>
          <dd>
           <p> This file defines settings for the Fedlet as a web application. It does not address the SAML v2.0 configuration. </p>
           <p> For more about this file, see <a class="xref" href="#unconfigured-fedlet-properties" title="3.2.2.&nbsp;Configuring Java Fedlet Properties">Section&nbsp;3.2.2, "Configuring Java Fedlet Properties"</a>. </p>
          </dd>
          <dt>
           <span class="term"><code class="filename">conf/fedlet.cot-template</code></span>
          </dt>
          <dd>
           <p> This template defines settings for a SAML v2.0 Circle of Trust to which the Fedlet belongs. </p>
           <p> For more about this file, see <a class="xref" href="#unconfigured-fedlet-cot" title="3.2.3.&nbsp;Configuring Circles of Trust">Section&nbsp;3.2.3, "Configuring Circles of Trust"</a>. </p>
          </dd>
          <dt>
           <span class="term"><code class="filename">conf/idp.xml</code> (not provided)</span>
          </dt>
          <dd>
           <p> The <code class="filename">idp.xml</code> file is standard SAML v2.0 metadata that describes the IDP configuration. </p>
           <p> Templates for other SAML v2.0 configuration files are provided, but no <code class="filename">idp.xml</code> template file is provided. </p>
           <p> Instead you must obtain the SAML v2.0 metadata from the IDP, and add it as <code class="filename">idp.xml</code> here, alongside the other SAML v2.0 configuration files. How you obtain this file from the IDP depends on the IDP implementation. </p>
          </dd>
          <dt>
           <span class="term"><code class="filename">conf/idp-extended.xml-template</code></span>
          </dt>
          <dd>
           <p> This template holds extended SAML v2.0 IDP settings that OpenAM uses. </p>
           <p> For more about this file, see <a class="xref" href="#unconfigured-fedlet-idp" title="3.2.4.&nbsp;Configuring the Identity Providers">Section&nbsp;3.2.4, "Configuring the Identity Providers"</a>. </p>
          </dd>
          <dt>
           <span class="term"><code class="filename">conf/sp.xml-template</code></span>
          </dt>
          <dd>
           <p> This template describes standard SAML v2.0 SP settings. </p>
           <p> For more about this file, see <a class="xref" href="#unconfigured-fedlet-sp" title="3.2.5.&nbsp;Configuring the Service Providers">Section&nbsp;3.2.5, "Configuring the Service Providers"</a>. </p>
          </dd>
          <dt>
           <span class="term"><code class="filename">conf/sp-extended.xml-template</code></span>
          </dt>
          <dd>
           <p> This template describes extended SAML v2.0 SP settings that the Fedlet uses. </p>
           <p> For more about this file, see <a class="xref" href="#unconfigured-fedlet-sp" title="3.2.5.&nbsp;Configuring the Service Providers">Section&nbsp;3.2.5, "Configuring the Service Providers"</a>. </p>
          </dd>
         </dl>
        </div>
       </div>
       <div class="section" id="unconfigured-fedlet-properties">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">3.2.2.&nbsp;Configuring Java Fedlet Properties</h3>
          </div>
         </div>
        </div>
        <p> The Java Fedlet to configure by hand includes a <code class="filename">Fedlet.properties</code> file that defines settings for the Fedlet as a web application. The configuration for a single Java Fedlet includes only one <code class="filename">Fedlet.properties</code> file, regardless of how many IDP and SP configurations are involved. This file does not address the SAML v2.0 configuration. </p>
        <p> When configured this file contains sensitive properties such as the value of <code class="literal">am.encryption.pwd</code>. Make sure it is readable only by the user running the Fedlet application. </p>
        <div class="itemizedlist">
         <p> This section categorizes the settings as follows: </p>
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p> <a class="xref" href="#unconfigured-fedlet-properties-deploy-url" title="Deployment URL Settings">Deployment URL Settings</a> </p></li>
          <li class="listitem"><p> <a class="xref" href="#unconfigured-fedlet-properties-logs" title="Log and Statistics Settings">Log and Statistics Settings</a> </p></li>
          <li class="listitem"><p> <a class="xref" href="#unconfigured-fedlet-properties-keys" title="Public and Private Key Settings">Public and Private Key Settings</a> </p></li>
          <li class="listitem"><p> <a class="xref" href="#unconfigured-fedlet-properties-alt-impl" title="Alternative Implementation Settings">Alternative Implementation Settings</a> </p></li>
         </ul>
        </div>
        <div class="variablelist" id="unconfigured-fedlet-properties-deploy-url">
         <div class="variablelist-title">
          Deployment URL Settings
         </div>
         <p> The following settings define the Fedlet deployment URL. </p>
         <dl class="variablelist">
          <dt>
           <span class="term"><code class="literal">com.iplanet.am.server.protocol</code></span>
          </dt>
          <dd>
           <p> Set this to the protocol portion of the URL, such as HTTP or HTTPS. </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.iplanet.am.server.host</code></span>
          </dt>
          <dd>
           <p> Set this to the host portion of the URL, such as <code class="literal">sp.example.com</code>. </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.iplanet.am.server.port</code></span>
          </dt>
          <dd>
           <p> Set this to the port portion of the URL, such as 80, 443, 8080, or 8443. </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.iplanet.am.services.deploymentDescriptor</code></span>
          </dt>
          <dd>
           <p> Set this to path portion of the URL, starting with a <code class="literal">/</code>, such as <code class="literal">/fedlet</code>. </p>
          </dd>
         </dl>
        </div>
        <div class="variablelist" id="unconfigured-fedlet-properties-logs">
         <div class="variablelist-title">
          Log and Statistics Settings
         </div>
         <p> The following settings define the Fedlet configuration for logging and monitoring statistics. </p>
         <dl class="variablelist">
          <dt>
           <span class="term"><code class="literal">com.iplanet.am.logstatus</code></span>
          </dt>
          <dd>
           <p> This sets whether the Fedlet actively writes debug log files. </p>
           <p> Default: <code class="literal">ACTIVE</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.iplanet.services.debug.level</code></span>
          </dt>
          <dd>
           <p> This sets the debug log level. </p>
           <p> The following settings are available, in order of increasing verbosity: </p>
           <table border="0" summary="Simple list" class="simplelist">
            <tbody>
             <tr>
              <td><code class="literal">off</code></td>
             </tr>
             <tr>
              <td><code class="literal">error</code></td>
             </tr>
             <tr>
              <td><code class="literal">warning</code></td>
             </tr>
             <tr>
              <td><code class="literal">message</code></td>
             </tr>
            </tbody>
           </table>
           <p> Default: <code class="literal">message</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.iplanet.services.debug.directory</code></span>
          </dt>
          <dd>
           <p> This sets the location of the debug log folder. </p>
           <p> Trailing spaces in the file names are significant. Even on Windows systems, use slashes to separate directories. </p>
           <p> Examples: <code class="filename">/home/user/fedlet/debug</code>, <code class="filename">C:/fedlet/debug</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.iplanet.am.stats.interval</code></span>
          </dt>
          <dd>
           <p> This sets the interval at which statistics are written, in seconds. </p>
           <p> The shortest interval supported is 5 seconds. Settings less than 5 (seconds) are taken as 5 seconds. </p>
           <p> Default: 60 </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.iplanet.services.stats.state</code></span>
          </dt>
          <dd>
           <p> This sets how the Fedlet writes monitoring statistics. </p>
           <p> The following settings are available: </p>
           <table border="0" summary="Simple list" class="simplelist">
            <tbody>
             <tr>
              <td><code class="literal">off</code></td>
             </tr>
             <tr>
              <td><code class="literal">console</code> (write to the container logs)</td>
             </tr>
             <tr>
              <td><code class="literal">file</code> (write to Fedlet stats logs)</td>
             </tr>
            </tbody>
           </table>
           <p> Default: <code class="literal">file</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.iplanet.services.stats.directory</code></span>
          </dt>
          <dd>
           <p> This sets the location of the stats file folder. </p>
           <p> Trailing spaces in the file names are significant. Even on Windows systems, use slashes to separate directories. </p>
           <p> Examples: <code class="filename">/home/user/fedlet/stats</code>, <code class="filename">C:/fedlet/stats</code> </p>
          </dd>
         </dl>
        </div>
        <div class="variablelist" id="unconfigured-fedlet-properties-keys">
         <div class="variablelist-title">
          Public and Private Key Settings
         </div>
         <p> The following settings define settings for access to certificates and private keys used in signing and encryption. </p>
         <p> For information about configuring a Fedlet for signing and encryption, including how to work with the keystores that these settings reference and how to specify public key certificates in standard SAML v2.0 metadata, see <a class="xref" href="#fedlet-signing-encryption" title="3.1.2.&nbsp;Signing &amp; Encryption For a Fedlet">Section&nbsp;3.1.2, "Signing &amp; Encryption For a Fedlet"</a>. </p>
         <dl class="variablelist">
          <dt>
           <span class="term"><code class="literal">com.sun.identity.saml.xmlsig.keystore</code></span>
          </dt>
          <dd>
           <p> This sets the path to the keystore file that holds public key certificates of IDPs and key pairs for the Fedlet. </p>
           <p> For hints on generating a keystore file with a key pair, see <a href="../admin-guide/index.html#change-signing-key" class="olink">Procedure&nbsp;23.3, "To Change the Default Signing Key"</a> in the <em>Administration Guide</em>. </p>
           <p> Example: <code class="filename">@FEDLET_HOME@/keystore.jks</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.sun.identity.saml.xmlsig.storepass</code></span>
          </dt>
          <dd>
           <p> This sets the path to the file that contains the keystore password encoded by using the symmetric key set as the value of <code class="literal">am.encryption.pwd</code>. </p>
           <div class="itemizedlist">
            <p> When creating the file, encode the clear text password by using your own test copy (not a production version) of OpenAM. </p>
            <ul class="itemizedlist" style="list-style-type: disc; ">
             <li class="listitem"><p> Log in to the OpenAM Console as administrator <code class="literal">amadmin</code>. </p></li>
             <li class="listitem"><p> Under Configuration &gt; Servers and Sites &gt; Security &gt; Encryption, set the Password Encryption Key to your symmetric key, and save your work. </p><p> Do not do this in a production system where the existing symmetric key is already in use! </p></li>
             <li class="listitem"><p> Switch to the <code class="filename">encode.jsp</code> page, such as <code class="literal">http://openam.example.com:8080/openam/encode.jsp</code>, enter the clear text password to encode with your symmetric key, and click Encode. </p></li>
             <li class="listitem"><p> Copy the encoded password to your file. </p></li>
            </ul>
           </div>
           <p> Example: <code class="filename">@FEDLET_HOME@/.storepass</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.sun.identity.saml.xmlsig.keypass</code></span>
          </dt>
          <dd>
           <p> This sets the path to the file that contains the private key password encoded by using the symmetric key set as the value of <code class="literal">am.encryption.pwd</code>. </p>
           <p> To encode the clear text password, follow the same steps for the password used when setting <code class="literal">com.sun.identity.saml.xmlsig.storepass</code>. </p>
           <p> Example: <code class="filename">@FEDLET_HOME@/.keypass</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.sun.identity.saml.xmlsig.certalias</code></span>
          </dt>
          <dd>
           <p> This sets the alias of the Fedlet's public key certificate. </p>
           <p> Example: <code class="literal">fedlet-cert</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.sun.identity.saml.xmlsig.storetype</code></span>
          </dt>
          <dd>
           <p> The sets the type of keystore. </p>
           <p> Default: <code class="literal">JKS</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">am.encryption.pwd</code></span>
          </dt>
          <dd>
           <p> This sets the symmetric key that used to encrypt and decrypt passwords. </p>
           <p> Example: <code class="literal">uu4dHvBkJJpIjPQWM74pxH3brZJ5gJje</code> </p>
          </dd>
         </dl>
        </div>
        <div class="variablelist" id="unconfigured-fedlet-properties-alt-impl">
         <div class="variablelist-title">
          Alternative Implementation Settings
         </div>
         <p> The Java Fedlet properties file includes settings that let you plug in alternative implementations of Fedlet capabilities. You can safely use the default settings, as specified in the following list. The list uses the same order for the keys you find in the file. </p>
         <dl class="variablelist">
          <dt>
           <span class="term"><code class="literal">com.sun.identity.plugin.configuration.class</code></span>
          </dt>
          <dd>
           <p> Default: <code class="literal">com.sun.identity.plugin.configuration.impl.FedletConfigurationImpl</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.sun.identity.plugin.datastore.class.default</code></span>
          </dt>
          <dd>
           <p> Default: <code class="literal">com.sun.identity.plugin.datastore.impl.FedletDataStoreProvider</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.sun.identity.plugin.log.class</code></span>
          </dt>
          <dd>
           <p> Default: <code class="literal">com.sun.identity.plugin.log.impl.FedletLogger</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.sun.identity.plugin.session.class</code></span>
          </dt>
          <dd>
           <p> Default: <code class="literal">com.sun.identity.plugin.session.impl.FedletSessionProvider</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.sun.identity.plugin.monitoring.agent.class</code></span>
          </dt>
          <dd>
           <p> Default: <code class="literal">com.sun.identity.plugin.monitoring.impl.FedletAgentProvider</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.sun.identity.plugin.monitoring.saml1.class</code></span>
          </dt>
          <dd>
           <p> Default: <code class="literal">com.sun.identity.plugin.monitoring.impl.FedletMonSAML1SvcProvider</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.sun.identity.plugin.monitoring.saml2.class</code></span>
          </dt>
          <dd>
           <p> Default: <code class="literal">com.sun.identity.plugin.monitoring.impl.FedletMonSAML2SvcProvider</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.sun.identity.plugin.monitoring.idff.class</code></span>
          </dt>
          <dd>
           <p> Default: <code class="literal">com.sun.identity.plugin.monitoring.impl.FedletMonIDFFSvcProvider</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.sun.identity.saml.xmlsig.keyprovider.class</code></span>
          </dt>
          <dd>
           <p> Default: <code class="literal">com.sun.identity.saml.xmlsig.JKSKeyProvider</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.sun.identity.saml.xmlsig.signatureprovider.class</code></span>
          </dt>
          <dd>
           <p> Default: <code class="literal">com.sun.identity.saml.xmlsig.AMSignatureProvider</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.sun.identity.common.serverMode</code></span>
          </dt>
          <dd>
           <p> Default: <code class="literal">false</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.sun.identity.webcontainer</code></span>
          </dt>
          <dd>
           <p> Default: <code class="literal">WEB_CONTAINER</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.sun.identity.saml.xmlsig.passwordDecoder</code></span>
          </dt>
          <dd>
           <p> Default: <code class="literal">com.sun.identity.fedlet.FedletEncodeDecode</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.iplanet.services.comm.server.pllrequest.maxContentLength</code></span>
          </dt>
          <dd>
           <p> Default: 16384 </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.iplanet.security.SecureRandomFactoryImpl</code></span>
          </dt>
          <dd>
           <p> Default: <code class="literal">com.iplanet.am.util.SecureRandomFactoryImpl</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.iplanet.security.SSLSocketFactoryImpl</code></span>
          </dt>
          <dd>
           <p> Default: <code class="literal">com.sun.identity.shared.ldap.factory.JSSESocketFactory</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.iplanet.security.encryptor</code></span>
          </dt>
          <dd>
           <p> Default: <code class="literal">com.iplanet.services.util.JCEEncryption</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.sun.identity.jss.donotInstallAtHighestPriority</code></span>
          </dt>
          <dd>
           <p> Default: <code class="literal">true</code> </p>
          </dd>
          <dt>
           <span class="term"><code class="literal">com.iplanet.services.configpath</code></span>
          </dt>
          <dd>
           <p> Default: <code class="literal">@BASE_DIR@</code> </p>
          </dd>
         </dl>
        </div>
       </div>
       <div class="section" id="unconfigured-fedlet-cot">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">3.2.3.&nbsp;Configuring Circles of Trust</h3>
          </div>
         </div>
        </div>
        <p> As described in <a class="xref" href="#unconfigured-fedlet-conf" title="3.2.1.&nbsp;Java Fedlet Layout">Section&nbsp;3.2.1, "Java Fedlet Layout"</a>, this template defines settings for a SAML v2.0 Circle of Trust. The Fedlet belongs to at least one Circle of Trust. </p>
        <div class="itemizedlist">
         <p> This section includes the following procedures: </p>
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p> <a class="xref" href="#unconfigured-fedlet-cot-single" title="Procedure&nbsp;3.7.&nbsp;To Configure a Circle of Trust With a Single IDP">Procedure&nbsp;3.7, "To Configure a Circle of Trust With a Single IDP"</a> </p></li>
          <li class="listitem"><p> <a class="xref" href="#unconfigured-fedlet-cot-multiple" title="Procedure&nbsp;3.8.&nbsp;To Configure Multiple Circles of Trust">Procedure&nbsp;3.8, "To Configure Multiple Circles of Trust"</a> </p></li>
          <li class="listitem"><p> <a class="xref" href="#unconfigured-fedlet-cot-discovery" title="Procedure&nbsp;3.9.&nbsp;To Configure a Circle of Trust With Multiple IDPs">Procedure&nbsp;3.9, "To Configure a Circle of Trust With Multiple IDPs"</a> </p></li>
         </ul>
        </div>
        <div class="procedure" id="unconfigured-fedlet-cot-single">
         <div class="procedure-inner">
          <div class="procedure-title">
           Procedure&nbsp;3.7.&nbsp;To Configure a Circle of Trust With a Single IDP
          </div>
          <p> When the Fedlet is involved in only a single Circle of Trust with one IDP and the Fedlet as an SP, the only settings to change are <code class="literal">cot-name</code> and <code class="literal">sun-fm-trusted-providers</code>. </p>
          <ol class="procedure" type="1">
           <li class="step"><p> Save a copy of the template as <code class="filename">fedlet.cot</code> in the configuration folder, as in the following example. </p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cp ~/Downloads/fedlet/conf/fedlet.cot-template ~/fedlet/fedlet.cot</strong>
    </pre></li>
           <li class="step"><p> Set <code class="literal">cot-name</code> to the name of the Circle of Trust. </p></li>
           <li class="step"><p> Set <code class="literal">sun-fm-trusted-providers</code> to a comma-separated list of the entity names for the IDP and SP. </p><p> For example, if the IDP is OpenAM with entity ID <code class="literal">https://openam.example.com:8443/openam</code> and the SP is the Fedlet with entity ID <code class="literal">https://sp.example.net:8443/fedlet</code>, then set the property as follows. </p><pre class="codelisting prettyprint ini">
sun-fm-trusted-providers=https://openam.example.com:8443/openam,\
 https://sp.example.net:8443/fedlet
    </pre></li>
          </ol>
         </div>
        </div>
        <div class="procedure" id="unconfigured-fedlet-cot-multiple">
         <div class="procedure-inner">
          <div class="procedure-title">
           Procedure&nbsp;3.8.&nbsp;To Configure Multiple Circles of Trust
          </div>
          <p> This procedure concerns deployments where the Fedlet participates as SP in multiple Circles of Trust, each involving their own IDP. </p>
          <ol class="procedure" type="1">
           <li class="step"><p> For each Circle of Trust, save a copy of the template in the configuration folder. </p><p> The following example involves two Circles of Trust. </p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cp ~/Downloads/fedlet/conf/fedlet.cot-template ~/fedlet/fedlet.cot</strong>
$ <strong class="userinput">cp ~/Downloads/fedlet/conf/fedlet.cot-template ~/fedlet/fedlet2.cot</strong>
    </pre></li>
           <li class="step"><p> Set up IDP XML files for each IDP as described in <a class="xref" href="#unconfigured-fedlet-idp" title="3.2.4.&nbsp;Configuring the Identity Providers">Section&nbsp;3.2.4, "Configuring the Identity Providers"</a>. </p></li>
           <li class="step"><p> For each Circle of Trust, set up the cot file as described in <a class="xref" href="#unconfigured-fedlet-cot-single" title="Procedure&nbsp;3.7.&nbsp;To Configure a Circle of Trust With a Single IDP">Procedure&nbsp;3.7, "To Configure a Circle of Trust With a Single IDP"</a>. </p></li>
           <li class="step"><p> In the extended SP XML file described in <a class="xref" href="#unconfigured-fedlet-idp" title="3.2.4.&nbsp;Configuring the Identity Providers">Section&nbsp;3.2.4, "Configuring the Identity Providers"</a>, set the Attribute element with name <code class="literal">cotlist</code> to include values for all Circles of Trust. The values are taken from the <code class="literal">cot-name</code> settings in the cot files. </p><p> The following example works with two Circles of Trust, <code class="literal">cot</code> and <code class="literal">cot2</code>. </p><pre class="codelisting prettyprint xml">
&lt;Attribute name="cotlist"&gt;
    &lt;Value&gt;cot&lt;/Value&gt;
    &lt;Value&gt;cot2&lt;/Value&gt;
&lt;/Attribute&gt;
</pre><p> The same Attribute element is also available in extended IDP XML files for cases where an IDP belongs to multiple Circles of Trust. </p></li>
          </ol>
         </div>
        </div>
        <div class="procedure" id="unconfigured-fedlet-cot-discovery">
         <div class="procedure-inner">
          <div class="procedure-title">
           Procedure&nbsp;3.9.&nbsp;To Configure a Circle of Trust With Multiple IDPs
          </div>
          <p> When the Circle of Trust involves multiple IDPs, use the Fedlet in combination with the OpenAM IDP Discovery service. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p> For this to work, the IDPs must be configured to use IDP discovery, and users must have preferred IDPs. </p>
           </div>
          </div>
          <ol class="procedure" type="1">
           <li class="step"><p> Set up the OpenAM IDP Discovery service. </p><p> For details see <a href="../admin-guide/index.html#deploy-idp-discovery" class="olink">Section&nbsp;12.4.6, "Deploying the Identity Provider Discovery Service"</a> in the <em>Administration Guide</em>. </p></li>
           <li class="step"><p> Configure the Circle of Trust as described in <a class="xref" href="#unconfigured-fedlet-cot-single" title="Procedure&nbsp;3.7.&nbsp;To Configure a Circle of Trust With a Single IDP">Procedure&nbsp;3.7, "To Configure a Circle of Trust With a Single IDP"</a>, but specifying multiple IDPs, including the IDP that provides the IDP Discovery service. </p></li>
           <li class="step"><p> Set the <code class="literal">sun-fm-saml2-readerservice-url</code> and the <code class="literal">sun-fm-saml2-writerservice-url</code> properties as defined for the IDP Discovery service. </p></li>
          </ol>
         </div>
        </div>
       </div>
       <div class="section" id="unconfigured-fedlet-idp">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">3.2.4.&nbsp;Configuring the Identity Providers</h3>
          </div>
         </div>
        </div>
        <p> As described in <a class="xref" href="#unconfigured-fedlet-conf" title="3.2.1.&nbsp;Java Fedlet Layout">Section&nbsp;3.2.1, "Java Fedlet Layout"</a>, the IDP provides its standard SAML v2.0 metadata as XML, which you save in the configuration folder as <code class="filename">idp.xml</code>. If the IDP uses OpenAM, the IDP can also provide extended SAML v2.0 metadata as XML, which you save in the configuration folder as <code class="filename">idp-extended.xml</code>, rather than using the template for extended information. </p>
        <p> If you have multiple identity providers, then number the configuration files, as in <code class="filename">idp.xml</code>, <code class="filename">idp2.xml</code>, <code class="filename">idp3.xml</code>, and also <code class="filename">idp-extended.xml</code>, <code class="filename">idp2-extended.xml</code>, <code class="filename">idp3-extended.xml</code> and so on. </p>
        <div class="section" id="unconfigured-fedlet-idp-standard">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">3.2.4.1.&nbsp;Identity Provider Standard XML</h4>
           </div>
          </div>
         </div>
         <p> This section covers the configuration in <code class="filename">idp.xml</code>. The <code class="filename">idp.xml</code> file contains standard SAML v2.0 metadata for an IDP in a Circle of Trust that includes the Fedlet as SP. The IDP provides you the content of this file. </p>
         <p> If the IDP uses OpenAM then the administrator can export the metadata by using either the <span class="command"><strong>ssoadm create-metadata-templ</strong></span> command or the <code class="literal">/saml2/jsp/exportmetadata.jsp</code> endpoint under the OpenAM deployment URL. </p>
         <p> If the IDP uses an implementation different from OpenAM, see the documentation for details on obtaining the standard metadata. The standard, product-independent metadata are covered in <a class="link" href="http://docs.oasis-open.org/security/saml/v2.0/saml-metadata-2.0-os.pdf" target="_blank"><em class="citetitle">Metadata for the OASIS Security Assertion Markup Language (SAML) V2.0</em></a>. The standard XML namespace describing the XML document has identifier <code class="literal">urn:oasis:names:tc:SAML:2.0:metadata</code>. An XML schema description for this namespace is found online at <a class="link" href="http://docs.oasis-open.org/security/saml/v2.0/saml-schema-metadata-2.0.xsd" target="_blank">http://docs.oasis-open.org/security/saml/v2.0/saml-schema-metadata-2.0.xsd</a>. </p>
        </div>
        <div class="section" id="unconfigured-fedlet-idp-extended">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">3.2.4.2.&nbsp;Identity Provider Extended XML</h4>
           </div>
          </div>
         </div>
         <p> This section covers the configuration in <code class="filename">idp-extended.xml</code>. Most extended metadata are specific to the OpenAM implementation of SAML v2.0. If the IDP runs OpenAM, have the IDP provide the extended metadata exported by using the <span class="command"><strong>ssoadm create-metadata-templ</strong></span> command. This section covers only the basic settings relative to all IDPs. </p>
         <p> The extended metadata file describes an <code class="sgmltag-element">EntityConfig</code> element, defined by the namespace with the identifier <code class="literal">urn:sun:fm:SAML:2.0:entityconfig</code>. The XML schema definition is described in <code class="filename">entity-config-schema.xsd</code>, available online as part of the OpenAM source code, though not included in the OpenAM war file. </p>
         <p> The unconfigured Fedlet includes a template file, <code class="filename">conf/idp-extended.xml-template</code>. This extended metadata template for the IDP requires that you edit at least the <code class="literal">IDP_ENTITY_ID</code> and <code class="literal">fedletcot</code> values to reflect the IDP entity ID used in the standard metadata and the Circle of Trust name defined in <code class="filename">fedlet.cot</code>, respectively. The <code class="literal">hosted</code> attribute on the <code class="sgmltag-element">EntityConfig</code> element must remain set to <code class="literal">hosted="0"</code>, meaning that the IDP is remote. The IDP is likely to play at least the role of SSO Identity Provider, though the namespace defines elements for the Attribute Authority and Policy Decision Point roles shown in the template, as well as the others defined in the standard governing SAML v2.0 metadata. </p>
         <p> The extended metadata file is essentially a series of XML maps of key-value pairs specifying IDP configuration for each role. All role-level elements can take a <code class="literal">metaAlias</code> attribute that the Fedlet uses when communicating with the IDP. Each child element of a role element defines an <code class="sgmltag-element">Attribute</code> whose <code class="literal">name</code> is the key. Each <code class="sgmltag-element">Attribute</code> element can contain multiple <code class="sgmltag-element">Value</code> elements. The <code class="sgmltag-element">Value</code> elements' contents comprise the values for the key. All values are strings, sometimes with a format that is meaningful to OpenAM. The basic example in the IDP template shows the minimal configuration for the SSO IDP role. </p>
         <p> In the following example, the <code class="literal">description</code> is empty and the name of the Circle of Trust is <code class="literal">fedletcot</code>. </p>
         <pre class="codelisting prettyprint xml">
&lt;IDPSSOConfig&gt;
&lt;Attribute name="description"&gt;
    &lt;Value/&gt;
&lt;/Attribute&gt;
&lt;Attribute name="cotlist"&gt;
    &lt;Value&gt;fedletcot&lt;/Value&gt;
&lt;/Attribute&gt;
</pre>
         <p> When functioning as IDP, OpenAM can take many other <code class="sgmltag-element">Attribute</code> values. These are implementation dependent. You can obtain the extended metadata from OpenAM either as part of the pre-packaged Java Fedlet that you create by using the OpenAM console wizard as described in <a class="xref" href="#create-a-java-fedlet" title="Procedure&nbsp;3.1.&nbsp;To Create a Fedlet">Procedure&nbsp;3.1, "To Create a Fedlet"</a>, or by using the <span class="command"><strong>ssoadm create-metadata-templ</strong></span> subcommand. </p>
         <div class="panel panel-info">
          <div class="panel-heading">
           <h3 class="panel-title">Note</h3>
          </div>
          <div class="panel-body">
           <p> Custom authentication contexts can be loaded and saved when they are loaded via ssoadm as part of the hosted IDP/SP extended metadata and the saves are made in the console. Any custom contexts loaded via ssoadm are also visible in the console. </p>
           <p> For example, you can specify custom entries in the <code class="literal">idpAuthncontextClassrefMapping</code> element of the extended metadata for a hosted IDP as follows: </p>
           <pre class="codelisting prettyprint nohighlight">
&lt;Attribute name="idpAuthncontextClassrefMapping"&gt;
 &lt;Value&gt;urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport
  |1||default&lt;/Value&gt;
 &lt;Value&gt;http://idmanagement.gov/ns/assurance/loa/4|4||&lt;/Value&gt;
 &lt;Value&gt;http://idmanagement.gov/ns/assurance/loa/3|3||&lt;/Value&gt;
 &lt;Value&gt;http://idmanagement.gov/ns/assurance/loa/2|2||&lt;/Value&gt;
 &lt;Value&gt;http://idmanagement.gov/ns/assurance/loa/1|1||&lt;/Value&gt;
&lt;/Attribute&gt;
    </pre>
          </div>
         </div>
        </div>
       </div>
       <div class="section" id="unconfigured-fedlet-sp">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">3.2.5.&nbsp;Configuring the Service Providers</h3>
          </div>
         </div>
        </div>
        <p> As mentioned in <a class="xref" href="#unconfigured-fedlet-conf" title="3.2.1.&nbsp;Java Fedlet Layout">Section&nbsp;3.2.1, "Java Fedlet Layout"</a>, the Fedlet SAML v2.0 configuration is defined in two XML files, the standard metadata in <code class="filename">sp.xml</code> and the extended metadata in <code class="filename">sp-extended.xml</code>. </p>
        <p> If the Fedlet has multiple service provider personalities, then number the configuration files, as in <code class="filename">sp.xml</code>, <code class="filename">sp2.xml</code>, <code class="filename">sp3.xml</code>, and also <code class="filename">sp-extended.xml</code>, <code class="filename">sp2-extended.xml</code>, <code class="filename">sp3-extended.xml</code> and so on. </p>
        <div class="section" id="unconfigured-fedlet-sp-standard">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">3.2.5.1.&nbsp;Service Provider Standard XML</h4>
           </div>
          </div>
         </div>
         <p> This section covers the configuration in <code class="filename">sp.xml</code>. The <code class="filename">sp.xml</code> file contains standard SAML v2.0 metadata for the Fedlet as SP. If you edit the standard metadata, make sure that you provide the new version to your IDP, as the IDP software relies on the metadata to get the Fedlet's configuration. </p>
         <p> The standard metadata are covered in <a class="link" href="http://docs.oasis-open.org/security/saml/v2.0/saml-metadata-2.0-os.pdf" target="_blank"><em class="citetitle">Metadata for the OASIS Security Assertion Markup Language (SAML) V2.0</em></a>. The standard XML namespace describing the XML document has identifier <code class="literal">urn:oasis:names:tc:SAML:2.0:metadata</code>. An XML schema description for this namespace is found online at <a class="link" href="http://docs.oasis-open.org/security/saml/v2.0/saml-schema-metadata-2.0.xsd" target="_blank">http://docs.oasis-open.org/security/saml/v2.0/saml-schema-metadata-2.0.xsd</a>. </p>
         <p> A standard metadata file describes the SAML v2.0 roles that the Fedlet plays. The default base element of the file is an <code class="sgmltag-element">EntityDescriptor</code>, which is a container for role descriptor elements. The <code class="sgmltag-element">EntityDescriptor</code> element can therefore contain multiple role descriptor elements. The namespace for the standard metadata document is <code class="literal">urn:oasis:names:tc:SAML:2.0:metadata</code>. You can get the corresponding XML schema description online at <a class="link" href="http://docs.oasis-open.org/security/saml/v2.0/saml-schema-metadata-2.0.xsd" target="_blank">http://docs.oasis-open.org/security/saml/v2.0/saml-schema-metadata-2.0.xsd</a>. In general, you can find standard SAML v2.0-related XML schema definitions at <a class="link" href="http://docs.oasis-open.org/security/saml/v2.0/" target="_blank">http://docs.oasis-open.org/security/saml/v2.0/</a>. </p>
         <p> Fedlets do not support all arbitrary SP configurations. As lightweight Service Provider components, Fedlets are built to play the SP role in web single sign-on and single logout, to perform attribute queries and XACML policy decision requests, and to work with multiple IDPs including Circles of Trust with an IDP discovery service. For a list of what Fedlets support, see the table <a href="../admin-guide/index.html#fedlet-saml2-features" class="olink">Table&nbsp;12.2, "Fedlet Support for SAML v2.0 Features"</a> in the <em>Administration Guide</em>. </p>
         <div class="itemizedlist">
          <p> When preparing a standard SP metadata file, follow these suggestions. </p>
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p> Start either with an existing example or with the template, <code class="filename">conf/sp.xml-template</code>. </p></li>
           <li class="listitem"><p> When using the template, replace the following placeholders. </p>
            <div class="variablelist">
             <dl class="variablelist">
              <dt>
               <span class="term"><code class="literal">FEDLET_ENTITY_ID</code></span>
              </dt>
              <dd>
               <p> The Fedlet entity ID used when communicating with the IDP. </p>
               <p> OpenAM often uses the deployment URL as the entity ID, though that is a convention rather than a requirement. </p>
              </dd>
              <dt>
               <span class="term"><code class="literal">FEDLET_PROTOCOL</code></span>
              </dt>
              <dd>
               <p> The Fedlet deployment protocol (<code class="literal">http</code>, <code class="literal">https</code>) </p>
              </dd>
              <dt>
               <span class="term"><code class="literal">FEDLET_HOST</code></span>
              </dt>
              <dd>
               <p> The Fedlet deployment host name </p>
              </dd>
              <dt>
               <span class="term"><code class="literal">FEDLET_PORT</code></span>
              </dt>
              <dd>
               <p> The Fedlet deployment port number </p>
              </dd>
              <dt>
               <span class="term"><code class="literal">FEDLET_DEPLOY_URI</code></span>
              </dt>
              <dd>
               <p> The Fedlet application deployment path </p>
              </dd>
             </dl>
            </div></li>
           <li class="listitem"><p> Add and edit role elements as children depending on the roles the Fedlet plays as described in the following sections. </p></li>
          </ul>
         </div>
         <div class="section" id="unconfigured-fedlet-sp-standard-sso">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">3.2.5.1.1.&nbsp;Single Sign-On and Logout: SPSSODescriptor Element</h5>
            </div>
           </div>
          </div>
          <p> Add an <code class="sgmltag-element">SPSSODescriptor</code> element to play the SP role in web single sign-on and logout. An <code class="sgmltag-element">SPSSODescriptor</code> element has attributes specifying whether requests and assertion responses should be digitally signed. </p>
          <div class="itemizedlist">
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p> The <code class="literal">AuthnRequestsSigned</code> attribute indicates whether the Fedlet signs authentication requests. </p><p> If you set the <code class="literal">AuthnRequestsSigned</code> attribute to true, then you must also configure the <code class="sgmltag-element">SPSSODescriptor</code> element to allow the Fedlet to sign requests. For details see the section on <a class="xref" href="#fedlet-signing-encryption" title="3.1.2.&nbsp;Signing &amp; Encryption For a Fedlet">Section&nbsp;3.1.2, "Signing &amp; Encryption For a Fedlet"</a>. </p></li>
            <li class="listitem"><p> The <code class="literal">WantAssertionsSigned</code> attribute indicates whether the Fedlet requests signed assertion responses from the IDP. </p></li>
           </ul>
          </div>
          <p> An <code class="sgmltag-element">SPSSODescriptor</code> element's children indicate what name ID formats the Fedlet supports, and where the IDP can call the following services on the Fedlet. </p>
          <div class="itemizedlist">
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p> The <code class="sgmltag-element">AssertionConsumerService</code> elements specify endpoints that support the SAML Authentication Request protocols. </p><p> You must specify at least one of these. The template specifies two, with the endpoint supporting the HTTP POST binding as the default. </p></li>
            <li class="listitem"><p> The optional <code class="sgmltag-element">SingleLogoutService</code> elements specify endpoints that support the SAML Single Logout protocols. </p></li>
           </ul>
          </div>
         </div>
         <div class="section" id="unconfigured-fedlet-sp-standard-attr-query">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">3.2.5.1.2.&nbsp;Attribute Queries: RoleDescriptor Element</h5>
            </div>
           </div>
          </div>
          <p> Add a <code class="sgmltag-element">RoleDescriptor</code> element with <code class="literal">type="query:AttributeQueryDescriptorType"</code> to perform attribute queries. </p>
          <p> Attribute queries require the IDP to act as Attribute Authority and call for signing and encryption to be configured for the Fedlet. For details, see the example in the procedure <a class="xref" href="#try-fedlet-attribute-query" title="Procedure&nbsp;3.3.&nbsp;To Try the Fedlet Attribute Query">Procedure&nbsp;3.3, "To Try the Fedlet Attribute Query"</a>. For example, you can set the attribute mapping on the Fedlet by editing the extended metadata attribute <code class="literal">attributeMap</code> in the <code class="sgmltag-element">SPSSOConfig</code> element as described in <a class="xref" href="#unconfigured-fedlet-sp-extended-spssoconfig" title="3.2.5.2.1.&nbsp;Service Provider Extended XML: SPSSOConfig Settings">Section&nbsp;3.2.5.2.1, "Service Provider Extended XML: SPSSOConfig Settings"</a>. </p>
         </div>
         <div class="section" id="unconfigured-fedlet-sp-standard-xacml">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">3.2.5.1.3.&nbsp;XACML Requests: XACMLAuthzDecisionQueryDescriptor Element</h5>
            </div>
           </div>
          </div>
          <p> Add an <code class="sgmltag-element">XACMLAuthzDecisionQueryDescriptor</code> element to perform XACML policy decision queries. </p>
          <p> Attribute queries require the IDP to act as XACML PDP. For details see the example in the procedure <a class="xref" href="#try-fedlet-xacml-query" title="Procedure&nbsp;3.4.&nbsp;To Try the Fedlet XACML Query">Procedure&nbsp;3.4, "To Try the Fedlet XACML Query"</a>. </p>
         </div>
        </div>
        <div class="section" id="unconfigured-fedlet-sp-extended">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">3.2.5.2.&nbsp;Service Provider Extended XML</h4>
           </div>
          </div>
         </div>
         <p> This section covers the configuration in the <code class="filename">sp-extended.xml</code> file. The extended metadata are specific to the OpenAM implementation of SAML v2.0. </p>
         <p> The extended metadata file describes an <code class="sgmltag-element">EntityConfig</code> element, defined by the namespace with the identifier <code class="literal">urn:sun:fm:SAML:2.0:entityconfig</code>. The XML schema definition is described in <code class="filename">entity-config-schema.xsd</code>, available online as part of the OpenAM source code, though not included with the unconfigured Fedlet. </p>
         <p> The unconfigured Fedlet does include a template file, <code class="filename">conf/sp-extended.xml-template</code>. This extended metadata template for the IDP requires that you edit at least the <code class="literal">FEDLET_ENTITY_ID</code> placeholder value, the <code class="literal">appLogoutUrl</code> attribute value in the <code class="sgmltag-element">SPSSOConfig</code> element, and the <code class="literal">fedletcot</code> values. The <code class="literal">FEDLET_ENTITY_ID</code> value must reflect the SP entity ID used in the standard metadata. For the single logout profile, the <code class="literal">appLogoutUrl</code> attribute value must match the Fedlet URL based on the values used in the <code class="filename">FederationConfig.properties</code> file. The <code class="literal">fedletcot</code> values must correspond to the Circle of Trust name defined in <code class="filename">fedlet.cot</code>. </p>
         <p> The <code class="literal">hosted</code> attribute on the <code class="sgmltag-element">EntityConfig</code> element must remain set to <code class="literal">hosted="1"</code>, meaning that the SP is hosted (local to the Fedlet). If you provide a copy of the file to your IDP running OpenAM, however, then set <code class="literal">hosted="0"</code> for the IDP, as the Fedlet is remote to the IDP. </p>
         <p> The extended metadata file is essentially a series of XML maps of key-value pairs specifying IDP configuration for each role. All role-level elements can take a <code class="literal">metaAlias</code> attribute that the Fedlet uses when communicating with the IDP. Each child element of a role element defines an <code class="sgmltag-element">Attribute</code> whose <code class="literal">name</code> is the key. Each <code class="sgmltag-element">Attribute</code> element can contain multiple <code class="sgmltag-element">Value</code> elements. The <code class="sgmltag-element">Value</code> elements' contents comprise the values for the key. All values are strings, sometimes with a format that is meaningful to the Fedlet. The basic example in the SP template shows the configuration options, documented in the following lists. </p>
         <div class="section" id="unconfigured-fedlet-sp-extended-spssoconfig">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">3.2.5.2.1.&nbsp;Service Provider Extended XML: SPSSOConfig Settings</h5>
            </div>
           </div>
          </div>
          <p> This section covers elements for the SP SSO role, arranged in the order they appear in the template. </p>
          <div class="variablelist">
           <dl class="variablelist">
            <dt>
             <span class="term"><code class="literal">description</code></span>
            </dt>
            <dd>
             <p> Human-readable description of the Fedlet in the SP SSO role </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">signingCertAlias</code></span>
            </dt>
            <dd>
             <p> Alias of the public key certificate for the key pair used when signing messages to the IDP </p>
             <p> The key pair is found in the Fedlet's keystore, and the certificate is included in the standard metadata. See <a class="xref" href="#unconfigured-fedlet-properties-keys" title="Public and Private Key Settings">Public and Private Key Settings</a> for details on how to specify access to the keystore, and <a class="xref" href="#unconfigured-fedlet-sp-standard" title="3.2.5.1.&nbsp;Service Provider Standard XML">Section&nbsp;3.2.5.1, "Service Provider Standard XML"</a> for details on how to set up standard metadata. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">encryptionCertAlias</code></span>
            </dt>
            <dd>
             <p> Alias of the public key certificate for the key pair used when encrypting messages to the IDP </p>
             <p> The key pair is found in the Fedlet's keystore, and the certificate is included in the standard metadata. See <a class="xref" href="#unconfigured-fedlet-properties-keys" title="Public and Private Key Settings">Public and Private Key Settings</a> for details on how to specify access to the keystore, and <a class="xref" href="#unconfigured-fedlet-sp-standard" title="3.2.5.1.&nbsp;Service Provider Standard XML">Section&nbsp;3.2.5.1, "Service Provider Standard XML"</a> for details on how to set up standard metadata. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">basicAuthOn</code></span>
            </dt>
            <dd>
             <p> Set this to true to use HTTP Basic authorization with the IDP. </p>
             <p> Default: false </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">basicAuthUser</code></span>
            </dt>
            <dd>
             <p> When using HTTP Basic authorization with the IDP, this value is the user name. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">basicAuthPassword</code></span>
            </dt>
            <dd>
             <p> When using HTTP Basic authorization with the IDP, this value is the password. </p>
             <p> Encrypt the password using the <code class="filename">encode.jsp</code> page of your test copy of OpenAM that you might also have used to encode keystore passwords as described in <a class="xref" href="#unconfigured-fedlet-properties-keys" title="Public and Private Key Settings">Public and Private Key Settings</a>. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">autofedEnabled</code></span>
            </dt>
            <dd>
             <p> Set this to true to enable automatic federation with OpenAM based on the value of a profile attribute that is common to user profiles both in OpenAM and in the Fedlet's context. </p>
             <p> Default: false </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">autofedAttribute</code></span>
            </dt>
            <dd>
             <p> When automatic federation is enabled, set this to the name of the user profile attribute used for automatic federation. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">transientUser</code></span>
            </dt>
            <dd>
             <p> Use this effective identity for users with transient identifiers. </p>
             <p> Default: anonymous </p>
            </dd>
            <dt>
             <span class="term">spAdapter</span>
            </dt>
            <dd>
             <p> Class name for a plugin service provider adapter </p>
             <p> This class must extend <code class="literal">com.sun.identity.saml2.plugins.SAML2ServiceProviderAdapter</code>. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">spAdapterEnv</code></span>
            </dt>
            <dd>
             <p> When using a plugin service provider adapter, this attribute's values optionally take a map of settings <code class="literal"><em class="replaceable">key</em>=<em class="replaceable">value</em></code> used to initialize the plugin. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">fedletAdapter</code></span>
            </dt>
            <dd>
             <p> Class name for an alternate fedlet adapter </p>
             <p> Default: <code class="literal">com.sun.identity.saml2.plugins.DefaultFedletAdapter</code> </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">fedletAdapterEnv</code></span>
            </dt>
            <dd>
             <p> When using an alternate fedlet adapter, this attribute's values optionally take a map of settings <code class="literal"><em class="replaceable">key</em>=<em class="replaceable">value</em></code> used to initialize the plugin. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">spAccountMapper</code></span>
            </dt>
            <dd>
             <p> Class name for an implementation mapping SAML protocol objects to local user profiles </p>
             <p> Default: <code class="literal">com.sun.identity.saml2.plugins.DefaultLibrarySPAccountMapper</code> </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">spAttributeMapper</code></span>
            </dt>
            <dd>
             <p> Class name for an implementation mapping SAML assertion attributes to local user profile attributes </p>
             <p> Default: <code class="literal">com.sun.identity.saml2.plugins.DefaultSPAttributeMapper</code> </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">spAuthncontextMapper</code></span>
            </dt>
            <dd>
             <p> Class name for an implementation determining the authentication context to set in an authentication request, and mapping the authentication context to an authentication level </p>
             <p> Default: <code class="literal">com.sun.identity.saml2.plugins.DefaultSPAuthnContextMapper</code> </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">spAuthncontextClassrefMapping</code></span>
            </dt>
            <dd>
             <p> String defining how the SAML authentication context classes map to authentication levels and indicate the default context class </p>
             <p> Format: <code class="literal"><em class="replaceable">authnContextClass</em>|<em class="replaceable">authLevel</em>[|default]</code> </p>
             <p> Default: <code class="literal">urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport|0|default</code> </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">spAuthncontextComparisonType</code></span>
            </dt>
            <dd>
             <p> How to evaluate authentication context class identifiers. </p>
             <div class="variablelist">
              <dl class="variablelist">
               <dt>
                <span class="term"><code class="literal">exact</code></span>
               </dt>
               <dd>
                <p> Assertion context must exactly match a context in the list </p>
               </dd>
               <dt>
                <span class="term"><code class="literal">minimum</code></span>
               </dt>
               <dd>
                <p> Assertion context must be at least as strong as a context in the list </p>
               </dd>
               <dt>
                <span class="term"><code class="literal">maximum</code></span>
               </dt>
               <dd>
                <p> Assertion context must be no stronger than a context in the list </p>
               </dd>
               <dt>
                <span class="term"><code class="literal">better</code></span>
               </dt>
               <dd>
                <p> Assertion context must be stronger than all contexts in the list </p>
               </dd>
              </dl>
             </div>
             <p> Default: <code class="literal">exact</code> </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">attributeMap</code></span>
            </dt>
            <dd>
             <p> Map of SAML assertion attributes to local user profile attributes </p>
             <p> Default: <code class="literal">*=*</code> </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">saml2AuthModuleName</code></span>
            </dt>
            <dd>
             <p> Name of an alternative SAML v2.0 authentication module </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">localAuthURL</code></span>
            </dt>
            <dd>
             <p> URL to a login page on the Fedlet side </p>
             <p> Use this to override the Assertion Consumer Service URL from the standard metadata when consuming assertions. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">intermediateUrl</code></span>
            </dt>
            <dd>
             <p> URL to an intermediate page returned before the user accesses the final protected resource </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">defaultRelayState</code></span>
            </dt>
            <dd>
             <p> If no RelayState is specified in a SAML request, redirect to this URL after successful single sign-on. </p>
             <p> URL-encode the <code class="literal">defaultRelayState</code> value. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">appLogoutUrl</code></span>
            </dt>
            <dd>
             <p> One or more Fedlet URLs that initiate single logout </p>
             <p> Replace the placeholders in the default with the values for your Fedlet. </p>
             <p> Default: <code class="literal">FEDLET_PROTOCOL://FEDLET_HOST:FEDLET_PORT/FEDLET_DEPLOY_URI/logout</code> </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">assertionTimeSkew</code></span>
            </dt>
            <dd>
             <p> Tolerate clock skew between the Fedlet and the IDP of at most this number of seconds </p>
             <p> Default: 300 </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">wantAttributeEncrypted</code></span>
            </dt>
            <dd>
             <p> Set to true to request that the IDP encrypt attributes in the response </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">wantAssertionEncrypted</code></span>
            </dt>
            <dd>
             <p> Set to true to request that the IDP encrypt the SAML assertion in the response </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">wantNameIDEncrypted</code></span>
            </dt>
            <dd>
             <p> Set to true to request that the IDP encrypt the name ID in the response </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">wantPOSTResponseSigned</code></span>
            </dt>
            <dd>
             <p> Set to true to request that the IDP sign the response when using HTTP POST </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">wantArtifactResponseSigned</code></span>
            </dt>
            <dd>
             <p> Set to true to request that the IDP sign the response when using HTTP Artifact </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">wantLogoutRequestSigned</code></span>
            </dt>
            <dd>
             <p> Set to true to request that the IDP sign single logout requests </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">wantLogoutResponseSigned</code></span>
            </dt>
            <dd>
             <p> Set to true to request that the IDP sign single logout responses </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">wantMNIRequestSigned</code></span>
            </dt>
            <dd>
             <p> Set to true to request that the IDP manage name ID requests </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">wantMNIResponseSigned</code></span>
            </dt>
            <dd>
             <p> Set to true to request that the IDP manage name ID responses </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">cotlist</code></span>
            </dt>
            <dd>
             <p> Set this to the Circle of Trust name used in <a class="xref" href="#unconfigured-fedlet-cot" title="3.2.3.&nbsp;Configuring Circles of Trust">Section&nbsp;3.2.3, "Configuring Circles of Trust"</a>. </p>
             <p> Default: <code class="literal">fedletcot</code> </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">saeAppSecretList</code></span>
            </dt>
            <dd>
             <p> When using Secure Attribute Exchange with OpenAM this represents the Application Security Configuration settings. </p>
             <p> Values take the format <code class="literal">url=<em class="replaceable">FedletURL</em>|type=<em class="replaceable">symmetric</em>|secret=<em class="replaceable">EncodedSharedSecret</em>[|encryptionalgorithm=<em class="replaceable">EncAlg</em>|encryptionkeystrength=<em class="replaceable">EncStrength</em>]</code> or <code class="literal">url=<em class="replaceable">FedletURL</em>|type=<em class="replaceable">asymmetric</em>|privatekeyalias=<em class="replaceable">FedletSigningCertAlias</em>[|encryptionalgorithm=<em class="replaceable">EncAlg</em>|encryptionkeystrength=<em class="replaceable">EncStrength</em>|pubkeyalias=<em class="replaceable">FedletPublicKeyAlias</em>]</code> </p>
             <p> You can omit the <code class="literal">privatekeyalias</code> setting if the signing certifcate is specified in the standard metadata. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">saeSPUrl</code></span>
            </dt>
            <dd>
             <p> When using Secure Attribute Exchange (SAE) with OpenAM this is the Fedlet URL that handles SAE requests. If this is omitted, then SAE is not enabled. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">saeSPLogoutUrl</code></span>
            </dt>
            <dd>
             <p> When using Secure Attribute Exchange with OpenAM this is the Fedlet URL that handles SAE global logout requests. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">ECPRequestIDPListFinderImpl</code></span>
            </dt>
            <dd>
             <p> When using the Enhanced Client and Proxy profile this is the class name for the implementation that returns a list of preferred IDPs trusted by the ECP. </p>
             <p> Default: <code class="literal">com.sun.identity.saml2.plugins.ECPIDPFinder</code> </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">ECPRequestIDPList</code></span>
            </dt>
            <dd>
             <p> When using the Enhanced Client and Proxy profile this is the list of IDPs for the ECP to contact. </p>
             <p> When not specified the list finder implementation is used. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">enableIDPProxy</code></span>
            </dt>
            <dd>
             <p> Set this to true to enable IDP proxy functionality. </p>
             <p> Default: false </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">idpProxyList</code></span>
            </dt>
            <dd>
             <p> A list of preferred IDPs that the Fedlet can proxy to </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">idpProxyCount</code></span>
            </dt>
            <dd>
             <p> Number of IDP proxies that the Fedlet can have </p>
             <p> Default: 0 </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">useIntroductionForIDPProxy</code></span>
            </dt>
            <dd>
             <p> Set this to true to pick a preferred IDP based on a SAML v2.0 introduction cookie. </p>
             <p> Default: false </p>
            </dd>
           </dl>
          </div>
         </div>
         <div class="section" id="unconfigured-fedlet-sp-extended-attributequeryconfig">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">3.2.5.2.2.&nbsp;Service Provider Extended XML: AttributeQueryConfig Settings</h5>
            </div>
           </div>
          </div>
          <p> This section covers elements for the Attribute Requester role, arranged in the order they appear in the template. </p>
          <div class="variablelist">
           <dl class="variablelist">
            <dt>
             <span class="term"><code class="literal">signingCertAlias</code></span>
            </dt>
            <dd>
             <p> Alias of the public key certificate for the key pair used when signing messages to the IDP </p>
             <p> The key pair is found in the Fedlet's keystore, and the certificate is included in the standard metadata. See <a class="xref" href="#unconfigured-fedlet-properties-keys" title="Public and Private Key Settings">Public and Private Key Settings</a> for details on how to specify access to the keystore, and <a class="xref" href="#unconfigured-fedlet-sp-standard" title="3.2.5.1.&nbsp;Service Provider Standard XML">Section&nbsp;3.2.5.1, "Service Provider Standard XML"</a> for details on how to set up standard metadata. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">encryptionCertAlias</code></span>
            </dt>
            <dd>
             <p> Alias of the public key certificate for the key pair used when encrypting messages to the IDP </p>
             <p> The key pair is found in the Fedlet's keystore, and the certificate is included in the standard metadata. See <a class="xref" href="#unconfigured-fedlet-properties-keys" title="Public and Private Key Settings">Public and Private Key Settings</a> for details on how to specify access to the keystore, and <a class="xref" href="#unconfigured-fedlet-sp-standard" title="3.2.5.1.&nbsp;Service Provider Standard XML">Section&nbsp;3.2.5.1, "Service Provider Standard XML"</a> for details on how to set up standard metadata. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">wantNameIDEncrypted</code></span>
            </dt>
            <dd>
             <p> Set to true to request that the IDP encrypt the name ID </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">cotlist</code></span>
            </dt>
            <dd>
             <p> Set this to the Circle of Trust name used in <a class="xref" href="#unconfigured-fedlet-cot" title="3.2.3.&nbsp;Configuring Circles of Trust">Section&nbsp;3.2.3, "Configuring Circles of Trust"</a>. </p>
             <p> Default: <code class="literal">fedletcot</code> </p>
            </dd>
           </dl>
          </div>
         </div>
         <div class="section" id="unconfigured-fedlet-sp-extended-xacmlauthzdecisionqueryconfig">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">3.2.5.2.3.&nbsp;Service Provider Extended XML: XACMLAuthzDecisionQueryConfig Settings</h5>
            </div>
           </div>
          </div>
          <p> This section covers elements for the XACML decision requester role, enabling the Fedlet to act as a Policy Enforcement Point, arranged in the order they appear in the template. </p>
          <div class="variablelist">
           <dl class="variablelist">
            <dt>
             <span class="term"><code class="literal">signingCertAlias</code></span>
            </dt>
            <dd>
             <p> Alias of the public key certificate for the key pair used when signing messages to the IDP </p>
             <p> The key pair is found in the Fedlet's keystore, and the certificate is included in the standard metadata. See <a class="xref" href="#unconfigured-fedlet-properties-keys" title="Public and Private Key Settings">Public and Private Key Settings</a> for details on how to specify access to the keystore, and <a class="xref" href="#unconfigured-fedlet-sp-standard" title="3.2.5.1.&nbsp;Service Provider Standard XML">Section&nbsp;3.2.5.1, "Service Provider Standard XML"</a> for details on how to set up standard metadata. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">encryptionCertAlias</code></span>
            </dt>
            <dd>
             <p> Alias of the public key certificate for the key pair used when encrypting messages to the IDP </p>
             <p> The key pair is found in the Fedlet's keystore, and the certificate is included in the standard metadata. See <a class="xref" href="#unconfigured-fedlet-properties-keys" title="Public and Private Key Settings">Public and Private Key Settings</a> for details on how to specify access to the keystore, and <a class="xref" href="#unconfigured-fedlet-sp-standard" title="3.2.5.1.&nbsp;Service Provider Standard XML">Section&nbsp;3.2.5.1, "Service Provider Standard XML"</a> for details on how to set up standard metadata. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">basicAuthOn</code></span>
            </dt>
            <dd>
             <p> Set to true to use HTTP Basic authorization when contacting the Policy Decision Provider </p>
             <p> Default: false </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">basicAuthUser</code></span>
            </dt>
            <dd>
             <p> When using Basic authorization to contact the Policy Decision Provider, use this value as the user name </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">basicAuthPassword</code></span>
            </dt>
            <dd>
             <p> When using Basic authorization to contact the Policy Decision Provider, use this value as the password </p>
             <p> Encrypt the password using the <code class="filename">encode.jsp</code> page of your test copy of OpenAM that you might also have used to encode keystore passwords as described in <a class="xref" href="#unconfigured-fedlet-properties-keys" title="Public and Private Key Settings">Public and Private Key Settings</a>. </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">wantXACMLAuthzDecisionResponseSigned</code></span>
            </dt>
            <dd>
             <p> Set this to true to request that the Policy Decision Provider sign the XACML response </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">wantAssertionEncrypted</code></span>
            </dt>
            <dd>
             <p> Set this to true to request that the Policy Decision Provider encrypt the SAML assertion response </p>
            </dd>
            <dt>
             <span class="term"><code class="literal">cotlist</code></span>
            </dt>
            <dd>
             <p> Set this to the Circle of Trust name used in <a class="xref" href="#unconfigured-fedlet-cot" title="3.2.3.&nbsp;Configuring Circles of Trust">Section&nbsp;3.2.3, "Configuring Circles of Trust"</a>. </p>
             <p> Default: <code class="literal">fedletcot</code> </p>
            </dd>
           </dl>
          </div>
         </div>
        </div>
       </div>
       <div class="section" id="unconfigured-fedlet-embedding">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">3.2.6.&nbsp;Embedding the Java Fedlet in a Web Application</h3>
          </div>
         </div>
        </div>
        <p> The Fedlet war file, <code class="filename">Fedlet-13.0.0.war</code>, serves both as an example and also to provide the code needed to embed the Fedlet in your web application. </p>
        <div class="itemizedlist">
         <p> The basic steps for using the Fedlet in your application are as follows. </p>
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p> Unpack the Fedlet war file to a working directory, remove any files you do not want to keep such as <code class="filename">index.jsp</code> or <code class="filename">fedletEncode.jsp</code>, and overlay the Fedlet files with those of your web application. </p></li>
          <li class="listitem"><p> To integrate single sign-on into your application, modify the functionality in <code class="filename">fedletSampleApp.jsp</code> or add it to your application's logic. </p><p> If you add it to your application's logic, then you must also edit your application's deployment descriptor file, <code class="filename">web.xml</code>, to set the assertion consumer URI, which by default is <code class="literal">/fedletapplication</code> in the basic SP XML for the Fedlet. Add <code class="literal">servlet</code> and <code class="literal">servlet-mapping</code> elements as shown in the following example. </p><pre class="codelisting prettyprint xml">
&lt;servlet&gt;
    &lt;servlet-name&gt;yourapplication&lt;/servlet-name&gt;
    &lt;jsp-file&gt;/your-application.jsp&lt;/jsp-file&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;yourapplication&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/fedletapplication&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
</pre></li>
          <li class="listitem"><p> Build a war file from your web application with embedded Fedlet files. </p><p> This is the version of the application to deploy. </p></li>
          <li class="listitem"><p> When you deploy your war file, also provide the Fedlet configuration as described in this section. </p></li>
         </ul>
        </div>
       </div>
      </div>
     </div>
     <div lang="" class="chapter" id="chap-customizing">
      <div class="titlepage">
       <div>
        <div>
         <h1 class="title">Chapter&nbsp;4.&nbsp;Customizing OpenAM</h1>
        </div>
       </div>
      </div>
      <p>Service provider interfaces (SPI's) provide a framework to customize all OpenAM service modules such as adding custom authentication modules, federation plugins, and policy conditions.</p>
      <p>This part of the guide covers customizing OpenAM functionality.</p>
      <div class="section" id="sec-custom-attr">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">4.1.&nbsp;Customizing Profile Attributes</h2>
         </div>
        </div>
       </div>
       <a class="indexterm" name="d14232e14195"></a>
       <p>You can extend user profiles by adding custom attributes. This section demonstrates how to add a custom attribute to a user profile when storing user profiles in the embedded LDAP directory.</p>
       <p>Adding a custom attribute involves both updating the <code class="literal">iPlanetAMUserService</code>, and also updating the identity repository schema to hold the new attribute. Furthermore, to allow users to update the attribute in their own profiles, you must also update the OpenAM policy configuration stored in the configuration directory.</p>
       <div class="panel panel-primary">
        <div class="panel-heading">
         <h3 class="panel-title">Important</h3>
        </div>
        <div class="panel-body">
         <p> In OpenAM 13, the ability to edit custom profile attributes is limited to the classic UI. Custom profile attributes do not appear in the user profile when users log in to OpenAM using the XUI. </p>
        </div>
       </div>
       <div class="itemizedlist">
        <p>This section includes the following procedures.</p>
        <ul class="itemizedlist" style="list-style-type: disc; ">
         <li class="listitem"><p><a class="xref" href="#add-attr-to-service-description" title="Procedure&nbsp;4.1.&nbsp;To Update the AMUser Service For the New Attribute">Procedure&nbsp;4.1, "To Update the AMUser Service For the New Attribute"</a></p></li>
         <li class="listitem"><p><a class="xref" href="#add-attr-to-identity-repository" title="Procedure&nbsp;4.2.&nbsp;To Update the Identity Repository For the New Attribute">Procedure&nbsp;4.2, "To Update the Identity Repository For the New Attribute"</a></p></li>
         <li class="listitem"><p><a class="xref" href="#allow-users-to-update-attr" title="Procedure&nbsp;4.3.&nbsp;To Allow Users To Update the New Attribute">Procedure&nbsp;4.3, "To Allow Users To Update the New Attribute"</a></p></li>
        </ul>
       </div>
       <div class="procedure" id="add-attr-to-service-description">
        <div class="procedure-inner">
         <div class="procedure-title">
          Procedure&nbsp;4.1.&nbsp;To Update the AMUser Service For the New Attribute
         </div>
         <p>Follow the steps below to create a custom attribute in OpenAM.</p>
         <ol class="procedure" type="1">
          <li class="step"><p>Create a backup copy of the configuration file for the <code class="literal">iPlanetAMUserService</code>.</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cp ~/openam/config/xml/amUser.xml ~/openam/config/xml/amUser.xml.orig</strong>
   </pre></li>
          <li class="step"><p>Edit the file to add your attribute as one of the list of <code class="literal">&lt;User&gt;</code> attributes.</p><pre class="codelisting prettyprint xml">&lt;AttributeSchema name="customAttribute"
    type="single"
    syntax="string"
    any="display"
    i18nKey="Custom Attribute"&gt;
&lt;/AttributeSchema&gt;</pre><p>Here, the name refers to the attribute type name used in LDAP. The <code class="literal">i18nKey</code> holds either the reference, or in this case the content, of the text that appears in the user interface.</p></li>
          <li class="step"><p>Delete <code class="literal">iPlanetAMUserService</code>, and then create it from your updated configuration file.</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cd /path/to/tools/openam/bin/</strong>
$ <strong class="userinput">ssoadm \
 delete-svc \
 --adminid amadmin \
 --password-file /tmp/pwd.txt \
 --servicename iPlanetAMUserService</strong>

<em class="computeroutput">Service was deleted.</em>
$ <strong class="userinput">ssoadm \
 create-svc \
 --adminid amadmin \
 --password-file /tmp/pwd.txt \
 --xmlfile $HOME/openam/config/xml/amUser.xml</strong>

<em class="computeroutput">Service was added.</em>
   </pre></li>
         </ol>
        </div>
       </div>
       <div class="procedure" id="add-attr-to-identity-repository">
        <div class="procedure-inner">
         <div class="procedure-title">
          Procedure&nbsp;4.2.&nbsp;To Update the Identity Repository For the New Attribute
         </div>
         <p>Follow the steps below to update the identity repository LDAP schema for the custom attribute, and then update OpenAM to use the custom attribute and object class.</p>
         <p>If you are adding an existing attribute that is already allowed on user profile entries, you can skip this procedure.</p>
         <div class="panel panel-success">
          <div class="panel-heading">
           <h3 class="panel-title">Tip</h3>
          </div>
          <div class="panel-body">
           <p>If you are using OpenDJ as the identity repository, you can update the schema through OpenDJ Control Panel &gt; Schema &gt; Manage Schema, as described in the <a class="link" href="https://backstage.forgerock.com/docs/opendj/3/admin-guide/#update-schema" target="_blank">OpenDJ documentation</a>.</p>
          </div>
         </div>
         <ol class="procedure" type="1">
          <li class="step"><p>Prepare the attribute type object class definitions in LDIF format.</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cat custom-attr.ldif</strong>
<em class="computeroutput">dn: cn=schema
changetype: modify
add: attributeTypes
attributeTypes: ( temp-custom-attr-oid NAME 'customAttribute' EQUALITY case
 IgnoreMatch ORDERING caseIgnoreOrderingMatch SUBSTR caseIgnoreSubstrings
 Match SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 USAGE userApplications )
-
add: objectClasses
objectClasses: ( temp-custom-oc-oid NAME 'customObjectclass' SUP top AUXILIARY
  MAY customAttribute )</em>
   </pre></li>
          <li class="step"><p>Add the schema definitions to the directory.</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">/path/to/opendj/bin/ldapmodify \
 --port 1389 \
 --hostname openam.example.com \
 --bindDN "cn=Directory Manager" \
 --bindPassword password \
 --filename custom-attr.ldif</strong>
<em class="computeroutput">Processing MODIFY request for cn=schema
MODIFY operation successful for DN cn=schema</em>
   </pre></li>
          <li class="step"><p>In OpenAM console, browse to Realms &gt; <em class="replaceable">Realm Name</em> &gt; Data Stores &gt; <em class="replaceable">Data Store Name</em>.</p></li>
          <li class="step"><p>Add the object class, here <code class="literal">customObjectclass</code>, to the LDAP User Object Class list.</p></li>
          <li class="step"><p>Add the attribute type, here <code class="literal">customAttribute</code>, to the LDAP User Attributes list.</p></li>
          <li class="step"><p>Save your work.</p></li>
         </ol>
        </div>
       </div>
       <div class="procedure" id="allow-users-to-update-attr">
        <div class="procedure-inner">
         <div class="procedure-title">
          Procedure&nbsp;4.3.&nbsp;To Allow Users To Update the New Attribute
         </div>
         <p>Follow these steps to make the new attribute editable by users. The steps imply use of the embedded configuration directory. If you use a different directory server to store the configuration, then adapt them for your tools.</p>
         <ol class="procedure" type="1">
          <li class="step"><p>Login to the control panel for the embedded configuration directory.</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">./openam/opends/bin/control-panel &amp;</strong>
   </pre><p>Connect using bind DN <code class="literal">cn=Directory Manager</code> and the the password for <code class="literal">amadmin</code>.</p></li>
          <li class="step"><p>Select Manage Entries to open the LDAP browser.</p></li>
          <li class="step"><p>Search with <code class="literal">LDAP Filter:</code> set to <code class="literal">ou=SelfWriteAttributes</code>, and then expand the tree views to see the two entries found.</p></li>
          <li class="step"><p>In the entry under <code class="literal">iPlanetAMPolicyService</code>, edit the <code class="literal">sunKeyValue</code> attribute to add your custom attribute to the list of self-writable attributes, as in <code class="literal">&lt;Value&gt;customAttribute&lt;/Value&gt;</code>.</p></li>
          <li class="step"><p>In the entry under <code class="literal">sunEntitlementIndexes</code>, edit the <code class="literal">sunKeyValue</code> attribute to add your custom attribute to the list of self-writable attributes, as in replacing the last <code class="literal">\n</code> in the list with <code class="literal">,\n \"customAttribute\"\n</code>.</p></li>
          <li class="step"><p>Restart OpenAM or the web container where it runs. The following example applies to Tomcat.</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">/path/to/tomcat/bin/shutdown.sh</strong>
$ <strong class="userinput">/path/to/tomcat/bin/startup.sh</strong>
   </pre></li>
          <li class="step"><p>Login to OpenAM console as a user to check that a user can save a value for your new, custom attribute.</p>
           <div class="mediaobject" align="center" id="figure-bjensen-with-custom-attribute">
            <a class="fancybox" href="images/bjensen-with-custom-attribute.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_bjensen-with-custom-attribute.png" align="middle" alt="Saving Babs Jensen's profile with a custom attribute" title="If all goes well, you can save the new custom attribute to the
     user profile."></a>
           </div></li>
         </ol>
        </div>
       </div>
      </div>
      <div class="section" id="sec-oauth2-scopes">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">4.2.&nbsp;Customizing OAuth 2.0 Scope Handling</h2>
         </div>
        </div>
       </div>
       <a class="indexterm" name="d14232e14426"></a>
       <p> RFC 6749, <a class="link" href="http://tools.ietf.org/html/rfc6749" target="_blank"><em class="citetitle">The OAuth 2.0 Authorization Framework</em></a>, describes access token scopes as a set of case-sensitive strings defined by the authorization server. Clients can request scopes, and resource owners can authorize them. </p>
       <p> The default scopes implementation in OpenAM treats scopes as profile attributes for the resource owner. When a resource server or other entity uses the access token to get token information from OpenAM, OpenAM populates the scopes with profile attribute values. For example, if one of the scopes is <code class="literal">mail</code>, OpenAM sets <code class="literal">mail</code> to the resource owner's email address in the token information returned. </p>
       <p> You can change this behavior by writing your own scope validator plugin. This section shows how to write a custom OAuth 2.0 scope validator plugin for use in an OAuth 2.0 provider (authorization server) configuration. </p>
       <div class="section" id="design-oauth2-scopes-plugin">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.2.1.&nbsp;Designing an OAuth 2.0 Scope Validator Plugin</h3>
          </div>
         </div>
        </div>
        <p> A scope validator plugin implements the <code class="literal">org.forgerock.oauth2.core.ScopeValidator</code> interface. As described in the API specification, the <a class="link" href="https://backstage.forgerock.com/static/docs/openam/13/apidocs/?org/forgerock/oauth2/core/ScopeValidator.html" target="_blank"><code class="literal">ScopeValidator</code> interface</a> has several methods that your plugin overrides. </p>
        <p> The following example plugin sets whether <code class="literal">read</code> and <code class="literal">write</code> permissions were granted. </p>
        <pre class="codelisting prettyprint java">
package org.forgerock.openam.examples;

import org.forgerock.oauth2.core.AccessToken;
import org.forgerock.oauth2.core.ClientRegistration;
import org.forgerock.oauth2.core.OAuth2Request;
import org.forgerock.oauth2.core.ScopeValidator;
import org.forgerock.oauth2.core.Token;
import org.forgerock.oauth2.core.UserInfoClaims;
import org.forgerock.oauth2.core.exceptions.InvalidClientException;
import org.forgerock.oauth2.core.exceptions.NotFoundException;
import org.forgerock.oauth2.core.exceptions.ServerException;
import org.forgerock.oauth2.core.exceptions.UnauthorizedClientException;

import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;
import java.util.Set;

/**
 * Custom scope validators implement the
 * {@link org.forgerock.oauth2.core.ScopeValidator} interface.
 *
 * &lt;p&gt;
 * This example sets read and write permissions according to the scopes set.
 * &lt;/p&gt;
 *
 * &lt;ul&gt;
 *
 * &lt;li&gt;
 * The {@code validateAuthorizationScope} method
 * adds default scopes, or any allowed scopes provided.
 * &lt;/li&gt;
 *
 * &lt;li&gt;
 * The {@code validateAccessTokenScope} method
 * adds default scopes, or any allowed scopes provided.
 * &lt;/li&gt;
 *
 * &lt;li&gt;
 * The {@code validateRefreshTokenScope} method
 * adds the scopes from the access token,
 * or any requested scopes provided that are also in the access token scopes.
 * &lt;/li&gt;
 *
 * &lt;li&gt;
 * The {@code getUserInfo} method
 * populates scope values and sets the resource owner ID to return.
 * &lt;/li&gt;
 *
 * &lt;li&gt;
 * The {@code evaluateScope} method
 * populates scope values to return.
 * &lt;/li&gt;
 *
 * &lt;li&gt;
 * The {@code additionalDataToReturnFromAuthorizeEndpoint} method
 * returns no additional data (an empty Map).
 * &lt;/li&gt;
 *
 * &lt;li&gt;
 * The {@code additionalDataToReturnFromTokenEndpoint} method
 * adds no additional data.
 * &lt;/li&gt;
 *
 * &lt;/ul&gt;
 */
public class CustomScopeValidator implements ScopeValidator {
    @Override
    public Set&lt;String&gt; validateAuthorizationScope(
            ClientRegistration clientRegistration,
            Set&lt;String&gt; scope,
            OAuth2Request request) {
        if (scope == null || scope.isEmpty()) {
            return clientRegistration.getDefaultScopes();
        }

        Set&lt;String&gt; scopes = new HashSet&lt;String&gt;(
                clientRegistration.getAllowedScopes());
        scopes.retainAll(scope);
        return scopes;
    }

    @Override
    public Set&lt;String&gt; validateAccessTokenScope(
            ClientRegistration clientRegistration,
            Set&lt;String&gt; scope,
            OAuth2Request request) {
        if (scope == null || scope.isEmpty()) {
            return clientRegistration.getDefaultScopes();
        }

        Set&lt;String&gt; scopes = new HashSet&lt;String&gt;(
                clientRegistration.getAllowedScopes());
        scopes.retainAll(scope);
        return scopes;
    }

    @Override
    public Set&lt;String&gt; validateRefreshTokenScope(
            ClientRegistration clientRegistration,
            Set&lt;String&gt; requestedScope,
            Set&lt;String&gt; tokenScope,
            OAuth2Request request) {
        if (requestedScope == null || requestedScope.isEmpty()) {
            return tokenScope;
        }

        Set&lt;String&gt; scopes = new HashSet&lt;String&gt;(tokenScope);
        scopes.retainAll(requestedScope);
        return scopes;
    }

   @Override
   public UserInfoClaims getUserInfo(
           AccessToken token,
           OAuth2Request request)
           throws UnauthorizedClientException, NotFoundException {
       Map&lt;String, Object&gt; response = mapScopes(token);
       response.put("sub", token.getResourceOwnerId());
       UserInfoClaims claims = new UserInfoClaims(response, null);
       return claims;
   }

    /**
     * Set read and write permissions according to scope.
     *
     * @param token The access token presented for validation.
     * @return The map of read and write permissions,
     *         with permissions set to {@code true} or {@code false},
     *         as appropriate.
     */
    private Map&lt;String,Object&gt; mapScopes(AccessToken token) {
        Set&lt;String&gt; scopes = token.getScope();
        Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();
        final String[] permissions = {"read", "write"};

        for (String scope : permissions) {
            if (scopes.contains(scope)) {
                map.put(scope, true);
            } else {
                map.put(scope, false);
            }
        }
        return map;
    }

    @Override
    public Map&lt;String, Object&gt; evaluateScope(AccessToken token) {
        return mapScopes(token);
    }

    @Override
    public Map&lt;String, String&gt; additionalDataToReturnFromAuthorizeEndpoint(
            Map&lt;String, Token&gt; tokens,
            OAuth2Request request) {
        return new HashMap&lt;String, String&gt;(); // No special handling
    }

    @Override
    public void additionalDataToReturnFromTokenEndpoint(
            AccessToken token,
            OAuth2Request request)
            throws ServerException, InvalidClientException {
        // No special handling
    }
}
  </pre>
       </div>
       <div class="section" id="build-oauth2-scopes-plugin">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.2.2.&nbsp;Building the OAuth 2.0 Scope Validator Sample Plugin</h3>
          </div>
         </div>
        </div>
        <p> The <a class="link" href="https://github.com/ForgeRock/openam-scope-sample/tree/13.0.0" target="_blank">sample scope validator plugin source</a> is available online. Get a local clone so that you can try the sample on your system. In the sources you find the following files. </p>
        <div class="variablelist">
         <dl class="variablelist">
          <dt>
           <span class="term"><code class="filename">pom.xml</code></span>
          </dt>
          <dd>
           <p> Apache Maven project file for the module </p>
           <p> This file specifies how to build the sample scope validator plugin, and also specifies its dependencies on OpenAM components. </p>
          </dd>
          <dt>
           <span class="term"><code class="filename">src/main/java/org/forgerock/openam/examples/CustomScopeValidator.java</code></span>
          </dt>
          <dd>
           <p> Core class for the sample OAuth 2.0 scope validator plugin </p>
           <p> See <a class="xref" href="#design-oauth2-scopes-plugin" title="4.2.1.&nbsp;Designing an OAuth 2.0 Scope Validator Plugin">Section&nbsp;4.2.1, "Designing an OAuth 2.0 Scope Validator Plugin"</a> for a listing. </p>
          </dd>
         </dl>
        </div>
        <p> Build the module using Apache Maven. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cd /path/to/openam-scope-sample</strong>
$ <strong class="userinput">mvn install</strong>
<em class="computeroutput">[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building openam-scope-sample 1.0.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------

...

[INFO]
[INFO] --- maven-jar-plugin:2.3.2:jar (default-jar) @ openam-scope-sample ---
[INFO] Building jar: .../target/openam-scope-sample-1.0.0-SNAPSHOT.jar

...

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 1.827s
[INFO] Finished at: Tue Jun 03 10:40:31 CEST 2014
[INFO] Final Memory: 27M/357M
[INFO] ------------------------------------------------------------------------</em>
  </pre>
        <p> After you successfully build the module, you find the .jar in the <code class="filename">target/</code> directory of the project. </p>
       </div>
       <div class="section" id="configure-oauth2-scopes-plugin">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.2.3.&nbsp;Configuring OpenAM to Use the Plugin</h3>
          </div>
         </div>
        </div>
        <p> After building your plugin .jar file, copy the .jar file under <code class="filename">WEB-INF/lib/</code> where you deployed OpenAM. </p>
        <p> Restart OpenAM or the container in which it runs. </p>
        <p> In OpenAM console, you can either configure a specific OAuth 2.0 provider to use your plugin, or configure your plugin as the default for new OAuth 2.0 providers. In either case, you need the class name of your plugin. The class name for the sample plugin is <code class="literal">org.forgerock.openam.examples.CustomScopeValidator</code>. </p>
        <div class="itemizedlist">
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p> To configure a specific OAuth 2.0 provider to use your plugin, add the class name of your scopes plugin under Realms &gt; <em class="replaceable">Realm Name</em> &gt; Services &gt; <em class="replaceable">OAuth2 Provider Name</em> &gt; Scope Implementation Class. </p></li>
          <li class="listitem"><p> To configure your plugin as the default for new OAuth 2.0 providers, add the class name of your scopes plugin under Configuration &gt; Global &gt; OAuth2 Provider &gt; Scope Implementation Class. </p></li>
         </ul>
        </div>
       </div>
       <div class="section" id="try-oauth2-scopes-plugin">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.2.4.&nbsp;Trying the Sample Plugin</h3>
          </div>
         </div>
        </div>
        <p> In order to try the sample plugin, make sure you have configured an OAuth 2.0 provider to use the sample plugin. Also, set up an OAuth 2.0 client of the provider that takes scopes <code class="literal">read</code> and <code class="literal">write</code>. </p>
        <p> Next try the provider as shown in the following example. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --data "grant_type=client_credentials&amp;username=demo&amp;password=changeit\
&amp;client_id=myClientID&amp;client_secret=password&amp;scope=read" \
 https://openam.example.com:8443/openam/oauth2/access_token</strong>

<em class="computeroutput">{
    "scope": "read",
    "expires_in": 59,
    "token_type": "Bearer",
    "access_token": "c8860442-daba-4af0-a1d9-b607c03e5a0b"
}</em>

$ <strong class="userinput">curl https://openam.example.com:8443/openam/oauth2/tokeninfo\
?access_token=0d492486-11a7-4175-b116-2fc1cbff6d78</strong>
<em class="computeroutput">{
    "scope": [
        "read"
    ],
    "grant_type": "client_credentials",
    "realm": "/",
    "write": false,
    "read": true,
    "token_type": "Bearer",
    "expires_in": 24,
    "access_token": "c8860442-daba-4af0-a1d9-b607c03e5a0b"
}</em>
  </pre>
        <p> As seen in this example, the requested scope <code class="literal">read</code> is authorized, but the <code class="literal">write</code> scope has not been authorized. </p>
       </div>
      </div>
      <div class="section" id="sec-auth-spi">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">4.3.&nbsp;Customizing Authentication Modules</h2>
         </div>
        </div>
       </div>
       <a class="indexterm" name="d14232e14584"></a>
       <p>This section shows how to customize authentication with a sample custom authentication module. For deployments with particular requirements not met by existing OpenAM authentication modules, determine whether you can adapt one of the built-in or extension modules for your needs. If not, build the functionality into a custom authentication module.</p>
       <div class="section" id="about-custom-auth-module">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.3.1.&nbsp;About the Sample Authentication Module</h3>
          </div>
         </div>
        </div>
        <p>The sample authentication module prompts for a user name and password to authenticate the user, and handles error conditions. The sample shows how you integrate an authentication module into OpenAM such that you can configure the module through OpenAM console, and also localize the user interface.</p>
        <div class="variablelist">
         <p>The <a class="link" href="https://github.com/ForgeRock/openam-auth-sample/tree/13.0.0" target="_blank">sample authentication module source</a> is available online. Get a local clone so that you can try the sample on your system. In the sources you find the following files.</p>
         <dl class="variablelist">
          <dt>
           <span class="term"><code class="filename">pom.xml</code></span>
          </dt>
          <dd>
           <p>Apache Maven project file for the module</p>
           <p>This file specifies how to build the sample authentication module, and also specifies its dependencies on OpenAM components and on the Java Servlet API.</p>
          </dd>
          <dt>
           <span class="term"><code class="filename">src/main/java/org/forgerock/openam/examples/SampleAuth.java</code></span>
          </dt>
          <dd>
           <p>Core class for the sample authentication module</p>
           <p>This class is called by OpenAM to initialize the module and to process authentication. See <a class="xref" href="#authentication-logic-sample-auth-module" title="4.3.4.&nbsp;The Sample Authentication Logic">Section&nbsp;4.3.4, "The Sample Authentication Logic"</a> for details.</p>
          </dd>
          <dt>
           <span class="term"><code class="filename">src/main/java/org/forgerock/openam/examples/SampleAuthPrincipal.java</code></span>
          </dt>
          <dd>
           <p>Class implementing <code class="literal">java.security.Principal</code> interface that defines how to map credentials to identities</p>
           <p>This class is used to process authentication. See <a class="xref" href="#principal-sample-auth-module" title="4.3.5.&nbsp;The Sample Auth Principal">Section&nbsp;4.3.5, "The Sample Auth Principal"</a> for details.</p>
          </dd>
          <dt>
           <span class="term"><code class="filename">src/main/resources/amAuthSampleAuth.properties</code></span>
          </dt>
          <dd>
           <p>Properties file mapping UI strings to property values</p>
           <p>This file makes it easier to localize the UI. See <a class="xref" href="#properties-sample-auth-module" title="4.3.2.&nbsp;Sample Auth Properties">Section&nbsp;4.3.2, "Sample Auth Properties"</a> for details.</p>
          </dd>
          <dt>
           <span class="term"><code class="filename">src/main/resources/amAuthSampleAuth.xml</code></span>
          </dt>
          <dd>
           <p>Configuration file for the sample authentication service</p>
           <p>This file is used when registering the authentication module with OpenAM. See <a class="xref" href="#service-conf-sample-auth-module" title="4.3.6.&nbsp;The Sample Auth Service Configuration">Section&nbsp;4.3.6, "The Sample Auth Service Configuration"</a> for details.</p>
          </dd>
          <dt>
           <span class="term"><code class="filename">src/main/resources/config/auth/default/SampleAuth.xml</code></span>
          </dt>
          <dd>
           <p>Callback file for OpenAM classic UI authentication pages</p>
           <p>The sample authentication module does not include localized versions of this file. See <a class="xref" href="#callbacks-file-sample-auth-module" title="4.3.3.&nbsp;Sample Auth Callbacks">Section&nbsp;4.3.3, "Sample Auth Callbacks"</a> for details.</p>
          </dd>
         </dl>
        </div>
       </div>
       <div class="section" id="properties-sample-auth-module">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.3.2.&nbsp;Sample Auth Properties</h3>
          </div>
         </div>
        </div>
        <p>OpenAM uses a Java properties file per locale to retrieve the appropriate, localized strings for the authentication module.</p>
        <p>The following is the Sample Authentication Module properties file, <code class="filename">amAuthSampleAuth.properties</code>.</p>
        <pre class="codelisting prettyprint java">sampleauth-service-description=Sample Authentication Module
a500=Authentication Level
a501=Service Specific Attribute

sampleauth-ui-login-header=Login
sampleauth-ui-username-prompt=User Name:
sampleauth-ui-password-prompt=Password:

sampleauth-error-1=Error 1 occurred during the authentication
sampleauth-error-2=Error 2 occurred during the authentication</pre>
       </div>
       <div class="section" id="callbacks-file-sample-auth-module">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.3.3.&nbsp;Sample Auth Callbacks</h3>
          </div>
         </div>
        </div>
        <p>OpenAM callbacks XML files are used to build the classic UI to prompt the user for identity information needed to process the authentication. The document type for a callback XML file is described in <code class="filename">WEB-INF/Auth_Module_Properties.dtd</code> where OpenAM is deployed.</p>
        <p>The value of the <code class="literal">moduleName</code> property in the callbacks file must match your custom authentication module's class name. Observe that the module name in <a class="xref" href="#full-callbacks-file" title="Example&nbsp;4.1.&nbsp;Sample Auth Callbacks File">Example&nbsp;4.1, "Sample Auth Callbacks File"</a>, <code class="literal">SampleAuth</code>, matches the class name in <a class="xref" href="#sample-auth-module-code" title="Example&nbsp;4.2.&nbsp;Sample Authentication Module Code">Example&nbsp;4.2, "Sample Authentication Module Code"</a>. </p>
        <div class="example" id="full-callbacks-file">
         <div class="example-title">
          Example&nbsp;4.1.&nbsp;Sample Auth Callbacks File
         </div>
         <div class="example-contents">
          <p>The following is the <code class="filename">SampleAuth.xml</code> callbacks file.</p>
          <pre class="codelisting prettyprint xml">&lt;!DOCTYPE ModuleProperties PUBLIC
 "=//iPlanet//Authentication Module Properties XML Interface 1.0 DTD//EN"
        "jar://com/sun/identity/authentication/Auth_Module_Properties.dtd"&gt;

&lt;ModuleProperties moduleName="SampleAuth" version="1.0" &gt;
    &lt;Callbacks length="0" order="1" timeout="600" header="#NOT SHOWN#" /&gt;
    &lt;Callbacks length="2" order="2" timeout="600" header="#TO BE SUBSTITUTED#"&gt;
        &lt;NameCallback isRequired="true"&gt;
            &lt;Prompt&gt;#USERNAME#&lt;/Prompt&gt;
        &lt;/NameCallback&gt;
        &lt;PasswordCallback echoPassword="false" &gt;
            &lt;Prompt&gt;#PASSWORD#&lt;/Prompt&gt;
        &lt;/PasswordCallback&gt;
    &lt;/Callbacks&gt;
    &lt;Callbacks length="1" order="3" timeout="600" header="#TO BE SUBSTITUTED#"
        error="true" &gt;
        &lt;NameCallback&gt;
            &lt;Prompt&gt;#THE DUMMY WILL NEVER BE SHOWN#&lt;/Prompt&gt;
        &lt;/NameCallback&gt;
    &lt;/Callbacks&gt;
&lt;/ModuleProperties&gt;</pre>
          <div class="orderedlist">
           <p>This file specifies three states.</p>
           <ol class="orderedlist" type="1">
            <li class="listitem"><p>The initial state (order="1") is used dynamically to replace the dummy strings shown between hashes (for example, <code class="literal">#USERNAME#</code>) by the <code class="literal">substituteUIStrings()</code> method in <code class="filename">SampleAuth.java</code>.</p></li>
            <li class="listitem"><p>The next state (order="2") handles prompting the user for authentication information.</p></li>
            <li class="listitem"><p>The last state (order="3") has the attribute <code class="literal">error="true"</code>. If the authentication module state machine reaches this order then the authentication has failed. The <code class="literal">NameCallback</code> is not used and not displayed to user. OpenAM requires that the callbacks array have at least one element. Otherwise OpenAM does not permit header substitution.</p></li>
           </ol>
          </div>
         </div>
        </div>
        <br class="example-break">
       </div>
       <div class="section" id="authentication-logic-sample-auth-module">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.3.4.&nbsp;The Sample Authentication Logic</h3>
          </div>
         </div>
        </div>
        <p>An OpenAM authentication module must extend the <code class="literal">com.sun.identity.authentication.spi.AMLoginModule</code> abstract class, and must implement the methods shown below.</p>
        <p>See the <a class="link" href="https://backstage.forgerock.com/static/docs/openam/13/apidocs/" target="_blank"><em class="citetitle">OpenAM Java SDK API Specification</em></a> for reference.</p>
        <pre class="codelisting prettyprint java">
// OpenAM calls the init() method once when the module is created.
public void init(Subject subject, Map sharedState, Map options)

// OpenAM calls the process() method when the user submits authentication
// information. The process() method determines what happens next:
// success, failure, or the next state specified by the order
// attribute in the callbacks XML file.
public int process(Callback[] callbacks, int state) throws LoginException

// OpenAM expects the getPrincipal() method to return an implementation of
// the java.security.Principal interface.
public Principal getPrincipal()</pre>
        <p>OpenAM does not reuse authentication module instances. This means that you can store information specific to the authentication process in the instance.</p>
        <div class="example" id="sample-auth-module-code">
         <div class="example-title">
          Example&nbsp;4.2.&nbsp;Sample Authentication Module Code
         </div>
         <div class="example-contents">
          <p>The implementation, <code class="filename">SampleAuth.java</code>, is shown below.</p>
          <pre class="codelisting prettyprint java">/**
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.
 *
 * Copyright (c) 2011-2015 ForgeRock AS. All Rights Reserved
 *
 * The contents of this file are subject to the terms
 * of the Common Development and Distribution License
 * (the License). You may not use this file except in
 * compliance with the License.
 *
 * You can obtain a copy of the License at legal/CDDLv1.0.txt.
 * See the License for the specific language governing
 * permission and limitations under the License.
 *
 * When distributing Covered Code, include this CDDL
 * Header Notice in each file and include the License file at legal/CDDLv1.0.txt.
 * If applicable, add the following below the CDDL Header,
 * with the fields enclosed by brackets [] replaced by
 * your own identifying information:
 * "Portions Copyrighted [year] [name of copyright owner]"
 *
 */

package org.forgerock.openam.examples;

import java.security.Principal;
import java.util.Map;
import java.util.ResourceBundle;

import javax.security.auth.Subject;
import javax.security.auth.callback.Callback;
import javax.security.auth.callback.NameCallback;
import javax.security.auth.callback.PasswordCallback;
import javax.security.auth.login.LoginException;

import com.sun.identity.authentication.spi.AMLoginModule;
import com.sun.identity.authentication.spi.AuthLoginException;
import com.sun.identity.authentication.spi.InvalidPasswordException;
import com.sun.identity.authentication.util.ISAuthConstants;
import com.sun.identity.shared.datastruct.CollectionHelper;
import com.sun.identity.shared.debug.Debug;

/**
 * SampleAuth authentication module example.
 *
 * If you create your own module based on this example, you must modify all
 * occurrences of "SampleAuth" in addition to changing the name of the class.
 *
 * Please refer to OpenAM documentation for further information.
 *
 * Feel free to look at the code for authentication modules delivered with
 * OpenAM, as they implement this same API.
 */
public class SampleAuth extends AMLoginModule {

    // Name for the debug-log
    private final static String DEBUG_NAME = "SampleAuth";
    private final static Debug debug = Debug.getInstance(DEBUG_NAME);

    // Name of the resource bundle
    private final static String amAuthSampleAuth = "amAuthSampleAuth";

    // User names for authentication logic
    private final static String USERNAME = "demo";
    private final static String PASSWORD = "changeit";

    private final static String ERROR_1_USERNAME = "test1";
    private final static String ERROR_2_USERNAME = "test2";

    // Orders defined in the callbacks file
    private final static int STATE_BEGIN = 1;
    private final static int STATE_AUTH = 2;
    private final static int STATE_ERROR = 3;

    // Errors properties
    private final static String SAMPLE_AUTH_ERROR_1 = "sampleauth-error-1";
    private final static String SAMPLE_AUTH_ERROR_2 = "sampleauth-error-2";

    private Map&lt;String, String&gt; options;
    private ResourceBundle bundle;
    private Map&lt;String, String&gt; sharedState;

    public SampleAuth() {
        super();
    }


    /**
     * This method stores service attributes and localized properties for later
     * use.
     * @param subject
     * @param sharedState
     * @param options
     */
    @Override
    public void init(Subject subject, Map sharedState, Map options) {

        debug.message("SampleAuth::init");

        this.options = options;
        this.sharedState = sharedState;
        this.bundle = amCache.getResBundle(amAuthSampleAuth, getLoginLocale());
    }

    @Override
    public int process(Callback[] callbacks, int state) throws LoginException {

        debug.message("SampleAuth::process state: {}", state);

        switch (state) {

            case STATE_BEGIN:
                // No time wasted here - simply modify the UI and
                // proceed to next state
                substituteUIStrings();
                return STATE_AUTH;

            case STATE_AUTH:
                // Get data from callbacks. Refer to callbacks XML file.
                NameCallback nc = (NameCallback) callbacks[0];
                PasswordCallback pc = (PasswordCallback) callbacks[1];
                String username = nc.getName();
                String password = String.valueOf(pc.getPassword());

                //First errorstring is stored in "sampleauth-error-1" property.
                if (ERROR_1_USERNAME.equals(username)) {
                    setErrorText(SAMPLE_AUTH_ERROR_1);
                    return STATE_ERROR;
                }

                //Second errorstring is stored in "sampleauth-error-2" property.
                if (ERROR_2_USERNAME.equals(username)) {
                    setErrorText(SAMPLE_AUTH_ERROR_2);
                    return STATE_ERROR;
                }

                if (USERNAME.equals(username) &amp;&amp; PASSWORD.equals(password)) {
                    debug.message("SampleAuth::process User '{}' " +
                            "authenticated with success.", username);
                    return ISAuthConstants.LOGIN_SUCCEED;
                }

                throw new InvalidPasswordException("password is wrong",
                        USERNAME);

            case STATE_ERROR:
                return STATE_ERROR;
            default:
                throw new AuthLoginException("invalid state");
        }
    }

    @Override
    public Principal getPrincipal() {
        return new SampleAuthPrincipal(USERNAME);
    }

    private void setErrorText(String err) throws AuthLoginException {
        // Receive correct string from properties and substitute the
        // header in callbacks order 3.
        substituteHeader(STATE_ERROR, bundle.getString(err));
    }

    private void substituteUIStrings() throws AuthLoginException {
        // Get service specific attribute configured in OpenAM
        String ssa = CollectionHelper.getMapAttr(options, "specificAttribute");

        // Get property from bundle
        String new_hdr = ssa + " " +
                bundle.getString("sampleauth-ui-login-header");
        substituteHeader(STATE_AUTH, new_hdr);

        replaceCallback(STATE_AUTH, 0, new NameCallback(
                bundle.getString("sampleauth-ui-username-prompt")));
        replaceCallback(STATE_AUTH, 1, new PasswordCallback(
                bundle.getString("sampleauth-ui-password-prompt"), false));
    }
}</pre>
         </div>
        </div>
        <br class="example-break">
       </div>
       <div class="section" id="principal-sample-auth-module">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.3.5.&nbsp;The Sample Auth Principal</h3>
          </div>
         </div>
        </div>
        <p>The implementation, <code class="filename">SampleAuthPrincipal.java</code>, is shown below.</p>
        <div class="informalexample">
         <pre class="codelisting prettyprint java">/**
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.
 *
 * Copyright (c) 2011-2015 ForgeRock AS. All Rights Reserved
 *
 * The contents of this file are subject to the terms
 * of the Common Development and Distribution License
 * (the License). You may not use this file except in
 * compliance with the License.
 *
 * You can obtain a copy of the License at legal/CDDLv1.0.txt.
 * See the License for the specific language governing
 * permission and limitations under the License.
 *
 * When distributing Covered Code, include this CDDL
 * Header Notice in each file and include the License file at legal/CDDLv1.0.txt.
 * If applicable, add the following below the CDDL Header,
 * with the fields enclosed by brackets [] replaced by
 * your own identifying information:
 * "Portions Copyrighted [year] [name of copyright owner]"
 *
 */

package org.forgerock.openam.examples;

import java.io.Serializable;
import java.security.Principal;

/**
 * SampleAuthPrincipal represents the user entity.
 */
public class SampleAuthPrincipal implements Principal, Serializable {
    private final static String COLON = " : ";

    private final String name;

    public SampleAuthPrincipal(String name) {

        if (name == null) {
            throw new NullPointerException("illegal null input");
        }

        this.name = name;
    }

    /**
     * Return the LDAP username for this SampleAuthPrincipal.
     *
     * @return the LDAP username for this SampleAuthPrincipal
     */
    @Override
    public String getName() {
        return name;
    }

    /**
     * Return a string representation of this SampleAuthPrincipal.
     *
     * @return a string representation of this
     *         TestAuthModulePrincipal.
     */
    @Override
    public String toString() {
        return new StringBuilder().append(this.getClass().getName())
                .append(COLON).append(name).toString();
    }

    /**
     * Compares the specified Object with this SampleAuthPrincipal
     * for equality. Returns true if the given object is also a
     *  SampleAuthPrincipal  and the two SampleAuthPrincipal have
     * the same username.
     *
     * @param o Object to be compared for equality with this
     *          SampleAuthPrincipal.
     * @return true if the specified Object is equal equal to this
     *         SampleAuthPrincipal.
     */
    @Override
    public boolean equals(Object o) {
        if (o == null) {
            return false;
        }

        if (this == o) {
            return true;
        }

        if (!(o instanceof SampleAuthPrincipal)) {
            return false;
        }
        SampleAuthPrincipal that = (SampleAuthPrincipal) o;

        if (this.getName().equals(that.getName())) {
            return true;
        }
        return false;
    }

    /**
     * Return a hash code for this SampleAuthPrincipal.
     *
     * @return a hash code for this SampleAuthPrincipal.
     */
    @Override
    public int hashCode() {
        return name.hashCode();
    }
}</pre>
        </div>
       </div>
       <div class="section" id="service-conf-sample-auth-module">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.3.6.&nbsp;The Sample Auth Service Configuration</h3>
          </div>
         </div>
        </div>
        <p>OpenAM requires that all authentication modules be configured by means of an OpenAM service. At minimum, the service must include an authentication level attribute. Your module can access these configuration attributes in the <code class="literal">options</code> parameter passed to the <code class="literal">init()</code> method.</p>
        <div class="itemizedlist">
         <p>Some observations about the service configuration file follow in the list below.</p>
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p>The document type for a service configuration file is described in <code class="filename">WEB-INF/sms.dtd</code> where OpenAM is deployed.</p></li>
          <li class="listitem"><p> The service name is derived from the module name. The service name must have the following format: </p>
           <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: circle; ">
             <li class="listitem"><p> It must start with either <code class="literal">iPlanetAMAuth</code> or <code class="literal">sunAMAuth</code>. </p></li>
             <li class="listitem"><p> The module name must follow. The case of the module name must match the case of the class that implements the custom authentication module. </p></li>
             <li class="listitem"><p> It must end with <code class="literal">Service</code>. </p></li>
            </ul>
           </div><p> In the Sample Auth service configuration, the module name is <code class="literal">SampleAuth</code> and the service name is <code class="literal">iPlanetAMAuthSampleAuthService</code>. </p></li>
          <li class="listitem"><p>The service must have a localized description, retrieved from a properties file.</p></li>
          <li class="listitem"><p>The <code class="literal">i18nFileName</code> attribute in the service configuration holds the default (non-localized) base name of the Java properties file. The <code class="literal">i18nKey</code> attributes indicate properties keys to string values in the Java properties file.</p></li>
          <li class="listitem"><p> The authentication level attribute name must have the following format: </p>
           <div class="itemizedlist">
            <ul class="itemizedlist" style="list-style-type: circle; ">
             <li class="listitem"><p> It must start with <code class="literal">iplanet-am-auth-</code>, <code class="literal">sun-am-auth-</code>, or <code class="literal">forgerock-am-auth-</code>. </p></li>
             <li class="listitem"><p> The module name must follow, and must appear in lower case if the attribute name starts with <code class="literal">iplanet-am-auth-</code> or <code class="literal">forgerock-am-auth-</code>. If the attribute name starts with <code class="literal">sun-am-auth-</code>, it must exactly match the case of the module name as it appears in the service name. </p></li>
             <li class="listitem"><p> It must end with <code class="literal">-auth-level</code>. </p></li>
            </ul>
           </div><p> In the Sample Auth service configuration, the authentication level attribute name is <code class="literal">iplanet-am-auth-sampleauth-auth-level</code>. </p></li>
          <li class="listitem"><p>The Sample Auth service configuration includes an example <code class="literal">sampleauth-service-specific-attribute</code>, which can be configured through OpenAM console.</p></li>
         </ul>
        </div>
        <p>The service configuration file, <code class="filename">amAuthSampleAuth.xml</code>, is shown below. Save a local copy of this file, which you use when registering the module. </p>
        <pre class="codelisting prettyprint xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!--
   DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.

   Copyright (c) 2011-2015 ForgeRock AS.

   The contents of this file are subject to the terms
   of the Common Development and Distribution License
   (the License). You may not use this file except in
   compliance with the License.

   You can obtain a copy of the License at legal/CDDLv1.0.txt.
   See the License for the specific language governing
   permission and limitations under the License.

   When distributing Covered Code, include this CDDL
   Header Notice in each file and include the License file at legal/CDDLv1.0.txt.
   If applicable, add the following below the CDDL Header,
   with the fields enclosed by brackets [] replaced by
   your own identifying information:
   "Portions Copyrighted [year] [name of copyright owner]"
--&gt;
&lt;!DOCTYPE ServicesConfiguration
    PUBLIC "=//iPlanet//Service Management Services (SMS) 1.0 DTD//EN"
    "jar://com/sun/identity/sm/sms.dtd"&gt;

&lt;ServicesConfiguration&gt;
 &lt;Service name="iPlanetAMAuthSampleAuthService" version="1.0"&gt;
  &lt;Schema
   serviceHierarchy="/DSAMEConfig/authentication/iPlanetAMAuthSampleAuthService"
   i18nFileName="amAuthSampleAuth" revisionNumber="10"
   i18nKey="sampleauth-service-description" resourceName="sample"&gt;
   &lt;Organization&gt;
    &lt;!-- Specify resourceName for a JSON-friendly property in the REST SMS --&gt;
    &lt;AttributeSchema name="iplanet-am-auth-sampleauth-auth-level" resourceName="authLevel"
     type="single" syntax="number_range" rangeStart="0" rangeEnd="2147483647"
     i18nKey="a500"&gt;
     &lt;DefaultValues&gt;
      &lt;Value&gt;1&lt;/Value&gt;
     &lt;/DefaultValues&gt;
    &lt;/AttributeSchema&gt;

    &lt;!-- No need for resourceName when the name is JSON-compatible --&gt;
    &lt;AttributeSchema name="specificAttribute"
     type="single" syntax="string" validator="no" i18nKey="a501" /&gt;

    &lt;!--
     For Auth Modules, the parent Schema element specifies the REST SMS resourceName,
     and the nested SubSchema must have resourceName="USE-PARENT"
    --&gt;
    &lt;SubSchema name="serverconfig" inheritance="multiple" resourceName="USE-PARENT"&gt;
     &lt;AttributeSchema name="iplanet-am-auth-sampleauth-auth-level" resourceName="authLevel"
      type="single" syntax="number_range" rangeStart="0" rangeEnd="2147483647"
      i18nKey="a500"&gt;
      &lt;DefaultValues&gt;
       &lt;Value&gt;1&lt;/Value&gt;
      &lt;/DefaultValues&gt;
     &lt;/AttributeSchema&gt;

     &lt;!-- No need for a DefaultValues element when the default is blank --&gt;
     &lt;AttributeSchema name="specificAttribute"
      type="single" syntax="string" validator="no" i18nKey="a501" /&gt;

    &lt;/SubSchema&gt;
   &lt;/Organization&gt;
  &lt;/Schema&gt;
 &lt;/Service&gt;
&lt;/ServicesConfiguration&gt;</pre>
       </div>
       <div class="section" id="build-config-sample-auth-module">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.3.7.&nbsp;Building &amp; Installing the Sample Auth Module</h3>
          </div>
         </div>
        </div>
        <p>Build the module with Apache Maven, and install the module in OpenAM.</p>
        <div class="section" id="building-sample-auth-module">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">4.3.7.1.&nbsp;Building the Module</h4>
           </div>
          </div>
         </div>
         <p>Build the module using Apache Maven.</p>
         <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cd /path/to/openam-auth-sample</strong>
$ <strong class="userinput">mvn install</strong>
<em class="computeroutput">[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building openam-auth-sample 1.0.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
...

[INFO]
[INFO] --- maven-jar-plugin:2.3.2:jar (default-jar) @ openam-auth-sample ---
[INFO] Building jar: ...target/openam-auth-sample-1.0.0-SNAPSHOT.jar
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 3.651s
[INFO] Finished at: Thu Oct 03 11:19:07 CEST 2013
[INFO] Final Memory: 20M/226M
[INFO] ------------------------------------------------------------------------</em>
   </pre>
         <p>After you successfully build the module, you find the .jar in the <code class="filename">target/</code> directory of the project.</p>
        </div>
        <div class="section" id="installing-sample-auth-module">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">4.3.7.2.&nbsp;Installing the Module</h4>
           </div>
          </div>
         </div>
         <p>Installing the sample authentication module consists of copying the .jar to OpenAM's <code class="filename">WEB-INF/lib/</code> directory, registering the module with OpenAM, and then restarting OpenAM or the web application container where it runs.</p>
         <div class="orderedlist">
          <ol class="orderedlist" type="1">
           <li class="listitem"><p>Copy the sample authentication module .jar file to <code class="filename">WEB-INF/lib/</code> where OpenAM is deployed.</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cp target/openam-auth-sample*.jar /path/to/tomcat/webapps/openam/WEB-INF/lib/</strong>
     </pre></li>
           <li class="listitem"><p>Register the module with OpenAM using the <span class="command"><strong>ssoadm</strong></span> command.</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">ssoadm \
 create-svc \
 --adminid amadmin \
 --password-file /tmp/pwd.txt \
 --xmlfile src/main/resources/amAuthSampleAuth.xml</strong>

<em class="computeroutput">Service was added.</em>
$ <strong class="userinput">ssoadm \
 register-auth-module \
 --adminid amadmin \
 --password-file /tmp/pwd.txt \
 --authmodule org.forgerock.openam.examples.SampleAuth</strong>

<em class="computeroutput">Authentication module was registered.</em>
     </pre><p>See the <a href="../reference/index.html#ssoadm-1" class="olink"><span class="refentrytitle">ssoadm</span>(1)</a> in the <em>Reference</em> a full list of Authentication Service Management subcommands.</p></li>
           <li class="listitem"><p>Restart OpenAM or the container in which it runs.</p><p>For example if you deployed OpenAM in Apache Tomcat, then you shut down Tomcat and start it again.</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">/path/to/tomcat/bin/shutdown.sh</strong>
$ <strong class="userinput">/path/to/tomcat/bin/startup.sh</strong>
$ <strong class="userinput">tail -1 /path/to/tomcat/logs/catalina.out</strong>
<em class="computeroutput">INFO: Server startup in 14736 ms</em>
     </pre></li>
          </ol>
         </div>
        </div>
       </div>
       <div class="section" id="configuring-testing-sample-auth-module">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.3.8.&nbsp;Configuring &amp; Testing the Sample Auth Module</h3>
          </div>
         </div>
        </div>
        <p>Authentication modules are registered as services with OpenAM globally, and then set up for use in a particular realm. In this example, you set up the sample authentication module for use in the realm / (Top Level Realm).</p>
        <p>Log in to the OpenAM console as an administrator, such as <code class="literal">amadmin</code>, and browse to Realms &gt; Top Level Realm &gt; Authentication &gt; Modules. Click Add Module to create an instance of the Sample Authentication Module. Name the module <code class="literal">Sample</code>.</p>
        <div class="mediaobject" align="center" id="figure-register-sample-auth">
         <a class="fancybox" href="images/register-sample-auth.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_register-sample-auth.png" align="middle" alt="Sample authentication module registration" title="The module type is Sample Authentication Module."></a>
        </div>
        <p>Click Create, and then configure the authentication module as appropriate.</p>
        <div class="mediaobject" align="center" id="figure-sampleauth-conf">
         <a class="fancybox" href="images/sampleauth-conf.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_sampleauth-conf.png" align="middle" alt="Sample authentication module configuration" title="The module has two configurable properties, Authentication Level and
    Service Specific Attribute."></a>
        </div>
        <p>Now that the module is configured, log out of the OpenAM console.</p>
        <p>Finally, try the module by specifying the <code class="literal">Sample</code> module using a query string parameter. Browse to the login URL such as <code class="literal">http://openam.example.com:8080/openam/XUI/#login/&amp;module=Sample</code>, and then authenticate with user name <code class="literal">demo</code> and password <code class="literal">changeit</code>.</p>
        <div class="mediaobject" align="center" id="figure-openam-auth-sample-login">
         <a class="fancybox" href="images/openam-auth-sample-login.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_openam-auth-sample-login.png" align="middle" alt="Sample authentication module login page" title="On the login page, you can see the string you set as the value of
    Service Specific Attribute."></a>
        </div>
        <p>After authentication you are redirected to the end user page for the demo user. You can logout of OpenAM console, and then try to authenticate as the non-existent user <code class="literal">test123</code> to see what the error handling looks like to the user.</p>
       </div>
      </div>
      <div class="section" id="sec-custom-quota-exhaustion-action">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">4.4.&nbsp;Customizing Session Quota Exhaustion Actions</h2>
         </div>
        </div>
       </div>
       <p> This section demonstrates a custom session quota exhaustion action plugin. OpenAM calls a session quota exhaustion action plugin when a user tries to open more stateful sessions than their quota allows. Note that session quotas are not available for stateless sessions. </p>
       <p> You only need a custom session quota exhaustion action plugin if the built-in actions are not flexible enough for your deployment. See <a href="../admin-guide/index.html#session-quotas-and-exhaustion-actions" class="olink">Procedure&nbsp;2.15, "To Configure Session Quotas and Exhaustion Actions"</a> in the <em>Administration Guide</em>. </p>
       <div class="section" id="create-custom-quota-exhaustion-action">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.4.1.&nbsp;Creating &amp; Installing a Custom Session Quota Exhaustion Action</h3>
          </div>
         </div>
        </div>
        <p> You build custom session quota exhaustion actions into a .jar that you then plug in to OpenAM. You must also add your new action to the Session service configuration, and restart OpenAM in order to be able to configure it for your use. </p>
        <p> Your custom session quota exhaustion action implements the <code class="literal">com.iplanet.dpro.session.service.QuotaExhaustionAction</code> interface, overriding the <code class="literal">action</code> method. The <code class="literal">action</code> method performs the action when the session quota is met, and returns <code class="literal">true</code> only if the request for a new session should <span class="emphasis"><em>not</em></span> be granted. </p>
        <p> The example in this section simply removes the first session it finds as the session quota exhaustion action. </p>
        <pre class="codelisting prettyprint java">package org.forgerock.openam.examples.quotaexhaustionaction;

import com.iplanet.dpro.session.Session;
import com.iplanet.dpro.session.SessionException;
import com.iplanet.dpro.session.SessionID;
import com.iplanet.dpro.session.service.InternalSession;
import com.iplanet.dpro.session.service.QuotaExhaustionAction;
import com.iplanet.dpro.session.service.SessionService;
import com.sun.identity.shared.debug.Debug;
import java.util.Map;

/**
 * This is a sample {@link QuotaExhaustionAction} implementation,
 * which randomly kills the first session it finds.
 */
public class SampleQuotaExhaustionAction implements QuotaExhaustionAction {

    private static Debug debug = SessionService.sessionDebug;

    /**
     * Check if the session quota for a given user has been exhausted and
     * if so perform the necessary actions. This implementation randomly
     * destroys the first session it finds.
     *
     * @param is               The InternalSession to be activated.
     * @param existingSessions All existing sessions that belong to the same
     *                         uuid (Map:sid-&gt;expiration_time).
     * @return true If the session activation request should be rejected,
     *              otherwise false.
     */
    @Override
    public boolean action(
            InternalSession is,
            Map&lt;String, Long&gt; existingSessions) {
        for (Map.Entry&lt;String, Long&gt; entry : existingSessions.entrySet()) {
            try {
                // Get an actual Session instance based on the session ID.
                Session session =
                        Session.getSession(new SessionID(entry.getKey()));
                // Use the session to destroy itself.
                session.destroySession(session);
                // Only destroy the first session.
                break;
            } catch (SessionException se) {
                if (debug.messageEnabled()) {
                    debug.message("Failed to destroy existing session.", se);
                }
                // In this case, deny the session activation request.
                return true;
            }
        }
        return false;
    }
}
</pre>
        <p> The <a class="link" href="https://github.com/ForgeRock/openam-examples-quotaexhaustionaction/" target="_blank">sample plugin source</a> is available online. Get a local clone so that you can try the sample on your system. In the sources you find the following files. </p>
        <div class="variablelist">
         <dl class="variablelist">
          <dt>
           <span class="term"><code class="filename">pom.xml</code></span>
          </dt>
          <dd>
           <p> Apache Maven project file for the module </p>
           <p> This file specifies how to build the sample plugin, and also specifies its dependencies on OpenAM components and on the Servlet API. </p>
          </dd>
          <dt>
           <span class="term"><code class="filename">src/main/java/org/forgerock/openam/examples/quotaexhaustionaction/SampleQuotaExhaustionAction.java</code></span>
          </dt>
          <dd>
           <p> Core class for the sample quota exhaustion action plugin </p>
          </dd>
         </dl>
        </div>
        <p> Build the module using Apache Maven. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cd /path/to/openam-examples-quotaexhaustionaction</strong>
$ <strong class="userinput">mvn install</strong>
<em class="computeroutput">[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building OpenAM Example Quota Exhaustion Action 1.0.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------

...

[INFO]
[INFO] --- maven-jar-plugin:2.3.1:jar (default-jar) @ quotaexhaustionaction ---
[INFO] Building jar: .../target/quotaexhaustionaction-1.0.0-SNAPSHOT.jar

...

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 10.138s
[INFO] Finished at: Mon Nov 25 15:59:10 CET 2013
[INFO] Final Memory: 18M/129M
[INFO] ------------------------------------------------------------------------</em>
  </pre>
        <p> Copy the .jar to <code class="filename">WEB-INF/lib/</code> where OpenAM is deployed. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cp target/*.jar /path/to/tomcat/webapps/openam/WEB-INF/lib/</strong>
  </pre>
        <p> Using the <span class="command"><strong>ssoadm</strong></span> command or the <code class="literal">ssoadm.jsp</code> page in OpenAM Console, update the Session service configuration. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">ssoadm \
 set-attr-choicevals \
 --adminid amadmin \
 --password-file /tmp/pwd.txt \
 --servicename iPlanetAMSessionService \
 --schematype Global \
 --attributename iplanet-am-session-constraint-handler \
 --add \
 --choicevalues myKey=\
org.forgerock.openam.examples.quotaexhaustionaction.SampleQuotaExhaustionAction</strong>

<em class="computeroutput">Choice Values were set.</em>
  </pre>
        <p> Extract <code class="filename">amSession.properties</code> and if necessary the localized versions of this file from <code class="filename">openam-core-13.0.0.jar</code> to <code class="filename">WEB-INF/classes/</code> where OpenAM is deployed. For example, if OpenAM is deployed under <code class="filename">/path/to/tomcat/webapps/openam</code>, then you could run the following commands. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cd /path/to/tomcat/webapps/openam/WEB-INF/classes/</strong>
$ <strong class="userinput">jar -xvf ../lib/openam-core-13.0.0.jar amSession.properties</strong>
 <em class="computeroutput">inflated: amSession.properties</em>
  </pre>
        <p> Add the following line to <code class="filename">amSession.properties</code>. </p>
        <pre class="codelisting prettyprint ini">myKey=Randomly Destroy Session</pre>
        <p> Restart OpenAM or the container in which it runs. </p>
        <p> You can now use the new session quota exhaustion action in OpenAM Console under Configuration &gt; Global &gt; Session &gt; Resulting behavior if session quota exhausted. </p>
        <p> Before moving to your test and production environments, be sure to add your .jar and updates to <code class="filename">amSession.properties</code> into a custom .war that you can then deploy. You must still update the Session service configuration in order to use your custom session quota exhaustion action. </p>
       </div>
       <div class="section" id="list-custom-quota-exhaustion-actions">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.4.2.&nbsp;Listing Session Quota Exhaustion Actions</h3>
          </div>
         </div>
        </div>
        <p> List session quota exhaustion actions by using the <span class="command"><strong>ssoadm</strong></span> command or by using the <code class="literal">ssoadm.jsp</code> page. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">ssoadm \
 get-attr-choicevals \
 --adminid amadmin \
 --password-file /tmp/pwd.txt \
 --servicename iPlanetAMSessionService \
 --schematype Global \
 --attributename iplanet-am-session-constraint-handler</strong>
<em class="computeroutput">
I18n Key                  Choice Value
------------------------- ---...-----------------------------------------
choiceDestroyOldSession   org...session.service.DestroyOldestAction
choiceDenyAccess          org...session.service.DenyAccessAction
choiceDestroyNextExpiring org...session.service.DestroyNextExpiringAction
choiceDestroyAll          org...session.service.DestroyAllAction
myKey                     org...examples...SampleQuotaExhaustionAction</em>
  </pre>
       </div>
       <div class="section" id="remove-custom-quota-exhaustion-actions">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.4.3.&nbsp;Removing a Session Quota Exhaustion Action</h3>
          </div>
         </div>
        </div>
        <p> Remove a session quota exhaustion action by using the <span class="command"><strong>ssoadm</strong></span> command or by using the <code class="literal">ssoadm.jsp</code> page. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">ssoadm \
 remove-attr-choicevals \
 --adminid amadmin \
 --password-file /tmp/pwd.txt \
 --servicename iPlanetAMSessionService \
 --schematype Global \
 --attributename iplanet-am-session-constraint-handler \
 --choicevalues \
 org.forgerock.openam.examples.quotaexhaustionaction.SampleQuotaExhaustionAction</strong>

<em class="computeroutput">Choice Values were removed.</em>
  </pre>
       </div>
      </div>
      <div class="section" id="sec-policy-spi">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">4.5.&nbsp;Customizing Policy Evaluation</h2>
         </div>
        </div>
       </div>
       <a class="indexterm" name="d14232e15271"></a>
       <p>OpenAM policies let you restrict access to resources based both on identity and group membership, and also on a range of conditions including session age, authentication chain or module used, authentication level, realm, session properties, IP address and DNS name, user profile content, resource environment, date, day, time of day, and time zone. Yet, some deployments require further distinctions for policy evaluation. This section explains how to customize policy evaluation for deployments with particular requirements not met by built-in OpenAM functionality.</p>
       <p> This section shows how to build and use a custom policy plugin that implements a subject condition, an environment condition, and resource attributes. </p>
       <div class="section" id="about-sample-policy-plugins">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.5.1.&nbsp;About the Sample Plugin</h3>
          </div>
         </div>
        </div>
        <p> The OpenAM policy framework lets you build plugins that extend subject conditions, environment conditions, and resource attributes. The <a class="link" href="https://github.com/ForgeRock/openam-policy-eval-sample" target="_blank">sample policy plugin source</a> is available online. Get a local clone so that you can read the source and try the sample on your system. In the sources you find the following files. </p>
        <div class="variablelist">
         <dl class="variablelist">
          <dt>
           <span class="term"><code class="filename">pom.xml</code></span>
          </dt>
          <dd>
           <p> Apache Maven project file for the module </p>
           <p> This file specifies how to build the sample policy evaluation plugin, and also specifies its dependencies on OpenAM components. </p>
          </dd>
          <dt>
           <span class="term"><code class="filename">src/main/java/org/forgerock/openam/examples/SampleAttributeType.java</code></span>
          </dt>
          <dd>
           <p> Extends the <code class="literal">com.sun.identity.entitlement.ResourceAttribute</code> interface, and shows an implementation of a resource attribute provider to send an attribute with the response. </p>
          </dd>
          <dt>
           <span class="term"><code class="filename">src/main/java/org/forgerock/openam/examples/SampleConditionType.java</code></span>
          </dt>
          <dd>
           <p> Extends the <code class="literal">com.sun.identity.entitlement.EntitlementCondition</code> interface, and shows an implementation of a condition that is the length of the user name. </p>
           <p> A condition influences whether the policy applies for a given access request. If the condition is fulfilled, then OpenAM includes the policy in the set of policies to evaluate in order to respond to a policy decision request. </p>
          </dd>
          <dt>
           <span class="term"><code class="filename">src/main/java/org/forgerock/openam/examples/SampleSubjectType.java</code></span>
          </dt>
          <dd>
           <p> Extends the <code class="literal">com.sun.identity.entitlement.EntitlementSubject</code> interface, and shows an implementation that defines a user to whom the policy applies. </p>
           <p> A subject, like a condition, influences whether the policy applies. If the subject matches in the context of a given access request, then the policy applies. </p>
          </dd>
          <dt>
           <span class="term"><code class="filename">src/main/java/org/forgerock/openam/examples/SampleEntitlementModule.java</code>, </span>
           <span class="term"><code class="filename">src/main/resources/META-INF/services/org.forgerock.openam.entitlement.EntitlementModule</code></span>
          </dt>
          <dd>
           <p> These files serve to register the plugin with OpenAM. </p>
           <p> The Java class, <code class="literal">SampleEntitlementModule</code>, implements the <code class="literal">org.forgerock.openam.entitlement.EntitlementModule</code> interface. In the sample, this class registers "SampleAttribute", "SampleCondition", and "SampleSubject". </p>
           <p> The services file, <code class="filename">org.forgerock.openam.entitlement.EntitlementModule</code>, holds the fully qualified class name of the <code class="literal">EntitlementModule</code> that registers the custom implementations. In this case, <code class="literal">org.forgerock.openam.entitlement.EntitlementModule</code>. </p>
          </dd>
         </dl>
        </div>
        <div class="procedure" id="building-a-sample-plugin">
         <div class="procedure-inner">
          <div class="procedure-title">
           Procedure&nbsp;4.4.&nbsp;To Build a Sample Plugin
          </div>
          <ol class="procedure" type="1">
           <li class="step"><p> Build the module using Apache Maven. </p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cd /path/to/openam-policy-eval-sample</strong>
$ <strong class="userinput">mvn install</strong>
<em class="computeroutput">[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building openam-policy-eval-sample 1.0.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------

...

[INFO] --- maven-jar-plugin:2.3.2:jar (default-jar) @ openam-policy-eval-sample
[INFO] Building jar: .../target/openam-policy-eval-sample-1.0.0-SNAPSHOT.jar
[INFO]

...

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 1.480s
[INFO] Finished at: Tue Dec 09 11:45:54 CET 2014
[INFO] Final Memory: 16M/257M
[INFO] ------------------------------------------------------------------------</em>
   </pre></li>
           <li class="step"><p> Copy the .jar to the <code class="filename">WEB-INF/lib</code> directory where you deployed OpenAM. </p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cp target/*.jar /path/to/tomcat/webapps/openam/WEB-INF/lib/</strong>
   </pre></li>
           <li class="step"><p> Restart OpenAM or the container in which it runs. </p></li>
          </ol>
         </div>
        </div>
       </div>
       <div class="section" id="add-custom-policy-impl-to-existing-apps">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.5.2.&nbsp;Adding Custom Policy Implementations to Existing Policy Applications</h3>
          </div>
         </div>
        </div>
        <p> In order to use your custom policy in existing applications, you must update the applications. Note that you cannot update an application that already has policies configured. When there are already policies configured for an application, you must instead first delete the policies, and then update the application. </p>
        <p> The following example updates the <code class="literal">iPlanetAMWebAgentService</code> policy set in the top level realm of a fresh installation. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "X-OpenAM-Username: amadmin" \
 --header "X-OpenAM-Password: password" \
 --header "Content-Type: application/json" \
 --data "{}" \
 https://openam.example.com:8443/openam/json/authenticate</strong>
<em class="computeroutput">{"tokenId":"AQIC5wM2...","successUrl":"/openam/console"}</em>

$ <strong class="userinput">curl \
 --request PUT \
 --header "iPlanetDirectoryPro: AQIC5wM2..." \
 --header "Content-Type: application/json" \
 --data '{
    "name": "iPlanetAMWebAgentService",
    "resourceTypeUuids": [
        "12345a67-8f0b-123c-45de-6fab78cd01e2"
    ],
    "realm": "/",
    "resources": [
        "*://*:*/*?*",
        "*://*:*/*"
    ],
    "actions": {
        "POST": true,
        "PATCH": true,
        "GET": true,
        "DELETE": true,
        "OPTIONS": true,
        "HEAD": true,
        "PUT": true
    },
    "description": "The built-in Application used by OpenAM Policy Agents.",
    "realm": "/",
    "conditions": [
        "AuthenticateToService",
        "AuthLevelLE",
        "AuthScheme",
        "IPv6",
        "SimpleTime",
        "OAuth2Scope",
        "IPv4",
        "AuthenticateToRealm",
        "OR",
        "AMIdentityMembership",
        "LDAPFilter",
        "AuthLevel",
        "SessionProperty",
        "Session",
        "NOT",
        "AND",
        "ResourceEnvIP",
        "SampleCondition"
    ],
    "resourceComparator": null,
    "applicationType": "iPlanetAMWebAgentService",
    "subjects": [
        "JwtClaim",
        "AuthenticatedUsers",
        "Identity",
        "NOT",
        "AND",
        "NONE",
        "OR",
        "SampleSubject"
    ],
    "attributeNames": [],
    "saveIndex": null,
    "searchIndex": null,
    "entitlementCombiner": "DenyOverride"
}' https://openam.example.com:8443/openam/json/applications/iPlanetAMWebAgentService</strong>
  </pre>
        <p> Notice that the command adds "SampleCondition" to "conditions", and "SampleSubject" to "subjects". </p>
       </div>
       <div class="section" id="trying-sample-policy-plugin">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.5.3.&nbsp;Trying the Sample Subject and Environment Conditions</h3>
          </div>
         </div>
        </div>
        <p> Using OpenAM policy editor, create a policy in the "iPlanetAMWebAgentService" policy set in the top level realm that allows HTTP GET access to "http://www.example.com:80/*" and that makes use of the custom subject and environment conditions. </p>
        <p> The following listing shows a JSON representation of the policy. </p>
        <pre class="codelisting prettyprint javascript">
{
    "name": "Sample Policy",
    "active": true,
    "description": "Try sample policy plugin",
    "resources": [
        "http://www.example.com:80/*"
    ],
    "applicationName": "iPlanetAMWebAgentService",
    "actionValues": {
        "GET": true
    },
    "subject": {
        "type": "SampleSubject",
        "name": "demo"
    },
    "condition": {
        "type": "SampleCondition",
        "nameLength": 4
    }
}
  </pre>
        <p> With the policy in place, authenticate both as a user who can request policy decisions and also as a user trying to access a resource. Both of these calls return "tokenId" values for use in the policy decision request. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "X-OpenAM-Username: amadmin" \
 --header "X-OpenAM-Password: password" \
 --header "Content-Type: application/json" \
 --data "{}" \
 https://openam.example.com:8443/openam/json/authenticate</strong>

<em class="computeroutput">{"tokenId":"AQIC5wM2LY4Sfcw...","successUrl":"/openam/console"}</em>

$ <strong class="userinput">curl \
 --request POST \
 --header "X-OpenAM-Username: demo" \
 --header "X-OpenAM-Password: changeit" \
 --header "Content-Type: application/json" \
 --data "{}" \
 https://openam.example.com:8443/openam/json/authenticate</strong>

<em class="computeroutput">{"tokenId":"AQIC5wM2LY4Sfcy...","successUrl":"/openam/console"}</em>
  </pre>
        <p> Use the administrator token ID as the header of the policy decision request, and the user token Id as the subject "ssoToken" value. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "iPlanetDirectoryPro: AQIC5wM2LY4Sfcw..." \
 --header "Content-Type: application/json" \
 --data '{
    "subject": {
      "ssoToken": "AQIC5wM2LY4Sfcy..."},
    "resources": [
        "http://www.example.com:80/index.html"
    ],
    "application": "iPlanetAMWebAgentService"
 }' \
 https://openam.example.com:8443/openam/json/policies?_action=evaluate</strong>
<em class="computeroutput">
[
   {
       "resource": "http://www.example.com:80/index.html",
       "actions": {
           "GET": true
       },
       "attributes": {},
       "advices": {}
   }
]
   </em>
  </pre>
        <p> Notice that the "actions" are set in accordance with the policy. </p>
       </div>
       <div class="section" id="trying-custom-policy-resource-attributes">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.5.4.&nbsp;Trying the Sample Resource Attributes</h3>
          </div>
         </div>
        </div>
        <p> The sample custom policy plugin can have OpenAM return an attribute with the policy decision. In order to make this work, update your policy to return a "test" attribute. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request PUT \
 --header "iPlanetDirectoryPro: AQIC5wM2LY4Sfcw..." \
 --header "Content-Type: application/json" \
 --data '{
    "name": "Sample Policy",
    "active": true,
    "description": "Try sample policy plugin",
    "resources": [
        "http://www.example.com:80/*"
    ],
    "applicationName": "iPlanetAMWebAgentService",
    "actionValues": {
        "GET": true
    },
    "subject": {
        "type": "SampleSubject",
        "name": "demo"
    },
    "condition": {
        "type": "SampleCondition",
        "nameLength": 4
    },
    "resourceAttributes": [
        {
            "type": "SampleAttribute",
            "propertyName": "test"
        }
    ]
}' http://openam.example.com:8088/openam/json/policies/Sample%20Policy</strong>
  </pre>
        <p> When you now request the same policy decision as before, OpenAM returns the "test" attribute that you configured in the policy. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "iPlanetDirectoryPro: AQIC5wM2LY4Sfcw..." \
 --header "Content-Type: application/json" \
 --data '{
    "subject": {
      "ssoToken": "AQIC5wM2LY4Sfcy..."},
    "resources": [
        "http://www.example.com:80/index.html"
    ],
    "application": "iPlanetAMWebAgentService"
 }' \
 http://openam.example.com:8080/openam/json/policies?_action=evaluate</strong>
<em class="computeroutput">
[
    {
        "resource": "http://www.example.com/profile",
        "actions": {
            "GET": true
        },
        "attributes": {
            "test": [
                "sample"
            ]
        },
        "advices": {}
    }
]</em>
  </pre>
       </div>
       <div class="section" id="extend-ssoadm-classpath">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.5.5.&nbsp;Extending the ssoadm Classpath</h3>
          </div>
         </div>
        </div>
        <p> After customizing your OpenAM deployment to use policy evaluation plugins, inform <span class="command"><strong>ssoadm</strong></span> users to add the jar file containing the plugins to the classpath before running policy management subcommands. </p>
        <p> To add a jar file to the <span class="command"><strong>ssoadm</strong></span> classpath, set the <code class="literal">CLASSPATH</code> environment variable before running the <span class="command"><strong>ssoadm</strong></span> command. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">export CLASSPATH=<em><strong class="replaceable">/path/to/jarfile</strong></em>:$CLASSPATH</strong>
$ <strong class="userinput">ssoadm ...</strong>
   </pre>
        <p> </p>
       </div>
      </div>
      <div class="section" id="sec-identity-repo-spi">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">4.6.&nbsp;Customizing Identity Data Storage</h2>
         </div>
        </div>
       </div>
       <a class="indexterm" name="d14232e15514"></a>
       <p>OpenAM maps user and group identities into a realm using data stores. An OpenAM data store relies on a Java identity repository (IdRepo) plugin to implement interaction with the identity repository where the users and groups are stored.</p>
       <div class="section" id="about-idrepo-plugin">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.6.1.&nbsp;About the Identity Repository Plugin</h3>
          </div>
         </div>
        </div>
        <p>This section describes how to create a custom identity repository plugin. OpenAM includes built-in support for LDAP and JDBC identity repositories. For most deployments, you therefore do not need to create your own custom identity repository plugin. Only create custom identity repository plugins for deployments with particular requirements not met by built-in OpenAM functionality.</p>
        <div class="panel panel-success">
         <div class="panel-heading">
          <h3 class="panel-title">Tip</h3>
         </div>
         <div class="panel-body">
          <p>Before creating your own identity repository plugin, start by reading the OpenAM source code for the <code class="literal">FilesRepo</code> or <code class="literal">DatabaseRepo</code> plugins under <code class="literal">com.sun.identity.idm.plugins</code>.</p>
         </div>
        </div>
        <div class="section" id="idrepo-plugin-inheritance">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">4.6.1.1.&nbsp;IdRepo Inheritance</h4>
           </div>
          </div>
         </div>
         <p>Your identity repository plugin class must extend the <code class="literal">com.sun.identity.idm.IdRepo</code> abstract class, and must include a constructor method that takes no arguments.</p>
        </div>
        <div class="section" id="idrepo-plugin-lifecycle">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">4.6.1.2.&nbsp;IdRepo Lifecycle</h4>
           </div>
          </div>
         </div>
         <p>When OpenAM instantiates your IdRepo plugin, it calls the <code class="literal">initialize()</code> method.</p>
         <pre class="codelisting prettyprint java">public void initialize(Map configParams)</pre>
         <p>The <code class="literal">configParams</code> are service configuration parameters for the realm where the IdRepo plugin is configured. The <code class="literal">configParams</code> normally serve to set up communication with the underlying identity data store. OpenAM calls the <code class="literal">initialize()</code> method once, and considers the identity repository ready for use.</p>
         <p>If you encounter errors or exceptions during initialization, catch and store them in your plugin for use later when OpenAM calls other plugin methods.</p>
         <p>After initialization, OpenAM calls the <code class="literal">addListener()</code> and <code class="literal">removeListener()</code> methods to register listeners that inform OpenAM client code of changes to identities managed by your IdRepo.</p>
         <pre class="codelisting prettyprint java">public int addListener(SSOToken token, IdRepoListener listener)
public void removeListener()</pre>
         <p>You must handle listener registration in your IdRepo plugin, and also return events to OpenAM through the <code class="literal">IdRepoListener</code>.</p>
         <p>When stopping, OpenAM calls your IdRepo plugin <code class="literal">shutdown()</code> method.</p>
         <pre class="codelisting prettyprint java">public void shutdown()</pre>
         <p>You are not required to implement <code class="literal">shutdown()</code> unless your IdRepo plugin has shut down work of its own to do, such as close connections to the underlying identity data store.</p>
        </div>
        <div class="section" id="idrepo-plugin-capabilities">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">4.6.1.3.&nbsp;IdRepo Plugin Capabilities</h4>
           </div>
          </div>
         </div>
         <p>Your IdRepo plugin provides OpenAM with a generic means to manage subjects—including users and groups but also special types such as roles, realms, and agents— and to create, read, update, delete, and search subjects. In order for OpenAM to determine your plugin's capabilities, it calls the methods described in this section.</p>
         <pre class="codelisting prettyprint java">public Set getSupportedTypes()</pre>
         <p>The <code class="literal">getSupportedTypes()</code> method returns a set of <code class="literal">IdType</code> objects, such as <code class="literal">IdType.USER</code> and <code class="literal">IdType.GROUP</code>. You can either hard-code the supported types into your plugin, or make them configurable through the IdRepo service.</p>
         <pre class="codelisting prettyprint java">public Set getSupportedOperations(IdType type)</pre>
         <p>The <code class="literal">getSupportedOperations()</code> method returns a set of <code class="literal">IdOperation</code> objects, such as <code class="literal">IdOperation.CREATE</code> and <code class="literal">IdOperation.EDIT</code>. You can also either hard-code these, or make them configurable.</p>
         <pre class="codelisting prettyprint java">public boolean supportsAuthentication()</pre>
         <p>The <code class="literal">supportsAuthentication()</code> method returns true if your plugin supports the <code class="literal">authenticate()</code> method.</p>
        </div>
       </div>
       <div class="section" id="idrepo-plugin-implementation">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.6.2.&nbsp;Identity Repository Plugin Implementation</h3>
          </div>
         </div>
        </div>
        <p>Your IdRepo plugin implements operational methods depending on what you support. These methods perform the operations in your data store.</p>
        <div class="variablelist">
         <dl class="variablelist">
          <dt>
           <span class="term">Create</span>
          </dt>
          <dd>
           <p>OpenAM calls <code class="literal">create()</code> to provision a new identity in the repository, where <code class="literal">name</code> is the new identity's name, and <code class="literal">attrMap</code> holds the attributes names and values.</p>
           <pre class="codelisting prettyprint java">public String create(SSOToken token, IdType type, String name, Map attrMap)
  throws IdRepoException, SSOException</pre>
          </dd>
          <dt>
           <span class="term">Read</span>
          </dt>
          <dd>
           <p>OpenAM calls the following methods to retrieve subjects in the identity repository, and to check account activity. If your data store does not support binary attributes, return an empty <code class="literal">Map</code> for <code class="literal">getBinaryAttributes()</code>.</p>
           <pre class="codelisting prettyprint java">public boolean isExists(
  SSOToken token,
  IdType type,
  String name
) throws IdRepoException, SSOException

public boolean isActive(
  SSOToken token,
  IdType type,
  String name
) throws IdRepoException, SSOException

public Map getAttributes(
  SSOToken token,
  IdType type,
  String name
) throws IdRepoException, SSOException

public Map getAttributes(
  SSOToken token,
  IdType type,
  String name,
  Set attrNames
) throws IdRepoException, SSOException

public Map getBinaryAttributes(
  SSOToken token,
  IdType type,
  String name,
  Set attrNames
) throws IdRepoException, SSOException

public RepoSearchResults search(
  SSOToken token,
  IdType type,
  String pattern,
  Map avPairs,
  boolean recursive,
  int maxResults,
  int maxTime,
  Set returnAttrs
) throws IdRepoException, SSOException

public RepoSearchResults search(
  SSOToken token,
  IdType type,
  String pattern,
  int maxTime,
  int maxResults,
  Set returnAttrs,
  boolean returnAllAttrs,
  int filterOp,
  Map avPairs,
  boolean recursive
) throws IdRepoException, SSOException</pre>
          </dd>
          <dt>
           <span class="term">Edit</span>
          </dt>
          <dd>
           <p>OpenAM calls the following methods to update a subject in the identity repository.</p>
           <pre class="codelisting prettyprint java">public void setAttributes(
  SSOToken token,
  IdType type,
  String name,
  Map attributes,
  boolean isAdd
) throws IdRepoException, SSOException

public void setBinaryAttributes(
  SSOToken token,
  IdType type,
  String name,
  Map attributes,
  boolean isAdd
) throws IdRepoException, SSOException

public void removeAttributes(
  SSOToken token,
  IdType type,
  String name,
  Set attrNames
) throws IdRepoException, SSOException

public void modifyMemberShip(
  SSOToken token,
  IdType type,
  String name,
  Set members,
  IdType membersType,
  int operation
) throws IdRepoException, SSOException

public void setActiveStatus(
  SSOToken token,
  IdType type,
  String name,
  boolean active
)</pre>
          </dd>
          <dt>
           <span class="term">Authenticate</span>
          </dt>
          <dd>
           <p>OpenAM calls <code class="literal">authenticate()</code> with the credentials from the <code class="literal">DataStore</code> authentication module.</p>
           <pre class="codelisting prettyprint java">public boolean authenticate(Callback[] credentials)
  throws IdRepoException, AuthLoginException</pre>
          </dd>
          <dt>
           <span class="term">Delete</span>
          </dt>
          <dd>
           <p>The <code class="literal">delete()</code> method removes the subject from the identity repository. The <code class="literal">name</code> specifies the subject.</p>
           <pre class="codelisting prettyprint java">public void delete(SSOToken token, IdType type, String name)
  throws IdRepoException, SSOException</pre>
          </dd>
          <dt>
           <span class="term">Service</span>
          </dt>
          <dd>
           <p>The <code class="literal">IdOperation.SERVICE</code> operation is rarely used in recent OpenAM deployments.</p>
          </dd>
         </dl>
        </div>
       </div>
       <div class="section" id="idrepo-plugin-deployment">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">4.6.3.&nbsp;Identity Repository Plugin Deployment</h3>
          </div>
         </div>
        </div>
        <p> When you build your IdRepo plugin, include <code class="filename">openam-core-13.0.0.jar</code> in the classpath. This file is found under <code class="filename">WEB-INF/lib/</code> where OpenAM is deployed. </p>
        <p> You can either package your plugin as a .jar, and then add it to <code class="filename">WEB-INF/lib/</code>, or add the classes under <code class="filename">WEB-INF/classes/</code>. </p>
        <p>To register your plugin with OpenAM, you add a <code class="literal">SubSchema</code> to the <code class="literal">sunIdentityRepositoryService</code> using the <span class="command"><strong>ssoadm</strong></span> command. First, you create the <code class="literal">SubSchema</code> document having the following structure.</p>
        <pre class="codelisting prettyprint xml">&lt;SubSchema i18nKey="x4000" inheritance="multiple" maintainPriority="no"
           name="CustomRepo" supportsApplicableOrganization="no" validate="yes"&gt;
 &lt;AttributeSchema cosQualifier="default" isSearchable="no"
                  name="RequiredValueValidator" syntax="string"
                  type="validator" &gt;
  &lt;DefaultValues&gt;
   &lt;Value&gt;com.sun.identity.sm.RequiredValueValidator&lt;/Value&gt;
  &lt;/DefaultValues&gt;
 &lt;/AttributeSchema&gt;
 &lt;AttributeSchema any="required" cosQualifier="default"
                  i18nKey="x4001" isSearchable="no"
                  name="sunIdRepoClass" syntax="string"
                  type="single" validator="RequiredValueValidator" &gt;
  &lt;DefaultValues&gt;
   &lt;Value&gt;org.test.CustomRepo&lt;/Value&gt;
  &lt;/DefaultValues&gt;
 &lt;/AttributeSchema&gt;
 &lt;AttributeSchema cosQualifier="default" i18nKey="x4002" isSearchable="no"
                  name="sunIdRepoAttributeMapping" syntax="string" type="list"&gt;
  &lt;DefaultValues&gt;
    &lt;Value&gt;&lt;/Value&gt;
  &lt;/DefaultValues&gt;
 &lt;/AttributeSchema&gt;
&lt;/SubSchema&gt;</pre>
        <p>Also include the <code class="literal">AttributeSchema</code> required to configure your IdRepo plugin.</p>
        <p> Notice the <code class="literal">i18nKey</code> attributes on <code class="literal">SubSchema</code> elements. The <code class="literal">i18nKey</code> attribute values correspond to properties in the <code class="filename">amIdRepoService.properties</code> file under <code class="filename">WEB-INF/classes/</code> where OpenAM is deployed. OpenAM console displays the label for the configuration user interface that it retrieves from the value of the <code class="literal">i18nKey</code> property in the <code class="filename">amIdRepoService.properties</code> file. </p>
        <p> To make changes to the properties, first extract <code class="filename">amIdRepoService.properties</code> and if necessary the localized versions of this file from <code class="filename">openam-core-13.0.0.jar</code> to <code class="filename">WEB-INF/classes/</code> where OpenAM is deployed. For example, if OpenAM is deployed under <code class="filename">/path/to/tomcat/webapps/openam</code>, then you could run the following commands. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cd /path/to/tomcat/webapps/openam/WEB-INF/classes/</strong>
$ <strong class="userinput">jar -xvf ../lib/openam-core-13.0.0.jar amIdRepoService.properties</strong>
 <em class="computeroutput">inflated: amIdRepoService.properties</em>
  </pre>
        <p>Register your plugin using the <span class="command"><strong>ssoadm</strong></span> command after copy the files into place.</p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">ssoadm \
 add-sub-schema \
 --adminid amadmin \
 --password-file /tmp/pwd.txt \
 --servicename sunIdentityRepositoryService \
 --schematype Organization \
 --filename customIdRepo.xml</strong>
  </pre>
        <p>Log in to the OpenAM console as administrator, then browse to Realms &gt; <em class="replaceable">Realm Name</em> &gt; Data Stores. In the Data Stores table, click New... to create a Data Store corresponding to your custom IdRepo plugin. In the first screen of the wizard, name the Data Store and select the type corresponding to your plugin. In the second screen of the wizard, add the configuration for your plugin.</p>
        <p>After creating the Data Store, create a new subject in the realm to check that your plugin works as expected. You can do this under Realms &gt; <em class="replaceable">Realm Name</em> &gt; Subjects.</p>
        <p>If your plugin supports authentication, then users should now be able to authenticate using the <code class="literal">DataStore</code> module for the realm.</p>
        <pre class="literallayout">http://openam.example.com:8080/openam/UI/Login?realm=test&amp;module=DataStore</pre>
       </div>
      </div>
     </div>
     <div lang="" class="chapter" id="chap-extending">
      <div class="titlepage">
       <div>
        <div>
         <h1 class="title">Chapter&nbsp;5.&nbsp;Extending OpenAM</h1>
        </div>
       </div>
      </div>
      <p>OpenAM services solve a wide range of access and federation management problems out of the box. Yet, OpenAM also exposes APIs and SPIs that enable you extend OpenAM services when built-in functionality does not fit your deployment.</p>
      <p>This part of the guide covers OpenAM mechanisms for plugging in additional functionality not available out of the box.</p>
      <div class="section" id="sec-post-auth">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">5.1.&nbsp;Creating a Post Authentication Plugin</h2>
         </div>
        </div>
       </div>
       <a class="indexterm" name="d14232e15865"></a>
       <p>Post authentication plugins (PAP) let you include custom processing at the end of the authentication process, immediately before the subject is authenticated. Common uses of post authentication plugins include setting cookies and session variables. Post authentication plugins are often used in conjunction with policy agents. The post authentication plugin sets custom session properties, and then the policy agent injects the custom properties into the request header to the protected application.</p>
       <p> Two issues should be considered when writing a post authentication plugin for an OpenAM deployment that uses stateless sessions: </p>
       <div class="variablelist">
        <dl class="variablelist">
         <dt>
          <span class="term">Cookie size</span>
         </dt>
         <dd>
          <p> You can set an unlimited number of session properties in a post authentication plugin. When OpenAM creates a stateless session, it writes the session properties into the session cookie, increasing the size of the cookie. Very large session cookies can exceed browser limitations. Therefore, when implementing a post authentication plugin in a deployment with stateless sessions, be sure to monitor the session cookie size and verify that you have not exceeded browser cookie size limits. </p>
          <p> For more information about stateless session cookies, see <a href="../admin-guide/index.html#session-state-cookies" class="olink">Section&nbsp;9.2, "Session Cookies"</a> in the <em>Administration Guide</em>. </p>
         </dd>
         <dt>
          <span class="term">Cookie security</span>
         </dt>
         <dd>
          <p> The OpenAM administrator secures custom session properties residing on the OpenAM server for stateful sessions by using firewalls and other typical security techniques. </p>
          <p> However, when using stateless sessions, custom session properties are written in cookies and reside on end users' systems. Cookies can be long-lasting and might represent a security issue if any session properties are of a sensitive nature. When developing a post authentication plugin for a deployment that uses stateless sessions, be sure that you are aware of the measures securing the session contained within the cookie. </p>
          <p> For more information about stateless session cookie security, see <a href="../admin-guide/index.html#session-state-stateless-cookie-security" class="olink">Section&nbsp;9.2.1, "Stateless Session Cookie Security"</a> in the <em>Administration Guide</em>. </p>
         </dd>
        </dl>
       </div>
       <p> </p>
       <p>This section explains how to create a post authentication plugin.</p>
       <div class="section" id="design-post-authentication-plugin">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">5.1.1.&nbsp;Designing Your Post Authentication Plugin</h3>
          </div>
         </div>
        </div>
        <p>Your post authentication plugin class implements the <code class="literal">AMPostAuthProcessInterface</code> interface, and in particular the following three methods.</p>
        <pre class="codelisting prettyprint java">public void onLoginSuccess(
  Map requestParamsMap,
  HttpServletRequest request,
  HttpServletResponse response,
  SSOToken token
) throws AuthenticationException

public void onLoginFailure(
  Map requestParamsMap,
  HttpServletRequest request,
  HttpServletResponse response
) throws AuthenticationException

public void onLogout(
  HttpServletRequest request,
  HttpServletResponse response,
  SSOToken token
) throws AuthenticationException</pre>
        <p>OpenAM calls the <code class="literal">onLoginSuccess()</code> and <code class="literal">onLoginFailure()</code> methods immediately before informing the user of login success or failure, respectively. OpenAM calls the <code class="literal">onLogout()</code> method only when the user actively logs out, not when a user's session times out.</p>
        <p>See the <a class="link" href="https://backstage.forgerock.com/static/docs/openam/13/apidocs/" target="_blank"><em class="citetitle">OpenAM Java SDK API Specification</em></a> for reference.</p>
        <p>These methods can perform whatever processing you require. Yet, know that OpenAM calls your methods synchronously as part of the authentication process. Therefore, if your methods take a long time to complete, you will keep users waiting. Minimize the processing done in your post authentication methods.</p>
       </div>
       <div class="section" id="build-post-authentication-plugin">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">5.1.2.&nbsp;Building Your Sample Post Authentication Plugin</h3>
          </div>
         </div>
        </div>
        <p>The following example post authentication plugin sets a session property during successful login, writing to its debug log if the operation fails.</p>
        <pre class="codelisting prettyprint java">package com.forgerock.openam.examples;

import java.util.Map;

import com.iplanet.sso.SSOException;
import com.iplanet.sso.SSOToken;

import com.sun.identity.authentication.spi.AMPostAuthProcessInterface;
import com.sun.identity.authentication.spi.AuthenticationException;
import com.sun.identity.shared.debug.Debug;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class SamplePAP implements AMPostAuthProcessInterface {
    private final static String PROP_NAME = "MyProperty";
    private final static String PROP_VALUE = "MyValue";
    private final static String DEBUG_FILE = "SamplePAP";

    protected Debug debug = Debug.getInstance(DEBUG_FILE);

    public void onLoginSuccess(
            Map requestParamsMap,
            HttpServletRequest request,
            HttpServletResponse response,
            SSOToken token
    ) throws AuthenticationException {
        try {
            token.setProperty(PROP_NAME, PROP_VALUE);
        } catch (SSOException e) {
            debug.error("Unable to set property");
        }
    }

    public void onLoginFailure(
            Map requestParamsMap,
            HttpServletRequest request,
            HttpServletResponse response
    ) throws AuthenticationException {
        // Not used
    }

    public void onLogout(
            HttpServletRequest request,
            HttpServletResponse response,
            SSOToken token
    ) throws AuthenticationException {
        // Not used
    }
}
</pre>
        <p> The <a class="link" href="https://github.com/ForgeRock/openam-post-auth-sample" target="_blank">sample post authentication plugin source</a> is available online. Get a local clone so that you can try the sample on your system. In the sources you find the following files. </p>
        <div class="variablelist">
         <dl class="variablelist">
          <dt>
           <span class="term"><code class="filename">pom.xml</code></span>
          </dt>
          <dd>
           <p> Apache Maven project file for the module </p>
           <p> This file specifies how to build the sample post authentication plugin, and also specifies its dependencies on OpenAM components and on the Servlet API. </p>
          </dd>
          <dt>
           <span class="term"><code class="filename">src/main/java/com/forgerock/openam/examples/SamplePAP.java</code></span>
          </dt>
          <dd>
           <p> Core class for the sample post authentication plugin </p>
          </dd>
         </dl>
        </div>
        <p> Build the module using Apache Maven. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cd /path/to/openam-post-auth-sample</strong>
$ <strong class="userinput">mvn install</strong>
<em class="computeroutput">[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building openam-post-auth-sample 1.0.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------

...

[INFO]
[INFO] --- maven-jar-plugin:2.3.1:jar (default-jar) @ openam-post-auth-sample --
[INFO] Building jar: .../target/openam-post-auth-sample-1.0.0-SNAPSHOT.jar

...

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 6.727s
[INFO] Finished at: Mon Nov 25 17:07:23 CET 2013
[INFO] Final Memory: 20M/227M
[INFO] ------------------------------------------------------------------------</em>
  </pre>
        <p> Copy the .jar to the <code class="filename">WEB-INF/lib</code> directory where you deployed OpenAM. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">cp target/*.jar /path/to/tomcat/webapps/openam/WEB-INF/lib/</strong>
  </pre>
        <p> Restart OpenAM or the container in which it runs. </p>
       </div>
       <div class="section" id="configure-post-authentication-plugin">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">5.1.3.&nbsp;Configuring Your Post Authentication Plugin</h3>
          </div>
         </div>
        </div>
        <p> You can configure the post authentication plugin for a realm, for a service (authentication chain), or for a role. Where you configure the plugin depends on the scope to which the plugin should apply. Configuring the plugin at the realm level as shown here, for example, ensures that OpenAM calls your plugin for all authentications to the realm. </p>
        <p> In OpenAM Console, browse to Realms &gt; <em class="replaceable">Realm Name</em> &gt; Authentication &gt; Settings &gt; Post Authentication Processing. In the Authentication Post Processing Classes list, add the sample plugin class, <code class="literal">com.forgerock.openam.examples.SamplePAP</code>, and then click Save. </p>
        <p> Alternatively, you can configure sample plugin for the realm by using the <span class="command"><strong>ssoadm</strong></span> command. </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">ssoadm
 set-svc-attrs
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --servicename iPlanetAMAuthService
 --realm /myRealm
 --attributevalues iplanet-am-auth-post-login-process-class=
 com.forgerock.openam.examples.SamplePAP</strong>

<em class="computeroutput">iPlanetAMAuthService under /myRealm was
 modified.</em>
  </pre>
       </div>
       <div class="section" id="test-post-authentication-plugin">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">5.1.4.&nbsp;Testing Your Post Authentication Plugin</h3>
          </div>
         </div>
        </div>
        <p> To test the sample post authentication plugin, login successfully to OpenAM in the scope where the plugin is configured. For example, if you configured your plugin for the realm, <code class="literal">/myRealm</code>, specify the realm in the login URL. </p>
        <pre class="literallayout">http://openam.example.com:8080/openam/UI/Login?realm=myRealm</pre>
        <p> Although as a user you do not notice anywhere in the user interface that OpenAM calls your plugin, a policy agent or custom client code could retrieve the session property that your plugin added to the user session. </p>
       </div>
      </div>
      <div class="section" id="sec-uma-extension-points">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">5.2.&nbsp;Extending UMA Workflow with Extension Points</h2>
         </div>
        </div>
       </div>
       <a class="indexterm" name="d14232e16030"></a>
       <p>OpenAM provides a number of extension points for extending the UMA workflow. These extension points are provided as filters and are dynamically loaded by using the <a class="link" href="http://docs.oracle.com/javase/7/docs/api/java/util/ServiceLoader.html" target="_top">Java <code class="literal">ServiceLoader</code> framework</a> during the UMA workflow. </p>
       <p>The extension points available are described in the sections below:</p>
       <div class="itemizedlist">
        <ul class="itemizedlist" style="list-style-type: disc; ">
         <li class="listitem"><p><a class="xref" href="#ext-resource-registration" title="5.2.1.&nbsp;Resource Set Registration Extension Point">Section&nbsp;5.2.1, "Resource Set Registration Extension Point"</a></p></li>
         <li class="listitem"><p><a class="xref" href="#ext-permission-requests" title="5.2.2.&nbsp;Permission Request Extension Point">Section&nbsp;5.2.2, "Permission Request Extension Point"</a></p></li>
         <li class="listitem"><p><a class="xref" href="#ext-authorization-requests" title="5.2.3.&nbsp;Authorization Request Extension Point">Section&nbsp;5.2.3, "Authorization Request Extension Point"</a></p></li>
         <li class="listitem"><p><a class="xref" href="#ext-resource-delegation" title="5.2.4.&nbsp;Resource Sharing Extension Point">Section&nbsp;5.2.4, "Resource Sharing Extension Point"</a></p></li>
        </ul>
       </div>
       <div class="section" id="ext-resource-registration">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">5.2.1.&nbsp;Resource Set Registration Extension Point</h3>
          </div>
         </div>
        </div>
        <p>OpenAM provides the <code class="literal">ResourceRegistrationFilter</code> extension point, which can be used to extend UMA resource set registration functionality. </p>
        <div class="table" id="ext-resource-registration-methods">
         <div class="table-title">
          Table&nbsp;5.1.&nbsp;Resource Set Registration Extension Methods
         </div>
         <div class="table-contents">
          <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Resource Set Registration Extension Methods" width="100%" border="0">
           <colgroup>
            <col width="16%">
            <col width="33%">
            <col width="51%">
           </colgroup>
           <thead>
            <tr>
             <th>Method</th>
             <th>Parameters</th>
             <th>Description</th>
            </tr>
           </thead>
           <tbody>
            <tr>
             <td> <p> <code class="literal">beforeResourceRegistration</code> </p> </td>
             <td> <p> <em class="replaceable">resourceSet</em> (type: <code class="literal">ResourceSetDescription</code>) </p> </td>
             <td> <p>Invoked before a resource set is registered in the backend. </p> <p>Changes made to the <em class="replaceable">resourceSet</em> object at this stage <span class="emphasis"><em>will</em></span> be persisted.</p> </td>
            </tr>
            <tr>
             <td> <p> <code class="literal">afterResourceRegistration</code> </p> </td>
             <td> <p> <em class="replaceable">resourceSet</em> (type: <code class="literal">ResourceSetDescription</code>) </p> </td>
             <td> <p>Invoked after a resource set is registered in the backend.</p> <p>Changes made to the <em class="replaceable">resourceSet</em> object at this stage <span class="emphasis"><em>will not</em></span> be persisted.</p> </td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <br class="table-break">
       </div>
       <div class="section" id="ext-permission-requests">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">5.2.2.&nbsp;Permission Request Extension Point</h3>
          </div>
         </div>
        </div>
        <p>OpenAM provides the <code class="literal">PermissionRequestFilter</code> extension point, which can be used to extend UMA permission request functionality. </p>
        <div class="table" id="ext-permission-requests-methods">
         <div class="table-title">
          Table&nbsp;5.2.&nbsp;Permission Request Extension Methods
         </div>
         <div class="table-contents">
          <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Permission Request Extension Methods" width="100%" border="0">
           <colgroup>
            <col width="16%">
            <col width="33%">
            <col width="51%">
           </colgroup>
           <thead>
            <tr>
             <th>Method</th>
             <th>Parameters</th>
             <th>Description</th>
            </tr>
           </thead>
           <tbody>
            <tr>
             <td> <p> <code class="literal">onPermissionRequest</code> </p> </td>
             <td> <p> <em class="replaceable">resourceSet</em> (type: <code class="literal">ResourceSetDescription</code>) </p> <p> <em class="replaceable">requestedScopes</em> (type: <code class="literal">Set&lt;String&gt;</code>) </p> <p> <em class="replaceable">requestingClientId</em> (type: <code class="literal">String</code>) </p> </td>
             <td> <p>Invoked before a permission request is created.</p> </td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <br class="table-break">
       </div>
       <div class="section" id="ext-authorization-requests">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">5.2.3.&nbsp;Authorization Request Extension Point</h3>
          </div>
         </div>
        </div>
        <p>OpenAM provides the <code class="literal">RequestAuthorizationFilter</code> extension point, which can be used to extend UMA authorization functionality. </p>
        <div class="table" id="ext-authorization-requests-methods">
         <div class="table-title">
          Table&nbsp;5.3.&nbsp;Authorization Request Extension Methods
         </div>
         <div class="table-contents">
          <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Authorization Request Extension Methods" width="100%" border="0">
           <colgroup>
            <col width="16%">
            <col width="33%">
            <col width="51%">
           </colgroup>
           <thead>
            <tr>
             <th>Method</th>
             <th>Parameters</th>
             <th>Description</th>
            </tr>
           </thead>
           <tbody>
            <tr>
             <td> <p> <code class="literal">beforeAuthorization</code> </p> </td>
             <td> <p> <em class="replaceable">permissionTicket</em> (type: <code class="literal">PermissionTicket</code>) </p> <p> <em class="replaceable">requestingParty</em> (type: <code class="literal">Subject</code>) </p> <p> <em class="replaceable">resourceOwner</em> (type: <code class="literal">Subject</code>) </p> </td>
             <td> <p>Invoked before authorization of a request is attempted.</p> <p>Throws <code class="literal">UmaException</code> if authorization of the request should not be attempted.</p> </td>
            </tr>
            <tr>
             <td> <p> <code class="literal">afterAuthorization</code> </p> </td>
             <td> <p> <em class="replaceable">isAuthorized</em> (type: <code class="literal">boolean</code>) </p> <p> <em class="replaceable">permissionTicket</em> (type: <code class="literal">PermissionTicket</code>) </p> <p> <em class="replaceable">requestingParty</em> (type: <code class="literal">Subject</code>) </p> <p> <em class="replaceable">resourceOwner</em> (type: <code class="literal">Subject</code>) </p> </td>
             <td> <p>Invoked before authorization of a request is attempted.</p> <p>If the authorization request was successful, <em class="replaceable">isAuthorized</em> will be <code class="literal">true</code>.</p> </td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <br class="table-break">
       </div>
       <div class="section" id="ext-resource-delegation">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">5.2.4.&nbsp;Resource Sharing Extension Point</h3>
          </div>
         </div>
        </div>
        <p>OpenAM provides the <code class="literal">ResourceDelegationFilter</code> extension point, which can be used to extend UMA resource sharing functionality. </p>
        <div class="table" id="ext-resource-delegation-methods">
         <div class="table-title">
          Table&nbsp;5.4.&nbsp;Resource Sharing Extension Methods
         </div>
         <div class="table-contents">
          <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Resource Sharing Extension Methods" width="100%" border="0">
           <colgroup>
            <col width="16%">
            <col width="33%">
            <col width="51%">
           </colgroup>
           <thead>
            <tr>
             <th>Method</th>
             <th>Parameters</th>
             <th>Description</th>
            </tr>
           </thead>
           <tbody>
            <tr>
             <td> <p> <code class="literal">beforeResourceShared</code> </p> </td>
             <td> <p> <em class="replaceable">umaPolicy</em> (type: <code class="literal">UmaPolicy</code>) </p> </td>
             <td> <p>Invoked before creating a sharing policy for a resource.</p> <p>Changes to the <em class="replaceable">umaPolicy</em> object at this stage <span class="emphasis"><em>will</em></span> be persisted.</p> <p>Throws <code class="literal">ResourceException</code> if a sharing policy for the resource should not be created.</p> </td>
            </tr>
            <tr>
             <td> <p> <code class="literal">afterResourceShared</code> </p> </td>
             <td> <p> <em class="replaceable">umaPolicy</em> (type: <code class="literal">UmaPolicy</code>) </p> </td>
             <td> <p>Invoked after creating a sharing policy for a resource.</p> <p>Changes to the <em class="replaceable">umaPolicy</em> object at this stage <span class="emphasis"><em>will not</em></span> be persisted.</p> </td>
            </tr>
            <tr>
             <td> <p> <code class="literal">beforeResourceSharedModification</code> </p> </td>
             <td> <p> <em class="replaceable">currentUmaPolicy</em> (type: <code class="literal">UmaPolicy</code>) </p> <p> <em class="replaceable">updatedUmaPolicy</em> (type: <code class="literal">UmaPolicy</code>) </p> </td>
             <td> <p>Invoked before altering the sharing policy of a resource.</p> <p>Changes to the <em class="replaceable">updatedUmaPolicy</em> object at this stage <span class="emphasis"><em>will</em></span> be persisted.</p> <p>Throws <code class="literal">ResourceException</code> if the sharing policy of the resource should not be modified.</p> </td>
            </tr>
            <tr>
             <td> <p> <code class="literal">onResourceSharedDeletion</code> </p> </td>
             <td> <p> <em class="replaceable">umaPolicy</em> (type: <code class="literal">UmaPolicy</code>) </p> </td>
             <td> <p>Invoked before deleting the sharing policy of a resource.</p> <p>Throws <code class="literal">ResourceException</code> if the sharing policy of the resource should not be deleted.</p> </td>
            </tr>
            <tr>
             <td> <p> <code class="literal">beforeQueryResourceSets</code> </p> </td>
             <td> <p> <em class="replaceable">userId</em> (type: <code class="literal">String</code>) </p> <p> <em class="replaceable">queryFilter</em> (type: <code class="literal">QueryFilter&lt;JsonPointer&gt;</code>) </p> </td>
             <td> <p>Invoked before querying the resource sets owned or shared with a user.</p> <p>The <em class="replaceable">userId</em> parameter provides the ID of the user making the query request. </p> <p>The <em class="replaceable">queryFilter</em> parameter provides the incoming request query filter. </p> <p>Returns a <code class="literal">QueryFilter</code> that can be used to return the user's resource sets.</p> </td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <br class="table-break">
       </div>
      </div>
     </div>
     <div lang="" class="chapter" id="chap-scripting">
      <div class="titlepage">
       <div>
        <div>
         <h1 class="title">Chapter&nbsp;6.&nbsp;Scripting OpenAM</h1>
        </div>
       </div>
      </div>
      <a class="indexterm" name="d14232e16589"></a>
      <p> This chapter explains how to use scripting to exact fine control over various aspects of OpenAM. </p>
      <p> You can use scripts for client-side and server-side authentication, policy conditions, and handling OpenID Connect claims. </p>
      <p> This chapter covers the following topics: </p>
      <div class="itemizedlist">
       <ul class="itemizedlist" style="list-style-type: disc; ">
        <li class="listitem"><p><a class="xref" href="#script-env" title="6.1.&nbsp;The Scripting Environment">The Scripting Environment</a> </p></li>
        <li class="listitem"><p><a class="xref" href="#scripting-api" title="6.2.&nbsp;The Scripting API">The Scripting API</a> </p></li>
        <li class="listitem"><p><a class="xref" href="#sec-scripting-default-scripts" title="6.3.&nbsp;Using the Default Scripts">Using the Default Scripts</a> </p></li>
       </ul>
      </div>
      <p> For information on managing scripts, see <a href="../admin-guide/index.html#chap-manage-scripts" class="olink">Chapter&nbsp;22, "Managing Scripts"</a> in the <em>Administration Guide</em> and <a class="xref" href="#sec-manage-scripts-rest" title="2.1.6.&nbsp;RESTful Script Management">Section&nbsp;2.1.6, "RESTful Script Management"</a>. </p>
      <div class="section" id="script-env">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">6.1.&nbsp;The Scripting Environment</h2>
         </div>
        </div>
       </div>
       <p> This section introduces how OpenAM executes scripts, and covers thread pools and security configuration. </p>
       <p> You can use scripts to modify default OpenAM behavior in the following situations, also known as <em class="firstterm">contexts</em>: </p>
       <div class="variablelist">
        <dl class="variablelist">
         <dt>
          <span class="term">Client-side Authentication</span>
         </dt>
         <dd>
          <p> Scripts that are executed on the client during authentication. </p>
          <div class="panel panel-info">
           <div class="panel-heading">
            <h3 class="panel-title">Note</h3>
           </div>
           <div class="panel-body">
            <p>Client-side scripts must be in JavaScript.</p>
           </div>
          </div>
         </dd>
         <dt>
          <span class="term">Server-side Authentication</span>
         </dt>
         <dd>
          <p> Scripts are included in an authentication module and are executed on the server during authentication. </p>
          <p> Scripted authentication modules are an alternative to developing custom authentication modules by using Java as described in <a class="xref" href="#sec-auth-spi" title="4.3.&nbsp;Customizing Authentication Modules">Section&nbsp;4.3, "Customizing Authentication Modules"</a>. A scripted authentication module allows you to customize default authentication behavior by adding Groovy or JavaScript code to the module configuration. </p>
          <p> To see an example server-side authentication script, see <a class="xref" href="#sec-scripted-auth-module" title="6.3.1.&nbsp;Default Server-side Authentication Script">Section&nbsp;6.3.1, "Default Server-side Authentication Script"</a>. </p>
         </dd>
         <dt>
          <span class="term">Policy Condition</span>
         </dt>
         <dd>
          <p> Scripts used as conditions within policies. </p>
          <p> To see an example policy condition script, see <a class="xref" href="#sec-scripted-policy-condition" title="6.3.2.&nbsp;Default Policy Condition Script">Section&nbsp;6.3.2, "Default Policy Condition Script"</a>. </p>
         </dd>
         <dt>
          <span class="term">OIDC Claims</span>
         </dt>
         <dd>
          <p> Scripts that gather and populate the claims in a request when issuing an ID token or making a request to the <code class="literal">userinfo</code> endpoint. </p>
         </dd>
        </dl>
       </div>
       <p> OpenAM implements a configurable scripting engine for each of the context types that are executed on the server. </p>
       <p> The scripting engines in OpenAM have two main components: security settings, and the thread pool. </p>
       <div class="mediaobject" align="center">
        <a class="fancybox" href="images/scripting-engine-overview.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_scripting-engine-overview.png" align="middle" alt="Diagram of the scripting environment within OpenAM." title="The scripting engines contain configuration for
     security settings and thread pool management."></a>
       </div>
       <div class="section" id="script-engine-security">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">6.1.1.&nbsp;Security</h3>
          </div>
         </div>
        </div>
        <p> OpenAM scripting engines provide security features for ensuring that malicious Java classes are not directly called. The engines validate scripts by checking all directly-called Java classes against a configurable blacklist and whitelist, and, optionally, against the JVM SecurityManager, if it is configured. </p>
        <p> Whitelists and blacklists contain class names that are allowed or denied execution respectively. Specify classes in whitelists and blacklists by name or by using regular expressions. </p>
        <p> Classes called by the script are checked against the whitelist first, and must match at least one pattern in the list. The blacklist is applied after the whitelist, and classes matching any pattern are disallowed. </p>
        <p> You can also configure the scripting engine to make an additional call to the JVM security manager for each class that is accessed. The security manager throws an exception if a class being called is not allowed to execute. </p>
        <p> For more information on configuring script engine security, see <a href="../reference/index.html#scripting-configuration" class="olink">Section&nbsp;1.4.17, "Scripting"</a> in the <em>Reference</em>. </p>
        <div class="variablelist">
         <div class="variablelist-title">
          Important Points About Script Engine Security
         </div>
         <p> The following points should be considered when configuring the security settings within each script engine: </p>
         <dl class="variablelist">
          <dt>
           <span class="term">The scripting engine only validates directly accessible classes.</span>
          </dt>
          <dd>
           <p> The security settings only apply to classes that the script <span class="emphasis"><em>directly</em></span> accesses. If the script calls <code class="literal">Foo.a()</code> and then that method calls <code class="literal">Bar.b()</code>, the scripting engine will be unable to prevent it. You must consider the whole chain of accessible classes. </p>
           <div class="panel panel-info">
            <div class="panel-heading">
             <h3 class="panel-title">Note</h3>
            </div>
            <div class="panel-body">
             <p> <em class="firstterm">Access</em> includes actions such as: </p>
             <div class="itemizedlist">
              <ul class="itemizedlist" style="list-style-type: disc; ">
               <li class="listitem"><p>Importing or loading a class.</p></li>
               <li class="listitem"><p> Accessing any instance of that class. For example, passed as a parameter to the script. </p></li>
               <li class="listitem"><p>Calling a static method on that class.</p></li>
               <li class="listitem"><p>Calling a method on an instance of that class.</p></li>
               <li class="listitem"><p> Accessing a method or field that returns an instance of that class. </p></li>
              </ul>
             </div>
             <p> </p>
            </div>
           </div>
          </dd>
          <dt>
           <span class="term">Potentially dangerous Java classes are blacklisted by default.</span>
          </dt>
          <dd>
           <p> All Java reflection classes (<code class="literal">java.lang.Class</code>, <code class="literal">java.lang.reflect.*</code>) are blacklisted by default to avoid bypassing the security settings. </p>
           <p> The <code class="literal">java.security.AccessController</code> class is also blacklisted by default to prevent access to the <code class="literal">doPrivileged()</code> methods. </p>
           <div class="panel panel-danger">
            <div class="panel-heading">
             <h3 class="panel-title">Caution</h3>
            </div>
            <div class="panel-body">
             <p> You should not remove potentially dangerous Java classes from the blacklist. </p>
            </div>
           </div>
          </dd>
          <dt>
           <span class="term">The whitelists and blacklists match class or package names only.</span>
          </dt>
          <dd>
           <p> The whitelist and blacklist patterns apply only to the exact class or package names involved. The script engine does not know anything about inheritance, so it is best to whitelist known, specific classes. </p>
          </dd>
         </dl>
        </div>
       </div>
       <div class="section" id="script-engine-thread-pool">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">6.1.2.&nbsp;Thread Pools</h3>
          </div>
         </div>
        </div>
        <p> Each script is executed in an individual thread. Each scripting engine starts with an initial number of threads available for executing scripts. If no threads are available for execution, OpenAM creates a new thread to execute the script, until the configured maximum number of threads is reached. </p>
        <p> If the maximum number of threads is reached, pending script executions are queued in a number of buffer threads, until a thread becomes available for execution. If a created thread has completed script execution and has remained idle for a configured amount of time, OpenAM terminates the thread, shrinking the pool. </p>
        <p> For more information on configuring script engine thread pools, see <a href="../reference/index.html#scripting-configuration" class="olink">Section&nbsp;1.4.17, "Scripting"</a> in the <em>Reference</em>.</p>
       </div>
      </div>
      <div class="section" id="scripting-api">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">6.2.&nbsp;The Scripting API</h2>
         </div>
        </div>
       </div>
       <a class="indexterm" name="d14232e16784"></a>
       <p> Client-side scripts have access only to the user agent API. The functionality provided by each user agent is different, refer to the API provided by your user agent for more information. </p>
       <div class="section" id="scripting-api-global">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">6.2.1.&nbsp;Global API Functionality</h3>
          </div>
         </div>
        </div>
        <p>This section covers functionality available to each of the server-side script types.</p>
        <div class="itemizedlist">
         <p>Global API functionality includes:</p>
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p><a class="xref" href="#scripting-api-global-http-client" title="6.2.1.1.&nbsp;Accessing HTTP Services">Accessing HTTP Services</a></p></li>
          <li class="listitem"><p><a class="xref" href="#scripting-api-global-logger" title="6.2.1.2.&nbsp;Debug Logging">Debug Logging</a></p></li>
         </ul>
        </div>
        <div class="section" id="scripting-api-global-http-client">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">6.2.1.1.&nbsp;Accessing HTTP Services</h4>
           </div>
          </div>
         </div>
         <p> OpenAM passes an HTTP client object, <code class="literal">httpClient</code>, to server-side scripts. Server-side scripts can call HTTP services with the <code class="literal">httpClient.get</code> and <code class="literal">httpClient.post</code> methods. The methods return an <code class="literal">HttpClientResponse</code> object. </p>
         <div class="table" id="scripted-auth-module-http-client-methods">
          <div class="table-title">
           Table&nbsp;6.1.&nbsp;HTTP Client Methods
          </div>
          <div class="table-contents">
           <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="HTTP Client Methods" width="100%" border="0">
            <colgroup>
             <col width="11%">
             <col width="33%">
             <col width="22%">
             <col width="34%">
            </colgroup>
            <thead>
             <tr>
              <th>Method</th>
              <th>Parameters</th>
              <th>Return Type</th>
              <th>Description</th>
             </tr>
            </thead>
            <tbody>
             <tr>
              <td> <p> <code class="literal">httpClient.get</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">URI</em></code> (type: <code class="literal">String</code>) </p> <p> <code class="literal"><em class="replaceable">Request Data</em></code> (type: <code class="literal">Map</code>) </p> </td>
              <td> <p> <code class="literal">HttpClientResponse</code> </p> </td>
              <td> <p> Perform an HTTP GET on the specified URI with the specified request data and return the response retrieved. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">httpClient.post</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">URI</em></code> (type: <code class="literal">String</code>) </p> <p> <code class="literal"><em class="replaceable">Body</em></code> (type: <code class="literal">String</code>) </p> <p> <code class="literal"><em class="replaceable">Request Data</em></code> (type: <code class="literal">Map</code>) </p> </td>
              <td> <p> <code class="literal">HttpClientResponse</code> </p> </td>
              <td> <p> Perform an HTTP POST to the specified URI with the specified body and request data and return the response retrieved. </p> </td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
         <br class="table-break">
         <p> The <code class="literal">requestData</code> object is a map in which the keys are <code class="literal">cookies</code> and <code class="literal">headers</code>. OpenAM ignores other keys. </p>
         <p> The <code class="literal">cookies</code> value, specifying the cookie headers in the request, is a list of maps where the keys are <code class="literal">domain</code>, <code class="literal">field</code>, and <code class="literal">value</code>. </p>
         <p> The <code class="literal">headers</code> value, specifying the headers in the request, is a list of maps where the keys are <code class="literal">field</code>, and <code class="literal">value</code>. </p>
         <p>An example <code class="literal">requestData</code> JavaScript object using GET would be as follows:</p>
         <pre class="codelisting prettyprint javascript">var response = httpClient.get("http://example.com:8080/openam/json/users/" + username,
{
    cookies:[
        {
            "domain": ".example.com",
            "field": "iPlanetDirectoryPro",
            "value": "E8cDkvlad83kd....KDodkIEIx*DLEDLK...JKD09d"
        }
    ],
    headers:[
        {
            "field": "Content-type",
            "value": "application/json"
        }
    ]
});</pre>
         <p>An example <code class="literal">requestData</code> JavaScript object using POST follows:</p>
         <pre class="codelisting prettyprint javascript">var response = httpClient.post("http://example.com:8080/openam/json/authenticate","{
    "authId": "eyAiYWxnIjogIkhTMjU2IiwgInR5cCI6ICJqd3QiIH0.eyAib3RrIjogIm03ODVzN2x
    sbnR1bjZvbGZ1MHZhOGVtYTQxIiwgInNlc3Npb25JZCI6ICJBUUlDNXdNMkxZNFNmY3lEeDY3QnB
    PdzJtRU9rUzNpLWhfNDdRWlMwNHBEN1ppdy4qQUFKVFNRQUNNREVBQWxOTEFCUXROak15TURjNU1
    UZzROVFUwTXpnNE5qRTNNQS4uKiIsICJyZWFsbSI6ICJkYz1vcGVuYW0sZGM9Zm9yZ2Vyb2NrLGR
    jPW9yZyIgfQ.VDRqaekQuXBm2lNI29hfwVADLxjepezuO0241VNDsIM",
    "template": "",
    "stage": "DataStore1",
    "callbacks": [
        {
            "type": "NameCallback",
            "output": [
                {
                    "name": "prompt",
                    "value": "User Name:"
                }
            ],
            "input": [
                {
                    "name": "IDToken1",
                    "value": "demo"
                }
            ]
        },
        {
            "type": "PasswordCallback",
            "output": [
                {
                    "name": "prompt",
                    "value": "Password:"
                }
            ],
            "input": [
                {
                    "name": "IDToken2",
                    "value": "changeit"
                }
            ]
        }
    ]
    }",
    {
        cookies:[
        ],
        headers:[
            {
                "field": "Content-Type",
                "value": "application/json"
            }
        ]
});</pre>
         <div class="panel panel-info">
          <div class="panel-heading">
           <h3 class="panel-title">Note</h3>
          </div>
          <div class="panel-body">
           <p>To get the form data, you can access the <code class="literal">sharedState</code> object to get the data that previous modules in the chain have obtained. For example, if you have a Data Store module in your chain, you can get the username and password from the <code class="literal">sharedState</code> object in the script. </p>
          </div>
         </div>
         <p> HTTP client requests are synchronous, blocking until they return. You can, however, set a global timeout for server-side scripts. For details, see <a href="../admin-guide/index.html#scripted-module-conf-hints" class="olink">Section&nbsp;2.4.23, "Hints for the Scripted Authentication Module"</a> in the <em>Administration Guide</em>. </p>
         <p> Server-side scripts can access response data by using the methods listed in the table below. </p>
         <div class="table" id="scripted-auth-module-http-client-response-methods">
          <div class="table-title">
           Table&nbsp;6.2.&nbsp;HTTP Client Response Methods
          </div>
          <div class="table-contents">
           <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="HTTP Client Response Methods" width="100%" border="0">
            <colgroup>
             <col width="20%">
             <col width="20%">
             <col width="20%">
             <col width="40%">
            </colgroup>
            <thead>
             <tr>
              <th>Method</th>
              <th>Parameters</th>
              <th>Return Type</th>
              <th>Description</th>
             </tr>
            </thead>
            <tbody>
             <tr>
              <td> <p> <code class="literal">HttpClientResponse.getCookies</code> </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> <code class="literal">Map&lt;String, String&gt;</code> </p> </td>
              <td> <p> Get the cookies for the returned response, if any exist. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">HttpClientResponse.getEntity</code> </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> <code class="literal">String</code> </p> </td>
              <td> <p> Get the entity of the returned response. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">HttpClientResponse.getHeaders</code> </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> <code class="literal">Map&lt;String, String&gt;</code> </p> </td>
              <td> <p> Get the headers for the returned response, if any exist. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">HttpClientResponse.getReasonPhrase</code> </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> <code class="literal">String</code> </p> </td>
              <td> <p> Get the reason phrase of the returned response. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">HttpClientResponse.getStatusCode</code> </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> <code class="literal">Integer</code> </p> </td>
              <td> <p> Get the status code of the returned response. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">HttpClientResponse.hasCookies</code> </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> <code class="literal">Boolean</code> </p> </td>
              <td> <p> Indicate whether the returned response had any cookies. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">HttpClientResponse.hasHeaders</code> </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> <code class="literal">Boolean</code> </p> </td>
              <td> <p> Indicate whether the returned response had any headers. </p> </td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
         <br class="table-break">
        </div>
        <div class="section" id="scripting-api-global-logger">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">6.2.1.2.&nbsp;Debug Logging</h4>
           </div>
          </div>
         </div>
         <p> Server-side scripts can write messages to OpenAM debug logs by using the <code class="literal">logger</code> object. </p>
         <p> OpenAM does not log debug messages from scripts by default. You can configure OpenAM to log such messages by setting the debug log level for the <code class="literal">amScript</code> service. For details, see <a href="../admin-guide/index.html#log-debug-selective-capture" class="olink">Section&nbsp;24.4.3, "Debug Logging By Service"</a> in the <em>Administration Guide</em>. </p>
         <p> The following table lists the <code class="literal">logger</code> methods. </p>
         <div class="table" id="scripted-auth-module-logger-methods">
          <div class="table-title">
           Table&nbsp;6.3.&nbsp;Logger Methods
          </div>
          <div class="table-contents">
           <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Logger Methods" width="100%" border="0">
            <colgroup>
             <col width="22%">
             <col width="22%">
             <col width="22%">
             <col width="34%">
            </colgroup>
            <thead>
             <tr>
              <th>Method</th>
              <th>Parameters</th>
              <th>Return Type</th>
              <th>Description</th>
             </tr>
            </thead>
            <tbody>
             <tr>
              <td> <p> <code class="literal">logger.error</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">Error Message</em></code> (type: <code class="literal">String</code>) </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> Write <em class="replaceable">Error Message</em> to OpenAM debug logs if ERROR level logging is enabled. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">logger.errorEnabled</code> </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> <code class="literal">Boolean</code> </p> </td>
              <td> <p> Return <code class="literal">true</code> when ERROR level debug messages are enabled. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">logger.message</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">Message</em></code> (type: <code class="literal">String</code>) </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> Write <em class="replaceable">Message</em> to OpenAM debug logs if MESSAGE level logging is enabled. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">logger.messageEnabled</code> </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> <code class="literal">Boolean</code> </p> </td>
              <td> <p> Return <code class="literal">true</code> when MESSAGE level debug messages are enabled. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">logger.warning</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">Warning Message</em></code> (type: <code class="literal">String</code>) </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> Write <em class="replaceable">Warning Message</em> to OpenAM debug logs if WARNING level logging is enabled. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">logger.warningEnabled</code> </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> <code class="literal">Boolean</code> </p> </td>
              <td> <p> Return <code class="literal">true</code> when WARNING level debug messages are enabled. </p> </td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
         <br class="table-break">
        </div>
       </div>
       <div class="section" id="scripting-api-authn">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">6.2.2.&nbsp;Authentication API Functionality</h3>
          </div>
         </div>
        </div>
        <p>This section covers the available functionality when Scripting authentication modules use client-side and server-side authentication script types.</p>
        <div class="itemizedlist">
         <p>Authentication API functionality includes:</p>
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p><a class="xref" href="#scripting-api-authn-state" title="6.2.2.1.&nbsp;Accessing Authentication State">Accessing Authentication State</a></p></li>
          <li class="listitem"><p><a class="xref" href="#scripting-api-authn-id-repo" title="6.2.2.2.&nbsp;Accessing Profile Data">Accessing Profile Data</a></p></li>
          <li class="listitem"><p><a class="xref" href="#scripting-api-authn-client-data" title="6.2.2.3.&nbsp;Accessing Client-Side Script Output Data">Accessing Client-Side Script Output Data</a></p></li>
          <li class="listitem"><p><a class="xref" href="#scripting-api-authn-request-data" title="6.2.2.4.&nbsp;Accessing Request Data">Accessing Request Data</a></p></li>
         </ul>
        </div>
        <div class="section" id="scripting-api-authn-state">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">6.2.2.1.&nbsp;Accessing Authentication State</h4>
           </div>
          </div>
         </div>
         <p> OpenAM passes <code class="literal">authState</code> and <code class="literal">sharedState</code> objects to server-side scripts in order for the scripts to access authentication state. </p>
         <p> Server-side scripts can access the current authentication state through the <code class="literal">authState</code> object. </p>
         <p> The <code class="literal">authState</code> value is <code class="literal">SUCCESS</code> if the authentication is currently successful, or <code class="literal">FAILED</code> if authentication has failed. Server-side scripts must set a value for <code class="literal">authState</code> before completing. </p>
         <p> If an earlier authentication module in the authentication chain has set the login name of the user, server-side scripts can access the login name through <code class="literal">username</code>.</p>
         <p>The following authentication modules set the login name of the user: </p>
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p>Anonymous</p></li>
           <li class="listitem"><p>Certificate</p></li>
           <li class="listitem"><p>Data Store</p></li>
           <li class="listitem"><p>Federation</p></li>
           <li class="listitem"><p>HTTP Basic</p></li>
           <li class="listitem"><p>JDBC</p></li>
           <li class="listitem"><p>LDAP</p></li>
           <li class="listitem"><p>Membership</p></li>
           <li class="listitem"><p>RADIUS</p></li>
           <li class="listitem"><p><span lang="en" class="phrase"> SecurID, </span></p></li>
           <li class="listitem"><p>Windows Desktop SSO</p></li>
           <li class="listitem"><p>Windows NT</p></li>
          </ul>
         </div>
        </div>
        <div class="section" id="scripting-api-authn-id-repo">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">6.2.2.2.&nbsp;Accessing Profile Data</h4>
           </div>
          </div>
         </div>
         <p> Server-side authentication scripts can access profile data through the methods of the <code class="literal">idRepository</code> object. </p>
         <div class="table" id="scripted-auth-module-id-repo-methods">
          <div class="table-title">
           Table&nbsp;6.4.&nbsp;Profile Data Methods
          </div>
          <div class="table-contents">
           <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Profile Data Methods" width="100%" border="0">
            <colgroup>
             <col width="22%">
             <col width="33%">
             <col width="11%">
             <col width="34%">
            </colgroup>
            <thead>
             <tr>
              <th>Method</th>
              <th>Parameters</th>
              <th>Return Type</th>
              <th>Description</th>
             </tr>
            </thead>
            <tbody>
             <tr>
              <td> <p> <code class="literal">idRepository.getAttribute</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">User Name</em></code> (type: <code class="literal">String</code>) </p> <p> <code class="literal"><em class="replaceable">Attribute Name</em></code> (type: <code class="literal">String</code>) </p> </td>
              <td> <p> <code class="literal">Set</code> </p> </td>
              <td> <p> Return the values of the named attribute for the named user. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">idRepository.setAttribute</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">User Name</em></code> (type: <code class="literal">String</code>) </p> <p> <code class="literal"><em class="replaceable">Attribute Name</em></code> (type: <code class="literal">String</code>) </p> <p> <code class="literal"><em class="replaceable">Attribute Values</em></code> (type: <code class="literal">Array</code>) </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> Set the named attribute as specified by the attribute value for the named user, and persist the result in the user's profile. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">idRepository.addAttribute</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">User Name</em></code> (type: <code class="literal">String</code>) </p> <p> <code class="literal"><em class="replaceable">Attribute Name</em></code> (type: <code class="literal">String</code>) </p> <p> <code class="literal"><em class="replaceable">Attribute Value</em></code> (type: <code class="literal">String</code>) </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> Add an attribute value to the list of attribute values associated with the attribute name for a particular user. </p> </td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
         <br class="table-break">
        </div>
        <div class="section" id="scripting-api-authn-client-data">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">6.2.2.3.&nbsp;Accessing Client-Side Script Output Data</h4>
           </div>
          </div>
         </div>
         <p> Client-side scripts add data they gather into a String object named <code class="literal">clientScriptOutputData</code>. Client-side scripts then cause the user-agent automatically to return the data to OpenAM by HTTP POST of a self-submitting form. </p>
        </div>
        <div class="section" id="scripting-api-authn-request-data">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">6.2.2.4.&nbsp;Accessing Request Data</h4>
           </div>
          </div>
         </div>
         <p> Server-side scripts can get access to the login request by using the methods of the <code class="literal">requestData</code> object. </p>
         <p> The following table lists the methods of the <code class="literal">requestData</code> object. Note that this object differs from the client-side <code class="literal">requestData</code> object (see <a class="xref" href="#scripted-auth-module-http-client-methods" title="Table&nbsp;6.1.&nbsp;HTTP Client Methods">Table&nbsp;6.1, "HTTP Client Methods"</a>) and contains information about the original authentication request made by the user. </p>
         <div class="table" id="scripted-auth-module-request-data-methods">
          <div class="table-title">
           Table&nbsp;6.5.&nbsp;Request Data Methods
          </div>
          <div class="table-contents">
           <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Request Data Methods" width="100%" border="0">
            <colgroup>
             <col width="16%">
             <col width="17%">
             <col width="16%">
             <col width="51%">
            </colgroup>
            <thead>
             <tr>
              <th>Method</th>
              <th>Parameters</th>
              <th>Return Type</th>
              <th>Description</th>
             </tr>
            </thead>
            <tbody>
             <tr>
              <td> <p> <code class="literal">requestData.getHeader</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">Header Name</em></code> (type: <code class="literal">String</code>) </p> </td>
              <td> <p> <code class="literal">String</code> </p> </td>
              <td> <p> Return the String value of the named request header, or <code class="literal">null</code> if parameter is not set. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">requestData.getHeaders</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">Header Name</em></code> (type: <code class="literal">String</code>) </p> </td>
              <td> <p> <code class="literal">String[]</code> </p> </td>
              <td> <p> Return the array of String values of the named request header, or <code class="literal">null</code> if parameter is not set. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">requestData.getParameter</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">Parameter Name</em></code> (type: <code class="literal">String</code>) </p> </td>
              <td> <p> <code class="literal">String</code> </p> </td>
              <td> <p> Return the String value of the named request parameter, or <code class="literal">null</code> if parameter is not set. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">requestData.getParameters</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">Parameter Name</em></code> (type: <code class="literal">String</code>) </p> </td>
              <td> <p> <code class="literal">String[]</code> </p> </td>
              <td> <p> Return the array of String values of the named request parameter, or <code class="literal">null</code> if parameter is not set. </p> </td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
         <br class="table-break">
        </div>
       </div>
       <div class="section" id="scripting-api-authz">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">6.2.3.&nbsp;Authorization API Functionality</h3>
          </div>
         </div>
        </div>
        <p>This section covers functionality available when scripting authorization using the policy condition script context type.</p>
        <div class="section" id="scripted-api-authz-state">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">6.2.3.1.&nbsp;Accessing Authorization State</h4>
           </div>
          </div>
         </div>
         <p> Server-side scripts can access the current authorization state through the following objects: </p>
         <div class="table" id="scripted-api-authz-state-objects">
          <div class="table-title">
           Table&nbsp;6.6.&nbsp;Authorization State Objects
          </div>
          <div class="table-contents">
           <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Authorization State Objects" width="100%" border="0">
            <colgroup>
             <col width="16%">
             <col width="17%">
             <col width="67%">
            </colgroup>
            <thead>
             <tr>
              <th>Object</th>
              <th>Type</th>
              <th>Description</th>
             </tr>
            </thead>
            <tbody>
             <tr>
              <td> <p> <code class="literal">authorized</code> </p> </td>
              <td> <p> <code class="literal">Boolean</code> </p> </td>
              <td> <p> Return <code class="literal">true</code> if the authorization is currently successful, or <code class="literal">false</code> if authorization has failed. Server-side scripts must set a value for <code class="literal">authorized</code> before completing. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">environment</code> </p> </td>
              <td> <p> <code class="literal">Map&lt;String, Set&lt;String&gt;&gt;</code> </p> </td>
              <td> <p> Describe the environment passed from the client making the authorization request. </p> <p>For example, the following shows a simple <code class="literal">environment</code> map with a single entry:</p> <pre class="codelisting prettyprint nohighlight">"environment": {
    "IP": [
        "127.0.0.1"
    ]
}</pre> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">resourceURI</code> </p> </td>
              <td> <p> <code class="literal">String</code> </p> </td>
              <td> <p> Specify the URI of the resource to which authorization is being requested. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">username</code> </p> </td>
              <td> <p> <code class="literal">String</code> </p> </td>
              <td> <p> Specify the user ID of the subject that is requesting authorization. </p> </td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
         <br class="table-break">
        </div>
        <div class="section" id="scripting-api-authz-id-repo">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">6.2.3.2.&nbsp;Accessing Profile Data</h4>
           </div>
          </div>
         </div>
         <p> Server-side authorization scripts can access profile data of the subject of the authorization request through the methods of the <code class="literal">identity</code> object. </p>
         <div class="panel panel-info">
          <div class="panel-heading">
           <h3 class="panel-title">Note</h3>
          </div>
          <div class="panel-body">
           <p>To access the profile data of the subject, they must be logged in and their SSO token must be available.</p>
          </div>
         </div>
         <div class="table" id="scripted-authz-module-id-repo-methods">
          <div class="table-title">
           Table&nbsp;6.7.&nbsp;Authorization Script Profile Data Methods
          </div>
          <div class="table-contents">
           <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Authorization Script Profile Data Methods" width="100%" border="0">
            <colgroup>
             <col width="22%">
             <col width="33%">
             <col width="11%">
             <col width="34%">
            </colgroup>
            <thead>
             <tr>
              <th>Method</th>
              <th>Parameters</th>
              <th>Return Type</th>
              <th>Description</th>
             </tr>
            </thead>
            <tbody>
             <tr>
              <td> <p> <code class="literal">identity.getAttribute</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">Attribute Name</em></code> (type: <code class="literal">String</code>) </p> </td>
              <td> <p> <code class="literal">Set</code> </p> </td>
              <td> <p> Return the values of the named attribute for the subject of the authorization request. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">identity.setAttribute</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">Attribute Name</em></code> (type: <code class="literal">String</code>) </p> <p> <code class="literal"><em class="replaceable">Attribute Values</em></code> (type: <code class="literal">Array</code>) </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> Set the named attribute to the values specified by the attribute value for the subject of the authorization request. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">identity.addAttribute</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">Attribute Name</em></code> (type: <code class="literal">String</code>) </p> <p> <code class="literal"><em class="replaceable">Attribute Value</em></code> (type: <code class="literal">String</code>) </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> Add an attribute value to the list of attribute values associated with the attribute name for the subject of the authorization request. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">identity.store</code> </p> </td>
              <td> <p> None </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> Commit any changes to the identity repository. </p> 
               <div class="panel panel-danger">
                <div class="panel-heading">
                 <h3 class="panel-title">Caution</h3>
                </div>
                <div class="panel-body">
                 <p>You must call <code class="literal">store()</code> otherwise changes will be lost when the script completes.</p>
                </div>
               </div> </td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
         <br class="table-break">
        </div>
        <div class="section" id="scripting-api-authz-session">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">6.2.3.3.&nbsp;Accessing Session Data</h4>
           </div>
          </div>
         </div>
         <p> Server-side authorization scripts can access session data of the subject of the authorization request through the methods of the <code class="literal">session</code> object. </p>
         <div class="panel panel-info">
          <div class="panel-heading">
           <h3 class="panel-title">Note</h3>
          </div>
          <div class="panel-body">
           <p>To access the session data of the subject, they must be logged in and their SSO token must be available.</p>
          </div>
         </div>
         <div class="table" id="scripted-authz-module-session-methods">
          <div class="table-title">
           Table&nbsp;6.8.&nbsp;Authorization Script Session Methods
          </div>
          <div class="table-contents">
           <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Authorization Script Session Methods" width="100%" border="0">
            <colgroup>
             <col width="22%">
             <col width="33%">
             <col width="11%">
             <col width="34%">
            </colgroup>
            <thead>
             <tr>
              <th>Method</th>
              <th>Parameters</th>
              <th>Return Type</th>
              <th>Description</th>
             </tr>
            </thead>
            <tbody>
             <tr>
              <td> <p> <code class="literal">session.getProperty</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">Property Name</em></code> (type: String) </p> </td>
              <td> <p> <code class="literal">String</code> </p> </td>
              <td> <p> Retrieve properties from the session associated with the subject of the authorization request. For example, <code class="literal">AuthLevel</code>.</p> </td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
         <br class="table-break">
        </div>
        <div class="section" id="scripting-api-authz-response">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">6.2.3.4.&nbsp;Setting Authorization Responses</h4>
           </div>
          </div>
         </div>
         <p> Server-side authorization scripts can return information in the response to an authorization request. </p>
         <div class="table" id="scripted-authz-module-response-methods">
          <div class="table-title">
           Table&nbsp;6.9.&nbsp;Authorization Script Response Methods
          </div>
          <div class="table-contents">
           <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Authorization Script Response Methods" width="100%" border="0">
            <colgroup>
             <col width="22%">
             <col width="33%">
             <col width="11%">
             <col width="34%">
            </colgroup>
            <thead>
             <tr>
              <th>Method</th>
              <th>Parameters</th>
              <th>Return Type</th>
              <th>Description</th>
             </tr>
            </thead>
            <tbody>
             <tr>
              <td> <p> <code class="literal">responseAttributes.put</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">Attribute Name</em></code> (type: <code class="literal">String</code>) </p> <p> <code class="literal"><em class="replaceable">Attribute Values</em></code> (type: <code class="literal">Array</code>) </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> Add an attribute to the response to the authorization request. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">advice.put</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">Advice Key</em></code> (type: <code class="literal">String</code>) </p> <p> <code class="literal"><em class="replaceable">Advice Values</em></code> (type: <code class="literal">Array</code>) </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> Add advice key-value pairs to the response to a failing authorization request. </p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">ttl</code> </p> </td>
              <td> <p> <code class="literal"><em class="replaceable">TTL Value</em></code> (type: <code class="literal">Integer</code>) </p> </td>
              <td> <p> <code class="literal">Void</code> </p> </td>
              <td> <p> Add a time-to-live value to the response to a successful authorization, after which the decision is no longer valid. </p> </td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
         <br class="table-break">
        </div>
       </div>
       <div class="section" id="scripting-api-oidc-claims">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">6.2.4.&nbsp;OIDC Claims API Functionality</h3>
          </div>
         </div>
        </div>
        <p>This section covers functionality available when scripting OIDC claim handling using the OIDC claims script context type.</p>
        <div class="section" id="scripted-api-oidc-request">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">6.2.4.1.&nbsp;Accessing OpenID Connect Requests</h4>
           </div>
          </div>
         </div>
         <p> Server-side scripts can access the OpenID Connect request through the following objects: </p>
         <div class="table" id="scripted-api-oidc-request-objects">
          <div class="table-title">
           Table&nbsp;6.10.&nbsp;OIDC Request Objects
          </div>
          <div class="table-contents">
           <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="OIDC Request Objects" width="100%" border="0">
            <colgroup>
             <col width="16%">
             <col width="17%">
             <col width="67%">
            </colgroup>
            <thead>
             <tr>
              <th>Object</th>
              <th>Type</th>
              <th>Description</th>
             </tr>
            </thead>
            <tbody>
             <tr>
              <td> <p> <code class="literal">scopes</code> </p> </td>
              <td> <p> <code class="literal">Set&lt;String&gt;</code> </p> </td>
              <td> <p> Contains a set of the requested scopes. For example: </p> <pre class="codelisting prettyprint JavaScript">[
    "profile",
    "openid"
]</pre> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">identity</code> </p> </td>
              <td> <p> <code class="literal">Class</code> </p> </td>
              <td> <p> Contains a representation of the identity of the resource owner. </p> <p>For more details, see the <code class="literal">com.sun.identity.idm.AMIdentity</code> class in the <a class="link" href="https://backstage.forgerock.com/static/docs/openam/13/apidocs/index.html?com/sun/identity/idm/AMIdentity.html" target="_top">OpenAM Javadoc</a>.</p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">session</code> </p> </td>
              <td> <p> <code class="literal">Class</code> </p> </td>
              <td> <p> Contains a representation of the user's session object if the request contained a session cookie. </p> <p>For more details, see the <code class="literal">com.iplanet.sso.SSOToken</code> class in the <a class="link" href="https://backstage.forgerock.com/static/docs/openam/13/apidocs/index.html?com/iplanet/sso/SSOToken.html" target="_top">OpenAM Javadoc</a>.</p> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">claims</code> </p> </td>
              <td> <p> <code class="literal">Map&lt;String, Object&gt;</code> </p> </td>
              <td> <p> Contains a map of the claims the server provides by default. For example: </p> <pre class="codelisting prettyprint JavaScript">{
    "sub": "248289761001",
    "updated_at": "1450368765"
}</pre> </td>
             </tr>
             <tr>
              <td> <p> <code class="literal">requestedClaims</code> </p> </td>
              <td> <p> <code class="literal">Map&lt;String, Set&lt;String&gt;&gt;</code> </p> </td>
              <td> <p> Contains requested claims if the <code class="literal">claims</code> query parameter is used in the request and <span class="emphasis"><em>Enable "claims_parameter_supported"</em></span> is checked in the OAuth2 provider service configuration, otherwise is empty.</p> <p>For more information see <a class="link" href="http://openid.net/specs/openid-connect-core-1_0.html#ClaimsParameter" target="_blank">"Requesting Claims using the "claims" Request Parameter"</a> in the <em class="citetitle">OpenID Connect Core 1.0</em> specification. </p> <p>Example:</p> <pre class="codelisting prettyprint nohighlight">{
    "given_name": {
        "essential": true,
        "values": [
            "Demo User",
            "D User"
        ]
    },
    "nickname": null,
    "email": {
        "essential": true
    }
}</pre> </td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
         <br class="table-break">
        </div>
       </div>
      </div>
      <div class="section" id="sec-scripting-default-scripts">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">6.3.&nbsp;Using the Default Scripts</h2>
         </div>
        </div>
       </div>
       <p> This section covers the default scripts provided in OpenAM. These scripts act as templates for creating your own scripts. They are global and can be used in any realm, and cannot be deleted. </p>
       <div class="panel panel-warning">
        <div class="panel-heading">
         <h3 class="panel-title">Warning</h3>
        </div>
        <div class="panel-body">
         <p> Editing a default script will affect every authentication module, policy condition, or OIDC claim configuration that uses the script. </p>
        </div>
       </div>
       <div class="section" id="sec-scripted-auth-module">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">6.3.1.&nbsp;Default Server-side Authentication Script</h3>
          </div>
         </div>
        </div>
        <a class="indexterm" name="d14232e18688"></a>
        <p> This section demonstrates how to use the default server-side authentication script in a Scripted Authentication module. </p>
        <p>The default server-side authentication script only authenticates a subject when the current time on the OpenAM server is between 09:00 and 17:00. The script also uses the <code class="literal">logger</code> and <code class="literal">httpClient</code> functionality provided in the scripting API. </p>
        <p>To examine the contents of the default server-side authentication script in the OpenAM console browse to Realms &gt; Top Level Realm &gt; Scripts, and then click Scripted Module - Server Side.</p>
        <p>For more information on the functions available for use in server-side authentication scripts, see <a class="xref" href="#scripting-api" title="6.2.&nbsp;The Scripting API">Section&nbsp;6.2, "The Scripting API"</a>.</p>
        <div class="section" id="sec-scripted-auth-module-prepare">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">6.3.1.1.&nbsp;Preparing OpenAM</h4>
           </div>
          </div>
         </div>
         <p>OpenAM requires a small amount of configuration before trying the example server-side authentication script. You must first create a Scripted authentication module, and then include it in an authentication chain, which can then be used when logging in to OpenAM. </p>
         <p>The procedures in this section are:</p>
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p><a class="xref" href="#proc-scripted-auth-module" title="Procedure&nbsp;6.1.&nbsp;To Create a Scripted Authentication Module that Uses the Default Server-side Authentication Script">Procedure&nbsp;6.1, "To Create a Scripted Authentication Module that Uses the Default Server-side Authentication Script"</a> </p></li>
           <li class="listitem"><p><a class="xref" href="#proc-scripted-auth-chain" title="Procedure&nbsp;6.2.&nbsp;To Create an Authentication Chain that Uses a Scripted Authentication Module">Procedure&nbsp;6.2, "To Create an Authentication Chain that Uses a Scripted Authentication Module"</a> </p></li>
          </ul>
         </div>
         <div class="procedure" id="proc-scripted-auth-module">
          <div class="procedure-inner">
           <div class="procedure-title">
            Procedure&nbsp;6.1.&nbsp;To Create a Scripted Authentication Module that Uses the Default Server-side Authentication Script
           </div>
           <p>In this procedure create a Scripted Authentication module, and link it to the default server-side authentication script.</p>
           <ol class="procedure" type="1">
            <li class="step"><p>Log in as an OpenAM administrator, for example <code class="literal">amadmin</code>.</p></li>
            <li class="step"><p>Click Realms &gt; Top Level Realm &gt; Authentication &gt; Modules.</p></li>
            <li class="step"><p>On the Authentication Modules page, click Add Module.</p></li>
            <li class="step"><p>In the Create new Module dialog box, enter a module name, such as <code class="literal">myScriptedAuthModule</code>, in the Type drop-down menu, select <code class="literal">Scripted Module</code>, and then click Create.</p></li>
            <li class="step"><p>On the module configuration page:</p>
             <ol type="a" class="substeps">
              <li class="step"><p>Uncheck the Client-side script enabled checkbox.</p></li>
              <li class="step"><p>In the Server-side Script drop-down menu, select <code class="literal">Scripted Module - Server Side</code>.</p></li>
              <li class="step"><p>Click Save Changes.</p></li>
             </ol></li>
           </ol>
          </div>
         </div>
         <div class="procedure" id="proc-scripted-auth-chain">
          <div class="procedure-inner">
           <div class="procedure-title">
            Procedure&nbsp;6.2.&nbsp;To Create an Authentication Chain that Uses a Scripted Authentication Module
           </div>
           <p>In this procedure create an authentication chain that uses a Data Store authentication module and the Scripted authentication module created in the previous procedure.</p>
           <ol class="procedure" type="1">
            <li class="step"><p>Log in as an OpenAM administrator, for example <code class="literal">amadmin</code>.</p></li>
            <li class="step"><p>Click Realms &gt; Top Level Realm &gt; Authentication &gt; Chains.</p></li>
            <li class="step"><p>On the Authentication Chains page, click Add Chain.</p></li>
            <li class="step"><p>In the Create new chain dialog box, enter a chain name, such as <code class="literal">myScriptedChain</code>, and then click Create.</p></li>
            <li class="step"><p>On the Edit Chain tab, click Add Module.</p></li>
            <li class="step"><p>In the New Module dialog box:</p>
             <ol type="a" class="substeps">
              <li class="step"><p>In the Select Module drop-down menu, select <code class="literal">DataStore</code>.</p></li>
              <li class="step"><p>In the Select Criteria drop-down menu, select <code class="literal">Required</code>.</p></li>
              <li class="step"><p>Click OK.</p></li>
             </ol><p> The Data Store authentication module checks the user credentials, whereas the Scripted authentication module does not check credentials, but instead only checks that the authentication request is processed during working hours. Without the Data Store module, the username in the Scripted authentication module could not be determined.</p></li>
            <li class="step"><p>On the Edit Chain tab, click Add Module.</p></li>
            <li class="step"><p>In the New Module dialog box:</p>
             <ol type="a" class="substeps">
              <li class="step"><p>In the Select Module drop-down menu, select the Scripted Module from the previous procedure, for example <code class="literal">myScriptedAuthModule</code>.</p></li>
              <li class="step"><p>In the Select Criteria drop-down menu, select <code class="literal">Required</code>.</p></li>
              <li class="step"><p>Click OK.</p></li>
             </ol><p>The resulting chain resembles the following:</p>
             <div class="mediaobject" align="center">
              <a class="fancybox" href="images/scripting-sample-chain.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_scripting-sample-chain.png" align="middle" alt="An example chain that uses the default server-side authentication script." title="Two modules are required: DataStore and Scripted Module - Server
     Side."></a>
             </div></li>
            <li class="step"><p>On the Edit Chain tab, click Save Changes.</p></li>
           </ol>
          </div>
         </div>
        </div>
        <div class="section" id="scripted-auth-module-try-it-out">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">6.3.1.2.&nbsp;Trying the Default Server-side Authentication Script</h4>
           </div>
          </div>
         </div>
         <p> This section shows how to log in using an authentication chain that contains a Scripted authentication module, which in turn uses the default server-side authentication script. </p>
         <div class="procedure" id="d14232e18854">
          <div class="procedure-inner">
           <div class="procedure-title">
            Procedure&nbsp;6.3.&nbsp;To Login to OpenAM Using a Chain Containing a Scripted Authentication Module
           </div>
           <ol class="procedure" type="1">
            <li class="step"><p>Log out of OpenAM.</p></li>
            <li class="step"><p>In a browser, navigate to the OpenAM login URL, and specify the authentication chain created in the previous procedure as the value of the <code class="literal">service</code> query parameter.</p><p>For example: </p><pre class="cmdline prettyprint nohighlight">https://openam.example.com:8443/openam/XUI/#login/&amp;service=<em><strong class="replaceable">myScriptedChain</strong></em></pre></li>
            <li class="step"><p> Log in as user <code class="literal">demo</code> with password <code class="literal">changeit</code>. </p><p> If login is successful, the user profile page appears. The script will also output messages, such as the following in the <code class="filename">debug/Authentication</code> log file: </p><pre class="codelisting prettyprint none">
amScript:05/08/2015 11:31:21:835 AM CEST: Thread[pool-19-thread-5,5,main]
Starting server-side JavaScript
amScript:05/08/2015 11:31:21:837 AM CEST: Thread[pool-19-thread-5,5,main]
User: demo
amScript:05/08/2015 11:31:21:837 AM CEST: Thread[pool-19-thread-5,5,main]
Current time: 11
amScript:05/08/2015 11:31:21:837 AM CEST: Thread[pool-19-thread-5,5,main]
Authentication allowed!</pre>
             <div class="panel panel-success">
              <div class="panel-heading">
               <h3 class="panel-title">Tip</h3>
              </div>
              <div class="panel-body">
               <p>The default server-side authentication script outputs log messages at the <code class="literal">message</code> and <code class="literal">error</code> level. </p>
               <p> OpenAM does not log debug messages from scripts by default. You can configure OpenAM to log such messages by setting the debug log level for the <code class="literal">amScript</code> service. For details, see <a href="../admin-guide/index.html#log-debug-selective-capture" class="olink">Section&nbsp;24.4.3, "Debug Logging By Service"</a> in the <em>Administration Guide</em>. </p>
              </div>
             </div></li>
            <li class="step"><p><span class="optional-step">(Optional) </span>To test that the script is being used as part of the login process, edit the script to alter the times when authentication is allowed:</p>
             <ol type="a" class="substeps">
              <li class="step"><p>Log out the <code class="literal">demo</code> user.</p></li>
              <li class="step"><p>Log in as an OpenAM administrator, for example <code class="literal">amadmin</code>.</p></li>
              <li class="step"><p>Click Realms &gt; Top Level Realm &gt; Scripts &gt; Scripted Module - Server Side.</p></li>
              <li class="step"><p>In the script, swap the values for <code class="literal">START_TIME</code> and <code class="literal">END_TIME</code>, for example:</p><pre class="cmdline prettyprint nohighlight">var START_TIME = 17;
var END_TIME   = 9; //</pre></li>
              <li class="step"><p>Click Save.</p></li>
              <li class="step"><p>Repeat steps 1, 2, and 3 above, logging into the module as the <code class="literal">demo</code> user as before. The authentication result will be the opposite of the previous result, as the allowed times have inverted.</p></li>
             </ol></li>
           </ol>
          </div>
         </div>
        </div>
       </div>
       <div class="section" id="sec-scripted-policy-condition">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">6.3.2.&nbsp;Default Policy Condition Script</h3>
          </div>
         </div>
        </div>
        <a class="indexterm" name="d14232e18950"></a>
        <p> This section demonstrates how to use the sample policy condition script as part of an authorization policy. To examine the contents of the sample policy condition script in the OpenAM console browse to Realms &gt; Top Level Realm &gt; Scripts, and then click <span class="emphasis"><em>Scripted Policy Condition</em></span>. </p>
        <p>The default policy condition script demonstrates how to access a user's profile information, use that information in HTTP calls, and make a policy decision based on the outcome.</p>
        <p>For more information on the functions available for use in policy condition scripts, see <a class="xref" href="#scripting-api" title="6.2.&nbsp;The Scripting API">Section&nbsp;6.2, "The Scripting API"</a>.</p>
        <div class="section" id="sec-scripted-policy-condition-prepare">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">6.3.2.1.&nbsp;Preparing OpenAM</h4>
           </div>
          </div>
         </div>
         <p>OpenAM requires a small amount of configuration before trying the default policy condition script. The default policy condition script requires that the subject of the policy has an address in their profile. The script compares the address to the country in the resource URL and to the country from which the request originated, as determined by an external GeoIP web service. The <code class="literal">demo</code> user also requires access to evaluate policies. </p>
         <p>The procedures in this section are:</p>
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p><a class="xref" href="#proc-scripted-pol-address" title="Procedure&nbsp;6.4.&nbsp;To Add an Address to the Demo User">Procedure&nbsp;6.4, "To Add an Address to the Demo User"</a> </p></li>
           <li class="listitem"><p><a class="xref" href="#proc-scripted-pol-privilege" title="Procedure&nbsp;6.5.&nbsp;To Allow the Demo User to Evaluate a Policy">Procedure&nbsp;6.5, "To Allow the Demo User to Evaluate a Policy"</a> </p></li>
           <li class="listitem"><p><a class="xref" href="#proc-scripted-pol-policy" title="Procedure&nbsp;6.6.&nbsp;To Create a Policy that Uses the Default Policy Condition Script">Procedure&nbsp;6.6, "To Create a Policy that Uses the Default Policy Condition Script"</a> </p></li>
           <li class="listitem"><p><a class="xref" href="#proc-enable-entitlement-debug-logging" title="Procedure&nbsp;6.7.&nbsp;To Enable Message-level Logging for Policy Evaluation">Procedure&nbsp;6.7, "To Enable Message-level Logging for Policy Evaluation"</a> </p></li>
          </ul>
         </div>
         <div class="procedure" id="proc-scripted-pol-address">
          <div class="procedure-inner">
           <div class="procedure-title">
            Procedure&nbsp;6.4.&nbsp;To Add an Address to the Demo User
           </div>
           <p>In this procedure, add an address value to the <code class="literal">demo</code> user's profile. The default policy condition script uses the address when performing policy evaluation.</p>
           <ol class="procedure" type="1">
            <li class="step"><p>Log in as an OpenAM administrator, for example <code class="literal">amadmin</code>.</p></li>
            <li class="step"><p>Click Realms &gt; Top Level Realm &gt; Subjects.</p></li>
            <li class="step"><p>On the User tab, click the <code class="literal">demo</code> user.</p></li>
            <li class="step"><p>In Home Address, enter a valid address. For example:</p><pre class="cmdline prettyprint nohighlight"><strong class="userinput">201 Mission St, Suite 2900, San Francisco, CA 94105</strong></pre></li>
            <li class="step"><p>Click Save.</p></li>
           </ol>
          </div>
         </div>
         <div class="procedure" id="proc-scripted-pol-privilege">
          <div class="procedure-inner">
           <div class="procedure-title">
            Procedure&nbsp;6.5.&nbsp;To Allow the Demo User to Evaluate a Policy
           </div>
           <p>In this procedure, add the <code class="literal">demo</code> user to a group and assign the privilege required to perform policy evaluations.</p>
           <ol class="procedure" type="1">
            <li class="step"><p>Log in as an OpenAM administrator, for example <code class="literal">amadmin</code>.</p></li>
            <li class="step"><p>Click Realms &gt; Top Level Realm &gt; Subjects.</p></li>
            <li class="step"><p>On the Group tab, click New, enter an ID for the group, such as <code class="literal">policyEval</code>, and then click OK.</p></li>
            <li class="step"><p>On the User tab:</p>
             <ol type="a" class="substeps">
              <li class="step"><p>Click the <code class="literal">demo</code> user.</p></li>
              <li class="step"><p>Click the Group tab.</p></li>
              <li class="step"><p>In the Available box, select the group created in step 3, and then click Add.</p></li>
              <li class="step"><p>Click Save.</p></li>
             </ol></li>
            <li class="step"><p>Click Realms &gt; Top Level Realm &gt; Privileges.</p></li>
            <li class="step"><p>Click the group created in step 3, for example <code class="literal">policyEval</code>.</p></li>
            <li class="step"><p>On the Privileges page, select <code class="literal">Read and write access to all realm and policy properties</code>.</p></li>
            <li class="step"><p>Click Save.</p></li>
           </ol>
          </div>
         </div>
         <div class="procedure" id="proc-scripted-pol-policy">
          <div class="procedure-inner">
           <div class="procedure-title">
            Procedure&nbsp;6.6.&nbsp;To Create a Policy that Uses the Default Policy Condition Script
           </div>
           <p>In this procedure, create a policy that uses the default policy condition script. Policy evaluations can then be performed to test the script functionality.</p>
           <ol class="procedure" type="1">
            <li class="step"><p>Log in as an OpenAM administrator, for example <code class="literal">amadmin</code>.</p></li>
            <li class="step"><p>Click Realms &gt; Top Level Realm &gt; Authorization &gt; Policy Sets.</p></li>
            <li class="step"><p>On the Policy Sets page, click <code class="literal">iPlanetAMWebAgentService</code>.</p></li>
            <li class="step"><p>On the iPlanetAMWebAgentService page, click Add a New Policy.</p></li>
            <li class="step"><p>Define the policy as follows:</p>
             <ol type="a" class="substeps">
              <li class="step"><p>Enter a name and description for the policy.</p></li>
              <li class="step"><p>Define resources to which the policy applies:</p>
               <ol type="i" class="substeps">
                <li class="step"><p>Select <code class="literal">URL</code> from the Resource Type drop down list.</p></li>
                <li class="step"><p>Select the resource pattern <code class="literal">*://*:*/*</code> from the Resources drop down list.</p></li>
                <li class="step"><p>Click Add.</p><p>The <code class="literal">*://*:*/*</code> resource appears in the Resources field.</p></li>
                <li class="step"><p>Click Add Resource to add a second resource to the policy.</p></li>
                <li class="step"><p>Select the resource pattern <code class="literal">*://*:*/*?*</code> from the Resources drop down list.</p></li>
                <li class="step"><p>Click Add.</p><p>The <code class="literal">*://*:*/*?*</code> resource appears along with the <code class="literal">*://*:*/*</code> resource in the Resources field.</p></li>
                <li class="step"><p>Click Create to create the policy.</p><p>The Resources tab appears as follows:</p>
                 <div class="mediaobject" align="center">
                  <a class="fancybox" href="images/scripting-sample-policy-resources.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_scripting-sample-policy-resources.png" align="middle" alt="Resources for an example policy that uses the default policy condition script." title="Configure resources for a policy as shown to try out the default policy
          condition script."></a>
                 </div></li>
               </ol></li>
              <li class="step"><p>Specify actions to which the policy applies:</p>
               <ol type="i" class="substeps">
                <li class="step"><p>Select the Actions tab.</p></li>
                <li class="step"><p>Select GET from the Select an Action drop down list.</p></li>
                <li class="step"><p>Click Add action.</p><p>The GET action appears in the list of actions. The default state for the GET action is Allow.</p><p>The Actions tab appears as follows:</p>
                 <div class="mediaobject" align="center">
                  <a class="fancybox" href="images/scripting-sample-policy-actions.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_scripting-sample-policy-actions.png" align="middle" alt="Actions for an example policy that uses the default policy condition script." title="Configure actions for a policy as shown to try out the default policy
          condition script."></a>
                 </div></li>
                <li class="step"><p>Click Save Changes.</p></li>
               </ol></li>
              <li class="step"><p>Configure subjects to which the policy applies:</p>
               <ol type="i" class="substeps">
                <li class="step"><p>Select the Subjects tab.</p></li>
                <li class="step"><p>Click the edit icon—the pencil.</p></li>
                <li class="step"><p>Select Authenticated Users from the Type drop down list.</p></li>
                <li class="step"><p>Click the OK icon—the check mark.</p><p>The Subjects tab appears as follows:</p>
                 <div class="mediaobject" align="center">
                  <a class="fancybox" href="images/scripting-sample-policy-subjects.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_scripting-sample-policy-subjects.png" align="middle" alt="Subjects for an example policy that uses the default policy condition script." title="Configure subjects for a policy as shown to try out the default policy
          condition script."></a>
                 </div></li>
                <li class="step"><p>Click Save Changes.</p></li>
               </ol></li>
              <li class="step"><p>Configure environments in which the policy applies:</p>
               <ol type="i" class="substeps">
                <li class="step"><p>Select the Environments tab.</p></li>
                <li class="step"><p>Click Add an Environment Condition.</p></li>
                <li class="step"><p>Select Script from the Type drop down list.</p></li>
                <li class="step"><p>Select Scripted Policy Condition from the Script Name drop down list.</p></li>
                <li class="step"><p>Click the OK icon—the check mark.</p><p>The Environments tab appears as follows:</p>
                 <div class="mediaobject" align="center">
                  <a class="fancybox" href="images/scripting-sample-policy-environments.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_scripting-sample-policy-environments.png" align="middle" alt="Environments for an example policy that uses the default policy condition script." title="Configure environments for a policy as shown to try out the default policy
          condition script."></a>
                 </div></li>
                <li class="step"><p>Click Save Changes.</p></li>
               </ol></li>
              <li class="step"><p>No additional configuration is required in the Response Attributes tab.</p></li>
             </ol></li>
           </ol>
          </div>
         </div>
         <div class="procedure" id="proc-enable-entitlement-debug-logging">
          <div class="procedure-inner">
           <div class="procedure-title">
            Procedure&nbsp;6.7.&nbsp;To Enable Message-level Logging for Policy Evaluation
           </div>
           <p>The default policy condition script writes to the debug logs at the <code class="literal">message</code> level. Message-level debug logging is not enabled for policy evaluation by default.</p>
           <p> This section shows how to enable message-level debug logging for policy evaluation, so that logger output from the default policy condition script can be viewed in the <code class="filename">Entitlement</code> debug log.</p>
           <ol class="procedure" type="1">
            <li class="step"><p>Log in as an OpenAM administrator, for example <code class="literal">amadmin</code>.</p></li>
            <li class="step"><p>Visit the <code class="literal">Debug.jsp</code> page, for example: <code class="literal">https://openam.example.com:8443/openam/Debug.jsp</code>.</p></li>
            <li class="step"><p> In the Debug instances drop-down, select <code class="literal">Entitlement</code>. </p></li>
            <li class="step"><p> In the Level drop-down, choose the debug level required. In this example, select <code class="literal">Message</code>. </p>
             <div class="mediaobject" align="center">
              <a class="fancybox" href="images/enable-entitlement-debug-logs.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_enable-entitlement-debug-logs.png" align="middle" alt="Use the Debug.jsp page to enable message-level debug logging." title="Use the Debug.jsp page to enable message-level debug logging."></a>
             </div></li>
            <li class="step"><p>Click Submit, and on the summary page that appears, click Confirm.</p><p>Message-level debug logging is now enabled for policy evaluation.</p></li>
           </ol>
          </div>
         </div>
        </div>
        <div class="section" id="sec-scripted-policy-condition-evaluate">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">6.3.2.2.&nbsp;Trying the Default Policy Condition Script</h4>
           </div>
          </div>
         </div>
         <p>This section demonstrates using a policy that contains the default policy condition script.</p>
         <p>To evaluate against a policy, you must first obtain an SSO token for the subject performing the evaluation, in this case the <code class="literal">demo</code> user. You can then make a call to the <code class="literal">policies?_action=evaluate</code> endpoint, including some environment information, which the policy uses to make an authorization decision. </p>
         <div class="procedure" id="d14232e19331">
          <div class="procedure-inner">
           <div class="procedure-title">
            Procedure&nbsp;6.8.&nbsp;To Evaluate a Policy
           </div>
           <ol class="procedure" type="1">
            <li class="step"><p>Obtain an SSO Token for the <code class="literal">demo</code> user:</p><pre class="cmdline prettyprint nohighlight">
<strong class="userinput">curl --request POST \
--header "Content-Type: application/json" \
--header "X-OpenAM-Username: demo" \
--header "X-OpenAM-Password: changeit" \
https://openam.example.com:8443/openam/json/authenticate</strong>
<em class="computeroutput">{
     "tokenId": "AQIC5wM2...",
     "successUrl": "/openam/console"
}</em>
</pre></li>
            <li class="step"><p>Send an evaluation request to the <code class="literal">policies</code> endpoint, using the SSO token of the <code class="literal">demo</code> user in the <code class="literal">iPlanetDirectoryPro</code> header.</p><p>In the JSON data, set the <code class="literal">subject</code> property to also be the SSO token of the <code class="literal">demo</code> user. In the <code class="literal">resources</code> property, include a URL that resides on a server in the same country as the address set for the <code class="literal">demo</code> user. In the <code class="literal">environment</code> property, include an IP address that is also based in the same country as the user and the resource. The example below uses the ForgeRock Community web site URL and an IP address from a ForgeRock office, both located in the United States: </p><pre class="cmdline prettyprint nohighlight">
<strong class="userinput">curl --request POST \
--header "Content-Type: application/json" \
--header "iPlanetDirectoryPro: AQIC5wM2..." \
--data '{
    "resources": [
        "http://www.forgerock.org:80/index.html"
    ],
    "application": "iPlanetAMWebAgentService",
    "subject": { "ssoToken": "AQIC5wM2..."},
    "environment": {
        "IP": [
            "38.99.39.210"
        ]
    }
}' \
https://openam.example.com:8443/openam/json/policies?_action=evaluate</strong>
<em class="computeroutput">[
  {
    "advices": {},
    "ttl": 9223372036854775807,
    "resource": "http://www.forgerock.org:80/index.html",
    "actions": {
      "POST": true,
      "GET": true
    },
    "attributes": {
      "countryOfOrigin": [
        "United States"
      ]
    }
  }
]</em>
</pre><p>If the country in the subject's profile matches the country determined from the source IP in the environment and the country determined from the resource URL, then OpenAM returns a list of actions available. The script will also add an attribute to the response called <code class="literal">countryOfOrigin</code> with the country as the value.</p><p>If the countries do not match, no actions are returned. In the following example, the resource URL is based in France, while the IP and user's address in the profile are based in the United States:</p><pre class="cmdline prettyprint nohighlight"><strong class="userinput">curl -X POST \
-H "Content-Type: application/json" \
-H "iPlanetDirectoryPro: AQIC5wM2..." \
-d '{
    "resources": [
        "http://www.forgerock.fr:80/index.html"
    ],
    "application": "iPlanetAMWebAgentService",
    "subject": { "ssoToken": "AQIC5wM2..."},
    "environment": {
        "IP": [
            "38.99.39.210"
        ]
    }
}' \
'https://openam.example.com:8443/openam/json/policies?_action=evaluate'</strong>
<em class="computeroutput">[
    {
        "advices": {},
        "ttl": 9223372036854775807,
        "resource": "http://www.forgerock.fr:80/index.html",
        "actions": {},
        "attributes": {}
    }
]</em>
</pre></li>
           </ol>
          </div>
         </div>
        </div>
       </div>
       <div class="section" id="sec-scripted-oidc-claims">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">6.3.3.&nbsp;Default OIDC Claims Script</h3>
          </div>
         </div>
        </div>
        <a class="indexterm" name="d14232e19405"></a>
        <p> This section demonstrates how to use the default OIDC claims script to return the profile attributes of a user in response to an OpenID Connect request for the <code class="literal">profile</code> scope. </p>
        <p>The default OIDC claims script maps the following claims to the <code class="literal">profile</code> scope:</p>
        <div class="itemizedlist">
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p>zoneinfo</p></li>
          <li class="listitem"><p>family_name</p></li>
          <li class="listitem"><p>locale</p></li>
          <li class="listitem"><p>name</p></li>
         </ul>
        </div>
        <p>To examine the contents of the default OIDC claims script in the OpenAM console browse to Realms &gt; Top Level Realm &gt; Scripts, and then click OIDC Claims Script.</p>
        <p>For more information on the functions available for use in OIDC claim scripts, see <a class="xref" href="#scripting-api" title="6.2.&nbsp;The Scripting API">Section&nbsp;6.2, "The Scripting API"</a>.</p>
        <div class="section" id="sec-scripted-oidc-claims-prepare">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">6.3.3.1.&nbsp;Preparing OpenAM</h4>
           </div>
          </div>
         </div>
         <p>OpenAM requires a small amount of configuration before trying the example OIDC claims script. You must first create an OAuth2 provider with OpenID Connect settings, and register an OpenID Connect client, before you can authenticate to the client using a web browser. </p>
         <p>The procedures in this section are:</p>
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p><a class="xref" href="#proc-oidc-script-provider" title="Procedure&nbsp;6.9.&nbsp;To Create an OpenID Connect Provider Service">Procedure&nbsp;6.9, "To Create an OpenID Connect Provider Service"</a> </p></li>
           <li class="listitem"><p><a class="xref" href="#proc-oidc-script-client" title="Procedure&nbsp;6.10.&nbsp;To Register an OpenID Connect Client">Procedure&nbsp;6.10, "To Register an OpenID Connect Client"</a> </p></li>
          </ul>
         </div>
         <div class="procedure" id="proc-oidc-script-provider">
          <div class="procedure-inner">
           <div class="procedure-title">
            Procedure&nbsp;6.9.&nbsp;To Create an OpenID Connect Provider Service
           </div>
           <p>Follow the steps in this procedure to create an OpenID Connect provider service by using the wizard.</p>
           <ol class="procedure" type="1">
            <li class="step"><p>Log in to OpenAM as an administrator, for example <code class="literal">amadmin</code>.</p></li>
            <li class="step"><p>Click Realms &gt; Top Level Realm &gt; Configure OAuth Provider &gt; Configure OpenID Connect.</p></li>
            <li class="step"><p>On the Configure OpenID Connect page, accept the default values and then click Create.</p></li>
            <li class="step"><p>Click Realms &gt; Top Level Realm &gt; Services &gt; OAuth2 Provider, and verify that the value for OIDC Claims Script is the default script, <code class="literal">OIDC Claims Script</code>.</p></li>
           </ol>
          </div>
         </div>
         <p>For a more detailed explanation and example of creating an OpenID Connect provider service, see <a href="../admin-guide/index.html#configure-openid-connect-provider" class="olink">Section&nbsp;14.2, "Configuring OpenAM As OpenID Connect Provider"</a> in the <em>Administration Guide</em>.</p>
         <div class="procedure" id="proc-oidc-script-client">
          <div class="procedure-inner">
           <div class="procedure-title">
            Procedure&nbsp;6.10.&nbsp;To Register an OpenID Connect Client
           </div>
           <p>Follow the steps in this procedure to create an OpenID Connect client agent profile.</p>
           <ol class="procedure" type="1">
            <li class="step"><p>Log in to OpenAM as an administrator, for example <code class="literal">amadmin</code>.</p></li>
            <li class="step"><p>Click Realms &gt; Top Level Realm &gt; Agents &gt; OAuth 2.0/OpenID Connect Client.</p></li>
            <li class="step"><p>In the Agent table, click New.</p></li>
            <li class="step"><p>Enter a name for the client, such as <code class="literal">oidcTest</code>, provide a password, and then click Create.</p></li>
            <li class="step"><p>On the OAuth 2.0/OpenID Connect Client page, click the agent name to configure the agent.</p></li>
            <li class="step"><p>On the edit client page:</p>
             <ol type="a" class="substeps">
              <li class="step"><p>In Redirection URIs, enter an example URI such as <code class="literal">http://www.example.com</code>.</p></li>
              <li class="step"><p>In Scope(s), enter both <code class="literal">profile</code> and <code class="literal">openid</code>.</p><p>The <code class="literal">profile</code> scope will return details about the subject such as given name and timezone. The <code class="literal">openid</code> scope indicates this is an OpenID Connect client.</p></li>
              <li class="step"><p>In Display name, enter the name of the client as it will be displayed on the consent page, for example <code class="literal">OIDC Claims Script Client</code>.</p></li>
             </ol></li>
            <li class="step"><p>Save your work.</p></li>
           </ol>
          </div>
         </div>
         <p>For a more detailed explanation and examples of registering an OpenID Connect client, see <a href="../admin-guide/index.html#register-openid-connect-clients" class="olink">Section&nbsp;14.5, "Registering OpenID Connect Relying Parties"</a> and <a href="../admin-guide/index.html#configure-oauth2-client" class="olink">Section&nbsp;5.8, "Configuring OAuth 2.0 and OpenID Connect 1.0 Clients"</a> in the <em>Administration Guide</em>.</p>
        </div>
        <div class="section" id="scripted-oidc-claims-try-it-out">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">6.3.3.2.&nbsp;Trying the Default OIDC Claims Script</h4>
           </div>
          </div>
         </div>
         <p> This section shows how to authenticate to a registered OpenID Connect client and request scopes from OpenAM, which in turn uses the default OIDC Claims script to populate the scope with claims and profile values. </p>
         <div class="procedure" id="d14232e19555">
          <div class="procedure-inner">
           <div class="procedure-title">
            Procedure&nbsp;6.11.&nbsp;To Authenticate to an OIDC Client and use the Default OIDC Claims Script
           </div>
           <ol class="procedure" type="1">
            <li class="step"><p>Log out of OpenAM.</p></li>
            <li class="step"><p>In an Internet browser, navigate to the OpenAM OAuth 2.0 authorization endpoint, <code class="literal">/oauth2/authorize</code>, and specify the following query parameters, with the values you configured in the agent profile:</p>
             <div class="table" id="table-oidc-profile-mappings">
              <div class="table-title">
               Table&nbsp;6.11.&nbsp;Query parameters for OpenID Connect Authorization to an Agent Profile
              </div>
              <div class="table-contents">
               <table xmlns:ng="http://docbook.org/docbook-ng" xmlns:db="http://docbook.org/ns/docbook" xmlns:exsl="http://exslt.org/common" xmlns:exslt="http://exslt.org/common" xmlns:doc="http://nwalsh.com/xsl/documentation/1.0" xmlns:stbl="http://nwalsh.com/xslt/ext/com.nwalsh.saxon.Table" xmlns:xtbl="xalan://com.nwalsh.xalan.Table" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:ptbl="http://nwalsh.com/xslt/ext/xsltproc/python/Table" class="table table-striped" summary="Query parameters for OpenID Connect Authorization to an Agent Profile" border="0">
                <colgroup>
                 <col width="20%">
                 <col width="80%">
                </colgroup>
                <thead>
                 <tr>
                  <th>Query Parameter</th>
                  <th>Agent Profile Property Value</th>
                 </tr>
                </thead>
                <tbody>
                 <tr>
                  <td><code class="literal">client_id</code></td>
                  <td>Name of the agent, for example <code class="literal">oidcTest</code>.</td>
                 </tr>
                 <tr>
                  <td><code class="literal">redirect_uri</code></td>
                  <td>Redirection URIs, for example <code class="literal">http://www.example.com</code>.</td>
                 </tr>
                 <tr>
                  <td><code class="literal">response_type</code></td>
                  <td>Response Types, for example <code class="literal">code</code>.</td>
                 </tr>
                 <tr>
                  <td><code class="literal">scope</code></td>
                  <td>Scope(s), for example <code class="literal">openid profile</code>.</td>
                 </tr>
                </tbody>
               </table>
              </div>
             </div><br class="table-break"><p>For example: <code class="literal">http://openam.example.com:8080/openam/oauth2/authorize?client_id=oidcTest&amp;redirect_uri=http://www.example.com&amp;response_type=code&amp;scope=openid profile</code> </p></li>
            <li class="step"><p>Log in to OpenAM as <code class="literal">demo</code>, with password <code class="literal">changeit</code>.</p></li>
            <li class="step"><p>On the consent page, expand the panel labelled Your personal information to see the claim values the default OIDC script has populated into the requested <code class="literal">profile</code> scope.</p>
             <div class="mediaobject" align="center">
              <a class="fancybox" href="images/scripting-sample-oidc-consent.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_scripting-sample-oidc-consent.png" align="middle" alt="The OpenID Consent Screen with Claims Mapped to a Scope." title="The OIDC Claims script maps claims to scopes."></a>
             </div></li>
            <li class="step"><p>Click Allow to be redirected to the Redirection URI specified in the agent profile. The authorization code is appended to the redirection URI as the value of the <code class="literal">code</code> query parameter.</p></li>
           </ol>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <div lang="" class="chapter" id="chap-sts">
      <div class="titlepage">
       <div>
        <div>
         <h1 class="title">Chapter&nbsp;7.&nbsp;Working With the Security Token Service</h1>
        </div>
       </div>
      </div>
      <a class="indexterm" name="d14232e19656"></a>
      <p> This chapter covers tasks developers perform when working with OpenAM's Security Token Service (STS). </p>
      <p> The Security Token Service transforms security tokens upon request. For example, you can call the Security Token Service to convert a username and password token to a SAML v2.0 token. For a complete description of the Security Token Service, including operational flow, supported token types, configuration, and deployment, see <a href="../admin-guide/index.html#chap-sts" class="olink">Chapter&nbsp;17, "Configuring the Security Token Service"</a> in the <em>Administration Guide</em>. </p>
      <p> This section covers tasks that developers perform when working with the Security Token Service: </p>
      <div class="itemizedlist">
       <ul class="itemizedlist" style="list-style-type: disc; ">
        <li class="listitem"><p> <a class="xref" href="#sts-publish" title="7.1.&nbsp;Publishing STS Instances">Section&nbsp;7.1, "Publishing STS Instances"</a> </p></li>
        <li class="listitem"><p> <a class="xref" href="#sts-consume" title="7.2.&nbsp;Consuming STS Instances">Section&nbsp;7.2, "Consuming STS Instances"</a> </p></li>
        <li class="listitem"><p> <a class="xref" href="#sts-query-validate-cancel" title="7.3.&nbsp;Querying, Validating, and Canceling Tokens">Section&nbsp;7.3, "Querying, Validating, and Canceling Tokens"</a> </p></li>
        <li class="listitem"><p> <a class="xref" href="#sts-custom-token-types" title="7.4.&nbsp;Extending STS to Support Custom Token Types">Section&nbsp;7.4, "Extending STS to Support Custom Token Types"</a> </p></li>
       </ul>
      </div>
      <div class="section" id="sts-publish">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">7.1.&nbsp;Publishing STS Instances</h2>
         </div>
        </div>
       </div>
       <p> You configure STS <em class="firstterm">instances</em> to perform one or more token transformations. Each instance provides configuration details about how SAML v2.0 and/or OpenID Connect output tokens are encrypted or signed. Deployments that support multiple SAML v2.0 and/or OpenID Connect service providers require multiple STS instances. </p>
       <p> <em class="firstterm">Publishing an STS instance</em> means creating an STS instance with a given configuration. </p>
       <p> OpenAM supports two types of STS instances: REST STS instances and SOAP STS instances. REST STS instances provide token transformations by letting users call REST API endpoints, while SOAP STS instances provide token transformations by letting users call WS-Trust 1.4-compliant SOAP endpoints. </p>
       <p> OpenAM provides two techniques for publishing STS instances: </p>
       <div class="itemizedlist">
        <ul class="itemizedlist" style="list-style-type: disc; ">
         <li class="listitem"><p> Creating and configuring the instance by using the OpenAM console </p></li>
         <li class="listitem"><p> Executing code that calls the <code class="literal">sts-publish</code> REST endpoint </p></li>
        </ul>
       </div>
       <p> <a href="../admin-guide/index.html#chap-sts" class="olink">Chapter&nbsp;17, "Configuring the Security Token Service"</a> in the <em>Administration Guide</em> describes how to create and configure STS instances by using the OpenAM console. This chapter covers how to publish STS instances programmatically. </p>
       <p> When you publish a REST STS instance, OpenAM exposes a REST endpoint for accessing the instance, and the instance is immediately available for use to callers. </p>
       <p> For SOAP STS instances, there is an additional deployment step. In order for the SOAP endpoint to be exposed, a SOAP STS deployment must exist for the realm in which the SOAP STS instance was created. A SOAP STS deployment is a running web application separate from OpenAM. For information about creating SOAP STS deployments, see <a href="../admin-guide/index.html#sts-deploy-soap-sts" class="olink">Section&nbsp;17.7, "Deploying SOAP STS Instances"</a> in the <em>Administration Guide</em>. </p>
       <div class="section" id="sts-publish-service">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">7.1.1.&nbsp;The Publish Service</h3>
          </div>
         </div>
        </div>
        <p> To publish an STS instance, perform an HTTP POST on one of the <code class="literal">sts-publish</code> endpoints: </p>
        <div class="itemizedlist">
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p> <code class="literal">/sts-publish/rest</code>, for REST STS instances </p></li>
          <li class="listitem"><p> <code class="literal">/sts-publish/soap</code>, for SOAP STS instances </p></li>
         </ul>
        </div>
        <p> Specify the <code class="literal">_action=create</code> parameter in the URL. </p>
        <p> For example, you could publish a REST STS instance named <code class="literal">username-transformer</code> in the Top Level Realm as follows: </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "iPlanetDirectoryPro: AQIC5..." \
 --header "Content-Type: application/json" \
 --data '{
    "invocation_context": "invocation_context_client_sdk",
    "instance_state": {
      "saml2-config": {
        "issuer-name":"saml2-issuer",
        ...
      },
      "deployment-config": {
        "deployment-url-element":"username-transformer",
        "deployment-realm":"/",
        ...
      },
      "persist-issued-tokens-in-cts":"false",
      "supported-token-transforms":[{
        "inputTokenType":"USERNAME",
        "outputTokenType":"OPENIDCONNECT",
        "invalidateInterimOpenAMSession":false
      }],
      "oidc-id-token-config":{
        "oidc-issuer":"test",
        ...
      }
    }
  } \
 https://openam.example.com:8443/openam/sts-publish/rest?_action=create</strong>
<em class="computeroutput">{
  "_id":"username-transformer",
  "_rev":"21939129",
  "result":"success",
  "url_element":"username-transformer"}
}</em></pre>
        <p> The <code class="literal">instance_state</code> object in the JSON payload represents the STS instance's configuration. For a complete example of an <code class="literal">instance_state</code> object, see the sample code for the <code class="literal">RestSTSInstancePublisher</code> class in <a class="xref" href="#sts-publish-rest" title="7.1.2.&nbsp;Publishing REST STS Instances">Section&nbsp;7.1.2, "Publishing REST STS Instances"</a>. </p>
        <p> Accessing the <code class="literal">sts-publish</code> endpoint requires administrative privileges. Authenticate as an OpenAM administrative user, such as <code class="literal">amadmin</code>, before attempting to publish an STS instance. </p>
        <p> In addition to publishing instances, the <code class="literal">sts-publish</code> endpoint can also return the configuration of an STS instance when you perform an HTTP GET on the <code class="literal">sts-publish</code> endpoint for the instance. The endpoint you access differs for REST and SOAP STS instances: </p>
        <div class="itemizedlist">
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p> For REST STS instances, access <code class="literal">/sts-publish/rest/<em class="replaceable">realm</em>/<em class="replaceable">deployment-URL-element</em></code> </p></li>
          <li class="listitem"><p> For SOAP STS instances, access <code class="literal">/sts-publish/soap/<em class="replaceable">realm</em>/<em class="replaceable">deployment-URL-element</em></code> </p></li>
         </ul>
        </div>
        <p> In the preceding examples, <em class="replaceable">deployment-URL-element</em> is the value of the STS instance's deployment URL element—one of the instance's configuration properties. <em class="replaceable">realm</em> is the realm in which a SOAP STS instance has been configured. </p>
        <p> For example, you could obtain the configuration of a REST STS instance configured in the Top Level Realm with the deployment URL element <code class="literal">username-transformer</code> as follows: </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request GET \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/sts-publish/rest/username-transformer</strong>
<em class="computeroutput">{
  "_id":"username-transformer",
  "_rev":"-659999943",
  "username-transformer": {
    "saml2-config": {
      "issuer-name":"saml2-issuer",
      ...
    },
    "deployment-config": {
      "deployment-url-element":"username-transformer",
      ...
    },
    "persist-issued-tokens-in-cts":"false",
    "supported-token-transforms":[{
      "inputTokenType":"USERNAME",
      "outputTokenType":"OPENIDCONNECT",
      "invalidateInterimOpenAMSession":false
      }],
    "oidc-id-token-config":{
      "oidc-issuer":"test",
      ...
    }
  }
}</em></pre>
        <p> You can delete STS instances by performing an HTTP DELETE on the <code class="literal">sts-publish</code> endpoint. The endpoint you access differs for REST and SOAP STS instances: </p>
        <div class="itemizedlist">
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p> For REST STS instances, perform an HTTP DELETE on <code class="literal">/sts-publish/rest/<em class="replaceable">realm</em>/<em class="replaceable">deployment-URL-element</em></code> </p></li>
          <li class="listitem"><p> For SOAP STS instances, perform an HTTP DELETE on <code class="literal">/sts-publish/soap/<em class="replaceable">realm</em>/<em class="replaceable">deployment-URL-element</em></code> </p></li>
         </ul>
        </div>
       </div>
       <div class="section" id="sts-publish-rest">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">7.1.2.&nbsp;Publishing REST STS Instances</h3>
          </div>
         </div>
        </div>
        <p> The sample code referenced in this section provides an example of how to programmatically publish REST STS instance. The code is not intended to be a working example. Rather, it is a starting point—code that you can modify to satisfy your organization's specific requirements. </p>
        <p> After publishing a REST STS instance programmatically, you can view the instance's configuration in the OpenAM console. The instance is ready for consumption. </p>
        <p> Sample code is available for the following classes: </p>
        <div class="variablelist">
         <dl class="variablelist">
          <dt>
           <span class="term"> <a class="link" href="https://raw.githubusercontent.com/ForgeRock/openam-sts-example-code/13/RestSTSInstancePublisher.java" target="_blank"><code class="filename">RestSTSInstancePublisher</code></a> </span>
          </dt>
          <dd>
           <p> The <code class="literal">RestSTSInstancePublisher</code> class exposes an API to publish, delete, and update REST STS instances by calling methods that perform an HTTP POST operation on the <code class="literal">soap-sts/publish</code> endpoint. </p>
          </dd>
          <dt>
           <span class="term"> <a class="link" href="https://raw.githubusercontent.com/ForgeRock/openam-sts-example-code/13/RestSTSInstanceConfigFactory.java" target="_blank"><code class="filename">RestSTSInstanceConfigFactory</code></a> </span>
          </dt>
          <dd>
           <p> The <code class="filename">RestSTSInstancePublisher</code>class calls the <code class="literal">RestSTSInstanceConfigFactory</code> class to create a <code class="literal">RestSTSInstanceConfig</code> instance. <code class="literal">RestSTSInstanceConfig</code> objects encapsulate all the configuration information of a REST STS instance, and emit JSON values that you can post to the <code class="literal">sts-publish/rest</code> endpoint to publish a REST STS instance. </p>
          </dd>
          <dt>
           <span class="term"> <a class="link" href="https://raw.githubusercontent.com/ForgeRock/openam-sts-example-code/13/STSPublishContext.java" target="_blank"><code class="filename">STSPublishContext</code></a> </span>
          </dt>
          <dd>
           <p> The sample <code class="literal">STSPublishContext</code> class specifies the configuration necessary to publish REST and SOAP STS instances. The class provides a programmatic method for setting configuration properties—the same configuration properties available through the OpenAM console under Realms &gt; <em class="replaceable">Realm Name</em> &gt; STS. </p>
          </dd>
          <dt>
           <span class="term"> <a class="link" href="https://raw.githubusercontent.com/ForgeRock/openam-sts-example-code/13/CustomTokenOperationContext.java" target="_blank"><code class="filename">CustomTokenOperationContext</code></a> </span>
          </dt>
          <dd>
           <p> The sample <code class="literal">CustomTokenOperationContext</code> class specifies custom validators, token types, and transformations that a REST STS instance can support. </p>
          </dd>
         </dl>
        </div>
        <div class="panel panel-primary">
         <div class="panel-heading">
          <h3 class="panel-title">Important</h3>
         </div>
         <div class="panel-body">
          <p> The sample code referenced in this section is <span class="emphasis"><em>not</em></span> compilable, because it uses classes that are not available publicly. The code provides patterns to developers familiar with the problem domain and is intended only to assist developers who want to programmatically publish REST STS instances. </p>
          <p> The sample code imports a number of classes, introducing dependencies. Classes imported from the OpenAM client SDK can remain in your code, but other imported classes must be removed and replaced with code that provides similar functionality in your environment. For example, the <code class="literal">RestSTSInstanceConfigFactory</code> class uses a constant named <code class="literal">CommonConstants.DEFAULT_CERT_MODULE_NAME</code> from the imported <code class="literal">com.forgerock.openam.functionaltest.sts.frmwk.common.CommonConstants</code> utility class. This utility class is not publicly available. Therefore, you need to replace this constant with another construct. </p>
          <p> The critical part of the sample code is the idioms that programmatically set all the state necessary to publish a REST STS instance. </p>
         </div>
        </div>
       </div>
       <div class="section" id="sts-publish-soap">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">7.1.3.&nbsp;Publishing SOAP STS Instances</h3>
          </div>
         </div>
        </div>
        <p> The sample code referenced in this section provides an example of how to programmatically publish of a SOAP STS instance. The code is not intended to be a working example. Rather, it is starter code that you can modify to satisfy your organization's specific requirements. </p>
        <p> After publishing a SOAP STS instance programmatically, you can view the instance's configuration in the OpenAM console. However, the instance is not ready for consumption until after you have created and deployed a SOAP STS <code class="literal">.war</code> file. For information about how to create and deploy a SOAP STS <code class="literal">.war</code> file, see <a href="../admin-guide/index.html#sts-deploy-soap-sts" class="olink">Section&nbsp;17.7, "Deploying SOAP STS Instances"</a> in the <em>Administration Guide</em>." </p>
        <p> Sample code is available for the following classes: </p>
        <div class="variablelist">
         <dl class="variablelist">
          <dt>
           <span class="term"> <a class="link" href="https://raw.githubusercontent.com/ForgeRock/openam-sts-example-code/13/SoapSTSInstancePublisher.java" target="_blank"><code class="filename">SoapSTSInstancePublisher</code></a> </span>
          </dt>
          <dd>
           <p> The sample <code class="literal">SoapSTSInstancePublisher</code> class exposes an API to publish, delete, and update SOAP STS instances by calling methods that perform an HTTP POST operation on the <code class="literal">soap-sts-publish/publish</code> endpoint. </p>
          </dd>
          <dt>
           <span class="term"> <a class="link" href="https://raw.githubusercontent.com/ForgeRock/openam-sts-example-code/13/SoapSTSInstanceConfigFactory.java" target="_blank"><code class="filename">SoapSTSInstanceConfigFactory</code></a> </span>
          </dt>
          <dd>
           <p> The sample <code class="literal">SoapSTSInstancePublisher</code> class calls the <code class="literal">SoapSTSInstanceConfigFactory</code> class to create a <code class="literal">SoapSTSInstanceConfig</code> instance. <code class="literal">SoapSTSInstanceConfig</code> objects encapsulate all the configuration information of a SOAP STS instance, and emit JSON values that you can post to the <code class="literal">soap-sts-publish/publish</code> endpoint to publish a REST STS instance. </p>
          </dd>
          <dt>
           <span class="term"> <a class="link" href="https://raw.githubusercontent.com/ForgeRock/openam-sts-example-code/13/SoapSTSServerCryptoState.java" target="_blank"><code class="filename">SoapSTSServerCryptoState</code></a> </span>
          </dt>
          <dd>
           <p> The sample <code class="literal">SoapSTSServerCryptoState</code> class specifies the configuration for the keystore used by a SOAP STS instance. The class provides a programmatic method for setting configuration properties—the same configuration properties available through the OpenAM console under Realms &gt; <em class="replaceable">Realm Name</em> &gt; STS &gt; Soap Keystore Configuration. </p>
          </dd>
          <dt>
           <span class="term"> <a class="link" href="https://raw.githubusercontent.com/ForgeRock/openam-sts-example-code/13/STSPublishContext.java" target="_blank"><code class="filename">STSPublishContext</code></a> </span>
          </dt>
          <dd>
           <p> The sample <code class="literal">STSPublishContext</code> class specifies the configuration necessary to publish REST and SOAP STS instances. The class provides a programmatic method for setting configuration properties—the same configuration properties available through the OpenAM console under Realms &gt; <em class="replaceable">Realm Name</em> &gt; STS. </p>
          </dd>
         </dl>
        </div>
        <div class="panel panel-primary">
         <div class="panel-heading">
          <h3 class="panel-title">Important</h3>
         </div>
         <div class="panel-body">
          <p> The sample code referenced in this section is <span class="emphasis"><em>not</em></span> compilable, because it uses classes that are not available publicly. The code provides patterns to developers familiar with the problem domain and is intended only to assist developers who want to programmatically publish SOAP STS instances. </p>
          <p> The sample code imports a number of classes, introducing dependencies. Classes imported from the OpenAM client SDK and the SOAP STS client SDK can remain in your code, but other imported classes must be removed and replaced with code that provides similar functionality in your environment. For example, the <code class="literal">SoapSTSInstanceConfigFactory</code> class uses a constant named <code class="literal">CommonConstants.DEFAULT_CERT_MODULE_NAME</code> from the imported <code class="literal">com.forgerock.openam.functionaltest.sts.frmwk.common.CommonConstants</code> utility class. This utility class is not publicly available. Therefore, you need to replace this constant with another construct. </p>
          <p> The critical part of the sample code is the idioms that programmatically set all the state necessary to publish a SOAP STS instance. </p>
         </div>
        </div>
       </div>
      </div>
      <div class="section" id="sts-consume">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">7.2.&nbsp;Consuming STS Instances</h2>
         </div>
        </div>
       </div>
       <p> Once REST and SOAP STS instance endpoints have been exposed, they are available for use to consumers as follows: </p>
       <div class="itemizedlist">
        <ul class="itemizedlist" style="list-style-type: disc; ">
         <li class="listitem"><p> Developers access REST STS instances by making REST API calls that support token transformations. </p></li>
         <li class="listitem"><p> Developers access SOAP STS instances by sending SOAP messages or by using the SOAP STS client SDK. OpenAM's SOAP STS is <a class="link" href="http://docs.oasis-open.org/ws-sx/ws-trust/v1.4/ws-trust.html" target="_blank">WS-Trust 1.4</a> compliant. </p></li>
        </ul>
       </div>
       <div class="section" id="sts-consume-rest">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">7.2.1.&nbsp;Consuming REST STS Instances</h3>
          </div>
         </div>
        </div>
        <p> You consume a REST STS instance by sending REST API calls to the instance's endpoint. </p>
        <div class="section" id="sts-consume-rest-endpoint">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">7.2.1.1.&nbsp;REST STS Instance Endpoint</h4>
           </div>
          </div>
         </div>
         <p> REST STS instances' endpoints comprise the following parts: </p>
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p> The OpenAM context </p></li>
           <li class="listitem"><p> The string <code class="literal">rest-sts</code> </p></li>
           <li class="listitem"><p> The realm in which the REST STS instance is configured </p></li>
           <li class="listitem"><p> The deployment URL element, which is one of the configuration properties of an STS instance </p></li>
          </ul>
         </div>
         <p> For example, a REST STS instance configured in the realm <code class="literal">myRealm</code> with the deployment URL element <code class="literal">username-transformer</code> exposes the endpoint <code class="literal">/rest-sts/myRealm/username-transformer</code>. </p>
        </div>
        <div class="section" id="sts-consume-json-payload">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">7.2.1.2.&nbsp;JSON Representation of Token Transformations</h4>
           </div>
          </div>
         </div>
         <p> Token transformations are represented in JSON as follows: </p>
         <pre class="cmdline prettyprint nohighlight">{
  "input_token_state": {
    "token_type": "<em><strong class="replaceable">INPUT_TOKEN_TYPE</strong></em>"
    ... <em><strong class="replaceable">INPUT_TOKEN_TYPE_PROPERTIES</strong></em> ...
  },
  "output_token_state": {
    "token_type": "<em><strong class="replaceable">OUTPUT_TOKEN_TYPE</strong></em>"
    ... <em><strong class="replaceable">OUTPUT_TOKEN_TYPE_PROPERTIES</strong></em> ...
  }
}</pre>
         <p> REST STS supports the following token types and properties: </p>
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p> Input token types: </p>
            <div class="itemizedlist">
             <ul class="itemizedlist" style="list-style-type: circle; ">
              <li class="listitem"><p> <code class="literal">USERNAME</code> </p><p> Requires the <code class="literal">username</code> and <code class="literal">password</code> properties. </p></li>
              <li class="listitem"><p> <code class="literal">OPENAM</code> </p><p> Requires the <code class="literal">session_id</code> property, with an SSO token as its value. </p></li>
              <li class="listitem"><p> <code class="literal">X509</code> </p><p> No properties are required, because input X.509 tokens are presented either in HTTP headers or by using TLS. For more information about X.509 tokens, see the configuration details for the Authentication Target Mappings and Client Certificate Header Key properties in <a href="../admin-guide/index.html#sts-configure-rest-properties" class="olink">Section&nbsp;17.6.1, "REST STS Configuration Properties"</a> in the <em>Administration Guide</em>. </p></li>
              <li class="listitem"><p> <code class="literal">OPENIDCONNECT</code> </p><p> Requires the <code class="literal">oidc_id_token</code> property, with the OpenID Connect token as its value. </p></li>
             </ul>
            </div></li>
           <li class="listitem"><p> Output token types: </p>
            <div class="itemizedlist">
             <ul class="itemizedlist" style="list-style-type: circle; ">
              <li class="listitem"><p> <code class="literal">SAML2</code> </p><p> Requires the <code class="literal">subject_confirmation</code> property, the value of which determines the <code class="literal">&lt;saml:ConfirmationMethod&gt;</code> element for the generated SAML v2.0 assertion. Valid values are <code class="literal">BEARER</code>, <code class="literal">SENDER_VOUCHES</code>, and <code class="literal">HOLDER_OF_KEY</code>. </p><p> When generating an assertion with a holder-of-key subject confirmation method, the <code class="literal">proof_token_state</code> property is required. The value for this property is an object that contains the <code class="literal">base64EncodedCertificate</code> property. </p></li>
              <li class="listitem"><p> <code class="literal">OPENIDCONNECT</code> </p><p> Requires the <code class="literal">nonce</code> and <code class="literal">allow_access</code> properties. </p></li>
             </ul>
            </div></li>
          </ul>
         </div>
         <p> The following are examples of JSON payloads that define REST STS token transformations: </p>
         <div class="orderedlist">
          <ol class="orderedlist" type="1">
           <li class="listitem"><p> Transform a username token to a SAML v2.0 token with the bearer subject confirmation method: </p><pre class="cmdline prettyprint nohighlight">{
  "input_token_state": {
    "token_type": "USERNAME",
    "username": "demo",
    "password": "changeit"
  },
  "output_token_state": {
    "token_type": "SAML2",
    "subject_confirmation": "BEARER"
  }
}</pre></li>
           <li class="listitem"><p> Transform an X.509 token to a SAML v2.0 token with the sender vouches subject confirmation method: </p><pre class="cmdline prettyprint nohighlight">{
  "input_token_state": {
    "token_type": "X509"
  },
  "output_token_state": {
    "token_type": "SAML2",
    "subject_confirmation": "SENDER_VOUCHES"
  }
}</pre></li>
           <li class="listitem"><p> Transform an OpenID Connect token to a SAML v2.0 token with the holder-of-key subject confirmation method: </p><pre class="cmdline prettyprint nohighlight">{
  "input_token_state": {
    "token_type": "OPENIDCONNECT",
    "oidc_id_token": "eyAiYWxQ.euTNnNDExNTkyMjEyIH0.kuNlKwyvZJqaC8EYpDyPJMiEcII"
  },
  "output_token_state": {
    "token_type": "SAML2",
    "subject_confirmation": "HOLDER_OF_KEY",
    "proof_token_state": {
      "base64EncodedCertificate": "MIMbFAAOBjQAwgYkCgYEArSQ...c/U75GB2AtKhbGS5pimrW0Y0Q=="
     }
  }
}</pre></li>
           <li class="listitem"><p> Transform an OpenAM SSO token to an OpenID Connect token: </p><pre class="cmdline prettyprint nohighlight">{
  "input_token_state": {
    "token_type": "OPENAM",
    "session_id": "AQIC5wM2...TMQAA*"
  },
  "output_token_state": {
    "token_type": "OPENIDCONNECT",
    "nonce": "471564333",
    "allow_access": true
  }
}</pre></li>
          </ol>
         </div>
         <p> For more examples of JSON payloads that you can send to REST STS instances, see the comments in the sample code in <a class="xref" href="#sts-consume-rest-programmatic" title="7.2.1.4.&nbsp;Java Example">Section&nbsp;7.2.1.4, "Java Example"</a>. </p>
        </div>
        <div class="section" id="sts-consume-rest-cli">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">7.2.1.3.&nbsp;Command-Line Example</h4>
           </div>
          </div>
         </div>
         <p> You can use the <span class="command"><strong>curl</strong></span> command to quickly verify that a published REST STS instance operates as expected. </p>
         <p> For example, if you publish a REST instance with a deployment URL element <code class="literal">usernmame-transformer</code> that supports username to SAML v2.0 bearer assertion token transformation, you can perform an HTTP POST to the <code class="literal">/rest-sts/username-transformer</code> endpoint, setting the <code class="literal">_action</code> parameter to <code class="literal">translate</code> as follows: </p>
         <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "iPlanetDirectoryPro: AQIC5..." \
 --header "Content-Type: application/json" \
 --data '{
    "input_token_state": {
        "token_type": "USERNAME",
        "username": "demo",
        "password": "changeit"
    },
    "output_token_state": {
        "token_type": "SAML2",
        "subject_confirmation": "BEARER"
    }
 }' \
 https://openam.example.com:8443/openam/rest-sts/username-transformer?_action=translate</strong>
<em class="computeroutput">{
  "issued_token":
     "&lt;saml:Assertion
       xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\"
       Version=\"2.0\"
       ID=\"s2c51ebd0ad10aae44fb76e4b400164497c63b4ce6\"
       IssueInstant=\"2016-03-02T00:14:47Z\"&gt;\n
       &lt;saml:Issuer&gt;saml2-issuer&lt;/saml:Issuer&gt;
       &lt;saml:Subject&gt;\n
        &lt;saml:NameID
         Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress\"&gt;demo
        &lt;/saml:NameID&gt;
        &lt;saml:SubjectConfirmation
         Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"&gt;\n
         &lt;saml:SubjectConfirmationData
          NotOnOrAfter=\"2016-03-02T00:24:47Z\" &gt;
         &lt;/saml:SubjectConfirmationData&gt;
        &lt;/saml:SubjectConfirmation&gt;\n
       &lt;/saml:Subject&gt;
       &lt;saml:Conditions
        NotBefore=\"2016-03-02T00:14:47Z\"
        NotOnOrAfter=\"2016-03-02T00:24:47Z\"&gt;\n
        &lt;saml:AudienceRestriction&gt;\n
         &lt;saml:Audience&gt;saml2-issuer-entity&lt;/saml:Audience&gt;\n
        &lt;/saml:AudienceRestriction&gt;\n&lt;/saml:Conditions&gt;\n
        &lt;saml:AuthnStatement
         AuthnInstant=\"2016-03-02T00:14:47Z\"&gt;
         &lt;saml:AuthnContext&gt;
          &lt;saml:AuthnContextClassRef&gt;
           urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport
          &lt;/saml:AuthnContextClassRef&gt;
         &lt;/saml:AuthnContext&gt;
        &lt;/saml:AuthnStatement&gt;
       &lt;/saml:Assertion&gt;\n"
}</em></pre>
         <p> The <code class="literal">iPlanetDirectoryPro</code> header is required and should contain the SSO token of an administrator user with access to perform the operation. </p>
        </div>
        <div class="section" id="sts-consume-rest-programmatic">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">7.2.1.4.&nbsp;Java Example</h4>
           </div>
          </div>
         </div>
         <p> The <a class="link" href="https://raw.githubusercontent.com/ForgeRock/openam-sts-example-code/13/RestSTSConsumer.java" target="_blank"><code class="filename">RestSTSConsumer.java</code>sample code</a> provides an example of how to consume a published REST STS instance programmatically. Tailor this example as required to provide programmatic consumption of your own REST STS instances. </p>
         <div class="panel panel-primary">
          <div class="panel-heading">
           <h3 class="panel-title">Important</h3>
          </div>
          <div class="panel-body">
           <p> The sample code referenced in this section is <span class="emphasis"><em>not</em></span> compilable, because it uses classes that are not available publicly. The code provides patterns to developers familiar with the problem domain and is intended only to assist developers who want to programmatically consume REST STS instances. </p>
          </div>
         </div>
        </div>
       </div>
       <div class="section" id="sts-consume-soap">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">7.2.2.&nbsp;Consuming SOAP STS Instances</h3>
          </div>
         </div>
        </div>
        <p> You consume a SOAP STS instance by sending it SOAP messages to the instance's endpoint, or by calling it using the OpenAM SOAP STS client SDK. </p>
        <div class="section" id="sts-consume-soap-endpoint">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">7.2.2.1.&nbsp;SOAP STS Instance URL</h4>
           </div>
          </div>
         </div>
         <p> SOAP STS instances' URLs comprise the following parts: </p>
         <div class="itemizedlist">
          <ul class="itemizedlist" style="list-style-type: disc; ">
           <li class="listitem"><p> The SOAP STS deployment context </p></li>
           <li class="listitem"><p> The string <code class="literal">sts</code> </p></li>
           <li class="listitem"><p> The realm in which the REST STS instance is configured </p></li>
           <li class="listitem"><p> The deployment URL element, which is one of the configuration properties of an STS instance </p></li>
          </ul>
         </div>
         <p> The SOAP STS deployment context comprises the base URL of the web container to which the SOAP STS <code class="literal">.war</code> file is deployed and the deployment web application name. For more information about SOAP STS deployments, see <a href="../admin-guide/index.html#sts-deploy-soap-sts-deploy-war" class="olink">Section&nbsp;17.7.6, "Deploying the SOAP STS Instance to a Web Container"</a> in the <em>Administration Guide</em>. </p>
         <p> For example, a SOAP STS instance configured in the realm <code class="literal">myRealm</code> with the deployment URL element <code class="literal">soap-username-transformer</code> and the a deployment web application name <code class="literal">openam-soap-sts</code> would expose a URL similar to <code class="literal">https://soap-sts-host.com:8443/openam-soap-sts/sts/myRealm/soap-username-transformer</code>. </p>
         <p> The WSDL for the service would be available at <code class="literal">https://soap-sts-host.com:8443/openam-soap-sts/sts/myRealm/soap-username-transformer?wsdl</code>. </p>
        </div>
        <div class="section" id="sts-consume-soap-messages">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">7.2.2.2.&nbsp;Consuming SOAP STS Instances Using SOAP Messages</h4>
           </div>
          </div>
         </div>
         <p> Because an OpenAM SOAP STS instance is a WS-Trust 1.4-compliant security token service, users can consume the instance by sending it standard WS-Trust 1.4 SOAP STS framework messages, such as <code class="literal">RequestSecurityToken</code> messages, passed as the payload to WSDL ports that are implemented by the security token services. </p>
         <p> For more information about WS-Trust 1.4 security token services, see the <a class="link" href="http://docs.oasis-open.org/ws-sx/ws-trust/v1.4/ws-trust.html" target="_blank">WS-Trust 1.4 specification</a>. </p>
        </div>
        <div class="section" id="sts-consume-soap-client-sdk">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">7.2.2.3.&nbsp;Consuming SOAP STS Instances Using the OpenAM SOAP STS Client SDK</h4>
           </div>
          </div>
         </div>
         <p> You can consume an OpenAM SOAP STS instance by calling it using the OpenAM SOAP STS client SDK. </p>
         <div class="section" id="sts-consume-soap-client-sdk-about">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">7.2.2.3.1.&nbsp;About the SOAP STS Client SDK</h5>
            </div>
           </div>
          </div>
          <p> The SOAP STS client SDK is based on classes in <a class="link" href="http://cxf.apache.org" target="_blank">Apache CXF</a>, an open source service framework. Apache CXF provides the <a class="link" href="http://cxf.apache.org/javadoc/latest" target="_blank"><code class="literal">org.apache.cxf.ws.security.trust.STSClient</code></a> class, which encapsulates consumption of a SOAP STS service. However, using this class requires considerable expertise. </p>
          <p> The SOAP STS client SDK makes it easier to consume OpenAM SOAP STS instances than using Apache CXF for the following reasons: </p>
          <div class="itemizedlist">
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p> The <code class="literal">org.forgerock.openam.sts.soap.SoapSTSConsumer</code> class in the OpenAM SOAP STS client SDK wraps the Apache CXF class <code class="literal">org.apache.cxf.ws.security.trust.STSClient</code>, providing a higher level of abstraction that makes consumption of SOAP STS instances easier to achieve. </p></li>
            <li class="listitem"><p> The <code class="literal">SoapSTSConsumer</code> class' <code class="literal">issueToken</code>, <code class="literal">validateToken</code>, and <code class="literal">cancelToken</code> methods provide the three fundamental operations exposed by SOAP STS instances. Supporting classes facilitate the creation of state necessary to invoke these methods. </p></li>
            <li class="listitem"><p> Classes in the SDK provide logic to allow OpenAM session tokens to be presented in order to satisfy the security policy bindings that mandate OpenAM sessions as supporting tokens. The STS client obtains secret password state—keystore entry passwords and aliases, username token credential information, and so forth—from a callback handler. The <code class="literal">SoapSTSConsumerCallbackHandler</code> class provides the means to create a callback handler initialized with state that will be encountered when consuming SOAP STS instances. The <code class="literal">SoapSTSConsumerCallbackHandler</code> instance can be passed to an STS client. The <code class="literal">TokenSpecification</code> class provides a way to create the varying token state necessary to obtain specific tokens and create any necessary supporting state. </p></li>
           </ul>
          </div>
          <p> You can use the classes in the SOAP STS client SDK as is, or you can tailor them to your needs. For more information about the SOAP STS client SDK classes, see the source code and the Javadoc. </p>
         </div>
         <div class="section" id="sts-consume-soap-client-sdk-build">
          <div class="titlepage">
           <div>
            <div>
             <h5 class="title">7.2.2.3.2.&nbsp;Building a SOAP STS Client SDK .jar File</h5>
            </div>
           </div>
          </div>
          <p> The SOAP STS client SDK is not part of the OpenAM client SDK. <a href="#ftn.d14232e20456" class="footnote"><sup class="footnote" id="d14232e20456">[2]</sup></a> To use the SOAP STS client SDK, you must compile the source code for the SOAP STS client SDK and create a <code class="literal">.jar</code> file. </p>
          <div class="procedure" id="sts-consume-soap-client-sdk-build-procedure">
           <div class="procedure-inner">
            <div class="procedure-title">
             Procedure&nbsp;7.1.&nbsp;To Build the SOAP STS Client SDK
            </div>
            <ol class="procedure" type="1">
             <li class="step"><p> Download the OpenAM source code. </p></li>
             <li class="step"><p> Change to the <code class="filename">openam-sts/openam-soap-sts</code> directory. </p></li>
             <li class="step"><p> Run the <code class="literal">mvn install</code> command. </p></li>
             <li class="step"><p> Locate the <code class="filename">openam-soap-sts-client-13.jar</code> file in the <code class="filename">openam-sts/openam-soap-sts/openam-soap-sts-client/target</code> directory. </p></li>
            </ol>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
      <div class="section" id="sts-query-validate-cancel">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">7.3.&nbsp;Querying, Validating, and Canceling Tokens</h2>
         </div>
        </div>
       </div>
       <p> Both REST and SOAP STS instances support <em class="firstterm">token persistence</em>, which is the ability to store tokens issued for the STS instance in the Core Token Service (CTS). You enable token persistence for both REST and SOAP STS instances' configuration under Realms &gt; <em class="replaceable">Realm Name</em> &gt; STS &gt; <em class="replaceable">STS Instance Name</em> &gt; General Configuration &gt; Persist Issued Tokens in Core Token Store. Tokens are saved in the CTS for the duration of the token lifetime, which is a configuration property for STS-issued SAML v2.0 and OpenID Connect tokens. Tokens with expired durations are periodically removed from the CTS. </p>
       <p> With token persistence enabled for an STS instance, OpenAM provides the ability to query, validate, and cancel tokens issued for the instance: </p>
       <div class="itemizedlist">
        <ul class="itemizedlist" style="list-style-type: disc; ">
         <li class="listitem"><p> <em class="firstterm">Querying tokens</em> means listing tokens issued for an STS instance or for a user. </p></li>
         <li class="listitem"><p> <em class="firstterm">Validating a token</em> means verifying that the token is still present in the CTS. </p></li>
         <li class="listitem"><p> <em class="firstterm">Cancelling a token</em> means removing the token from the CTS. </p></li>
        </ul>
       </div>
       <div class="section" id="sts-query-validate-cancel-sts-tokengen">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">7.3.1.&nbsp;Invoking the sts-tokengen Endpoint</h3>
          </div>
         </div>
        </div>
        <p> The <code class="literal">sts-tokengen</code> endpoint provides administrators with the ability to query and cancel tokens issued <span class="emphasis"><em>for both REST and SOAP STS instances</em></span> using REST API calls. </p>
        <p> When using the <code class="literal">sts-tokengen</code> endpoint, be sure to provide the token ID for an OpenAM administrator, such as <code class="literal">amadmin</code>, as the value of a header whose name is the name of the SSO token cookie, by default <code class="literal">iPlanetDirectoryPro</code>. </p>
        <div class="section" id="sts-query-validate-cancel-sts-tokengen-query">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">7.3.1.1.&nbsp;Querying Tokens</h4>
           </div>
          </div>
         </div>
         <p> List tokens issued for an STS instance by using the <code class="literal">queryFilter</code> action in an HTTP GET call to the <code class="literal">sts-tokengen</code> endpoint with the <code class="literal">/sts-id</code> argument. </p>
         <p> The following example lists all the tokens issued for the <code class="literal">username-transformer</code> STS instance. The results show that OpenAM has issued two OpenID Connect tokens for the <code class="literal">demo</code> user for the <code class="literal">username-transformer</code> STS instance: </p>
         <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request GET \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/sts-tokengen?_queryFilter=\/sts_id+eq+\'username-transformer'\</strong>
<em class="computeroutput">{
  "result":[
    {
      "_id":"B663D248CE4C3B63A7422000B03B8F5E0F8E443B",
      "_rev":"",
      "token_id":"B663D248CE4C3B63A7422000B03B8F5E0F8E443B",
      "sts_id":"username-transformer",
      "principal_name":"demo",
      "token_type":"OPENIDCONNECT",
      "expiration_time":1459376096
    },
    {
      "_id":"7CB70009970D1AAFF177AC2A08D58405EDC35DF5",
      "_rev":"",
      "token_id":"7CB70009970D1AAFF177AC2A08D58405EDC35DF5",
      "sts_id":"username-transformer",
      "principal_name":"demo",
      "token_type":"OPENIDCONNECT",
      "expiration_time":1459376098
   }
 ],
 "resultCount":2,
 "pagedResultsCookie":null,
 "totalPagedResultsPolicy":"NONE",
 "totalPagedResults":-1,
 "remainingPagedResults":-1
}</em></pre>
         <p> List tokens issued for a particular user with the <code class="literal">queryFilter</code> action in an HTTP GET call to the <code class="literal">sts-tokengen</code> endpoint with the <code class="literal">/token-principal</code> argument. </p>
         <p> The following example lists all the tokens issued for the <code class="literal">demo</code> user. The results show that OpenAM has issued two OpenID Connect tokens: </p>
         <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request GET \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/sts-tokengen?_queryFilter=\/token_principal+eq+\'demo'\</strong>
<em class="computeroutput">{
  "result":[
    {
      "_id":"B663D248CE4C3B63A7422000B03B8F5E0F8E443B",
      "_rev":"",
      "token_id":"B663D248CE4C3B63A7422000B03B8F5E0F8E443B",
      "sts_id":"username-transformer",
      "principal_name":"demo",
      "token_type":"OPENIDCONNECT",
      "expiration_time":1459376096
    },
    {
      "_id":"7CB70009970D1AAFF177AC2A08D58405EDC35DF5",
      "_rev":"",
      "token_id":"7CB70009970D1AAFF177AC2A08D58405EDC35DF5",
      "sts_id":"username-transformer",
      "principal_name":"demo",
      "token_type":"OPENIDCONNECT",
      "expiration_time":1459376098
   }
 ],
 "resultCount":2,
 "pagedResultsCookie":null,
 "totalPagedResultsPolicy":"NONE",
 "totalPagedResults":-1,
 "remainingPagedResults":-1
}</em></pre>
        </div>
        <div class="section" id="sts-query-validate-cancel-sts-tokengen-cancel">
         <div class="titlepage">
          <div>
           <div>
            <h4 class="title">7.3.1.2.&nbsp;Cancelling Tokens</h4>
           </div>
          </div>
         </div>
         <p> Cancel tokens by making an HTTP DELETE call to the <code class="literal">sts-tokengen</code>/<em class="replaceable">token_id</em> endpoint: </p>
         <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request DELETE \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/sts-tokengen/B663D248CE4C3B63A7422000B03B8F5E0F8E443B</strong>
<em class="computeroutput">{
 "_id":"B663D248CE4C3B63A7422000B03B8F5E0F8E443B",
 "_rev":"B663D248CE4C3B63A7422000B03B8F5E0F8E443B",
 "result":"token with id B663D248CE4C3B63A7422000B03B8F5E0F8E443B successfully removed."
}</em></pre>
        </div>
       </div>
       <div class="section" id="query-validate-cancel-rest-sts-instance">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">7.3.2.&nbsp;Validating and Cancelling Tokens by Invoking a REST STS Instance</h3>
          </div>
         </div>
        </div>
        <p> REST STS users can validate and cancel tokens by making an HTTP POST call to a REST STS instance's endpoint. </p>
        <p> To validate a token, use the <code class="literal">validate</code> action. The following example validates an OpenID Connect token previously issued by the <code class="literal">username-transformer</code> REST STS instance: </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "iPlanetDirectoryPro: AQIC5..." \
 --header "Content-Type: application/json" \
 --data '{
    "validated_token_state": {
        "token_type": "OPENIDCONNECT",
        "oidc_id_token": "eyAidHlwIjogIkpXVCIsIC..."
    }
 }' \
 https://openam.example.com:8443/openam/rest-sts/username-transformer?_action=validate</strong>
<em class="computeroutput">{
 "token_valid":true
}</em></pre>
        <p> To cancel a token, use the <code class="literal">cancel</code> action. The following example cancels an OpenID Connect token previously issued by the <code class="literal">username-transformer</code> REST STS instance: </p>
        <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "iPlanetDirectoryPro: AQIC5..." \
 --header "Content-Type: application/json" \
 --data '{
    "cancelled_token_state": {
        "token_type": "OPENIDCONNECT",
        "oidc_id_token": "eyAidHlwIjogIkpXVCIsIC..."
    }
 }' \
 https://openam.example.com:8443/openam/rest-sts/username-transformer?_action=cancel</strong>
<em class="computeroutput">{
 "result":"OPENIDCONNECT token cancelled successfully."
}</em></pre>
       </div>
       <div class="section" id="query-validate-cancel-soap-sts-instance">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">7.3.3.&nbsp;Validating and Cancelling Tokens by Invoking a SOAP STS Instance</h3>
          </div>
         </div>
        </div>
        <p> The source code for the <code class="literal">validateToken</code> and <code class="literal">cancelToken</code> methods in the <code class="literal">org.forgerock.openam.sts.soap.SoapSTSConsumer</code> class provides information needed to construct WS-Trust 1.4-compliant calls for validating and cancelling tokens. </p>
        <p> Locate the <code class="literal">org.forgerock.openam.sts.soap.SoapSTSConsumer</code> class under <code class="literal">openam-sts/openam-soap-sts/openam-soap-sts-client</code> in the OpenAM source code. </p>
       </div>
      </div>
      <div class="section" id="sts-custom-token-types">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">7.4.&nbsp;Extending STS to Support Custom Token Types</h2>
         </div>
        </div>
       </div>
       <p> OpenAM supports token transformations to and from a variety of token types, including username, SAML v2.0, OpenID Connect, and X.509. In addition to these supported token types, REST STS instances can use custom token types as the input or output token, or both, in a token transformation. When you configure a REST STS instance to support a token transformation that takes a custom token type, you can also configure a custom validator and provider class for the custom token type. OpenAM uses custom validator classes to validate custom tokens and custom provider classes to produce custom tokens. </p>
       <p> Specify custom token validator and provider classes in the OpenAM console by configuring the Custom Token Validators and Custom Token Providers properties under Realms &gt; <em class="replaceable">Realm Name</em> &gt; STS &gt; <em class="replaceable">REST STS Instance Name</em>. </p>
       <p> A custom validator class can be used in transformations that produce standard STS output tokens, such as SAML v2.0 tokens or OpenID Connect tokens, and in transformations that produce custom output token types. </p>
       <p> A custom provider class can be used in token transformations that take standard STS input tokens, such as username tokens or OpenAM SSO tokens, and in transformations that take custom input token types. </p>
       <p> Before a REST STS instance can use a custom token type validator or provider class, you must bundle the class into the OpenAM <code class="literal">.war</code> file and restart OpenAM. </p>
       <p> OpenAM invokes a single instance of a validator or provider class to run all concurrently dispatched token transformations that use the custom token type. Because there is only a single instance of the class, you must code custom validator and provider classes to be thread-safe. </p>
       <div class="section" id="sts-consume-rest-custom-validator">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">7.4.1.&nbsp;Developing Custom Token Type Validator Classes</h3>
          </div>
         </div>
        </div>
        <p> To create a custom token type validator class, implement the <code class="literal">org.forgerock.openam.sts.rest.token.validator.RestTokenTransformValidator</code> class. </p>
        <p> Custom token type validator classes implement the <code class="literal">validateToken</code> method. This method takes a <code class="literal">RestTokenValidatorParameters</code> object as input. Note that the generic type of <code class="literal">RestTokenValidatorParameters</code> is <code class="literal">org.forgerock.json.fluent.JsonValue</code>. As a result of using this type, custom validator classes can access the JSON representation of the input token passed to the REST STS instance in the <code class="literal">input_token_state</code> JSON key. </p>
        <p> The <code class="literal">validateToken</code> method returns an <code class="literal">org.forgerock.openam.sts.rest.token.validator.RestTokenTransformValidatorResult</code> object. At a minimum, this object contains the OpenAM SSO token corresponding to the validated principal. It can also contain additional information specified as a JSON value, allowing a custom validator to pass extra state to a custom provider in a token transformation. </p>
       </div>
       <div class="section" id="sts-consume-rest-custom-provider">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">7.4.2.&nbsp;Developing Custom Token Type Provider Classes</h3>
          </div>
         </div>
        </div>
        <p> To create a custom token type provider class, implement the <code class="literal">org.forgerock.openam.sts.rest.token.provider.RestTokenProvider</code> class. </p>
        <p> Custom token type provider classes implement the <code class="literal">createToken</code> method. This method takes an <code class="literal">org.forgerock.openam.sts.rest.token.provider.CustomRestTokenProviderParameters</code> object as input. This object gives the custom provider access to the following information: </p>
        <div class="itemizedlist">
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p> The principal returned by the <code class="literal">RestTokenTransformValidator</code> </p></li>
          <li class="listitem"><p> The OpenAM SSO token corresponding to the validated principal </p></li>
          <li class="listitem"><p> Any additional state returned in the <code class="literal">RestTokenValidatorResult</code> object </p></li>
          <li class="listitem"><p> The type of input token validated by the <code class="literal">RestTokenTransformValidator</code> in the token transformation </p></li>
          <li class="listitem"><p> The <code class="literal">JsonValue</code> corresponding to this validated token, as specified by the <code class="literal">input_token_state</code> object in the transformation request </p></li>
          <li class="listitem"><p> The <code class="literal">JsonValue</code> corresponding to the <code class="literal">token_output_state</code> object specified in the token transformation request (which can provide additional information pertinent to the creation of the output token) </p></li>
         </ul>
        </div>
        <p> The <code class="literal">createToken</code> method returns a string representation of the custom token in a format that can be transmitted across HTTP in JSON. It should be base64-encoded if binary. </p>
       </div>
       <div class="section" id="sts-consume-rest-custom-using">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">7.4.3.&nbsp;Using Custom Token Type Validators and Providers</h3>
          </div>
         </div>
        </div>
        <p> This section provides an example of how to use custom token type validators and providers. </p>
        <p> The example assumes that you already configured a token transformation by completing the following tasks: </p>
        <div class="itemizedlist">
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p> Implementing the <code class="literal">RestTokenTransformValidator</code> interface to create a custom token type validator </p></li>
          <li class="listitem"><p> Implementing the <code class="literal">RestTokenProvider</code> interface to create a custom token type provider </p></li>
          <li class="listitem"><p> Bundling the two classes into the OpenAM <code class="literal">.war</code> file </p></li>
          <li class="listitem"><p> Restarting OpenAM </p></li>
          <li class="listitem"><p> Publishing a REST STS instance with a custom token type named <code class="literal">CUSTOM</code>, specifying the custom validator and provider classes in the instance's configuration </p></li>
         </ul>
        </div>
        <p> To transform a <code class="literal">CUSTOM</code> token to an OpenID Connect token, you might specify a JSON payload similar to the following: </p>
        <pre class="codelisting prettyprint javascript">
{
    "input_token_state":
        {
            "token_type": "CUSTOM",
            "extra_stuff": "very_useful_state"
        },
    "output_token_state":
        {
            "token_type": "OPENIDCONNECT",
            "nonce": "1234",
            "allow_access": true
        }
}
   </pre>
        <p> With the preceding JSON payload, OpenAM passes a <code class="literal">JsonValue</code> instance to the <code class="literal">validateToken</code> method of the custom token type validator class as follows: </p>
        <pre class="codelisting prettyprint javascript">
{
    "token_type": "CUSTOM",
    "extra_stuff": "very_useful_state"
}
   </pre>
        <p> To transform a username token to a <code class="literal">CUSTOM</code> token, you might specify a JSON payload similar to the following: </p>
        <pre class="codelisting prettyprint javascript">
{
    "input_token_state":
        {
            "token_type": "USERNAME",
            "username": "unt_user17458687",
            "password": "password"
        },
    "output_token_state":
        {
            "token_type": "CUSTOM",
            "extra_stuff_for_custom": "some_useful_information"
        }
}
   </pre>
        <p> With the preceding JSON payload, OpenAM passes the following information to the <code class="literal">createToken</code> method of the custom token type provider: </p>
        <div class="itemizedlist">
         <ul class="itemizedlist" style="list-style-type: disc; ">
          <li class="listitem"><p> The principal returned by the <code class="literal">USERNAME</code> token validator: <code class="literal">unt_user17458687</code>. </p></li>
          <li class="listitem"><p> The OpenAM SSO token corresponding to this authenticated principal. </p></li>
          <li class="listitem"><p> Additional state returned by the token validator, if any. Because the <code class="literal">USERNAME</code> token validator does not return any additional state, the additional state for this example would be null. </p></li>
          <li class="listitem"><p> The input token type: <code class="literal">CUSTOM</code> </p></li>
          <li class="listitem"><p> A <code class="literal">JsonValue</code> representation of the following: </p><pre class="codelisting prettyprint javascript">
{
    "token_type": "USERNAME",
    "username": "unt_user17458687",
    "password": "password"
}
</pre><p> </p></li>
          <li class="listitem"><p> A <code class="literal">JsonValue</code> representation of the following: </p><pre class="codelisting prettyprint javascript">
{
    "token_type": "CUSTOM",
    "extra_stuff_for_custom": "some_useful_information"
}
</pre><p> </p></li>
         </ul>
        </div>
        <p> To transform a <code class="literal">CUSTOM</code> token to a <code class="literal">CUSTOM</code> token, you might specify a JSON payload similar to the following: </p>
        <pre class="codelisting prettyprint javascript">
{
    "input_token_state":
        {
            "token_type": "CUSTOM",
            "extra_stuff": "very_useful_state"
        },
    "output_token_state":
        {
            "token_type": "CUSTOM",
            "extra_stuff_for_custom": "some_useful_information"
        }
}
   </pre>
        <p> The input to the custom validator and provider would be similar to the preceding examples, with the possible addition of any additional state that the custom validator returned from the <code class="literal">validateToken</code> method. </p>
       </div>
      </div>
      <div class="footnotes">
       <br>
       <hr class="footnote-hr">
       <div id="ftn.d14232e20456" class="footnote">
        <p><a href="#d14232e20456" class="para"><sup class="para">[2] </sup></a> The SOAP STS client SDK has a dependency on Apache CXF classes, which is not present in the OpenAM client SDK. Therefore, the two SDKs are not bundled together. </p>
       </div>
      </div>
     </div>
     <div lang="" class="chapter" id="chap-sae">
      <div class="titlepage">
       <div>
        <div>
         <h1 class="title">Chapter&nbsp;8.&nbsp;Using Secure Attribute Exchange</h1>
        </div>
       </div>
      </div>
      <a class="indexterm" name="d14232e20930"></a>
      <p> Most deployments can rely on OpenAM to handle authentication and provide identity assertions. OpenAM supports a wide variety of authentication scenarios out of the box, but OpenAM also makes it possible to add custom authentication modules. Furthermore, OpenIG lets you integrate legacy systems into your access management deployment. </p>
      <p> In a deployment where you need OpenAM to act as a SAML v2.0 gateway to a legacy application that serves as an identity provider, you can use OpenAM Secure Attribute Exchange (SAE). On the identity provider side, SAE lets OpenAM retrieve the information needed to create assertions from an external authentication service, bypassing OpenAM authentication and trusting the external service as the authoritative source of authentication. On the service provider side, SAE lets OpenAM securely provide attributes to an application that makes its own policy decision based on the attributes rather than rely on OpenAM for the policy decision. </p>
      <div class="mediaobject" align="center" id="figure-sae">
       <a class="fancybox" href="images/sae.png"><img class="img-responsive center-block" data-toggle="tooltip" src="images/thumb_sae.png" align="middle" alt="External applications use SAE to participate in federation." title="External applications use SAE to communicate with OpenAM providers.
   The providers in turn use SAML v2.0 to communicate with other
   providers."></a>
      </div>
      <p> When you use SAE on the identity provider side, an external application acts as the authoritative source of authentication. After a user authenticates successfully, the application tells OpenAM to create a session by sending a secure HTTP GET or POST to OpenAM that asserts the identity of the user. OpenAM processes the assertion to create a session for the user. If the user is already authenticated and comes back to access the application, the application sends a secure HTTP POST to OpenAM to assert both the user's identity and also any necessary attributes related to the user. OpenAM processes the assertion to create the session for the user and populate the attributes in the user's session. When the user logs out, the external authentication application can initiate single logout from the identity provider OpenAM server by sending the <code class="literal">sun.cmd=logout</code> attribute to OpenAM using SAE. </p>
      <p> On the service provider side, OpenAM communicates using SAML v2.0 with OpenAM on the identity provider side. OpenAM can use SAE to transmit attributes to an application through a secure HTTP POST. </p>
      <p> SAE relies either on shared keys and symmetric encryption, or on public and private keys and asymmetric encryption to protect attributes communicated between OpenAM and external applications. </p>
      <p> OpenAM ships with sample JSPs that demonstrate secure attribute exchange. To try the sample, you must set up an OpenAM Circle of Trust to include an identity provider and a service provider, install the SDK sample web application on each provider, and then configure the providers appropriately as described in this chapter to secure communications with the sample SAE applications on both the identity provider and service provider sides. </p>
      <div class="section" id="sae-install-prerequisites">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">8.1.&nbsp;Installing the Samples</h2>
         </div>
        </div>
       </div>
       <p>Set up an OpenAM server as an identity provider, and another as a service provider, connecting the two in a circle of trust called <code class="literal">samplesaml2cot</code>. Configure both the hosted providers and also the remote providers as described in <a href="../admin-guide/index.html#saml2-providers-and-cots" class="olink">Section&nbsp;12.4, "Configuring Identity Providers, Service Providers, and Circles of Trust"</a> in the <em>Administration Guide</em>. This chapter assumes you set up the hosted identity provider at <code class="literal">http://idp.example.com:8080/openam</code> and the hosted service provider at <code class="literal">http://sp.example.com:8080/openam</code>. Use Realms &gt; <em class="replaceable">Realm Name</em> &gt; Test Federation Connectivity in the OpenAM console to make sure Federation is working before you add secure attribute exchange applications that rely on functioning SAML v2.0 communications between the providers.</p>
       <p>Set up the sample web application as described in <a class="xref" href="#install-sdk-samples" title="2.2.1.&nbsp;Installing OpenAM Client SDK Samples">Section&nbsp;2.2.1, "Installing OpenAM Client SDK Samples"</a>, both on the identity provider side and also on the service provider side. The SAE samples are found under <code class="filename">/saml2/sae</code> where you installed the samples. <code class="filename">saeIDPApp.jsp</code> is the identity provider side external application. <code class="filename">saeSPApp.jsp</code> is the service provider side external application.</p>
      </div>
      <div class="section" id="sae-security-prerequisites">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">8.2.&nbsp;Preparing to Secure SAE Communications</h2>
         </div>
        </div>
       </div>
       <p>In order for SAE to be secure, you must both set up a trust relationship between the application on the identity provider side and the OpenAM server acting as identity provider, and sets up a trust relationship between the application on the service provider side and the OpenAM server acting as the service provider. These trust relationships can be based on a shared secret and symmetric encryption, or on public and private key pairs and asymmetric encryption. The trust relationships on either side are independent. For example, you can use a shared secret on the identity provider side and certificates on the service provider side if you chose.</p>
       <p>When using symmetric encryption, you must define a shared secret string used both for the application and the provider. The sample uses <code class="literal">secret12</code> as the shared secret. To simplify configuration, the sample uses the same shared secret, and thus symmetric encryption, for both trust relationships.</p>
       <p>When using symmetric encryption, you must also use the encoded version of your shared secret. To get the encoded version of a shared secret string, use the <code class="filename">encode.jsp</code> page on the provider, as in <code class="literal">http://idp.example.com:8080/openam/encode.jsp</code> and <code class="literal">http://sp.example.com:8080/openam/encode.jsp</code>. An encoded version of <code class="literal">secret12</code> looks something like <code class="literal">AQICEcFhDWmb6sVmMuCJuVh43306HVacDte9</code>.</p>
       <p>When using asymmetric encryption, you must obtain a public-private key pair for the application, and store the keys in a keystore on the application side. Also store the public key from OpenAM which is acting as the provider in the application's keystore. Make note of the certificate aliases for your application's private key, and for OpenAM's public key. Also note the path to the keystore for your application, the keystore password, and the private key password.</p>
      </div>
      <div class="section" id="sae-secure-idp">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">8.3.&nbsp;Securing the Identity Provider Side</h2>
         </div>
        </div>
       </div>
       <p>This configuration uses the default sample settings with a shared secret of <code class="literal">secret12</code>, without encryption of the attributes:</p>
       <div class="orderedlist">
        <ol class="orderedlist" type="1">
         <li class="listitem"><p>Log in as <code class="literal">amadmin</code> to the OpenAM server console where you set up the hosted identity provider (IDP).</p></li>
         <li class="listitem"><p>The sample includes a <code class="literal">branch</code> attribute not found in user profiles by default. Therefore, under Realms &gt; <em class="replaceable">Realm Name</em> &gt; Authentication &gt; Settings &gt; User Profile, set User Profile to Ignored, and then save your work.</p></li>
         <li class="listitem">
          <div class="itemizedlist">
           <p>Under Federation &gt; Entity Providers, click the name for the Hosted IDP in order to access the IDP configuration:</p>
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p>Under Assertion Processing &gt; Attribute Mapper, add both <code class="literal">mail=mail</code> and <code class="literal">branch=branch</code> to the attribute map, and then Save your work.</p></li>
            <li class="listitem"><p>Under Advanced &gt; SAE Configuration, make sure the IDP URL reflects an endpoint on the IDP such as <code class="literal">http://idp.example.com:8080/openam/idpsaehandler/metaAlias/idp</code>, and then Save your work.</p></li>
            <li class="listitem"><p>Also under Advanced &gt; SAE Configuration &gt; Application Security Configuration, add the URL value for the kind of encryption you are using, and then Save your work.</p><p>When using the defaults, the value is something like <code class="literal">url=http://idp.example.com:8080/samples/saml2/sae/saeIDPApp.jsp|type=symmetric|secret=<em class="replaceable">encoded-secret</em></code>, where the OpenAM SDK sample web application is deployed on the IDP side with context root <code class="literal">/samples</code> and the <em class="replaceable">encoded-secret</em> is something like <code class="literal">AQICEcFhDWmb6sVmMuCJuVh43306HVacDte9</code>.</p><p>If you use a different mechanism to secure the communications between the SAE application and the provider, read the online help in the console to see how to construct your URL value.</p></li>
           </ul>
          </div></li>
         <li class="listitem">
          <div class="itemizedlist">
           <p>Under Federation &gt; Entity Providers, click the name for the Remote SP in order to access the SP configuration on the IDP side:</p>
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p>Under Assertion Processing &gt; Attribute Mapper, add both <code class="literal">mail=mail</code> and <code class="literal">branch=branch</code> to the attribute map, and then Save your work.</p></li>
            <li class="listitem"><p>Under Advanced &gt; SAE Configuration, make sure the SP URL reflects an endpoint on the SP, such as <code class="literal">http://sp.example.com:8080/openam/spsaehandler/metaAlias/sp</code>, and then Save your work.</p></li>
            <li class="listitem"><p>Also under Advanced &gt; SAE Configuration, add the URL to the sample SAE application as the SP Logout URL, such as <code class="literal">http://sp.example.com:8080/samples/saml2/sae/saeSPApp.jsp</code>, and then Save your work.</p></li>
           </ul>
          </div></li>
        </ol>
       </div>
      </div>
      <div class="section" id="sae-secure-sp">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">8.4.&nbsp;Securing the Service Provider Side</h2>
         </div>
        </div>
       </div>
       <p>This configuration uses the default sample setting of symmetric encryption, with a shared secret of <code class="literal">secret12</code>.</p>
       <div class="orderedlist">
        <p>Login as <code class="literal">amadmin</code> to the OpenAM server console where you set up the hosted service provider (SP):</p>
        <ol class="orderedlist" type="1">
         <li class="listitem"><p>The sample includes a <code class="literal">branch</code> attribute not found in user profiles by default. Therefore, under Realms &gt; <em class="replaceable">Realm Name</em> &gt; Authentication &gt; Settings &gt; User Profile, set User Profile to Ignored, and then Save your work.</p></li>
         <li class="listitem">
          <div class="itemizedlist">
           <p>Under Federation &gt; Entity Providers, click the name for the Hosted SP in order to access the SP configuration:</p>
           <ul class="itemizedlist" style="list-style-type: disc; ">
            <li class="listitem"><p>Under Assertion Processing &gt; Attribute Mapper, add both <code class="literal">mail=mail</code> and <code class="literal">branch=branch</code> to the attribute map, and then Save your work.</p></li>
            <li class="listitem"><p>Also under Assertion Processing &gt; Attribute Mapper &gt; Auto Federation, select Enabled, set the Attribute to <code class="literal">mail</code>, and then Save your work.</p></li>
            <li class="listitem"><p>Under Advanced &gt; SAE Configuration, make sure the SP URL reflects an endpoint on the SP such as <code class="literal">http://sp.example.com:8080/openam/spsaehandler/metaAlias/sp</code>, and then Save your work.</p></li>
            <li class="listitem"><p>Furthermore, under Advanced &gt; SAE Configuration, add the URL to the sample SAE application as the SP Logout URL such as <code class="literal">http://sp.example.com:8080/samples/saml2/sae/saeSPApp.jsp</code>, and then Save your work.</p></li>
            <li class="listitem"><p>Also under Advanced &gt; SAE Configuration &gt; Application Security Configuration, add the URL value for the kind of encryption you are using, and then Save your work.</p><p>When using the defaults, the value is something like <code class="literal">url=http://sp.example.com:8080/samples/saml2/sae/saeSPApp.jsp|type=symmetric|secret=<em class="replaceable">encoded-secret</em></code>, where the OpenAM SDK sample web application is deployed on the IDP side with context root <code class="literal">/samples</code> and the <em class="replaceable">encoded-secret</em> is something like <code class="literal">AQICkX24RbZboAVgr2FG1kWoqRv1zM2a6KEH</code>.</p><p>If you use a different mechanism to secure the communications between the SAE application and the provider, read the online help in the console to see how to construct your URL value.</p></li>
           </ul>
          </div></li>
        </ol>
       </div>
      </div>
      <div class="section" id="sae-trying-it-out">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">8.5.&nbsp;Trying It Out</h2>
         </div>
        </div>
       </div>
       <p>After completing the setup described above, navigate to the IDP side SAE application, for example at <code class="literal">http://idp.example.com:8080/samples/saml2/sae/saeIDPApp.jsp</code>.</p>
       <div class="variablelist">
        <p>Make sure you set at least the "SP App URL" and "SAE URL on IDP end" to fit your configuration. For example if you used the settings above then use the following values:</p>
        <dl class="variablelist">
         <dt>
          <span class="term">SP App URL</span>
         </dt>
         <dd>
          <p><code class="literal">http://sp.example.com:8080/samples/saml2/sae/saeSPApp.jsp</code></p>
         </dd>
         <dt>
          <span class="term">SAE URL on IDP end</span>
         </dt>
         <dd>
          <p><code class="literal">http://idp.example.com:8080/openam/idpsaehandler/metaAlias/idp</code></p>
         </dd>
        </dl>
       </div>
       <p>Check the settings, and then click Generate URL to open the Secure Attributes Exchange IDP APP SAMPLE page.</p>
       <p>Click the <code class="literal">ssourl</code> link in the page to start the exchange.</p>
       <p>The resulting web page shows the attributes exchanged, including the mail and branch values used. The text of that page is something like the following:</p>
       <pre class="codelisting prettyprint none">SAE SP APP SAMPLE

Secure Attrs :
mail            testuser@foo.com
sun.idpentityid http://idp.example.com:8080/openam
sun.spentityid  http://sp.example.com:8080/openam
branch          mainbranch
sun.authlevel   0</pre>
      </div>
     </div>
     <div lang="en" class="appendix" id="appendix-deprecated-apis">
      <div class="titlepage">
       <div>
        <div>
         <h1 class="title">Appendix&nbsp;A.&nbsp;Deprecated REST APIs</h1>
        </div>
       </div>
      </div>
      <p> This appendix provides information about REST APIs deprecated in OpenAM 13. </p>
      <div class="section" id="deprecated-session-apis-auth">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">A.1.&nbsp;Deprecated Session Information APIs</h2>
         </div>
        </div>
       </div>
       <p> Interface Stability: <a href="../admin-guide/index.html#interface-stability" class="olink">Deprecated</a> </p>
       <p> To check the maximum remaining time (in seconds) of a session, perform an HTTP POST to the resource URL, <code class="literal">/json/sessions/</code>, using the <code class="literal">getMaxTime</code> action as shown in the following example: </p>
       <pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 http://openam.example.com:8080/openam/json/sessions/?_action=getMaxTime&amp;tokenId=BXCCq...NX*1*
  </strong>
<em class="computeroutput">{"maxtime":7022}</em>
</pre>
       <p> The <code class="literal">getMaxTime</code> action has been deprecated in favor of <code class="literal">getTimeLeft</code>. For more information, see <a class="xref" href="#rest-api-session-information" title="2.1.1.8.2.&nbsp;Session Information">Section&nbsp;2.1.1.8.2, "Session Information"</a>. </p>
      </div>
      <div class="section" id="deprecated-self-service">
       <div class="titlepage">
        <div>
         <div>
          <h2 class="title" style="clear: both">A.2.&nbsp;Deprecated Self-Service APIs</h2>
         </div>
        </div>
       </div>
       <p> Interface Stability: <a href="../admin-guide/index.html#interface-stability" class="olink">Deprecated</a> </p>
       <p> For information about the new self-service APIs, see <a class="xref" href="#sec-rest-user-services" title="2.1.4.&nbsp;RESTful User Self-Service">Section&nbsp;2.1.4, "RESTful User Self-Service"</a>. </p>
       <div class="section" id="deprecated-rest-api-self-registration">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">A.2.1.&nbsp;Legacy User Self-Registration</h3>
          </div>
         </div>
        </div>
        <p> The OpenAM REST API for users provides an action for self-registration. The feature works by sending an email to the user in response to RESTful HTTP POST requesting registration with an email address. When the user clicks the link received by mail, an application intercepts the HTTP GET, transforms the query string values into an HTTP POST to confirm the operation. OpenAM responds to the application with a JSON object that the application can further use to request creation of the user account to complete the transaction. </p>
        <div class="procedure" id="setup-user-self-registration">
         <div class="procedure-inner">
          <div class="procedure-title">
           Procedure&nbsp;A.1.&nbsp;To Set Up Legacy User Self-Registration
          </div>
          <ol class="procedure" type="1">
           <li class="step"><p>Configure the Email Service.</p><p>You must configure the Email Service to send mail notifications to users who self-register. You can configure these globally in OpenAM console at Configuration &gt; Global &gt; Email Service. </p><p>Alternatively, you can configure them for an individual realm under Realms &gt; <em class="replaceable">Realm Name</em> &gt; Services.</p></li>
           <li class="step"><p>Configure Legacy User Self Service.</p><p> You must enable self-registration in the User Self Service service. You can configure these globally in OpenAM console at Configuration &gt; Global &gt; Legacy User Self Service. On the Legacy User Self Service page, click the <code class="literal">Enabled</code> checkbox next to Legacy Self-Service REST Endpoint, and Self-Registration for Users, and then click Save. </p><p> At this point users can self-register. The starting screen for self-registration is at <code class="literal">/XUI/#register/</code> under the base URL where OpenAM is installed. The default confirmation URI is <code class="literal">/XUI/confirm.html</code>. </p></li>
           <li class="step"><p>Perform an HTTP POST on <code class="literal">/json/users?_action=register</code> with the new user's mail.</p>
            <div class="panel panel-info">
             <div class="panel-heading">
              <h3 class="panel-title">Note</h3>
             </div>
             <div class="panel-body">
              <p>In OpenAM 13, the <code class="literal">/users</code> endpoint was updated to version 3.0. Request API resource version 2.0 in the REST API calls to get the behavior provided in previous versions of OpenAM.</p>
             </div>
            </div><p> To use a subject and message other than those configured in the Email Service, you can optionally set the mail subject and message content by including "subject" and "message" strings in the JSON data. For example, the following POST results in a mail with subject <code class="literal">Confirm registration with OpenAM</code> and content <code class="literal">Follow this link to confirm your registration</code> in addition to the confirmation link. </p><p> Notice that authentication is not required. </p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
--request POST \
--header "Content-Type: application/json" \
--header "Accept-API-Version: protocol=1.0,resource=2.0" \
--data \
'{
    "email": "newuser@example.com",
    "subject": "Confirm registration with OpenAM",
    "message": "Follow this link to confirm your registration"
}' \
https://openam.example.com:8443/openam/json/users?_action=register</strong>
<em class="computeroutput">{}</em></pre><p>On success, the response is an empty JSON object <code class="literal">{}</code> as shown in the example.</p></li>
           <li class="step"><p> The user receives an email message that includes a URL similar to the following example, but all on one line. The user has self-registered in the root realm: </p><pre class="literallayout">https://openam.example.com:8443/openam/XUI/confirm.html?
      confirmationId=f4x0Dh6iZCXtX8nhiSb3xahNxrg%3D
      &amp;email=newuser%40example.com
      &amp;tokenId=yA26LZ6SxFEgNuF86%2FSIXfimGlg%3D
      &amp;realm=/</pre></li>
           <li class="step"><p>Intercept the HTTP GET request to this URL when the user clicks the link.</p><p>Your application must use the confirmation link to construct an HTTP POST to <code class="literal">/json/users?_action=confirm</code> from the query string parameters as shown in the following example:</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
--request POST \
--header "Content-Type: application/json" \
--header "Accept-API-Version: protocol=1.0,resource=2.0" \
--data \
'{
    "email": "newuser@example.com",
    "tokenId": "yA26LZ6SxFEgNuF86/SIXfimGlg=",
    "confirmationId": "f4x0Dh6iZCXtX8nhiSb3xahNxrg="
}' \
https://openam.example.com:8443/openam/json/users?_action=confirm</strong>
<em class="computeroutput">{
    "email": "newuser@example.com",
    "tokenId": "yA26LZ6SxFEgNuF86/SIXfimGlg=",
    "confirmationId": "f4x0Dh6iZCXtX8nhiSb3xahNxrg="
}</em></pre><p>The response is a further confirmation that the account can be created.</p></li>
           <li class="step"><p>Using the confirmation, your application must make an authenticated HTTP POST to <code class="literal">/json/users?_action=anonymousCreate</code> to create the user as shown in the following example:</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
--request POST \
--header "Content-Type: application/json" \
--header "Accept-API-Version: protocol=1.0,resource=2.0" \
--data \
'{
    "email": "newuser@example.com",
    "tokenId": "yA26LZ6SxFEgNuF86/SIXfimGlg=",
    "confirmationId": "f4x0Dh6iZCXtX8nhiSb3xahNxrg=",
    "username": "newuser",
    "userpassword": "password"
}' \
https://openam.example.com:8443/openam/json/users?_action=anonymousCreate</strong>
<em class="computeroutput">{
    "username": "newuser",
    "realm": "/",
    "uid": [
        "newuser"
    ],
    "mail": [
        "newuser@example.com"
    ],
    "sn": [
        "newuser"
    ],
    "cn": [
        "newuser"
    ],
    "inetUserStatus": [
        "Active"
    ],
    "dn": [
        "uid=newuser,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "objectClass": [
        "devicePrintProfilesContainer",
        "person",
        "sunIdentityServerLibertyPPService",
        "inetorgperson",
        "sunFederationManagerDataStore",
        "iPlanetPreferences",
        "iplanet-am-auth-configuration-service",
        "organizationalperson",
        "sunFMSAML2NameIdentifier",
        "inetuser",
        "forgerock-am-dashboard-service",
        "iplanet-am-managed-person",
        "iplanet-am-user-service",
        "sunAMAuthAccountLockout",
        "top"
    ],
    "universalid": [
        "id=newuser,ou=user,dc=openam,dc=forgerock,dc=org"
    ]
}</em></pre><p>At this point, the user is registered, active, and can authenticate with OpenAM.</p></li>
          </ol>
         </div>
        </div>
       </div>
       <div class="section" id="deprecated-rest-api-password-reset">
        <div class="titlepage">
         <div>
          <div>
           <h3 class="title">A.2.2.&nbsp;Legacy Forgotten Password Reset</h3>
          </div>
         </div>
        </div>
        <p> The OpenAM REST API provides an action for handling forgotten passwords as long as the user has a valid email address in their profile. This is an alternative to the password reset capability described in <a href="../admin-guide/index.html#chap-usr-selfservices" class="olink">Chapter&nbsp;8, "Configuring User Self-Service Features"</a> in the <em>Administration Guide</em>. </p>
        <div class="panel panel-success">
         <div class="panel-heading">
          <h3 class="panel-title">Tip</h3>
         </div>
         <div class="panel-body">
          <p>If the current password is known, use the <a class="xref" href="#rest-api-change-password" title="2.1.5.1.7.&nbsp;Changing Passwords">Section&nbsp;2.1.5.1.7, "Changing Passwords"</a> feature to change a password.</p>
         </div>
        </div>
        <p>The option is disabled by default. You can enable it in the OpenAM Console globally by using Configuration &gt; Global &gt; User Self Service.</p>
        <p>Alternatively, you can enable it for an individual realm under Realms &gt; <em class="replaceable">Realm Name</em> &gt; Services &gt; Add &gt; User Self Service.</p>
        <div class="orderedlist">
         <p>An example follows, showing the steps in more detail.</p>
         <ol class="orderedlist" type="1">
          <li class="listitem"><p>Configure the Email Service.</p><p>In particular, you must configure the Email Service to send mail allowing the user to reset the forgotten password.</p><p>You can configure the service globally in the OpenAM Console via Configuration &gt; Global &gt; Email Service.</p><p>Alternatively, you can configure it for an individual realm under Realms &gt; <em class="replaceable">Realm Name</em> &gt; Services.</p><p> At this point users with mail addresses can reset their forgotten passwords. The starting screen for forgotten password reset is at <code class="literal">/XUI/#forgotPassword/</code> under the base URL where OpenAM is installed. The default confirmation URI is <code class="literal">/XUI/confirm.html</code>. </p><p> The steps that follow show how to use the REST API directly. </p></li>
          <li class="listitem"><p> Perform an HTTP POST on <code class="literal">/json/users?_action=forgotPassword</code> with the user's ID. </p>
           <div class="panel panel-info">
            <div class="panel-heading">
             <h3 class="panel-title">Note</h3>
            </div>
            <div class="panel-body">
             <p>In OpenAM 13, the <code class="literal">/users</code> endpoint was updated to version 3.0. Request API resource version 2.0 in the REST API calls to get the behavior provided in previous versions of OpenAM.</p>
            </div>
           </div><p> To use a subject and message other than those configured in the Email Service, you can optionally set the mail subject and message content by including "subject" and "message" strings in the JSON data. For example, the following POST results in a mail with subject <code class="literal">Reset your forgotten password with OpenAM</code> and content <code class="literal">Follow this link to reset your password</code> in addition to the confirmation link. </p><p> Notice that authentication is not required. </p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
--request POST \
--header "Content-Type: application/json" \
--header "Accept-API-Version: protocol=1.0,resource=2.0" \
--data '{
    "username": "demo",
    "subject": "Reset your forgotten password with OpenAM",
    "message": "Follow this link to reset your password"
}' \
https://openam.example.com:8443/openam/json/users/?_action=forgotPassword</strong>
<em class="computeroutput">{}</em></pre><p>Note that you can also use the <code class="literal">email</code> attribute to locate the user. If both <code class="literal">username</code> and <code class="literal">mail</code> attributes are used, then a request error is issued. If more than one account has been registered with the same email address, the password reset process does not start.</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
--request POST \
--header "Content-Type: application/json" \
--header "Accept-API-Version: protocol=1.0,resource=2.0" \
--data '{
    "email": "demo@example.com",
    "subject": "Reset your forgotten password with OpenAM",
    "message": "Follow this link to reset your password"
}' \
https://openam.example.com:8443/openam/json/users/?_action=forgotPassword</strong>
<em class="computeroutput">{}</em></pre><p>On success, the response is an empty JSON object <code class="literal">{}</code> as shown in the example.</p></li>
          <li class="listitem"><p>OpenAM looks up the email address in the user profile, and sends an email message that includes a URL as in the following example, but all on one line.</p><pre class="literallayout">https://openam.example.com:8443/openam/json/XUI/confirm.html
      ?confirmationId=sdfsfeM+URcWVQ7vvCDnx4N5Vut7SBIY=
      &amp;tokenId=vkm+5v58cTs1yQcQl5HCQGOsuQk=
      &amp;username=demo&amp;realm=/</pre></li>
          <li class="listitem"><p>Intercept the HTTP GET request to this URL when the user clicks the link.</p><p>Your application must use the confirmation link to construct an HTTP POST to <code class="literal">/json/users?_action=confirm</code> from the query string parameters as shown in the following example:</p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
--request POST \
--header "Content-Type: application/json" \
--header "Accept-API-Version: protocol=1.0,resource=2.0" \
--data \
'{
    "username":"demo",
    "tokenId":"vkm+5v58cTs1yQcQl5HCQGOsuQk=",
    "confirmationId":"sdfsfeM+URcWVQ7vvCDnx4N5Vut7SBIY="
}' \
https://openam.example.com:8443/openam/json/users?_action=confirm</strong>
<em class="computeroutput">{
    "username": "demo",
    "tokenId": "vkm+5v58cTs1yQcQl5HCQGOsuQk=",
    "confirmationId": "sdfsfeM+URcWVQ7vvCDnx4N5Vut7SBIY="
}</em></pre><p>The response is a further confirmation that the request is valid, has not expired, and the password can be reset.</p></li>
          <li class="listitem"><p>Using the confirmation, your application must construct an HTTP POST to <code class="literal">/json/users?_action=forgotPasswordReset</code> to reset the password as shown in the following example.</p><p>Your POST includes the new password as the value of the "userpassword" field in the JSON payload. You can also use the <code class="literal">email</code> attribute instead of <code class="literal">username</code>. </p><pre class="cmdline prettyprint nohighlight">
$ <strong class="userinput">curl \
--request POST \
--header "Content-Type: application/json" \
--header "Accept-API-Version: protocol=1.0,resource=2.0" \
--data '{
    "username":"demo",
    "userpassword":"password",
    "tokenId":"vkm+5v58cTs1yQcQl5HCQGOsuQk=",
    "confirmationId":"sdfsfeM+URcWVQ7vvCDnx4N5Vut7SBIY="
}' \
https://openam.example.com:8443/openam/json/users?_action=forgotPasswordReset</strong>
<em class="computeroutput">{}</em></pre><p>On success or failure, the REST call returns an empty message, so that information is not leaked. </p></li>
         </ol>
        </div>
        <p>At this point the user can authenticate with the new password.</p>
       </div>
      </div>
     </div>
     <div class="index" id="index">
      <div class="titlepage">
       <div>
        <div>
         <h1 class="title">Index</h1>
        </div>
       </div>
      </div>
      <div xmlns:xlink="http://www.w3.org/1999/xlink" class="index">
       <div class="indexdiv">
        <h3>A</h3>
        <dl>
         <dt id="ientry-d14232e1192">
          Authentication
         </dt>
         <dd>
          <dl>
           <dt>
            Custom module, 
            <a class="indexterm" href="#sec-auth-spi">Customizing Authentication Modules</a>
           </dt>
           <dt>
            Java API, 
            <a class="indexterm" href="#sec-authentication">Authenticating Using OpenAM Java SDK</a>
           </dt>
           <dt>
            Post authentication plugins, 
            <a class="indexterm" href="#sec-post-auth">Creating a Post Authentication Plugin</a>
           </dt>
           <dt>
            REST API, 
            <a class="indexterm" href="#rest-api-auth">Authentication &amp; Logout</a>
           </dt>
          </dl>
         </dd>
        </dl>
       </div>
       <div class="indexdiv">
        <h3>D</h3>
        <dl>
         <dt id="ientry-d14232e8106">
          Dashboard services, 
          <a class="indexterm" href="#rest-dashboard">Displaying Dashboard Applications</a>
         </dt>
        </dl>
       </div>
       <div class="indexdiv">
        <h3>F</h3>
        <dl>
         <dt id="ientry-d14232e11084">
          Fedlets
         </dt>
         <dd>
          <dl>
           <dt>
            Java
           </dt>
           <dd>
            <dl>
             <dt>
              Manual, 
              <a class="indexterm" href="#sec-fedlet-unconfigured">Configuring Java Fedlets By Hand</a>
             </dt>
             <dt>
              Wizard, 
              <a class="indexterm" href="#sec-fedlet-java">Using Fedlets in Java Web Applications</a>
             </dt>
            </dl>
           </dd>
           <dt>
            SAML v2.0, 
            <a class="indexterm" href="#chap-fedlets">Building SAML v2.0 Service Providers With Fedlets</a>
           </dt>
          </dl>
         </dd>
        </dl>
       </div>
       <div class="indexdiv">
        <h3>I</h3>
        <dl>
         <dt id="ientry-d14232e9883">
          Installing
         </dt>
         <dd>
          <dl>
           <dt>
            C SDK, 
            <a class="indexterm" href="#sec-csdk">Using the OpenAM C SDK</a>
           </dt>
           <dt>
            Java SDK samples, 
            <a class="indexterm" href="#install-sdk-samples">Installing OpenAM Client SDK Samples</a>
           </dt>
          </dl>
         </dd>
        </dl>
       </div>
       <div class="indexdiv">
        <h3>O</h3>
        <dl>
         <dt id="ientry-d14232e6397">
          OAuth 2.0, 
          <a class="indexterm" href="#sec-oauth2-scopes">Customizing OAuth 2.0 Scope Handling</a>
         </dt>
         <dd>
          <dl>
           <dt>
            REST API, 
            <a class="indexterm" href="#rest-api-oauth2">OAuth 2.0</a>
           </dt>
          </dl>
         </dd>
         <dt id="ientry-d14232e7428">
          OpenID Connect 1.0
         </dt>
         <dd>
          <dl>
           <dt>
            REST API, 
            <a class="indexterm" href="#rest-api-openid-connect">OpenID Connect 1.0</a>
           </dt>
          </dl>
         </dd>
        </dl>
       </div>
       <div class="indexdiv">
        <h3>P</h3>
        <dl>
         <dt id="ientry-d14232e8669">
          Passwords
         </dt>
         <dd>
          <dl>
           <dt>
            Change, 
            <a class="indexterm" href="#rest-api-change-password">Changing Passwords</a>
           </dt>
           <dt>
            Reset, 
            <a class="indexterm" href="#rest-api-change-password">Changing Passwords</a>
           </dt>
          </dl>
         </dd>
         <dt id="ientry-d14232e2589">
          Policy
         </dt>
         <dd>
          <dl>
           <dt>
            Java API, 
            <a class="indexterm" href="#sec-policy-decisions">Requesting Policy Decisions Using OpenAM Java SDK</a>
           </dt>
           <dt>
            Plugins, 
            <a class="indexterm" href="#sec-policy-spi">Customizing Policy Evaluation</a>
           </dt>
           <dt>
            REST API, 
            <a class="indexterm" href="#rest-api-authz">About the REST Policy Endpoints</a>
           </dt>
          </dl>
         </dd>
        </dl>
       </div>
       <div class="indexdiv">
        <h3>R</h3>
        <dl>
         <dt id="ientry-d14232e8778">
          Realm data
         </dt>
         <dd>
          <dl>
           <dt>
            REST access, 
            <a class="indexterm" href="#rest-api-crud-realm">Realm Management</a>
           </dt>
          </dl>
         </dd>
         <dt id="ientry-d14232e1015">
          Realms
         </dt>
         <dd>
          <dl>
           <dt>
            REST, 
            <a class="indexterm" href="#realms-rest">Specifying Realms in REST API Calls</a>
           </dt>
          </dl>
         </dd>
         <dt id="ientry-d14232e9731">
          Recording
         </dt>
         <dd>
          <dl>
           <dt>
            Using the REST API, 
            <a class="indexterm" href="#sec-rest-api-recording">RESTful Troubleshooting Information Recording</a>
           </dt>
          </dl>
         </dd>
         <dt id="ientry-d14232e3217">
          Resource Types, 
          <a class="indexterm" href="#rest-api-authz-resource-types">Managing Resource Types</a>
         </dt>
         <dt id="ientry-d14232e380">
          REST API, 
          <a class="indexterm" href="#sec-rest">Using the REST API</a>, 
          <a class="indexterm" href="#sec-rest-authz-policy">RESTful Authorization and Policy Management Services</a>, 
          <a class="indexterm" href="#sec-rest-oauth2-oidc">RESTful OAuth 2.0, OpenID Connect 1.0 and UMA 1.0 Services</a>, 
          <a class="indexterm" href="#sec-rest-identity-realm-mgmt">RESTful Identity and Realm Management Services</a>
         </dt>
        </dl>
       </div>
       <div class="indexdiv">
        <h3>S</h3>
        <dl>
         <dt id="ientry-d14232e9156">
          Scripts, 
          <a class="indexterm" href="#chap-scripting">Scripting OpenAM</a>
         </dt>
         <dd>
          <dl>
           <dt>
            API, 
            <a class="indexterm" href="#scripting-api">The Scripting API</a>
           </dt>
           <dt>
            Managing, 
            <a class="indexterm" href="#sec-manage-scripts-rest">RESTful Script Management</a>
           </dt>
           <dt>
            OIDC Claims, 
            <a class="indexterm" href="#sec-scripted-oidc-claims">Default OIDC Claims Script</a>
           </dt>
           <dt>
            Policy Conditions, 
            <a class="indexterm" href="#sec-scripted-policy-condition">Default Policy Condition Script</a>
           </dt>
           <dt>
            Server-side Authentication, 
            <a class="indexterm" href="#sec-scripted-auth-module">Default Server-side Authentication Script</a>
           </dt>
          </dl>
         </dd>
         <dt id="ientry-d14232e20930">
          Secure Attribute Exchange (SAE), 
          <a class="indexterm" href="#chap-sae">Using Secure Attribute Exchange</a>
         </dt>
         <dt id="ientry-d14232e19656">
          Security Token Service, 
          <a class="indexterm" href="#chap-sts">Working With the Security Token Service</a>
         </dt>
         <dt id="ientry-d14232e1904">
          Session information
         </dt>
         <dd>
          <dl>
           <dt>
            REST API, 
            <a class="indexterm" href="#rest-api-tokens">Token Validation and Session Information</a>
           </dt>
          </dl>
         </dd>
         <dt id="ientry-d14232e1197">
          Session tokens
         </dt>
         <dd>
          <dl>
           <dt>
            Java API, 
            <a class="indexterm" href="#sec-session">Handling Single Sign-On Using OpenAM Java SDK</a>
           </dt>
           <dt>
            REST API, 
            <a class="indexterm" href="#rest-api-auth">Authentication &amp; Logout</a>, 
            <a class="indexterm" href="#rest-api-ssotoken">Using the Session Token After Authentication</a>
           </dt>
          </dl>
         </dd>
        </dl>
       </div>
       <div class="indexdiv">
        <h3>T</h3>
        <dl>
         <dt id="ientry-d14232e1899">
          Token validation
         </dt>
         <dd>
          <dl>
           <dt>
            REST API, 
            <a class="indexterm" href="#rest-api-tokens">Token Validation and Session Information</a>
           </dt>
          </dl>
         </dd>
         <dt id="ientry-d14232e8162">
          Two Step Verification
         </dt>
         <dd>
          <dl>
           <dt>
            resetting device profile, 
            <a class="indexterm" href="#rest-api-device-profile-reset">Resetting Device Profiles</a>
           </dt>
          </dl>
         </dd>
        </dl>
       </div>
       <div class="indexdiv">
        <h3>U</h3>
        <dl>
         <dt id="ientry-d14232e16030">
          UMA
         </dt>
         <dd>
          <dl>
           <dt>
            Extending, 
            <a class="indexterm" href="#sec-uma-extension-points">Extending UMA Workflow with Extension Points</a>
           </dt>
          </dl>
         </dd>
         <dt id="ientry-d14232e8236">
          User data
         </dt>
         <dd>
          <dl>
           <dt>
            Custom profile attributes, 
            <a class="indexterm" href="#sec-custom-attr">Customizing Profile Attributes</a>
           </dt>
           <dt>
            Custom repository, 
            <a class="indexterm" href="#sec-identity-repo-spi">Customizing Identity Data Storage</a>
           </dt>
           <dt>
            REST access, 
            <a class="indexterm" href="#rest-api-crud-identity">Identity Management</a>
           </dt>
          </dl>
         </dd>
         <dt id="ientry-d14232e7679">
          User self-service
         </dt>
         <dd>
          <dl>
           <dt>
            REST API, 
            <a class="indexterm" href="#sec-rest-user-services">RESTful User Self-Service</a>
           </dt>
          </dl>
         </dd>
         <dt id="ientry-d14232e7554">
          User-Managed Access (UMA)
         </dt>
         <dd>
          <dl>
           <dt>
            REST API, 
            <a class="indexterm" href="#sec-rest-uma">User-Managed Access (UMA)</a>
           </dt>
          </dl>
         </dd>
        </dl>
       </div>
      </div>
     </div>
    </div>
    <a href="#" class="back-to-top hidden-xs hidden-print" data-placement="left" title="Back to top"><button type="button" class="btn btn-primary btn-default"><span class="glyphicon glyphicon-chevron-up"></span></button></a>
   </div>
  </div>
  <div class="titlepage modal fade hidden-print" id="aboutModal">
   <div class="modal-dialog modal-lg">
    <div class="modal-content">
     <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">X</span></button>
      <div id="about-subtitle">
       OpenAM 13
      </div>
      <div id="about-title">
       Developer's Guide
      </div>
     </div>
     <div class="modal-body">
      <div id="about-authorgroup">
       <div class="author">
        <h3 class="author"><span class="firstname">Mark</span> <span class="surname">Craig</span></h3>
       </div>
       <div class="author">
        <h3 class="author"><span class="firstname">David</span> <span class="surname">Goldsmith</span></h3>
       </div>
       <div class="author">
        <h3 class="author"><span class="firstname">Gene</span> <span class="surname">Hirayama</span></h3>
       </div>
       <div class="author">
        <h3 class="author"><span class="firstname">Mike</span> <span class="surname">Jang</span></h3>
       </div>
       <div class="author">
        <h3 class="author"><span class="firstname">Chris</span> <span class="surname">Lee</span></h3>
       </div>
       <div class="author">
        <h3 class="author"><span class="firstname">Peter</span> <span class="surname">Major</span></h3>
        <div lang="" class="affiliation">
         <span class="orgname">ForgeRock AS<br></span>
         <div class="address">
          <p><br> &nbsp;&nbsp;&nbsp;&nbsp;<span class="street">201&nbsp;Mission&nbsp;St</span><br> &nbsp;&nbsp;&nbsp;&nbsp;<span class="otheraddr">Suite&nbsp;2900</span><br> &nbsp;&nbsp;&nbsp;&nbsp;<span class="city">San&nbsp;Francisco</span>,&nbsp;<span class="state">CA</span>&nbsp;<span class="postcode">94105</span><br> &nbsp;&nbsp;&nbsp;&nbsp;<span class="country">USA</span><br> &nbsp;&nbsp;&nbsp;&nbsp;<span class="phone">+1&nbsp;415-599-1100&nbsp;(US)</span><br> &nbsp;&nbsp;&nbsp;&nbsp;<code class="uri">www.forgerock.com</code><br> &nbsp;&nbsp;&nbsp;</p>
         </div>
        </div>
       </div>
      </div>
      <div id="about-abstract">
       Guide to developing OpenAM client applications and service providers. OpenAM provides open source Authentication, Authorization, Entitlement and Federation software.
      </div>
      <div id="about-buildRevision">
       Build Number: 
       <span>f8bfb850ad2</span>
      </div>
      <div id="about-buildDateTime">
       Build Date: 
       <span>20170728</span>
      </div>
      <a id="about-legalnotice" href="https://backstage.forgerock.com/knowledge/backstagehelp/article/a81642400" target="_blank">Legal Notice (Documentation)</a>
      <div class="about-copyright">
        Copyright © 2011-2017&nbsp;ForgeRock AS.
      </div>
     </div>
    </div>
   </div>
  </div>
  <div id="alternateBar" class="alert alert-warning alert-dismissible" style="">
   <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>
   <div class="mr-1">
    Read a different version of 
    <i id="current-title"></i>:
   </div>
   <span id="alternate-titles"></span>
  </div>
  <backstage-site-footer></backstage-site-footer>
 </body>
</html>