<!doctype html>
<html lang="en">
 <head> 
  <script src="https://use.typekit.net/leq2dmp.js"></script> 
  <script>try{Typekit.load({ async: true });}catch(e){}</script> 
  <meta charset="utf-8"> 
  <meta http-equiv="Content-Language" content="en_US"> 
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Sentiment Analysis with the Sentimental Gem (Example) - GoRails</title> 
  <meta name="stripe-key" content="pk_daFP6nPmDBA00HxJrslPhckbWUZ92"> 
  <meta name="google-site-verification" content="ju-3k3BBfiCNNz3Ug59RQi-dTrGY5uI4wG7L8SHNjRo"> 
  <meta name="keywords" content="rails, ruby on rails, screencasts, gorails, railscast, railscasts, tips, tricks, tutorials, training, podcasts, programming"> 
  <meta name="description" content="Learn how to use sentimental analysis against text inside your application and cache it so you can query against it later"> 
  <!-- Google Authorship and Publisher Markup --> 
  <link rel="author" href="https://plus.google.com/106699287110566383664/posts"> 
  <meta name="twitter:card" content="summary"> 
  <meta name="twitter:site" content="@gorails"> 
  <meta name="twitter:title" content="Sentiment Analysis with the Sentimental Gem (Example)"> 
  <meta name="twitter:description" content="Learn how to use sentimental analysis against text inside your application and cache it so you can query against it later"> 
  <meta name="twitter:image" content="https://gorails.com/assets/open-graph-82976a8b909da5bac463721517ba08c66acabf9a053704756c1e435a89072dff.jpg"> 
  <meta name="twitter:creator" content="@excid3"> 
  <link rel="prefetch" href="https://gorails.com"> 
  <link rel="prerender" href="https://gorails.com"> 
  <meta property="og:title" content="Sentiment Analysis with the Sentimental Gem (Example) - GoRails"> 
  <meta property="og:url" content="https://gorails.com/episodes/sentiment-analysis-with-the-sentimental-gem"> 
  <meta property="og:type" content="website"> 
  <meta property="og:description" content="Learn how to use sentimental analysis against text inside your application and cache it so you can query against it later"> 
  <meta property="og:image" content="https://gorails.com/assets/open-graph-82976a8b909da5bac463721517ba08c66acabf9a053704756c1e435a89072dff.jpg"> 
  <meta property="og:site_name" content="GoRails"> 
  <script src="/assets/application-ea85c30fcfb83a0c038a77691c8ecb39c66b95c5c23e1ea13103818dd4e5ebf4.js" data-turbolinks-track="reload"></script> 
  <script src="//fast.wistia.com/assets/external/E-v1.js" data-turbolinks-track="reload"></script> 
  <script src="https://js.stripe.com/v2/" data-turbolinks-track="reload"></script> 
  <script src="https://js.stripe.com/v3/" data-turbolinks-track="reload"></script> 
  <script src="https://js.braintreegateway.com/v2/braintree.js" data-turbolinks-track="reload"></script> 
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.payment/1.0.2/jquery.payment.min.js" data-turbolinks-track="reload"></script> 
  <script src="https://buttons.github.io/buttons.js" data-turbolinks-track="reload"></script> 
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,900" rel="stylesheet"> 
  <link rel="stylesheet" media="all" href="/assets/application-4beea63e06711a967ca2095c93e7ff224b4fabf3cda9de16c4f1e8725b372b9d.css" data-turbolinks-track="reload"> 
  <meta name="csrf-param" content="authenticity_token"> 
  <meta name="csrf-token" content="EMTyW86eTtu+eQruS3nPp6k2OEdJvqQAZHgFgUoxzzkBT6b5D0TTx8JegGaR5soMghfBfYzrjegrKQKgUHOJIQ=="> 
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon-b7c281b7cf591f0e0a4ddcdfaeaaf510320298228a56f028b943c34fec64ecab.ico"> 
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://gorails.com/blog.rss"> 
  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-8399719-16', 'auto');
  </script> 
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries --> 
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]--> 
 </head> 
 <body class="dark-bg"> 
  <a class="sr-only" href="#content">Skip to main content</a> 
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark"> 
   <div class="container"> 
    <a class="navbar-brand" href="/"> <img title="GoRails" height="20" src="/assets/logo-white-a59a16997c678edb493004e0c5862e09f19d66de473584441e92bdf9d1cddd48.svg" alt="Logo white"> </a> 
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> 
    <div class="collapse navbar-collapse" id="navbarColor01"> 
     <ul class="navbar-nav mr-auto"> 
      <li class="nav-item active"><a class="nav-link" href="/episodes">Episodes <span class="sr-only">(current)</span></a></li> 
      <li class="nav-item "><a class="nav-link" href="/series">Series</a></li> 
      <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="/guides"> Guides <b class="caret"></b> </a> 
       <div class="dropdown-menu"> 
        <a class="dropdown-item" href="/setup">Setup Ruby on Rails</a> 
        <a class="dropdown-item" href="/deploy/ubuntu">Deploy Ruby on Rails</a> 
        <a class="dropdown-item" href="/deploy/actioncable">Deploy ActionCable</a> 
        <div class="dropdown-divider"></div> 
        <a class="dropdown-item" href="/guides/free-ssl-with-rails-and-nginx-using-let-s-encrypt">Free SSL for Rails and Nginx using Let's Encrypt</a> 
        <a class="dropdown-item" href="/guides/hourly-production-server-database-and-file-backups">Hourly Production Server Database And File Backups</a> 
        <a class="dropdown-item" href="/guides/rotating-rails-production-logs-with-logrotate">Rotating Rails Production Logs with LogRotate</a> 
        <a class="dropdown-item" href="/guides/setting-up-rails-4-with-mongodb-and-mongoid">Setting Up Rails 4 with MongoDB and Mongoid</a> 
        <a class="dropdown-item" href="/guides/upgrading-postgresql-version-on-ubuntu-server">Upgrading PostgreSQL Version on Ubuntu Server</a> 
        <a class="dropdown-item" href="/guides/using-vagrant-for-rails-development">Using Vagrant for Rails Development</a> 
        <div class="dropdown-divider"></div> 
        <a class="dropdown-item text-center" href="/guides">See All Guides</a> 
       </div> </li> 
      <li class="nav-item "><a class="nav-link" href="/forum">Community</a></li> 
     </ul> 
     <form class="ml-md-auto mr-3 form-inline" action="/search" accept-charset="UTF-8" method="get">
      <input name="utf8" type="hidden" value="?"> 
      <div class="form-group"> 
       <input type="text" name="q" id="q" class="form-control search-input" placeholder="What do you want to learn?" style="min-width: 16em"> 
      </div> 
     </form> 
     <ul class="navbar-nav"> 
      <li class="nav-item"><a class="nav-link" href="/pricing">Pricing</a></li> 
      <li class="nav-item"><a class="nav-link" href="/users/sign_in?redirect_to=%2Fepisodes%2Fsentiment-analysis-with-the-sentimental-gem">Login</a></li> 
      <li class="nav-item"><a class="nav-link text-success" href="/users/sign_up">Sign Up</a></li> 
     </ul> 
    </div> 
   </div> 
  </nav> 
  <div class="episode-video-wrapper mb-5"> 
   <div class="video-player"> 
    <div class="embed-responsive embed-responsive-video"> 
     <iframe class="embed-responsive-item" src="https://www.youtube.com/embed/JY6X4j68Voc?enablejsapi=1&amp;rel=0&amp;autoplay=0" frameborder="0" allowfullscreen></iframe> 
    </div> 
    <div class="row"> 
     <div class="col"> 
      <ul class="nav nav-pills justify-content-end"> 
       <li class="nav-item"><a class="nav-link">Share on</a></li> 
       <li class="nav-item"> <a target="blank" class="nav-link" href="http://www.twitter.com/share?text=Sentiment%20Analysis%20with%20the%20Sentimental%20Gem&amp;url=https://gorails.com/episodes/sentiment-analysis-with-the-sentimental-gem"> <i class="fa fa-twitter twitter"></i> Twitter </a> </li> 
       <li class="nav-item"> <a target="blank" class="nav-link" href="https://www.facebook.com/sharer/sharer.php?u=https://gorails.com/episodes/sentiment-analysis-with-the-sentimental-gem"> <i class="fa fa-facebook-official facebook"></i> Facebook </a> </li> 
       <li class="nav-item"> <a target="blank" class="nav-link" href="http://www.reddit.com/submit?title=Sentiment%20Analysis%20with%20the%20Sentimental%20Gem&amp;url=https://gorails.com/episodes/sentiment-analysis-with-the-sentimental-gem"> <i class="fa fa-reddit-alien reddit"></i> Reddit </a> </li> 
       <li class="nav-item"> <a target="blank" class="nav-link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://gorails.com/episodes/sentiment-analysis-with-the-sentimental-gem&amp;title=Sentiment%20Analysis%20with%20the%20Sentimental%20Gem"> <i class="fa fa-linkedin linkedin"></i> LinkedIn </a> </li> 
      </ul> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div class="container" id="episode_118"> 
   <h1 data-behavior="episode" data-name="Sentiment Analysis with the Sentimental Gem" data-id="118"> <span class="pull-right" id="hearts"> <a data-toggle="tooltip" data-placement="left" title="Sign up to heart this episode" href="/users/sign_up"><i class="fa fa-heart text-muted"></i></a> <span class="text-muted">14</span> </span> Sentiment Analysis with the Sentimental Gem </h1> 
   <div class="row"> 
    <div class="col-md-4"> 
     <div class="card episode-actions"> 
      <div class="card-body"> 
       <h5 class="page-header">Recommended Episodes</h5> 
       <a class="next-episode-card" href="/episodes/improving-query-performance-with-database-indexes?autoplay=1"> 
        <div class="row"> 
         <div class="col-sm-4 col-xs-4"> 
          <img class="img-fluid" src="https://embed-ssl.wistia.com/deliveries/bb48cdaaa37233c5e8b3888f2bc6de645db6e5aa.jpg?image_crop_resized=400x240" alt="Bb48cdaaa37233c5e8b3888f2bc6de645db6e5aa"> 
         </div> 
         <div class="col-sm-8 col-xs-8">
           Improving Query Performance with Database Indexes 
         </div> 
        </div> </a> 
       <a class="next-episode-card" href="/episodes/inviting-users-with-devise_invitable?autoplay=1"> 
        <div class="row"> 
         <div class="col-sm-4 col-xs-4"> 
          <img class="img-fluid" src="https://embed-ssl.wistia.com/deliveries/c11346f684a57b0dbd12db2da4736eac94c8b806.jpg?image_crop_resized=400x240" alt="C11346f684a57b0dbd12db2da4736eac94c8b806"> 
         </div> 
         <div class="col-sm-8 col-xs-8">
           Inviting Users with devise_invitable 
         </div> 
        </div> </a> 
       <a class="next-episode-card" href="/episodes/advanced-caching-user-permissions-and-authorization?autoplay=1"> 
        <div class="row"> 
         <div class="col-sm-4 col-xs-4"> 
          <img class="img-fluid" src="https://embed-ssl.wistia.com/deliveries/7baa8022dc5488589f8ca64ea9d00f51f6b92f53.jpg?image_crop_resized=400x240" alt="7baa8022dc5488589f8ca64ea9d00f51f6b92f53"> 
         </div> 
         <div class="col-sm-8 col-xs-8">
           Advanced Caching with User Permissions and Authorization 
         </div> 
        </div> </a> 
       <a class="next-episode-card" href="/episodes/russian-doll-caching-with-rails-5?autoplay=1"> 
        <div class="row"> 
         <div class="col-sm-4 col-xs-4"> 
          <img class="img-fluid" src="https://embed-ssl.wistia.com/deliveries/3e6ffa1ce167301f660e4f6a831e5e82c543f4a6.jpg?image_crop_resized=400x240" alt="3e6ffa1ce167301f660e4f6a831e5e82c543f4a6"> 
         </div> 
         <div class="col-sm-8 col-xs-8">
           Russian Doll Caching with Rails 5 
         </div> 
        </div> </a> 
       <a class="next-episode-card" href="/episodes/reposting-retweeting-reblogging?autoplay=1"> 
        <div class="row"> 
         <div class="col-sm-4 col-xs-4"> 
          <img class="img-fluid" src="https://embed-ssl.wistia.com/deliveries/103876a740b36d550eb2876b79ce81562a0eabff.jpg?image_crop_resized=400x240" alt="103876a740b36d550eb2876b79ce81562a0eabff"> 
         </div> 
         <div class="col-sm-8 col-xs-8">
           Repost / Retweet / Reblog 
         </div> 
        </div> </a> 
       <a class="next-episode-card" href="/episodes/turbolinks-5-forms?autoplay=1"> 
        <div class="row"> 
         <div class="col-sm-4 col-xs-4"> 
          <img class="img-fluid" src="https://embed-ssl.wistia.com/deliveries/5c8b81ea5d41efa2164eb30d69d5807b279a5691.jpg?image_crop_resized=400x240" alt="5c8b81ea5d41efa2164eb30d69d5807b279a5691"> 
         </div> 
         <div class="col-sm-8 col-xs-8">
           Turbolinks 5 Forms for Mobile 
         </div> 
        </div> </a> 
      </div> 
     </div> 
    </div> 
    <div class="col-md-8"> 
     <div class="card mb-3"> 
      <div class="card-body"> 
       <div class="row"> 
        <div class="col"> 
         <p class="text-muted form-control-plaintext mb-3"> Episode 117 · May 5, 2016 </p> 
        </div> 
        <div class="col"> 
         <div class="btn-group"> 
          <a data-behavior="completed-status" class="btn btn-link" data-remote="true" rel="nofollow" data-method="post" href="/episodes/sentiment-analysis-with-the-sentimental-gem/complete">Mark as Completed</a> 
          <a data-behavior="watchlist-status" class="btn btn-link" data-remote="true" rel="nofollow" data-method="post" href="/episodes/sentiment-analysis-with-the-sentimental-gem/watchlist">Watch Later</a> 
          <a download="true" class="btn btn-link" href="http://embed.wistia.com/deliveries/c1a5d40a5303c90e9c53f1219b3879abfe1a010d/117-sentiment-analysis-with-the-sentimental-gem.mp4">Download</a> 
         </div> 
        </div> 
       </div> 
       <p>Learn how to use sentimental analysis against text inside your application and cache it so you can query against it later</p> 
       <p> <a href="/episodes/tagged/Gems"><span class="badge badge-primary">Gems</span></a> </p> 
       <hr> 
       <div>
        <h2>Resources</h2> 
        <ul> 
         <li><a href="https://github.com/7compass/sentimental">Sentimental Gem</a></li> 
         <li><a href="https://github.com/excid3/gorails-episode-117">Source code for this episode</a></li> 
        </ul> 
       </div> 
      </div> 
     </div> 
     <div class="card mb-3"> 
      <div class="card-body"> 
       <h3>Transcripts</h3> 
       <div> 
        <!-- Nav tabs --> 
        <ul class="nav nav-pills" role="tablist" data-behavior="transcript-tabs"> 
         <a class="nav-link " href="#arabic">Arabic</a> 
         <a class="nav-link active" href="#english">English</a> 
        </ul> 
        <!-- Tab panes --> 
        <div class="tab-content"> 
         <div role="tabpanel" class="tab-pane " id="arabic" dir="auto"> 
          <div class="text-center"> 
           <i class="fa fa-spinner fa-spin fa-3x fa-fw"></i> 
           <span class="sr-only">Loading...</span> 
          </div> 
         </div> 
         <div role="tabpanel" class="tab-pane active" id="english" dir="auto"> 
          <p>What's up guys? This episode, we're going to talk about sentiment analysis, so we're going to load up some tweets into a rails application, we're going to take the text of the tweets, and then we're going to check to see how positive or how negative those tweets are based on the words that were written in it. Sentiment analysis is basically like: Is this person saying they love or they hate this thing, or are they neutral about it, and so you can take any text and analyze it and estimate how positive or negative that is. Now this is something that we're going to do a very rudimentary version using the sentimental gem, but there's a lot of stuff that you could learn about this stuff, because in language, language is a very complex thing and so people might be sarcastic and something like this may not be able to detect that, but from a rough standpoint, we're going to have a fairly good accuracy based on the words that are in these tweets. For fun, you might search something like "Microsoft", and you might check to see how many people say: I hate Microsoft or I love Microsoft, and you'll be able to tell, based on the word "love" and "hate", you'll be able to determine: Ok, well this word means positive, this word is negative, and so there's different scales of all of those words. This sentimental gem actually comes with a word list, and you can look this up, it's a pretty large file, but basically has all these words, and their values scale from 1.0 to -1.0, and so this is just a way of going about and saying how positive or how negative that is based on the words in the text that you're analyzing, so for example if you say <em>love</em>, it's a 0.925% positive word, and it's kind of weighted based on the usage of it, the language, so there is times when people will say <em>love</em> and it's maybe sarcastic or something, but it's rare for people to say <em>epic</em> or <em>good</em>, or <em>upright</em> or whatever in some sort of negative fashion, so you have all these weighings of the words, and you scroll through this, and you can make adjustments to this if you'd like or add your own words just by downloading this file, and then uploading your own version, loading that into the gem when you load the library. We're just going to use the built-in word list, and we're going to analyze some text, so we'll probably connect this to Twitter, and then load up some searches and determine what are the sentiment in general for each tweet that may be an average across all the tweets. Let's dive into implementing this gem.</p> 
          <p>Let's create a new rails application, we'll build a model, and then we'll sync tweets into our database using the Twitter gem, and then we'll just hit the local copies of the tweets in order to be able to test this out a lot easier. <code>rails new sentimental_tweets</code> is the name of our rails application, and so we'll install this, we'll install the Twitter gem next, and we'll go ahead and plug in the Twitter client, and then go ahead and create a model for all of that. Let's dive into this, and let's open up the Gemfile, and so here let's get the Twitter gem, and we'll grab the latest version of that, and let's go ahead and create a model so that we can save copies of those tweets. Let's go ahead and do that once the bundle command is finished.</p> 
          <p>Now that that's finished installing, let's hop back over to the README and take a look and see what we're going to want to save as attributes in our tweet model. This gem actually parses the text that you give it, and then it gives you either a positive, negative or neutral string that you can get back, so you can see that when you call sentiment on some text, that will give you a symbol back. We can save that, and that would allow for easier searching in our database, but the actual detail of the score might be useful in a lot of cases, so you might want to analyze this and be able to adjust the queries based on the score rather than just the very broad, generic, positive, negative and neutral. This score is probably going to be the most important piece to actually cache, and we're going to want to do this and cache that sentiment score and possibly the sentiment in general so that we have this important thing of basically like: We only do this one time, we only make that calculation one time so we'll save it into the database, and then we can look it up because the text shouldn't be changing for these tweets. We will set it up so that anytime the text changes in the tweet, we'll go ahead and rerun the sentiment analysis, and then save those attributes on the model. Let's generate our model, and then we'll go and actually implement the sinking from Twitter, and then sentiment analysis itself. Let's generate a scaffold called Tweet, <code>rails g scaffold Tweet body:text sentiment score:decimal</code>, <code>rake db:migrate</code> We will now just implement the Twitter client in order to sync some tweets down, we'll do that really simply using the Twitter gem and the search that they provide. We'll just search like "Microsoft" or something. "Rails", "JavaScript", whatever, and then we'll sync those tweets to the database and then we will do sentiment analysis on those. If you head over to the configuration section in the Twitter README, it gives you an example on how to set up the client. I'm actually going to put this inside of the Tweet model, and we'll have a sync method, and this will just be what we use in order to sync this over. We're going to swap all of these strings instead of hard-coding them. I'm going to use Rails application secrets.</p> 
          <p><strong>app/models/tweet.rb</strong></p> 
          <div class="highlight">
           <pre><span></span><span class="k">class</span> <span class="nc">Tweet</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span> 
    <span class="k">def</span> <span class="nf">sync</span> 
        <span class="n">client</span> <span class="o">=</span> <span class="no">Twitter</span><span class="o">::</span><span class="no">REST</span><span class="o">::</span><span class="no">Client</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
            <span class="n">config</span><span class="o">.</span><span class="n">consumer_key</span>         <span class="o">=</span>  <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">consumer_key</span>
            <span class="n">config</span><span class="o">.</span><span class="n">consumer_secret</span>      <span class="o">=</span>  <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">consumer_secret</span>
            <span class="n">config</span><span class="o">.</span><span class="n">access_token</span>         <span class="o">=</span>  <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">access_token</span>
            <span class="n">config</span><span class="o">.</span><span class="n">access_token_secret</span>  <span class="o">=</span>  <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">access_token_secret</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre>
          </div> 
          <p>The access tokens are going to be the ones that come from your users who have OAuth. I'm going to hard-code some in in the secrets file for myself without doing OAuth because if you go into the apps section on Twitter you can just grab that string there that they give you to meke testing their API a little bit easier, but in the future you'd actually want to pull this like from the user model or wherever you saved the OAuth tokens that you would get back from like OmniAuth. </p> 
          <p>I just pasted those off-screen, those keys in my <strong>secrets.yml</strong>, you can do the same or put those from the user model or whatever you would like to do, and then I'm also going to change this to be a class method so that we can access this, and then we'll have a query that we pass in so that we can do <code>client.search(query)</code> That way, you can paste in and use this generic method to sync any tweets of any type of query, and we're not going to worry about duplicates or anything like that, we're just going to sync, sync, sync and you can go and tweak this to work however you would like. We just need some data in our application to test out the sentiment analysis part. If we run <code>rails c</code> now, we should be able to say <code>Tweet.sync("rails")</code> That should load up a whole bunch of tweets, and it does, and now we just need to go through each one of these tweets and save them into our database. Here, we're just going to say </p> 
          <p><strong>app/model/tweets.rb</strong> </p> 
          <div class="highlight">
           <pre><span></span><span class="k">class</span> <span class="nc">Tweet</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span> 
    <span class="k">def</span> <span class="nf">sync</span> 
        <span class="n">client</span> <span class="o">=</span> <span class="no">Twitter</span><span class="o">::</span><span class="no">REST</span><span class="o">::</span><span class="no">Client</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
            <span class="n">config</span><span class="o">.</span><span class="n">consumer_key</span>         <span class="o">=</span>  <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">consumer_key</span>
            <span class="n">config</span><span class="o">.</span><span class="n">consumer_secret</span>      <span class="o">=</span>  <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">consumer_secret</span>
            <span class="n">config</span><span class="o">.</span><span class="n">access_token</span>         <span class="o">=</span>  <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">access_token</span>
            <span class="n">config</span><span class="o">.</span><span class="n">access_token_secret</span>  <span class="o">=</span>  <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">access_token_secret</span>
        <span class="k">end</span>
        <span class="n">client</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">tweet</span><span class="o">|</span>
            <span class="n">create</span><span class="p">(</span><span class="ss">body</span><span class="p">:</span> <span class="n">tweet</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre>
          </div> 
          <p>Let's rerun the rails console with that new code, so we'll say <code>Tweet.sync("rails")</code> This is going to go insert a whole bunch of these into our database, which is perfect. That does exactly what we want, and now we need to be able to go through those tweets, and then actually parse them for sentiment analysis.</p> 
          <p>We haven't installed the sentimental gem yet, so let's open up our Gemfile, and add that to the bottom, let's get the latest version of this, and let's go ahead and paste that in, and run bundle to install it. Now that that's installed, let's jump back to the README for sentimental, and take a look at what we're going to need to implement into our application. We might actually want to say: Let's build a global sentiment analyzer because if we were to instantiate this and load the default every time that we run this, we might load the dictionary database into memory a handful of times, which wouldn't be ideal. Depends on actually how this is implemented behind the scenes, it might not do that, but you might actually be loading that word list in a memory every new time that you create an analyzer, which could use a lot of memory, and probably is the case because it allows you to customize the sentiment file based on what you've loaded. Chances are that this would duplicate that memory, you have to read the source code of this to double check on that, but what we're going to do is load this globally, and then have that ready to go anytime that we want to use it to analyze text inside our models. We're going to put this analyzer, we're going to put this inside an initializer, so we'll have </p> 
          <p><strong>config/initializers/sentimental.rb</strong> </p> 
          <div class="highlight">
           <pre><span></span><span class="vg">$analyzer</span> <span class="o">=</span> <span class="no">Sentimental</span><span class="o">.</span><span class="n">new</span> 
<span class="vg">$analyzer</span><span class="o">.</span><span class="n">load_defaults</span>
</pre>
          </div> 
          <p>That will always be ready to go in order to analyze these anytime that we decided to sync our sentiment on our Tweets. Let's actually just run the sentiment analysis in the console to check and make sure that it's working. Let's grab the last tweet, and grab the body from that, and we can just pass it into the analyzer and ask for either the sentiment or the score. Here, we pass in the last tweet body, and it has marked it as positive, but if you want to know why it's positive or how positive is it, then you can go and call the score method, and that is going to give us basically 62.5% positive for that. Now, how should we go about adding these to our models in order to set this up properly? There's a handful of different ways that you can go about this. We've built a sync method here that allows you to sync these tweets but that's not always the case. When you're syncing the tweet, ok. You can simply say: Let's set the sentiment immediately, and let's also set the score immediately. The thing is, that when you're doing that in something like a scaffold, that's not going to make as much sense because you're not going to always take the params, text and pass that in to sentiment analysis thing. You might want to do that in a callback and say: Well, if the body changed, let's go ahead and run this. There's various ways that you could do about this too because if you go for a more complex sentiment analysis method, or one that takes time, then you might actually want to say: Let's run that in a background job so that we can run that, and if it takes a longer time then this gem does, we can run that behind the scenes. I wouldn't say to add this to your create methods or update methods, because that doesn't make for a pretty seamless experience. You want the capturing of the sentiment to be behind the scenes, so that whenever you interact with these objects, it automatically updates when something changes. That's one of those cases where before-- Well a callback makes sense here <code>before_save :set_sentiment, if: body_changed?</code> Basically, we would set this so that we're only going to want to save the sentiment if the body changed, and then that way, if you go and update this, all you have to worry about is setting the body on the tweet, and then this should automatically run and update that. Now this code here can either immediately update the sentiment, or it could launch a background to go and update the sentiment if this takes longer and you have a different implementation. That would make a lot more sense for the mayority of cases, but in this case, we're going to keep it simple and just say: We'll set the sentiment there, and we're doing this <code>before_save</code> in order to set thsoe values, so that when it does save and does successfully set that, then these values will automatically be included. Here we can say:</p> 
          <div class="highlight">
           <pre><span></span><span class="k">def</span> <span class="nf">set_sentiment</span> 
     <span class="nb">self</span><span class="o">.</span><span class="n">sentiment</span> <span class="o">=</span> <span class="vg">$analyzer</span><span class="o">.</span><span class="n">sentiment</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
     <span class="nb">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="vg">$analyzer</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
<span class="k">end</span> 
</pre>
          </div> 
          <p>If we save this and we go and say: Let's reload our rails application, and do <code>Tweet.sync</code> this time, and of corse, this time we actually need to actually make sure we actually pass in a search, so this time let's search "ruby", and let's see what happens. As you can see here, we're inserting a whole bunch to the database, but what you're getting the sentiment and the scores being added automatically to the database. Anytime it inserts one of those, it's going to check and say: Hey, that body is new, so we're going to go and update that, and if you ever edit the text body of that, it will rerun it through the sentiment analysis. Here we can get the last tweet, we can say <code>Tweet.last.sentiment</code> and we can find out that it's positive, and if we want to get the score for it, we get the score, and you can convert that to a float. So our float value for that was 28.13% Here we can say, if we want to double check that, let's grab the body from that and have the analyzer rerun that and give us the score, and we'll see it gets the exact same value, so we know that it's working right, it's saving those to the database, and we're able to then use this inside our application, so we can go and create scopes around those, and we could say: Let's create a scope for only positive ones, and we'll keep that query really simply around the sentiment one and we'll only look for the positive ones:</p> 
          <div class="highlight">
           <pre><span></span>    <span class="n">scope</span> <span class="ss">:positive</span><span class="p">,</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">sentiment</span><span class="p">:</span> <span class="ss">:positive</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">scope</span> <span class="ss">:neutral</span><span class="p">,</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">sentiment</span><span class="p">:</span> <span class="ss">:neutral</span><span class="p">)}</span>
    <span class="n">scope</span> <span class="ss">:negative</span><span class="p">,</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">sentiment</span><span class="p">:</span> <span class="ss">:negative</span><span class="p">)}</span>
</pre>
          </div> 
          <p>If we go back to the console we can say: <code>Tweet.positive.count</code> so we have almost 500 tweets that are positive, we have 120 tweets that are neutral and we have 180 negative ones. Overall, ruby has a higher percentage of positive tweets than negative or neutral ones, which is awesome, and like that, we're able to go in and add basically sentiment analysis to determine are people happy about this? Are they not? You can apply it to any text that you want to possibly give that. Tweets are a fun one to analyze, but you could do this with forum posts or status updates or anything that you can imagine. Any user input, it's pretty fun to play with this and kind of see-- Maybe you're GitHub and you're wondering, out of all of the issues, how many comments on the issues are positive or negative. It's a lot of interesting stuff. If you support things like emojis and all that, you might actually go and edit your database of positive and negative words, and include the text for the emojis, and then you can have those and say: If it's a :thumbs_up:, then that is also a positive indicator or whatever. You can actually go and modify a lot of the stuff in order to adapt to what your users are doing, because something like this only has a database of it's own words that it's currently aware of, and while this doesn't get updated a huge amount, it's going to depend on your application, so you might actually start here, and then upgrade into using something like your own database that you can easily manage and adjust, or your own machine learning or something like that in order to take this to the next level. This is a great introduction for sentiment analysis. It does a pretty good job for the basic implementation that it does, and it's going to do more than enough for the majority of use cases unless this becomes your core product or something. That's the sentimental gem, I hope you enjoyed this episode, it's pretty fun to play with this stuff, and if you want to see more of this in the future, let me know in the comments below. Talk to you in the next one. Peace <img alt="v" src="/images/emoji/unicode/270c.png" width="20" height="20"></p> 
          <p><em>Transcript written by <a href="https://github.com/mickeytgl">Miguel</a></em></p> 
         </div> 
        </div> 
       </div> 
      </div> 
     </div> 
     <div class="card mb-3"> 
      <div class="card-body"> 
       <h3>Discussion</h3> 
       <div id="disqus_thread"></div> 
       <noscript>
        Please enable JavaScript to view the 
        <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
       </noscript> 
       <script type="text/javascript">
    if(typeof DISQUS === "undefined"){
        var disqus_shortname = 'gorails'; // required: replace example with your forum shortname
        var disqus_identifier = document.title;
        var disqus_url = location.href.split("?")[0];

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    } else {
        DISQUS.reset({
          reload: true,
          config: function () {
            this.page.identifier = document.title;
            this.page.url = location.href.split("?")[0];
          }
        });
    }
</script> 
      </div> 
     </div> 
    </div> 
   </div> 
  </div> 
  <footer role="contentinfo"> 
   <div class="container mt-5"> 
    <div class="row"> 
     <div class="col-sm-3"> 
      <div>
       <a href="/"><img class="img-fluid hidden-xs" style="max-height:20px" src="/assets/logo-81edfa9191cc7ee9fc327380405e470c1b4908d777e92dea7366b5689cf6cebf.svg" alt="Logo"></a>
      </div> 
      <br class="hidden-xs"> 
      <div>
       <small><a href="http://excid3.com" target="_blank">© 2014-2017, GoRails, LLC.</a></small>
      </div> 
     </div> 
     <div class="col-sm-2 col-xs-4"> 
      <div>
       <strong>LEARN</strong>
      </div> 
      <div>
       <a href="/series">Series</a>
      </div> 
      <div>
       <a href="/episodes">Episodes</a>
      </div> 
      <div>
       <a href="/forum">Community</a>
      </div> 
      <div>
       <a href="/guides">Guides</a>
      </div> 
     </div> 
     <div class="col-sm-2 col-xs-4"> 
      <div>
       <strong>EXTRAS</strong>
      </div> 
      <div>
       <a target="blank" href="https://hatch.gorails.com">Deploy Rails</a>
      </div> 
      <div>
       <a href="/pricing">Pricing</a>
      </div> 
      <div>
       <a href="/testimonials">Testimonials</a>
      </div> 
      <div>
       <a href="/blog">Blog</a>
      </div> 
      <div>
       <a target="blank" href="https://courses.gorails.com/">Courses</a>
      </div> 
      <div>
       <a target="blank" href="http://gorails.storenvy.com/">T-Shirts</a>
      </div> 
     </div> 
     <div class="col-sm-2 col-xs-4"> 
      <div>
       <strong>ABOUT</strong>
      </div> 
      <div>
       <a target="blank" href="http://gorails.uservoice.com/forums/259979-general">Support</a>
      </div> 
      <div>
       <a href="/terms">Terms</a>
      </div> 
      <div>
       <a href="/privacy">Privacy</a>
      </div> 
      <div>
       <a href="/about">About Us</a>
      </div> 
      <div>
       <small class="text-muted">Icons by <a target="blank" href="https://icons8.com">Icons8</a></small>
      </div> 
     </div> 
     <div class="col-sm-3 col-xs-12"> 
      <br class="visible-xs"> 
      <data data-token="a70a851ae927fc575382bdad3e48c71f" class="mj-w-data" data-apikey="1ywk" data-w-id="2l5" data-lang="en_US" data-base="https://app.mailjet.com" data-width="640" data-height="374" data-statics="statics"></data> 
      <div data-token="a70a851ae927fc575382bdad3e48c71f" class="mj-w-btn" style="color: white; padding: 0 25px; background-color: #f0622b; text-align: center; vertical-align: middle; display: inline-block; border-radius: 3px;"> 
       <div style="display: table; height: 45px;"> 
        <div style="display: table-cell; vertical-align: middle;"> 
         <div style="font-family:Ubuntu, Helvetica; display: inline-block; text-align: center; font-size: 13px; vertical-align: middle;">
          <b>Join the newsletter</b>
         </div> 
        </div> 
       </div> 
      </div> 
      <hr class="hidden-xs"> 
      <a href="https://twitter.com/excid3" class="twitter-follow-button" data-link-color="#0069D6" data-show-count="true">Follow @excid3</a> 
      <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://gorails.com/" data-count="horizontal" data-via="excid3" data-related="excid3:Creator of GoRails">Tweet</a> 
     </div> 
    </div> 
   </div> 
  </footer> 
  <script>
  (function(i,s,o,g,r,a,m){i['ProfitWellObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);
  })(window,document,'script','https://dna8twue3dlxq.cloudfront.net/js/profitwell.js','profitwell');
  profitwell('auth_token', '631ab5d1fb3171ff43ec050548d320b7'); // Your unique Profitwell public API token
</script> 
  <script>
  // Include the UserVoice JavaScript SDK (only needed once on a page)
  UserVoice=window.UserVoice||[];(function(){var uv=document.createElement('script');uv.type='text/javascript';uv.async=true;uv.src='//widget.uservoice.com/hEIjIRxhpvMmrEEYGFi4A.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(uv,s)})();

  //
  // UserVoice Javascript SDK developer documentation:
  // https://www.uservoice.com/o/javascript-sdk
  //

  // Set colors
  UserVoice.push(['set', {
    accent_color: '#e23a39',
    trigger_color: 'white',
    trigger_background_color: 'rgba(46, 49, 51, 0.6)'
  }]);

  // Identify the user and pass traits
  // To enable, replace sample data with actual user traits and uncomment the line
  UserVoice.push(['identify', {
    email: "",
    name: "",
    id: "",
    //email:      'john.doe@example.com', // User’s email address
    //name:       'John Doe', // User’s real name
    //created_at: 1364406966, // Unix timestamp for the date the user signed up
    //id:         123, // Optional: Unique id of the user (if set, this should not change)
    //type:       'Owner', // Optional: segment your users by type
    //account: {
    //  id:           123, // Optional: associate multiple users with a single account
    //  name:         'Acme, Co.', // Account name
    //  created_at:   1364406966, // Unix timestamp for the date the account was created
    //  monthly_rate: 9.99, // Decimal; monthly rate of the account
    //  ltv:          1495.00, // Decimal; lifetime value of the account
    //  plan:         'Enhanced' // Plan name for the account
    //}
  }]);

  // Add default trigger to the bottom-right corner of the window:
  UserVoice.push(['addTrigger', { mode: 'smartvote', trigger_position: 'bottom-right' }]);

  // Or, use your own custom trigger:
  //UserVoice.push(['addTrigger', '#id', { mode: 'smartvote' }]);

  // Autoprompt for Satisfaction and SmartVote (only displayed under certain conditions)
  UserVoice.push(['autoprompt', {}]);
</script>   
 </body>
</html>