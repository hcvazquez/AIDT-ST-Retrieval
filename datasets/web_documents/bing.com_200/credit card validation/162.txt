<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
 <head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
  <link rel="shortcut icon" type="image/x-icon" href="/upload/images/Favicon2.png"> 
  <!--////////BEGIN Omniconvert.com///////--> 
  <link rel="dns-prefetch" href="//app.omniconvert.com"> 
  <script type="text/javascript" src="//cdn.omniconvert.com/js/z2fb9c3.js"></script> 
  <!-- /////// END Omniconvert.com /////// --> 
  <!-- /////// BEGIN Optimizely /////// --> 
  <script src="//cdn.optimizely.com/js/300327357.js"></script> 
  <!-- /////// END Optimizely /////// --> 
  <!-- Google Tag Manager --> 
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-P9H5CX');</script> 
  <!-- End Google Tag Manager --> 
  <link href="https://www.2checkout.com/?css=global_embeds/css_reset.v.1467225365" type="text/css" rel="stylesheet" media="screen"> 
  <link href="https://www.2checkout.com/?css=global_embeds/css_text.v.1488919457" type="text/css" rel="stylesheet" media="screen"> 
  <link href="https://www.2checkout.com/?css=global_embeds/css_forms.v.1502382036" type="text/css" rel="stylesheet" media="screen"> 
  <link href="https://www.2checkout.com/?css=global_embeds/css_blog.v.1495804864" type="text/css" rel="stylesheet" media="screen"> 
  <!--[if IE 8]>
<link href="https://www.2checkout.com/?css=global_embeds/css_IE8.v.1377788075" type="text/css" rel="stylesheet" media="screen" />
<![endif]--> 
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
  <title>API Best Practices, Part III: Using JavaScript Validation | 2Checkout Blog</title> 
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"> 
  <meta name="format-detection" content="telephone=no"> 
  <meta name="description" content=""> 
  <link href="https://plus.google.com/+2checkout" rel="publisher"> 
  <link rel="canonical" href="https://www.2checkout.com/blog/article/api-best-practices-part-iii-using-javascript-validation"> 
 </head> 
 <body id="article"> 
  <!-- Google Tag Manager (noscript) --> 
  <noscript>
   <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P9H5CX" height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript> 
  <!-- End Google Tag Manager (noscript) --> 
  <div id="wrapper"> 
   <!-- ////////////////////// WRAPPER BEGIN ////////////////////// --> 
   <!-- blog_header --> 
   <div id="header"> 
    <div class="container"> 
     <div id="header-logo"> 
      <a class="left" href="/"><img src="/upload/images/2Checkout_logo_black_85x85.png" alt="2Checkout Logo"></a> 
      <a class="left" href="/blog"><img src="/upload/images/logo_split_blog_85x85.png" alt="Blog Logo"></a> 
      <div class="clear"></div> 
     </div> 
     <button id="toggle"></button> 
     <button id="toggle-search"></button> 
     <div id="search-form" class="show"> 
      <form id="search" method="post" action="https://www.2checkout.com/"> 
       <div class="hiddenFields"> 
        <input type="hidden" name="ACT" value="1"> 
        <input type="hidden" name="RES" value="10"> 
        <input type="hidden" name="meta" value="YTo5OntzOjY6InN0YXR1cyI7czowOiIiO3M6NzoiY2hhbm5lbCI7czoxMjoiYmxvZ19lbnRyaWVzIjtzOjg6ImNhdGVnb3J5IjtzOjA6IiI7czo5OiJzZWFyY2hfaW4iO3M6NzoiZW50cmllcyI7czo1OiJ3aGVyZSI7czozOiJhbGwiO3M6MTI6InNob3dfZXhwaXJlZCI7czowOiIiO3M6MTk6InNob3dfZnV0dXJlX2VudHJpZXMiO2I6MDtzOjExOiJyZXN1bHRfcGFnZSI7czoxMzoiL2Jsb2cvcmVzdWx0cyI7czoxNToibm9fcmVzdWx0c19wYWdlIjtzOjE4OiIvYmxvZy9yZXN1bHRzLW5vbmUiO31kZTA0NDQxZTlhZGU5N2EzZGY1ODkwMjgyZjA5ZjYyMw=="> 
        <input type="hidden" name="site_id" value="1"> 
        <input type="hidden" name="csrf_token" value="e3507752e32e687f3ddf4bcda65d017f611a76d8"> 
       </div> 
       <input type="text" name="s" id="keywords" placeholder="Search the blog..."> 
       <div class="clear"></div> 
      </form> 
      <div class="clear"></div> 
      <a id="search-submit" class="btn-search"> 
       <!--                  <img src="/upload/images/search_icon_desktop.png" alt="2Checkout Logo"></img>   --> </a> 
      <div class="clear"></div> 
     </div> 
     <div id="categories"> 
      <div class="row"> 
       <div class="container"> 
        <ul id="nav_categories" class="blog_categories_list"> 
         <li> <a href="/blog/category/2checkout/81">2Checkout <span class="cat_count">62</span></a> </li> 
         <li> <a href="/blog/category/conversions-ux/71">Conversions &amp; UX <span class="cat_count">10</span></a> </li> 
         <li> <a href="/blog/category/international/51">International <span class="cat_count">10</span></a> </li> 
         <li> <a href="/blog/category/marketing/11">Marketing <span class="cat_count">19</span></a> </li> 
         <li> <a href="/blog/category/news-trends/31">News &amp; Trends <span class="cat_count">11</span></a> </li> 
         <li> <a href="/blog/category/technology/91">Technology <span class="cat_count">21</span></a> </li> 
        </ul> 
       </div> 
      </div> 
      <div class="clear"></div> 
     </div> 
     <div id="mobile-menu"> 
      <ul id="navigation_menu" class="hidden"> 
       <li> </li>
       <li class="menu-item"><a href="/blog/category/C81">2Checkout</a></li>  
       <li> </li>
       <li class="menu-item"><a href="/blog/category/C71">Conversions &amp; UX</a></li>  
       <li> </li>
       <li class="menu-item"><a href="/blog/category/C51">International</a></li>  
       <li> </li>
       <li class="menu-item"><a href="/blog/category/C11">Marketing</a></li>  
       <li> </li>
       <li class="menu-item"><a href="/blog/category/C31">News &amp; Trends</a></li>  
       <li> </li>
       <li class="menu-item"><a href="/blog/category/C91">Technology</a></li>  
      </ul> 
     </div> 
     <div class="clear"></div> 
    </div> 
   </div> 
   <!-- blog_header_close --> 
   <div id="content"> 
    <!-- ////////////////////// CONTENT BEGIN ////////////////////// --> 
    <div id="container"> 
     <!-- Entry BEGIN --> 
     <div id="entry" class="row"> 
      <div class="container"> 
       <div class="col span-12"> 
        <div class="entry-heading"> 
         <span class="date">March 14, 2014</span> 
         <h1 class="entry-title"><a href="/blog/article/api-best-practices-part-iii-using-javascript-validation">API Best Practices, Part III: Using JavaScript Validation</a></h1> 
         <span class="author">Posted by <a href="/blog/author/craig-christenson">Craig Christenson</a></span> 
         <a class="category" href="/blog/category/C91"><span><img src="/upload/images/category_icon_technology.png" class="cat-img" alt="Category Icon">Technology</span></a> 
         <div class="clear"></div> 
        </div> 
        <div class="entry-content"> 
         <p><strong>In this new blog series, 2Checkout explores the developments and features of its brand new Payment API, currently in BETA. To see the new 2Checkout Payment API BETA and use it as your new checkout, <a href="https://www.2checkout.com/payment-api">apply here</a>.</strong></p> 
         <p>In our last API best practices blog post, we explored some of the things we can do with HTML5 validation. In this post, we will walk you through the process of adding JavaScript validation to our Payment API form using a couple of different jQuery validation libraries.</p> 
         <h5 id="starting-point">A Good Starting Point</h5> 
         <p>To start out, lets take a look at our example form and JavaScript to integrate with the Payment API.</p> 
         <pre class="prettyprint">

          <form id="myCCForm" action="https://www.mysite.com/examplescript.php" method="post">
  
           <input id="sellerId" type="hidden" value="1817037">
  
           <input id="publishableKey" type="hidden" value="087F9356-39A3-4CEC-AAEE-0694E4B619EE">
  
           <input id="token" name="token" type="hidden" value="">
  
           <div> 
            <label> <span>Card Number</span> </label> 
            <input id="ccNo" type="text" size="20" value="" autocomplete="off" required> 
           </div>
  
           <div> 
            <label> <span>Expiration Date (MM/YYYY)</span> </label> 
            <input type="text" size="2" id="expMonth" required> 
            <span> / </span> 
            <input type="text" size="2" id="expYear" required> 
           </div>
  
           <div> 
            <label> <span>CVC</span> </label> 
            <input id="cvv" size="4" type="text" value="" autocomplete="off" required> 
           </div>
  
           <input type="submit" value="Submit Payment">

          </form>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script type="text/javascript" src="https://www.2checkout.com/checkout/api/script/publickey/1817037"></script>
<script type="text/javascript" src="https://www.2checkout.com/checkout/api/2co.min.js"></script>

<script>
  // Called when token created successfully.
  function successCallback(data) {
    var myForm = document.getElementById('myCCForm');
    myForm.token.value = data.response.token.token;
    myForm.submit();
  }

  // Called when token creation fails.
  function errorCallback(data) {
    if (data.errorCode === 200) {
      TCO.requestToken(successCallback,
        errorCallback, 'myCCForm');
    } else {
      alert(data.errorMsg);
    }
  }

  $(function() {
    $("#myCCForm").submit(function(e){
      e.preventDefault();
      TCO.requestToken(successCallback, errorCallback, 'myCCForm');
    });
  });
</script>
</pre> 
         <p>As you can see from the code above, we are not validating any of the fields on this form before making the token request. The Payment API will perform it’s own validation and return an error if data is missing or in an incorrect format. Rather than blindly alerting an error message, let’s look at how we can utilize JavaScript validation libraries to provide the user with some real-time feedback, as well as format the data correctly before making the payment API token request.</p> 
         <hr>
         <h5>Validation with Parsley.js</h5>
         <p><a href="http://parsleyjs.org/">Parsley.js</a> is a <a href="http://jquery.com/">jQuery</a> plugin that allows you to add JavaScript validation to your form fields by simply adding custom data attributes to the input elements. On our Payment API form, we want to insure that all required fields have been filled in and are in the correct format. With Parsley.js, this is as easy as adding the appropriate ‘data-attributes’ to the elements we want to validate.</p> 
         <p>First, let’s <a href="http://parsleyjs.org/doc/download.html">download the Parsley JavaScript library</a> and pull it in after our jQuery reference.</p> 
         <pre class="prettyprint">
<script src="parsley.min.js"></script>
</pre> 
         <p>Next, tell Parsley that we want to validate our form by adding the `data-parsley-validate` attribute to the form element.</p> 
         <pre class="prettyprint">

          <form id="myCCForm" action="https://www.mysite.com/examplescript.php" method="post" data-parsley-validate">

          </form></pre> 
         <p>At this point, we can also create a container to display validation errors to the user and instruct Parsley to utilize it by adding the `data-parsley-errors-container,` specifying the element ID for our container. For this example, let’s add the error container directly above the form element and specify the container’s ID as the value for the `data-parsley-errors-container` attribute. This will insure that the error messages are listed in our new container instead of below each form field.</p> 
         <pre class="prettyprint">

          <div id="infoArea"></div>

</pre> 
         <p>We should also add some CSS in the `head` of the document to hide the error container and highlight the errors and error fields in red.</p> 
         <pre class="prettyprint">
    <style type="text/css">
      input.parsley-success,
      select.parsley-success,
      textarea.parsley-success {
        color: #468847;
        background-color: #DFF0D8;
        border: 1px solid #D6E9C6;
      }

      input.parsley-error,
      select.parsley-error,
      textarea.parsley-error {
        color: #B94A48;
        background-color: #F2DEDE;
        border: 1px solid #EED3D7;
      }

      .parsley-errors-list {
        margin: 2px 0 3px 0;
        padding: 0;
        list-style-type: none;
        font-size: 0.9em;
        line-height: 0.9em;
        opacity: 0;
        -moz-opacity: 0;
        -webkit-opacity: 0;

        transition: all .3s ease-in;
        -o-transition: all .3s ease-in;
        -ms-transition: all .3s ease-in-;
        -moz-transition: all .3s ease-in;
        -webkit-transition: all .3s ease-in;
      }

      .parsley-errors-list.filled {
        opacity: 1;
      }

      #infoArea {
        color: #B94A48;
        display: none;
      }
    </style>
</pre> 
         <p>Now we can add our `parsley-data` attributes to each field to specify our validation rules. These attributes allow you to specify the rule(s) that the field value must conform to. For each of our fields, we want to insure that the value is not empty, only contains numbers and that the length of the value is correct. We show how we can modify our fields to include these additional Parsley attributes below.</p> 
         <pre class="prettyprint">

          <!-- Card Number -->
<input id="ccNo" type="text" size="20" value="" autocomplete="off" data-parsley-type="digits" data-parsley-length="[13, 16]" data-parsley-error-message="Credit Card Number is Required" data-parsley-required>


          <!-- Expiration 2 Digit Month -->
<input type="text" size="2" id="expMonth" value="" data-parsley-type="digits" data-parsley-length="[2, 2]" data-parsley-error-message="Expiration Month is Required" data-parsley-required>


          <!-- Expiration 2 or 4 Digit Year -->
<input type="text" size="2" id="expYear" value="" data-parsley-type="digits" data-parsley-length="[2, 4]" data-parsley-error-message="Expiration Year is Required" data-parsley-required>


          <!-- 3-4 digit CVC Code -->
<input id="cvv" size="4" type="text" value="" autocomplete="off" data-parsley-type="digits" data-parsley-length="[3, 4]" data-parsley-error-message="CVC Code is Required" data-parsley-required>
</pre> 
         <p>Here we specified the `data-parsley-type` as “digits” to insure that only numbers were entered. We added the `data-parsley-length` attribute to specify the minimum and maximum length. We added `data-parsley-required` to indicate that each field cannot be empty. We also used the `data-parsley-error-message` to override the default error message and provide our own custom error message for each field.</p> 
         <p>Now all we need to do is check against the `parsley.validate()` function to determine if the fields are valid.</p> 
         <pre class="prettyprint">
$('#myCCForm').submit(function(e){
  e.preventDefault();

  if ( !$('#myCCForm').parsley().validate()) {
    $('#infoArea').show();
  } else {
    $('#infoArea').hide();
    TCO.requestToken(successCallback, errorCallback, 'myCCForm');
  }
});
</pre> 
         <p>We can now test our new validation rules to insure that they are working properly.</p> 
         <p><img alt="Field Errors" src="/upload/images/parsley-1.png"></p> 
         <p>Since the validation has been triggered, Parsley will automatically validate as we correct the data.</p> 
         <p><img alt="Field Corrections" src="/upload/images/parsley-2.png"></p> 
         <p>To finish up the example, let’s safeguard the credit card input validation from other potential errors. The user might enter spaces or dashes with his or her card number, so we should strip out any non-numeric characters before we validate.</p> 
         <pre class="prettyprint">
$('#ccNo').val($('#ccNo').val().replace(/[^0-9\.]+/g,''));
</pre>
         <strong>Complete Example</strong>
         <pre class="prettyprint">

  
    <style type="text/css">
      input.parsley-success,
      select.parsley-success,
      textarea.parsley-success {
        color: #468847;
        background-color: #DFF0D8;
        border: 1px solid #D6E9C6;
      }

      input.parsley-error,
      select.parsley-error,
      textarea.parsley-error {
        color: #B94A48;
        background-color: #F2DEDE;
        border: 1px solid #EED3D7;
      }

      .parsley-errors-list {
        margin: 2px 0 3px 0;
        padding: 0;
        list-style-type: none;
        font-size: 0.9em;
        line-height: 0.9em;
        opacity: 0;
        -moz-opacity: 0;
        -webkit-opacity: 0;

        transition: all .3s ease-in;
        -o-transition: all .3s ease-in;
        -ms-transition: all .3s ease-in-;
        -moz-transition: all .3s ease-in;
        -webkit-transition: all .3s ease-in;
      }

      .parsley-errors-list.filled {
        opacity: 1;
      }

      #infoArea {
        color: #B94A48;
        display: none;
      }
    </style>
  
  
    
          <div id="infoArea"></div>
    
      <input id="sellerId" type="hidden" value="1817037">
      <input id="publishableKey" type="hidden" value="087F9356-39A3-4CEC-AAEE-0694E4B619EE">
      <input id="token" name="token" type="hidden" value="">
      
          <div>
        
           <label> <span>Card Number</span> <input id="ccNo" type="text" size="20" value="" autocomplete="off" data-parsley-type="digits" data-parsley-length="[13, 16]" data-parsley-error-message="Credit Card Number is Required" data-parsley-required> </label>
      
          </div>
      
          <div>
        
           <label> <span>Expiration Date (MM/YYYY)</span> <input type="text" size="2" id="expMonth" value="" data-parsley-type="digits" data-parsley-length="[2, 2]" data-parsley-error-message="Expiration Month is Required" data-parsley-required> </label>
        
           <span> / </span>
        
           <input type="text" size="2" id="expYear" value="" data-parsley-type="digits" data-parsley-length="[2, 4]" data-parsley-error-message="Expiration Year is Required" data-parsley-required>
      
          </div>
      
          <div>
        
           <label> <span>CVC</span> <input id="cvv" size="4" type="text" value="" autocomplete="off" data-parsley-type="digits" data-parsley-length="[3, 4]" data-parsley-error-message="CVC Code is Required" data-parsley-required> </label>
      
          </div>
      <input type="submit" value="Submit Payment">
    

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<p>    </p><script src="parsley.js"></script>
<p>    </p><script type="text/javascript" src="https://www.2checkout.com/checkout/api/script/publickey/1817037"></script>
<p>    </p><script type="text/javascript" src="https://www.2checkout.com/checkout/api/2co.min.js"></script>
<p>    <br>
    </p><script>

      // Called when token created successfully.
      function successCallback(data) {
        var myForm = document.getElementById('myCCForm');
        myForm.token.value = data.response.token.token;
        myForm.submit();
      }

      // Called when token creation fails.
      function errorCallback(data) {
        if (data.errorCode === 200) {
          TCO.requestToken(successCallback, errorCallback, 'myCCForm');  // Resubmit if the ajax request fails
        } else {
          alert(data.errorMsg);
        }
      }

      $('#myCCForm').submit(function(e){
        e.preventDefault();
        // Strip non-numeric characters from credit card
        $('#ccNo').val($('#ccNo').val().replace(/[^0-9.]+/g,''));

        if ( !$('#myCCForm').parsley().validate()) {
          $('#infoArea').show();
        } else {
          $('#infoArea').hide();
          TCO.requestToken(successCallback, errorCallback, 'myCCForm');
        }
      });

    </script>
<p>  </p>


</pre>
         <hr>
         <h5>Validation and Formatting with Formance.js</h5>
         <p><a href="http://omarshammas.github.io/formancejs">Formance.js</a> is a form validation library that started off as a fork of the popular jQuery.payment library. Because of it’s roots, Formance.js specializes in validating and formatting payment fields to insure that the user can only enter data in the correct format for the card number, CVC, and expiration date.</p> 
         <p>Using the <a href="#starting-point">example from the beginning of the article</a>, let’s <a href="https://github.com/omarshammas/jquery.formance">download the Formance JavaScript library</a> and pull it in after our jQuery reference.</p> 
         <pre class="prettyprint">
<script src="jquery.formance.min.js"></script>
</pre> 
         <p>Now to integrate our payment form with Formance.js, we’ll set up the formatting when the document loads and run our validation on the submit event.</p> 
         <p>Formance requires the expiration month and year to be entered on the same field. Let’s start out by modifying our original payment form example from the beginning of this post to take the expiration month and year on a new ‘expDate’ input field. Since the Payment API is expecting this data in separate fields, we will keep hidden input fields for the ‘expMonth’ and ‘expYear’.</p> 
         <pre class="prettyprint">

          <form id="myCCForm" action="https://www.mysite.com/examplescript.php" method="post">
  
           <input id="sellerId" type="hidden" value="1817037">
  
           <input id="publishableKey" type="hidden" value="087F9356-39A3-4CEC-AAEE-0694E4B619EE">
  
           <input id="token" name="token" type="hidden" value="">
  
           <div> 
            <label> <span>Card Number</span> <input id="ccNo" type="text" size="20" value="" autocomplete="off"> </label> 
           </div>
  
           <div> 
            <label> <span>Expiration Date (MM/YYYY)</span> <input type="text" id="expDate"> </label> 
            <input type="hidden" id="expMonth"> 
            <input type="hidden" id="expYear"> 
           </div>
  
           <div> 
            <label> <span>CVC</span> <input id="cvv" type="text" value="" autocomplete="off"> </label> 
           </div>
  
           <input type="submit" value="Submit Payment">

          </form>
</pre> 
         <p>And let’s add some JavaScript to our form’s `submit` function to populate our ‘expMonth’ and ‘expYear’ from the data entered in our new ‘expDate’ input field.</p> 
         <pre class="prettyprint">
$('#myCCForm').submit(function(e){
    e.preventDefault();

    var expiration = $('#expDate').val().replace(/ /g,'').split("/");
    $('#expMonth').val(expiration[0]);
    $('#expYear').val(expiration[1]);

    TCO.requestToken(successCallback, errorCallback, 'myCCForm');
});
</pre> 
         <p>Now we can set up the Formance.js formatting on our input fields when the document loads. This will utilize the formatters provided by the library to restrict the input fields to the allowed characters and length for each field type. This also improves the user experience by adding separators for the credit card and expiration date as they are being entered.</p> 
         <pre class="prettyprint">
$(function($) {
    $("#ccNo").formance("format_credit_card_number");
    $("#expDate").formance("format_credit_card_expiry");
    $("#cvv").formance("format_credit_card_cvc");

    $('#myCCForm').submit(function(e){
      e.preventDefault();

      var expiration = $('#expDate').val().replace(/ /g,'').split("/");
      $('#expMonth').val(expiration[0]);
      $('#expYear').val(expiration[1]);

      TCO.requestToken(successCallback, errorCallback, 'myCCForm');
    });
});
</pre> 
         <p>The credit card formatter will add a space after every 4 digits entered, so we will need to strip those before we make our token request.</p> 
         <pre class="prettyprint">
$('#ccNo').val($('#ccNo').val().replace(/ /g,''));
</pre> 
         <p>Next, let’s disable the submit button when the document loads and utilize the Formance.js validation for each field type to check the validation for each field and enable the submit if the field is valid.</p> 
         <pre class="prettyprint">
$(function($) {
    $("input[type='submit']").prop("disabled", true);

    $("#ccNo").formance("format_credit_card_number");
    $("#expDate").formance("format_credit_card_expiry");
    $("#cvv").formance("format_credit_card_cvc");

    $("#ccNo").formance("format_credit_card_number").on( 'keyup, blur', function (event) {
        if ( $(this).formance('validate_credit_card_number') ) {
            $(this).removeClass('invalid');
            $("input[type='submit']").prop("disabled", false);
        } else {
            $(this).addClass('invalid');
            $("input[type='submit']").prop("disabled", true);
        }
    });

    $("#expDate").formance("format_credit_card_expiry").on( 'keyup, blur', function (event) {
        if ( $(this).formance('validate_credit_card_expiry') ) {
            $(this).removeClass('invalid');
            $("input[type='submit']").prop("disabled", false);
        } else {
            $(this).addClass('invalid');
            $("input[type='submit']").prop("disabled", true);
        }
    });

    $("#cvv").formance("format_credit_card_cvc").on( 'keyup, blur', function (event) {
        if ( $(this).formance('validate_credit_card_cvc') ) {
            $(this).removeClass('invalid');
            $("input[type='submit']").prop("disabled", false);
        } else {
            $(this).addClass('invalid');
            $("input[type='submit']").prop("disabled", true);
        }
    });

    $('#myCCForm').submit(function(e){
        e.preventDefault();

        var expiration = $('#expDate').val().replace(/ /g,'').split("/");
        $('#expMonth').val(expiration[0]);
        $('#expYear').val(expiration[1]);

        $('#ccNo').val($('#ccNo').val().replace(/ /g,''));
        TCO.requestToken(successCallback, errorCallback, 'myCCForm');
    });

});
</pre> 
         <p>If the validation fails on a field, Formance.js will add the ‘invalid’ class to the field. So for our example, let’s add some styling in the `head` of the document to highlight the invalid fields in red.</p> 
         <pre class="prettyprint">
<style type="text/css">
    .invalid {
      color: #B94A48;
      background-color: #F2DEDE;
      border: 1px solid #EED3D7;
    }
</style>
</pre> 
         <p>To finish up our validation, we need to ensure that we only make the token request in cases where all of the form fields are valid. We can accomplish this by altering our form’s `submit` function to check the input elements for the ‘invalid’ class and only make the request is if it is not present.</p> 
         <pre class="prettyprint">
$('#myCCForm').submit(function(e){
    e.preventDefault();

    if ( $('input.invalid').length ) {
      alert('Please correct the fields in red.');
    } else {
      var expiration = $('#expDate').val().replace(/ /g,'').split("/");
      $('#expMonth').val(expiration[0]);
      $('#expYear').val(expiration[1]);

      $('#ccNo').val($('#ccNo').val().replace(/ /g,''));
      TCO.requestToken(successCallback, errorCallback, 'myCCForm');
    }
});
</pre> 
         <p>We can now test our validation to guarantee that any invalid fields will show up in red and the submit button is locked down until they are corrected.</p> 
         <p><img alt="Field Errors" src="/upload/images/formance-1.png"><strong>Complete Example</strong></p>
         <pre class="prettyprint">



  <style type="text/css">
      .invalid {
        color: #B94A48;
        background-color: #F2DEDE;
        border: 1px solid #EED3D7;
      }
  </style>


    
          <form id="myCCForm" action="https://www.mysite.com/examplescript.php" method="post">
      
           <input id="sellerId" type="hidden" value="1817037">
      
           <input id="publishableKey" type="hidden" value="087F9356-39A3-4CEC-AAEE-0694E4B619EE">
      
           <input id="token" name="token" type="hidden" value="">
      
           <div> 
            <label> <span>Card Number</span> <input id="ccNo" type="text" size="20" value="" autocomplete="off"> </label> 
           </div>
      
           <div> 
            <label> <span>Expiration Date (MM/YYYY)</span> <input type="text" id="expDate"> </label> 
            <input type="hidden" id="expMonth"> 
            <input type="hidden" id="expYear"> 
           </div>
      
           <div> 
            <label> <span>CVC</span> <input id="cvv" type="text" value="" autocomplete="off"> </label> 
           </div>
      
           <input type="submit" value="Submit Payment">
    
          </form>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<p>    </p><script src="jquery.formance.min.js"></script>
<p>    </p><script type="text/javascript" src="https://www.2checkout.com/checkout/api/script/publickey/1817037"></script>
<p>    </p><script type="text/javascript" src="https://www.2checkout.com/checkout/api/2co.min.js"></script>

<p>    </p><script>

        // Called when token created successfully.
        function successCallback(data) {
          var myForm = document.getElementById('myCCForm');
          myForm.token.value = data.response.token.token;
          myForm.submit();
        }

        // Called when token creation fails.
        function errorCallback(data) {
          if (data.errorCode === 200) {
            TCO.requestToken(successCallback, errorCallback, 'myCCForm');  // Resubmit if the ajax request fails
          } else {
            alert(data.errorMsg);
          }
        }

        $(function($) {
            $("input[type='submit']").prop("disabled", true);

            $("#ccNo").formance("format_credit_card_number");
            $("#expDate").formance("format_credit_card_expiry");
            $("#cvv").formance("format_credit_card_cvc");

            $("#ccNo").formance("format_credit_card_number").on( 'change', function (event) {
                if ( $(this).formance('validate_credit_card_number') ) {
                    $(this).removeClass('invalid');
                    $("input[type='submit']").prop("disabled", false);
                } else {
                    $(this).addClass('invalid');
                    $("input[type='submit']").prop("disabled", true);
                }
            });

            $("#expDate").formance("format_credit_card_expiry").on( 'change', function (event) {
                if ( $(this).formance('validate_credit_card_expiry') ) {
                    $(this).removeClass('invalid');
                    $("input[type='submit']").prop("disabled", false);
                } else {
                    $(this).addClass('invalid');
                    $("input[type='submit']").prop("disabled", true);
                }
            });

            $("#cvv").formance("format_credit_card_cvc").on( 'change', function (event) {
                if ( $(this).formance('validate_credit_card_cvc') ) {
                    $(this).removeClass('invalid');
                    $("input[type='submit']").prop("disabled", false);
                } else {
                    $(this).addClass('invalid');
                    $("input[type='submit']").prop("disabled", true);
                }
            });

            $('#myCCForm').submit(function(e){
                e.preventDefault();

                if ( $('input.invalid').length ) {
                  alert('Please correct the fields in red.');
                } else {
                  var expiration = $('#expDate').val().replace(/ /g,'').split("/");
                  $('#expMonth').val(expiration[0]);
                  $('#expYear').val(expiration[1]);

                  $('#ccNo').val($('#ccNo').val().replace(/ /g,''));
                  TCO.requestToken(successCallback, errorCallback, 'myCCForm');
                }
            });

        });

    </script>


</pre> 
         <p>As this series continues, we will explore some best practices for making the Sale Authorization call server side. Come back to the 2Checkout Blog for more information on how to optimize your Payment API integration as well as read the latest tutorials on all things e-commerce.</p> 
        </div> 
       </div> 
       <div class="clear"></div> 
      </div> 
     </div> 
     <!-- Entry END --> 
     <!-- Related Material BEGIN --> 
     <!-- Related Material END--> 
     <!-- AddThis Share BEGIN --> 
     <div class="row"> 
      <div class="container"> 
       <div id="article-share" class="col span-12"> 
        <div class="addthis_toolbox addthis_counter_style"> 
         <a class="addthis_counter"></a> 
         <a class="addthis_button_facebook_like" fb:like:layout="box_count"></a> 
         <a class="addthis_button_tweet" tw:count="vertical"></a> 
         <a class="addthis_button_linkedin_counter" li:counter="top"></a> 
         <a class="addthis_button_google_plusone" g:plusone:size="tall"></a> 
        </div> 
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5260206a082044a2"></script> 
       </div> 
       <div class="clear"></div> 
      </div> 
     </div> 
     <!-- AddThis Share END --> 
     <!-- Related Articles BEGIN --> 
     <div id="related-articles" class="row"> 
      <div class="container"> 
       <div class="col span-12">
        <h5>Related Articles</h5>
       </div> 
       <div class="col span-4"> 
        <span class="post-image"> <img class="generic" src="/upload/images/icon_blog-post.png" alt="Blog Post Icon"> </span> 
        <h4><a href="/blog/article/api-best-practices-ajax">API Best Practices Part I: AJAX</a></h4> 
       </div>
       <div class="col span-4"> 
        <span class="post-image"> <img class="generic" src="/upload/images/icon_blog-post.png" alt="Blog Post Icon"> </span> 
        <h4><a href="/blog/article/api-best-practices-part-ii-using-html5-field-validation">API Best Practices, Part II: Using HTML5 Field Validation</a></h4> 
       </div> 
       <div class="clear"></div> 
      </div> 
     </div> 
     <!-- Related Articles END --> 
     <!-- DISQUS BEGIN --> 
     <div class="row"> 
      <div class="container"> 
       <div class="col span-12"> 
        <div id="disqus_thread"></div> 
        <script type="text/javascript">
                                              var disqus_shortname = '2co';
                                          
                                              (function() {
                                                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                                                  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                                                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                                              })();
                                          </script> 
       </div> 
       <div class="clear"></div> 
      </div> 
     </div> 
     <!-- DISQUS END --> 
     <!-- Pagination BEGIN --> 
     <!-- Pagination END --> 
     <!-- Footer BEGIN --> 
     <div class="row"> 
      <div class="col span-12"> 
       <div id="footer"> 
        <p id="copyright">© 2003-<script type="text/javascript">var year = new Date();document.write(year.getFullYear());</script> 2Checkout.com, Inc. All rights reserved.</p> 
       </div> 
      </div> 
      <div class="clear"></div> 
     </div> 
     <!-- Footer END --> 
    </div> 
   </div> 
   <!-- ////////////////////// CONTENT END ////////////////////// --> 
   <div id="sidebar"> 
    <!-- ////////////////////// SIDEBAR BEGIN ////////////////////// --> 
    <!-- Subscribe BEGIN --> 
    <div id="subscribe"> 
     <form method="post" action="https://s686229964.t.eloqua.com/e/f2"> 
      <input type="submit" value="Subscribe" class="btn orange subscribe-button"> 
      <input value="UntitledForm-1381341601455" type="hidden" name="elqFormName"> 
      <input value="686229964" type="hidden" name="elqSiteId"> 
      <input name="elqCampaignId" type="hidden"> 
      <input id="field0" name="emailAddress" type="text" value="" placeholder="Your Email" required> 
      <input id="field1" type="hidden" name="u" value="10689b98ec0f45272964a6c83"> 
      <input id="field2" type="hidden" name="id" value="ed38c326f7"> 
      <input id="field4" type="hidden" name="C_Mailchimp_Subscribed1" value="1"> 
      <input type="hidden" name="retURL" id="elqRetValSignup" value="https://www.2checkout.com/blog"> 
     </form> 
     <div class="clear"></div> 
    </div> 
    <!-- Subscribe END --> 
    <div class="footer-col"> 
     <!-- About Author BEGIN --> 
     <div id="single-author"> 
      <div class="container"> 
       <div class="row"> 
        <h2>About The Author</h2> 
        <img src="/upload/images/craig_blog.jpg"> 
        <div class="clear"></div> 
        <h3><a href="/blog/author/craig-christenson/">Craig Christenson</a></h3> 
        <p>?Craig is a developer, marketer and advocate for 2Checkout’s developer community. When he is not working on adding or improving 2Checkout features, he hacks on open source software and lends a... </p>
       </div> 
      </div> 
      <div class="clear"></div> 
     </div> 
     <!-- About Author END --> 
    </div> 
    <div class="footer-col"> 
     <!-- More From Author BEGIN --> 
     <div id="sidebar-author-more"> 
      <div class="container"> 
       <div class="row"> 
        <h2>More by Craig Christenson</h2> 
       </div> 
      </div> 
      <div class="clear"></div> 
     </div> 
     <!-- More From Author END --> 
    </div> 
    <div class="footer-col"> 
     <!-- Sign Up Begin --> 
     <div id="sidebar-signup" class="container"> 
      <div class="row align-center"> 
       <p>Are you ready to start selling?</p> 
       <a href="/signup">Sign up today!</a> 
       <div class="clear"></div> 
      </div> 
     </div> 
     <!-- Sign Up END --> 
     <!-- Company Menu BEGIN --> 
     <div id="sidebar-company" class="container"> 
      <div class="row"> 
       <h2>Company</h2> 
       <ul id="site-nav" class="group"> 
        <li><a href="https://www.2checkout.com/">Home</a></li> 
        <li><a href="https://www.2checkout.com/about">About</a></li> 
        <li><a href="https://www.2checkout.com/careers">Careers</a></li> 
        <li><a href="https://www.2checkout.com/online-payment-processing">Payment Processing</a></li> 
        <li><a href="https://www.2checkout.com/contact">Contact</a></li> 
       </ul> 
      </div> 
     </div> 
     <!-- Company Menu END --> 
    </div> 
    <div class="clear"></div> 
    <p id="copyright">© 2003-<script type="text/javascript">var year = new Date();document.write(year.getFullYear());</script> 2Checkout.com, Inc. All rights reserved.</p> 
   </div> 
   <!-- ////////////////////// SIDEBAR END ////////////////////// --> 
  </div> 
  <!-- ////////////////////// WRAPPER END ////////////////////// --> 
  <div id="footer-bar"> 
   <!-- ////////////////////// FOOTER-BAR BEGIN ////////////////////// --> 
   <h4>Share the love...</h4> 
   <div id="subscribe"> 
    <form method="post" action="https://s686229964.t.eloqua.com/e/f2"> 
     <input type="submit" value="Subscribe" class="btn orange subscribe-button"> 
     <input value="UntitledForm-1381341601455" type="hidden" name="elqFormName"> 
     <input value="686229964" type="hidden" name="elqSiteId"> 
     <input name="elqCampaignId" type="hidden"> 
     <input id="field0" name="emailAddress" type="text" value="" placeholder="Your Email" required> 
     <input id="field1" type="hidden" name="u" value="10689b98ec0f45272964a6c83"> 
     <input id="field2" type="hidden" name="id" value="ed38c326f7"> 
     <input id="field4" type="hidden" name="C_Mailchimp_Subscribed1" value="1"> 
     <input type="hidden" name="retURL" id="elqRetValSignup" value="https://www.2checkout.com/blog"> 
    </form> 
    <div class="clear"></div> 
   </div> 
  </div> 
  <!-- ////////////////////// FOOTER-BAR END ////////////////////// --> 
  <!-- ////////////////////// POPUP BEGIN ////////////////////// --> 
  <div class="overlay"></div> 
  <div class="popup-wrapper"> 
   <div id="subscribe-popup" class="popup"> 
    <div class="popup-header"> 
     <span><strong>Subscribe</strong></span> 
     <div class="close"></div> 
    </div> 
    <p class="large">Subscribe to our blog and get the latest articles in your mailbox!</p> 
    <form method="post" action="https://s686229964.t.eloqua.com/e/f2"> 
     <input value="UntitledForm-1381341601455" type="hidden" name="elqFormName"> 
     <input value="686229964" type="hidden" name="elqSiteId"> 
     <input name="elqCampaignId" type="hidden"> 
     <input id="field0" name="emailAddress" type="text" value="" placeholder="Your Email" required> 
     <input id="field1" type="hidden" name="u" value="10689b98ec0f45272964a6c83"> 
     <input id="field2" type="hidden" name="id" value="ed38c326f7"> 
     <input type="hidden" name="retURL" id="elqRetValSignup" value="https://www.2checkout.com/blog"> 
     <input type="submit" value="Subscribe" class="btn orange subscribe-button"> 
    </form> 
    <div class="clear"></div> 
   </div> 
  </div> 
  <!-- ////////////////////// POPUP END////////////////////// --> 
  <!-- AddThis Smart Layers BEGIN --> 
  <!-- Go to http://www.addthis.com/get/smart-layers to customize --> 
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5260206a082044a2"></script> 
  <script type="text/javascript">
      addthis.layers({
            'theme' : 'light',
            'share' : {
                  'position' : 'left',
                  'numPreferredServices' : 6
            }, 
            'follow' : {
                  'services' : [
                       {'service': 'facebook', 'id': '2Checkout.2CO'},
                       {'service': 'twitter', 'id': '2checkout'},
                       {'service': 'google_follow', 'id': '+2checkout'},
                       {'service': 'linkedin', 'id': '2checkout-com', 'usertype': 'company'},
                       {'service': 'rss', 'id': 'http://www.2checkout.com/blog/feed/rss'}
                  ]
            },  
            'whatsnext' : {},  
            'recommended' : {}});
</script> 
  <!-- AddThis Smart Layers END --> 
  <script type="text/javascript">
var addthis_config = addthis_config||{};
addthis_config.data_track_addressbar = false;
addthis_config.data_track_clickback = false;
</script> 
  <div id="footer"> 
   <p id="copyright">© 2003-<script type="text/javascript">var year = new Date();document.write(year.getFullYear());</script> 2Checkout.com, Inc. All rights reserved.</p> 
  </div> 
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script> 
  <script src="/global_embeds/jquery-cookie" type="text/javascript"></script> 
  <script src="/global_embeds/js_blog" type="text/javascript"></script> 
  <script src="/global_embeds/jquery-cookie" type="text/javascript"></script> 
  <script src="/global_embeds/parse_url" type="text/javascript"></script> 
  <script src="/global_embeds/adwords_cookie" type="text/javascript"></script> 
  <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script> 
  <script src="/global_embeds/js_cookie" type="text/javascript"></script> 
  <!-- Hiding This Section for Now
<div id="liveagent_button_online_573F00000008OIF" style="display:none;" onclick="liveagent.startChat('573F00000008OIF')" class="live_chat_btn"></div>
<div id="liveagent_button_online_573F00000008OSV" style="display:none;" onclick="liveagent.startChat('573F00000008OSV')" class="live_chat_btn"></div>
<div id="liveagent_button_online_573F00000008OYP" style="display:none;" onclick="liveagent.startChat('573F00000008OYP')" class="live_chat_btn" ></div>
<!-- /////// BEGIN Live Chat /////// --> 
  <script src="https://c.la1w1.salesforceliveagent.com/content/g/deployment.js" type="text/javascript"></script> 
  <script src="/global_embeds/live_chat_js" type="text/javascript"></script> 
  <!-- /////// END Live Chat /////// --> 
  <script type="text/javascript">
var s = true;
var i = false;
var a = false;

addButton(s,i,a);
</script>--&gt;  
 </body>
</html>