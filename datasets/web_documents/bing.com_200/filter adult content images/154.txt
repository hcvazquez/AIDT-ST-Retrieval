<html>
 <head> 
  <title>JSP Example: Dynamic HTML Form - Table Editor</title> 
  <meta NAME="description" CONTENT="An HTML form generated dynamically by a JSP allows you to modify a table stored as an XML document. You may add / delete rows and modify the cell values."> 
  <link REL="stylesheet" HREF="/style.css" TYPE="text/css"> 
  <script src="/util.js" type="text/javascript">
</script> 
 </head> 
 <body> 
  <table width="100%" border="0" cellspacing="0" cellpadding="0"> 
   <tbody>
    <tr> 
     <td width="1%" align="LEFT" valign="BOTTOM"> <a href="/"><img BORDER="0" WIDTH="204" HEIGHT="42" SRC="/images/devsphere.gif"></a> </td> 
     <td width="*" colspan="2" align="RIGHT" valign="BOTTOM"> <a href="/"><img BORDER="0" WIDTH="523" HEIGHT="42" SRC="/images/s4.gif"></a> </td> 
    </tr> 
    <tr> 
     <td class="BarMenu" width="20%" align="LEFT" valign="MIDDLE"> 
      <table class="BarMenu" border="0" cellpadding="0" cellspacing="0"> 
       <tbody>
        <tr class="BarMenu"> 
         <td class="BarMenuItem" nowrap> <a href="/company/index.html" class="BarMenuItem"> 
           <div class="BarItem">
             About us 
           </div> </a> </td> 
         <td class="BarMenuItem" nowrap> <a href="/company/contact.html" class="BarMenuItem"> 
           <div class="BarItem">
             Contact us 
           </div> </a> </td> 
        </tr> 
       </tbody>
      </table> </td> 
     <td class="BarMenu" width="60%" align="CENTER" valign="MIDDLE"> 
      <table class="BarMenu" border="0" cellpadding="0" cellspacing="0"> 
       <tbody>
        <tr class="BarMenu"> 
         <td class="BarMenuItem" nowrap> <a href="/products/index.html" class="BarMenuItem"> 
           <div class="BarItem">
             Products 
           </div> </a> </td> 
         <td class="BarMenuItem" nowrap> <a href="/services/index.html" class="BarMenuItem"> 
           <div class="BarItem">
             Services 
           </div> </a> </td> 
         <td class="BarMenuItem" nowrap> <a href="/articles/index.html" class="BarMenuItem"> 
           <div class="BarItem">
             Articles 
           </div> </a> </td> 
        </tr> 
       </tbody>
      </table> </td> 
     <td class="BarMenu" width="20%" align="RIGHT" valign="MIDDLE"> <a href="http://twitter.com/devsphere" class="BarMenuItem"><img BORDER="0" WIDTH="16" HEIGHT="16" SRC="/images/twitter-icon.gif">&nbsp;Twitter</a>&nbsp;&nbsp;&nbsp; <a href="http://www.addthis.com/bookmark.php" onclick="return addthis_click(this);" target="_blank"><img SRC="/images/button1-share.gif" WIDTH="125" HEIGHT="16" BORDER="0" ALT="Bookmark and Share"></a> </td> 
    </tr> 
    <tr> 
     <td colspan="3"> 
      <table width="100%" border="0" cellspacing="0" cellpadding="0"> 
       <tbody>
        <tr class="TopBorder"> 
         <td class="TopBorder"> 
          <table width="100%" border="0" cellspacing="1" cellpadding="5"> 
           <tbody>
            <tr class="TopMenu"> 
             <td class="TopMenu" width="34%" align="CENTER" valign="TOP"> 
              <table class="TopMenu" border="0" cellpadding="0" cellspacing="0"> 
               <tbody>
                <tr class="TopMenuTitle"> 
                 <td class="TopMenuTitle" nowrap> <a href="/services/design/index.html" class="TopMenuTitle"> 
                   <div class="MenuTitle">
                     USER INTERFACE DESIGN 
                   </div> </a> </td> 
                </tr> 
                <tr class="TopMenuItem"> 
                 <td class="TopMenuItem" nowrap> <a href="/services/design/ajax-java-web-dhtml-javascript-css-xml-dom-jsp-jsf-adf-faces-designers-developers.html" class="TopMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> Rich Web UIs with AJAX &amp; DHTML 
                   </div> </a> </td> 
                </tr> 
                <tr class="TopMenuItem"> 
                 <td class="TopMenuItem" nowrap> <a href="/services/design/eclipse-plugin-swt-jface-java-desktop-gui-windows-linux-mac-designers-developers.html" class="TopMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> Eclipse Plugins &amp; JFace/SWT UIs 
                   </div> </a> </td> 
                </tr> 
                <tr class="TopMenuItem"> 
                 <td class="TopMenuItem" nowrap> <a href="/services/design/java-desktop-swing-jfc-awt-swt-gui-windows-linux-mac-2d-3d-designers-developers.html" class="TopMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> Desktop GUIs Based on Swing 
                   </div> </a> </td> 
                </tr> 
               </tbody>
              </table> </td> 
             <td class="TopMenu" width="33%" align="CENTER" valign="TOP"> 
              <table class="TopMenu" border="0" cellpadding="0" cellspacing="0"> 
               <tbody>
                <tr class="TopMenuTitle"> 
                 <td class="TopMenuTitle" nowrap> <a href="/services/development/index.html" class="TopMenuTitle"> 
                   <div class="MenuTitle">
                     JAVA EE DEVELOPMENT 
                   </div> </a> </td> 
                </tr> 
                <tr class="TopMenuItem"> 
                 <td class="TopMenuItem" nowrap> <a href="/services/development/java-ee-j2ee-ejb3-ajax-jsp-jsf-adf-faces-struts-spring-hibernate-seam-developers.html" class="TopMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> Using Standards &amp; Open Source 
                   </div> </a> </td> 
                </tr> 
                <tr class="TopMenuItem"> 
                 <td class="TopMenuItem" nowrap> <a href="/services/development/oracle-jdeveloper-adf-bc-oracle-adf-faces-rich-client-java-ee-j2ee-developers.html" class="TopMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> Oracle ADF Java Applications 
                   </div> </a> </td> 
                </tr> 
                <tr class="TopMenuItem"> 
                 <td class="TopMenuItem" nowrap> <a href="/services/development/ajax-java-server-faces-jsf-adf-myfaces-dhtml-web-component-designers-developers.html" class="TopMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> AJAX JSF Web Components 
                   </div> </a> </td> 
                </tr> 
               </tbody>
              </table> </td> 
             <td class="TopMenu" width="33%" align="CENTER" valign="TOP"> 
              <table class="TopMenu" border="0" cellpadding="0" cellspacing="0"> 
               <tbody>
                <tr class="TopMenuTitle"> 
                 <td class="TopMenuTitle" nowrap> <a href="/services/consulting/index.html" class="TopMenuTitle"> 
                   <div class="MenuTitle">
                     AJAX / JAVA CONSULTING 
                   </div> </a> </td> 
                </tr> 
                <tr class="TopMenuItem"> 
                 <td class="TopMenuItem" nowrap> <a href="/services/consulting/jsf-jsp-struts-desktop-to-ajax-adf-faces-migration-conversion-consultants.html" class="TopMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> Migrating Existing Apps to AJAX 
                   </div> </a> </td> 
                </tr> 
                <tr class="TopMenuItem"> 
                 <td class="TopMenuItem" nowrap> <a href="/services/consulting/oracle-java-xml-database-db-oc4j-jdeveloper-toplink-adf-faces-ajax-consultants.html" class="TopMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> Java &amp; Oracle ADF Consulting 
                   </div> </a> </td> 
                </tr> 
                <tr class="TopMenuItem"> 
                 <td class="TopMenuItem" nowrap> <a href="/services/consulting/struts-to-ajax-jsf-adf-faces-shale-seam-migration-conversion-consultants.html" class="TopMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> Switching from Struts to JSF 
                   </div> </a> </td> 
                </tr> 
               </tbody>
              </table> </td> 
            </tr> 
           </tbody>
          </table> </td> 
        </tr> 
       </tbody>
      </table> </td> 
    </tr> 
   </tbody>
  </table> 
  <br> 
  <table border="0" cellspacing="0" cellpadding="0" width="100%"> 
   <tbody>
    <tr> 
     <td valign="top" width="1%"> 
      <table border="0" cellspacing="0" cellpadding="0" class="LeftMenuMargins"> 
       <tbody>
        <tr class="LeftBorder"> 
         <td class="LeftBorder"> 
          <table border="0" cellspacing="1" cellpadding="5"> 
           <tbody>
            <tr class="LeftMenu"> 
             <td class="LeftMenu" align="LEFT" valign="TOP"> 
              <table class="LeftMenu" border="0" cellpadding="0" cellspacing="0"> 
               <tbody>
                <tr class="LeftMenuTitle"> 
                 <td class="LeftMenuTitle" nowrap> <a href="/products/index.html" class="LeftMenuTitle"> 
                   <div class="MenuTitle">
                     CUSTOMIZABLE 
                   </div> 
                   <div class="MenuTitle">
                    WEB SOLUTIONS
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuItem"> 
                 <td class="LeftMenuItem" nowrap> <a href="/products/website/esd.html" class="LeftMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> ESD Implementation 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuItem"> 
                 <td class="LeftMenuItem" nowrap> <a href="/products/website/forms.html" class="LeftMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> Form Management 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuItem"> 
                 <td class="LeftMenuItem" nowrap> <a href="/products/website/utils.html" class="LeftMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> Web Components 
                   </div> </a> </td> 
                </tr> 
               </tbody>
              </table> </td> 
            </tr> 
            <tr class="LeftMenu"> 
             <td class="LeftMenu" align="LEFT" valign="TOP"> 
              <table class="LeftMenu" border="0" cellpadding="0" cellspacing="0"> 
               <tbody>
                <tr class="LeftMenuTitle"> 
                 <td class="LeftMenuTitle" nowrap> <a href="/xml/index.html" class="LeftMenuTitle"> 
                   <div class="MenuTitle">
                     OPEN SOURCE 
                   </div> 
                   <div class="MenuTitle">
                    JAVA PROJECTS
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuItem"> 
                 <td class="LeftMenuItem" nowrap> <a href="/xml/saxdomix/index.html" class="LeftMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> Java SAX-DOM Mix 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuItem"> 
                 <td class="LeftMenuItem" nowrap> <a href="/xml/benchmark/index.html" class="LeftMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> Parsing Benchmark 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuItem"> 
                 <td class="LeftMenuItem" nowrap> <a href="/xml/taglib/process/index.html" class="LeftMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> JSP XML Processing 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/xml/taglib/process/reference.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> JSP Tag Reference 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/xml/taglib/process/builder.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> Code Generator 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/xml/taglib/process/examples.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> JSP Examples 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuItem"> 
                 <td class="LeftMenuItem" nowrap> <a href="/xml/taglib/output/index.html" class="LeftMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> JSP XML Output 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/xml/taglib/output/reference.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> JSP Tag Reference 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/xml/taglib/output/builder.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> Code Generator 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/xml/taglib/output/examples.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> JSP Examples 
                   </div> </a> </td> 
                </tr> 
               </tbody>
              </table> </td> 
            </tr> 
            <tr class="LeftMenu"> 
             <td class="LeftMenu" align="LEFT" valign="TOP"> 
              <table class="LeftMenu" border="0" cellpadding="0" cellspacing="0"> 
               <tbody>
                <tr class="LeftMenuTitle"> 
                 <td class="LeftMenuTitle" nowrap> <a href="/mapping/index.html" class="LeftMenuTitle"> 
                   <div class="MenuTitle">
                     OBJECT MAPPING 
                   </div> 
                   <div class="MenuTitle">
                    FRAMEWORK
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuItem"> 
                 <td class="LeftMenuItem" nowrap> <a href="/mapping/docs/guide/overview.html" class="LeftMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> Product Overview 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuItem"> 
                 <td class="LeftMenuItem" nowrap> <a href="/mapping/docs/guide/appmodel.html" class="LeftMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> Application Model 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuItem"> 
                 <td class="LeftMenuItem" nowrap> <a href="/mapping/docs/guide/preface.html#ii_specifications" class="LeftMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> Mapping Specs 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/mapping/docs/guide/formspec.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> JavaBeans - Forms 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/mapping/docs/guide/textspec.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> JavaBeans - Text 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/mapping/docs/guide/xmlspec.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> JavaBeans - XML 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuItem"> 
                 <td class="LeftMenuItem" nowrap> <a href="/mapping/docs/guide/preface.html#iii_examples" class="LeftMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> Code Samples 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/mapping/docs/guide/simple.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> Simple JSP Form 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/mapping/docs/guide/dynamic.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> Dynamic JSP Form 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/mapping/docs/guide/imagemap.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> Image Map 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/mapping/docs/guide/upload.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> JSP File Uploading 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/mapping/docs/guide/internat.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> JSP Localization 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuItem"> 
                 <td class="LeftMenuItem" nowrap> <a href="/mapping/docs/guide/application.html" class="LeftMenuItem"> 
                   <div class="MenuItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> Demo Application 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/mapping/docs/guide/mailer.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> Form Mailer 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/mapping/docs/guide/conectors.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> Connectors 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/mapping/docs/guide/monitor.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> Mail Monitor 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/mapping/docs/guide/starter.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> Monitor Starter 
                   </div> </a> </td> 
                </tr> 
                <tr class="LeftMenuSubItem"> 
                 <td class="LeftMenuSubItem" nowrap> <a href="/mapping/docs/guide/maildemo.html" class="LeftMenuSubItem"> 
                   <div class="MenuSubItem"> 
                    <img CLASS="BulletIcon" BORDER="0" WIDTH="7" HEIGHT="7" SRC="/images/jsp-jsf-adf-swing-ejb-icon.gif"> Mail Example 
                   </div> </a> </td> 
                </tr> 
               </tbody>
              </table> </td> 
            </tr> 
           </tbody>
          </table> </td> 
        </tr> 
       </tbody>
      </table> </td> 
     <td valign="top" width="*"> <h1>8. Dynamic Example</h1> 
      <table border="0" cellspacing="0" cellpadding="0" width="100%"> 
       <tbody>
        <tr> 
         <td valign="top" width="*"> 
          <table border="0" cellspacing="0" cellpadding="0" align="RIGHT" class="RightMenuMargins"> 
           <tbody>
            <tr class="RightBorder"> 
             <td class="RightBorder"> 
              <table border="0" cellspacing="1" cellpadding="5"> 
               <tbody>
                <tr class="RightMenu"> 
                 <td class="RightMenu" align="LEFT" valign="TOP"> 
                  <table class="RightMenu" border="0" cellpadding="0" cellspacing="0"> 
                   <tbody>
                    <tr class="RightMenuAuthor"> 
                     <td class="RightMenuAuthor" nowrap> <a href="/articles/index.html" class="RightMenuAuthor"> 
                       <div class="MenuAuthor">
                         ARTICLES ON JAVA, ORACLE, ADF, 
                       </div> 
                       <div class="MenuAuthor">
                        AJAX, JSF, JSP, SWING, XML, EJB3
                       </div> 
                       <div class="MenuAuthor">
                        BY ANDREI CIOROIANU
                       </div> 
                       <div class="MenuAuthor">
                        FOUNDER OF DEVSPHERE
                       </div> </a> </td> 
                    </tr> 
                   </tbody>
                  </table> </td> 
                </tr> 
                <tr class="RightMenu"> 
                 <td class="RightMenu" align="LEFT" valign="TOP"> 
                  <table class="RightMenu" border="0" cellpadding="0" cellspacing="0"> 
                   <tbody>
                    <tr class="RightMenuTitle"> 
                     <td class="RightMenuTitle" nowrap> <a href="/articles/java-ajax/index.html" class="RightMenuTitle"> 
                       <div class="MenuTitle">
                         JAVA / AJAX SERIES 
                       </div> </a> </td> 
                    </tr> 
                    <tr class="RightMenuItem"> 
                     <td class="RightMenuItem" nowrap> <a href="http://www.ibm.com/developerworks/views/web/libraryview.jsp?end_no=100&amp;lcl_sort_order=desc&amp;type_by=All+Types&amp;sort_order=asc&amp;show_all=false&amp;start_no=1&amp;sort_by=Date&amp;search_by=ajax+java+development+made+simpler&amp;topic_by=All+topics+and+related+products&amp;search_flag=true&amp;show_abstract=true&amp;S_TACT=105AGX08&amp;S_CMP=ART" class="RightMenuItem" target="_blank"> 
                       <div class="MenuItem"> 
                        <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/ibm-icon.gif"> AJAX and Java Dev Made Simpler 
                       </div> </a> </td> 
                    </tr> 
                    <tr class="RightMenuItem"> 
                     <td class="RightMenuItem" nowrap> <a href="http://www.ibm.com/developerworks/views/web/libraryview.jsp?end_no=100&amp;lcl_sort_order=desc&amp;type_by=All+Types&amp;sort_order=asc&amp;show_all=false&amp;start_no=1&amp;sort_by=Date&amp;search_by=Auto-save+JSF+forms&amp;topic_by=All+topics+and+related+products&amp;search_flag=true&amp;show_abstract=true&amp;S_TACT=105AGX01&amp;S_CMP=LP" class="RightMenuItem" target="_blank"> 
                       <div class="MenuItem"> 
                        <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/ibm-icon.gif"> Auto-Save JSF Forms with AJAX 
                       </div> </a> </td> 
                    </tr> 
                    <tr class="RightMenuItem"> 
                     <td class="RightMenuItem" nowrap> <a href="http://www.ibm.com/developerworks/views/java/libraryview.jsp?end_no=100&amp;lcl_sort_order=desc&amp;type_by=All+Types&amp;sort_order=asc&amp;show_all=false&amp;start_no=1&amp;sort_by=Date&amp;search_by=Craft+Ajax+applications+using+JSF+with+CSS+and+JavaScript&amp;topic_by=All+topics+and+related+products&amp;search_flag=true&amp;show_abstract=true&amp;S_TACT=105AGX08&amp;S_CMP=ART" class="RightMenuItem" target="_blank"> 
                       <div class="MenuItem"> 
                        <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/ibm-icon.gif"> Using JSF with CSS and JavaScript 
                       </div> </a> </td> 
                    </tr> 
                   </tbody>
                  </table> </td> 
                </tr> 
                <tr class="RightMenu"> 
                 <td class="RightMenu" align="LEFT" valign="TOP"> 
                  <table class="RightMenu" border="0" cellpadding="0" cellspacing="0"> 
                   <tbody>
                    <tr class="RightMenuItem"> 
                     <td class="RightMenuItem" nowrap> <a href="/articles/index.html" class="RightMenuItem"> 
                       <div class="MenuItem"> 
                        <img CLASS="BulletIcon" BORDER="0" WIDTH="10" HEIGHT="10" SRC="/images/java-oracle-ajax-xml-icon.gif"> More Articles on AJAX, JSF and JSP 
                       </div> </a> </td> 
                    </tr> 
                   </tbody>
                  </table> </td> 
                </tr> 
               </tbody>
              </table> </td> 
            </tr> 
           </tbody>
          </table> 
          <table width="60%"> 
           <tbody>
            <tr> 
             <td align="left"> <a href="index.html">Contents</a> | <a href="simple.html">Previous Chapter</a> | <a href="imagemap.html">Next Chapter</a> </td> 
            </tr> 
           </tbody>
          </table> 
          <!--add about --> <p>This chapter shows how to use the framework to build a table editor. The HTML form is generated dynamically by a JSP. The framework still does the routine tasks such as form data handling, user error handling, etc. XML-based persistence was implemented for user data. A discussion about thread safety was included at the end of the chapter.</p> <br> <h2><a name="data_beans">8.1. Data Beans</a></h2> <p>RowBean is a Java bean whose instances maintain the row data of a table. It has three standard properties (a boolean and two strings) that can be accessed using the get &amp; set methods. The clone() method can be used to create copies of a bean object.</p> <p><b>RowBean.java:</b></p> <pre>
package com.devsphere.examples.mapping.dynamic;

/**
 * Row bean
 */
public class RowBean implements java.io.Serializable, Cloneable {
    private boolean selected;
    private String text;
    private String combo;

    /**
     * No-arg constructor
     */
    public RowBean() {
    }

    /**
     * Gets the selected property
     */
    public boolean isSelected() {
        return this.selected;
    }

    /**
     * Sets the selected property
     */
    public void setSelected(boolean value) {
        this.selected = value;
    }

    /**
     * Gets the text property
     */
    public String getText() {
        return this.text;
    }

    /**
     * Sets the text property
     */
    public void setText(String value) {
        this.text = value;
    }

    /**
     * Gets the combo property
     */
    public String getCombo() {
        return this.combo;
    }

    /**
     * Sets the combo property
     */
    public void setCombo(String value) {
        this.combo = value;
    }

    /**
     * Returns a clone of this bean object
     */
    public Object clone() {
        try {
            return super.clone();
        } catch (CloneNotSupportedException e) {
            e.printStackTrace();
        }
        return null;
    }

}</pre> <p>TableBean uses an array of RowBean instances to store the data of an entire table. The other two properties (command and fileName) are used to communicate with the processor component described in <a href="#java_processor">a later section</a>. In addition to the access methods, the TableBean class implements several table operations: create table, clone table, count selected rows, append new row, delete selected rows.</p> <p><b>TableBean.java:</b></p> <pre>
package com.devsphere.examples.mapping.dynamic;

/**
 * Table bean
 */
public class TableBean implements java.io.Serializable, Cloneable {
    public static final int DEFAULT_ROW_COUNT = 3;
    private String command;
    private String fileName;
    private RowBean rowArray[];

    /**
     * No-arg constructor
     */
    public TableBean() {
    }

    /**
     * Gets the command property
     */
    public String getCommand() {
        return this.command;
    }

    /**
     * Sets the command property
     */
    public void setCommand(String value) {
        this.command = value;
    }

    /**
     * Gets the fileName property
     */
    public String getFileName() {
        return this.fileName;
    }

    /**
     * Sets the fileName property
     */
    public void setFileName(String value) {
        this.fileName = value;
    }

    /**
     * Gets the rowArray property
     */
    public RowBean[] getRowArray() {
        return this.rowArray;
    }

    /**
     * Sets the rowArray property
     */
    public void setRowArray(RowBean values[]) {
        this.rowArray = values;
    }

    /**
     * Gets an element of the rowArray property
     */
    public RowBean getRowArray(int index) {
        return this.rowArray[index];
    }

    /**
     * Sets an element of the rowArray property
     */
    public void setRowArray(int index, RowBean value) {
        this.rowArray[index] = value;
    }

    /**
     * Returns a clone of this bean object
     */
    public Object clone() {
        TableBean tableClone = null;
        try {
            tableClone = (TableBean) super.clone();
            if (tableClone.rowArray != null) {
                tableClone.rowArray = (RowBean[]) tableClone.rowArray.clone();
                for (int i = 0; i &lt; tableClone.rowArray.length; i++)
                    tableClone.rowArray[i] = (RowBean) tableClone.rowArray[i].clone();
            }
        } catch (CloneNotSupportedException e) {
            e.printStackTrace();
        }
        return tableClone;
    }

    /**
     * Returns the number of selected rows
     */
    public int countSelectedRows() {
        int count = 0;
        for (int i = 0; i &lt; rowArray.length; i++)
            if (rowArray[i].isSelected())
                count++;
        return count;
    }

    /**
     * Appends a new row at the end of the table
     */
    public void appendNewRow() {
        RowBean newRowArray[] = new RowBean[rowArray.length + 1];
        for (int i = 0; i &lt; rowArray.length; i++)
            newRowArray[i] = rowArray[i];
        newRowArray[rowArray.length] = new RowBean();
        setRowArray(newRowArray);
    }

    /**
     * Deletes the selected rows
     */
    public void deleteSelectedRows() {
        RowBean newRowArray[] = new RowBean[rowArray.length-countSelectedRows()];
        for (int i = 0, j = 0; i &lt; rowArray.length; i++)
            if (!rowArray[i].isSelected())
                newRowArray[j++] = rowArray[i];
        setRowArray(newRowArray);
    }

    /**
     * Creates a table having a default number of empty rows
     */
    public static TableBean createEmptyTable() {
        TableBean table = new TableBean();
        RowBean rowArray[] = new RowBean[DEFAULT_ROW_COUNT];
        for (int i = 0; i &lt; rowArray.length; i++)
            rowArray[i] = new RowBean();
        table.setRowArray(rowArray);
        return table;
    }

}</pre> <br> 
          <!--add taglib web products --> <h2><a name="dynamic_html_form">8.2. Dynamic HTML Form</a></h2> <p>The HTML form used to edit the table is built dynamically by a JSP. This is necessary only because the number of rows is variable.</p> <p>DynamicForm.jsp is almost pure HTML. You don't have to code the insertion of the values of the form elements. The JSP handler invokes the JSP form and parses its content. The values of the table cells are extracted from a TableBean and inserted automatically within the HTML form.</p> 
          <table border cellspacing="1" cellpadding="5"> 
           <tbody>
            <tr> 
             <td>Name</td> 
             <td>Property type</td> 
             <td>Element type</td> 
            </tr> 
            <tr> 
             <td>&nbsp;</td> 
             <td>&nbsp;</td> 
             <td>&nbsp;</td> 
            </tr> 
            <tr> 
             <td>command</td> 
             <td>String</td> 
             <td>submit[]</td> 
            </tr> 
            <tr> 
             <td>fileName</td> 
             <td>String</td> 
             <td>text</td> 
            </tr> 
            <tr> 
             <td>rowArray.length</td> 
             <td>int</td> 
             <td>hidden</td> 
            </tr> 
            <tr> 
             <td>rowArray.<i>index</i>.selected</td> 
             <td>boolean</td> 
             <td>checkbox</td> 
            </tr> 
            <tr> 
             <td>rowArray.<i>index</i>.text</td> 
             <td>String</td> 
             <td>text</td> 
            </tr> 
            <tr> 
             <td>rowArray.<i>index</i>.combo</td> 
             <td>String</td> 
             <td>select</td> 
            </tr> 
           </tbody>
          </table> <p>The JSP handler disables the showing of the user error messages by removing from the error table the MappingError objects that contain these messages. Without this, a message would be shown for every cell that wasn't filled by the user. The showing of the application error messages isn't disabled. Not to affect the layout of the table, the message variables are relocated at the end of the document. This is possible by inserting &lt;!-- VARIABLE NAME="[ERROR_MESSAGE.rowArray.<i>index.propertyName</i>]" --&gt; comments.</p> <p>The mapping utilities don't handle the I/O errors that may occur during the loading/saving of XML files. In order to report these errors to the user, the io_error variable defined in the HTML form (&lt;!-- VARIABLE NAME="io_error" --&gt;) is used by the JSP handler.</p> <p><b>DynamicForm.jsp:</b></p> <pre>
&lt;%@ page language="java" %&gt;
&lt;HTML&gt;
&lt;HEAD&gt;&lt;TITLE&gt;DynamicForm&lt;/TITLE&gt;&lt;/HEAD&gt;
&lt;BODY&gt;
&lt;CENTER&gt;
&lt;H3&gt;Dynamic Example&lt;/H3&gt;
&lt;FORM METHOD="POST"&gt;
&lt;%
    int count = 0;
    try { count = Integer.parseInt(request.getParameter("count")); }
    catch (Throwable t) { }
%&gt;
&lt;P&gt;
&lt;INPUT TYPE="TEXT"   NAME="fileName" LENGTH="20"&gt;
&lt;INPUT TYPE="SUBMIT" NAME="command" VALUE="Load"&gt;
&lt;INPUT TYPE="SUBMIT" NAME="command" VALUE="Save"&gt;
&lt;BR&gt;&lt;!-- VARIABLE NAME="io_error" --&gt;
&lt;P&gt;
&lt;INPUT TYPE="SUBMIT" NAME="command" VALUE="Append New Row"&gt;
&lt;INPUT TYPE="SUBMIT" NAME="command" VALUE="Delete Selected Rows"&gt;
&lt;INPUT TYPE="SUBMIT" NAME="command" VALUE="Undo"&gt;
&lt;P&gt;
&lt;INPUT TYPE="HIDDEN" NAME="rowArray.length" VALUE="&lt;%=count%&gt;"&gt;
&lt;TABLE BORDER="1" CELLPADDING="3" CELLSPACING="1"&gt;
    &lt;TR&gt;
        &lt;TH&gt;Selected&lt;/TH&gt;
        &lt;TH&gt;Text&lt;/TH&gt;
        &lt;TH&gt;Combo&lt;/TH&gt;
    &lt;/TR&gt;
&lt;%  for (int i = 0; i &lt; count; i++) { %&gt;
    &lt;TR&gt;
        &lt;TD&gt;
            &lt;CENTER&gt;
            &lt;INPUT TYPE="CHECKBOX" NAME="rowArray.&lt;%=i%&gt;.selected"&gt;
            &lt;/CENTER&gt;
        &lt;/TD&gt;
        &lt;TD&gt;
            &lt;INPUT TYPE="TEXT" NAME="rowArray.&lt;%=i%&gt;.text" LENGTH="30"&gt;
        &lt;/TD&gt;
        &lt;TD&gt;
            &lt;SELECT NAME="rowArray.&lt;%=i%&gt;.combo" SIZE="1"&gt;
                &lt;OPTION VALUE=""&gt;&lt;/OPTION&gt;
                &lt;OPTION VALUE="1"&gt;Item 1&lt;/OPTION&gt;
                &lt;OPTION VALUE="2"&gt;Item 2&lt;/OPTION&gt;
                &lt;OPTION VALUE="3"&gt;Item 3&lt;/OPTION&gt;
            &lt;/SELECT&gt;
        &lt;/TD&gt;
    &lt;/TR&gt;
&lt;%  } %&gt;
&lt;/TABLE&gt;
&lt;/FORM&gt;
&lt;!-- VARIABLE NAME="[ERROR_MESSAGE]" --&gt;
&lt;!-- VARIABLE NAME="[ERROR_MESSAGE.fileName]" --&gt;
&lt;%  for (int i = 0; i &lt; count; i++) { %&gt;
    &lt;!-- VARIABLE NAME="[ERROR_MESSAGE.rowArray.&lt;%=i%&gt;.selected]" --&gt;
    &lt;!-- VARIABLE NAME="[ERROR_MESSAGE.rowArray.&lt;%=i%&gt;.text]" --&gt;
    &lt;!-- VARIABLE NAME="[ERROR_MESSAGE.rowArray.&lt;%=i%&gt;.combo]" --&gt;
&lt;%  } %&gt;
&lt;/CENTER&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;</pre> <br> <h2><a name="bean_resources">8.3. Bean Resources</a></h2> <p>TableBeanResources is the single resource bundle of the application and contains the form's name, several application-specific error messages and the HTML wrappers of the error messages. The resource bundle is a .properties file.</p> <p><b>TableBeanResources.properties:</b></p> <pre>
[FORM_NAME]=DynamicForm.jsp

# Application-specific error messages
[MISSING_FILE_NAME]=You must input a file name
[FILE_NOT_FOUND]=File not found
[COULDNT_LOAD_FILE]=Couldn't load the file
[COULDNT_SAVE_FILE]=Couldn't save the file</pre> <br> 
          <!--add services --> <h2><a name="jsp_handler">8.4. JSP Handler</a></h2> <p>DynamicHndl.jsp is not a typical handler. The HTML form is generated dynamically using a JSP described in <a href="#dynamic_html_form">a previous section</a> of this chapter. The form data is mapped to TableBean instances that are passed to a processor declared as a session bean.</p> <p>After loading the resource bundle, the handler builds a base URL by deleting its own name from the request URL. Next, it builds the path the processor uses to save the beans as XML files.</p> <p>If the HTTP method isn't POST, the handler calls getCurrentState() of the processor, which returns a bean table with three empty rows at the first call. </p> <p>If the HTTP method is POST, the form data is passed to FormUtils.formToBean() which fills the "cells" of a table bean. The user errors are removed from the returned Hahstable to disable the showing of the user error messages. Then, the table bean is passed to the executeCommand() method of the processor, which may append a new row, delete the selected rows, undo a change, save the data to an XML file or load an existent table from an XML file.</p> <p>The JSP form is invoked using its URL (instead of &lt;jsp:include&gt; or &lt;jsp:forward&gt;) because the HTML form needs some processing. The new table bean returned by executeCommand() is passed to FormUtils.beanToForm(), which inserts the table's data into the HTML form. The processor returns any I/O error as a message stored in the command property of the table bean. If not null, this message is inserted into the HTML document. </p> <p>The HTML form containing the table's data is send to the user using the send() method of the FormDocument instance.</p> <p><b>DynamicHndl.jsp:</b></p> <pre>
&lt;%@ page language="java" %&gt;
&lt;%@ page import="com.devsphere.mapping.*, com.devsphere.logging.*" %&gt;
&lt;jsp:useBean id="dynamicProc" scope="session"
    class="com.devsphere.examples.mapping.dynamic.DynamicProc"/&gt;
&lt;jsp:useBean id="tableBean" scope="request"
    class="com.devsphere.examples.mapping.dynamic.TableBean"/&gt;
&lt;%
    // Get the bean resources
    java.util.ResourceBundle beanRes
        = HandlerUtils.getBeanResources(tableBean.getClass());

    // Construct the base URL
    String baseURL = javax.servlet.http.HttpUtils.getRequestURL(
        request).toString();
    int slashIndex = baseURL.lastIndexOf('/');
    baseURL = slashIndex != -1 ? baseURL.substring(0, slashIndex+1) : "";

    // Construct the data path
    String dataPath = request.getServletPath();
    slashIndex = dataPath.lastIndexOf('/');
    dataPath = slashIndex != -1 ? dataPath.substring(0, slashIndex+1) : "";
    dataPath = application.getRealPath(dataPath + "data");

    // Determine the HTTP method
    boolean isPostMethod = request.getMethod().equals("POST");

    // Create a logger that wraps the servlet context
    ServletLogger logger = new ServletLogger(application);

    // Declare local variables
    com.devsphere.examples.mapping.dynamic.TableBean newTableBean = null;
    java.util.Hashtable errorTable = null;

    if (!isPostMethod) {
        // Get the table of the current session
        newTableBean = dynamicProc.getCurrentState();
    } else {
        // Wrap the form data
        FormData formData = new ServletFormData(request);

        // Form-to-bean mapping: request parameters are mapped to bean properties
        errorTable = FormUtils.formToBean(formData, tableBean, logger);

        // Ignore the user errors
        errorTable = HandlerUtils.removeUserErrors(errorTable);

        // Process the user command
        newTableBean = dynamicProc.executeCommand(tableBean, dataPath, logger);
    }

    // Construct the form's URL
    String formURL = baseURL + beanRes.getString("[FORM_NAME]").trim();
    if (newTableBean.getRowArray() != null)
        formURL += "?count=" + newTableBean.getRowArray().length;

    // Get the form template
    FormTemplate template = FormUtils.getTemplate(new java.net.URL(formURL));

    // Get a new document
    FormDocument document = template.getDocument();

    // Bean-to-form mapping: bean properties are mapped to form elements
    FormUtils.beanToForm(newTableBean, errorTable, document, logger);

    // Show the possible I/O error
    String ioError = newTableBean.getCommand();
    if (ioError != null)
        document.setValue("io_error", ioError);

    // Send the form document
    document.send(out);
%&gt;</pre> <br> 
          <!--add j2ee --> <h2><a name="java_processor">8.5. Java Processor</a></h2> <p>The application uses one processor instance per user session. This instance maintains the initial table, the current table and a stack of tables that is used to undo changes. The getCurrentState() method returns a clone of the current table. The executeCommand() method takes a bean table, performs some actions depending on the value of the command property and returns the new current table.</p> <p>Before making an undoable change (adding/removing of rows), the executeCommand() method of DynamicProc pushes the current table on the stack. The undo command gets the last table from the stack and makes it the new current table. This undo mechanism works fine with forms, though it would be considered inefficient in a traditional GUI application based on events.</p> <p><b>DynamicProc.java:</b></p> <pre>
package com.devsphere.examples.mapping.dynamic;

import com.devsphere.logging.*;

import java.util.*;

/**
 * Processor of table beans
 */
public class DynamicProc implements java.io.Serializable {
    private Stack oldTables;
    private TableBean initialState;
    private TableBean currentState;

    /**
     * Creates the processor
     */
    public DynamicProc() {
        oldTables = new Stack();
        initialState = TableBean.createEmptyTable();
        currentState = TableBean.createEmptyTable();
    }

    /**
     * Returns the current table bean
     */
    public synchronized TableBean getCurrentState() {
        return (TableBean) currentState.clone();
    }

    /**
     * Processes a table bean and executes its command
     */
    public synchronized TableBean executeCommand(
        TableBean table, String dataPath, AbstractLogger logger) {
        // Make a clone of the table
        table = (TableBean) table.clone();

        // Get the command
        String command = table.getCommand();

        // Clear the command property
        table.setCommand(null);

        // Execute the command
        if (command != null)
            if (command.startsWith("Load")) {
                table = XMLArchiver.load(table, dataPath, logger);
                if (table.getCommand() == null) {
                    // No error message.
                    // Reinitialize the processor
                    oldTables.removeAllElements();
                    initialState = (TableBean) table.clone();
                }
            } else if (command.startsWith("Save")) {
                table = XMLArchiver.save(table, dataPath, logger);
            } else if (command.startsWith("Undo")) {
                // Get the last table from the stack
                if (!oldTables.isEmpty())
                    table = (TableBean) oldTables.pop();
                else
                    table = (TableBean) initialState.clone();
            } else {
                // Put the table on the stack
                oldTables.push(table);

                // Make a clone of the table
                table = (TableBean) table.clone();

                // Process the undoable command
                if (command.startsWith("Append"))
                    table.appendNewRow();
                else if (command.startsWith("Delete"))
                    table.deleteSelectedRows();
            }

        // Update the current state
        currentState = table;

        // Return the current state
        return getCurrentState();
    }

}</pre> <br> 
          <!--add xml --> <h2><a name="xml_based_persistence">8.6. XML-based Persistence</a></h2> <p>The save() and load() methods of XMLArchiver use XMLUtils.beanToXML() and XMLUtils.xmlToBean() to convert the bean table to XML and vice-versa. The file name is provided as a property of the table bean and any I/O error is reported via the command property. The values of these two properties shouldn't be stored in the XML file. Therefore, they are cleared before the table data is saved to the XML file. However, the fileName and command properties must participate to the mapping process in order to make the communication between the HTML form and the DynamicProc processor as easy as possible.</p> <p><b>XMLArchiver.java:</b></p> <pre>
package com.devsphere.examples.mapping.dynamic;

import com.devsphere.logging.*;
import com.devsphere.mapping.*;

import java.io.*;
import java.util.*;

/**
 * Archiver of table beans
 */
public class XMLArchiver {
    public static final Object FILE_LOCK = new Object();
    private static final String HTML_MESSAGE_START = (String)
        HandlerUtils.getResource("[HTML_MESSAGE_START]", "", TableBean.class);
    private static final String HTML_MESSAGE_END = (String)
        HandlerUtils.getResource("[HTML_MESSAGE_END]", "", TableBean.class);
    private static final String HTML_MESSAGE_SEPARATOR = (String)
        HandlerUtils.getResource("[HTML_MESSAGE_SEPARATOR]", "", TableBean.class);
    private static ResourceBundle beanRes
        = HandlerUtils.getBeanResources(TableBean.class);

    /**
     * Loads a table bean from an XML file
     */
    public static TableBean load(TableBean tableBean, String dataPath,
        AbstractLogger logger) {
        String fileName = tableBean.getFileName();
        if (fileName == null || fileName.length() == 0
            || fileName.indexOf('\\') != -1
            || fileName.indexOf('/') != -1) {
            error(tableBean, "[MISSING_FILE_NAME]");
            return tableBean;
        }
        if (!fileName.toLowerCase().endsWith(".xml")) {
            fileName += ".xml";
            tableBean.setFileName(fileName);
        }
        synchronized (FILE_LOCK) {
            File file = new File(dataPath, fileName);
            try {
                FileInputStream in = new FileInputStream(file);
                try {
                    Hashtable errorTable = null;
                    TableBean newTableBean = new TableBean();
                    errorTable = XMLUtils.xmlToBean(in, newTableBean, logger);
                    newTableBean.setFileName(fileName);
                    tableBean = newTableBean;
                } finally {
                    in.close();
                }
            } catch (FileNotFoundException e) {
                error(tableBean, "[FILE_NOT_FOUND]");
            } catch (IOException e) {
                error(tableBean, "[COULDNT_LOAD_FILE]");
                logger.log(e);
            }
        }
        return tableBean;
    }

    /**
     * Saves a table bean to an XML file
     */
    public static TableBean save(TableBean tableBean, String dataPath,
        AbstractLogger logger) {
        String fileName = tableBean.getFileName();
        if (fileName == null || fileName.length() == 0) {
            error(tableBean, "[MISSING_FILE_NAME]");
            return tableBean;
        }
        if (!fileName.toLowerCase().endsWith(".xml"))
            fileName += ".xml";
        synchronized (FILE_LOCK) {
            new File(dataPath).mkdirs();
            File file = new File(dataPath, fileName);
            try {
                FileOutputStream out = new FileOutputStream(file);
                try {
                    tableBean.setFileName(null);
                    XMLUtils.beanToXML(tableBean, null, out, logger);
                } finally {
                    tableBean.setFileName(fileName);
                    out.close();
                }
            } catch (IOException e) {
                error(tableBean, "[COULDNT_SAVE_FILE]");
                logger.log(e);
            }
        }
        return tableBean;
    }

    /**
     * Signals an application-specific error
     */
    private static void error(TableBean tableBean, String key) {
        StringBuffer buf = new StringBuffer();
        buf.append(HTML_MESSAGE_START);
        try {
            String message = beanRes.getString(key);
            message = FormUtils.messageToHTML(message);
            buf.append(message);
        } catch (MissingResourceException e) {
            buf.append(key);
        }
        buf.append(HTML_MESSAGE_END);
        tableBean.setCommand(buf.toString());
    }

}</pre> <br> <h2><a name="thread_safety">8.7. Thread Safety</a></h2> <p>All classes of the framework are thread safe. This section discusses the need to synchronize some of the code of this example application.</p> <p>A user could perform multiple concurrent requests during the same session. The servlet engine may create a pool of threads running the code of the JSP handler. Therefore, the same processor instance may be accessed from concurrent threads. Making the processor's methods synchronized is necessary, but not enough. </p> <p>DynamicHndl.jsp creates instances of TableBean, which aren't thread safe. Therefore each bean object must be used in a single thread at a given time. The JSP handler passes a table bean to the executeCommand() method of the processor. It is OK to access this bean object within executeCommand(), but the processor must not keep any reference to the table bean instance because it could be accessed from other threads. In other words, a bean object that was created by the JSP handler must not be stored to oldTables or currentState. To ensure this, executeCommand() creates a clone of the bean object.</p> <p>The table beans created by the JSP handler are accessed in a single thread. Unlike them the table beans created internally by the processor may be accessed from multiple threads activated by requests of the same session. (The user could open multiple windows of the browser and make concurrent requests.) This is OK too because the methods of DynamicProc are declared synchronized, which means that their code cannot be executed concurrently. In other words, only one thread of a request may execute the methods of a processor instance at a given time.</p> <p>Both getCurrentState() and executeCommand() methods return a bean object, which is used further by the JSP handler. To avoid the concurrent access to these objects, the processor's methods must not return bean objects used internally by them. In addition, the same object shouldn't be returned twice. The solution is to return newly created clones of the bean object and not use the returned clones internally. This way, the clone of the current table will be used further only by the handler invocation that gets it.</p> <p>One last word about thread safety. Since exectuteCommand() is synchronized, a user can't access the XML files at the same time within two concurrent requests of the same session. This isn't enough in a multi-user environment. To avoid file conflicts, the XML documents should not be accessed concurrently by different sessions. For instance, a user shouldn't be able to load an XML file while another user saves the same file. The simplest solution is to a have a global file lock (XMLArchiver.FILE_LOCK) that ensures that a single file is accessed at a given time. A possible better approach would be to create a separate data directory for each user. In this case the users wouldn't be able to share the files, unless an exchange mechanism is implemented.</p> <br> <h2><a name="hints_and_tips">8.8. Hints and Tips</a></h2> <p>The FormUtils.getTemplate() method allows you to build FormTemplate instances from</p> 
          <ul> 
           <li>a File </li> 
           <li>a URL </li> 
           <li>an InputStream </li> 
           <li>a Reader </li> 
           <li>a String</li>
          </ul> <p><a href="xmlspec.html">A previous chapter</a> describes the way bean objects are mapped to XML documents and vice-versa.</p> 
          <table width="60%"> 
           <tbody>
            <tr> 
             <td align="left"> <a href="index.html">Contents</a> | <a href="simple.html">Previous Chapter</a> | <a href="imagemap.html">Next Chapter</a> </td> 
            </tr> 
           </tbody>
          </table> 
          <div>
           <img BORDER="0" WIDTH="360" HEIGHT="2" SRC="/images/blank.gif">
          </div> </td> 
        </tr> 
       </tbody>
      </table> </td> 
    </tr> 
   </tbody>
  </table> 
  <br> 
  <table width="100%" border="0" cellspacing="0" cellpadding="5"> 
   <tbody>
    <tr class="BottomMenu"> 
     <td class="BottomMenu" align="CENTER" valign="TOP"> 
      <div align="CENTER">
       Copyright  2000-2009 Devsphere
      </div> <br> 
      <table class="BottomMenu" border="0" cellpadding="0" cellspacing="0"> 
       <tbody>
        <tr class="BottomMenu"> 
         <td class="BottomMenuItem" nowrap> <a href="/company/index.html" class="BottomMenuItem"> 
           <div class="BarItem">
             About us 
           </div> </a> </td> 
         <td class="BottomMenuItem" nowrap> <a href="/company/contact.html" class="BottomMenuItem"> 
           <div class="BarItem">
             Contact us 
           </div> </a> </td> 
         <td class="BottomMenuItem" nowrap> <a href="/products/index.html" class="BottomMenuItem"> 
           <div class="BarItem">
             Products 
           </div> </a> </td> 
         <td class="BottomMenuItem" nowrap> <a href="/services/index.html" class="BottomMenuItem"> 
           <div class="BarItem">
             Services 
           </div> </a> </td> 
         <td class="BottomMenuItem" nowrap> <a href="/articles/index.html" class="BottomMenuItem"> 
           <div class="BarItem">
             Articles 
           </div> </a> </td> 
        </tr> 
       </tbody>
      </table> </td> 
    </tr> 
   </tbody>
  </table>   
 </body>
</html>