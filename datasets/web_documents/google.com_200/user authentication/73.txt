<!doctype html>
<html class="no-js" lang="">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <title>Build an Instagram clone with AngularJS, Satellizer, Node.js and MongoDB - HackHands</title> 
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1"> 
  <link rel="apple-touch-icon" href="/apple-touch-icon.png"> 
  <link rel="icon" href="/favicon.ico?v=1.1" type="image/x-icon"> 
  <link rel="shortcut icon" href="/favicon.ico?v=1.1"> 
  <meta name="author" content="hackhands.com"> 
  <link rel="profile" href="http://gmpg.org/xfn/11"> 
  <meta property="og:site_name" content="HackHands"> 
  <meta property="og:image" content="https://hackhands.com/assets/branding/face_cover.png"> 
  <meta property="og:locale" content="en_US"> 
  <meta property="og:type" content="article"> 
  <meta property="article:section" content="Uncategorized"> 
  <link rel="canonical" href=""> 
  <meta name="description" content="1. IntroductionSatellizer is a token-based authentication module for AngularJS that comes with built-in support for Facebook, Google, LinkedIn, Twitter, GitHub, Yahoo and Windows Live OAuth provid..."> 
  <meta property="og:title" content="Build an Instagram clone with AngularJS, Satellizer, Node.js and MongoDB"> 
  <meta property="og:description" content="1. IntroductionSatellizer is a token-based authentication module for AngularJS that comes with built-in support for Facebook, Google, LinkedIn, Twitter, GitHub, Yahoo and Windows Live OAuth provid..."> 
  <meta property="og:url" content=""> 
  <meta property="article:published_time" content="Tue Dec 09 2014 00:00:00 GMT+0000 (UTC)"> 
  <meta property="article:modified_time" content="Tue Dec 09 2014 00:00:00 GMT+0000 (UTC)"> 
  <meta property="og:updated_time" content="Tue Dec 09 2014 00:00:00 GMT+0000 (UTC)"> 
  <!-- Twitter Card data! --> 
  <meta name="twitter:card" content="HackHands"> 
  <meta name="twitter:site" content="@hackhands"> 
  <meta name="twitter:title" content="Build an Instagram clone with AngularJS, Satellizer, Node.js and MongoDB"> 
  <meta name="twitter:description" content="1. IntroductionSatellizer is a token-based authentication module for AngularJS that comes with built-in support for Facebook, Google, LinkedIn, Twitter, GitHub, Yahoo and Windows Live OAuth provid..."> 
  <!-- Twitter Summary card images must be at least 120x120px --> 
  <meta name="twitter:image" content="https://hackhands.com/assets/branding/face_cover.png"> 
  <!--
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for HackHands Blog" href="https://hackhands.com/feed/" />
    --> 
  <!-- build:css(./public) /_css/main.css --> 
  <link rel="stylesheet" href="/assets/bower_components/normalize.css/normalize.css"> 
  <link rel="stylesheet" href="/assets/bower_components/owlcar/owl-carousel/owl.carousel.css"> 
  <link rel="stylesheet" href="/assets/bower_components/owlcar/owl-carousel/owl.theme.css"> 
  <link rel="stylesheet" href="/assets/bower_components/selectize/dist/css/selectize.default.css"> 
  <link rel="stylesheet" href="/assets/bower_components/tooltipster/css/tooltipster.css"> 
  <link rel="stylesheet" href="/assets/bower_components/nouislider/distribute/jquery.nouislider.min.css"> 
  <link rel="stylesheet" href="/assets/bower_components/nouislider/distribute/jquery.nouislider.pips.min.css"> 
  <link rel="stylesheet" href="/assets/bower_components/highlightjs/styles/default.css"> 
  <link rel="stylesheet" href="/assets/bower_components/highlightjs/styles/monokai_sublime.css"> 
  <link rel="stylesheet" href="/assets/bower_components/multiple-select/multiple-select.css"> 
  <link rel="stylesheet" href="/assets/bower_components/unsemantic/assets/stylesheets/unsemantic-grid-responsive-tablet.css"> 
  <link rel="stylesheet" href="/assets/fonts/hh-tag/styles.css?version=344789"> 
  <link rel="stylesheet" href="/assets/fonts/hackhands/styles.css?version=344789"> 
  <link rel="stylesheet" href="/assets/fonts/whitney/font.css?version=344789"> 
  <link rel="stylesheet" href="/assets/css/hackhands.css?version=344789"> 
  <link rel="stylesheet" href="//cloud.typography.com/6966154/691568/css/fonts.css"> 
  <!-- endbuild --> 
  <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--> 
  <!-- build:js(./public) /_js/head-scripts.js --> 
  <script src="/assets/bower_components/modernizr/modernizr.js"></script> 
  <script src="/assets/js/utils.js"></script> 
  <!-- endbuild --> 
 </head> 
 <body> 
  <!--[if lt IE 10]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]--> 
  <header> 
   <!-- Header --> 
   <div class="topNavigation"> 
    <a href="/"><img title="HackHands" alt="HackHands" src="/assets/branding/hackhands_ps.svg"></a> 
    <ul class="menu hide-on-mobile hide-on-tablet"> 
     <li><a href="/how-it-works/">How it works</a></li> 
     <li><a href="/blog/">Posts</a></li> 
     <li class="stateLogout"><a href="/create-expert-account/" class="btTopCTA1 bt bt-purple">BECOME A MENTOR</a></li> 
     <li class="stateLogout"><a href="/login/" data-no-instant class="btTopCTA2 homeLogin doLogIn bt bt-border-hh">Sign In</a></li> 
     <li style="display:none" class="stateLogin"><a href="#" onclick="HH_Helpers.goToDashboard(); return false" class="btTopCTA1 bt bt-purple">enter Dashboard</a></li> 
     <li style="display:none" class="stateLogin"><a href="#" onclick="HH_Helpers.logout(); return false;" data-no-instant class="btTopCTA2 homeLogin doLogIn bt bt-border-hh">Logout</a></li> 
    </ul> 
    <ul class="menu hide-on-desktop"> 
     <li class="stateLogout hide-on-mobile"><a href="/create-expert-account/" class="bt bt-purple">BECOME A MENTOR</a></li> 
     <li class="stateLogout hide-on-mobile"><a href="/login/" class="homeLogin bt bt-border-hh">Sign In</a></li> 
     <li style="display:none" class="stateLogin hide-on-mobile"><a href="#" onclick="HH_Helpers.goToDashboard(); return false" class="bt bt-purple">Dashboard</a></li> 
     <li style="display:none" class="stateLogin hide-on-mobile"><a href="#" onclick="HH_Helpers.logout(); return false;" class="homeLogin bt bt-border-hh">Logout</a></li> 
     <li> 
      <div id="hamburguer"> 
       <span></span> 
       <span></span> 
       <span></span> 
       <span></span> 
      </div> </li> 
    </ul> 
   </div> 
   <div id="hamburguerSlider"> 
    <div class="menuMobile"> 
     <ul> 
      <li><a href="/how-it-works/" class="bt bt-border-hh">How it works</a></li> 
      <li><a href="/blog/" class="bt bt-border-hh">Posts</a></li> 
      <li><a href="/faq/" class="bt bt-border-hh">FAQ</a></li> 
      <li><a href="/jobs/" class="bt bt-border-hh">Jobs</a></li> 
      <li><a href="/success-stories/" class="bt bt-border-hh">Success Stories</a></li> 
      <li><a href="/contact/" class="bt bt-border-hh">Contact us</a></li> 
      <li class="stateLogout"><a href="/create-expert-account/" class="bt bt-border-hh">BECOME A MENTOR</a></li> 
      <li class="stateLogout"><a href="/login/" class="bt bt-border-hh">Sign In</a></li> 
      <li style="display:none" class="stateLogin"><a href="#" onclick="HH_Helpers.goToDashboard(); return false;" class="bt bt-border-hh">Dashboard</a></li> 
      <li style="display:none" class="stateLogin"><a href="#" onclick="HH_Helpers.logout(); return false;" class="bt bt-border-hh">Logout</a></li> 
     </ul> 
    </div> 
   </div> 
   <!-- [END] Header --> 
  </header> 
  <!-- POST page --> 
  <div class="header"> 
   <div class="grid-container"> 
    <h3 class="fontSizeH3">hack.hands() is an online service for live programing help available 24/7. <a href="/dashboard/request/expert" onclick="HH_Helpers.mainCTA(); return false;" class="bt bt-border-white">Get Started</a></h3> 
   </div> 
  </div> 
  <div class="page-BlogPost"> 
   <div class="grid-container post"> 
    <div class="grid-25 hide-on-tablet hide-on-mobile"> 
     <div class="postAuthor"> 
      <img class="thumb" src="https://secure.gravatar.com/avatar/e345bcfa4059c6caebedec1597f9eb5f?s=100&amp;d=https%3A%2F%2Fmentors-api-prod.s3-us-west-2.amazonaws.com%2Fstatic%2Favatar%2Favatar_normal.jpg"> 
      <div class="label">
       Written by
      </div> 
      <div class="name">
       <a href="/sahat">Sahat Yalkabov</a>
      </div> 
      <div class="location">
       America/New_York
      </div> 
      <div class="bio">
       Full Stack JavaScript developer and open-source contributor. Creator of the Hackathon Starter, Satellizer and Mega Boilerplate projects.
      </div> 
      <div class="links"> 
       <a rel="nofollow" target="_blank" href="https://github.com/sahat"><i class="icon icon-github"></i></a> 
       <a rel="nofollow" target="_blank" href="https://linkedin.com/in/sahatyalkabov"><i class="icon icon-linkedin"></i></a> 
      </div> 
      <div class="requestExpert"> 
       <a href="/dashboard/request/sahat/preferred" class="bt bt-hh">Request Expert</a> $2 / min 
      </div> 
     </div> 
    </div> 
    <div class="grid-75 tablet-grid-100"> 
     <div class="grid-parent"> 
      <div class="grid-50 date">
       Posted on December 9th 2014
      </div> 
      <div class="grid-50 social"> 
       <a href="#" onclick="share('google'); return false;"><i class="icon icon-google-plus"></i></a>
       <a href="#" onclick="share('facebook'); return false;"><i class="icon icon-facebook"></i></a>
       <a href="#" onclick="share('twitter'); return false;"><i class="icon icon-twitter"></i></a>
       <a href="#" onclick="share('pinterest'); return false;"><i class="icon icon-pinterest"></i></a>
       <a href="#" onclick="share('linkedin'); return false;"><i class="icon icon-linkedin"></i></a> 
      </div> 
     </div> 
     <h1>Build an Instagram clone with AngularJS, Satellizer, Node.js and MongoDB</h1> 
     <!-- <div class="date">Posted on December 9th 2014</div>--> 
     <!--<div class="tags">Posted on:  <a href="/blog/{{tag}}/" rel="tag">{{tag}}</a>{% if forloop.last != true %},{% endif %}{% endfor %}</div>
			--> 
     <div class="body"> 
      <h2 id="1-introduction">1. Introduction</h2> 
      <p><a target="_blank" rel="nofollow" href="https://github.com/sahat/satellizer">Satellizer</a> is a token-based authentication module for AngularJS that comes with built-in support for Facebook, Google, LinkedIn, Twitter, GitHub, Yahoo and Windows Live OAuth providers, as well as a more traditional email and password sign-in flow.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-09-20-03.58.52.png" alt="Screenshot 2014-09-20 03.58.52">The motivation to build Satellizer came from my frustration with existing <span style="font-family: proximanova_regular, Arial, sans-serif;font-size: 16px">authentication solutions for AngularJS at the time of writing my blog post </span><a target="_blank" rel="nofollow" href="http://sahatyalkabov.com/create-a-tv-show-tracker-using-angularjs-nodejs-and-mongodb/">Create a TV Show Tracker using AngularJS, Node.js and MongoDB</a>. Although Satellizer gained quite a bit of popularity, building it was not without its own set of challenges:</p> 
      <ol> 
       <li>Writing a library is very different from writing an application. Before Satellizer, I have never written a single JavaScript library, only web apps and boilerplates. I wasn't even sure where to start with building an AngularJS module.</li> 
       <li>Deciding on the authentication flow: popup versus redirect, authentication library (e.g. <a target="_blank" rel="nofollow" href="http://passportjs.org">Passport</a> for Node.js or <a target="_blank" rel="nofollow" href="https://github.com/intridea/omniauth">Omniauth</a> for Ruby) versus the manual login flow on the back-end, embed client-side SDKs (Facebook, Google, LinkedIn) versus custom OAuth 1.0 and OAuth 2.0 implementations. These are some big decisions that could have resulted in a completely different library.</li> 
       <li>Since I had decided to make Satellizer as flexible as possible by not relying on any third-party SDKs, I had to learn and master OAuth 1.0 and OAuth 2.0 authentication flows in order to implement it in the Satellizer module.</li> 
       <li><a target="_blank" rel="nofollow" href="http://i1.kym-cdn.com/photos/images/original/000/346/560/157.jpg">Support for Internet Explorer</a>.</li> 
      </ol> 
      <p>Ok, enough of Satellizer's backstory. Let's get started and build something awesome with Satellizer and AngularJS. One last thing, if you find any typos or mistakes please report them so I could update the post as necessary.</p> 
      <p>Enjoy this tutorial.</p> 
      <h2 id="2-demo-source-code-toc-">2. Demo &amp; Source Code <a href="#toc"></a></h2> 
      <p>If you do not have time to read the entire post, here are the links for <a target="_blank" rel="nofollow" href="https://dl.dropboxusercontent.com/u/14131013/instagram/index.html">Live Demo</a> and <a target="_blank" rel="nofollow" href="https://github.com/sahat/instagram-hackhands">GitHub Project</a>. This is what we will be building in this tutorial:</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-22-16.59.29.png" alt="Screenshot 2014-10-22 16.59.29"></p> 
      <blockquote> 
       <p><strong>Disclaimer:</strong> This app is not intended to be a fully-featured Instagram clone but rather I want to demonstrate how easy it is to implement user authentication with Satellizer. I chose Instagram in particular because the <a target="_blank" rel="nofollow" href="https://satellizer.herokuapp.com">Satellizer Demo</a> already comes with Facebook, Google, Twitter, LinkedIn, GitHub, Yahoo, Windows Live and Foursquare sign-in options, and so I wanted to implement something different this time.</p> 
      </blockquote> 
      <h2 id="3-getting-started">3. Getting Started</h2> 
      <p>Let's start by downloading the latest version of AngularJS. Be sure to click on <a target="_blank" rel="nofollow" href="https://code.angularjs.org/1.3.6/">Browse additional modules</a> and download <span style="text-decoration: underline">angular-route.js</span> and <span style="text-decoration: underline">angular-messages.js</span>. The former is for routing (page navigation), while the latter is for displaying input validation error messages.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-22-14.32.34.png" alt="Screenshot 2014-10-22 14.32.34">Create a new directory named <strong>instagram</strong>. Inside, create another directory named <strong>client</strong>. Inside <strong>client</strong>, create <strong>vendor</strong> directory. Finally, copy the files we just downloaded - <span style="text-decoration: underline">angular.js</span>, <span style="text-decoration: underline">angular-messages.js</span> and <span style="text-decoration: underline">angular-route.js.</span> into <strong>vendor</strong> directory.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-22-16.21.47.png" alt=""></p> 
      <p>In the <strong>client</strong> directory create a new file <span style="text-decoration: underline">index.html</span> with the following contents:</p> 
      <pre><code class="hljs xml"><span class="hljs-doctype">&lt;!doctype html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span> <span class="hljs-attribute">ng-app</span>=<span class="hljs-value">"Instagram"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">http-equiv</span>=<span class="hljs-value">"X-UA-Compatible"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"IE=edge"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"viewport"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"width=device-width, initial-scale=1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>Instagram - Powered by Satellizer<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"//maxcdn.bootstrapcdn.com/bootswatch/3.3.0/paper/bootstrap.min.css"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"//code.ionicframework.com/ionicons/1.5.2/css/ionicons.min.css"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"css/styles.css"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">ng-view</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"vendor/angular.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"vendor/angular-route.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"vendor/angular-messages.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"app.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre> 
      <p>The <strong>ng-app</strong> attribute is used for bootstrapping an AngularJS application. It designates the root element of the application and is usually placed on <strong></strong> or <strong></strong> tags. The <strong>ng-view</strong> works alongside <a target="_blank" rel="nofollow" href="https://docs.angularjs.org/api/ngRoute">ngRoute</a> by including the rendered template of the current route into the main layout - <span style="text-decoration: underline">index.html</span> in this case. When the current route changes, the included view changes with it as well.</p> 
      <p>Next, in the same directory create a new file called <span style="text-decoration: underline">app.js</span>. It will be the entry point of our AngularJS application.</p> 
      <pre><code class="hljs javascript">angular.module(<span class="hljs-string">'Instagram'</span>, [<span class="hljs-string">'ngRoute'</span>, <span class="hljs-string">'ngMessages'</span>])
  .config(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($routeProvider)</span> </span>{

  });
</code></pre> 
      <p>Angular uses modules to organize application code. A module can depend on other modules, in this case - <a target="_blank" rel="nofollow" href="https://docs.angularjs.org/api/ngRoute/">ngRoute</a> and <a target="_blank" rel="nofollow" href="https://docs.angularjs.org/api/ngMessages/">ngMessages</a>. Each module is like a mini-application with its own potential models, controllers, services, directives, filters, etc.</p> 
      <p>As you may have guessed already, the first argument is the name of the module and the second argument is an array of module dependencies. If you do not have any dependencies, an empty array must be provided either way. Omitting an array has a "getter" behavior. For example, when we need to reference a module in order to create a new controllers, services or directives we will simply use <strong>angular.module('Instagram')</strong> without the second argument.</p> 
      <p>The <strong>.config()</strong> method above is executed during the provider registration and configuration phase. You can only inject <a target="_blank" rel="nofollow" href="https://docs.angularjs.org/guide/providers">providers</a> and <a target="_blank" rel="nofollow" href="http://lostechies.com/gabrielschenker/2014/01/14/angularjspart-9-values-and-constants/">constants</a> into configuration blocks, hence the <strong>$routeProvider</strong> and not <strong>$route</strong>. This is where you would set-up routes, override Satellizer's default options, or potentially modify HTTP requests/responses via <a target="_blank" rel="nofollow" href="http://www.webdeveasy.com/interceptors-in-angularjs-and-useful-examples/">interceptors</a>.</p> 
      <p>You can read more about AngularJS modules <a target="_blank" rel="nofollow" href="https://docs.angularjs.org/guide/module">here</a>.</p> 
      <blockquote> 
       <p><strong>Note:</strong> The module name and the <strong>ng-app</strong> attribute value in <span style="text-decoration: underline">index.html</span> have to match.</p> 
      </blockquote> 
      <p>Here is our project directory structure so far:</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-22-16.22.16.png" alt=""></p> 
      <p>Let's go ahead and start a Python web server to see how our page looks. You could double click the <span style="text-decoration: underline">index.html</span>and that would still work for now, but as soon as we start making AJAX requests you will see an error that looks something like this:</p> 
      <p>Cross origin requests are only supported for protocol schemes: http, data, chrome-extension, https, chrome-extension-resource.</p> 
      <p>And that's why we need a web server. You don't have to use Python but it is by far the easiest one to use. If you are on a Mac OS X or Linux then you already have Python installed, but if you are on a Windows machine, <a target="_blank" rel="nofollow" href="https://www.python.org/downloads/">download</a> and install Python 2.x or 3.x on your machine before proceeding.</p> 
      <p>Open the Terminal then navigate to our <strong>client</strong> directory and enter the following command:</p> 
      <pre><code class="hljs bash">$ python -m SimpleHTTPServer
</code></pre> 
      <blockquote> 
       <p><strong>Note:</strong> Windows users, be sure to check out <a target="_blank" rel="nofollow" href="http://bliker.github.io/cmder/">cmder</a> console emulator. It is the closest thing to Linux and Mac OS X Terminal for Windows operating system. I absolutely love using it when I am coding on my Surface Pro 3.</p> 
      </blockquote> 
      <p><img src="http://bliker.github.io/cmder/img/main.jpg" alt=""></p> 
      <p>Go to <a target="_blank" rel="nofollow" href="http://localhost:8000">http://localhost:8000</a> and you should see a blank page since we have not added any styles or content yet. Open Google Chrome's JavaScript Console <span style="color: #333333">(<strong> Mac OS X</strong>: ? + ? + J or <strong> Windows</strong>: Ctrl + Shift + J) and verify</span> there are no errors.</p> 
      <h2 id="4-bootstrapping-ui">4. Bootstrapping UI</h2> 
      <p>Since we have included a <a target="_blank" rel="nofollow" href="http://bootswatch.com/paper/">Paper Bootstrap</a> theme from CDN let's add a Navbar component to our <span style="text-decoration: underline">index.html</span> page. Add the following code right before <code>&lt;div ng-view&gt;&lt;/div&gt;</code> so that the Navbar could be visible on all pages.</p> 
      <pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar navbar-default navbar-static-top"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"nav navbar-nav"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-brand"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">i</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ion-images"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">i</span>&gt;</span> Instagram<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/"</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/login"</span>&gt;</span>Log in<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/signup"</span>&gt;</span>Sign up<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">ng-click</span>=<span class="hljs-value">"logout()"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">""</span>&gt;</span>Logout<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-22-17.13.53.png" alt="">Before moving on any further let's get the CSS styles out of the way. This blog post is not about CSS and for that reason I will not be covering it here. There is really not much to cover anyway since it is mostly Boostrap classes overrides. If you are interested in learning about CSS best practices I would recommend checking out the following blog posts: <a target="_blank" rel="nofollow" href="https://medium.com/@fat/mediums-css-is-actually-pretty-fucking-good-b8e2a6c78b06">Medium’s CSS is actually pretty f<em>*</em>ing good</a>, <a target="_blank" rel="nofollow" href="http://oli.jp/2011/ids/">Don’t use IDs in CSS selectors?</a> and <a target="_blank" rel="nofollow" href="http://thesassway.com/beginner">The Sass Way</a>.</p> 
      <p>Create a new directory called <strong>css</strong> inside <strong>client</strong>, then inside this new <strong>css</strong> directory create <span style="text-decoration: underline">styles.css</span> file and paste the following:</p> 
      <pre><code class="hljs css"><span class="hljs-tag">body</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#d8d8d8</span></span></span>; }</span>

<span class="hljs-tag">a</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#3f729b</span></span></span>; }</span>

<span class="hljs-rule"><span class="hljs-attribute">a</span>:<span class="hljs-value">hover { color: <span class="hljs-hexcolor">#1c5380</span></span></span>;
}

<span class="hljs-class">.text-muted</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#90939a</span></span></span>; }</span>

<span class="hljs-class">.navbar</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">min-height</span>:<span class="hljs-value"> <span class="hljs-number">50px</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">border</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">box-shadow</span>:<span class="hljs-value"> <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">5px</span> <span class="hljs-number">0</span> <span class="hljs-function">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, .<span class="hljs-number">26</span>)</span></span>; }</span>

<span class="hljs-class">.navbar-header</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">float</span>:<span class="hljs-value"> left</span></span>; <span class="hljs-rule"><span class="hljs-attribute">padding-left</span>:<span class="hljs-value"> <span class="hljs-number">15px</span></span></span>; }</span>

<span class="hljs-class">.navbar-brand</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">50px</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">0</span> <span class="hljs-number">15px</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> inherit</span></span>; <span class="hljs-rule"><span class="hljs-attribute">line-height</span>:<span class="hljs-value"> <span class="hljs-number">50px</span></span></span>; }</span>

<span class="hljs-class">.navbar-nav</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">float</span>:<span class="hljs-value"> left</span></span>; <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>; }</span>

<span class="hljs-class">.navbar-nav</span> &gt; <span class="hljs-tag">li</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">float</span>:<span class="hljs-value"> left</span></span>; }</span>

<span class="hljs-class">.navbar-nav</span> &gt; <span class="hljs-tag">li</span> &gt; <span class="hljs-tag">a</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">0</span> <span class="hljs-number">15px</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">line-height</span>:<span class="hljs-value"> <span class="hljs-number">50px</span></span></span>; }</span>

<span class="hljs-class">.navbar-text</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">margin-top</span>:<span class="hljs-value"> <span class="hljs-number">10px</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">margin-bottom</span>:<span class="hljs-value"> <span class="hljs-number">10px</span></span></span>; }</span>

<span class="hljs-class">.center-form</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">315px</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> <span class="hljs-number">10%</span> auto</span></span>; }</span>

<span class="hljs-class">.signup-or-separator</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">position</span>:<span class="hljs-value"> relative</span></span>; <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">29px</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> <span class="hljs-number">5px</span> <span class="hljs-number">0</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value"> center</span></span>; <span class="hljs-rule"><span class="hljs-attribute">background</span>:<span class="hljs-value"> none</span></span>; }</span>

<span class="hljs-class">.signup-or-separator</span> <span class="hljs-tag">hr</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">90%</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> -<span class="hljs-number">16px</span> auto <span class="hljs-number">10px</span> auto</span></span>; <span class="hljs-rule"><span class="hljs-attribute">border-top</span>:<span class="hljs-value"> <span class="hljs-number">1px</span> solid <span class="hljs-hexcolor">#dce0e0</span></span></span>; }</span>

<span class="hljs-class">.signup-or-separator</span> <span class="hljs-class">.text</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> inline-block</span></span>; <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">8px</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#fff</span></span></span>; }</span>

<span class="hljs-class">.has-feedback</span> <span class="hljs-class">.form-control-feedback</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">top</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">left</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">46px</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">46px</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">line-height</span>:<span class="hljs-value"> <span class="hljs-number">46px</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#555</span></span></span>; }</span>

<span class="hljs-attr_selector">[class^='ion-']</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"> <span class="hljs-number">1.2em</span></span></span>; }</span>

<span class="hljs-class">.has-feedback</span> <span class="hljs-class">.form-control</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">padding-left</span>:<span class="hljs-value"> <span class="hljs-number">42px</span></span></span>; }</span>

<span class="hljs-class">.btn-instagram</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#fff</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#517fa4</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">border</span>:<span class="hljs-value"> <span class="hljs-number">1px</span> solid <span class="hljs-hexcolor">#456c8c</span></span></span>; }</span>

<span class="hljs-rule"><span class="hljs-attribute">.btn-instagram</span>:<span class="hljs-value">hover, .btn-instagram:focus { color: <span class="hljs-hexcolor">#fff</span></span></span>;
  <span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#303030</span></span></span>;
}

<span class="hljs-class">.media-object</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> inline-block</span></span>; <span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"> <span class="hljs-number">32px</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">32px</span></span></span>; }</span>

<span class="hljs-class">.media-heading</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">display</span>:<span class="hljs-value"> block</span></span>; <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"> <span class="hljs-hexcolor">#3f729b</span></span></span>; }</span>

<span class="hljs-rule"><span class="hljs-attribute">.media-heading</span>:<span class="hljs-value">hover { color: <span class="hljs-hexcolor">#1c5380</span></span></span>;
}

<span class="hljs-class">.soften</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">1px</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">background-image</span>:<span class="hljs-value"> <span class="hljs-function">-webkit-linear-gradient</span>(left, <span class="hljs-function">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-function">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, .<span class="hljs-number">1</span>), <span class="hljs-function">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))</span></span>; <span class="hljs-rule"><span class="hljs-attribute">background-image</span>:<span class="hljs-value"> <span class="hljs-function">-moz-linear-gradient</span>(left, <span class="hljs-function">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-function">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, .<span class="hljs-number">1</span>), <span class="hljs-function">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))</span></span>; <span class="hljs-rule"><span class="hljs-attribute">background-image</span>:<span class="hljs-value"> <span class="hljs-function">-ms-linear-gradient</span>(left, <span class="hljs-function">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-function">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, .<span class="hljs-number">1</span>), <span class="hljs-function">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))</span></span>; <span class="hljs-rule"><span class="hljs-attribute">border</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>; }</span>

<span class="hljs-class">.thumbnail</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">border</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">border-radius</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">box-shadow</span>:<span class="hljs-value"> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-function">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, .<span class="hljs-number">04</span>),<span class="hljs-number">0</span> <span class="hljs-number">1px</span> <span class="hljs-number">5px</span> <span class="hljs-function">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, .<span class="hljs-number">1</span>)</span></span>; }</span>
</code></pre> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-22-17.19.22.png" alt="Screenshot 2014-10-22 17.19.22">And lastly, add the stylesheet reference to the <strong></strong> block of <span style="text-decoration: underline">index.html:</span></p> 
      <pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"css/styles.css"</span>&gt;</span>
</code></pre> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-22-19.24.10.png" alt="Screenshot 2014-10-22 19.24.10"></p> 
      <h2 id="5-routing">5. Routing</h2> 
      <p>Next, we will create a grid of thumbnails on the home page. For that we will need to setup Angular routes that render partial templates based on the URL. For example, when a user visits <strong><a target="_blank" rel="nofollow" href="http://localhost:8000/">http://localhost:8000/</a> </strong>the router will render the <span style="text-decoration: underline">home.html</span> template. Similarly, when <strong>**<a target="_blank" rel="nofollow" href="http://localhost:8000">http://localhost:8000</a></strong>/login **is visted, the router will render the <span style="text-decoration: underline">login.html</span> template.</p> 
      <blockquote> 
       <p><strong>Note:</strong> I am using <a target="_blank" rel="nofollow" href="https://docs.angularjs.org/api/ngRoute/service/$route">ngRoute</a> for the sake of simplicity. If, however, you prefer to use <a target="_blank" rel="nofollow" href="https://github.com/angular-ui/ui-router">ui-router</a> instead, then by all means use that module. For the difference between two modules take a look at <a target="_blank" rel="nofollow" href="http://stackoverflow.com/questions/21023763/difference-between-angular-route-and-angular-ui-router">Difference between angular-route and angular-ui-router</a> on StackOverflow.</p> 
      </blockquote> 
      <p>A template is just a snippet of HTML-like code that gets inserted into the <strong>ng-view</strong> block of <span style="text-decoration: underline">index.html</span>. By placing the Navbar inside i<span style="text-decoration: underline">ndex.html</span> we know that it will be rendered in every template. If you want to have the Navbar displayed only on some pages, then you would need to place it on those specific templates, not inside <span style="text-decoration: underline">index.html</span>. For more informationsee the <a target="_blank" rel="nofollow" href="https://docs.angularjs.org/api/ng/directive/ngInclude">ng-include</a> documentation to find out how you could embed external HTML fragments into your templates to avoid duplicating Navbar across multiple templates.</p> 
      <p>Open <span style="text-decoration: underline">app.js</span> in the <strong>client</strong> directory and add the following code inside the <strong>.config()</strong> function block:</p> 
      <pre><code class="hljs javascript">$routeProvider
  .when(<span class="hljs-string">'/'</span>, {
    templateUrl: <span class="hljs-string">'views/home.html'</span>,
    controller: <span class="hljs-string">'HomeCtrl'</span>
  })
  .when(<span class="hljs-string">'/login'</span>, {
    templateUrl: <span class="hljs-string">'views/login.html'</span>,
    controller: <span class="hljs-string">'LoginCtrl'</span>
  })
  .when(<span class="hljs-string">'/signup'</span>, {
    templateUrl: <span class="hljs-string">'views/signup.html'</span>,
    controller: <span class="hljs-string">'SignupCtrl'</span>
  })
  .when(<span class="hljs-string">'/photo/:id'</span>, {
    templateUrl: <span class="hljs-string">'views/detail.html'</span>,
    controller: <span class="hljs-string">'DetailCtrl'</span>
  })
  .otherwise(<span class="hljs-string">'/'</span>);
</code></pre> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-22-22.53.49.png" alt="Screenshot 2014-10-22 22.53.49"></p> 
      <p>Each <strong>.when**</strong>()<strong> method above takes a relative URL path as its first argument and an object as its second argument. When we visit the index route "</strong>/<strong>"Angular will load <span style="text-decoration: underline">home.html</span> from the </strong>views<strong> directory and make </strong>HomeCtrl** controller available to that template.</p> 
      <p>The colon in <strong>/photos/:id</strong> route tells us that it is a dynamic route, where <strong>id</strong> is a unique Instagram photo id. For instance, this route will match the following URL:</p> 
      <pre><code class="hljs bash">http://localhost:<span class="hljs-number">8000</span>/photos/<span class="hljs-number">85391138</span>efe54d929d17e3c18bf634fe
</code></pre> 
      <p>The last, optional method <strong>.otherwise()</strong> will match any path that is not one of the specified routes above. This is where you could also redirect to a 404 page instead of a home page like we have above.</p> 
      <p>Ok, if you refresh the browser now, you will see a bunch of <strong>404 File Not Found</strong> errors because <strong>$routeProvider</strong> is trying to load templates and controllers that do not yet exist. Let's fix that in the next section!</p> 
      <h2 id="6-home-page">6. Home Page</h2> 
      <p>Create two new directories named <strong>controllers</strong> and <strong>views</strong>. Inside <strong>controllers</strong> create the following JavaScript files:</p> 
      <ul> 
       <li>detail.js</li> 
       <li>home.js</li> 
       <li>login.js</li> 
       <li>navbar.js</li> 
       <li>signup.js</li> 
      </ul> 
      <p>In the <strong>views</strong> directory create the following HTML files:</p> 
      <ul> 
       <li>detail.html</li> 
       <li>home.html</li> 
       <li>login.html</li> 
       <li>signup.html</li> 
      </ul> 
      <blockquote> 
       <p><strong>Note:</strong> The <span style="text-decoration: underline">navbar.js</span> controller does not have a corresponding template. We will include an inline controller directly on the Navbar component in <span style="text-decoration: underline">index.html</span> to handle the logout action and a few other things.</p> 
      </blockquote> 
      <p>We need to include above JavaScript files from the <strong>controllers</strong> directory into <span style="text-decoration: underline">index.html</span> to load them.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-23-00.50.21.png" alt="Screenshot 2014-10-23 00.50.21">Open <strong>views/</strong><span style="text-decoration: underline">home.html</span> template and paste the following code:</p> 
      <pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container"</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">ng-if</span>=<span class="hljs-value">"isAuthenticated() &amp;&amp; currentUser.username"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"row"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">ng-repeat</span>=<span class="hljs-value">"photo in photos"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"col-lg-2 col-sm-3 col-xs-4"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/photo/{{photo.id}}"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">ng-src</span>=<span class="hljs-value">"{{photo.images.standard_resolution.url}}"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"thumbnail img-responsive"</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">ng-if</span>=<span class="hljs-value">"!isAuthenticated()"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"jumbotron"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">h2</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">i</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ion-images"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">i</span>&gt;</span> Instagram<span class="hljs-tag">&lt;/<span class="hljs-title">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>This is a basic Instagram clone powered by <span class="hljs-tag">&lt;<span class="hljs-title">strong</span>&gt;</span>Satellizer<span class="hljs-tag">&lt;/<span class="hljs-title">strong</span>&gt;</span>. To continue, please log in with your Instagram account or create a new email account.<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"btn btn-lg btn-success"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/login"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">i</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ion-log-in"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">i</span>&gt;</span> Log in<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"btn btn-lg btn-primary"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/signup"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">i</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ion-person-add"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">i</span>&gt;</span> Create account<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">ng-if</span>=<span class="hljs-value">"isAuthenticated() &amp;&amp; !currentUser.username"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"center-form panel"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"panel-body"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">h5</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"text-center"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">i</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ion-link"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">i</span>&gt;</span> Link Account<span class="hljs-tag">&lt;/<span class="hljs-title">h5</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>To complete the registration process you must link your Instagram account.<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"btn btn-block btn-instagram"</span> <span class="hljs-attribute">ng-click</span>=<span class="hljs-value">"linkInstagram()"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">i</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ion-social-instagram"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">i</span>&gt;</span> Sign in with Instagram
      <span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre> 
      <p>This template consists of <strong>3</strong> main parts:</p> 
      <ol> 
       <li><strong>User is authenticated via Email or OAuth 2.0 and has a valid Instagram username</strong>. What this means is that a user has successfully signed in with Instagram or created an Email account and later connected it with his or her Instagram account.</li> 
       <li><strong>User is not authenticated</strong>. This could a visitor seeing the page for the first time.</li> 
       <li><strong>User is authenticated via Email but does not have a valid Instagram username</strong>. At this point an account must be linked with Instagram before being able to do anything.</li> 
      </ol> 
      <blockquote> 
       <p><strong>Note:</strong> I am using the Instagram username as a unique identifier to determine whether or not a user has signed in with Instagram and authorized the app.</p> 
      </blockquote> 
      <p>I could have certaintly made my life much easier by using just the Instagram authentication, but I wanted to demonstrate how to handle account linking and account merging on the back-end because it seems like such a common problem.</p> 
      <p>Let's break it down line by line. The <strong>ng-if</strong> attribute is a special Angular directive that conditionally renders an HTML block based on some expression. If the expression inside <strong>ng-if</strong> evaluates to <strong>false</strong> then the element is removed from the DOM, otherwise a clone of the element is reinserted into the DOM.</p> 
      <p>The <strong>ng-repeat</strong> attribute is another special Angular directive that is essentially a <strong>for-each</strong> loop designed for Angular templates. Unlike Handlebars or Jade templates where you <a target="_blank" rel="nofollow" href="http://jade-lang.com/reference/iteration/">wrap the for loop around the element</a>, in Angular the <strong>ng-repeat</strong> will iterate over the element itself on which it is defined.</p> 
      <p>In order to avoid fetching images quite literally from<strong> {{photo.images.standard_resolution.url}} </strong>we need to use <strong>ng-src</strong> attribute on <strong><img></strong> element. Angular will automatically evaluate that expression and insert a correct string value.</p> 
      <p>You may have noticed expressions like <strong>isAuthenticated()</strong>, <strong>linkInstagram()</strong> and <strong>currentUser</strong>. These are functions and objects that we are going to create next in the <strong>HomeCtrl </strong>controller.</p> 
      <blockquote> 
       <p><strong>Note:</strong> Don't forget to prepend <em>href</em> paths with a hash, i.e. <strong>#/login</strong> instead of <strong>/login</strong>. That is necessary unless you are using HTML5 History API (pushState). However, it is not as simple as adding <a target="_blank" rel="nofollow" href="http://stackoverflow.com/questions/11095179/using-html5-pushstate-on-angular-js">one line of code</a>, you still need to have web server rewrite rules or page redirects on the back-end to make the whole thing work.</p> 
      </blockquote> 
      <p>Open <strong>controllers</strong>/<span style="text-decoration: underline">home.js</span> and paste the following code (we will implement these functions in the next section):</p> 
      <pre><code class="hljs javascript">angular.module(<span class="hljs-string">'Instagram'</span>)
  .controller(<span class="hljs-string">'HomeCtrl'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($scope)</span> </span>{

    $scope.isAuthenticated = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-comment">// check if logged in</span>
    };

    $scope.linkInstagram = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-comment">// connect email account with instagram</span>
    };

  });
</code></pre> 
      <p>I don't think I could explain Angular controllers any better than Todd Motto, the way he did in his <a target="_blank" rel="nofollow" href="https://www.airpair.com/angularjs/posts/angularjs-tutorial#5-controllers">AngularJS guide</a>. That post is the first thing anyone should read who is starting out with AngularJS. I am really surprised it has not been featured on front page of <a target="_blank" rel="nofollow" href="https://angularjs.org/">https://angularjs.org</a>.</p> 
      <p>Reload the browser and you should see the following page:<br><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-23-01.53.11.png" alt="Screenshot 2014-10-23 01.53.11"></p> 
      <h2 id="7-satellizer">7. Satellizer</h2> 
      <p>Go to <a target="_blank" rel="nofollow" href="https://github.com/sahat/satellizer">https://github.com/sahat/satellizer</a> and click on the <strong> Download ZIP</strong> button on the right sidebar. Extract the archive, then copy <span style="text-decoration: underline">satellizer.js</span> to <strong>instagram/client/vendor</strong> directory.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-23-20.23.26.png" alt="Screenshot 2014-10-23 20.23.26"></p> 
      <p>Open <span style="text-decoration: underline">index.html</span> and include the reference to Satellizer before <strong>app.js</strong> script tag:</p> 
      <pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"vendor/satellizer.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"app.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
...
</code></pre> 
      <p>Open <span style="text-decoration: underline">app.js</span>, import the Satellizer module and add <strong>$authProvider</strong> parameter to the <strong>.config</strong> block:</p> 
      <pre><code class="hljs javascript">angular.module(<span class="hljs-string">'Instagram'</span>, [<span class="hljs-string">'ngRoute'</span>, <span class="hljs-string">'ngMessages'</span>, <span class="hljs-string">'satellizer'</span>])
  .config(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($routeProvider, $authProvider)</span> </span>{
</code></pre> 
      <p>By default, Satellizer module comes with the following default OAuth providers at the moment of this writing: Google, Facebook, Twitter, LinkedIn, GitHub, Yahoo and Windows Live. For these providers you may only need to pass a <em>Client ID</em> information as long as you are satisfied with the <a target="_blank" rel="nofollow" href="https://github.com/sahat/satellizer#configuration">default configuration options</a>.</p> 
      <p>For Instagram, or any other generic OAuth 2.0 provider, you are required to pass additional information. In the same <span style="text-decoration: underline">app.js</span> file, after <strong>$routeProvider</strong>, add the following code:</p> 
      <pre><code class="hljs javascript">$authProvider.loginUrl = <span class="hljs-string">'http://localhost:3000/auth/login'</span>;
$authProvider.signupUrl = <span class="hljs-string">'http://localhost:3000/auth/signup'</span>;
$authProvider.oauth2({
  name: <span class="hljs-string">'instagram'</span>,
  url: <span class="hljs-string">'http://localhost:3000/auth/instagram'</span>,
  redirectUri: <span class="hljs-string">'http://localhost:8000'</span>,
  clientId: <span class="hljs-string">'799d1f8ea0e44ac8b70e7f18fcacedd1'</span>,
  requiredUrlParams: [<span class="hljs-string">'scope'</span>],
  scope: [<span class="hljs-string">'likes'</span>],
  scopeDelimiter: <span class="hljs-string">'+'</span>,
  authorizationEndpoint: <span class="hljs-string">'https://api.instagram.com/oauth/authorize'</span>
});
</code></pre> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-23-21.09.17.png" alt="">As you may have guessed, just by looking at the directory structure, we will be running the Express server on a separate port from the Angular app. Our API back-end will be completely independent of the front-end. I chose to do it this way because it seems like a common use case with single page apps and since I have never built a web app using this architecture before, I thought this would be a good time as any to do it.</p> 
      <p>I typically include my single page apps inside the <strong>public</strong> directory that is served by Express or some other web server. So, because of that, I never had to deal with CORS (cross original resource sharing) business.</p> 
      <p>First thing you will notice is that we are using <em>absolute URLs</em> because our server is running on a different port. Our server could potentially be on an completely different host, e.g. Node.js back-end hosted on <a href="www.digitalocean.com/?refcode=31bf8418522c">Digital Ocean</a> and AngularJS front-end hosted on <a target="_blank" rel="nofollow" href="http://heroku.com">Heroku</a> or <a target="_blank" rel="nofollow" href="https://pages.github.com/">GitHub Pages</a>.</p> 
      <p>Both <strong>loginUrl</strong> and <strong>signupUrl </strong>are server endpoints to handle user login and registration. Satellizer will send a POST request to these endpoints when we call <strong>$auth.login()</strong> and <strong>$auth.signup()</strong> from <strong>LoginCtrl</strong> and <strong>SignupCtrl</strong> controllers.</p> 
      <p>The <strong>name </strong>could be anything as long as you are consistent with yourself when calling <strong>$auth.authenticate()</strong> method.</p> 
      <p>The <strong>url</strong> server endpoint is where most of the work will be done. It will handle Instagram account creation, account merging, returning existing account if a user logs in a second time.</p> 
      <p>The <strong>redirectUri</strong> must match the the <em>Redirect URI</em> specified in your app on <a target="_blank" rel="nofollow" href="http://instagram.com/developer">instagram.com/developer</a> as shown in the screenshot below. This is where Instagram will redirect to after user successfully authorizes our app to use their profile information, feed and potentially perform actions like commenting on and liking photos on their behalf.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-23-21.21.48.png" alt="Screenshot 2014-10-23 21.21.48"></p> 
      <p>The <strong>scope</strong> and <strong>scopeDelimiter</strong> are related to each other in that the <a target="_blank" rel="nofollow" href="http://instagram.com/developer/authentication/#scope">scope</a> is used for requesting additional permissions such liking a photo, commenting on a photo, following or unfollowing users, while the <strong>scopeDelimiter</strong> is a separator between multiple scopes. Built-in providers already have a proper scope separator so you don't have to think about that.</p> 
      <p>When I built Satellizer I used a <em>comma</em> to separate multiple scopes until I found out that Google and some other providers use <em>space</em> character instead. Instagram on the other hand uses an escaped space ("+"). To better illustrate this point here are a few examples:</p> 
      <ul> 
       <li><strong>Facebook:</strong> scope=email,user_likes,user_friends</li> 
       <li><strong>Google:</strong> scope=openid%20email%20profile</li> 
       <li><strong>Instagram:</strong> scope=likes+comments+relationships</li> 
       <li><strong>GitHub:</strong> scope=user,public_repo,gist</li> 
      </ul> 
      <blockquote> 
       <p><span class="s1"><strong>Note:</strong> If you think that having a <strong>scope</strong> array and a <strong>scopeDelimiter</strong> string is too confusing, I could instead use a <strong>scope</strong> string, provided that you will be responsible for entering a scope in using a proper format specified by that OAuth provider. If you have any feedback on this matter please <a target="_blank" rel="nofollow" href="https://github.com/sahat/satellizer/issues">open an issue</a> on GitHub.</span></p> 
      </blockquote> 
      <p>Finally, the <strong>authorizationEndpoint</strong> is the URL for the consent screen. Unfortunately, sometimes it requires a little bit of digging into an API documentation to find that URL. A <a target="_blank" rel="nofollow" href="https://developer.github.com/v3/oauth/">good documentation</a> will make it easily accessible for developers.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-23-22.11.24.png" alt="Screenshot 2014-10-23 22.11.24"></p> 
      <p>Before going any further, let's create a new app on <a target="_blank" rel="nofollow" href="http://instagram.com/developer/clients/register/">instagram.com/developer/clients/register/</a> because you should be using your own <em>Client ID</em> and <em>Client Secret</em>, not mine. Enter your <em>application name</em>, <em>description,</em> then set <em>Redirect URI</em> and <em>Website</em> to <strong><a target="_blank" rel="nofollow" href="http://localhost:8000">http://localhost:8000</a></strong>. Next, replace my <strong>clientId</strong> string in <span style="text-decoration: underline">app.js</span> and my <strong>clientSecret</strong> in <span style="text-decoration: underline"> <strong>server</strong>/config.js</span> with the ones you just obtained from Instagram.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screen-Shot-2014-11-23-at-7.35.54-PM.png" alt="Screen Shot 2014-11-23 at 7.35.54 PM"></p> 
      <p>Go back to <strong>HomeCtrl</strong> controller in <span style="text-decoration: underline"><strong>controllers</strong>/home.js</span> and update your code. First, inject the following services:</p> 
      <pre><code class="hljs javascript">.controller(<span class="hljs-string">'HomeCtrl'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($scope, $window, $rootScope, $auth)</span> </span>{
</code></pre> 
      <blockquote> 
       <p><strong>Note:</strong> $scope, $window and $rootScope are built-in Angular services.</p> 
      </blockquote> 
      <p>Next, we will use Satellizer's <strong>$auth</strong> service to implement <strong>isAuthenticated()</strong> and <strong>linkInstagram()</strong> functions:</p> 
      <pre><code class="hljs javascript">$scope.isAuthenticated = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> $auth.isAuthenticated();
};

$scope.linkInstagram = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  $auth.link(<span class="hljs-string">'instagram'</span>)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
      $<span class="hljs-built_in">window</span>.localStorage.currentUser = <span class="hljs-built_in">JSON</span>.stringify(response.data.user);
      $rootScope.currentUser = <span class="hljs-built_in">JSON</span>.parse($<span class="hljs-built_in">window</span>.localStorage.currentUser);
    });
};
</code></pre> 
      <blockquote> 
       <p><strong>Note:</strong> Hopefully you are familiar with the promises syntax using <strong>.then </strong>/ <strong>.catch</strong> methods. If, however, you have only used callbacks up to this point and promises are completely alien to you then you may want to watch this <a target="_blank" rel="nofollow" href="https://thinkster.io/egghead/promises/">Egghead.io screencast</a> on AngularJS promises. <em>I actually didn't understand how promises work in JavaScript until earlier this year when I started learning AngularJS.</em></p> 
      </blockquote> 
      <p>If you refresh the browser you will not see anything new because <strong>isAuthenticated()</strong> will still return <em>false</em> and the button with <strong>linkInstagram()</strong> action will not be visible just yet.Let's step back for a moment to see what we have so far. This would be a great time to catch up and see if you have missed anything along the way.<img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-26-22.23.58.png" alt=""> <img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-23-22.53.22.png" alt="Screenshot 2014-10-23 22.53.22"> <img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-23-22.53.13.png" alt="Screenshot 2014-10-23 22.53.13"> <img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-23-22.53.04.png" alt="Screenshot 2014-10-23 22.53.04"></p> 
      <h2 id="8-login-page">8. Login Page</h2> 
      <p>Open <span style="text-decoration: underline">login.html</span> and enter the following:</p> 
      <pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"center-form panel"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"panel-body"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">h4</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"text-center"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">i</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ion-log-in"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">i</span>&gt;</span> Log in<span class="hljs-tag">&lt;/<span class="hljs-title">h4</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">form</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"loginForm"</span> <span class="hljs-attribute">ng-submit</span>=<span class="hljs-value">"emailLogin()"</span> <span class="hljs-attribute">novalidate</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-group has-feedback"</span> <span class="hljs-attribute">ng-class</span>=<span class="hljs-value">"{ 'has-error': loginForm.email.$invalid &amp;&amp; loginForm.email.$dirty }"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">server-error</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control input-lg"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"email"</span> <span class="hljs-attribute">ng-model</span>=<span class="hljs-value">"email"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"Email"</span> <span class="hljs-attribute">required</span> <span class="hljs-attribute">autofocus</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ion-at form-control-feedback"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"help-block"</span> <span class="hljs-attribute">ng-if</span>=<span class="hljs-value">"loginForm.email.$dirty"</span> <span class="hljs-attribute">ng-messages</span>=<span class="hljs-value">"loginForm.email.$error"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">ng-message</span>=<span class="hljs-value">"required"</span>&gt;</span>Please enter your email<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">ng-message</span>=<span class="hljs-value">"server"</span>&gt;</span>{{errorMessage.email}}<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

          <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-group has-feedback"</span> <span class="hljs-attribute">ng-class</span>=<span class="hljs-value">"{ 'has-error': loginForm.password.$invalid &amp;&amp; loginForm.password.$dirty }"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">server-error</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control input-lg"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"password"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"password"</span> <span class="hljs-attribute">ng-model</span>=<span class="hljs-value">"password"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"Password"</span> <span class="hljs-attribute">required</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ion-key form-control-feedback"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"help-block"</span> <span class="hljs-attribute">ng-if</span>=<span class="hljs-value">"loginForm.password.$dirty"</span> <span class="hljs-attribute">ng-messages</span>=<span class="hljs-value">"loginForm.password.$error"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">ng-message</span>=<span class="hljs-value">"required"</span>&gt;</span>Please enter your password<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">ng-message</span>=<span class="hljs-value">"server"</span>&gt;</span>{{errorMessage.password}}<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

          <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"submit"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"btn btn-block btn-success"</span> <span class="hljs-attribute">ng-disabled</span>=<span class="hljs-value">"loginForm.$invalid"</span>&gt;</span>Log in<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>

          <span class="hljs-tag">&lt;<span class="hljs-title">br</span>/&gt;</span>

          <span class="hljs-tag">&lt;<span class="hljs-title">p</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"text-center text-muted"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">small</span>&gt;</span>Don't have an account yet? <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/signup"</span>&gt;</span>Sign up<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">small</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>

          <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"signup-or-separator"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h6</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"text"</span>&gt;</span>or<span class="hljs-tag">&lt;/<span class="hljs-title">h6</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">hr</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">form</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"btn btn-block btn-instagram"</span> <span class="hljs-attribute">ng-click</span>=<span class="hljs-value">"instagramLogin()"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">i</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ion-social-instagram"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">i</span>&gt;</span> Sign in with Instagram
        <span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre> 
      <p>Refresh the Browser and you should now see the following login page.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-26-22.51.31.png" alt="Screenshot 2014-10-26 22.51.31">This code <strong>ng-submit="emailLogin()</strong> <em>on line 7</em> will execute specified function in our <strong>LoginCtrl</strong> controller that we are going to create next. It is very similar to <strong>$('form').submit()</strong> in jQuery.</p> 
      <p>On <em>line 8</em> we conditionally apply Bootstrap's <strong>has-error</strong> class based on the following two form states:</p> 
      <ol> 
       <li>Email field is invalid, e.g. does not have the @ symbol or is empty. (empty input validation is enforced by the <strong>required</strong> attribute)</li> 
       <li>In addition to the above, the form must be "dirty", in other words a user has interacted with the form by typing something into it.</li> 
      </ol> 
      <blockquote> 
       <p><strong>Note:</strong> To learn more about different form states such as dirty, pristine, error, valid, invalid check out <a target="_blank" rel="nofollow" href="http://mrbool.com/the-concepts-of-angularjs-forms/29117">The concepts of AngularJS Forms</a> by Muhammad Azamuddin. Also, if you are not familiar with Bootstrap's form validation or feedback icons take a look at the <a target="_blank" rel="nofollow" href="http://getbootstrap.com/css/#forms-control-validation">validation states</a> section in the docs.</p> 
      </blockquote> 
      <p>For displaying error messages under the form fields we are going to use <a target="_blank" rel="nofollow" href="https://docs.angularjs.org/api/ngMessages/directive/ngMessages">ng-messages</a> directive introduced in AngularJS 1.3. If you have never used <em>ng-messages</em> directive before then be sure to take a look at the following awesome resources: <a target="_blank" rel="nofollow" href="https://egghead.io/lessons/angularjs-introduction-to-ng-messages-for-angularjs">Egghead.io Screencast</a> and <a target="_blank" rel="nofollow" href="http://www.yearofmoo.com/2014/05/how-to-use-ngmessages-in-angularjs.html">Year of Moo blog post</a>.</p> 
      <p>The only thing about <em>ng-messages</em> that may not obvious here is <strong>ng-message="server"</strong> and <strong>server-error</strong> attributes. The latter is a directive that we will implement shortly, while the former is a <a target="_blank" rel="nofollow" href="http://www.yearofmoo.com/2014/05/how-to-use-ngmessages-in-angularjs.html#custom-vaidations-and-error-messages">custom validator for ngMessages</a> which will be used to display server-side input validation errors such as <em>"The email or password you entered was incorrect"</em>.</p> 
      <p>Why do we need the <strong>server-error</strong> directive? We need it to clear the error message by setting <strong>$setValidity('server', true)</strong> on <strong>keyDown</strong> event, i.e. when a user starts typing in the form. Since I chose to disable the Login button unless the form is valid, when we set <strong>$setValidity('server', false)</strong> the form will stay invalid because the <strong>server</strong> custom validator is now <strong>false</strong> and there would be no way to re-submit the form again.</p> 
      <p>That's why we somehow need to reset the validity of the <strong>server</strong> validator. A directive is the only place where it makes sense to do this. Anyhow, it's just an implementation detail. Designing the best user experience for login and signup forms is not the main objective of this tutorial. We could have even used a <strong>401</strong> status code as an indicator that email or password is invalid and then just hard-code _"The email or password you entered was incorrect" _message in Angular.</p> 
      <p>Below is the finished project's screenshot of what it looks like after we submit a form using an email address that does exist in a database. That message <em>"Incorrect email"</em> is sent from the server, defined in the <strong>/auth/login</strong> route that we will implement in <a href="#login-and-signup-express-routes">Step #13</a>.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-27-00.32.32.png" alt="Screenshot 2014-10-27 00.32.32"></p> 
      <p>Next, open <span style="text-decoration: underline">login.js</span> and enter the following code:</p> 
      <pre><code class="hljs javascript">angular.module(<span class="hljs-string">'Instagram'</span>)
  .controller(<span class="hljs-string">'LoginCtrl'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($scope, $window, $location, $rootScope, $auth)</span> </span>{

    $scope.instagramLogin = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      $auth.authenticate(<span class="hljs-string">'instagram'</span>)
        .then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
          $<span class="hljs-built_in">window</span>.localStorage.currentUser = <span class="hljs-built_in">JSON</span>.stringify(response.data.user);
          $rootScope.currentUser = <span class="hljs-built_in">JSON</span>.parse($<span class="hljs-built_in">window</span>.localStorage.currentUser);
        })
        .catch(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
          <span class="hljs-built_in">console</span>.log(response.data);
        });
    };

    $scope.emailLogin = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      $auth.login({ email: $scope.email, password: $scope.password })
        .then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
          $<span class="hljs-built_in">window</span>.localStorage.currentUser = <span class="hljs-built_in">JSON</span>.stringify(response.data.user);
          $rootScope.currentUser = <span class="hljs-built_in">JSON</span>.parse($<span class="hljs-built_in">window</span>.localStorage.currentUser);
        })
        .catch(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
          $scope.errorMessage = {};
          angular.forEach(response.data.message, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(message, field)</span> </span>{
            $scope.loginForm[field].$setValidity(<span class="hljs-string">'server'</span>, <span class="hljs-literal">false</span>);
            $scope.errorMessage[field] = response.data.message[field];
          });
        });
    };

  });
</code></pre> 
      <p>As both method names imply, <strong>instagramLogin()</strong> is a method handler for <em>Sign in with Instagram</em> button and <strong>emailLogin()</strong> is a method handler for email and password form submission.</p> 
      <p>Satellizer has two sign-in methods: <em>authenticate</em> and <em>login</em>. The former is for the OAuth 1.0 and OAuth 2.0 sign-in and the latter is for the email (or username) and password sign-in. This naming convention of login and authenticate is just my personal preference to separate two distinct auth flows.</p> 
      <p>Both functions return a promise, that's why we use <strong>.then</strong> and <strong>.catch</strong> to handle success and errors responses. Under the hood <strong>$auth.authenticate()</strong> opens a popup window pointing to <strong>authorizationEndpoint</strong><em>,</em> for example <a target="_blank" rel="nofollow" href="https://accounts.google.com/o/oauth2/auth">https://accounts.google.com/o/oauth2/auth</a> with dynamically constructed query parameters based on the default configuration object below.</p> 
      <pre><code class="hljs javascript">google: {
  url: <span class="hljs-string">'/auth/google'</span>,
  authorizationEndpoint: <span class="hljs-string">'https://accounts.google.com/o/oauth2/auth'</span>,
  redirectUri: <span class="hljs-built_in">window</span>.location.origin || <span class="hljs-built_in">window</span>.location.protocol + <span class="hljs-string">'//'</span> + <span class="hljs-built_in">window</span>.location.host,
  scope: [<span class="hljs-string">'profile'</span>, <span class="hljs-string">'email'</span>],
  scopePrefix: <span class="hljs-string">'openid'</span>,
  scopeDelimiter: <span class="hljs-string">' '</span>,
  requiredUrlParams: [<span class="hljs-string">'scope'</span>],
  optionalUrlParams: [<span class="hljs-string">'display'</span>],
  display: <span class="hljs-string">'popup'</span>,
  type: <span class="hljs-string">'2.0'</span>,
  popupOptions: { width: <span class="hljs-number">452</span>, height: <span class="hljs-number">633</span> }
}
</code></pre> 
      <p>In the case of Facebook login, calling <strong>$auth.authenticate('facebook')</strong> will open a popup window with something like the following URL:</p> 
      <pre>https://www.facebook.com/dialog/oauth?response_type=code&amp;client_id=657854390977827&amp;redirect_uri=https://satellizer.herokuapp.com/&amp;display=popup&amp;scope=email
</pre> 
      <p>The <strong>url</strong> property on <em>line 2</em> is a server endpoint that handles most of the authentication flow that we will implement soon. Remember, since Satellizer uses <a target="_blank" rel="nofollow" href="https://api.stackexchange.com/docs/authentication">explicit grant type</a> we need to have a back-end for authentication as well. Although Satellizer does support pure client-side authentication using <a target="_blank" rel="nofollow" href="http://oauthlib.readthedocs.org/en/latest/oauth2/grants/implicit.html">implicit grant type</a> as of <a target="_blank" rel="nofollow" href="https://github.com/sahat/satellizer/pull/157">pull request 157</a> I am not going to cover it in this tutorial. The main difference between two grant types that actually matters to us is that one grant can be done purely on the client and another grant cannot.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-23-22.11.24.png" alt="Screenshot 2014-10-23 22.11.24"></p> 
      <p>With explicit grant type when you authorize your app on the screen above, Instagram will issue you a short-lived <strong>authorization</strong> <strong>code</strong> that you must exchange for an <strong>access_token</strong> on the server. This cannot be done just on the client-side alone. You can then use that <strong>access_token</strong> to query for user's profile information or perform certain actions on behalf of that user. If you have ever used a library like <a target="_blank" rel="nofollow" href="http://passportjs.org">Passport.js</a>, that's what it is essentially doing <a target="_blank" rel="nofollow" href="https://github.com/jaredhanson/passport-instagram/blob/master/lib/passport-instagram/strategy.js#L45-L46">under the hood</a>. For this tutorial, however, we will write it ourselves so you can see and understand the entire OAuth 2.0 flow from start to finish.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-27-23.43.11.png" alt="Screenshot 2014-10-27 23.43.11"></p> 
      <p>With implicit grant type, Instagram will issue you an <strong>access_token</strong> right away, instead of an <strong>authorization code</strong>. That means you can do user authentication entirely on the client-side similar to Facebook and Google JavaScript SDKs. The down-side to this approach is that when you obtain user's profile and decide to save that user in your database how can you be sure that the profile information and access token they are sending to you is valid?</p> 
      <p>You cannot, not without verifying it first. These verification checks range from being very straightforward (Facebook) to rather difficult (LinkedIn). If you have to go through the trouble of doing all that on the server, you might as well just use explicit grant type and fetch an access token from the server in the first place. For a single provider it may be okay, but when you have 3 or 4 providers it is not fun at all. I learned that lesson the hard way during the early stage development of Satellizer.</p> 
      <blockquote> 
       <p><strong>Note:</strong> Dear LinkedIn, if you are listening, please remove your annoying <strong>https</strong> requirement from <a target="_blank" rel="nofollow" href="https://developer.linkedin.com/documents/exchange-jsapi-tokens-rest-api-oauth-tokens">credentials_cookie: true</a>. I don't want to create self-signed SSL certificates when developing apps on my local machine just to validate the signature. Let us, developers, worry about when to use or not to use SSL. Better yet, ditch the cookie and use another mechanism similar to what Facebook and Google are doing for identity verification. Your security reasons are irrelevant if it makes for a painful developer experience to the point of not wanting to use your API at all.</p> 
      </blockquote> 
      <p>As you saw in the screenshot above, after authorizing the app, the popup window redirects back to initial page. This was a design choice to keep everything self-contained in <span style="text-decoration: underline">satellizer.js</span> without requiring users to setup additional routes and templates specifically for <strong>redirectUrl</strong> similar to how I have it in <a target="_blank" rel="nofollow" href="https://github.com/sahat/hackathon-starter/blob/master/app.js#L163-L164">Hackathon Starter</a>. Typically, a popup window will close fast enough that you won't even see your loaded page in there. But if you do have a nicer solution please open an issue or submit a pull request on GitHub.</p> 
      <p>The <strong>scopePrefix</strong> on <em>line 6</em> is a special case for Google . Take note of the Tip below. It basically requires you to prepend <strong>openid</strong> to the scopes string.<br><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-28-00.56.07.png" alt="Screenshot 2014-10-28 00.56.07"></p> 
      <blockquote> 
       <p><strong>Note:</strong> This StackExchange post - <a target="_blank" rel="nofollow" href="http://security.stackexchange.com/questions/37818/why-use-openid-connect-instead-of-plain-oauth">Why use OpenID Connect instead of plain OAuth?</a> explains the differences between OAuth and OpenID Connect (newer standard).</p> 
      </blockquote> 
      <p>There are two types of OAuth in Satellizer: "1.0" and "2.0". When you add a new provider via <strong>$authProvider.oauth2()</strong> or <strong>$authProvider.oauth1()</strong> a proper <strong>type</strong> is added automatically. That's pretty much the only thing these methods do. I could have also created a single <strong>$authProvider.oauth()</strong> method and force users to specify the <strong>type</strong> as part of the object. In the end it came down to personal preference.</p> 
      <p>Finally, the <strong>popupOptions</strong> on the very last line is where you could potentially specify custom size dimensions for your provider's popup window. Every single provider has a different "ideal" window size where the entire page fits perfectly without vertical or horizontal scrollbars. Those width and height numbers you see for built-in providers is something I had to find manually via <strong>window.innerWidth</strong> and <strong>window.innerHeight</strong> in the JavaScript Console. If <strong>popupOptions</strong> is not specified, width and height defaults to 500 by 500 pixels.</p> 
      <p>Ok, hopefully that gave you a better idea of how Satellizer works under the hood. So, once the <strong>$auth.authenticate()</strong> returns, it will have a response object from the server which contains JSON Web Token (JWT) and a user object. This unique JWT token is generated on the server specifically for this user. It's a special string that looks something like the following.</p> 
      <p><span style="color: #99cc00">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</span>.<span style="color: #3366ff">eyJzdWIiOjEyMzQ1Njc4OTAsIm5hbWUiOiJTYWhhdCJ9</span>.<span style="color: #ff6600">WJs3pD-1m-at8fXSbaCfCwXal93_TLT5fF57lnRjYpQ</span></p> 
      <blockquote> 
       <p><strong>Note:</strong> You can play around with JWT using an interactive debugger at <a target="_blank" rel="nofollow" href="http://jwt.io/">jwt.io</a>. Also, from here on I will refer to JSON Web Token as JWT token as it has a better sound to it, despite the fact that the word token is repeated twice.</p> 
      </blockquote> 
      <p>The reason for passing a <strong>user</strong> object from the server is that typically JWT token only includes a unique user id or some other unique identifier. This would require us to hit the server endpoints whenever we need to display user information on a page. For example, if you need to display user's first name and last name in the Navbar you would need to make an additional request to the server since JWT containly only a user id, not an entire user object.</p> 
      <p>Now, let me make something clear. You do not really <strong>have to</strong> store user id in JWT token. You could put a user object into JWT token as well. If it works for you then use that. Just keep in mind that you will be sending this token back and forth on every request and as your user object grows so will the token size. Let me give you an idea of how big your token can get using a simple user object from the <a href="github.com/sahat/hackathon-starter">Hackathon Starter</a> project:</p> 
      <p><span style="color: #99cc00">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</span>.<span style="color: #3366ff">eyJfX3YiOjEsIl9pZCI6eyIkb2lkIjoiNTM1YWIwNjcxZjJjMmJlYzAzODRlZjg</span><br><span style="color: #3366ff">zIn0sImVtYWlsIjoic2FraGF0QGdtYWlsLmNvbSIsImdvb2dsZSI6IjEwMDQ3Mzc4MDc2NTEyMjc3NTMzMCIsImxpb</span><br><span style="color: #3366ff">mtlZGluIjoiTlJxdUduVUpaRCIsInByb2ZpbGUiOnsibG9jYXRpb24iOiJHcmVhdGVyIE5ldyBZb3JrIENpdHkgQXJlYSI</span><br><span style="color: #3366ff">sIm5hbWUiOiJTYWhhdCBZYWxrYWJvdiIsInBpY3R1cmUiOiJodHRwOi8vbS5jLmxua2QubGljZG4uY29tL21wci9tc</span><br><span style="color: #3366ff">HJ4LzBfZ3hrRk9yYndmOTMyYU1UaGpnYjRPdDVJaXp2btJWVGgwbktaT1BGSnBQVFkxWW44QU1OSUsxUGNEN</span><br><span style="color: #3366ff">HpsN2o4Mnl5UUpBcU1xTDdPVSIsIndlYnNpdGUiOiJodHRwOi8vd3d3LmxpbmtlZGluLmNvbS9pbi9zYWhhdHlhbG</span><br><span style="color: #3366ff">thYm92In0sInJlc2V0UGFzc3dvcmRFeHBpcmVzIjp7IiRkYXRlIjoiMjAxNC0wNC0yNVQyMDozMjoxMi44MDdaIn0s</span><br><span style="color: #3366ff">InJlc2V0UGFzc3dvcmRUb2tlbiI6ImY2NWJiN2IwNzAyYmZkZTY0ZTQyNDA0M2I4YWE1MDk1OWQ4M2NlMjAiLC</span><br><span style="color: #3366ff">J0b2tlbnMiOlt7ImFjY2Vzc1Rva2VuIjoiQVFWWGdDNWlMTEdkUTl6eXJwUm1yT1NlTFJjQUFNQjllbjA4T0h1N2FVN</span><br><span style="color: #3366ff">UdvMDN4VDJOdG1XeFVMS0Nod1RGWk9iaDN2ay11NkJxNnQwc1NzNnU2bS1TaDBHTzJ5ajJxaUJPdGk2aWFYdW</span><br><span style="color: #3366ff">tnVnVscy1hcEIyTHVuTWhjc1BIbi0xWjZob3hGcmZkclNpVkFoak12Wm80enpXa21TZUktU2FTLXNydk40UVduTFp</span><br><span style="color: #3366ff">pWklnbVEiLCJraW5kIjoibGlua2VkaW4ifSx7ImtpbmQiOiJnb29nbGUiLCJhY2Nlc3NUb2tlbiI6InlhMjkuMS5BQUR0</span><br><span style="color: #3366ff">Tl9Xb0Q2Z0J5cmIwaG42S1dDVHZqYV92a2FKb2NXWEdrRnFvc0ZiQmYxUlRnaDZBVDZQVkxXdnF1RGtRQjdxX2</span><br><span style="color: #3366ff">tYUnMifV19</span>.<span style="color: #ff6600">RTbUuUcSlor15Sh-ZBYlRrGjZEFx5_H-hKWNMqP-eGM</span></p> 
      <p>That is why I think it would be better to send a user object alongside JWT token, not inside it, and then store it in Local Storage for later use. That way you don't have to send a fat JWT token back and forth between client and server.</p> 
      <p>Satellizer will pass along the original response object from the server. In other words, if you send a JSON object with <strong>token</strong> and <strong>user</strong> from the server, we could get <strong>user</strong> back via <strong>response.data.user</strong> inside <strong>.then()</strong> of <strong>authenticate()</strong> and <strong>login()</strong> methods.</p> 
      <p>You will hear a lot of people say that using <strong>$rootScope</strong> is a bad practice. Pesonally, I never ran into issues with it, which is probably due to the fact I have not built anything big in AngularJS yet. But anyway, it fits nicely with what we are trying to do here.</p> 
      <p>The <strong>currentUser</strong> object will contain user's information such as Instagram id, username, email and display name. Because we defined it on <strong>$rootScope</strong> we can use <strong>{{currentUser.username}}</strong> in the Navbar and detail page. Otherwise we would have to create <strong>currentUser</strong> per each <strong>$scope</strong> in <em>NavbarCtrl</em> and <em>DetailCtrl</em> and any other controller that may need to display user information in the future. But if you prefer the second approach, then by all means do it that way.</p> 
      <p>The big difference between <strong>instagramLogin()</strong> and <strong>emailLogin()</strong> lies in the error handling. We are actually not even doing any error handling for Instagram authentication in this tutorial. Let me show you the error handling code again:</p> 
      <pre><code class="hljs javascript">$scope.errorMessage = {};
angular.forEach(response.data.message, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(message, field)</span> </span>{
  $scope.loginForm[field].$setValidity(<span class="hljs-string">'server'</span>, <span class="hljs-literal">false</span>);
  $scope.errorMessage[field] = response.data.message[field];
});
</code></pre> 
      <p>We are using Angular's <a target="_blank" rel="nofollow" href="https://docs.angularjs.org/api/ng/function/angular.forEach">forEach</a> method to iterate over the <strong>message</strong> object keys. To better visualize it here is the JSON response from the server:</p> 
      <pre><code class="hljs javascript">{ message: { email: <span class="hljs-string">'Incorrect email'</span> } }
</code></pre> 
      <p>In this case there is only one invalid field, namely email. So, on <em>line 3</em> it basically sets the <strong>email</strong> validity of our custom validator to false. You know how there are some basic HTML validators like text, number, url, email, regex? Well, our <strong>server</strong> validator is our own validator for <strong>email</strong> and <strong>password</strong> fields. It is <strong>false</strong> when there are no server errors and resolves to <strong>true</strong> when we do get server errors like invalid email or invalid password.</p> 
      <p>On <em>line 4</em> we set that error message <em>"Incorrect email"</em> on the <strong>$scope</strong> object so that we could then access it from <span style="text-decoration: underline">login.html</span>:</p> 
      <pre><code class="hljs html"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">ng-message</span>=<span class="hljs-value">"server"</span>&gt;</span></span><span class="hljs-expression">{{<span class="hljs-variable">errorMessage.email</span>}}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span></span>
</code></pre> 
      <p>I think that covers just about everything for Login page. But before we move to the Signup page, let's implement the <em>serverError</em> directive.</p> 
      <p>Create a new folder called <strong>directives</strong> inside the <strong>client </strong>directory, then inside it create a file called <span style="text-decoration: underline">serverError.js</span>.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-07-15.55.10.png" alt="Screenshot 2014-12-07 15.55.10"></p> 
      <p>It's a very simple Angular directive - its primary purpose is to clear error messages such as <em>Invalid Username or Password</em> and reset form validity whenever user starts typing again. Otherwise, after you get an error message back from the server you will not be able to re-submit the form with our current implementation. Once again, please refer to <a target="_blank" rel="nofollow" href="https://www.airpair.com/angularjs/posts/angularjs-tutorial#8-directives-core-">Todd Motto's AngularJS guide</a> to learn more about directives or see my <a target="_blank" rel="nofollow" href="https://speakerdeck.com/sahat/building-a-tv-show-tracker-with-angularjs">Introduction to AngularJS</a> slides.</p> 
      <pre><code class="hljs javascript">angular.module(<span class="hljs-string">'Instagram'</span>)
  .directive(<span class="hljs-string">'serverError'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> {
        restrict: <span class="hljs-string">'A'</span>,
        <span class="hljs-built_in">require</span>: <span class="hljs-string">'ngModel'</span>,
        link: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(scope, element, attrs, ctrl)</span> </span>{
          element.on(<span class="hljs-string">'keydown'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            ctrl.$setValidity(<span class="hljs-string">'server'</span>, <span class="hljs-literal">true</span>)
          });
        }
    }
  });
</code></pre> 
      <p>And finally, add the following line to <span style="text-decoration: underline">index.html</span> in order to load this directive:</p> 
      <pre><code class="hljs xml">
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"directives/serverError.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre> 
      <p>Next up is the Signup page.</p> 
      <h2 id="-span-style-color-000000-9-signup-page-toc-span-"><span style="color: #000000"><strong>9. Signup Page <a href="#toc"></a></strong></span></h2> 
      <p>Open <span style="text-decoration: underline">signup.html</span> template and paste the following markup:</p> 
      <pre><code class="hljs xml">
<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container"</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"center-form panel"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"panel-body"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">h4</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"text-center"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">i</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ion-person-add"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">i</span>&gt;</span> Sign up<span class="hljs-tag">&lt;/<span class="hljs-title">h4</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">form</span> <span class="hljs-attribute">method</span>=<span class="hljs-value">"post"</span> <span class="hljs-attribute">ng-submit</span>=<span class="hljs-value">"signup()"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"signupForm"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-group has-feedback"</span> <span class="hljs-attribute">ng-class</span>=<span class="hljs-value">"{ 'has-error' : signupForm.email.$invalid &amp;&amp; signupForm.email.$dirty }"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control input-lg"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"email"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"email"</span> <span class="hljs-attribute">ng-model</span>=<span class="hljs-value">"email"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"Email"</span> <span class="hljs-attribute">required</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ion-at form-control-feedback"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-group has-feedback"</span> <span class="hljs-attribute">ng-class</span>=<span class="hljs-value">"{ 'has-error' : signupForm.password.$invalid &amp;&amp; signupForm.password.$dirty }"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"form-control input-lg"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"password"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"password"</span> <span class="hljs-attribute">ng-model</span>=<span class="hljs-value">"password"</span> <span class="hljs-attribute">placeholder</span>=<span class="hljs-value">"Password"</span> <span class="hljs-attribute">required</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ion-key form-control-feedback"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">p</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"text-center text-muted"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">small</span>&gt;</span>By clicking on Sign up, you agree to <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#"</span>&gt;</span>terms &amp; conditions<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span> and <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#"</span>&gt;</span>privacy policy<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">small</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"submit"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"btn btn-block btn-primary"</span>&gt;</span>Sign up<span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">br</span>/&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">p</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"text-center text-muted"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">small</span>&gt;</span>Already have an account? <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/login"</span>&gt;</span>Log in now<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">small</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">form</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre> 
      <p>This template is not all that different from the Login page. On form submission we call the <strong>signup()</strong> method which is going to grab email and password values and send it to the server.</p> 
      <p>Type or paste the following code into <strong>controllers/</strong><span style="text-decoration: underline">signup.js</span>:</p> 
      <pre><code class="hljs javascript">
angular.module(<span class="hljs-string">'Instagram'</span>)
  .controller(<span class="hljs-string">'SignupCtrl'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($scope, $auth)</span> </span>{

    $scope.signup = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">var</span> user = {
        email: $scope.email,
        password: $scope.password
      };

      <span class="hljs-comment">// Satellizer</span>
      $auth.signup(user)
        .catch(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
          <span class="hljs-built_in">console</span>.log(response.data);
        });
    };

  });
</code></pre> 
      <p>Satellizer's <strong>$auth.signup()</strong> method just takes an object and sends it to the server without doing anything to it. What you pass here is what you will get at <strong>/auth/signup</strong> route (Default URL) on the server.</p> 
      <blockquote> 
       <p><strong>Note:</strong> If you wish to use <strong>/register</strong> endpoint instead of <strong>/auth/signup</strong> you can easily override the signup URL:</p> 
       <p>$authProvider.signupUrl = '/register';</p> 
      </blockquote> 
      <p>I should also point out that by default Satellizer will automatically sign you in after a successful registration. If you do not like this behavior you can turn it off like so:</p> 
      <pre><code class="hljs javascript">
$authProvider.loginOnSignup = <span class="hljs-literal">false</span>;
</code></pre> 
      <p>If you disable automatic sign in, Satellizer will simply redirect a user to the <strong>/login</strong> route specified in <strong>$authProvider.loginRoute</strong>. If for some reason you have to do something else before redirect to login page you can disable this behavior by setting<strong>$authProvider.loginRoute</strong> to <strong>null</strong>.</p> 
      <p>When you reload the browser and click on Signup in the Navbar you should see something like the screenshot below:</p> 
      <p><a href="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-28-21.47.32.png"><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-28-21.47.32.png" alt="Screenshot 2014-10-28 21.47.32"></a>Let's shift gears for a moment and switch over to our back-end code. We will be using Node.js and Express because that's what I am most comfortable with but hopefully you already knew that. The code should be simple enough for you to port it to other web frameworks and languages of your choice. For example, I have written <a target="_blank" rel="nofollow" href="https://github.com/sahat/satellizer/tree/master/examples/server">PHP and Python examples</a> for Satellizer with minimal knowledge of both languages.</p> 
      <h2 id="-span-style-color-000000-10-express-skeleton-toc-span-"><span style="color: #000000"><strong>10. Express Skeleton <a href="#toc"></a></strong></span></h2> 
      <p>In the <strong>instagram</strong> directory create a new folder called <strong>server</strong>, it should be a sibling of <strong>client</strong>.</p> 
      <p><a href="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-28-22.03.00.png"><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-28-22.03.00.png" alt="Screenshot 2014-10-28 22.03.00"></a></p> 
      <p>In the <strong>server</strong> directory create two new files: <span style="text-decoration: underline">package.json</span> and <span style="text-decoration: underline">server.js</span>. Open <span style="text-decoration: underline">package.json</span> and paste the following code with all package dependencies for our app:</p> 
      <pre><code class="hljs javascript">
{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"instagram-server"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"0.0.0"</span>,
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"start"</span>: <span class="hljs-string">"node server.js"</span>
  },
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"bcryptjs"</span>: <span class="hljs-string">"^2.0.2"</span>,
    <span class="hljs-string">"body-parser"</span>: <span class="hljs-string">"^1.8.1"</span>,
    <span class="hljs-string">"cors"</span>: <span class="hljs-string">"^2.4.2"</span>,
    <span class="hljs-string">"express"</span>: <span class="hljs-string">"^4.9.0"</span>,
    <span class="hljs-string">"jwt-simple"</span>: <span class="hljs-string">"^0.2.0"</span>,
    <span class="hljs-string">"moment"</span>: <span class="hljs-string">"^2.8.3"</span>,
    <span class="hljs-string">"mongoose"</span>: <span class="hljs-string">"^3.8.17"</span>,
    <span class="hljs-string">"request"</span>: <span class="hljs-string">"^2.44.0"</span>
  }
}
</code></pre> 
      <p>After that paste the following code into <span style="text-decoration: underline">server.js</span>:</p> 
      <pre><code class="hljs javascript">
<span class="hljs-keyword">var</span> bcrypt = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bcryptjs'</span>);
<span class="hljs-keyword">var</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'body-parser'</span>);
<span class="hljs-keyword">var</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cors'</span>);
<span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">var</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jwt-simple'</span>);
<span class="hljs-keyword">var</span> moment = <span class="hljs-built_in">require</span>(<span class="hljs-string">'moment'</span>);
<span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">var</span> request = <span class="hljs-built_in">require</span>(<span class="hljs-string">'request'</span>);

<span class="hljs-keyword">var</span> app = express();

app.set(<span class="hljs-string">'port'</span>, process.env.PORT || <span class="hljs-number">3000</span>);
app.use(cors());
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: <span class="hljs-literal">false</span> }));
app.use(express.static(path.join(__dirname, <span class="hljs-string">'public'</span>)));

app.listen(app.get(<span class="hljs-string">'port'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Express server listening on port '</span> + app.get(<span class="hljs-string">'port'</span>));
});
</code></pre> 
      <blockquote> 
       <p><strong>Note:</strong> All of our back-end code from here on will be go into <span style="text-decoration: underline">app.js</span> unless otherwise stated. In other words I am not going to break our Express app into separate models, controllers, routes, etc. just for the sake of simplicity.</p> 
      </blockquote> 
      <p>Let's install package dependencies and see if our server is working without any issues. Open the Terminal and navigate to the <strong>instagram/server</strong> directory, then type <strong>npm install</strong>:</p> 
      <p><a href="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-28-22.17.54.png"><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-28-22.17.54.png" alt="Screenshot 2014-10-28 22.17.54"></a></p> 
      <p>By the way, I am using the fish shell with <a target="_blank" rel="nofollow" href="https://github.com/bpinto/oh-my-fish">oh-my-fish</a> project. I really like that auto-complete feature. What's even more awesome is that it remembers the last command you have typed. If I were to start typing <strong>py</strong> it will suggest me <strong><span class="s1">python</span> <span class="s3">-m</span></strong> <span class="s3"><strong>SimpleHTTPServer</strong> which is exactly what I wanted.</span></p> 
      <p>After you install all of the app dependencies we can now start the server.</p> 
      <p><a href="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-28-22.18.31.png"><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-28-22.18.31.png" alt="Screenshot 2014-10-28 22.18.31"></a></p> 
      <p>You can either run npm start or node server.js to start this Express application. If you did everything correctly you should see the following message:</p> 
      <p><strong><span class="s1">Express server listening on port 3000</span></strong></p> 
      <p>If you have built Express apps in the past this code should be very familiar to you. One thing to note here is the use of<a target="_blank" rel="nofollow" href="https://github.com/troygoode/node-cors">cors()</a> middleware. Since we are running AngularJS app on a separate port we need to have cross-origin requests support as I have briefly mentioned in the first section. The great thing about this web service oriented architecture is isolation. You can have some developers working on a front-end side of your project which could be maintained in its own Git repository and running on Heroku for example, while other developers could be working on the back-end portion of the project that could potentially be running on Azure or OpenShift. This would be a great advantage to have at hackathons, where you could have multiple developers working on the project independently in parallel.</p> 
      <blockquote> 
       <p><strong>Note:</strong> For fine-tuning CORS options, see <a target="_blank" rel="nofollow" href="https://github.com/troygoode/node-cors#configuring-cors">https://github.com/troygoode/node-cors#configuring-cors</a>.</p> 
      </blockquote> 
      <h2 id="-span-style-color-000000-11-database-and-user-model-toc-span-"><span style="color: #000000"><strong>11. Database and User Model <a href="#toc"></a></strong></span></h2> 
      <p>As you will see shortly, we will use <a target="_blank" rel="nofollow" href="http://mongoosejs.com/">Mongoose</a> package to connect to MongoDB. Instead of hard coding <em>Mongo URI</em> inside <span style="text-decoration: underline">app.js</span> let's put into <span style="text-decoration: underline">config.js</span> instead. So, create a new file <span style="text-decoration: underline">config.js</span> in the <strong>server</strong> directory and paste the following code:</p> 
      <pre><code class="hljs javascript">
<span class="hljs-built_in">module</span>.exports = {
  db: process.env.db || <span class="hljs-string">'localhost'</span>,
  tokenSecret: process.env.tokenSecret || <span class="hljs-string">'pick a hard to guess string'</span>

};
</code></pre> 
      <p>The <strong>tokenSecret</strong> will come in handy in the next chapter when we get to the JSON Web Token authentication.</p> 
      <blockquote> 
       <p><strong>Note:</strong> If you are not familiar with <strong>exports</strong> and <strong>module.exports</strong> in Node.js then refer to <a target="_blank" rel="nofollow" href="http://www.sitepoint.com/understanding-module-exports-exports-node-js/">this article</a>.</p> 
      </blockquote> 
      <p>Back in <span style="text-decoration: underline">app.js</span> let's import this config file by adding the following line with the rest of "requires":</p> 
      <pre><code class="hljs javascript">
<span class="hljs-keyword">var</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./config'</span>);
</code></pre> 
      <p>Next, let's create a new User model and connect to MongoDB database. Add the following code after the previous line:</p> 
      <pre><code class="hljs javascript">
<span class="hljs-keyword">var</span> User = mongoose.model(<span class="hljs-string">'User'</span>, <span class="hljs-keyword">new</span> mongoose.Schema({
  instagramId: { type: <span class="hljs-built_in">String</span>, index: <span class="hljs-literal">true</span> },
  email: { type: <span class="hljs-built_in">String</span>, unique: <span class="hljs-literal">true</span>, lowercase: <span class="hljs-literal">true</span> },
  password: { type: <span class="hljs-built_in">String</span>, select: <span class="hljs-literal">false</span> },
  username: <span class="hljs-built_in">String</span>,
  fullName: <span class="hljs-built_in">String</span>,
  picture: <span class="hljs-built_in">String</span>,
  accessToken: <span class="hljs-built_in">String</span>
}));

mongoose.connect(config.db);
</code></pre> 
      <p>I have already talked about Mongoose models enough in<a target="_blank" rel="nofollow" href="http://sahatyalkabov.com/how-to-implement-password-reset-in-nodejs/">How To Implement Password Reset In Node.js</a> and <a target="_blank" rel="nofollow" href="http://sahatyalkabov.com/create-a-tv-show-tracker-using-angularjs-nodejs-and-mongodb/">Create a TV Show Tracker using AngularJS, Node.js and MongoDB</a> so I will not be repeating myself here again.</p> 
      <p>One thing I will mention is the <strong>select</strong> property on the password field. This tells Mongoose not to retrieve the password field unless explicitly stated otherwise via <strong>"+password"</strong> option as we will see shortly. Otherwise we would need to manually remove password field from a <strong>user</strong> instance before sending it off to Angular.</p> 
      <p><a href="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-28-23.08.54.png"><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-28-23.08.54.png" alt="Screenshot 2014-10-28 23.08.54"></a></p> 
      <p>Start MongoDB if you haven't already done so then restart the Express server. You will see the following error if your MongoDB process is not running:</p> 
      <p><a href="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-28-23.09.58.png"><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-28-23.09.58.png" alt="Screenshot 2014-10-28 23.09.58"></a></p> 
      <blockquote> 
       <p><strong>Note:</strong> If you have installed MongoDB via a package manager on Mac or Linux you may have to run <strong>mongod</strong> command. On Windows you will need to open <strong>mongod.exe</strong> after downloading and installing MongoDB.</p> 
      </blockquote> 
      <p>That's all for this section. Next we will implement two helper functions in Express: <strong>isAuthenticated()</strong> middleware for checking if user is authenticated before accessing priveleged routes and <strong>createToken()</strong> for generating a JSON Web Token.</p> 
      <h2 id="-span-style-color-000000-12-authentication-middleware-and-jwt-toc-span-"><span style="color: #000000"><strong>12. Authentication Middleware and JWT <a href="#toc"></a></strong></span></h2> 
      <p>Add the following function after the last <strong>app.use()</strong> middleware. It doesn't actually matter where you place the function in <span style="text-decoration: underline">server.js</span> but it would certainly make it easier to follow this tutorial. It is just a plain JavaScript function that takes a <strong>user</strong> object as an argument and returns a token string.</p> 
      <pre><code class="hljs javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createToken</span><span class="hljs-params">(user)</span> </span>{
  <span class="hljs-keyword">var</span> payload = {
    exp: moment().add(<span class="hljs-number">14</span>, <span class="hljs-string">'days'</span>).unix(),
    iat: moment().unix(),
    sub: user._id
  };

  <span class="hljs-keyword">return</span> jwt.encode(payload, config.tokenSecret);
}
</code></pre> 
      <p>I am using <a target="_blank" rel="nofollow" href="http://momentjs.com">Moment.js</a> to generate <em>current time</em> and <em>two weeks from now</em> dates. You can certainly use built-in <strong>Date</strong> object in JavaScript but it will not be nearly as nice and concise as above.</p> 
      <p>The JWT library that we are using (<a target="_blank" rel="nofollow" href="https://github.com/hokaccha/node-jwt-simple">jwt-simple</a>) has two methods that are of interest to us: <strong>encode()</strong> and <strong>decode()</strong>. An object that gets encoded and decoded is called JWT Claims, others may also refer to it as payload. You can read the entire JSON Web Token draft specification <a target="_blank" rel="nofollow" href="http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html">here</a>. None of these reserved claims above - <strong>exp</strong> (expiration time), <strong>iat</strong> (issued at), <strong>sub</strong> (subject) are required at all. It's up to you, as a developer, to decide which JWT claims you need to use for your particular use case. As I have mentioned earlier, you could even include the entire <strong>user</strong> object as part of JWT Claims, but typically <strong>email</strong> or <strong>user_id</strong> are used instead.</p> 
      <p>The reserved <strong>sub</strong> claim on <em>line 5</em> is used to store user's unique ID (<a target="_blank" rel="nofollow" href="http://docs.mongodb.org/manual/reference/object-id/">MongoDB ObjectId</a>) for that particular user. Why did I use <strong>sub</strong> instead of <strong>id</strong> or <strong>user_id</strong>? It came down to a personal preference, but also because Google happens to be using it as unique identifier for the user in OAuth 2.0 OpenID Connect:</p> 
      <p><a href="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-31-22.11.02.png"><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-31-22.11.02.png" alt="Screenshot 2014-10-31 22.11.02"></a></p> 
      <p>The next function is responsible for preventing unauthorized users from accessing protected routes. For instance, we don't want to allows users to access <strong>/api/feed</strong> route (Instagram feed) unless they are authenticated.</p> 
      <pre><code class="hljs javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isAuthenticated</span><span class="hljs-params">(req, res, next)</span> </span>{
  <span class="hljs-keyword">if</span> (!(req.headers &amp;amp;amp;&amp;amp;amp; req.headers.authorization)) {
    <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">400</span>).send({ message: <span class="hljs-string">'You did not provide a JSON Web Token in the Authorization header.'</span> });
  }

  <span class="hljs-keyword">var</span> header = req.headers.authorization.split(<span class="hljs-string">' '</span>);
  <span class="hljs-keyword">var</span> token = header[<span class="hljs-number">1</span>];
  <span class="hljs-keyword">var</span> payload = jwt.decode(token, config.tokenSecret);
  <span class="hljs-keyword">var</span> now = moment().unix();

  <span class="hljs-keyword">if</span> (now &amp;amp;gt; payload.exp) {
    <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">401</span>).send({ message: <span class="hljs-string">'Token has expired.'</span> });
  }

  User.findById(payload.sub, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, user)</span> </span>{
    <span class="hljs-keyword">if</span> (!user) {
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">400</span>).send({ message: <span class="hljs-string">'User no longer exists.'</span> });
    }

    req.user = user;
    next();
  })
}
</code></pre> 
      <p>On <em>lines 2-4</em> we first check if an HTTP request has the Authorization header. Why? Because Satellizer will intercept all outgoing requests and append JSON Web Token to headers. If you look at the Satellizer's source code here is the block that is responsible for this:</p> 
      <pre><code class="hljs javascript">
$httpProvider.interceptors.push([<span class="hljs-string">'$q'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($q)</span> </span>{
  <span class="hljs-keyword">var</span> tokenName = config.tokenPrefix ? config.tokenPrefix + <span class="hljs-string">'_'</span> + config.tokenName : config.tokenName;
  <span class="hljs-keyword">return</span> {
    request: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(httpConfig)</span> </span>{
      <span class="hljs-keyword">var</span> token = localStorage.getItem(tokenName);
      <span class="hljs-keyword">if</span> (token) {
        token = config.authHeader === <span class="hljs-string">'Authorization'</span> ? <span class="hljs-string">'Bearer '</span> + token : token;
        httpConfig.headers[config.authHeader] = token;
      }
      <span class="hljs-keyword">return</span> httpConfig;
    },
    responseError: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
      <span class="hljs-keyword">return</span> $q.reject(response);
    }
  };
}]);
</code></pre> 
      <p>You do not have to understand everything in the code above, I only wanted to show you why we are checking for the Authorization header in Express. By the way, you can inspect requests from Google Chrome's <em>Developer Tools</em> under the <em>Network</em> tab:</p> 
      <p><a href="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-11-09-18.08.27.png"><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-11-09-18.08.27.png" alt="Screenshot 2014-11-09 18.08.27"></a></p> 
      <p>Ok, back to <strong>isAuthenticated()</strong> middleware function. After checking for presence of the Authorization header, we then need to decode that token using the same <em>secret</em> stringwe used to generate the token. Decoding the token will give us back its original claims object, for example:</p> 
      <pre><code class="hljs javascript">
{ exp: <span class="hljs-number">1416796466</span>,
  iat: <span class="hljs-number">1415586866</span>,
  sub: <span class="hljs-string">'546024329ac4d00000db0e09'</span> }
</code></pre> 
      <blockquote> 
       <p><strong>Note:</strong> It is a good idea to check for the validity of JSON Web Token before doing anything else. This middleware assumes that we will get a valid token in the following format: <strong>Authorization: Bearer [token]</strong>. Take a look at the <a target="_blank" rel="nofollow" href="https://github.com/auth0/node-jsonwebtoken/blob/master/index.js#L34-L84">auth0/node-jsonwebtoken source code</a> (line 34 through 84) for more information.</p> 
      </blockquote> 
      <p>First, check for expiration date. I have set 14 days for token expiration, however, everyone's use case will be different. If you are building an app that deals with a lot of sensitive information you might want to set expiration time to 1 hour or even less.</p> 
      <p>If token is not expired, we can then and retrieve the user document from database. On <em>line 20</em>, we temporarily "save" the user object inside the <strong>request</strong> object. This allows us to obtain user's information in the protected route by calling <strong>req.user</strong>. For example:</p> 
      <pre><code class="hljs javascript">
app.get(<span class="hljs-string">'/protected'</span>, isAuthenticated, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span> </span>{
  <span class="hljs-comment">// Prints currently signed-in user object</span>
  <span class="hljs-built_in">console</span>.log(req.user);
});
</code></pre> 
      <p>We end this middleware function by calling <strong>next()</strong>, which signals Express to proceed executing the route handler.</p> 
      <h2 id="-span-style-color-000000-13-login-and-signup-express-routes-toc-span-"><span style="color: #000000"><strong>13. Login and Signup Express Routes <a href="#toc"></a></strong></span></h2> 
      <p>Our login route is extremely simple. All it does is validates email and password. If both entries are correct, it returns a new token and a user object.</p> 
      <p>Add the following route right where we left off, after the <strong>isAuthenticated()</strong> middleware.</p> 
      <pre><code class="hljs javascript">
app.post(<span class="hljs-string">'/auth/login'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span> </span>{
  User.findOne({ email: req.body.email }, <span class="hljs-string">'+password'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, user)</span> </span>{
    <span class="hljs-keyword">if</span> (!user) {
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">401</span>).send({ message: { email: <span class="hljs-string">'Incorrect email'</span> } });
    }

    bcrypt.compare(req.body.password, user.password, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, isMatch)</span> </span>{
      <span class="hljs-keyword">if</span> (!isMatch) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">401</span>).send({ message: { password: <span class="hljs-string">'Incorrect password'</span> } });
      }

      user = user.toObject();
      <span class="hljs-keyword">delete</span> user.password;

      <span class="hljs-keyword">var</span> token = createToken(user);
      res.send({ token: token, user: user });
    });
  });
});
</code></pre> 
      <p>The <strong>+password</strong> parameter in the query tells Mongoose to include the password field. We have to do this because we explicitly told Mongoose to exclude the password field from all User model queries by setting <strong>password: { type: String, select: false }</strong>.</p> 
      <p>Remember how we used <strong>bcrypt</strong> to hash the password field in <em>Step 9</em> when we created the <strong>User</strong> model? Well, we cannot just check if two passwords match using normal comparison. That's where <strong>bcrypt.compare()</strong> comes in. To better illustrate this point consider the following simple example from <a target="_blank" rel="nofollow" href="https://www.npmjs.org/package/bcrypt-nodejs">bcrypt's</a> documentation:</p> 
      <pre><code class="hljs javascript">
<span class="hljs-keyword">var</span> hash = bcrypt.hashSync(<span class="hljs-string">"bacon"</span>);

bcrypt.compareSync(<span class="hljs-string">"bacon"</span>, hash); <span class="hljs-comment">// true</span>
bcrypt.compareSync(<span class="hljs-string">"veggies"</span>, hash); <span class="hljs-comment">// false</span>
</code></pre> 
      <p>If user with the given email is found and password is correct, on <em>line 12-13</em> we convert Mongoose Document object to plain JavaScript object then delete the password property. You may be wondering why not just delete the password property directly without converting it to plain object.</p> 
      <p>As it turns out, document objects returned by Mongoose are immutable, so deleting the password property won't do anything. You could, however, get around this problem by passing <a target="_blank" rel="nofollow" href="http://mongoosejs.com/docs/api.html#query_Query-lean">lean</a> option to a Mongoose query. Either way works just as well for our purposes.</p> 
      <p>The reason for structuring <em>Incorrect email</em> and <em>Incorrect password</em> error messages in such a way has more to do with the way we display validation errors on the login form. Instead of displaying all errors above the form as it is typically done, an error message is displayed right under each individual form field.</p> 
      <p><a href="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-27-00.32.32.png"><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-27-00.32.32.png" alt="Screenshot 2014-10-27 00.32.32"></a></p> 
      <p>Next up is the signup route. It starts by checking if email address is already taken (cannot have multiple users with the same email). It then hashes the password using <strong>bcrypt</strong> and saves the user to database.</p> 
      <p>Here is the code for the signup route:</p> 
      <pre><code class="hljs javascript">
app.post(<span class="hljs-string">'/auth/signup'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span> </span>{
  User.findOne({ email: req.body.email }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, existingUser)</span> </span>{
    <span class="hljs-keyword">if</span> (existingUser) {
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">409</span>).send({ message: <span class="hljs-string">'Email is already taken.'</span> });
    }

    <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">new</span> User({
      email: req.body.email,
      password: req.body.password
    });

    bcrypt.genSalt(<span class="hljs-number">10</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, salt)</span> </span>{
      bcrypt.hash(user.password, salt, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, hash)</span> </span>{
        user.password = hash;

        user.save(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
          <span class="hljs-keyword">var</span> token = createToken(user);
          res.send({ token: token, user: user });
        });
      });
    });
  });
});
</code></pre> 
      <blockquote> 
       <p><strong>Note:</strong> This route is only responsible for email and password signup process. We will have a different route for creating a new account using Instagram authentication.</p> 
      </blockquote> 
      <h2 id="-span-style-color-000000-14-instagram-authentication-express-route-toc-span-"><span style="color: #000000"><strong>14. Instagram Authentication Express Route <a href="#toc"></a></strong></span></h2> 
      <p>This section is going to be a little more difficult than any other simply because of the large scope it encompasses. I will break it apart into multiple code snippets and then show you the entire code at the end.</p> 
      <pre><code class="hljs javascript">
app.post(<span class="hljs-string">'/auth/instagram'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span> </span>{

});
</code></pre> 
      <p>The request to <strong>/auth/instagram</strong> will be made by Satellizer after <em>authorization code</em> has been obtained from the popup. This all happens really fast and the popup will be closed before you can see the <em>code</em> query parameter.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-10-27-23.43.11.png" alt="Screenshot 2014-10-27 23.43.11">Here is the Satellizer's source code that makes this happen, where <strong>defaults.url</strong> is <strong><a target="_blank" rel="nofollow" href="http://localhost:3000/auth/instagram">http://localhost:3000/auth/instagram</a></strong> that we specified in <strong>client</strong>/<span style="text-decoration: underline">app.js</span>.</p> 
      <pre><code class="hljs javascript">
oauth2.exchangeForToken = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(oauthData, userData)</span> </span>{
  <span class="hljs-keyword">var</span> data = angular.extend({}, userData, {
    code: oauthData.code,
    clientId: defaults.clientId,
    redirectUri: defaults.redirectUri
  });

  <span class="hljs-keyword">return</span> $http.post(defaults.url, data);
};
</code></pre> 
      <p>So, now you know where <strong>code</strong>, <strong>clientId</strong> and <strong>redirectUri</strong> are coming from that you are about to see inside this route:</p> 
      <pre><code class="hljs javascript">
app.post(<span class="hljs-string">'/auth/instagram'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span> </span>{
  <span class="hljs-keyword">var</span> accessTokenUrl = <span class="hljs-string">'https://api.instagram.com/oauth/access_token'</span>;

  <span class="hljs-keyword">var</span> params = {
    client_id: req.body.clientId,
    redirect_uri: req.body.redirectUri,
    client_secret: config.clientSecret,
    code: req.body.code,
    grant_type: <span class="hljs-string">'authorization_code'</span>
  };

});
</code></pre> 
      <p>After obtaining an <em>authorization code</em> the next step is to exchange it for an <em>access token</em>, with which we will be able to fetch user's photos or like a photo on the user's behalf.</p> 
      <p>Instagram requires all of the above parameters when sending a POST request to <strong><a target="_blank" rel="nofollow" href="https://api.instagram.com/oauth/access_token">https://api.instagram.com/oauth/access_token</a></strong>.</p> 
      <p><a href="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-11-09-21.16.20.png"><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-11-09-21.16.20.png" alt="Screenshot 2014-11-09 21.16.20"></a></p> 
      <pre><code class="hljs javascript">
app.post(<span class="hljs-string">'/auth/instagram'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span> </span>{
  <span class="hljs-keyword">var</span> accessTokenUrl = <span class="hljs-string">'https://api.instagram.com/oauth/access_token'</span>;

  <span class="hljs-keyword">var</span> params = {
    client_id: req.body.clientId,
    redirect_uri: req.body.redirectUri,
    client_secret: config.clientSecret,
    code: req.body.code,
    grant_type: <span class="hljs-string">'authorization_code'</span>
  };

 <span class="hljs-comment">// Step 1\. Exchange authorization code for access token.</span>
 request.post({ url: accessTokenUrl, form: params, json: <span class="hljs-literal">true</span> }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e, r, body)</span> </span>{
   <span class="hljs-comment">// Step 2a. Link user accounts.</span>
   <span class="hljs-keyword">if</span> (req.headers.authorization) {

   } <span class="hljs-keyword">else</span> { <span class="hljs-comment">// Step 2b. Create a new user account or return an existing one.</span>

   }
 });
});
</code></pre> 
      <blockquote> 
       <p><strong>Note:</strong> For production use, It may be better to create a function similar to <strong>isAuthenticated</strong> but it returns <em>true</em> or <em>false</em> instead of sending a response. The code above simply checks if <strong>req.headers.authorization</strong> is present. It does not check if the token is valid or whether it is properly formatted.</p> 
      </blockquote> 
      <p>Before proceeding further let us briefly go over some possible scenarios that may occur when this endpoint is requested, excluding extreme edge cases for the purposes of this tutorial:</p> 
      <ul> 
       <li>User is <span style="text-decoration: underline">not</span> logged in.
        <ul> 
         <li>Is this a returning user?
          <ul> 
           <li><strong>YES</strong>: Immediately return a token and a user object.</li> 
           <li><strong>NO</strong>: Create a new user with the Instagram profile information.</li> 
          </ul> </li> 
        </ul> </li> 
       <li>User is logged in via email account.
        <ul> 
         <li>Is there already an account with the given Instagram ID?
          <ul> 
           <li><strong>YES</strong>: Merge two accounts. Instagram account takes precedence. Email account is deleted.</li> 
           <li><strong>NO</strong>: Link current email account with the Instagram profile information.</li> 
          </ul> </li> 
        </ul> </li> 
      </ul> 
      <p>Let's do the second case first, when user is not logged in:</p> 
      <pre><code class="hljs javascript">app.post(<span class="hljs-string">'/auth/instagram'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span> </span>{
  <span class="hljs-keyword">var</span> accessTokenUrl = <span class="hljs-string">'https://api.instagram.com/oauth/access_token'</span>;

  <span class="hljs-keyword">var</span> params = {
    client_id: req.body.clientId,
    redirect_uri: req.body.redirectUri,
    client_secret: config.clientSecret,
    code: req.body.code,
    grant_type: <span class="hljs-string">'authorization_code'</span>
  };

  <span class="hljs-comment">// Step 1\. Exchange authorization code for access token.</span>
  request.post({ url: accessTokenUrl, form: params, json: <span class="hljs-literal">true</span> }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e, r, body)</span> </span>{
    <span class="hljs-comment">// Step 2a. Link user accounts.</span>
    <span class="hljs-keyword">if</span> (req.headers.authorization) {

    } <span class="hljs-keyword">else</span> { <span class="hljs-comment">// Step 2b. Create a new user account or return an existing one.</span>
      User.findOne({ instagramId: body.user.id }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, existingUser)</span> </span>{
        <span class="hljs-keyword">if</span> (existingUser) {
          <span class="hljs-keyword">var</span> token = createToken(existingUser);
          <span class="hljs-keyword">return</span> res.send({ token: token, user: existingUser });
        }

        <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">new</span> User({
          instagramId: body.user.id,
          username: body.user.username,
          fullName: body.user.full_name,
          picture: body.user.profile_picture,
          accessToken: body.access_token
        });

        user.save(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
          <span class="hljs-keyword">var</span> token = createToken(user);
          res.send({ token: token, user: user });
        });
      });
    }
  });
});
</code></pre> 
      <p>As I have explained above, it first checks if the user has alraedy signed-in before. We obviously don't want to create a new account every time they try to sign-in.</p> 
      <p>The next code snippet for the scenario when user is logged in, goes inside <strong>if (req.headers.authorization)</strong> block. I had to split it because it would be very hard to follow along.</p> 
      <pre><code class="hljs javascript">User.findOne({ instagramId: body.user.id }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, existingUser)</span> </span>{

  <span class="hljs-keyword">var</span> token = req.headers.authorization.split(<span class="hljs-string">' '</span>)[<span class="hljs-number">1</span>];
  <span class="hljs-keyword">var</span> payload = jwt.decode(token, config.tokenSecret);

  User.findById(payload.sub, <span class="hljs-string">'+password'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, localUser)</span> </span>{
    <span class="hljs-keyword">if</span> (!localUser) {
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">400</span>).send({ message: <span class="hljs-string">'User not found.'</span> });
    }

    <span class="hljs-comment">// Merge two accounts.</span>
    <span class="hljs-keyword">if</span> (existingUser) {

      existingUser.email = localUser.email;
      existingUser.password = localUser.password;

      localUser.remove();

      existingUser.save(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> token = createToken(existingUser);
        <span class="hljs-keyword">return</span> res.send({ token: token, user: existingUser });
      });

    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// Link current email account with the Instagram profile information.</span>
      localUser.instagramId = body.user.id;
      localUser.username = body.user.username;
      localUser.fullName = body.user.full_name;
      localUser.picture = body.user.profile_picture;
      localUser.accessToken = body.access_token;

      localUser.save(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> token = createToken(localUser);
        res.send({ token: token, user: localUser });
      });

    }
  });
});
</code></pre> 
      <p>This is not the prettiest code that I have written, but even if I had used something like <a target="_blank" rel="nofollow" href="https://github.com/caolan/async#waterfall">async.js waterfall</a> to deal with those callbacks it wouldn't have made this code that much simpler. Ideally, this route should be broken up into multiple functions if only to reduce the lines of code in the route and make it more readable. If testing is your number one concern then you will definitely want to break apart this route.</p> 
      <p>We first check if there is an existing account with the given Instagram ID, however, we don't do anything about it until <em>line 12</em>. After token is decoded and user id is obtained we fetch that user document, called <strong>localUser</strong> for convinience. If you have ever used Passport with <a target="_blank" rel="nofollow" href="http://passportjs.org/guide/username-password/">LocalStrategy</a> you may understand why I called it <strong>localUser</strong>. Ultimatelly, we need to differentiate two users somehow since we have two nested Mongoose queries on the same User model.</p> 
      <p>Next, if there is an existing account with the given Instagram ID, both email and password fields are added to it, effectively merging two accounts. Email account is deleted to avoid having multiple accounts for the same user. Remember, <strong>email</strong> field has the <strong>unique: true</strong> constraint, so we cannot have two MongoDB documents with the exact same email.</p> 
      <p>This merging part right here highly varies on case by case basis. If you have more than just email and password fields that need to be merged you will have to add them yourself. Or perhaps you wish to merge accounts in the opposite direction, merging the old account with the new one, then deleting an old account. Visually, they may look exactly the same, but they will have different ObjectIDs in database. There are many ways to merge accounts, this is one way to do it.</p> 
      <p>If it is the first time signing it with Instagram, we augment existing email account with new Instagram profile information obtained from the POST request to <strong><a target="_blank" rel="nofollow" href="https://api.instagram.com/oauth/access_token">https://api.instagram.com/oauth/access_token</a></strong>.</p> 
      <blockquote> 
       <p><strong>Note:</strong> Many OAuth providers will require you to access a separate endpoint in order to obtain user's profile information, as it is the case with Facebook, GitHub, Google and many other providers. That is not the case with Instagram; which is nice because if I had to nest the entire route within another callback, even I would not be able to read that code anymore.</p> 
      </blockquote> 
      <p>Here is the entire code snippet for the Instagram authentication route:</p> 
      <pre><code class="hljs javascript">app.post(<span class="hljs-string">'/auth/instagram'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span> </span>{
  <span class="hljs-keyword">var</span> accessTokenUrl = <span class="hljs-string">'https://api.instagram.com/oauth/access_token'</span>;

  <span class="hljs-keyword">var</span> params = {
    client_id: req.body.clientId,
    redirect_uri: req.body.redirectUri,
    client_secret: config.clientSecret,
    code: req.body.code,
    grant_type: <span class="hljs-string">'authorization_code'</span>
  };

  <span class="hljs-comment">// Step 1\. Exchange authorization code for access token.</span>
  request.post({ url: accessTokenUrl, form: params, json: <span class="hljs-literal">true</span> }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error, response, body)</span> </span>{

    <span class="hljs-comment">// Step 2a. Link user accounts.</span>
    <span class="hljs-keyword">if</span> (req.headers.authorization) {

      User.findOne({ instagramId: body.user.id }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, existingUser)</span> </span>{

        <span class="hljs-keyword">var</span> token = req.headers.authorization.split(<span class="hljs-string">' '</span>)[<span class="hljs-number">1</span>];
        <span class="hljs-keyword">var</span> payload = jwt.decode(token, config.tokenSecret);

        User.findById(payload.sub, <span class="hljs-string">'+password'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, localUser)</span> </span>{
          <span class="hljs-keyword">if</span> (!localUser) {
            <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">400</span>).send({ message: <span class="hljs-string">'User not found.'</span> });
          }

          <span class="hljs-comment">// Merge two accounts.</span>
          <span class="hljs-keyword">if</span> (existingUser) {

            existingUser.email = localUser.email;
            existingUser.password = localUser.password;

            localUser.remove();

            existingUser.save(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
              <span class="hljs-keyword">var</span> token = createToken(existingUser);
              <span class="hljs-keyword">return</span> res.send({ token: token, user: existingUser });
            });

          } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// Link current email account with the Instagram profile information.</span>
            localUser.instagramId = body.user.id;
            localUser.username = body.user.username;
            localUser.fullName = body.user.full_name;
            localUser.picture = body.user.profile_picture;
            localUser.accessToken = body.access_token;

            localUser.save(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
              <span class="hljs-keyword">var</span> token = createToken(localUser);
              res.send({ token: token, user: localUser });
            });

          }
        });
      });
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// Step 2b. Create a new user account or return an existing one.</span>
      User.findOne({ instagramId: body.user.id }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, existingUser)</span> </span>{
        <span class="hljs-keyword">if</span> (existingUser) {
          <span class="hljs-keyword">var</span> token = createToken(existingUser);
          <span class="hljs-keyword">return</span> res.send({ token: token, user: existingUser });
        }

        <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">new</span> User({
          instagramId: body.user.id,
          username: body.user.username,
          fullName: body.user.full_name,
          picture: body.user.profile_picture,
          accessToken: body.access_token
        });

        user.save(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
          <span class="hljs-keyword">var</span> token = createToken(user);
          res.send({ token: token, user: user });
        });
      });
    }
  });
});
</code></pre> 
      <p>Below is the collapsed overview of all the code we have in <span style="text-decoration: underline">server.js</span> so far:</p> 
      <p><a href="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-11-09-23.04.06.png"><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-11-09-23.04.06.png" alt="Screenshot 2014-11-09 23.04.06"></a>We are almost done on the back-end. Only three more routes to go and they are significantly smaller and simpler than the one above.</p> 
      <h2 id="-span-style-color-000000-15-instagram-api-endpoints-toc-span-"><span style="color: #000000"><strong>15. Instagram API Endpoints <a href="#toc"></a></strong></span></h2> 
      <p>In this section we will implement three new routes for:</p> 
      <ol> 
       <li>Get authenticated user's feed.</li> 
       <li>Get Instagram media by id.</li> 
       <li>Set a like on a media by the currently authenticated user</li> 
      </ol> 
      <p>Before writing a single line of code we must first find out which endpoints do we need to access. Go to the <a target="_blank" rel="nofollow" href="http://instagram.com/developer/endpoints/">Instagram API endpoints</a> to see a list of all API endpoints. In addition to showing you the parameters for a particular endpoint, you could also preview the entire response object, which I think that every API provider should have by default because. I find that having a sample API response is very helpful especially when working with the front-end. For example, I wouldn't have known about this object structure of image url until after I have made a request to Instagram with a valid access token.</p> 
      <pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">ng-src</span>=<span class="hljs-value">"{{photo.images.standard_resolution.url}}"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"thumbnail img-responsive"</span>&gt;</span>
</code></pre> 
      <p><a href="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-11-09-23.31.06.png"><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-11-09-23.31.06.png" alt="Screenshot 2014-11-09 23.31.06"></a></p> 
      <pre><code class="hljs javascript">app.get(<span class="hljs-string">'/api/feed'</span>, isAuthenticated, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span> </span>{
  <span class="hljs-keyword">var</span> feedUrl = <span class="hljs-string">'https://api.instagram.com/v1/users/self/feed'</span>;
  <span class="hljs-keyword">var</span> params = { access_token: req.user.accessToken };

  request.get({ url: feedUrl, qs: params, json: <span class="hljs-literal">true</span> }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error, response, body)</span> </span>{
    <span class="hljs-keyword">if</span> (!error &amp;&amp; response.statusCode == <span class="hljs-number">200</span>) {
      res.send(body.data);
    }
  });
});
</code></pre> 
      <p>Notice the <strong>isAuthenticated</strong> middleware in the code above. It prevents unauthorized access to this route. If you are not signed-in and try to go to <strong><a target="_blank" rel="nofollow" href="http://localhost:3000/api/feed">http://localhost:3000/api/feed</a></strong> you will get the following error message as expected:</p> 
      <p><a href="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-11-09-23.43.51.png"><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-11-09-23.43.51.png" alt="Screenshot 2014-11-09 23.43.51"></a></p> 
      <p>Our second route will retrieve information about a media object with a given media ID:</p> 
      <pre><code class="hljs javascript">
app.get(<span class="hljs-string">'/api/media/:id'</span>, isAuthenticated, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> </span>{
  <span class="hljs-keyword">var</span> mediaUrl = <span class="hljs-string">'https://api.instagram.com/v1/media/'</span> + req.params.id;
  <span class="hljs-keyword">var</span> params = { access_token: req.user.accessToken };

  request.get({ url: mediaUrl, qs: params, json: <span class="hljs-literal">true</span> }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error, response, body)</span> </span>{
    <span class="hljs-keyword">if</span> (!error &amp;amp;amp;&amp;amp;amp; response.statusCode == <span class="hljs-number">200</span>) {
      res.send(body.data);
    }
  });
});
</code></pre> 
      <p>You may have realized by now that there is virtually zero input validation and error handling throughout the project. That is intentional to keep the focus of this tutorial primarily on user authentication. If you were to deploy this code to production, you may want to return a 404 response, then catch it in Angular and display a 404 Media not found page or something like that.</p> 
      <p>Our last API route will allow to set a like on a media by the currently authenticated user:</p> 
      <pre><code class="hljs javascript">app.post(<span class="hljs-string">'/api/like'</span>, isAuthenticated, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> </span>{
  <span class="hljs-keyword">var</span> mediaId = req.body.mediaId;
  <span class="hljs-keyword">var</span> accessToken = { access_token: req.user.accessToken };
  <span class="hljs-keyword">var</span> likeUrl = <span class="hljs-string">'https://api.instagram.com/v1/media/'</span> + mediaId + <span class="hljs-string">'/likes'</span>;

  request.post({ url: likeUrl, form: accessToken, json: <span class="hljs-literal">true</span> }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error, response, body)</span> </span>{
    <span class="hljs-keyword">if</span> (response.statusCode !== <span class="hljs-number">200</span>) {
      <span class="hljs-keyword">return</span> res.status(response.statusCode).send({
        code: response.statusCode,
        message: body.meta.error_message
      });
    }
    res.status(<span class="hljs-number">200</span>).end();
  });
});
</code></pre> 
      <p>Instagram allows you to make <strong>5,000</strong> requests per hour per token to their API endpoints. If you exceed that limit you will get a Rate Limit Exceeded error. We will use <a target="_blank" rel="nofollow" href="http://tristanedwards.me/sweetalert">SweetAlert.js</a> on the client-side to display this error message when a user tries to like a media after API limit has been exceeded.</p> 
      <h2 id="16-back-to-the-client-side">16. Back to the client-side</h2> 
      <p>Let's go ahead and create a new user then try logging in to verify that our back-end implementation is working as expected.</p> 
      <p>Reload the browser, click on the <em>Sign up</em> link in the top Navbar, fill out the fields click on the <em>Sign up</em> button.<img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-11-23-19.16.59.png" alt="Screenshot 2014-11-23 19.16.59"></p> 
      <p>If all goes well you should be redirected to this page:</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screen-Shot-2014-11-23-at-7.38.03-PM.png" alt="Screen Shot 2014-11-23 at 7.38.03 PM"></p> 
      <p>What just happened? Well, by default, Satellizer will automatically sign in the user after successful user registration. This behavior can be turned off in <span style="text-decoration: underline">app.js</span> if you wish:</p> 
      <pre><code class="hljs javascript">$authProvider.loginOnSignup = <span class="hljs-literal">false</span>;
</code></pre> 
      <p>Right now you are looking at the <span style="text-decoration: underline">home.html</span> template. If you remember we had three possible states there:</p> 
      <ol> 
       <li>User is authenticated (email &amp; password or Instagram OAuth 2.0) and has Instagram username. This means that a user has signed-in with Instagram or created an email account and then connected it with his or her Instagram account.</li> 
       <li>User is not authenticated.</li> 
       <li>User is authenticated but does not have Instagram username. An account must be linked with Instagram before proceeding.</li> 
      </ol> 
      <p>Before we can link the Instagram account we need to make a few modifications to the <strong>HomeCtrl</strong> controller. Open <strong>controllers</strong>/home.js and replace <strong>$scope.linkInstagram</strong> function code with the following:</p> 
      <pre><code class="hljs javascript">$scope.linkInstagram = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  $auth.link(<span class="hljs-string">'instagram'</span>)
    .then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> </span>{
      $<span class="hljs-built_in">window</span>.localStorage.currentUser = <span class="hljs-built_in">JSON</span>.stringify(response.data.user);
      $rootScope.currentUser = <span class="hljs-built_in">JSON</span>.parse($<span class="hljs-built_in">window</span>.localStorage.currentUser);
      API.getFeed().success(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
        $scope.photos = data;
      });
    });
};
</code></pre> 
      <p>The only difference here is that we are calling <strong>API.getFeed()</strong> (which we are about to implement) after successfully linking the Instagram account. Once we get the data from the server and set it to $scope.photos, Angular's two-way binding will take care of the rest for us by displaying those photos in the <strong>Home</strong> template.</p> 
      <p>Before we move to implementing the <strong>API</strong> service, add the following code somewhere in the <strong>HomeCtrl</strong> controller as well:</p> 
      <pre><code class="hljs javascript"><span class="hljs-keyword">if</span> ($auth.isAuthenticated() &amp;&amp; ($rootScope.currentUser &amp;&amp; $rootScope.currentUser.username)) {
  API.getFeed().success(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
    $scope.photos = data;
  });
}
</code></pre> 
      <p>It is essentially the same code we have just added above. On page load, if user is authenticated, it will call <strong>API.getFeed()</strong> to fetch the latest photos from the user's Instagram feed.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-11-25-20.38.09.png" alt=""></p> 
      <blockquote> 
       <p><strong>Note:</strong> Do not forget to inject the <strong>API</strong> service into <strong>HomeCtrl</strong> controller as shown above.</p> 
      </blockquote> 
      <p>The only thing that is missing now is the <strong>API</strong> service itself. In the <strong>client</strong> directory create a new folder called <strong>services</strong>. That's where we will put our custom AngularJS services, factories, providers. In this tutorial we will only a single service.</p> 
      <p><a href="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-11-25-20.05.59.png"><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-11-25-20.05.59.png" alt="Screenshot 2014-11-25 20.05.59"></a></p> 
      <p>In this new <strong>services</strong> folder create a file called <span style="text-decoration: underline">api.js</span> with the following contents:</p> 
      <pre><code class="hljs javascript">angular.module(<span class="hljs-string">'Instagram'</span>)
  .factory(<span class="hljs-string">'API'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($http)</span> </span>{

    <span class="hljs-keyword">return</span> {
      getFeed: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> $http.get(<span class="hljs-string">'http://localhost:3000/api/feed'</span>);
      },
      getMediaById: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> </span>{
        <span class="hljs-keyword">return</span> $http.get(<span class="hljs-string">'http://localhost:3000/api/media/'</span> + id);
      },
      likeMedia: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> </span>{
        <span class="hljs-keyword">return</span> $http.post(<span class="hljs-string">'http://localhost:3000/api/like'</span>, { mediaId: id });
      }
    }

  });
</code></pre> 
      <p>The main purpose of this particular service is to abstract away HTTP requests to our server. The benefits of separating concerns will become more obvious once your app grows to be a little more complex than what we have here.</p> 
      <p>Finally, do not forget to include this service in <span style="text-decoration: underline">index.html</span>:</p> 
      <pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"services/api.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre> 
      <p>Reload the browser then click on the <em>Sign in with Instagram button</em>. After you log in to Instagram and successfuly authorize this app to use your Instagram profile information you should see a grid of photos displayed on the home page.</p> 
      <p>However, if you refresh the browser one more time you will be stuck on <em>Sign in with Instagram</em> screen once again. Let's fix that. Open <span style="text-decoration: underline">app.js</span> and add append the following <strong>.run</strong> block:</p> 
      <pre><code class="hljs javascript">.run(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($rootScope, $window, $auth)</span> </span>{
  <span class="hljs-keyword">if</span> ($auth.isAuthenticated()) {
    $rootScope.currentUser = <span class="hljs-built_in">JSON</span>.parse($<span class="hljs-built_in">window</span>.localStorage.currentUser);
  }
});
</code></pre> 
      <blockquote> 
       <p><strong>Note:</strong> You must remove the semicolon after the <strong>.config</strong> block above in order to chain the <strong>.run</strong> code block, otherwise you will have an invalid JavaScript syntax.</p> 
      </blockquote> 
      <p>Here is the whole thing:</p> 
      <pre><code class="hljs javascript">angular.module(<span class="hljs-string">'Instagram'</span>, [<span class="hljs-string">'ngRoute'</span>, <span class="hljs-string">'ngMessages'</span>, <span class="hljs-string">'chieffancypants.loadingBar'</span>, <span class="hljs-string">'satellizer'</span>])
  .config(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($routeProvider, $authProvider)</span> </span>{
    $routeProvider
      .when(<span class="hljs-string">'/'</span>, {
        templateUrl: <span class="hljs-string">'views/home.html'</span>,
        controller: <span class="hljs-string">'HomeCtrl'</span>
      })
      .when(<span class="hljs-string">'/login'</span>, {
        templateUrl: <span class="hljs-string">'views/login.html'</span>,
        controller: <span class="hljs-string">'LoginCtrl'</span>
      })
      .when(<span class="hljs-string">'/signup'</span>, {
        templateUrl: <span class="hljs-string">'views/signup.html'</span>,
        controller: <span class="hljs-string">'SignupCtrl'</span>
      })
      .when(<span class="hljs-string">'/photo/:id'</span>, {
        templateUrl: <span class="hljs-string">'views/detail.html'</span>,
        controller: <span class="hljs-string">'DetailCtrl'</span>
      })
      .otherwise(<span class="hljs-string">'/'</span>);

    $authProvider.loginUrl = <span class="hljs-string">'http://localhost:3000/auth/login'</span>;
    $authProvider.signupUrl = <span class="hljs-string">'http://localhost:3000/auth/signup'</span>;
    $authProvider.oauth2({
      name: <span class="hljs-string">'instagram'</span>,
      url: <span class="hljs-string">'http://localhost:3000/auth/instagram'</span>,
      redirectUri: <span class="hljs-string">'http://localhost:8000'</span>,
      clientId: <span class="hljs-string">'799d1f8ea0e44ac8b70e7f18fcacedd1'</span>,
      requiredUrlParams: [<span class="hljs-string">'scope'</span>],
      scope: [<span class="hljs-string">'likes'</span>],
      scopeDelimiter: <span class="hljs-string">'+'</span>,
      authorizationEndpoint: <span class="hljs-string">'https://api.instagram.com/oauth/authorize'</span>
    });
  })
  .run(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($rootScope, $window, $auth)</span> </span>{
    <span class="hljs-keyword">if</span> ($auth.isAuthenticated()) {
      $rootScope.currentUser = <span class="hljs-built_in">JSON</span>.parse($<span class="hljs-built_in">window</span>.localStorage.currentUser);
    }
  });
</code></pre> 
      <p>What this allows us to do is to grab the user object stored in the browser's local storage and assign it onto <strong>$rootScope.currentUser</strong> that is then globally available in the Angular application.</p> 
      <p><a href="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-11-25-21.01.18.png"><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-11-25-21.01.18.png" alt="Screenshot 2014-11-25 21.01.18"></a></p> 
      <p>Remember, with single page applications when you reload the browser, all your changes will be lost and the app is restored back to the original state. That is why we store the user object in browser's local storage after successful sign in, and then retrieve it when app is loaded. Consequently, it is our responsibility to clean up this local storage object during the user <em>log out</em> process.</p> 
      <p>Refresh the page and you should now see that everything works as expected:</p> 
      <p><img src="https://lh5.googleusercontent.com/-Vtj80ERZNVM/VIiaM1oOv9I/AAAAAAAAEps/MudM6vnOSkw/w1982-h1290-no/Screenshot%2B2014-11-25%2B21.22.53.png" alt=""></p> 
      <p>If you are still experiencing problems then try clearing the local storage by running <strong>localStorage.clear()</strong> in the <em>JavaScript Console</em> and creating a new user account.</p> 
      <h2 id="-span-style-color-000000-17-detail-page-toc-span-"><span style="color: #000000"><strong>17. Detail Page <a href="#toc"></a></strong></span></h2> 
      <p>One major piece that still remains is the detail page for a photo - individual page for each photo that contains a larger photo, descriptions, comments, number of likes.</p> 
      <p>Create a new template <strong>views/</strong><span style="text-decoration: underline">detail.html</span> with the following markup:</p> 
      <pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container"</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"panel panel-default"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"panel-body"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"row"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"col-xs-6"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">ng-src</span>=<span class="hljs-value">"{{photo.images.standard_resolution.url}}"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"img-responsive"</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"col-xs-6"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"caption"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h5</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://instagram.com/{{photo.user.username}}"</span>&gt;</span>{{photo.user.username}}<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">h5</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">h6</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"text-muted"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">i</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ion-clock"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">i</span>&gt;</span> {{photo.created_time * 1000 | date:'short'}}<span class="hljs-tag">&lt;/<span class="hljs-title">h6</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-title">p</span>&gt;</span>{{photo.caption.text}}<span class="hljs-tag">&lt;/<span class="hljs-title">p</span>&gt;</span>

          <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

      <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"row"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"col-xs-12"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">h5</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">i</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ion-heart text-danger"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">i</span>&gt;</span> {{photo.likes.count}} likes<span class="hljs-tag">&lt;/<span class="hljs-title">h5</span>&gt;</span>

          <span class="hljs-tag">&lt;<span class="hljs-title">hr</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"soften"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">h5</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"text-center"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">i</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ion-chatbox-working text-primary"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">i</span>&gt;</span> Comments<span class="hljs-tag">&lt;/<span class="hljs-title">h5</span>&gt;</span>

          <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"media-list"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">ng-repeat</span>=<span class="hljs-value">"comment in photo.comments.data"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"media"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"pull-left"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://instagram.com/{{comment.from.username}}"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"media-object img-rounded"</span> <span class="hljs-attribute">ng-src</span>=<span class="hljs-value">"{{comment.from.profile_picture}}"</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"media-body"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"media-heading"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://instagram.com/{{comment.from.username}}"</span>&gt;</span>@{{comment.from.username}}<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
                {{comment.text}}
              <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">ng-if</span>=<span class="hljs-value">"!photo.comments.data.length"</span>&gt;</span>No comments<span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>

          <span class="hljs-tag">&lt;<span class="hljs-title">hr</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"soften"</span>&gt;</span>

          <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"btn-group"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">button</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"btn"</span> <span class="hljs-attribute">ng-class</span>=<span class="hljs-value">"{ 'btn-danger': hasLiked, 'btn-default': !hasLiked }"</span> <span class="hljs-attribute">ng-click</span>=<span class="hljs-value">"like()"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">i</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ion-heart"</span> <span class="hljs-attribute">ng-class</span>=<span class="hljs-value">"{ 'text-danger': !hasLiked}"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">i</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">ng-if</span>=<span class="hljs-value">"hasLiked"</span>&gt;</span>Liked<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">span</span> <span class="hljs-attribute">ng-if</span>=<span class="hljs-value">"!hasLiked"</span>&gt;</span>Like<span class="hljs-tag">&lt;/<span class="hljs-title">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

        <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre> 
      <p>There is no point in going over this template as there no new concepts here that are worth mentioning. It has a lot of Bootstrap classes to make the page look pretty, but that's about it.</p> 
      <p>If you reload the browser and click on one of the thumbnails you should see this newly created template. However, since we have not created a controller for this page yet to fetch the data, nothing will be displayed here.</p> 
      <p><a href="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-11-25-21.58.08.png"><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-11-25-21.58.08.png" alt="Screenshot 2014-11-25 21.58.08"></a><br>In the <strong>controllers</strong> directory, create a new file called <span style="text-decoration: underline">detail.js</span>. Its main responsibilities are to handle <em>Like</em> action and fetch media data.</p> 
      <pre><code class="hljs javascript">angular.module(<span class="hljs-string">'Instagram'</span>)
.controller(<span class="hljs-string">'DetailCtrl'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($scope, $rootScope, $location, API)</span> </span>{

  <span class="hljs-keyword">var</span> mediaId = $location.path().split(<span class="hljs-string">'/'</span>).pop();

  API.getMediaById(mediaId).success(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(media)</span> </span>{
    $scope.hasLiked = media.user_has_liked;
    $scope.photo = media;
  });

  $scope.like = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    $scope.hasLiked = <span class="hljs-literal">true</span>;
    API.likeMedia(mediaId).error(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
      sweetAlert(<span class="hljs-string">'Error'</span>, data.message, <span class="hljs-string">'error'</span>);
    });
  };
});
</code></pre> 
      <p>Notice how I am stripping the Instagram media id from URL path and pass it to <strong>API.getMediaById(mediaId)</strong>. When we are navigating to the detail page by clicking on a thumbnail, at that point we do know what is the media id, hence this anchor tag:</p> 
      <pre><code class="hljs html"><span class="xml"> <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/photo/</span></span></span><span class="hljs-expression">{{<span class="hljs-variable">photo.id</span>}}</span><span class="xml"><span class="hljs-tag"><span class="hljs-value">"</span>&gt;</span></span>
</code></pre> 
      <p>But when we are visiting, say, <strong><a target="_blank" rel="nofollow" href="http://localhost:8000/#/photo/861959103308715759_787132">http://localhost:8000/#/photo/861959103308715759_787132</a></strong> directly or simply refresh that page we no longer have access to the <strong>$scope.photos</strong>, because it is part of the <strong>HomeCtrl</strong> controller that gets executed when we visit the home page ("/" route).</p> 
      <p>For the second method, <strong>$scope.like()</strong>, there is a temporary variable called <strong>hasLiked</strong>, if set to <strong>true</strong> will set the color of heart icon to red <span style="color: #ff0000">?</span> and update text from <em>Like</em> to <em>Liked</em>. See <span style="text-decoration: underline">detail.html</span> template above. In case there is an error, e.g. exceeded API requests limit per hour, a beautiful dialog message will be displayed with the error message. <del>Note that the like button will reset back to normal state if you refresh the page. Unfortunatelly, without making an additional Instagram API request, there is no way to get a list of all people that have liked a particular photo from the current API endpoint. That makes sense because some people have photos with well over a million of likes per photo, e.g. <em>Ariana Grande</em></del>. As <a target="_blank" rel="nofollow" href="https://github.com/sahat/instagram-hackhands/issues/1">@kukac7 pointed out</a>, there is a way to check if a particular user has <em>liked</em> one of the photos.</p> 
      <p><img src="https://lh3.googleusercontent.com/-1AVr_x1XdOQ/VIiZfegGCqI/AAAAAAAAEpk/UpS5XLsavPE/w1674-h1290-no/Screenshot%2B2014-11-25%2B22.31.38.png" alt=""></p> 
      <p>Up next we will implement the <strong>NavbarCtrl</strong> controller for handling <em>Logout</em> action, as well as hiding <em>Log in/Sign up</em> links if user is already authenticated and hiding Logout if user is not authenticated.</p> 
      <h2 id="18-navbar-enhancements">18. Navbar Enhancements</h2> 
      <p>Create a new file <strong>controllers/</strong><span style="text-decoration: underline">navbar.js</span> and paste the following code<span style="text-decoration: underline">:</span></p> 
      <pre><code class="hljs javascript">angular.module(<span class="hljs-string">'Instagram'</span>)
  .controller(<span class="hljs-string">'NavbarCtrl'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($scope, $rootScope, $window, $auth)</span> </span>{
    $scope.isAuthenticated = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">return</span> $auth.isAuthenticated();
    };

    $scope.logout = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      $auth.logout();
      <span class="hljs-keyword">delete</span> $<span class="hljs-built_in">window</span>.localStorage.currentUser;
    };
  });
</code></pre> 
      <p>This code should be fairly straightforward. There are only two methods here, both of which rely on the Satellizer module to check if user is authenticated and to perform a log out.</p> 
      <p>Log out is actually simpler than you might think at first. All it does is clear the JSON Web Token from local storage. There are no external HTTP requests to the server. Notice that as I mentioned earlier we need to delete <strong>currentUser</strong> from the local storage, otherwise it will be as if user is still signed in, while JSON Web Token is no longer present. No JWT token = Not Authenticated.</p> 
      <p>Satellizer's <strong>$auth.isAuthenticated()</strong> does a little more. In addition to checking if token is present in local storage, it also checks if token has not expired yet.</p> 
      <p>Open <span style="text-decoration: underline">index.html</span> and replace the entire Navbar block with the following markup. Lots of <strong>ng-if</strong> statements to condtionally display certain links based on whether user is authenticated or not, nothing more.</p> 
      <pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">ng-controller</span>=<span class="hljs-value">"NavbarCtrl"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar navbar-default navbar-static-top"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"nav navbar-nav"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"/"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"navbar-brand"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">i</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ion-images"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">i</span>&gt;</span> Instagram<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/"</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">ng-if</span>=<span class="hljs-value">"!isAuthenticated()"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/login"</span>&gt;</span>Log in<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">ng-if</span>=<span class="hljs-value">"!isAuthenticated()"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"#/signup"</span>&gt;</span>Sign up<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">ng-if</span>=<span class="hljs-value">"isAuthenticated()"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">ng-click</span>=<span class="hljs-value">"logout()"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">""</span>&gt;</span>Logout<span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">ul</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"nav navbar-nav navbar-right"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">li</span> <span class="hljs-attribute">ng-if</span>=<span class="hljs-value">"isAuthenticated() &amp;&amp; currentUser.username"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">a</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"http://instagram.com/{{currentUser.username}}"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">img</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"media-object img-rounded"</span> <span class="hljs-attribute">ng-src</span>=<span class="hljs-value">"{{currentUser.picture}}"</span>&gt;</span>
          @{{currentUser.username}}
        <span class="hljs-tag">&lt;/<span class="hljs-title">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">ul</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</code></pre> 
      <p>Refresh the page and assuming that you are still signed-in, both <em>Log in / Sign up</em> links should no longer be visible. Additionally, you should see your Instagram profile picture and username in the top right corner.</p> 
      <p><img src="https://lh6.googleusercontent.com/-TYJRMyl6254/VIiZa2KTbpI/AAAAAAAAEpc/DkwW_cX4OHI/w1982-h1290-no/Screenshot%2B2014-11-25%2B21.46.12.png" alt=""></p> 
      <h2 id="19-optimizations">19. Optimizations</h2> 
      <p>In this section we will cover some of the most common optimizations techniques to speed up our application. First, let's take a look at how long it takes to load a page before making any changes.</p> 
      <p><img src="https://lh3.googleusercontent.com/-0ECBuRc5gXY/VIiZY48m7TI/AAAAAAAAEpU/7iKSNLcnl7o/w1694-h1290-no/Screenshot%2B2014-12-07%2B16.22.55.png" alt=""></p> 
      <p>There are currently <strong>25 requests</strong> with a total size of <strong>1.40 MB</strong> and it takes <strong>442ms</strong> (+/- 100ms) to load this page. Build tool to the rescue. If you have read my previous tutorials then you already know how much I love <a target="_blank" rel="nofollow" href="http://gulpjs.com/">gulp.js</a>.</p> 
      <p>There a few easy optimizations we could do to speed up the performance of our web app:</p> 
      <ul> 
       <li>Minify and concatenate all JavaScript files.</li> 
       <li>Minify CSS.</li> 
       <li>Enable gzip compression on the server.</li> 
       <li>Cache AngularJS templates.</li> 
       <li>Cache static files on the server which includes all of our scripts and styles.</li> 
      </ul> 
      <p>But first, Let's make a small adjustment to our file structure. Move <span style="text-decoration: underline">package.json</span> from <strong>instagram/server</strong> one level up to <strong>instagram</strong> directory.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-07-16.32.37.png" alt="Screenshot 2014-12-07 16.32.37"></p> 
      <p>Then, update the <strong>"start"</strong> path to <strong>"node server/server.js"</strong> in order reflect the new structure. This way you could still type <strong>npm start</strong> to automatically start the Express app. Your <span style="text-decoration: underline">package.json</span> should look something like below:</p> 
      <pre><code class="hljs javascript">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"instagram-server"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"0.0.0"</span>,
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"start"</span>: <span class="hljs-string">"node server/server.js"</span>
  },
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"bcryptjs"</span>: <span class="hljs-string">"^2.0.2"</span>,
    <span class="hljs-string">"body-parser"</span>: <span class="hljs-string">"^1.8.1"</span>,
    <span class="hljs-string">"cors"</span>: <span class="hljs-string">"^2.4.2"</span>,
    <span class="hljs-string">"express"</span>: <span class="hljs-string">"^4.9.0"</span>,
    <span class="hljs-string">"jwt-simple"</span>: <span class="hljs-string">"^0.2.0"</span>,
    <span class="hljs-string">"moment"</span>: <span class="hljs-string">"^2.8.3"</span>,
    <span class="hljs-string">"mongoose"</span>: <span class="hljs-string">"^3.8.17"</span>,
    <span class="hljs-string">"request"</span>: <span class="hljs-string">"^2.44.0"</span>
  }
}
</code></pre> 
      <p>Open a terminal window and navigate to instagram project directory, then type the following:</p> 
      <pre><code class="hljs bash">npm install --save-dev gulp gulp-csso gulp-recess gulp-ng-annotate gulp-uglify gulp-concat gulp-angular-templatecache gulp-complexity gulp-header
</code></pre> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-07-17.47.12.png" alt=""></p> 
      <blockquote> 
       <p><strong>Note:</strong> The <strong>--save-dev</strong> flag will install specified packages and automatically add them to the <strong>devDependencies</strong> object in <span style="text-decoration: underline">package.json</span> as shown in the screenshot below.</p> 
      </blockquote> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-07-17.48.04.png" alt=""></p> 
      <p>Create a new file <span style="text-decoration: underline">gulpfile.js</span> in the <strong>instagram</strong> directory and the following dependencies:</p> 
      <pre><code class="hljs javascript"><span class="hljs-keyword">var</span> gulp = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp'</span>);
<span class="hljs-keyword">var</span> csso = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-csso'</span>);
<span class="hljs-keyword">var</span> uglify = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-uglify'</span>);
<span class="hljs-keyword">var</span> concat = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-concat'</span>);
<span class="hljs-keyword">var</span> recess = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-recess'</span>);
<span class="hljs-keyword">var</span> header = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-header'</span>);
<span class="hljs-keyword">var</span> gulpFilter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-filter'</span>);
<span class="hljs-keyword">var</span> complexity = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-complexity'</span>);
<span class="hljs-keyword">var</span> ngAnnotate = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-ng-annotate'</span>);
<span class="hljs-keyword">var</span> templateCache = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-angular-templatecache'</span>);
</code></pre> 
      <p>The first task that we create will handle JavaScript minification, concatenation, AngularJS inline annotations and AngularJS template caching. Furthermore, we will use <a target="_blank" rel="nofollow" href="https://www.npmjs.org/package/gulp-header">gulp-header</a> to add a comment block to the minified file containing <em>project name</em>, <em>author name</em>, <em>license</em> and <em>last updated date</em>. While it may not be strictly necessary for our purposes here I thought it would be nice to show it here anyway since we are covering <em>Gulp</em>. Paste the following code right after module dependencies:</p> 
      <pre><code class="hljs javascript"><span class="hljs-keyword">var</span> banner = [<span class="hljs-string">'/**'</span>,
    <span class="hljs-string">' * Instagram Demo'</span>,
    <span class="hljs-string">' * (c) 2014 Author Name'</span>,
    <span class="hljs-string">' * License: MIT'</span>,
    <span class="hljs-string">' * Last Updated: &lt;%= new Date().toUTCString() %&gt;'</span>,
    <span class="hljs-string">' */'</span>,
    <span class="hljs-string">''</span>].join(<span class="hljs-string">'\n'</span>);

gulp.task(<span class="hljs-string">'minify'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> templatesFilter = gulpFilter(<span class="hljs-string">'clients/views/*.html'</span>);

    <span class="hljs-keyword">return</span> gulp.src([
        <span class="hljs-string">'client/vendor/angular.js'</span>,
        <span class="hljs-string">'client/vendor/*.js'</span>,
        <span class="hljs-string">'client/app.js'</span>,
        <span class="hljs-string">'client/templates.js'</span>,
        <span class="hljs-string">'client/controllers/*.js'</span>,
        <span class="hljs-string">'client/services/*.js'</span>,
        <span class="hljs-string">'client/directives/*.js'</span>
    ])
        .pipe(templatesFilter)
        .pipe(templateCache({ root: <span class="hljs-string">'views'</span>, <span class="hljs-built_in">module</span>: <span class="hljs-string">'Instagram'</span> }))
        .pipe(templatesFilter.restore())
        .pipe(concat(<span class="hljs-string">'app.min.js'</span>))
        .pipe(ngAnnotate())
        .pipe(uglify())
        .pipe(header(banner))
        .pipe(gulp.dest(<span class="hljs-string">'client'</span>));
});
</code></pre> 
      <p>In <em>Gulp</em> everything flows from top to bottom, where each <strong>.pipe()</strong> method modifies the output in some shape or form, all the way until <strong>gulp.dest()</strong> is reached and output is saved to file.</p> 
      <p>The reason for passing such a long array of source files is because the order matters here for concatenation purposes. For example, we have to load <span style="text-decoration: underline">angular.js</span> before loading any Angular modules/libraries, likewise we have to load Angular modules before loading <span style="text-decoration: underline">app.js</span> and so on. The same reason we have defined <code>&lt;script&gt;</code> tags in this particular order in the index.html:</p> 
      <pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"vendor/angular.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"vendor/angular-route.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"vendor/angular-messages.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"vendor/satellizer.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"app.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"controllers/home.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"controllers/navbar.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"controllers/login.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"controllers/signup.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"controllers/detail.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"services/api.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"directives/serverError.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre> 
      <p>Next, using <a target="_blank" rel="nofollow" href="https://www.npmjs.org/package/gulp-filter">gulp-filter</a> we "take a detour" to another <strong>gulp.src()</strong> path to convert HTML templates into JavaScript by taking advantage of Angular's <a target="_blank" rel="nofollow" href="https://docs.angularjs.org/api/ng/service/$templateCache">$templateCache</a> feature. We have do this because Gulp does not allow you to specify multiple sources per task. After we finish with <em>angularTemplateCache</em> calling <strong>restore()</strong> method on a filter will take us back to the original <strong>gulp.src()</strong>.</p> 
      <blockquote> 
       <p><strong>Note:</strong> As an alternative we could have created a separate task called <strong>templates</strong> that gets run before <strong>minify</strong> task and then include the file generated by <strong>templates</strong> task (e.g. <span style="text-decoration: underline">templates.js</span>) in the <strong>minify</strong> task, and finally, remove <span style="text-decoration: underline">templates.js</span> after we are done. It is more work, but I thought I would point it out if you do not wish to use <em>gulp-filter</em>.</p> 
      </blockquote> 
      <p>The rest of the flow in <strong>minify</strong> task should be self-explanatory. Here is the preview of the minified <span style="text-decoration: underline">app.min.js</span> file:</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-07-17.50.28.png" alt="Screenshot 2014-12-07 17.50.28">Open <span style="text-decoration: underline">index.html</span> and comment out or remove previous <code>&lt;script&gt;</code> tags, we can now just include the single minified file:</p> 
      <pre><code class="hljs xml"><span class="hljs-comment">&lt;!--&lt;script src="vendor/angular.js"&gt;&lt;/script&gt;--&gt;</span>
<span class="hljs-comment">&lt;!--&lt;script src="vendor/angular-route.js"&gt;&lt;/script&gt;--&gt;</span>
<span class="hljs-comment">&lt;!--&lt;script src="vendor/angular-messages.js"&gt;&lt;/script&gt;--&gt;</span>
<span class="hljs-comment">&lt;!--&lt;script src="vendor/satellizer.js"&gt;&lt;/script&gt;--&gt;</span>
<span class="hljs-comment">&lt;!--&lt;script src="app.js"&gt;&lt;/script&gt;--&gt;</span>
<span class="hljs-comment">&lt;!--&lt;script src="controllers/home.js"&gt;&lt;/script&gt;--&gt;</span>
<span class="hljs-comment">&lt;!--&lt;script src="controllers/navbar.js"&gt;&lt;/script&gt;--&gt;</span>
<span class="hljs-comment">&lt;!--&lt;script src="controllers/login.js"&gt;&lt;/script&gt;--&gt;</span>
<span class="hljs-comment">&lt;!--&lt;script src="controllers/signup.js"&gt;&lt;/script&gt;--&gt;</span>
<span class="hljs-comment">&lt;!--&lt;script src="controllers/detail.js"&gt;&lt;/script&gt;--&gt;</span>
<span class="hljs-comment">&lt;!--&lt;script src="services/api.js"&gt;&lt;/script&gt;--&gt;</span>
<span class="hljs-comment">&lt;!--&lt;script src="directives/serverError.js"&gt;&lt;/script&gt;--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"app.min.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre> 
      <p>Moving on to the next Gulp task - <a target="_blank" rel="nofollow" href="https://www.npmjs.org/package/gulp-complexity">gulp-complexity</a>. It is a JavaScript complexity analysis tool. Again, not necessary for the optimizations we are doing but worth sharing nonetheless. Add the following task:</p> 
      <pre><code class="hljs javascript">gulp.task(<span class="hljs-string">'complexity'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> gulp.src([
        <span class="hljs-string">'!client/vendor/*.*'</span>,
        <span class="hljs-string">'!client/app.min.js'</span>,
        <span class="hljs-string">'client/**/*.js'</span>
    ])
        .pipe(complexity());
});
</code></pre> 
      <p>Here, we use the exclamation sign <strong>(!)</strong> to tell Gulp which files and directories to ignore. Now, if you run <strong>gulp complexity</strong> in the Terminal you should see something like the following:</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-07-18.29.30.png" alt="Screenshot 2014-12-07 18.29.30"></p> 
      <p>The last two tasks that we are going to add will be responsible for minifying and performing code quality analysis on CSS.</p> 
      <pre><code class="hljs javascript">gulp.task(<span class="hljs-string">'styles'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  gulp.src([
    <span class="hljs-string">'client/css/sweet-alert.css'</span>,
    <span class="hljs-string">'client/css/styles.css'</span>
  ])
    .pipe(concat(<span class="hljs-string">'styles.min.css'</span>))
    .pipe(csso())
    .pipe(gulp.dest(<span class="hljs-string">'client/css'</span>));
});

gulp.task(<span class="hljs-string">'recess'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
 gulp.src(<span class="hljs-string">'client/css/styles.css'</span>)
 .pipe(recess())
 .pipe(recess.reporter())
 .pipe(gulp.dest(<span class="hljs-string">'client/css'</span>));
});
</code></pre> 
      <p>Open <span style="text-decoration: underline">index.html</span> and update the stylesheet references from this:</p> 
      <pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"css/sweet-alert.css"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"css/styles.css"</span>&gt;</span>
</code></pre> 
      <p>To the following:</p> 
      <pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"css/styles.min.css"</span>&gt;</span>
</code></pre> 
      <p>Now, instead of serving 3 full size CSS files we are only serving 1 minified CSS file. I have intentionally moved <strong>recess </strong>into a separate task because if it fails, it will stop the entire Gulp process, which can be quite annoying, especially when you start the Gulp watcher "set it and forget it" in the background. However, you could use <a target="_blank" rel="nofollow" href="https://www.npmjs.org/package/gulp-plumber">gulp-plumber</a> or manually catch Gulp error events if you wish to do so. Let's run <strong>gulp recess</strong> and see what it looks like: <img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-07-18.58.07.png" alt="Screenshot 2014-12-07 18.58.07"> The last thing we are going to do is add task watchers and a default task:</p> 
      <pre><code class="hljs javascript">gulp.task(<span class="hljs-string">'watch'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  gulp.watch([<span class="hljs-string">'client/css/*.css'</span>, <span class="hljs-string">'!client/css/styles.min.css'</span>], [<span class="hljs-string">'styles'</span>]);
  gulp.watch([
    <span class="hljs-string">'client/app.js'</span>,
    <span class="hljs-string">'client/services/*.js'</span>,
    <span class="hljs-string">'client/directives/*.js'</span>,
    <span class="hljs-string">'client/controllers/*.js'</span>,
    <span class="hljs-string">'client/views/*.html'</span>
  ], [<span class="hljs-string">'minify'</span>]);
});
gulp.task(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'watch'</span>, <span class="hljs-string">'styles'</span>, <span class="hljs-string">'minify'</span>]);
</code></pre> 
      <blockquote> 
       <p><strong>Note:</strong> If you structure your client-side code reasonably well, you would not need to use these unwieldy path names above. I just haven't thought this through when I started writing this project and tutorial. If you had your Angular app in <span style="text-decoration: underline"><strong>src</strong></span> or <span style="text-decoration: underline"><strong>app</strong></span> directory and have you stylesheets, vendor files and minified <span style="text-decoration: underline">app.min.js</span> one or two directory levels above, then you could simply use <strong>gulp.watch('src/</strong>/<em>.{html, js}', ['minify'])*</em>. to do the same thing we are doing above.</p> 
      </blockquote> 
      <p>So, now if you run gulp it will automatically run <strong>styles</strong> and <strong>minify</strong> tasks and start monitoring for file changes. In other words, if you make any changes to your CSS files, Gulp will automatically re-run the <strong>styles</strong> task, similarly, if you make any changes in your AngularJS app, Gulp will automatically re-run the <strong>minify</strong> task.</p> 
      <p>That is what I meant by "set it and forget it". I typically start the Gulp process in the Terminal, then minimize the window to get it out of the way.</p> 
      <p>Ok, we are done with Gulp for the moment. Next, we will add gzip compression and static assets caching in Express. Install the following NPM module:</p> 
      <pre><code class="hljs bash">npm install --save compression
</code></pre> 
      <p><img src="https://lh3.googleusercontent.com/-nC20TtSOiVc/VIiZWk1eUoI/AAAAAAAAEpM/ebWnrBJKLpk/w1710-h1290-no/Screenshot%2B2014-12-07%2B19.14.49.png" alt=""></p> 
      <p>Then add it to the list of module dependencies in <strong>server/</strong><span style="text-decoration: underline">server.js</span>:</p> 
      <pre><code class="hljs javascript"><span class="hljs-keyword">var</span> compress = <span class="hljs-built_in">require</span>(<span class="hljs-string">'compression'</span>);
</code></pre> 
      <p>And finally add the <strong>compress()</strong> middleware before all other Express middlewares:</p> 
      <pre><code class="hljs javascript">app.set(<span class="hljs-string">'port'</span>, process.env.PORT || <span class="hljs-number">3000</span>);
app.use(compress());
app.use(cors());
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: <span class="hljs-literal">false</span> }));
app.use(express.static(path.join(__dirname, <span class="hljs-string">'public'</span>)));
</code></pre> 
      <p>To enable static assets caching update the static middleware as following:</p> 
      <pre><code class="hljs javascript">app.use(express.static(path.join(__dirname, <span class="hljs-string">'public'</span>), { maxAge: <span class="hljs-number">2628000000</span> }));
</code></pre> 
      <blockquote> 
       <p><strong>Note:</strong> One month is equivalent to 2628000000 milliseconds. You may want to create a separate variable such as <strong>oneDay</strong>, <strong>oneWeek</strong>, <strong>oneMonth</strong>, or <strong>oneYear</strong> instead of defining milliseconds directly in the middleware.</p> 
      </blockquote> 
      <p>And that is it, we are doing with optimizations. Let's check the <em>Network</em> tab in a Browser again. We should see a smaller number of requests and a smaller payload size.</p> 
      <p><img src="https://lh5.googleusercontent.com/-GeNx18oxabs/VIiXqrI5UrI/AAAAAAAAEpA/ybLrsx5hgZ4/w1694-h1290-no/Screenshot%2B2014-12-07%2B19.29.38.png" alt=""></p> 
      <p>Here is the quick summary of results:</p> 
      <ul> 
       <li>We went from <strong>25 requests</strong> to only <strong>14 requests</strong>.</li> 
       <li>The payload size decreased from <strong>1.40 MB</strong> to <strong>618 KB</strong>.</li> 
       <li>Page load time decreased from <strong>442ms</strong> (+/- 100ms) to roughly <strong>240ms</strong>.</li> 
      </ul> 
      <p>This is what I call a <em>low-hanging fruit</em> of web optimization_: w_e were able to obtain quite impressive results without a single change to the application business logic.</p> 
      <p>At the very least I hope you could take away some of these techniques found in this tutorial and apply them to your current and future projects.</p> 
      <p>Let's deploy this app to the cloud, shall we?</p> 
      <h2 id="20-deployment">20. Deployment</h2> 
      <p>Create a new file <span style="text-decoration: underline">.gitignore</span> in the <strong>instagram</strong> directory with the <strong>node_modules</strong> entry inside it. You can do this directly from the command line:</p> 
      <pre><code class="hljs bash">$ touch .gitignore
$ <span class="hljs-built_in">echo</span> node_modules &gt; .gitignore
</code></pre> 
      <p>This allows us to ignore <strong>node_modules</strong> directory when we commit files to Git. You will run into all sorts of issues if you try to deploy your Node.js apps to Heroku with <strong>node_modules</strong> commited to Git. Heroku will automatically download and install packages specified in <span style="text-decoration: underline">package.json</span>.</p> 
      <p>We will use <a target="_blank" rel="nofollow" href="http://heroku.com">Heroku</a> to host the back-end piece and <a target="_blank" rel="nofollow" href="http://dropbox.com">Dropbox</a> to host the front-end piece of our web application. Both services are free to use.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/logotype-vflFbF9pY.png" alt="Dropbox Logo"><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/heroku-Logo-1.jpg" alt="Heroku Logo"></p> 
      <p>Let's start with the back-end component. First, sign up and create a new application on Heroku.</p> 
      <p>Heroku's new clean Dashboard UI is very intuitive to use. (Great job Heroku engineers and designers)</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-07-21.21.26.png" alt="Screenshot 2014-12-07 21.21.26"></p> 
      <p>On the next screen you will see the instructions to get started. After you successfully run <strong>heroku login</strong> you can proceed to creating a new Git repository. Heroku, like many other cloud platforms, uses Git for the deployment process.</p> 
      <p>Open a terminal and navigate to the <span style="text-decoration: underline"><strong>instagram</strong> </span>directory, then type:</p> 
      <pre><code class="hljs bash">$ git init
$ heroku git:remote <span class="hljs-operator">-a</span> &lt;your heroku app name&gt;
$ git add .
$ git commit -am <span class="hljs-string">"initial commit"</span>
$ git push heroku master
</code></pre> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-07-22.20.20.png" alt="Screenshot 2014-12-07 22.20.20"></p> 
      <p>After it is done, visit <span style="text-decoration: underline"><a target="_blank" rel="nofollow" href="http://your-app-name.herokuapp.com">http://your-app-name.herokuapp.com</a></span> (in my case it is <span style="text-decoration: underline"><a target="_blank" rel="nofollow" href="http://instagram-server.herokuapp.com">http://instagram-server.herokuapp.com</a></span>) and you should see an <strong>Application Error</strong> page.</p> 
      <p>I already expected that, but let's take a look what exactly caused it. Inside the <span style="text-decoration: underline"><strong>instagram</strong></span> directory run <strong>heroku logs</strong> command:</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-07-22.22.34.png" alt="Screenshot 2014-12-07 22.22.34"></p> 
      <p>This error message basically says that our app was unable to connect to MongoDB on port 27017. We had to download, install and start MongoDB locally in order for our app to work, however, when we deployed our app to Heroku unfortunately our database was not able to magically teleport to Heroku as well.</p> 
      <p>Both <a target="_blank" rel="nofollow" href="https://www.compose.io">Compose</a> (previously MongoHQ) and <a target="_blank" rel="nofollow" href="http://mongolab.com">MongoLab</a> provide free MongoBD hosting. Alternatively, you could use one of my MongoDB databases that I created for the purposes of this tutorial:</p> 
      <pre><code class="hljs text"><span class="hljs-string">mongodb:</span><span class="hljs-comment">//hackhands:hackhands@ds063140.mongolab.com:63140/instagram</span>
</code></pre> 
      <p>Go back to Heroku dashboard and click on the <em>Settings</em> tab. You should see a button there called <em>Reveal Config Vars</em>. Click on it and then click on the <em>Edit</em> button in the same view. This is where you can set those configuration values from <span style="text-decoration: underline">config.js</span>. If you specify an envrionment variable here it will use that value, otherwise it will fallback to the string value.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-07-22.44.29.png" alt="Screenshot 2014-12-07 22.44.29"></p> 
      <p>Once you are ready to proceed click <em>Save</em>.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-07-22.50.57.png" alt="Screenshot 2014-12-07 22.50.57"></p> 
      <p>Now that is done, all that is left to do is restart our Heroku app by running <strong>heroku restart -a my-app-name</strong>:</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-07-23.02.50.png" alt="Screenshot 2014-12-07 23.02.50">If all goes well you should not see the <strong>Application Error</strong> page any longer. Keep in mind, since we have not created a <strong>GET /</strong> route you will not see anything if you just visit <a target="_blank" rel="nofollow" href="http://your-app-name.herokuapp.com">http://your-app-name.herokuapp.com</a>. But we could check <strong>GET /api/feed</strong> routeto make sure it is working correctly:</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-07-23.04.06.png" alt="Screenshot 2014-12-07 23.04.06">We are done with the back-end piece. Next, let's move to the front-end component. Copy all files from the <span style="text-decoration: underline"><strong>client</strong></span> directory into Dropbox's <span style="text-decoration: underline"><strong>Public</strong> <strong>Folder</strong></span>, preferably into a sub-directory, e.g. <span style="text-decoration: underline"><strong>instagram</strong></span> to keep it separate from other files that you might have in there.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-07-21.45.37.png" alt="Screenshot 2014-12-07 21.45.37"></p> 
      <p>Right-click on <span style="text-decoration: underline">index.html</span> and select <em>Copy public link...</em> from the dropdown menu. Copy that URL to clipboard.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-07-21.55.22.png" alt="Screenshot 2014-12-07 21.55.22"></p> 
      <p>Open the <span style="text-decoration: underline">app.js</span> file from the original <strong>instagram/client</strong> directory and update Satellizer's Instagram provider with the new URLs. You will need to update: <strong>loginUrl</strong>, <strong>signupUrl</strong>,as well as OAuth 2.0 <strong>url</strong> and <strong>redirectUri</strong> with your own Heroku and Dropbox URLs.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-08-00.20.28.png" alt=""></p> 
      <blockquote> 
       <p><strong>Note:</strong> Do not forget to update <strong>redirectUri</strong> on <a target="_blank" rel="nofollow" href="http://instagram.com/developer">instagram.com/developer</a> to the exact same <strong>redirectUri</strong> above.</p> 
      </blockquote> 
      <p>You will also need to update URLs in the <strong>client/services/</strong><span style="text-decoration: underline">api.js</span>:</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-08-00.20.19.png" alt=""></p> 
      <p>Next, run <strong>gulp</strong> (if it is not already running) to update the <span style="text-decoration: underline">app.min.js</span> file. Then copy <span style="text-decoration: underline">app.min.js</span> and paste it into the <span style="text-decoration: underline"><strong>instagram</strong></span> directory inside Dropbox's <strong>Public Folder</strong>, overwriting the old file.</p> 
      <blockquote> 
       <p><strong>Note:</strong> If you like this setup consider getting a custom domain and pointing it to your Dropbox Public Folder. Alternatively, consider using <a target="_blank" rel="nofollow" href="http://pages.github.com">GitHub Pages</a> for hosting static sites, honestly I think it is much easier approach than using Dropbox because it was never intended to be used for the purposes we are using Dropbox here. My personal website <a target="_blank" rel="nofollow" href="http://sahatyalkabov.com">http://sahatyalkabov.com</a> [<a target="_blank" rel="nofollow" href="https://github.com/sahat/sahat.github.com">source code</a>], for instance, has been running on GitHub Pages for over 2 years without any problems. And it's free.</p> 
      </blockquote> 
      <p>Notice that I am using <a target="_blank" rel="nofollow" href="https://instagram-server.herokuapp.com"><strong>https://</strong>instagram-server.herokuapp.com</a> instead of <a target="_blank" rel="nofollow" href="http://instagram-server.herokuapp.com"><strong>http://</strong>instagram-server.herokuapp.com</a>. Since Dropbox serves our front-end on a secure (https<em>)</em> protocol we cannot make a request to an unsecure (http) location. If you try to do that you will get the following error message:</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-08-00.20.50.png" alt="Screenshot 2014-12-08 00.20.50"></p> 
      <p>If you followed all the steps correctly all requests between <em>Heroku</em> (back-end) and <em>Dropbox</em> (front-end) should be working successfully now.</p> 
      <p><img src="/data/blogs/ClosedSource/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/assets/Screenshot-2014-12-08-00.36.56.png" alt="Screenshot 2014-12-08 00.36.56"></p> 
      <p>But seriously, if you must have a front-end and a back-end pieces running on separate servers, at least consider using GitHub Pages, Amazon S3 or <a target="_blank" rel="nofollow" href="https://www.digitalocean.com/community/questions/how-can-i-configure-nginx-to-deliver-static-html-pages">Digital Ocean with Nginx</a> to serve your static content. Also, cross origin requests are sometimes more trouble than it's worth, that is why I always prefer to have a server and a client running on the same host.</p> 
      <h2 id="-span-style-color-000000-21-conclusion-toc-span-"><span style="color: #000000"><strong>21. Conclusion <a href="#toc"></a></strong></span></h2> 
      <p>Congratulations on making it this far! It is now the longest blog post I have published to date. Funny, I said the exact same thing in my <a target="_blank" rel="nofollow" href="http://sahatyalkabov.com/create-a-tv-show-tracker-using-angularjs-nodejs-and-mongodb/">TV Show Tracker blog post</a>. Well, next thing you know I may be writing a book or something.</p> 
      <p>I originally planned to write a quick blog post on how to use the <a target="_blank" rel="nofollow" href="https://github.com/sahat/satellizer">Satellizer</a> module but it turned into this massive full-stack tutorial with well over 14 thousand words. Just to put things in perspective, I was asked to write this post 3 months ago, and so I have been writing it little by little.</p> 
      <p>This may seem like an extremely long hands-on blog post at first glance, but I hope you could take away something else from it. I started this post by saying that I created Satellizer because I was unsatisfied with existing authentication solutions at a time. So, I did something about that, despite not knowing anything about building AngularJS modules, JavaScript libraries or OAuth 1.0 &amp; OAuth 2.0 authentication flows. If there is a desire to do something you can almost certainly do it, provided that you are willing to put effort and time into it. So, if there is a a website, a library or a framework that you wish existed, use this as an opportunity to build it yourself. And if you ever get stuck on something along the way, take a break and come back to it later, but don't quit when things get difficult.</p> 
      <p>I hope you enjoyed this tutorial and learned something new after reading it There will be more blog posts by me in the near future either on my personal website or the <a target="_blank" rel="nofollow" href="http://yahoodevelopers.tumblr.com/">YDN blog</a>. Possible topics are OAuth 2.0, React, Flux and Swift.</p> 
      <p>And as always, you can email me directly with any questions, comments and feedback at <a href="mailto:sahat@me.com">sahat@me.com</a>.</p> 
     </div> 
     <div class="postAuthor mobile hide-on-desktop"> 
      <img class="thumb" src="https://secure.gravatar.com/avatar/e345bcfa4059c6caebedec1597f9eb5f?s=100&amp;d=https%3A%2F%2Fmentors-api-prod.s3-us-west-2.amazonaws.com%2Fstatic%2Favatar%2Favatar_normal.jpg"> 
      <div class="label">
       Written by
      </div> 
      <div class="name">
       <a href="/sahat">Sahat Yalkabov</a>
      </div> 
      <div class="location">
       America/New_York
      </div> 
      <div class="bio">
       Full Stack JavaScript developer and open-source contributor. Creator of the Hackathon Starter, Satellizer and Mega Boilerplate projects.
      </div> 
      <div class="links">
       <a rel="nofollow" target="_blank" href="https://github.com/sahat"><i class="icon icon-github"></i></a> 
       <a rel="nofollow" target="_blank" href="https://linkedin.com/in/sahatyalkabov"><i class="icon icon-linkedin"></i></a> 
      </div> 
      <div class="requestExpert"> 
       <a href="/dashboard/request/sahat/preferred" class="bt bt-hh">Request Expert</a> $2 / min 
      </div> 
     </div> 
     <div id="disqus_thread"></div> 
    </div> 
   </div> 
  </div> 
  <!-- [END] POST page --> 
  <!-- Footer Newsletter --> 
  <div class="component-subscribeNews"> 
   <form class="form" method="post" id="formNewsletter"> 
    <div class="grid-container" id="success"> 
     <div class="grid-100"> 
      <div class="title">
       <i class="icon-check"></i> Get on the mailing list!
      </div> 
      <div class="subTitle">
       The latest major updates, and nothing else.
      </div> 
     </div> 
     <div id="formNews"> 
      <div class="grid-25"> 
       <div class="field"> 
        <i class="icon icon-x formError" title=""></i> 
        <input type="text" name="news_name" placeholder="your name"> 
       </div> 
      </div> 
      <div class="grid-25"> 
       <div class="field"> 
        <i class="icon icon-x formError" title=""></i> 
        <input type="text" name="news_email" placeholder="you@domain.com"> 
       </div> 
      </div> 
      <div class="grid-35"> 
       <div class="field"> 
        <div class="custom-select"> 
         <select multiple name="news_languages" class="testselect2" style="display: none;"> <option value="Node.js">Node.js</option> <option value="Git">Git</option> <option value="Perl">Perl</option> <option value="JavaScript &amp; jQuery">JavaScript &amp; jQuery</option> <option value="HTML &amp; CSS">HTML &amp; CSS</option> <option value="Python &amp; Django">Python &amp; Django</option> <option value="PHP">PHP</option> <option value="Angular.js">Angular.js</option> <option value="SQL (MySQL &amp; Postgres)">SQL (MySQL &amp; Postgres)</option> <option value="Coffee Script">Coffee Script</option> <option value="Backbone.js">Backbone.js</option> <option value="Ruby on Rails">Ruby on Rails</option> <option value="React">React</option> <option value="Laravel">Laravel</option> <option value="Groovy on Grails">Groovy on Grails</option> <option value="Redis">Redis</option> <option value="Drupal">Drupal</option> <option value="ShellScript">ShellScript</option> <option value="Scala">Scala</option> <option value="Clojure">Clojure</option> <option value="Haskell">Haskell</option> <option value="Java &amp; J EE">Java &amp; J EE</option> <option value="Objective-C &amp; Swift">Objective-C &amp; Swift</option> <option value="C# &amp; .NET">C# &amp; .NET</option> <option value="C &amp; C++">C &amp; C++</option> <option value="Go">Go</option> <option value="Android">Android</option> <option value="CoffeeScript">CoffeeScript</option> <option value="Meteor.js">Meteor.js</option> <option value="NoSQL (MongoDB)">NoSQL (MongoDB)</option> <option value="XML">XML</option> <option value="Ember.js">Ember.js</option> <option value="Visual Basic">Visual Basic</option> <option value="ActionScript">ActionScript</option> <option value="Erlang">Erlang</option> <option value="Lua">Lua</option> <option value="Unity3d">Unity3d</option> <option value="DevOps &amp; SysAdmin">DevOps &amp; SysAdmin</option> <option value="R">R</option> <option value="F#">F#</option> <option value="MATLAB">MATLAB</option> </select> 
        </div> 
       </div> 
      </div> 
      <div class="grid-15"> 
       <button class="bt bt-hh" id="subscribe">subscribe</button> 
      </div> 
     </div> 
    </div> 
   </form> 
  </div> 
  <!-- [END] Footer Newsletter --> 
  <!-- Footer --> 
  <footer class="component-departments subscribeNews"> 
   <!-- Categories --> 
   <div class="grid-container categories"> 
    <div class="grid-25 "> 
     <div class="title">
       Get live help for these popular subjects 
      <span>plus many more!</span> 
     </div> 
    </div> 
    <div class="grid-75 cloud"> 
     <div class="row"> 
      <span class="w_1"><a href="/dashboard/request/expert?department=java">Java</a></span> 
      <span class="w_3"><a href="/dashboard/request/expert?department=node">Node.js</a></span> 
      <span class="w_3"><a href="/dashboard/request/expert?department=android">Android</a></span> 
      <span class="w_1"><a href="/dashboard/request/expert?department=csharp-dotnet">C# &amp; .NET</a></span> 
      <span class="w_1"><a href="/dashboard/request/expert?department=php">PHP</a></span> 
     </div> 
     <div class="row"> 
      <span class="w_1"><a href="/dashboard/request/expert?department=ember">Ember.js</a></span> 
      <span class="w_3"><a href="/dashboard/request/expert?department=objectivec-swift">iOS</a></span> 
      <span class="w_5"><a href="/dashboard/request/expert?department=javascript">Javascript</a></span> 
      <span class="w_3"><a href="/dashboard/request/expert?department=angular">Angular.js</a></span> 
      <span class="w_3"><a href="/dashboard/request/expert?department=go">Golang</a></span> 
     </div> 
     <div class="row"> 
      <span class="w_1"><a href="/dashboard/request/expert?department=meteor">Meteor.js</a></span> 
      <span class="w_1"><a href="/dashboard/request/expert?department=sql">SQL</a></span> 
      <span class="w_3"><a href="/dashboard/request/expert?department=ruby-on-rails">Ruby on Rails</a></span> 
      <span class="w_5"><a href="/dashboard/request/expert?department=html-css">HTML &amp; CSS</a></span> 
      <span class="w_1"><a href="/dashboard/request/expert?department=coffeescript">CoffeeScript</a></span> 
     </div> 
     <div class="row"> 
      <span class="w_1"><a href="/dashboard/request/expert?department=haskell">Haskell</a></span> 
      <span class="w_4"><a href="/dashboard/request/expert?department=python-django">Python &amp; Django</a></span> 
      <span class="w_1"><a href="/dashboard/request/expert?department=scala">Scala</a></span> 
     </div> 
    </div> 
   </div> 
   <!-- [END] Categories --> 
   <!-- Footer Menu --> 
   <div class="grid-container"> 
    <div class="grid-100"> 
     <div class="menuDown"> 
      <ul> 
       <li><a href="/create-expert-account/">Become an expert</a></li> 
       <li><a href="/login/">Login</a></li> 
       <li><a href="/blog/">Posts</a></li> 
       <li><a href="/faq/">FAQ</a></li> 
       <li><a href="/jobs/">Jobs</a></li> 
       <li><a href="/how-it-works/">How it works</a></li> 
       <li><a href="/success-stories/">Success stories</a></li> 
       <li><a href="/contact/">Contact us</a></li> 
      </ul> 
     </div> 
    </div> 
   </div> 
   <!-- [END] Footer Menu --> 
   <!-- SOCIAL + COPY --> 
   <div class="grid-container social"> 
    <div class="grid-15 socialIcons"> 
     <a target="_blank" href="https://twitter.com/hackhands"><i class="icon icon-twitter"></i></a> 
     <a target="_blank" href="https://www.facebook.com/hackhands"><i class="icon icon-facebook"></i></a> 
    </div> 
    <div class="grid-35 hide-on-mobile hide-on-tablet copyZone"> 
     <div class="hackhandsTxt">
      hack.hands( )
     </div> 
     <div class="copyright">
      © 2015 HackHands Inc. All rights reserved.
     </div> 
     <a href="/terms-of-service/">Terms of use</a> | 
     <a href="/terms-of-service/">Privacy Policy</a> 
    </div> 
    <div class="grid-50 tweetOfDay"> 
     <script type="text/html" id="tweetTPL">
			<$ for ( var i = 0; i < tweets.length; i++ ) { $>
				<div>
					<div class="intro"><i class="icon icon-twitter-1"></i> Latest Tweets - <a target="_blank"  href="https://twitter.com/hackhands">@hackhands</a></div>
					<$=linkify($('<div/>').text(tweets[i].text).html()) $>
				</div>
			<$ } $>
			</script> 
     <div id="tweetTPLRender"> 
      <div class="loading"> 
       <!-- loading tweets --> 
      </div> 
     </div> 
    </div> 
    <div class="grid-100 hide-on-desktop copyZone"> 
     <div class="hackhandsTxt">
      hack.hands( )
     </div> 
     <div class="copyright">
      © 2016 HackHands Inc. All rights reserved.
     </div> 
     <a href="/terms-of-service/">Terms of use</a> | 
     <a href="/terms-of-service/">Privacy Policy</a> 
    </div> 
   </div> 
   <!-- [END] Social + Copy --> 
  </footer> 
  <!-- [END] footer --> 
  <script type="text/javascript">
	var hhFooter = true;
</script> 
  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script> 
  <script>window.jQuery || document.write('<script src="/assets/bower_components/jquery/jquery.min.js"><\/script>')</script> 
  <!-- build:js(./public) /_js/plugins.js --> 
  <script type="text/javascript" src="/assets/bower_components/velocity/velocity.min.js"></script> 
  <script type="text/javascript" src="/assets/bower_components/velocity/velocity.ui.min.js"></script> 
  <script type="text/javascript" src="/assets/bower_components/owlcar/owl-carousel/owl.carousel.js"></script> 
  <script type="text/javascript" src="/assets/bower_components/vide/dist/jquery.vide.min.js"></script> 
  <script type="text/javascript" src="/assets/bower_components/malarkey/dist/malarkey.min.js"></script> 
  <script type="text/javascript" src="/assets/bower_components/selectize/dist/js/standalone/selectize.min.js"></script> 
  <script type="text/javascript" src="/assets/bower_components/tooltipster/js/jquery.tooltipster.min.js"></script> 
  <script type="text/javascript" src="/assets/bower_components/nouislider/distribute/jquery.nouislider.all.min.js"></script> 
  <script type="text/javascript" src="/assets/bower_components/momentjs/min/moment.min.js"></script> 
  <script type="text/javascript" src="/assets/bower_components/validate/validate.min.js"></script> 
  <script type="text/javascript" src="/assets/bower_components/js-cookie/src/js.cookie.js"></script> 
  <script type="text/javascript" src="/assets/bower_components/multiple-select/jquery.multiple.select.js"></script> 
  <!-- endbuild --> 
  <!-- build:js(./public) /_js/script.js --> 
  <script type="text/javascript" src="/assets/js/plugins.js"></script> 
  <script type="text/javascript" src="/assets/js/hackhands.js?version=344789"></script> 
  <script type="text/javascript" src="/assets/js/hackhands_controllers.js?version=344789"></script> 
  <!-- endbuild --> 
  <!--
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/instantclick/3.0.1/instantclick.min.js" data-no-instant></script>
<script data-no-instant>InstantClick.init();</script>
--> 
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44821373-1', 'auto');
  ga('send', 'pageview');
</script> 
  <!-- start Mixpanel --> 
  <script type="text/javascript">(function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);
mixpanel.init('51a513c708903848de49444c60805484');</script> 
  <!-- end Mixpanel --> 
  <script type="text/javascript">
mixpanel.track('Page Viewed', {
   'page name' : document.title,
   'url' : window.location.pathname
});
</script>   
  <div id="disqus_thread"></div> 
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    // Required: on line below, replace text in quotes with your forum shortname
    var disqus_shortname = 'hackhands';
	var disqus_url = 'https://hackhands.com/building-instagram-clone-angularjs-satellizer-nodejs-mongodb/';
	var disqus_title = "Build an Instagram clone with AngularJS, Satellizer, Node.js and MongoDB";

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script> 
  <noscript>
   Please enable JavaScript to view the 
   <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
  </noscript> 
 </body>
</html>