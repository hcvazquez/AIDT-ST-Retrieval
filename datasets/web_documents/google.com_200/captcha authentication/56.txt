<!doctype html>
<html lang="en">
 <head> 
  <!-- Page hiding snippet --> 
  <style>.async-hide { opacity: 0 !important} </style> 
  <script>(function(a,s,y,n,c,h,i,d,e){s.className+=' '+y;h.start=1*new Date;
h.end=i=function(){s.className=s.className.replace(RegExp(' ?'+y),'')};
(a[n]=a[n]||[]).hide=h;setTimeout(function(){i();h.end=null},c);h.timeout=c;
})(window,document.documentElement,'async-hide','dataLayer',4000,
{'GTM-MFPB9D':true});</script> 
  <title>
						Two-Factor Authentication for Shibboleth Identity Provider v3:
				Duo Security
</title> 
  <link rel="canonical" href="https://duo.com/docs/shibboleth"> 
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"> 
  <link rel="icon" type="image/x-icon" href="/favicon.ico"> 
  <link rel="alternate" type="application/rss+xml" href="https://duo.com/feed" title="The Duo Bulletin RSS Feed"> 
  <meta charset="utf-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"> 
  <meta name="robots" content="index,follow,archive"> 
  <meta property="fb:app_id" content="896409090480292"> 
  <meta property="og:title" content="Two-Factor Authentication for Shibboleth Identity Provider v3"> 
  <meta property="og:url" content="https://duo.com/docs/shibboleth"> 
  <meta property="og:site_name" content="Duo Security"> 
  <meta name="description" content="Two-factor authentication done right. Duo Security lets your users use their mobile phones to secure their logins, protecting your company from account takeover and data theft."> 
  <meta property="og:description" content="Two-factor authentication done right. Duo Security lets your users use their mobile phones to secure their logins, protecting your company from account takeover and data theft."> 
  <meta name="twitter:image" content="https://duo.com/assets/img/home/homepage-meta.jpg"> 
  <meta property="og:image" content="https://duo.com/assets/img/home/homepage-meta.jpg"> 
  <meta property="og:image:width" content="1200"> 
  <meta property="og:image:height" content="630"> 
  <!-- Third-Party Verifications --> 
  <meta name="bitly-verification" content="040b99f315c6"> 
  <meta name="google-site-verification" content="Svd8AHByyLSc2WLjqDZWIj1D2TNu8-U3fblDCieHxdU"> 
  <meta name="twitter:widgets:csp" content="on"> 
  <!-- Google Tag Manager (recommended in head) --> 
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-MFPB9D');</script> 
  <!-- End Google Tag Manager --> 
  <!-- ## Site CSS ## --> 
  <link rel="stylesheet" href="/site/themes/duo/css/production-2017.css?v=1506978971"> 
  <!--[if IE 9]>
		<link rel="stylesheet" type="text/css" href="/_themes/duo/css/if-ie9.css" />
	<![endif]--> 
  <!--[if lt IE 9]>
		<script>
			document.createElement('header');
			document.createElement('nav');
			document.createElement('section');
			document.createElement('article');
			document.createElement('aside');
			document.createElement('footer');
		</script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js" type="text/javascript"></script>
	<![endif]--> 
 </head> 
 <body id="top" class=""> 
  <a class="skpnav" href="#main-content">Skip navigation</a> 
  <header class="site-header"> 
   <div class="site-header-inner-wrap"> 
    <div class="inner"> 
     <a class="logo-wrap" href="/"><img class="logo" alt="Duo Security" src="/assets/img/duoLogo-web.png"></a> 
     <div class="menu-trigger-wrap"> 
      <a class="menu-trigger" href="#"><i class="menu-trigger-bars icon-bars"></i> Menu</a> 
     </div> 
     <div class="drawer"> 
      <div class="utility-nav"> 
       <a class="btn-login" href="https://admin.duosecurity.com">Login</a> 
       <a class="btn-signup" href="https://signup.duo.com/">Start Trial</a> 
       <a class="close-trigger" href="#">Close</a> 
       <!-- <a class="more-trigger search-trigger">Search</a> --> 
      </div> 
      <div id="search-wrap" class="visible"> 
       <form id="search-form" action="/search" method="GET"> 
        <input type="text" name="q" placeholder="Search" id="site-search"> 
        <button type="submit"><i class="icon-magnify-thick"></i></button> 
       </form> 
      </div> 
      <nav class="main-nav"> 
       <ul class="main-nav-list"> 
        <li class="main-nav-li"><a class="main-nav-link" href="/product">Product</a> 
         <ul class="main-nav-sub-list"> 
          <li class="main-nav-sub-li"><a class="main-nav-sub-link" href="/product/trusted-users">Trusted Users</a> </li> 
          <li class="main-nav-sub-li"><a class="main-nav-sub-link" href="/product/trusted-devices">Trusted Devices</a> </li> 
          <li class="main-nav-sub-li"><a class="main-nav-sub-link" href="/product/every-application">Every Application</a> </li> 
          <li class="main-nav-sub-li"><a class="main-nav-sub-link" href="/product/security-and-reliability">Security and Reliability</a> </li> 
         </ul> </li> 
        <li class="main-nav-li"><a class="main-nav-link" href="/use-cases">Use Cases</a> 
         <ul class="main-nav-sub-list"> 
          <li class="main-nav-sub-li"><a class="main-nav-sub-link" href="/use-cases/industry-solutions">Industry Solutions</a> </li> 
          <li class="main-nav-sub-li"><a class="main-nav-sub-link" href="/use-cases/case-studies">Case Studies</a> </li> 
         </ul> </li> 
        <li class="main-nav-li"><a class="main-nav-link" href="/pricing">Pricing</a> </li> 
        <li class="main-nav-li"><a class="main-nav-link" href="/about">About</a> 
         <ul class="main-nav-sub-list"> 
          <li class="main-nav-sub-li"><a class="main-nav-sub-link" href="/about/careers">Careers</a> </li> 
          <li class="main-nav-sub-li"><a class="main-nav-sub-link" href="/about/culture">Culture</a> </li> 
          <li class="main-nav-sub-li"><a class="main-nav-sub-link" href="/about/contact">Contact Us</a> </li> 
          <li class="main-nav-sub-li"><a class="main-nav-sub-link" href="/about/press">News &amp; Press</a> </li> 
         </ul> </li> 
        <li class="main-nav-li"><a class="main-nav-link" href="/partners">Partners</a> </li> 
        <li class="main-nav-li"><a class="main-nav-link" href="/resources">Resources</a> 
         <ul class="main-nav-sub-list"> 
          <li class="main-nav-sub-li"><a class="main-nav-sub-link" href="/resources/ebooks">Ebooks</a> </li> 
          <li class="main-nav-sub-li"><a class="main-nav-sub-link" href="/resources/events">Upcoming Events</a> </li> 
          <li class="main-nav-sub-li"><a class="main-nav-sub-link" href="/resources/infographics">Infographics</a> </li> 
          <li class="main-nav-sub-li"><a class="main-nav-sub-link" href="/resources/videos">Videos</a> </li> 
          <li class="main-nav-sub-li"><a class="main-nav-sub-link" href="/resources/glossary">InfoSec Glossary</a> </li> 
         </ul> </li> 
        <li class="main-nav-li"><a class="main-nav-link" href="/docs">Docs</a> </li> 
        <li class="main-nav-li"><a class="main-nav-link" href="/support">Support</a> </li> 
        <li class="main-nav-li"><a class="main-nav-link" href="/blog">Blog</a></li> 
        <li class="main-nav-li"><a class="main-nav-link" href="https://community.duo.com">Duo Community</a></li> 
       </ul> 
      </nav> 
     </div> 
     <div class="main-nav-lg-wrap"> 
      <nav class="main-nav-lg"> 
       <ul class="main-nav-lg-list"> 
        <li class="main-nav-lg-li"><a class="main-nav-lg-link product" href="/product">Product</a></li> 
        <li class="main-nav-lg-li"><a class="main-nav-lg-link use cases" href="/use-cases">Use Cases</a></li> 
        <li class="main-nav-lg-li"><a class="main-nav-lg-link pricing" href="/pricing">Pricing</a></li> 
        <li class="main-nav-lg-li"><a class="main-nav-lg-link about" href="/about">About</a></li> 
        <li class="main-nav-lg-li"><a class="main-nav-lg-link partners" href="/partners">Partners</a></li> 
        <li class="main-nav-lg-li"><a class="main-nav-lg-link resources" href="/resources">Resources</a></li> 
        <li class="main-nav-lg-li"><a class="main-nav-lg-link docs is-active" href="/docs">Docs</a></li> 
        <li class="main-nav-lg-li"><a class="main-nav-lg-link support" href="/support">Support</a></li> 
        <li class="main-nav-lg-li"><a id="js-more-trigger-text" class="main-nav-lg-link js-more-trigger" href="#" data-trigger-text="More" data-trigger-text-swap="Less">More</a><i id="js-main-nav-icon" class="icon main-nav-icon icon-chevron-down"></i></li> 
       </ul> 
      </nav> 
      <div class="utility-nav"> 
       <a class="btn-login" href="https://admin.duosecurity.com">Login</a> 
       <a class="btn-signup" href="https://signup.duo.com/">Start Trial</a> 
       <a id="js-open-icon" class="js-more-trigger search-trigger" href="#">
        <svg class="icon-magnifying-glass">
         <use xlink:href="#icon-magnifying-glass"></use>
        </svg></a> 
       <a id="js-close-icon" class="js-more-trigger search-trigger" href="#">
        <svg class="icon-x-mark-1">
         <use xlink:href="#icon-x-mark-1"></use>
        </svg></a> 
      </div> 
     </div> 
    </div> 
   </div> 
   <div class="drawer-lg"> 
    <div class="inner"> 
     <div id="search-wrap" class="visible"> 
      <form id="search-form" action="/search" method="GET"> 
       <input type="text" name="q" placeholder="Search" id="site-search"> 
       <button type="submit"><i class="icon-magnify-thick"></i></button> 
      </form> 
     </div> 
     <p class="drawer-lg-paragraph">Connect with Duo users and security professionals in our <a href="https://community.duo.com/"> Community</a>.</p> 
     <p class="drawer-lg-paragraph margin_bottom">Can't find what you're looking for? <a href="/about/contact">Contact Sales</a> or <a href="/support">Contact Support</a>.</p> 
     <nav class="secondary-main-nav"> 
      <ul class="secondary-main-nav-list"> 
       <li class="secondary-main-nav-li"><a class="secondary-main-nav-link" href="/resources"><strong>Resources</strong></a> 
        <ul class="secondary-main-nav-sub-list"> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/resources/ebooks">Ebooks</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/resources/videos">Videos</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/resources/infographics">Infographics</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/resources/events">Events &amp; Webinars</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/resources/glossary">InfoSec Glossary</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/resources/duo-insight">Phishing Tool</a></li> 
        </ul> </li> 
       <li class="secondary-main-nav-li"><a class="secondary-main-nav-link" href="/support"><strong>Support</strong></a> 
        <ul class="secondary-main-nav-sub-list"> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/docs">Documentation</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="https://help.duo.com">Knowledge Base</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="https://status.duo.com/">Status</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="https://guide.duo.com/">End-User Guide</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="https://community.duo.com/">Community</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/support#support-phone-numbers">Contact Support</a></li> 
        </ul> </li> 
       <li class="secondary-main-nav-li"><a class="secondary-main-nav-link" href="/about"><strong>About Duo</strong></a> 
        <ul class="secondary-main-nav-sub-list"> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/blog">Blog</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/about/careers">Careers</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/about/press">Press</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/about/contact">Contact Us</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/partners/managed-service-providers">MSP Program</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/labs/disclosure">Disclosure Policy</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/labs/security-response">Security Response</a></li> 
        </ul> </li> 
       <li class="secondary-main-nav-li"><a class="secondary-main-nav-link" href="/blog"><strong>Blog</strong></a> 
        <ul class="secondary-main-nav-sub-list"> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/blog/category/industry-news">Industry News</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/blog/category/product-updates">Product Updates</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/blog/category/duo-labs">Duo Labs</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/blog/category/engineering">Engineering</a></li> 
         <li class="secondary-main-nav-sub-li"><a class="secondary-main-nav-sub-link" href="/blog/category/press-and-events">Press and Events</a></li> 
        </ul> </li> 
      </ul> 
     </nav> 
    </div> 
   </div> 
  </header> 
  <a id="main-content" name="main-content"></a> 
  <div class="page"> 
   <section id="" class="leadin-full-width blue_bkgd"> 
    <div class="inner"> 
     <div class="leadin__content content max-width-7col"> 
      <h6><a href="/docs">Documentation</a></h6> 
      <h2>Duo for Shibboleth Identity Provider&nbsp;v3</h2> 
     </div> 
    </div> 
   </section> 
   <div class="doc-details"> 
    <div class="inner"> 
     <div class="doc-nav js-doc-nav"> 
      <div class="doc-sticker js-doc-sticker"> 
       <div class="doc-table-of-contents"> 
        <h4 class="doc-nav-header">Contents</h4> 
        <div id="toc"></div> 
       </div> 
       <div class="doc-related-links"> 
        <h4 class="doc-nav-header">Related</h4> 
        <ul> 
         <li><a href="/docs/shibboleth"> Shibboleth v3 Instructions</a></li> 
         <li><a href="/docs/shibboleth-faq"> Shibboleth FAQ</a></li> 
        </ul> 
       </div> 
      </div> 
     </div> 
     <div class="doc-content content"> 
      <div class="docs-feedback hidden"> 
       <h4>Feedback</h4> 
       <p>Was this page helpful? Let us know how we can make it better.</p> 
      </div> 
      <div class="intro">
       <p>Duo integrates with Shibboleth to add two-factor authentication for Shibboleth identity providers, complete with <a href="http://guide.duo.com/enrollment" target="_blank">inline self-service enrollment</a> and <a href="http://guide.duo.com/prompt" target="_blank">Duo Prompt</a>. The code is open-source and <a href="https://github.com/duosecurity/duo_shibboleth">available on GitHub</a>.</p> 
      </div> 
      <p>This plugin has been tested with Shibboleth Identity Provider v3.1.1.</p> 
      <p>Shibboleth v3.3 and later include a native Duo authentication login flow. Please do not try to use the instructions on this page with Shibboleth v3.3. <a href="https://wiki.shibboleth.net/confluence/display/IDP30/DuoAuthnConfiguration">See the DuoAuthnConfiguration documentation</a> for more information about the built-in Duo flow in Shibboleth v3.3.</p> 
      <h2>First Steps</h2> 
      <p>Before starting:</p> 
      <ol> 
       <li><a href="//signup.duo.com">Sign up for a Duo account</a>.</li> 
       <li>Log in to the <a href="https://admin.duosecurity.com">Duo Admin Panel</a> and navigate to <strong>Applications</strong>.</li> 
       <li>Click <strong>Protect an Application</strong> and locate <strong>Shibboleth</strong> in the applications list. Click <strong>Protect this Application</strong> to get your <strong>integration key</strong>, <strong>secret key</strong>, and <strong>API hostname</strong>. (See <a href="/docs/getting_started">Getting Started</a> for help.)</li> 
       <li>Use <a href="http://www.ntp.org/">NTP</a> to ensure that your server's time is correct.</li> 
       <li>Copy the <strong>duo_shibboleth.zip</strong> file <a href="https://github.com/duosecurity/duo_shibboleth">downloaded from GitHub</a> onto your Shibboleth server.</li> 
      </ol> 
      <p>The <span class="keyword">duo_shibboleth</span> plugin performs a second factor authentication after primary authentication, so you will need a working service provider configured with Shibboleth before continuing.</p> 
      <h2>Install Duo Using a Script<a name="installer"></a></h2> 
      <p>From the command line, run the installer from within the <strong>duo_shibboleth/v3</strong> directory with the following arguments:</p> 
      <pre><code>$ ./install.sh -i &lt;your_ikey&gt; -s &lt;your_skey&gt; -h &lt;your_host&gt; -d &lt;shibboleth_location&gt;
</code></pre> 
      <h5>Required Arguments</h5> 
      <table cellpadding="0" cellspacing="0"> 
       <tbody>
        <tr> 
         <td><code>-i</code></td>  
         <td>Your <span class="important">integration key</span> (i.e. <code>DIXXXXXXXXXXXXXXXXXX</code>) </td> 
        </tr> 
        <tr> 
         <td><code>-s</code></td> 
         <td>Your <span class="important">secret key</span></td> 
        </tr> 
        <tr> 
         <td><code>-h</code></td> 
         <td>Your <span class="important">API hostname</span> (i.e. <code>api-XXXXXXXX.duosecurity.com</code>) </td>
        </tr>
       </tbody>
      </table> 
      <h5>Optional Arguments</h5> 
      <table cellpadding="0" cellspacing="0"> 
       <tbody>
        <tr> 
         <td><code>-d</code></td> 
         <td>The directory where Shibboleth is installed. Defaults to <span class="important">/opt/shibboleth-idp</span> if not specified.</td> 
        </tr> 
       </tbody>
      </table> 
      <p>The script copies Duo configuration files into your Shibboleth install directory. If the script is unable to copy the necessary Duo files, try <a href="#install-duo-manually">installing Duo manually</a>.</p> 
      <p>After running the install script, follow the instructions to <a href="#configure">Configure the Identity Provider</a>.</p> 
      <h2>Install Duo Manually</h2> 
      <p>To install the Duo plugin for Shibboleth manually, first find the top directory of your Shibboleth installation, called <code>$SHIBBOLETH_DIR</code> below. This is usually <strong>/opt/shibboleth-idp</strong>.</p> 
      <p>If you've already installed Duo using the <a href="#installer">install script</a> you don't need to perform these manual install steps. Skip to <a href="#configure">Configure the Identity Provider</a>.</p> 
      <ol> 
       <li><p>Install the duo_java JAR <a name="install_duo_java"></a> from the <strong>duo_shibboleth/v3</strong> directory.</p> <p>Copy the prebuilt <strong>duo.jar</strong> from the unzipped plugin directory into the Shibboleth lib directory.</p> <pre><code>cp IDP_HOME/edit-webapp/WEB-INF/lib/DuoWeb-1.2-SNAPSHOT.jar $SHIBBOLETH_DIR/edit-webapp/WEB-INF/lib/
</code></pre></li> 
       <li><p>Install the duo_client_java JAR <a name="install_duo_client_java"></a> from the <strong>duo_shibboleth/v3</strong> directory.</p> <p>Copy the prebuilt <strong>duo-client-0.2.1.jar</strong> from the unzipped plugin directory into the Shibboleth lib directory.</p> <pre><code>cp IDP_HOME/edit-webapp/WEB-INF/lib/duo-client-0.2.1-jar-with-dependencies.jar $SHIBBOLETH_DIR/edit-webapp/WEB-INF/lib/
</code></pre></li> 
       <li><p>Install the DuoShibboleth-1.0 JAR<a name="install_duoshib_java"></a> from the <strong>duo_shibboleth/v3</strong> directory.</p> <p>Copy the prebuilt DuoShibboleth-1.0.jar from the unzipped plugin directory into the Shibboleth edit-webapp/WEB-INF/lib directory.</p> <pre><code>cp IDP_HOME/edit-webapp/WEB-INF/lib/DuoShibboleth-1.0.jar $SHIBBOLETH_DIR/edit-webapp/WEB-INF/lib/
</code></pre></li> 
       <li><p>Install the Duo-Web-v2 JavaScript file from the <strong>duo_shibboleth/v3</strong> directory.</p> <p>Copy the Duo-Web-v2.min.js from the unzipped plugin directory into Shibboleth edit-webapp/js directory. If the js directory does not already exist, create it.</p> <pre><code>cp IDP_HOME/edit-webapp/js/Duo-Web-v2.min.js $SHIBBOLETH_DIR/edit-webapp/js/
</code></pre></li> 
       <li><p>Install the Duo Velocity Macro<a name="install_duo_vm"></a> from the <strong>duo_shibboleth/v3</strong> directory.</p> <p>Copy duo.vm from the unzipped plugin directory into the Shibboleth views directory.</p> <pre><code>cp IDP_HOME/views/duo.vm $SHIBBOLETH_DIR/views/
</code></pre></li> 
       <li><p>Install the Duo Spring Webflow from the <strong>duo_shibboleth/v3</strong> directory.</p> <p>Copy duo-authn-flow.xml from the unzipped plugin directory into the Shibboleth flows/authn/Duo directory. If the Duo directory does not already exist, create it.</p> <pre><code>cp IDP_HOME/flows/authn/Duo/duo-authn-flow.xml $SHIBBOLETH_DIR/flows/authn/Duo/
</code></pre> <p>After manually copying the files, follow the <a href="#configure">Configure the Identity Provider</a> instructions.</p></li> 
      </ol> 
      <h2>Configure the Identity Provider<a name="configure"></a></h2> 
      <h3>Generate an akey</h3> 
      <p>Your application secret key (or <strong>akey</strong>) is a string that you should generate and keep secret from Duo. It should be at least 40 characters long and stored alongside your integration key and secret key in a configuration file.</p> 
      <p>You can generate a random string in Python with:</p> 
      <pre><code class="language-python">import os, hashlib
print hashlib.sha1(os.urandom(32)).hexdigest()
</code></pre> 
      <h3>Edit idp.properties</h3> 
      <p>Open idp.properties file located at $SHIBBOLETH_DIR/conf/idp.properties. Add the following values at the end of the file:</p> 
      <h5>Required</h5> 
      <table class="config_options" cellpadding="0" cellspacing="0"> 
       <tbody>
        <tr> 
         <td> <code class="param">duo.ikey</code> </td> 
         <td> Your Duo integration key. </td> 
        </tr> 
        <tr> 
         <td> <code class="param">duo.skey</code> </td> 
         <td> <p>Your Duo secret key.</p> </td> 
        </tr> 
        <tr> 
         <td> <code class="param">duo.akey</code> </td> 
         <td> <p>Your Duo application key that you created earlier.</p> </td> 
        </tr> 
        <tr> 
         <td> <code class="param">duo.host</code> </td> 
         <td> Your Duo API hostname (e.g. “api-XXXXXXXX.duosecurity.com”). </td> 
        </tr> 
       </tbody>
      </table> 
      <h5>Optional</h5> 
      <table> 
       <tbody>
        <tr> 
         <td> <code class="param">duo.failmode</code> </td> 
         <td> Either "safe" or "secure": 
          <table class="hasheader" cellpadding="0" cellspacing="0"> 
           <tbody>
            <tr> 
             <td> "safe" </td> 
             <td> In the event that Duo's service cannot be contacted, users' authentication attempts will be permitted if primary authentication succeeds. (Default) </td> 
            </tr> 
            <tr> 
             <td> "secure" </td> 
             <td> In the event that Duo's service cannot be contacted, all users' authentication attempts will be rejected. </td> 
            </tr> 
           </tbody>
          </table> </td> 
        </tr> 
       </tbody>
      </table> 
      <p>For example:</p> 
      <pre><code>#Duo Configuration
duo.ikey = DIXXXXXXXXXXXXXXXXXX
duo.skey = XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
duo.akey = XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
duo.host = api-XXXXXXXX.duosecurity.com
duo.failmode = safe
</code></pre> 
      <h3>Edit conditions-flow.xml</h3> 
      <p>Edit the conditions-flow.xml file located at $SHIBBOLETH_DIR/flows/authn/conditions/conditions-flow.xml.</p> 
      <ol> 
       <li><p>Add the following to the top of the <code>&lt;action-state id="ValidateUsernamePassword"&gt;</code> section:</p> <pre><code>&lt;!-- Enable Duo Two-Factor Authentication --&gt;
&lt;evaluate expression="ValidateUsernamePassword" /&gt;
&lt;evaluate expression="'duo'" /&gt;
&lt;transition on="duo" to="DuoAuth" /&gt;
&lt;!-- End Duo Two-Factor Authentication --&gt;
</code></pre></li> 
       <li><p>Add the following directly before <code>&lt;/flow&gt;</code> at the bottom of the file:</p> <pre><code>&lt;subflow-state id="DuoAuth" subflow="authn/Duo"&gt;
    &lt;input name="calledAsSubflow" value="true" /&gt;
    &lt;transition on="proceed" to="proceed" /&gt;
&lt;/subflow-state&gt;
</code></pre></li> 
      </ol> 
      <h3>Rebuild WAR file</h3> 
      <p>Run the following to rebuild the Shibboleth WAR file:</p> 
      <pre><code>/opt/shibboleth-idp/bin/build.sh</code></pre> 
      <h3>Restart Web Server</h3> 
      <p>Restart your web server for the changes to take effect.</p> 
      <h2>Test Your Setup</h2> 
      <p>Start the identity provider and authenticate against it with a Shibboleth service provider. You are prompted to enroll with Duo after authenticating to Shibboleth.</p> 
      <p>After completing enrollment you'll see the Duo authentication prompt during all subsequent Shibboleth logins.</p> 
      <p></p> 
      <h2>Network Diagram</h2> 
      <p><img src="/assets/img/documentation/shibboleth/shibboleth_network_diagram_2x.png" width="650" alt="Duo Shibboleth Network Diagram" class="figure"></p> 
      <ol> 
       <li>Application or Service connection initiated</li> 
       <li>Primary authentication</li> 
       <li>Client connection established to Duo Security over TCP port 443</li> 
       <li>Secondary authentication via Duo Security’s service</li> 
       <li>Shibboleth client receives authentication response.</li> 
       <li>Application or Service session logged in</li> 
      </ol> 
      <h2>Appendix: Building Manually</h2> 
      <h3>Build the JAR files</h3> 
      <p>If you'd prefer to build your own JAR files to use with Shibboleth please follow the steps below:</p> 
      <ol> 
       <li><p>duo-client-0.2.1-jar-with-dependencies.jar:</p> <pre><code>git clone https://github.com/duosecurity/duo_client_java
cd duo_client_java/duo-client
mvn package
cp target/duo-client-0.2.1-jar-with-dependencies.jar $SHIBBOLETH_DIR/edit-webapp/WEB-INF/lib/</code></pre></li> 
       <li><p>DuoWeb-1.2-SNAPSHOT.jar:</p> <pre><code>git clone https://github.com/duosecurity/duo_java
cd duo_java/DuoWeb
mvn package
cp target/DuoWeb-1.2-SNAPSHOT.jar $SHIBBOLETH_DIR/edit-webapp/WEB-INF/lib/</code></pre></li> 
       <li><p>DuoShibboleth-1.0.jar:</p> <pre><code>git clone https://github.com/duosecurity/duo_shibboleth
cd duo_shibboleth/v3/DuoShibboleth
mvn package
cp DuoShibboleth-1.0.jar SHIBBOLETH_DIR/edit-webapp/WEB-INF/lib/</code></pre></li> 
      </ol> 
      <p>If you would like to utilize a manually built dependent JAR when building DuoShibboleth, then copy the respective JARs to <code>IDP_HOME/edit-webapp/WEB-INF/lib</code> before building.</p> 
      <div class="case-study-cta"> 
       <h4>Ready to Get Started?</h4> 
       <a class="button external" href="https://signup.duo.com" target="_blank">Sign Up Free</a> 
      </div> 
     </div> 
    </div> 
   </div> 
  </div> 
  <footer class="site-footer"> 
   <div class="inner"> 
    <ul class="contact-info-list"> 
     <li class="contact-info-li"> <span class="contact-info-label">Contact Support</span> <span class="contact-info"><a href="mailto:support@duo.com">support@duo.com</a></span> </li> 
     <li class="contact-info-li"> <span class="contact-info-label">Call Sales</span> <span class="contact-info"><a href="tel:866-760-4247">1.866.760.4247</a></span> </li> 
     <li class="contact-info-li"> <span class="contact-info-label">Email Sales</span> <span class="contact-info"><a href="/about/contact">Contact Sales</a></span> </li> 
    </ul> 
    <hr> 
    <ul class="footer-nav-list footer-col-one"> 
     <li class="footer-nav-li"><span class="footer-labels"><a class="footer-nav-link" href="/product/trusted-users">Trusted Users</a></span> 
      <ul class="footer-child-nav"> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/product/trusted-users/two-factor-authentication">Two-Factor Authentication</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/product/trusted-users/two-factor-authentication/duo-mobile">Duo Mobile</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/product/trusted-users/two-factor-authentication/authentication-methods">Authentication Methods</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/product/trusted-users/user-access-policies">User Access Policies</a></li> 
      </ul> </li> 
     <li class="footer-nav-li"><span class="footer-labels"><a class="footer-nav-link" href="/product/trusted-devices">Trusted Devices</a></span> 
      <ul class="footer-child-nav"> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/product/trusted-devices/device-insight">Device Insight</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/product/trusted-devices/endpoint-remediation">Endpoint Remediation</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/product/trusted-devices/self-remediation">Self-Remediation</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/product/trusted-devices/device-access-policies">Device Access Policies</a></li> 
      </ul> </li> 
     <li class="footer-nav-li"><span class="footer-labels"><a class="footer-nav-link" href="/product/every-application">Every Application</a></span> 
      <ul class="footer-child-nav"> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/product/every-application/supported-applications/cloud-apps">Duo Access Gateway</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/product/every-application/single-sign-on">Single Sign-On (SSO)</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/product/every-application/supported-applications">Supported Applications</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/product/every-application/application-access-policies">Application Access Policies</a></li> 
      </ul> </li> 
    </ul> 
    <ul class="footer-nav-list footer-col-two"> 
     <li class="footer-nav-li"><span class="footer-labels"><a class="footer-nav-link" href="/use-cases">Use Cases</a></span> 
      <ul class="footer-child-nav"> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/use-cases/industry-solutions/education">Education</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/use-cases/industry-solutions/government">Federal</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/use-cases/industry-solutions/financial">Financial</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/use-cases/industry-solutions/healthcare">Healthcare</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/use-cases/industry-solutions/legal">Legal</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/use-cases/industry-solutions/retail">Retail</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/use-cases/industry-solutions/technology">Technology</a></li> 
      </ul> </li> 
     <li class="footer-nav-li"><span class="footer-labels"><a class="footer-nav-link" href="/use-cases/case-studies">Case Studies</a></span> 
      <ul class="footer-child-nav"> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/use-cases/case-studies/etsy">Etsy</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/use-cases/case-studies/threadless">Threadless</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/use-cases/case-studies/eventbrite">Eventbrite</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/use-cases/case-studies/facebook">Facebook</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/use-cases/case-studies/yelp">Yelp</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/use-cases/case-studies">View All</a></li> 
      </ul> </li> 
    </ul> 
    <ul class="footer-nav-list footer-col-three"> 
     <li class="footer-nav-li"><span class="footer-labels"><a class="footer-nav-link" href="/resources">Resources</a></span> 
      <ul class="footer-child-nav"> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/resources/ebooks">Ebooks</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/resources/videos">Videos</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/resources/infographics">Infographics</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/resources/events">Events &amp; Webinars</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/resources/glossary">InfoSec Glossary</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/resources/duo-insight">Phishing Tool</a></li> 
      </ul> </li> 
     <li class="footer-nav-li"><span class="footer-labels"><a class="footer-nav-link" href="/support">Support</a></span> 
      <ul class="footer-child-nav"> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/docs">Documentation</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="https://help.duo.com">Knowledge Base</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="https://status.duo.com">Status</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="https://guide.duo.com">End-User Guide</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="https://community.duo.com">Community</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/support#support-phone-numbers">Contact Support</a></li> 
      </ul> </li> 
    </ul> 
    <ul class="footer-nav-list footer-col-four"> 
     <li class="footer-nav-li"><span class="footer-labels"><a class="footer-nav-link" href="/about">About Duo</a></span> 
      <ul class="footer-child-nav"> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/blog">Blog</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/about/careers">Careers</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/about/culture">Culture</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/about/press">Press</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/about/contact">Contact Us</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/partners/managed-service-providers">MSP Program</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/labs/disclosure">Disclosure Policy</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/labs/security-response">Security Response</a></li> 
      </ul> </li> 
     <li class="footer-nav-li"><span class="footer-labels"><a class="footer-nav-link" href="/legal/terms">Legal</a></span> 
      <ul class="footer-child-nav"> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/legal/terms">Terms of Service</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/legal/privacy">Privacy Policy</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/legal/cookies">Cookie Policy</a></li> 
      </ul> </li> 
     <li class="footer-nav-li"><span class="footer-labels"><a class="footer-nav-link" href="/pricing">Pricing</a></span> 
      <ul class="footer-child-nav"> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/pricing/duo-free">Duo Free</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/pricing/duo-mfa">Duo MFA</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/pricing/duo-access">Duo Access</a></li> 
       <li class="footer-child-nav-li"><a class="footer-child-nav-link" href="/pricing/duo-beyond">Duo Beyond</a></li> 
      </ul> </li> 
    </ul> 
    <div class="footer-col-five t-icon--dark"> 
     <div class="newsletter-signup-main content"> 
      <span class="newsletter-signup-main__title">Stay Up To Date</span> 
      <p>Get monthly blogs, research, news, and more right to your inbox.</p> 
      <script src="//app-sj02.marketo.com/js/forms2/js/forms2.min.js"></script> 
      <form id="mktoForm_1556"></form> 
      <script>
    MktoForms2.loadForm("//app-sj02.marketo.com", "074-UQX-410", 1556, function(form) {
    form.onSuccess(function(values, followUpUrl) {
      form.getFormElem().hide();
      $('#js-newsletter-success').removeClass('hidden');
      $('#js-newsletter-success').addClass('visible');
        return false;
      });
    });
  </script> 
      <p id="js-newsletter-success" class="newsletter-signup-main__success success-message hidden">Thanks for signing up!</p> 
     </div> 
     <div class="social-icons"> 
      <span class="social-icons-title">Keep In Touch</span> 
      <ul class="social-icons-list"> 
       <li class="social-icon"><a href="https://www.facebook.com/duosec/">
         <svg class="icon-facebook-1">
          <use xlink:href="#icon-facebook-1"></use>
         </svg></a></li> 
       <li class="social-icon"><a href="https://twitter.com/duosec">
         <svg class="icon-twitter">
          <use xlink:href="#icon-twitter"></use>
         </svg></a></li> 
       <li class="social-icon"><a href="https://www.instagram.com/duosec/">
         <svg class="icon-instagram">
          <use xlink:href="#icon-instagram"></use>
         </svg></a></li> 
       <li class="social-icon"><a href="https://dribbble.com/duosec">
         <svg class="icon-dribbble">
          <use xlink:href="#icon-dribbble"></use>
         </svg></a></li> 
       <li class="social-icon"><a href="https://www.linkedin.com/company/duo-security">
         <svg class="icon-linkedin">
          <use xlink:href="#icon-linkedin"></use>
         </svg></a></li> 
       <li class="social-icon"><a href="https://plus.google.com/+DuoSecurity">
         <svg class="icon-googleplus">
          <use xlink:href="#icon-googleplus"></use>
         </svg></a></li> 
      </ul> 
     </div> 
    </div> 
    <div class="footer-utility"> 
     <div class="copyright-info">
      © 2017 Duo
     </div> 
     <ul class="other-sites"> 
      <li class="other-sites-li"><a class="other-sites-link js-other-site-en other-sites-active" href="https://duo.com/">English</a></li> 
      <li class="other-sites-li"><a class="other-sites-link js-other-site-fr" href="https://fr.duo.com">Français</a></li> 
      <li class="other-sites-li"><a class="other-sites-link js-other-site-de" href="https://de.duo.com">Deutsch</a></li> 
     </ul> 
    </div> 
    <div class="go-to-top-wrap">
     <a class="go-to-top-btn" href="#"><i class="icon-chevron-thick-up"></i></a>
    </div> 
   </div> 
  </footer> 
  <!-- js scripts --> 
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script> 
  <script src="/site/themes/duo/js/build/production-2017.min.js?v=1506978971"></script> 
  <!-- wistia video js --> 
  <script src="https://fast.wistia.net/assets/external/E-v1.js" async></script> 
  <!-- OLARK only on /support --> 
  <!-- Phone number change on homepage --> 
  <!-- Press Index - show / hide all press releases --> 
  <!-- Fontastic SVG Icon Sprite --> 
  <script src="https://file.myfontastic.com/w67C5rU7rS3nhosptu567M/icons.js"></script> 
  <!-- Google Tag Manager --> 
  <noscript>
   <iframe src="//www.googletagmanager.com/ns.html?id=GTM-MFPB9D" height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript> 
  <!-- End Google Tag Manager --> 
  <!-- Begin Inspectlet Embed Code --> 
  <script type="text/javascript" id="inspectletjs">
window.__insp = window.__insp || [];
__insp.push(['wid', 679911470]);
(function() {
function ldinsp(){if(typeof window.__inspld != "undefined") return; window.__inspld = 1; var insp = document.createElement('script'); insp.type = 'text/javascript'; insp.async = true; insp.id = "inspsync"; insp.src = ('https:' == document.location.protocol ? 'https' : 'http') + '://cdn.inspectlet.com/inspectlet.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(insp, x); };
setTimeout(ldinsp, 500); document.readyState != "complete" ? (window.attachEvent ? window.attachEvent('onload', ldinsp) : window.addEventListener('load', ldinsp, false)) : ldinsp();
})();
</script> 
  <!-- End Inspectlet Embed Code --> 
  <script src="//cdn.optimizely.com/js/160504861.js"></script>   
 </body>
</html>