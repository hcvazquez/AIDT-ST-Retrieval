<html op="item">
 <head>
  <meta name="referrer" content="origin">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="news.css?RzHgT0wcgpSKs5kU34En"> 
  <link rel="shortcut icon" href="favicon.ico"> 
  <title>Writing a Non-Blocking JavaScript Quicksort | Hacker News</title>
 </head>
 <body>
  <center>
   <table id="hnmain" border="0" cellpadding="0" cellspacing="0" width="85%" bgcolor="#f6f6ef"> 
    <tbody>
     <tr>
      <td bgcolor="#ff6600">
       <table border="0" cellpadding="0" cellspacing="0" width="100%" style="padding:2px">
        <tbody>
         <tr>
          <td style="width:18px;padding-right:4px"><a href="https://news.ycombinator.com"><img src="y18.gif" width="18" height="18" style="border:1px white solid;"></a></td> 
          <td style="line-height:12pt; height:10px;"><span class="pagetop"><b class="hnname"><a href="news">Hacker News</a></b> <a href="newest">new</a> | <a href="newcomments">comments</a> | <a href="show">show</a> | <a href="ask">ask</a> | <a href="jobs">jobs</a> | <a href="submit">submit</a> </span></td>
          <td style="text-align:right;padding-right:4px;"><span class="pagetop"> <a href="login?goto=item%3Fid%3D9690074">login</a> </span></td> 
         </tr>
        </tbody>
       </table></td>
     </tr> 
     <tr style="height:10px"></tr>
     <tr>
      <td>
       <table class="fatitem" border="0"> 
        <tbody>
         <tr class="athing" id="9690074"> 
          <td align="right" valign="top" class="title"><span class="rank"></span></td> 
          <td valign="top" class="votelinks">
           <center>
            <a id="up_9690074" href="vote?id=9690074&amp;how=up&amp;goto=item%3Fid%3D9690074">
             <div class="votearrow" title="upvote"></div></a>
           </center></td>
          <td class="title"><a href="http://www.breck-mckye.com/blog/2015/06/writing-a-non-blocking-javascript-quicksort/" class="storylink">Writing a Non-Blocking JavaScript Quicksort</a><span class="sitebit comhead"> (<a href="from?site=breck-mckye.com"><span class="sitestr">breck-mckye.com</span></a>)</span></td>
         </tr>
         <tr>
          <td colspan="2"></td>
          <td class="subtext"> <span class="score" id="score_9690074">66 points</span> by <a href="user?id=josep2" class="hnuser">josep2</a> <span class="age"><a href="item?id=9690074">830 days ago</a></span> <span id="unv_9690074"></span> | <a href="hide?id=9690074&amp;goto=item%3Fid%3D9690074">hide</a> | <a href="https://hn.algolia.com/?query=Writing%20a%20Non-Blocking%20JavaScript%20Quicksort&amp;sort=byDate&amp;dateRange=all&amp;type=story&amp;storyText=false&amp;prefix&amp;page=0" class="hnpast">past</a> | <a href="https://www.google.com/search?q=Writing%20a%20Non-Blocking%20JavaScript%20Quicksort">web</a> | <a href="item?id=9690074">41&nbsp;comments</a> | <a href="fave?id=9690074&amp;auth=2a1e8d0cc4cc9f114331920aa43d0746f5c3ae63">favorite</a> </td>
         </tr> 
        </tbody>
       </table><br><br> 
       <table border="0" class="comment-tree"> 
        <tbody>
         <tr class="athing comtr " id="9690143">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="0"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690143" href="vote?id=9690143&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=tantalor" class="hnuser">tantalor</a> <span class="age"><a href="item?id=9690143">830 days ago</a></span> <span id="unv_9690143"></span><span class="par"></span> <a class="togg" n="16" href="javascript:void(0)" onclick="return toggle(event, 9690143)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">The obvious solution is to use a Web Worker,<p></p><pre><code>  var code = "onmessage = function (evt) {evt.data.sort(); postMessage(evt.data)}";

  function asyncSort(data, cb) {
    var worker = new Worker(URL.createObjectURL(new Blob([code])));
    worker.onmessage = function (evt) { cb(evt.data); };
    worker.postMessage(data);
  }
</code></pre> Example,<p></p><pre><code>  asyncSort([3, 2, 1], function (res) { console.log(res); });
</code></pre> Prints,<p></p><pre><code>  "[1, 2, 3]"</code></pre><span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690193">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="40"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690193" href="vote?id=9690193&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=nemothekid" class="hnuser">nemothekid</a> <span class="age"><a href="item?id=9690193">830 days ago</a></span> <span id="unv_9690193"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 9690193)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">I thought that as well, if you are going to use setImmediate, it would probably make the most sense to just a web worker which is actually standardized and supported in all browsers (and won't turn your quick sort fn into a mess).<p>However it looked like he needed to support IE8, so this might be an ok solution (although I would argue a terrible one for anyone who doesn't need to support IE8/9).<span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690651">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="40"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690651" href="vote?id=9690651&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=amelius" class="hnuser">amelius</a> <span class="age"><a href="item?id=9690651">830 days ago</a></span> <span id="unv_9690651"></span><span class="par"></span> <a class="togg" n="6" href="javascript:void(0)" onclick="return toggle(event, 9690651)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">It is not efficient to use a webworker when transferring the data into it and out of it takes O(N) time.<span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690833">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="80"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690833" href="vote?id=9690833&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=ougawouga" class="hnuser">ougawouga</a> <span class="age"><a href="item?id=9690833">830 days ago</a></span> <span id="unv_9690833"></span><span class="par"></span> <a class="togg" n="4" href="javascript:void(0)" onclick="return toggle(event, 9690833)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">Not with transferable objects.<span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690854">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="120"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690854" href="vote?id=9690854&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=amelius" class="hnuser">amelius</a> <span class="age"><a href="item?id=9690854">830 days ago</a></span> <span id="unv_9690854"></span><span class="par"></span> <a class="togg" n="3" href="javascript:void(0)" onclick="return toggle(event, 9690854)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">From [1]:<p>&gt; when transferring an ArrayBuffer from your main app to Worker, the original ArrayBuffer is cleared and no longer usable</p><p>This is really too restrictive in many situations.</p><p>[1] <a href="https://developers.google.com/web/updates/2011/12/Transferable-Objects-Lightning-Fast" rel="nofollow">https://developers.google.com/web/updates/2011/12/Transferab...</a><span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9692047">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="160"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9692047" href="vote?id=9692047&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=RandomBK" class="hnuser">RandomBK</a> <span class="age"><a href="item?id=9692047">830 days ago</a></span> <span id="unv_9692047"></span><span class="par"></span> <a class="togg" n="2" href="javascript:void(0)" onclick="return toggle(event, 9692047)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">That may be what the API requires, but is it actually implemented as a physical move/copy of memory? It sounds like they can just make the array _appear_ to be cleared, while keeping it in place in memory.<span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9692150">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="200"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9692150" href="vote?id=9692150&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=yoklov" class="hnuser">yoklov</a> <span class="age"><a href="item?id=9692150">830 days ago</a></span> <span id="unv_9692150"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 9692150)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">The way I understand it is that they usually just move the pointer to the ArrayBuffer's underlying data store. No block copy occurs.<span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9692622">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="80"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9692622" href="vote?id=9692622&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=apaprocki" class="hnuser">apaprocki</a> <span class="age"><a href="item?id=9692622">830 days ago</a></span> <span id="unv_9692622"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 9692622)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">The new SharedArrayBuffer should solve that particular problem. Once videos are online, you should check out @naveedi's talk from JSConf 2 weeks ago.<span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690423">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="40"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690423" href="vote?id=9690423&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=lancefisher" class="hnuser">lancefisher</a> <span class="age"><a href="item?id=9690423">830 days ago</a></span> <span id="unv_9690423"></span><span class="par"></span> <a class="togg" n="2" href="javascript:void(0)" onclick="return toggle(event, 9690423)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">This is a good approach for the times you can't use web workers. It's not just old browsers either. You can't draw to the canvas with a web worker.<p>Depending on what you're doing, you may want to yield after x operations rather than on every recursive invocation like the example shown. There is a performance cost to using setImmediate.<span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9692169">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="80"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9692169" href="vote?id=9692169&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=yoklov" class="hnuser">yoklov</a> <span class="age"><a href="item?id=9692169">830 days ago</a></span> <span id="unv_9692169"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 9692169)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">It's massively unfortunate that a tradeoff like this has to be made (speed vs responsiveness).<p>But FWIW, you can do canvas pixel operations with a web worker, which you then blit to the canvas, which is acceptable in some cases.<span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690205">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="40"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690205" href="vote?id=9690205&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=error54" class="hnuser">error54</a> <span class="age"><a href="item?id=9690205">830 days ago</a></span> <span id="unv_9690205"></span><span class="par"></span> <a class="togg" n="6" href="javascript:void(0)" onclick="return toggle(event, 9690205)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">The whole thing issue was that it had to run in IE8.<span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690245">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="80"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690245" href="vote?id=9690245&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=Kiro" class="hnuser">Kiro</a> <span class="age"><a href="item?id=9690245">830 days ago</a></span> <span id="unv_9690245"></span><span class="par"></span> <a class="togg" n="5" href="javascript:void(0)" onclick="return toggle(event, 9690245)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">setImmediate is not supported in IE8 either.<span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690325">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="120"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690325" href="vote?id=9690325&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=exogen" class="hnuser">exogen</a> <span class="age"><a href="item?id=9690325">830 days ago</a></span> <span id="unv_9690325"></span><span class="par"></span> <a class="togg" n="4" href="javascript:void(0)" onclick="return toggle(event, 9690325)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">The polyfill implements setImmediate using postMessage in IE8, though. AFAIK it's not really possible to polyfill WebWorkers.<span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690623">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="160"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690623" href="vote?id=9690623&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=thomasfoster96" class="hnuser">thomasfoster96</a> <span class="age"><a href="item?id=9690623">830 days ago</a></span> <span id="unv_9690623"></span><span class="par"></span> <a class="togg" n="3" href="javascript:void(0)" onclick="return toggle(event, 9690623)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">You can sort of polyfill web workers by providing the same API but running the web worker in the main thread.<p>Edit: I assume I'm being downvoted because you're still running the script in the main thread, and therefore lose the concurrency. Obviously this is an issue with a polyfill, but the point of polyfilling web workers would be to keep the one codebase rather than writing your your web app with and then without web workers.<span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690675">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="200"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690675" href="vote?id=9690675&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=AgentME" class="hnuser">AgentME</a> <span class="age"><a href="item?id=9690675">830 days ago</a></span> <span id="unv_9690675"></span><span class="par"></span> <a class="togg" n="2" href="javascript:void(0)" onclick="return toggle(event, 9690675)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">Which misses the point entirely. The problem the author had was doing sorting of many items in IE8 without a warning. Using a real web worker would be a solution, but using a web worker polyfill that ran in the main thread would put him right back where he started, with IE8 triggering a warning.<span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690860">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="240"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690860" href="vote?id=9690860&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=thomasfoster96" class="hnuser">thomasfoster96</a> <span class="age"><a href="item?id=9690860">830 days ago</a></span> <span id="unv_9690860"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 9690860)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">I wasn't clear enough: I'd be polyfilling web workers not for this specific problem, but for other cases where I could use web workers and not lose IE8 support.<span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9691465">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="0"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9691465" href="vote?id=9691465&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=stestagg" class="hnuser">stestagg</a> <span class="age"><a href="item?id=9691465">830 days ago</a></span> <span id="unv_9691465"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 9691465)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">I've actually got a bunch of sort algorithms written as async javascript:<p><a href="http://stestagg.github.io/sort/" rel="nofollow">http://stestagg.github.io/sort/</a><span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690234">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="0"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690234" href="vote?id=9690234&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=KayEss" class="hnuser">KayEss</a> <span class="age"><a href="item?id=9690234">830 days ago</a></span> <span id="unv_9690234"></span><span class="par"></span> <a class="togg" n="5" href="javascript:void(0)" onclick="return toggle(event, 9690234)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">The 'long tail' really oughtn't be that long if they switched to the native sort when a partition becomes small enough.<span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9693329">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="40"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9693329" href="vote?id=9693329&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=drostie" class="hnuser">drostie</a> <span class="age"><a href="item?id=9693329">830 days ago</a></span> <span id="unv_9693329"></span><span class="par"></span> <a class="togg" n="2" href="javascript:void(0)" onclick="return toggle(event, 9693329)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">That's going to be tricky to do with quicksort... you could definitely do it with mergesort, though, but you'd have to abandon the in-place guarantee.<p>The basic problem is that Array.prototype.sort() does not accept indexes for a slice of the array to sort between.<span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9697210">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="80"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9697210" href="vote?id=9697210&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=KayEss" class="hnuser">KayEss</a> <span class="age"><a href="item?id=9697210">829 days ago</a></span> <span id="unv_9697210"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 9697210)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">It's simple enough if you split the list at the partition point, but hard if you do it in place.<span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690409">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="40"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690409" href="vote?id=9690409&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=girvo" class="hnuser">girvo</a> <span class="age"><a href="item?id=9690409">830 days ago</a></span> <span id="unv_9690409"></span><span class="par"></span> <a class="togg" n="2" href="javascript:void(0)" onclick="return toggle(event, 9690409)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00"><i>&gt; switched to the native sort when a partition becomes small enough</i><p>Isn't that exactly what they are doing?</p><p><i>&gt;&gt; Our approach was simply to prefer the native implementation unless working in IE8 or with arrays over a thousand items.</i><span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690756">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="80"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690756" href="vote?id=9690756&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=gpvos" class="hnuser">gpvos</a> <span class="age"><a href="item?id=9690756">830 days ago</a></span> <span id="unv_9690756"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 9690756)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">I understood that they chose between the two versions at the top level, not at lower levels.<span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690655">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="0"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690655" href="vote?id=9690655&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=mpweiher" class="hnuser">mpweiher</a> <span class="age"><a href="item?id=9690655">830 days ago</a></span> <span id="unv_9690655"></span><span class="par"></span> <a class="togg" n="7" href="javascript:void(0)" onclick="return toggle(event, 9690655)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">Is computation becoming a special case of being blocked (on I/O)?<p>I remember seeing this in an event-driven server framework (computation as the special case), this usage of "non-blocking" suggests it might be a trend.<span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9692084">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="40"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9692084" href="vote?id=9692084&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=jerf" class="hnuser">jerf</a> <span class="age"><a href="item?id=9692084">830 days ago</a></span> <span id="unv_9692084"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 9692084)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">"Is computation becoming a special case of being blocked (on I/O)?"<p>No, it's been one for a long time. We call this situation "cooperative multithreading". (If you object to the "threading" term, bear in mind we called it this long before everything was multi-core.) We have learned to prefer pre-emptive multithreading on the grounds that while cooperative multithreading may occasionally have small advantages, it frequently has massive disadvantages, and the balance isn't even close.</p><p>Unfortunately, the browser has had all kinds of work done on it over the years that deeply assumed cooperative multithreading was the order of the day, and it's very difficult to change that out now. I do not mean that as a sarcastic statement or something, I mean, seriously, changing a codebase or specification base the size of the browser from cooperative to pre-emptive is an incredible and very difficult change. Computation blocks are a huge and ongoing problem if you want really low-latence javascript, and while there's not "nothing" you can do about it, the tools are pretty crude and limited.<span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690861">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="40"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690861" href="vote?id=9690861&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=the8472" class="hnuser">the8472</a> <span class="age"><a href="item?id=9690861">830 days ago</a></span> <span id="unv_9690861"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 9690861)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">Javascript is a special problem child there because a large part of it's raison d'être is DOM manipulation and yet that's the thing that cannot be parallelized, even with web workers because the DOM has not been designed with any kind of parallelism in mind.<p>Other ecosystems also have problems with computations on the UI thread but running most of the application logic on different threads comes far more natural there and standard libraries offer a much richer support for multi-threading/fine-grained task execution (be it mutable or immutable shared state).<span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690765">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="40"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690765" href="vote?id=9690765&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=mattdw" class="hnuser">mattdw</a> <span class="age"><a href="item?id=9690765">830 days ago</a></span> <span id="unv_9690765"></span><span class="par"></span> <a class="togg" n="3" href="javascript:void(0)" onclick="return toggle(event, 9690765)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">In the browser, Javascript (outside of webworkers) is single-threaded, and while running it blocks the browser run-loop (for the given webpage.) This means the page can't accept or respond to any incoming events. It's "blocked" from interaction.<span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690839">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="80"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690839" href="vote?id=9690839&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=mpweiher" class="hnuser">mpweiher</a> <span class="age"><a href="item?id=9690839">830 days ago</a></span> <span id="unv_9690839"></span><span class="par"></span> <a class="togg" n="2" href="javascript:void(0)" onclick="return toggle(event, 9690839)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">Yes, I am aware of that.<p>It used to be "blocked" meant "process is waiting for an external event, usually I/O". Doing computation was typically referred to as "busy". "Non-blocking" meant "without putting the process to sleep".</p><p>There seems to be a shift in the meaning of this particular piece of terminology that I find interesting, because it seems to reflect the reality that "computers" actually do very little "computing". Instead computers mainly communicate, and even the CPUs themselves probably spend most of their time waiting on main memory (60ns) rather than doing actual arithmetic (sub ns in most cases).<span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9692266">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="120"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9692266" href="vote?id=9692266&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=couchand" class="hnuser">couchand</a> <span class="age"><a href="item?id=9692266">830 days ago</a></span> <span id="unv_9692266"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 9692266)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">Just to get a little more specific with this: the shift is in the accepted "main engine of computation" (to make up a mediocre term). We used to have something of an engineer's viewpoint, that the physical location of the electrical operation of the mathematics (i.e., the CPU) was this main engine. It's been a long road, but the new viewpoint is a bit more philosophical: the main engine is the human-computer nexus.<p>Of course, "human" in the above isn't strictly correct, since we know that computers talk to each other all the time, too. Indeed, when that happens the main engine of computation isn't really one or the other of the computers, but the link between them (i.e., the protocol).</p><p>So now "blocking" means requiring the main engine of computation to "sleep" and wait for "external input". For a human UI this means the classic sense of waiting on the wetware end, but it can just as easily mean waiting on the hardware end.</p><p>We strive to build responsive systems, so we wish for them to be "non-blocking" in every case. This means, if the human wants to communicate to the computer, it shouldn't be prevented to because the computer is currently working on a solitary operation. Ultimately it's the same principle we've already accepted from the reverse direction.<span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9691138">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="40"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9691138" href="vote?id=9691138&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=amalcon" class="hnuser">amalcon</a> <span class="age"><a href="item?id=9691138">830 days ago</a></span> <span id="unv_9691138"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 9691138)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c5a">This confused me quite a bit as well. "Wait, what? There's such a thing as a blocking quicksort? Maybe with mutexes or something, but this is JavaScript..."<p>Apparently "non-blocking" is used here to mean roughly the opposite of what it normally means (that your computation doesn't slow down the I/O). Oddly enough, this seems kind of reasonable for interactive programs: the I/O is the more important part, so it's the thing you want to not interfere with.</p><p>It's still a little confusing.<span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690350">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="0"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690350" href="vote?id=9690350&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=gridspy" class="hnuser">gridspy</a> <span class="age"><a href="item?id=9690350">830 days ago</a></span> <span id="unv_9690350"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 9690350)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">You need to add a test at the start of your quicksort function - when the number of elements for this invocation is &lt; 500, invoke native sort on the current subset.<span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690352">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="0"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690352" href="vote?id=9690352&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=chejazi" class="hnuser">chejazi</a> <span class="age"><a href="item?id=9690352">830 days ago</a></span> <span id="unv_9690352"></span><span class="par"></span> <a class="togg" n="7" href="javascript:void(0)" onclick="return toggle(event, 9690352)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">The main takeaway for me was lesson #4:<p>"setTimeout and browser timing are deceptive and shouldnt be wholly trusted"... and as a result, use the setImmediate API.<span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690459">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="40"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690459" href="vote?id=9690459&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=chejazi" class="hnuser">chejazi</a> <span class="age"><a href="item?id=9690459">830 days ago</a></span> <span id="unv_9690459"></span><span class="par"></span> <a class="togg" n="6" href="javascript:void(0)" onclick="return toggle(event, 9690459)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">Eek... "[setImmediate] is not expected to become standard, and is only implemented by recent builds of Internet Explorer and Node.js 0.10+. It meets resistance both from Gecko (Firefox) and Webkit (Google/Apple)."<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/setImmediate" rel="nofollow">https://developer.mozilla.org/en-US/docs/Web/API/Window/setI...</a><span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690589">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="80"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690589" href="vote?id=9690589&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=mikekchar" class="hnuser">mikekchar</a> <span class="age"><a href="item?id=9690589">830 days ago</a></span> <span id="unv_9690589"></span><span class="par"></span> <a class="togg" n="5" href="javascript:void(0)" onclick="return toggle(event, 9690589)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">Wah! I just skimmed through the Gecko bug that is linked from the above link. I recommend reading reading it through if you are interested in using these techniques on multiple browsers.<p>It's a bit of a mess. I think there is some misunderstanding here of what the requirements are. I should be able to queue callbacks and have them execute using 100% of the CPU, but still yield to browser and IO events so that the broswer (or IO processing) is responsive.</p><p>A lot of the talk is about minimum waits. For example setTimeout(0) apparently has a minimum timeout according to the spec. It's not that I want the minumum wait to be any particular value. It's that I want it to be as small as it can be while still yielding to browser and IO events. While I have callbacks queued and executing, I want the CPU to be pegged at 100%. While it is pegged at 100%, the browser should still be responsive if my callbacks yield often.</p><p>So reading the thread it seems that on Gecko setTimeout(0) does not max the CPU (because it is waiting -- I'm going to give this a try next time I get a chance). Also using .then() on a native Promise does not seem to yield to the browser (apparently this is what the spec asks for).<span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9691089">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="120"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9691089" href="vote?id=9691089&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=gpvos" class="hnuser">gpvos</a> <span class="age"><a href="item?id=9691089">830 days ago</a></span> <span id="unv_9691089"></span><span class="par"></span> <a class="togg" n="2" href="javascript:void(0)" onclick="return toggle(event, 9691089)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">One of the comments in the Gecko bug links to a post by Chromium developer James Robinson, which explains a lot of the technical details quite clearly: <a href="https://groups.google.com/a/chromium.org/d/msg/blink-dev/Hn3GxRLXmR0/XP9xcY_gBPQJ" rel="nofollow">https://groups.google.com/a/chromium.org/d/msg/blink-dev/Hn3...</a><span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9693319">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="160"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9693319" href="vote?id=9693319&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=mikekchar" class="hnuser">mikekchar</a> <span class="age"><a href="item?id=9693319">830 days ago</a></span> <span id="unv_9693319"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 9693319)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">Thanks for this. The rest of the thread is also very illuminating. I finally understand what they are opposed to. It makes sense.<span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9691140">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="120"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9691140" href="vote?id=9691140&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=lttlrck" class="hnuser">lttlrck</a> <span class="age"><a href="item?id=9691140">830 days ago</a></span> <span id="unv_9691140"></span><span class="par"></span> <a class="togg" n="2" href="javascript:void(0)" onclick="return toggle(event, 9691140)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">Why do you want the CPU pegged at 100%? What benefit does that provide?<p>Edit: ok I read some background, assume you mean it should be unclamped?<span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9691358">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="160"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9691358" href="vote?id=9691358&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=mikekchar" class="hnuser">mikekchar</a> <span class="age"><a href="item?id=9691358">830 days ago</a></span> <span id="unv_9691358"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 9691358)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">To be honest, I don't really understand what "unclamped" means in this context.<p>My background is in embedded telephony. I've worked on many systems that are single threaded because you have real time constraints. You have to make sure that your bit of work finishes in a certain amount of time and then you yield to the next bit of work. You could imagine that it would be very strange if a telephone switch handled connecting one call, but before it could connect another call it would have to "rest" for 15 ms.</p><p>The Javascript event loop is really just the reactor pattern: <a href="http://en.wikipedia.org/wiki/Reactor_pattern" rel="nofollow">http://en.wikipedia.org/wiki/Reactor_pattern</a></p><p>There are many, many useful ways to use the reactor pattern. In fact, I have often used it in preference of threads in GUI applications because it gives you very fine grained control over how much responsiveness you want in the UI. As long as you yield every X ms, it means that the user only has to wait X ms for a response to their actions. You can also prioritise work easily. With threads, you are at the mercy of the task scheduler and so you might have very uneven response times.</p><p>In the same way, I want to be able to program things that run continuously in JS but not have to give up the responsiveness in the browser (or other IO events). Like the original author, imagine that you are sorting thousands of records and it will take 3 seconds. You don't want to hang the browser for 3 seconds because maybe they want to click the "cancel" button. So you yield every 50 ms. But if you have something like a 15 ms wait time every time you yield, your 3 second task is going to take 4 seconds... for no reason at all.</p><p>So what I want is to be able to yield, have the system check for events and if there aren't any, resume <i>as quickly as possible</i>. Obviously there will be some overhead. But sticking a timer on it and saying, "I'm just going to take a brief nap" really sucks.</p><p>The problem I'm noticing is that some people think that there should be no delay at all. As soon as schedule a callback, it should run. This is not desirable at all. Again, the whole point is to yield to events and then come back. I just don't want to wait <i>longer</i> that it is necessary to do that.</p><p>To sum up, it's not that I <i>want</i> to use 100% CPU all the time, but if it is impossible to do, then it is broken. Similarly, if I am using 100% of the CPU and yielding every X ms, then then events should be handled every X ms (modulus the amount of time the event handler takes).<span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9691807">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="0"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9691807" href="vote?id=9691807&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=drostie" class="hnuser">drostie</a> <span class="age"><a href="item?id=9691807">830 days ago</a></span> <span id="unv_9691807"></span><span class="par"></span> <a class="togg" n="2" href="javascript:void(0)" onclick="return toggle(event, 9691807)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c5a">&gt; Theres just one problem  now weve made the function asynchronous, how do we know when it has finished?<p>The most obvious thing is just to call out to a (semi-) global:</p><p></p><pre><code>    function quicksort(arr, cb) {
        var thread_balance = 1;
        function thread(start, end) {
            if (not trivially solved) {
                partition_stuff;
                thread_balance += 1;
                setImmediate(...);
                setImmediate(...);
            } else {
                thread_balance -= 1; // this thread is done.
                if (thread_balance === 0) {
                    cb(arr);
                }
            }
        }
        thread(0, arr.length);
    }
</code></pre> This is why concurrent datatypes are often interested in simple registers that you can only increment/decrement, they are still super-helpful for coordinating when a workload is complete.<p>Taking this a little further, we can wrap setInterval in a Promises library which gives you back a promise for the sorted halves of the array; the thread(start, end) promise resolves with the [start..end-1] indices being sorted, and in the nontrivial case returns Promise.all([thread(start, pivot - 1), thread(pivot, end)]) (the promise-library's merge of the two promises to complete the work). Same idea really.<span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9692723">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="40"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9692723" href="vote?id=9692723&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=mattLummus" class="hnuser">mattLummus</a> <span class="age"><a href="item?id=9692723">830 days ago</a></span> <span id="unv_9692723"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 9692723)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">I was also curious about the lack of promises<span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690576">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="0"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690576" href="vote?id=9690576&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=scotty79" class="hnuser">scotty79</a> <span class="age"><a href="item?id=9690576">830 days ago</a></span> <span id="unv_9690576"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 9690576)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">Wouldn't it be faster to run built-in sort on each 1/8 of array, than each 1/4, 1/2 and the whole array in the end?<p>Does Array.sort run much faster when the array already has some order?</p><p>EDIT: It doesn't. Sorting even totally sorted array takes as much as sorting shuffled array.<span> </span></p>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
         <tr class="athing comtr " id="9690677">
          <td> 
           <table border="0"> 
            <tbody>
             <tr> 
              <td class="ind"><img src="s.gif" height="1" width="0"></td>
              <td valign="top" class="votelinks">
               <center>
                <a id="up_9690677" href="vote?id=9690677&amp;how=up&amp;goto=item%3Fid%3D9690074">
                 <div class="votearrow" title="upvote"></div></a>
               </center></td>
              <td class="default">
               <div style="margin-top:2px; margin-bottom:-10px;">
                <span class="comhead"> <a href="user?id=amelius" class="hnuser">amelius</a> <span class="age"><a href="item?id=9690677">830 days ago</a></span> <span id="unv_9690677"></span><span class="par"></span> <a class="togg" n="1" href="javascript:void(0)" onclick="return toggle(event, 9690677)"></a> <span class="storyon"></span> </span>
               </div><br>
               <div class="comment"> 
                <span class="c00">Instead, one could use an altjs compiler to generate nonblocking code. For example, ghcjs does this.<span> </span>
                 <div class="reply"> 
                  <p><font size="1"> </font> </p>
                 </div></span>
               </div></td>
             </tr> 
            </tbody>
           </table></td>
         </tr> 
        </tbody>
       </table> <br><br> </td>
     </tr> 
     <tr>
      <td><img src="s.gif" height="10" width="0">
       <table width="100%" cellspacing="0" cellpadding="1">
        <tbody>
         <tr>
          <td bgcolor="#ff6600"></td>
         </tr>
        </tbody>
       </table><br>
       <center>
        <a href="https://www.ycombinator.com/apply/"> Applications are open for YC Winter 2018 </a>
       </center><br>
       <center>
        <span class="yclinks"><a href="newsguidelines.html">Guidelines</a> | <a href="newsfaq.html">FAQ</a> | <a href="mailto:hn@ycombinator.com">Support</a> | <a href="https://github.com/HackerNews/API">API</a> | <a href="security.html">Security</a> | <a href="lists">Lists</a> | <a href="bookmarklet.html" rel="nofollow">Bookmarklet</a> | <a href="dmca.html">DMCA</a> | <a href="http://www.ycombinator.com/apply/">Apply to YC</a> | <a href="mailto:hn@ycombinator.com">Contact</a></span>
        <br>
        <br>
        <form method="get" action="//hn.algolia.com/">
         Search: 
         <input type="text" name="q" value="" size="17" autocorrect="off" spellcheck="false" autocapitalize="off" autocomplete="false">
        </form> 
       </center></td>
     </tr> 
    </tbody>
   </table>
  </center>
  <script type="text/javascript" src="hn.js?RzHgT0wcgpSKs5kU34En"></script>  
 </body>
</html>