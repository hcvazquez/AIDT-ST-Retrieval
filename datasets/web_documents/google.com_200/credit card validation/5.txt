<!doctype html>
<html>
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>In-app checkout using Stripe.js pop-up form for tokenization with Chargebee Subscriptions</title> 
  <meta class="swiftype" name="type" data-type="enum" content="tutorial"> 
  <meta class="swiftype" name="title" data-type="string" content="In-app checkout using Stripe.js pop-up form for tokenization with Chargebee Subscriptions"> 
  <meta class="swiftype" name="url" data-type="enum" content="https://www.chargebee.com/tutorials/stripe-js-card-token-example.html"> 
  <meta name="description" content="Integrating Stripe.js with card token for in-app checkout experience - Chargebee"> 
  <meta property="og:title" content="In-app checkout using Stripe.js pop-up form for tokenization with Chargebee Subscriptions"> 
  <meta property="og:description" content="Integrating Stripe.js with card token for in-app checkout experience - Chargebee"> 
  <meta property="og:url" content="https://www.chargebee.com/tutorials/stripe-js-card-token-example.html"> 
  <meta property="og:image" content="https://www.chargebee.com/static/resources/og-image.gif"> 
  <meta property="og:type" content="website"> 
  <meta property="og:site_name" content="Chargebee"> 
  <link rel="shortcut icon" href="assets/v1.1/images/favicon.ico"> 
  <link rel="apple-touch-icon-precomposed" href="assets/v1.1/images/apple-touch-icon.png"> 
  <link rel="canonical" href="https://www.chargebee.com/tutorials/stripe-js-card-token-example.html"> 
  <script>
            var start = (new Date()).getTime();
            var overall = start, timeData = "", prop ="";

            function startTime(){
                    start = (new Date()).getTime();
            }

            function storeTime(prop){
                    var end = (new Date()).getTime();
                    var loadTime = end - start;
                    timeData = timeData + prop + "=" + loadTime + "&";
            }

            function sendData(){
                    var end = (new Date()).getTime();
                    var loadTime = end - overall;
                    timeData = timeData + "overall=" + loadTime + "";
                    $.get("/licenses/cssheader.txt", timeData);
            }
        </script> 
  <!-- Adding the script at the head as otherwise the ui is not nice --> 
  <script>startTime();</script> 
  <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script> 
  <script>storeTime("prettifyjs");</script> 
  <link href="assets/v1.1/styles/bootstrap.min.css" rel="stylesheet"> 
  <link href="assets/fa-4.3.0/css/font-awesome.min.css" rel="stylesheet"> 
  <link rel="stylesheet" type="text/css" href="https://google-code-prettify.googlecode.com/svn/loader/prettify.css"> 
  <link href="assets/v1.1/styles/cb-tutorials.css" rel="stylesheet"> 
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries --> 
  <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]--> 
  <script>startTime();</script> 
  <script src="//use.typekit.net/fdp3egv.js"></script> 
  <script>try{Typekit.load();}catch(e){}</script> 
  <script>storeTime("typekit");</script> 
 </head> 
 <body onload="sendData();"> 
  <header id="cb-header" class="navbar navbar-static-top"> 
   <div class="container"> 
    <div id="cb-select-nav" class="cb-select visible-xs"> 
     <select class="form-control text-uppercase"> <option value="/tutorials/">API Tutorials</option> <option value="https://www.chargebee.com/docs/">Help Docs</option> <option value="https://apidocs.chargebee.com/">API Docs</option> <option value="http://support.chargebee.com/">Support</option> </select> 
    </div> 
    <div class="navbar-header"> 
     <a href="https://www.chargebee.com" class="navbar-brand"> <img src="assets/v1.1/images/logo.svg" width="100" class="hidden-xs"> <img src="assets/v1.1/images/icon.png" width="32" height="32" class="visible-xs-inline-block"> | Resources </a> 
    </div> 
    <nav class="hidden-xs"> 
     <ul class="nav navbar-nav navbar-right"> 
      <li> <a href="https://www.chargebee.com/docs/" target="_blank">Help Docs</a> </li> 
      <li> <a href="https://apidocs.chargebee.com/" target="_blank">API Docs</a> </li> 
      <li> <a class="act" href="/tutorials/">API Tutorials</a> </li> 
      <li> <a href="http://support.chargebee.com/" target="_blank">Support</a> </li> 
      <li> <a href="https://www.chargebee.com/trial-signup.html" target="_blank" class="btn-flat">Sign up</a> </li> 
     </ul> 
    </nav> 
   </div> 
  </header> 
  <section class="container"> 
   <div class="row text-center"> 
    <div class="col-md-8 col-md-offset-2"> 
     <div class="cb-page-title"> 
      <div class="cb-back-to"> 
       <a href="index.html"><span class="fa fa-arrow-left"></span> More tutorials</a> 
      </div> 
      <h1>Build an in-app checkout form by embedding Stripe.js</h1> 
     </div> 
    </div> 
   </div> 
   <div id="cb-container" data-cb-docfile="stripe-js-card-token-example.html"> 
    <div class="row"> 
     <div class="col-md-4 col-lg-3"> 
      <div id="cb-aside-helper"></div> 
      <div id="cb-aside-affix"> 
       <div id="cb-aside" class="cb-aside-nav"> 
        <ul> 
         <li> <a href="stripe-js-card-token-example.html#overview" data-cb-sublist-hash="overview">Overview</a> </li> 
         <li> <a href="stripe-js-card-token-example.html#honey-comics-demo-application" data-cb-sublist-hash="honey-comics-demo-application">Honey Comics - Demo Application</a> </li> 
         <li> <a href="stripe-js-card-token-example.html#prerequisites" data-cb-sublist-hash="prerequisites">Prerequisites</a> </li> 
         <li> <a href="stripe-js-card-token-example.html#build-the-checkout-form" data-cb-sublist-hash="build-the-checkout-form">Build the checkout form</a> </li> 
         <li> <a href="stripe-js-card-token-example.html#wire-up-stripe-js" data-cb-sublist-hash="wire-up-stripe-js">Wire up Stripe.js</a> </li> 
         <li> <a href="stripe-js-card-token-example.html#send-the-card-details-to-stripe" data-cb-sublist-hash="send-the-card-details-to-stripe">Send the card details to Stripe</a> </li> 
         <li> <a href="stripe-js-card-token-example.html#handle-stripe-s-response" data-cb-sublist-hash="handle-stripe-s-response">Handle Stripe's response</a> </li> 
         <li> <a href="stripe-js-card-token-example.html#setup-the-client-library" data-cb-sublist-hash="setup-the-client-library">Setup the client library</a> </li> 
         <li> <a href="stripe-js-card-token-example.html#create-the-subscription" data-cb-sublist-hash="create-the-subscription">Create the subscription</a> </li> 
         <li> <a href="stripe-js-card-token-example.html#test-cards" data-cb-sublist-hash="test-cards">Test cards</a> </li> 
        </ul> 
       </div> 
      </div> 
     </div> 
     <div class="col-md-7 col-lg-6 col-lg-offset-1"> 
      <div id="cb-content"> 
       <div class="cb-video-block" data-swiftype-index="false"> 
        <div class="embed-responsive embed-responsive-16by9"> 
         <iframe class="embed-responsive-item wistia_embed" src="//fast.wistia.net/embed/iframe/6yxx6ic6l2" allowtransparency="true" frameborder="0" scrolling="no" name="wistia_embed" allowfullscreen mozallowfullscreen webkitallowfullscreen oallowfullscreen msallowfullscreen></iframe> 
         <div class="cb-video-block-bg" style="background-color:#83A8C8"> 
          <div class="text-center"> 
           <div class="btn cb-btn-overlay">
            <span class="fa fa-play-circle"></span> Watch Video
           </div> 
          </div> 
         </div> 
        </div> 
       </div> 
       <span data-swiftype-name="body" data-swiftype-type="text"> <p>A tutorial on deploying an in-app checkout page using Stripe.js to create subscriptions in Chargebee and store and process payments on Stripe. Stripe.js makes it easy to use any form page as a checkout page and also reduces your PCI DSS scope. It does this by taking care of all the sensitive card information for you.</p> 
        <div class="cb-help cb-help-info-alt" mid="alternative"> 
         <div class="cb-help-title"> 
          <span class="fa fa-random"></span> Alternative options 
         </div> 
         <div class="cb-help-body" mdc="container"> 
          <p><strong>Hosted Pages</strong></p> 
          <p>The simplest way to setup your checkout process with Chargebee is by using the <span mid="link_doc"><a href="https://www.chargebee.com/docs/integration-options.html#only-hosted-pages" target="_blank">hosted payment pages</a>&nbsp;<span class="fa fa-external-link text-muted"></span></span> or the <span mid="link_doc"><a href="https://www.chargebee.com/docs/integration-options.html#hosted-pages-with-api-integration" target="_blank">Hosted Pages + API</a>&nbsp;<span class="fa fa-external-link text-muted"></span></span> integration method. Chargebee's hosted pages are built using the Bootstrap themes.</p> 
          <p><strong>Stripe's Embedded checkout form</strong> <br>The other option is to use the embedded checkout form provided by stripe. See <a mid="link_local" href="stripe-embedded-checkout-form-example.html">this tutorial</a> for explanation on how to use it.</p> 
         </div> 
        </div> <h2 id="overview" data-heading="h2">Overview<a class="fa fa-link" data-cb-sublist-hash="overview" href="stripe-js-card-token-example.html#overview" title="Permalink">&nbsp;</a></h2> <h3>What is Stripe JS?</h3> <p>Well, Stripe.js is a JavaScript library which you can wire into your checkout form to handle the credit card information. When a user signs up using the checkout form, it sends the credit card information directly from the user's browser to Stripe's servers. Meaning, credit card information never hits your server and thus reducing your PCI compliance scope. <br>For further details, have a look at <span mid="link_static"><a href="https://stripe.com/docs/stripe.js" target="_blank"> Stripe's documentation</a>&nbsp;<span class="fa fa-external-link text-muted"></span></span>.</p> <h3>How exactly does this work?</h3> <p>Here's a detailed set of steps on how the entire checkout flow works:</p> 
        <ol> 
         <li>Using your signup form user enters their card and personal details.</li> 
         <li>On form submit, Stripe.js passes just the card information to the Stripe server.</li> 
         <li>Stripe verifies the card, stores it if successful and returns a temporary token.</li> 
         <li>The temporary token and the form details are submitted to your server.</li> 
         <li>And using the <span mid="link_api"><a href="https://apidocs.chargebee.com/docs/api/subscriptions?#create_a_subscription" target="_blank"> create subscription API call</a>&nbsp;<span class="fa fa-external-link text-muted"></span></span>, the subscription information along with the temporary token is passed to Chargebee.</li> 
        </ol> <p>And, Voila, a subscription is created! Your users never left your website and neither did your servers handle any sensitive information.</p> <h3>Is this secure?</h3> <p>With Stripe.js, your server does not handle any sensitive credit card data, which reduces the PCI compliance burden. But we strongly recommend you to use Chargebee's <span mid="link_doc"><a href="https://www.chargebee.com/docs/hp_overview.html" target="_blank"> hosted payment pages</a>&nbsp;<span class="fa fa-external-link text-muted"></span></span>.</p> <h2 id="honey-comics-demo-application" data-heading="h2">Honey Comics - Demo Application<a class="fa fa-link" data-cb-sublist-hash="honey-comics-demo-application" href="stripe-js-card-token-example.html#honey-comics-demo-application" title="Permalink">&nbsp;</a></h2> <p>'Honey Comics', our demo application, is a fictitious <strong>online</strong> comic book store providing a subscription service for comics. We send comic books every week to subscribers. Users can sign up for a subscription from the website by providing the account,payment and shipping address information.</p> <h2 id="prerequisites" data-heading="h2">Prerequisites<a class="fa fa-link" data-cb-sublist-hash="prerequisites" href="stripe-js-card-token-example.html#prerequisites" title="Permalink">&nbsp;</a></h2> <p>Before trying out this tutorial, you would need to setup the following:</p> 
        <ul> 
         <li><span mid="doc_cb_account"> A Chargebee account. <a target="_blank" href="https://www.chargebee.com/trial-signup.html">Signup</a> for a free trial if you don't have one. </span></li> 
         <li>A plan in Chargebee for your customers to subscribe to.You can setup the plan for the demo using the "Setup Configuration" option in the index page if you have downloaded code and started the tutorials locally.</li> 
         <li>A <span mid="link_static"><a href="https://manage.stripe.com/register" target="_blank"> Stripe account</a>&nbsp;<span class="fa fa-external-link text-muted"></span></span> (test mode for now, live mode when you go into production).</li> 
         <li>Your Stripe account integrated into your Chargebee account. <span mid="link_support_article"><a href="http://support.chargebee.com/support/solutions/articles/120958-testing-with-stripe-sandbox" target="_blank"> Here is how you do it</a>&nbsp;<span class="fa fa-external-link text-muted"></span></span>.</li> 
         <li>Your Stripe <span mid="link_static"><a href="https://stripe.com/docs/tutorials/dashboard#api-keys" target="_blank"><strong>test publishable key</strong></a>&nbsp;<span class="fa fa-external-link text-muted"></span></span> (don't forget to replace it with the <strong>live publishable key</strong> when in production).</li> 
         <li><span mid="doc_api_key"> Your <a href="https://www.chargebee.com/docs/api_keys.html" target="_blank">Chargebee API key</a> for your test site. </span></li> 
        </ul> 
        <hr> <h2 id="build-the-checkout-form" data-heading="h2">Build the checkout form<a class="fa fa-link" data-cb-sublist-hash="build-the-checkout-form" href="stripe-js-card-token-example.html#build-the-checkout-form" title="Permalink">&nbsp;</a></h2> <p>We will start with the <strong>client side</strong> implementation. Let's start by building a form, for our users to sign up with. Now, only the card related information is passed to Stripe while remaining information such as account and shipping are passed to our server and then onto Chargebee. <br>Our demo app's checkout page is an example of a simple form collecting basic account information (such as name, email, phone) and card information such as card number, expiry date, cvv. We also collect the shipping address.</p> <p>Below form snippet shows the <strong>card number</strong> field alone.</p> 
        <div class="cb-preview" mid="snip" =""="" data-swiftype-index="false"> 
         <div class="cb-preview-title"> 
          <ul style="display:none"> 
           <li class="active"><span data-tab="php">php</span></li> 
           <li><span data-tab="rb">Ruby</span></li> 
           <li><span data-tab="java">Java</span></li> 
          </ul> 
          <span class="fa fa-file-code-o"></span>&nbsp; 
          <span class="cb-preview-file" mdc="replace_with" mdtext="checkout.html">checkout.html</span> &nbsp;-&nbsp; 
          <a href="https://github.com/chargebee/chargebee-samples/tree/master/php/stripe_js/checkout.html" target="_blank"><span class="fa fa-github"></span>&nbsp;View full code</a> 
         </div> 
         <div class="cb-preview-body"> 
          <pre class="prettyprint lang-html" mdc="container">
&lt;div class="form-group"&gt;
    &lt;label for="card_no"&gt;Credit Card Number&lt;/label&gt;
    &lt;div class="row"&gt;
        &lt;div class="col-sm-6"&gt;
            &lt;input type="text" class="card-number form-control" id="card_no" 
                   required data-msg-required="cannot be blank"&gt; 
        &lt;/div&gt;
        &lt;div class="col-sm-6"&gt;                          
            &lt;span class="cb-cards hidden-xs"&gt;                                        
                &lt;span class="visa"&gt;&lt;/span&gt;                                        
                &lt;span class="mastercard"&gt;&lt;/span&gt;
                &lt;span class="american_express"&gt;&lt;/span&gt;
                &lt;span class="discover"&gt;&lt;/span&gt;
            &lt;/span&gt; 
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;small for="card_no" class="text-danger"&gt;&lt;/small&gt;
&lt;/div&gt;

</pre> 
         </div> 
        </div> 
        <div class="cb-help cb-help-warning" mid="warning"> 
         <div class="cb-help-title"> 
          <span class="fa fa-warning"></span> Warning 
         </div> 
         <div class="cb-help-body" mdc="container"> 
          <p>We should not include a <strong>'name'</strong> attribute to the card data fields in the form. This will ensure that the sensitive card data is not passed to our server when submitted.</p> 
         </div> 
        </div> <p>The below form snippet shows an account field. In this case the <strong>name</strong> attribute is set as it needs to be passed on to our demo app server.</p> 
        <div class="cb-preview" mid="snip" =""="" data-swiftype-index="false"> 
         <div class="cb-preview-title"> 
          <ul style="display:none"> 
           <li class="active"><span data-tab="php">php</span></li> 
           <li><span data-tab="rb">Ruby</span></li> 
           <li><span data-tab="java">Java</span></li> 
          </ul> 
          <span class="fa fa-file-code-o"></span>&nbsp; 
          <span class="cb-preview-file" mdc="replace_with" mdtext="checkout.html">checkout.html</span> &nbsp;-&nbsp; 
          <a href="https://github.com/chargebee/chargebee-samples/tree/master/php/stripe_js/checkout.html" target="_blank"><span class="fa fa-github"></span>&nbsp;View full code</a> 
         </div> 
         <div class="cb-preview-body"> 
          <pre class="prettyprint lang-html" mdc="container">

&lt;div class="col-sm-6"&gt;
    &lt;div class="form-group"&gt;
        &lt;label for="customer[email]"&gt;Email&lt;/label&gt;
        &lt;input id="email" type="text" class="form-control" name="customer[email]" maxlength=50
                   data-rule-required="true" data-rule-email="true" 
                   data-msg-required="Please enter your email address" 
                   data-msg-email="Please enter a valid email address"&gt;
        &lt;small for="customer[email]" class="text-danger"&gt;&lt;/small&gt;
    &lt;/div&gt;
&lt;/div&gt; 

</pre> 
         </div> 
        </div> <h2 id="wire-up-stripe-js" data-heading="h2">Wire up Stripe.js<a class="fa fa-link" data-cb-sublist-hash="wire-up-stripe-js" href="stripe-js-card-token-example.html#wire-up-stripe-js" title="Permalink">&nbsp;</a></h2> <p>Now that the form is built, let's wire up Stripe.js into our form. For Stripe.js to come into action, we add it to checkout page's header tag using script tag.</p> 
        <div class="cb-preview" mid="snip" =""="" data-swiftype-index="false"> 
         <div class="cb-preview-title"> 
          <ul style="display:none"> 
           <li class="active"><span data-tab="php">php</span></li> 
           <li><span data-tab="rb">Ruby</span></li> 
           <li><span data-tab="java">Java</span></li> 
          </ul> 
          <span class="fa fa-file-code-o"></span>&nbsp; 
          <span class="cb-preview-file" mdc="replace_with" mdtext="checkout.html">checkout.html</span> &nbsp;-&nbsp; 
          <a href="https://github.com/chargebee/chargebee-samples/tree/master/php/stripe_js/checkout.html" target="_blank"><span class="fa fa-github"></span>&nbsp;View full code</a> 
         </div> 
         <div class="cb-preview-body"> 
          <pre class="prettyprint lang-html" mdc="container">
&lt;script type="text/javascript" src="https://js.stripe.com/v2/"&gt;
&lt;/script&gt;

</pre> 
         </div> 
        </div> <h3>Set the Stripe Publishable Key</h3> <p>After the JavaScript library has been embedded, we set the <span mid="link_static"><a href="https://stripe.com/docs/tutorials/dashboard#api-keys" target="_blank">Stripe publishable key</a>&nbsp;<span class="fa fa-external-link text-muted"></span></span>. This is for Stripe to identify our account.</p> 
        <div class="cb-preview" mid="snip" =""="" data-swiftype-index="false"> 
         <div class="cb-preview-title"> 
          <ul style="display:none"> 
           <li class="active"><span data-tab="php">php</span></li> 
           <li><span data-tab="rb">Ruby</span></li> 
           <li><span data-tab="java">Java</span></li> 
          </ul> 
          <span class="fa fa-file-code-o"></span>&nbsp; 
          <span class="cb-preview-file" mdc="replace_with" mdtext="checkout.html">checkout.html</span> &nbsp;-&nbsp; 
          <a href="https://github.com/chargebee/chargebee-samples/tree/master/php/stripe_js/checkout.html" target="_blank"><span class="fa fa-github"></span>&nbsp;View full code</a> 
         </div> 
         <div class="cb-preview-body"> 
          <pre class="prettyprint lang-html" mdc="container">
&lt;!-- Setting the stripe publishable key.--&gt;
&lt;script&gt;Stripe.setPublishableKey("pk_test_acfVSJh9Oo9QIGTAQpUvG5Ig");
&lt;/script&gt;

</pre> 
         </div> 
        </div> 
        <div class="cb-help" mid="note"> 
         <div class="cb-help-title"> 
          <span class="fa fa-pencil"></span> Note 
         </div> 
         <div class="cb-help-body" mdc="container"> 
          <p>Replace the sample key given above with your test publishable key. Also, don't forget to <strong>replace</strong> the <strong>test keys</strong> with <strong>live keys</strong> when going into production.</p> 
         </div> 
        </div> <h2 id="send-the-card-details-to-stripe" data-heading="h2">Send the card details to Stripe<a class="fa fa-link" data-cb-sublist-hash="send-the-card-details-to-stripe" href="stripe-js-card-token-example.html#send-the-card-details-to-stripe" title="Permalink">&nbsp;</a></h2> <p>So now that Stripe.js is all set in our web page, now let's write up some javascript for our form. The javascript should trigger up once a user submits the form and pass the card details to Stripe and also handle the response from Stripe. <br>In our code, we used a Stripe's <em>Stripe.createToken(params, stripeResponseHandler)</em> to pass the card details to Stripe. The parameter <em>params</em> should be a JSON object containing the card information and <em>stripeResponseHandler</em> is a callback function to be executed once the call is complete. The Stripe call is asynchronous and stripe will call the <em>callback</em> function with a json object once it has stored the card details in its server(s)</p> 
        <div class="cb-preview" mid="snip" =""="" data-swiftype-index="false"> 
         <div class="cb-preview-title"> 
          <ul style="display:none"> 
           <li class="active"><span data-tab="php">php</span></li> 
           <li><span data-tab="rb">Ruby</span></li> 
           <li><span data-tab="java">Java</span></li> 
          </ul> 
          <span class="fa fa-file-code-o"></span>&nbsp; 
          <span class="cb-preview-file" mdc="replace_with" mdtext="checkout.html">checkout.html</span> &nbsp;-&nbsp; 
          <a href="https://github.com/chargebee/chargebee-samples/tree/master/php/stripe_js/checkout.html" target="_blank"><span class="fa fa-github"></span>&nbsp;View full code</a> 
         </div> 
         <div class="cb-preview-body"> 
          <pre class="prettyprint lang-js" mdc="container">
$("#subscribe-form").on('submit', function(e) {
    // form validation
    formValidationCheck(this);
    if(!$(this).valid()){
        return false;
    }
    // Disable the submit button to prevent repeated clicks and form submit
    $('.submit-button').attr("disabled", "disabled");
    // createToken returns immediately - the supplied callback 
    // submits the form if there are no errors
    Stripe.createToken({
        number: $('.card-number').val(),
        cvc: $('.card-cvc').val(),
        exp_month: $('.card-expiry-month').val(),
        exp_year: $('.card-expiry-year').val()
    }, stripeResponseHandler);
    return false; // submit from callback
});

</pre> 
         </div> 
        </div> <h2 id="handle-stripe-s-response" data-heading="h2">Handle Stripe's response<a class="fa fa-link" data-cb-sublist-hash="handle-stripe-s-response" href="stripe-js-card-token-example.html#handle-stripe-s-response" title="Permalink">&nbsp;</a></h2> <p>The json object passed to the callback function will contain a temporary token and additional information. Incase the card validation fails then the json object will contain the error information.The sample responses are given below</p> 
        <ul> 
         <li><span mid="popup_link"><a data-popup="popup" data-content="popup_id_0" mdc="container" href="javascript:void()">Success response</a>&nbsp;<span class="fa fa-external-link-square text-muted"></span></span>.</li> 
         <li><span mid="popup_link"><a data-popup="popup" data-content="popup_id_1" mdc="container" href="javascript:void()">Error response</a>&nbsp;<span class="fa fa-external-link-square text-muted"></span></span>.</li> 
        </ul> <p>In our demo app's callback function (viz,<em>stripeResponseHandler</em>) we do the following:</p> 
        <ul> 
         <li>We identify whether the response from Stripe is an success json or error json.</li> 
         <li>If it's an error, we re-enable the submit button and call the <span mid="popup_link"><a data-popup="popup" data-content="popup_id_2" mdc="container" href="javascript:void()">error handler function</a>&nbsp;<span class="fa fa-external-link-square text-muted"></span></span>.</li> 
         <li>If it is success, we extract the response, append it to the form and submit it to our demo app server.</li> 
        </ul> 
        <div class="cb-preview" mid="snip" =""="" data-swiftype-index="false"> 
         <div class="cb-preview-title"> 
          <ul style="display:none"> 
           <li class="active"><span data-tab="php">php</span></li> 
           <li><span data-tab="rb">Ruby</span></li> 
           <li><span data-tab="java">Java</span></li> 
          </ul> 
          <span class="fa fa-file-code-o"></span>&nbsp; 
          <span class="cb-preview-file" mdc="replace_with" mdtext="checkout.html">checkout.html</span> &nbsp;-&nbsp; 
          <a href="https://github.com/chargebee/chargebee-samples/tree/master/php/stripe_js/checkout.html" target="_blank"><span class="fa fa-github"></span>&nbsp;View full code</a> 
         </div> 
         <div class="cb-preview-body"> 
          <pre class="prettyprint lang-js" mdc="container">
// Call back function for stripe response.
function stripeResponseHandler(status, response) {
    if (response.error) {
        // Re-enable the submit button
        $('.submit-button').removeAttr("disabled");
        // Show the errors on the form
        stripeErrorDisplayHandler(response);
        $('.subscribe_process').hide();
    } else {
        var form = $("#subscribe-form");
        // Getting token from the response json.
        var token = response['id'];
        // insert the token into the form so it gets submitted to the server
        if ($("input[name='stripeToken']").length == 1) {
            $("input[name='stripeToken']").val(token);
        } else {
            form.append("&lt;input type='hidden' name='stripeToken' value='" + token + "' /&gt;");
        }
        var options = {
            // post-submit callback when error returns
            error: subscribeErrorHandler, 
            // post-submit callback when success returns
            success: subscribeResponseHandler, 
            complete: function() {
                $('.subscribe_process').hide()
            },
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            dataType: 'json'
        };
        // Doing AJAX form submit to your server.
        form.ajaxSubmit(options);
        return false;
    }
}

</pre> 
         </div> 
        </div> 
        <hr> <p><strong>Now lets switch to the server side implementation</strong></p> <h2 id="setup-the-client-library" data-heading="h2">Setup the client library<a class="fa fa-link" data-cb-sublist-hash="setup-the-client-library" href="stripe-js-card-token-example.html#setup-the-client-library" title="Permalink">&nbsp;</a></h2> <p>We first have to <span mid="link_api"><a href="https://apidocs.chargebee.com/docs/api/" target="_blank"> download and import</a>&nbsp;<span class="fa fa-external-link text-muted"></span></span> the client library of our choice. Then we need to configure the client library with our <strong>test site</strong> and our <strong>test api key</strong>.</p> 
        <div mid="lang" style="display:none" data-content-type="java" mdc="container"> 
         <p>For the tutorials we have configured the site and the credentials in a properties file from which the client library is configured at the webapp is initialized.</p> 
         <div class="cb-preview" mid="snip" style="display:none" data-content-type="java" =""="" data-swiftype-index="false"> 
          <div class="cb-preview-title"> 
           <ul style=" "> 
            <li class="active"><span data-tab="php">php</span></li> 
            <li><span data-tab="rb">Ruby</span></li> 
            <li><span data-tab="java">Java</span></li> 
           </ul> 
           <span class="fa fa-file-code-o"></span>&nbsp; 
           <span class="cb-preview-file" mdc="replace_with" mdtext="EnvInitializer.java">EnvInitializer.java</span> &nbsp;-&nbsp; 
           <a href="https://github.com/chargebee/chargebee-samples/tree/master/java/src/com/chargebee/samples/common/EnvInitializer.java" target="_blank"><span class="fa fa-github"></span>&nbsp;View full code</a> 
          </div> 
          <div class="cb-preview-body"> 
           <pre class="prettyprint lang-java" mdc="container">

/**
 * The credentials are stored in a properties file under WEB-INF
 * The live site api keys should be stored securely. It should preferably 
 * be stored only in the production machine(s) and not hard coded 
 * in code or checked into a version control system by mistake.
 */
Properties credentials = read("WEB-INF/ChargeBeeCredentials.properties");
Environment.configure(credentials.getProperty("site"), 
        credentials.getProperty("api_key"));

</pre> 
          </div> 
         </div> 
        </div> 
        <div mid="lang" style="display:none" data-content-type="rb" mdc="container"> 
         <p>For the tutorials we have configured the site credentials in config/environments/development.rb</p> 
         <div class="cb-preview" mid="snip" style="display:none" data-content-type="rb" =""="" data-swiftype-index="false"> 
          <div class="cb-preview-title"> 
           <ul style=" "> 
            <li class="active"><span data-tab="php">php</span></li> 
            <li><span data-tab="rb">Ruby</span></li> 
            <li><span data-tab="java">Java</span></li> 
           </ul> 
           <span class="fa fa-file-code-o"></span>&nbsp; 
           <span class="cb-preview-file" mdc="replace_with" mdtext="development.rb">development.rb</span> &nbsp;-&nbsp; 
           <a href="https://github.com/chargebee/chargebee-samples/tree/master/ruby/cb_sample_apps/config/environments/development.rb" target="_blank"><span class="fa fa-github"></span>&nbsp;View full code</a> 
          </div> 
          <div class="cb-preview-body"> 
           <pre class="prettyprint lang-rb" mdc="container">
ENV["CHARGEBEE_SITE"]="honeycomics-test"
ENV["CHARGEBEE_API_KEY"]="test_3gfwsdd6doB2EKRP7cufTd5TvT32a5BrT"

</pre> 
          </div> 
         </div> 
         <p>We setup the client library in config/initializers/chargebee.rb</p> 
         <div class="cb-preview" mid="snip" style="display:none" data-content-type="rb" =""="" data-swiftype-index="false"> 
          <div class="cb-preview-title"> 
           <ul style=" "> 
            <li class="active"><span data-tab="php">php</span></li> 
            <li><span data-tab="rb">Ruby</span></li> 
            <li><span data-tab="java">Java</span></li> 
           </ul> 
           <span class="fa fa-file-code-o"></span>&nbsp; 
           <span class="cb-preview-file" mdc="replace_with" mdtext="chargebee.rb">chargebee.rb</span> &nbsp;-&nbsp; 
           <a href="https://github.com/chargebee/chargebee-samples/tree/master/ruby/cb_sample_apps/config/initializers/chargebee.rb" target="_blank"><span class="fa fa-github"></span>&nbsp;View full code</a> 
          </div> 
          <div class="cb-preview-body"> 
           <pre class="prettyprint lang-rb" mdc="container">
# Configuring the server for ChargeBee API call.
ChargeBee.configure(:site =&gt; ENV["CHARGEBEE_SITE"],
                    :api_key =&gt; ENV["CHARGEBEE_API_KEY"])

</pre> 
          </div> 
         </div> 
        </div> 
        <div mid="lang" style="display:none" data-content-type="php" mdc="container"> 
         <p>For the tutorials we have configured the site credentials in Config.php which is included in other php files.</p> 
         <div class="cb-preview" mid="snip" style="display:none" data-content-type="php" =""="" data-swiftype-index="false"> 
          <div class="cb-preview-title"> 
           <ul style=" "> 
            <li class="active"><span data-tab="php">php</span></li> 
            <li><span data-tab="rb">Ruby</span></li> 
            <li><span data-tab="java">Java</span></li> 
           </ul> 
           <span class="fa fa-file-code-o"></span>&nbsp; 
           <span class="cb-preview-file" mdc="replace_with" mdtext="Config.php">Config.php</span> &nbsp;-&nbsp; 
           <a href="https://github.com/chargebee/chargebee-samples/tree/master/php/php_src/Config.php" target="_blank"><span class="fa fa-github"></span>&nbsp;View full code</a> 
          </div> 
          <div class="cb-preview-body"> 
           <pre class="prettyprint lang-php" mdc="container">
require_once(dirname(__FILE__) . "/lib/ChargeBee.php");
/* 
 * Sets the environment for calling the Chargebee API.
 * You need to sign up at ChargeBee app to get this credential.
 * It is better if you fetch configuration from the environment 
 * properties instead of hard coding it in code.
 */
ChargeBee_Environment::configure("honeycomics-test", 
            "test_3gfwsdd6doB2EKRP7cufTd5TvT32a5BrT");
</pre> 
          </div> 
         </div> 
        </div> <h2 id="create-the-subscription" data-heading="h2">Create the subscription<a class="fa fa-link" data-cb-sublist-hash="create-the-subscription" href="stripe-js-card-token-example.html#create-the-subscription" title="Permalink">&nbsp;</a></h2> <p>We fetch the Stripe token and other information from the POST parameters submitted by our form and use the <span mid="link_api"><a href="https://apidocs.chargebee.com/docs/api/subscriptions#create_a_subscription" target="_blank"> Create Subscription</a>&nbsp;<span class="fa fa-external-link text-muted"></span></span> API to create the subscription in Chargebee.</p> 
        <div class="cb-preview" mid="snip" style="display:none" data-content-type="java" =""="" data-swiftype-index="false"> 
         <div class="cb-preview-title"> 
          <ul style=" "> 
           <li class="active"><span data-tab="php">php</span></li> 
           <li><span data-tab="rb">Ruby</span></li> 
           <li><span data-tab="java">Java</span></li> 
          </ul> 
          <span class="fa fa-file-code-o"></span>&nbsp; 
          <span class="cb-preview-file" mdc="replace_with" mdtext="StripeJsCheckout.java">StripeJsCheckout.java</span> &nbsp;-&nbsp; 
          <a href="https://github.com/chargebee/chargebee-samples/tree/master/java/src/com/chargebee/samples/StripeJsCheckout.java" target="_blank"><span class="fa fa-github"></span>&nbsp;View full code</a> 
         </div> 
         <div class="cb-preview-body"> 
          <pre class="prettyprint lang-java" mdc="container">
/* 
 * planId is id of the plan present in the ChargeBee app. 
 * For demo purpose a plan with id 'annual' is hard coded and should exist 
 * at your ChargeBee site. It can be also be received from request by 
 * making customer selecting the plan of their choice at client side.
 */
String planId = "annual";

/* Sends request to the ChargeBee server to create the subscription from 
 * the parameters received. The result will have subscription attributes, 
 * customer attributes and card attributes.
 */
Result result = Subscription.create()
        .planId(planId)
        .customerEmail(req.getParameter("customer[email]"))
        .customerFirstName(req.getParameter("customer[first_name]"))
        .customerLastName(req.getParameter("customer[last_name]"))
        .customerPhone(req.getParameter("customer[phone]"))
        .cardTmpToken(req.getParameter("stripeToken")).request();

</pre> 
         </div> 
        </div> 
        <div class="cb-preview" mid="snip" style="display:none" data-content-type="php" =""="" data-swiftype-index="false"> 
         <div class="cb-preview-title"> 
          <ul style=" "> 
           <li class="active"><span data-tab="php">php</span></li> 
           <li><span data-tab="rb">Ruby</span></li> 
           <li><span data-tab="java">Java</span></li> 
          </ul> 
          <span class="fa fa-file-code-o"></span>&nbsp; 
          <span class="cb-preview-file" mdc="replace_with" mdtext="StripeJsCheckout.php">StripeJsCheckout.php</span> &nbsp;-&nbsp; 
          <a href="https://github.com/chargebee/chargebee-samples/tree/master/php/php_src/StripeJsCheckout.php" target="_blank"><span class="fa fa-github"></span>&nbsp;View full code</a> 
         </div> 
         <div class="cb-preview-body"> 
          <pre class="prettyprint lang-php" mdc="container">
/*
 * Constructing a parameter array for create subscription api. 
 * It will have account information, the temporary token got from Stripe and
 * plan details.
 * For demo purpose a plan with id 'annual' is hard coded.
 * Other params are obtained from request object.
 * Note : Here customer object received from client side is sent directly 
 *        to ChargeBee.It is possible as the html form's input names are 
 *        in the format customer[&lt;attribute name&gt;] eg: customer[first_name] 
 *        and hence the $_POST["customer"] returns an associative array of the attributes.
 *               
 */
$createSubscriptionParams = array(
    "planId" =&gt; "basic",
    "customer" =&gt; $_POST['customer'],
    "card" =&gt; array(
    "tmp_token" =&gt; $_POST['stripeToken']
));

/* 
* Sending request to the chargebee server to create the subscription from 
* the parameters received. The result will have customer,subscription and 
* card attributes.
*/
$result = ChargeBee_Subscription::create($createSubscriptionParams);

</pre> 
         </div> 
        </div> 
        <div class="cb-preview" mid="snip" style="display:none" data-content-type="rb" =""="" data-swiftype-index="false"> 
         <div class="cb-preview-title"> 
          <ul style=" "> 
           <li class="active"><span data-tab="php">php</span></li> 
           <li><span data-tab="rb">Ruby</span></li> 
           <li><span data-tab="java">Java</span></li> 
          </ul> 
          <span class="fa fa-file-code-o"></span>&nbsp; 
          <span class="cb-preview-file" mdc="replace_with" mdtext="stripe_js_checkout_controller.rb">stripe_js_checkout_controller.rb</span> &nbsp;-&nbsp; 
          <a href="https://github.com/chargebee/chargebee-samples/tree/master/ruby/cb_sample_apps/app/controllers/stripe_js_checkout_controller.rb" target="_blank"><span class="fa fa-github"></span>&nbsp;View full code</a> 
         </div> 
         <div class="cb-preview-body"> 
          <pre class="prettyprint lang-rb" mdc="container">
# Sends request to the ChargeBee server to create the subscription from
# the parameters received. The result will have subscription attributes,
# customer attributes and card attributes.
#
# Note : Here customer object received from client side is sent directly 
#        to ChargeBee.It is possible as the html form's input names are 
#        in the format customer[&lt;attribute name&gt;] eg: customer[first_name] 
#        and hence the $_POST["customer"] returns an associative array of the attributes.               
result = ChargeBee::Subscription.create({
  :plan_id =&gt; "basic", 
  :customer =&gt; _params["customer"],
  :card =&gt; {
    :tmp_token =&gt; _params['stripeToken'] 
  }
})

</pre> 
         </div> 
        </div> <h3>Redirecting to a thank you page</h3> <p>So, what happens when a subscription is created successfully? Well, Chargebee returns a <span mid="popup_link"><a data-popup="popup" data-content="popup_id_3" mdc="container" href="javascript:void()">success response</a>&nbsp;<span class="fa fa-external-link-square text-muted"></span></span> in json format which is wrapped as a 'result' class by the client library. In case of any error , Chargebee returns a <span mid="popup_link"><a data-popup="popup" data-content="popup_id_4" mdc="container" href="javascript:void()">error response</a>&nbsp;<span class="fa fa-external-link-square text-muted"></span></span> which is wrapped and thrown as an exception by the client library .</p> <p>In case of successful checkout we redirect the user to a simple 'Thank You' page.</p> 
        <div class="cb-preview" mid="snip" style="display:none" data-content-type="java" =""="" data-swiftype-index="false"> 
         <div class="cb-preview-title"> 
          <ul style=" "> 
           <li class="active"><span data-tab="php">php</span></li> 
           <li><span data-tab="rb">Ruby</span></li> 
           <li><span data-tab="java">Java</span></li> 
          </ul> 
          <span class="fa fa-file-code-o"></span>&nbsp; 
          <span class="cb-preview-file" mdc="replace_with" mdtext="StripeJsCheckout.java">StripeJsCheckout.java</span> &nbsp;-&nbsp; 
          <a href="https://github.com/chargebee/chargebee-samples/tree/master/java/src/com/chargebee/samples/StripeJsCheckout.java" target="_blank"><span class="fa fa-github"></span>&nbsp;View full code</a> 
         </div> 
         <div class="cb-preview-body"> 
          <pre class="prettyprint lang-java" mdc="container">
/* Forwarding to thank you page after successful create subscription.
 */
//Writing json. Suggestion: Use proper json library
out.write("{\"forward\": \"/stripe_js/thankyou.html\"}");

</pre> 
         </div> 
        </div> 
        <div class="cb-preview" mid="snip" style="display:none" data-content-type="php" =""="" data-swiftype-index="false"> 
         <div class="cb-preview-title"> 
          <ul style=" "> 
           <li class="active"><span data-tab="php">php</span></li> 
           <li><span data-tab="rb">Ruby</span></li> 
           <li><span data-tab="java">Java</span></li> 
          </ul> 
          <span class="fa fa-file-code-o"></span>&nbsp; 
          <span class="cb-preview-file" mdc="replace_with" mdtext="StripeJsCheckout.php">StripeJsCheckout.php</span> &nbsp;-&nbsp; 
          <a href="https://github.com/chargebee/chargebee-samples/tree/master/php/php_src/StripeJsCheckout.php" target="_blank"><span class="fa fa-github"></span>&nbsp;View full code</a> 
         </div> 
         <div class="cb-preview-body"> 
          <pre class="prettyprint lang-php" mdc="container">
/*
 * Forwarding to success page after successful create subscription in ChargeBee.
 */
$queryParameters = "name=" . urlencode($result-&gt;customer()-&gt;firstName) .
              "&amp;planId=" . urlencode($result-&gt;subscription()-&gt;planId);        
$jsonResp["forward"] = "thankyou.html";
echo json_encode($jsonResp, true);

</pre> 
         </div> 
        </div> 
        <div class="cb-preview" mid="snip" style="display:none" data-content-type="rb" =""="" data-swiftype-index="false"> 
         <div class="cb-preview-title"> 
          <ul style=" "> 
           <li class="active"><span data-tab="php">php</span></li> 
           <li><span data-tab="rb">Ruby</span></li> 
           <li><span data-tab="java">Java</span></li> 
          </ul> 
          <span class="fa fa-file-code-o"></span>&nbsp; 
          <span class="cb-preview-file" mdc="replace_with" mdtext="stripe_js_checkout_controller.rb">stripe_js_checkout_controller.rb</span> &nbsp;-&nbsp; 
          <a href="https://github.com/chargebee/chargebee-samples/tree/master/ruby/cb_sample_apps/app/controllers/stripe_js_checkout_controller.rb" target="_blank"><span class="fa fa-github"></span>&nbsp;View full code</a> 
         </div> 
         <div class="cb-preview-body"> 
          <pre class="prettyprint lang-rb" mdc="container">
# Forwarding to thank you page after successful create subscription.
render json: {
  :forward =&gt; "thankyou.html"
}

</pre> 
         </div> 
        </div> <h3>Validation and Error Handling</h3> <p>Here's how we validate user inputs and handle API call errors in this demo:</p> 
        <ul> 
         <li><p><strong>Client Side Validation:</strong> We use the <span mid="link_static"><a href="http://jqueryvalidation.org/" target="_blank"> jQuery form validation</a>&nbsp;<span class="fa fa-external-link text-muted"></span></span> plugin to check whether the user's input in fields(email, zip code and phone number) is valid or not.</p> </li> 
         <li><p><strong>Stripe Tokenization Errors:</strong> Stripe returns error JSON for tokenization errors. We used the <span mid="popup_link"><a data-popup="popup" data-content="popup_id_5" mdc="container" href="javascript:void()">stripeErrorDisplayHandler</a>&nbsp;<span class="fa fa-external-link-square text-muted"></span></span> to identify and display the error that occurred.</p> </li> 
         <li><p><strong>Server Side Validation:</strong> As this is a demo app we have skipped the server side validation of all input parameters. But we recommend you to perform the validation at your end.</p> </li> 
         <li><p><strong>Payment Errors:</strong> If a payment fails due to card verification or processing errors, Chargebee returns an <span mid="popup_link"><a data-popup="popup" data-content="popup_id_6" mdc="container" href="javascript:void()">error response</a>&nbsp;<span class="fa fa-external-link-square text-muted"></span></span> which is thrown as a payment exception by the client library. We handle the exception in this demo with appropriate error messages.</p> </li> 
         <li><p><strong>General API Errors:</strong> Chargebee might return error responses due to various reasons such as invalid configuration. To identify specific reasons for all error responses you can check the <span mid="link_static"><a href="https://apidocs.chargebee.com/docs/api?lang=php#error_handling" target="_blank">API documentation</a>&nbsp;<span class="fa fa-external-link text-muted"></span></span> and also take a look at the error handler file to check how these errors can be handled.</p> </li> 
        </ul> <h2 id="test-cards" data-heading="h2">Test cards<a class="fa fa-link" data-cb-sublist-hash="test-cards" href="stripe-js-card-token-example.html#test-cards" title="Permalink">&nbsp;</a></h2> <p>Now that you're all set, why don't you test your integration with some test transactions. Here are some credit card numbers that you can use to test your application.</p> 
        <dl class="dl-horizontal"> 
         <dt>
           Visa 
         </dt> 
         <dd>
           4242 4242 4242 4242 
         </dd> 
         <dt>
           Discover 
         </dt> 
         <dd>
           6011 1111 1111 1117 
         </dd> 
         <dt>
           JCB 
         </dt> 
         <dd>
           3530 1113 3330 0000 
         </dd> 
        </dl> <p>For more test cards for testing different scenarios <span mid="link_static"><a href="https://stripe.com/docs/testing#cards" target="_blank"> click here</a>&nbsp;<span class="fa fa-external-link text-muted"></span></span>.</p> 
        <div id="cb-content-footer" mid="reference"> 
         <div class="row"> 
          <div class="col-sm-5"> 
           <h5 class="h3">Reference Links</h5> 
           <ul> 
            <li><span mid="link_api"><a href="https://apidocs.chargebee.com/docs/api/" target="_blank"> Chargebee API Docs</a>&nbsp;<span class="fa fa-external-link text-muted"></span></span></li> 
            <li><span mid="link_static"><a href="http://jqueryvalidation.org" target="_blank"> Jquery Validation</a>&nbsp;<span class="fa fa-external-link text-muted"></span></span></li> 
            <li><span mid="link_static"><a href="https://stripe.com/docs/stripe.js" target="_blank"> Stripe Docs</a>&nbsp;<span class="fa fa-external-link text-muted"></span></span></li> 
            <li><span mid="link_static"><a href="https://stripe.com/help/security" target="_blank"> Stripe Security Docs</a>&nbsp;<span class="fa fa-external-link text-muted"></span></span> </li> 
           </ul> 
          </div> 
          <div class="col-sm-5 col-sm-offset-1"> 
           <h5 class="h3">Need more help?</h5> 
           <p>We're always happy to help you with any questions you might have!</p> 
           <a href="mailto:support@chargebee.com">support@chargebee.com</a> 
           <br> 
          </div> 
         </div> 
        </div> </span> 
      </div> 
     </div> 
    </div> 
   </div> 
  </section> 
  <footer style="padding:30px 0;text-align:center;color:#777;"> 
   <div class="container">
     © Chargebee Inc. All Rights Reserved. 
   </div> 
  </footer> 
  <!-- popup window --> 
  <div class="modal" id="popup" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"> 
   <div class="modal-dialog"> 
    <div class="modal-content"> 
     <div class="modal-header"> 
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button> 
      <h4 class="modal-title" id="modalLabel">Modal title</h4> 
     </div> 
     <div class="modal-body" id="popup-body"> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div mid="psnip" id="popup_id_0" mdc="hide" data-title="Stripe success response" style="display:none"> 
   <pre class="prettyprint lang-json" mdc="container" data-swiftype-index="false">
{
   "card": "Object",
   "created": 1384236766,
   "id": "tok_2vRInkdCyn8mTi",
   "livemode": false,
   "object": "token",
   "type": "card",
   "used": false
}</pre> 
  </div>
  <div mid="psnip" id="popup_id_1" mdc="hide" data-title="Stripe error response" style="display:none"> 
   <pre class="prettyprint lang-json" mdc="container" data-swiftype-index="false">
{
   "error": "Object",
   "code": "invalid_expiry_month",
   "message": "Your card's expiration month is invalid.",
   "param": "exp_month",
   "type": "card_error"
}</pre> 
  </div>
  <div mid="psnip" id="popup_id_2" mdc="hide" data-title="Error Display Handler Code" style="display:none"> 
   <pre class="prettyprint lang-js" mdc="container" data-swiftype-index="false">
// Handling the error from stripe server due to invalid credit card credentials.
function stripeErrorDisplayHandler(response) {
    //Card field map - the keys are taken from error param values sent from stripe 
    //                 and the values are error class name in the form.
    var errorMap = {"number": "card-number",
        "cvc": "card-cvc",
        "exp_month": "card-expiry-month",
        "exp_year": "card-expiry-year"
    };
    //Check if param exist in error
    if (response.error.param) {
        var paramClassName = errorMap[response.error.param];
        if (paramClassName) {
            //Display error in found class
            $('.' + paramClassName)
                    .parents('.form-group')
                    .find('.text-danger')
                    .text(response.error.message).show();
        } else {
            $(".alert-danger").show().text(response.error.message);
        }
    } else {
        $(".alert-danger").show().text(response.error.message);
    }
}
 
 
</pre> 
  </div>
  <div mid="psnip" id="popup_id_3" mdc="hide" data-title="Create Subscription" style="display:none"> 
   <pre class="prettyprint lang-json" mdc="container" data-swiftype-index="false">
{
   "customer": {
      "auto_collection": "on",
      "billing_address": {
         "city": "Walnut",
         "country": "US",
         "line1": "340 S LEMON AVE #1537",
         "object": "billing_address",
         "state": "CA",
         "zip": "91789"
      },
      "card_status": "no_card",
      "created_at": 1382683911,
      "email": "john@user.com",
      "first_name": "John",
      "id": "8avSkOLGCmUZJ",
      "last_name": "Wayne",
      "object": "customer",
      "phone": "+1-949-305-6900"
   },
   "subscription": {
      "created_at": 1382683911,
      "due_invoices_count": 0,
      "id": "8avSkOLGCmUZJ",
      "object": "subscription",
      "plan_id": "basic",
      "plan_quantity": 1,
      "started_at": 1382683911,
      "status": "in_trial",
      "trial_end": 1385362311,
      "trial_start": 1382683911
   }
}</pre> 
  </div>
  <div mid="psnip" id="popup_id_4" mdc="hide" data-title="Card Declined Error" style="display:none"> 
   <pre class="prettyprint lang-json" mdc="container" data-swiftype-index="false">
{
   "api_error_code": "payment_method_verification_failed",
   "error_code": "add_card_error",
   "error_msg": "Problem while adding the card. Error message : (3009) Do not honour.",
   "http_status_code": 400,
   "message": "Problem while adding the card. Error message : (3009) Do not honour.",
   "type": "payment"
}</pre> 
  </div>
  <div mid="psnip" id="popup_id_5" mdc="hide" data-title="Error Display Handler" style="display:none"> 
   <pre class="prettyprint lang-js" mdc="container" data-swiftype-index="false">
// Handling the error from stripe server due to invalid credit card credentials.
function stripeErrorDisplayHandler(response) {
    //Card field map - the keys are taken from error param values sent from stripe 
    //                 and the values are error class name in the form.
    var errorMap = {"number": "card-number",
        "cvc": "card-cvc",
        "exp_month": "card-expiry-month",
        "exp_year": "card-expiry-year"
    };
    //Check if param exist in error
    if (response.error.param) {
        var paramClassName = errorMap[response.error.param];
        if (paramClassName) {
            //Display error in found class
            $('.' + paramClassName)
                    .parents('.form-group')
                    .find('.text-danger')
                    .text(response.error.message).show();
        } else {
            $(".alert-danger").show().text(response.error.message);
        }
    } else {
        $(".alert-danger").show().text(response.error.message);
    }
}
 
 
</pre> 
  </div>
  <div mid="psnip" id="popup_id_6" mdc="hide" data-title="Card Declined Error" style="display:none"> 
   <pre class="prettyprint lang-json" mdc="container" data-swiftype-index="false">
{
   "api_error_code": "payment_method_verification_failed",
   "error_code": "add_card_error",
   "error_msg": "Problem while adding the card. Error message : (3009) Do not honour.",
   "http_status_code": 400,
   "message": "Problem while adding the card. Error message : (3009) Do not honour.",
   "type": "payment"
}</pre> 
  </div> 
  <!-- Bootstrap core JavaScript
        ================================================== --> 
  <!-- Placed at the end of the document so the pages load faster --> 
  <script>startTime();</script> 
  <script type="text/javascript" src="assets/v1.1/js/jquery.min.js"></script> 
  <script type="text/javascript" src="assets/v1.1/js/bootstrap.min.js"></script> 
  <script>storeTime("jquery");</script> 
  <script>startTime();</script> 
  <script src="//fast.wistia.net/assets/external/E-v1.js" async></script> 
  <script type="text/javascript" src="https://fast.wistia.net/static/embed_shepherd-v1.js" defer></script> 
  <script>storeTime("otherjs");</script> 
  <script>startTime();</script> 
  <script type="text/javascript" src="assets/v1.1/js/application.js"></script> 
  <script type="text/javascript" src="assets/v1.1/js/nav.js"></script> 
  <script>storeTime("webjs");</script> 
  <script>startTime();</script> 
  <script src="https://www.chargebee.com/docs/assets/common/tp_snippets.js"></script> 
  <script>
        TpJsSnippet.init("tutorials");
        </script> 
  <script>storeTime("tpjs");</script>   
 </body>
</html>