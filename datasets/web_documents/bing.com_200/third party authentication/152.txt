<!doctype html>
<html class="v2" dir="ltr">
 <head> 
  <link href="https://www.blogger.com/static/v1/widgets/521441841-css_bundle_v2.css" rel="stylesheet" type="text/css"> 
  <meta content="width=1100" name="viewport"> 
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> 
  <meta content="blogger" name="generator"> 
  <link href="http://garymcallisteronline.blogspot.com.ar/favicon.ico" rel="icon" type="image/x-icon"> 
  <link href="http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html" rel="canonical"> 
  <link rel="alternate" type="application/atom+xml" title="GaryMcAllisterOnline - Atom" href="http://garymcallisteronline.blogspot.com/feeds/posts/default"> 
  <link rel="alternate" type="application/rss+xml" title="GaryMcAllisterOnline - RSS" href="http://garymcallisteronline.blogspot.com/feeds/posts/default?alt=rss"> 
  <link rel="service.post" type="application/atom+xml" title="GaryMcAllisterOnline - Atom" href="https://www.blogger.com/feeds/100826624083918515/posts/default"> 
  <link rel="alternate" type="application/atom+xml" title="GaryMcAllisterOnline - Atom" href="http://garymcallisteronline.blogspot.com/feeds/3066795278905207542/comments/default"> 
  <!--[if IE]><script type="text/javascript" src="https://www.blogger.com/static/v1/jsbin/35781802-ieretrofit.js"></script>
<![endif]--> 
  <link href="http://lh5.ggpht.com/-4s0igXmQ65w/UPM52cP8fiI/AAAAAAAAAEA/xxbn76zVGL8/image_thumb%25255B12%25255D.png?imgmax=800" rel="image_src"> 
  <meta content="http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html" property="og:url"> 
  <meta content="ASP.NET MVC 4, ADFS 2.0 and 3rd party STS integration (IdentityServer2)" property="og:title"> 
  <meta content=" Introduction  I am currently going through the architectural process of enabling 3rd party claims authentication via both active directory ..." property="og:description"> 
  <meta content="http://lh5.ggpht.com/-4s0igXmQ65w/UPM52cP8fiI/AAAAAAAAAEA/xxbn76zVGL8/w1200-h630-p-k-no-nu/image_thumb%25255B12%25255D.png?imgmax=800" property="og:image"> 
  <!--[if IE]> <script> (function() { var html5 = ("abbr,article,aside,audio,canvas,datalist,details," + "figure,footer,header,hgroup,mark,menu,meter,nav,output," + "progress,section,time,video").split(','); for (var i = 0; i < html5.length; i++) { document.createElement(html5[i]); } try { document.execCommand('BackgroundImageCache', false, true); } catch(e) {} })(); </script> <![endif]--> 
  <title>GaryMcAllisterOnline: ASP.NET MVC 4, ADFS 2.0 and 3rd party STS integration (IdentityServer2)</title> 
  <style id="page-skin-1" type="text/css"><!--
/*
-----------------------------------------------
Blogger Template Style
Name:     Simple
Designer: Blogger
URL:      www.blogger.com
----------------------------------------------- */

/* Content
----------------------------------------------- */
body {
font: normal normal 12px 'Trebuchet MS', Trebuchet, Verdana, sans-serif;
color: #666666;
background: #ffffff none repeat scroll top left;
padding: 0 0 0 0;
}
html body .region-inner {
min-width: 0;
max-width: 100%;
width: auto;
}
h2 {
font-size: 22px;
}
a:link {
text-decoration:none;
color: #2288bb;
}
a:visited {
text-decoration:none;
color: #888888;
}
a:hover {
text-decoration:underline;
color: #33aaff;
}
.body-fauxcolumn-outer .fauxcolumn-inner {
background: transparent none repeat scroll top left;
_background-image: none;
}
.body-fauxcolumn-outer .cap-top {
position: absolute;
z-index: 1;
height: 400px;
width: 100%;
}
.body-fauxcolumn-outer .cap-top .cap-left {
width: 100%;
background: transparent none repeat-x scroll top left;
_background-image: none;
}
.content-outer {
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
-goog-ms-box-shadow: 0 0 0 #333333;
box-shadow: 0 0 0 rgba(0, 0, 0, .15);
margin-bottom: 1px;
}
.content-inner {
padding: 10px 40px;
}
.content-inner {
background-color: #ffffff;
}
/* Header
----------------------------------------------- */
.header-outer {
background: transparent none repeat-x scroll 0 -400px;
_background-image: none;
}
.Header h1 {
font: normal normal 40px 'Trebuchet MS',Trebuchet,Verdana,sans-serif;
color: #000000;
text-shadow: 0 0 0 rgba(0, 0, 0, .2);
}
.Header h1 a {
color: #000000;
}
.Header .description {
font-size: 18px;
color: #000000;
}
.header-inner .Header .titlewrapper {
padding: 22px 0;
}
.header-inner .Header .descriptionwrapper {
padding: 0 0;
}
/* Tabs
----------------------------------------------- */
.tabs-inner .section:first-child {
border-top: 0 solid #dddddd;
}
.tabs-inner .section:first-child ul {
margin-top: -1px;
border-top: 1px solid #dddddd;
border-left: 1px solid #dddddd;
border-right: 1px solid #dddddd;
}
.tabs-inner .widget ul {
background: transparent none repeat-x scroll 0 -800px;
_background-image: none;
border-bottom: 1px solid #dddddd;
margin-top: 0;
margin-left: -30px;
margin-right: -30px;
}
.tabs-inner .widget li a {
display: inline-block;
padding: .6em 1em;
font: normal normal 12px 'Trebuchet MS', Trebuchet, Verdana, sans-serif;
color: #000000;
border-left: 1px solid #ffffff;
border-right: 1px solid #dddddd;
}
.tabs-inner .widget li:first-child a {
border-left: none;
}
.tabs-inner .widget li.selected a, .tabs-inner .widget li a:hover {
color: #000000;
background-color: #eeeeee;
text-decoration: none;
}
/* Columns
----------------------------------------------- */
.main-outer {
border-top: 0 solid transparent;
}
.fauxcolumn-left-outer .fauxcolumn-inner {
border-right: 1px solid transparent;
}
.fauxcolumn-right-outer .fauxcolumn-inner {
border-left: 1px solid transparent;
}
/* Headings
----------------------------------------------- */
div.widget > h2,
div.widget h2.title {
margin: 0 0 1em 0;
font: normal bold 11px 'Trebuchet MS',Trebuchet,Verdana,sans-serif;
color: #000000;
}
/* Widgets
----------------------------------------------- */
.widget .zippy {
color: #999999;
text-shadow: 2px 2px 1px rgba(0, 0, 0, .1);
}
.widget .popular-posts ul {
list-style: none;
}
/* Posts
----------------------------------------------- */
h2.date-header {
font: normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
}
.date-header span {
background-color: #bbbbbb;
color: #ffffff;
padding: 0.4em;
letter-spacing: 3px;
margin: inherit;
}
.main-inner {
padding-top: 35px;
padding-bottom: 65px;
}
.main-inner .column-center-inner {
padding: 0 0;
}
.main-inner .column-center-inner .section {
margin: 0 1em;
}
.post {
margin: 0 0 45px 0;
}
h3.post-title, .comments h4 {
font: normal normal 22px 'Trebuchet MS',Trebuchet,Verdana,sans-serif;
margin: .75em 0 0;
}
.post-body {
font-size: 110%;
line-height: 1.4;
position: relative;
}
.post-body img, .post-body .tr-caption-container, .Profile img, .Image img,
.BlogList .item-thumbnail img {
padding: 2px;
background: #ffffff;
border: 1px solid #eeeeee;
-moz-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
-webkit-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
}
.post-body img, .post-body .tr-caption-container {
padding: 5px;
}
.post-body .tr-caption-container {
color: #666666;
}
.post-body .tr-caption-container img {
padding: 0;
background: transparent;
border: none;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
box-shadow: 0 0 0 rgba(0, 0, 0, .1);
}
.post-header {
margin: 0 0 1.5em;
line-height: 1.6;
font-size: 90%;
}
.post-footer {
margin: 20px -2px 0;
padding: 5px 10px;
color: #666666;
background-color: #eeeeee;
border-bottom: 1px solid #eeeeee;
line-height: 1.6;
font-size: 90%;
}
#comments .comment-author {
padding-top: 1.5em;
border-top: 1px solid transparent;
background-position: 0 1.5em;
}
#comments .comment-author:first-child {
padding-top: 0;
border-top: none;
}
.avatar-image-container {
margin: .2em 0 0;
}
#comments .avatar-image-container img {
border: 1px solid #eeeeee;
}
/* Comments
----------------------------------------------- */
.comments .comments-content .icon.blog-author {
background-repeat: no-repeat;
background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9sLFwMeCjjhcOMAAAD+SURBVDjLtZSvTgNBEIe/WRRnm3U8RC1neQdsm1zSBIU9VVF1FkUguQQsD9ITmD7ECZIJSE4OZo9stoVjC/zc7ky+zH9hXwVwDpTAWWLrgS3QAe8AZgaAJI5zYAmc8r0G4AHYHQKVwII8PZrZFsBFkeRCABYiMh9BRUhnSkPTNCtVXYXURi1FpBDgArj8QU1eVXUzfnjv7yP7kwu1mYrkWlU33vs1QNu2qU8pwN0UpKoqokjWwCztrMuBhEhmh8bD5UDqur75asbcX0BGUB9/HAMB+r32hznJgXy2v0sGLBcyAJ1EK3LFcbo1s91JeLwAbwGYu7TP/3ZGfnXYPgAVNngtqatUNgAAAABJRU5ErkJggg==);
}
.comments .comments-content .loadmore a {
border-top: 1px solid #999999;
border-bottom: 1px solid #999999;
}
.comments .comment-thread.inline-thread {
background-color: #eeeeee;
}
.comments .continue {
border-top: 2px solid #999999;
}
/* Accents
---------------------------------------------- */
.section-columns td.columns-cell {
border-left: 1px solid transparent;
}
.blog-pager {
background: transparent url(//www.blogblog.com/1kt/simple/paging_dot.png) repeat-x scroll top center;
}
.blog-pager-older-link, .home-link,
.blog-pager-newer-link {
background-color: #ffffff;
padding: 5px;
}
.footer-outer {
border-top: 1px dashed #bbbbbb;
}
/* Mobile
----------------------------------------------- */
body.mobile  {
background-size: auto;
}
.mobile .body-fauxcolumn-outer {
background: transparent none repeat scroll top left;
}
.mobile .body-fauxcolumn-outer .cap-top {
background-size: 100% auto;
}
.mobile .content-outer {
-webkit-box-shadow: 0 0 3px rgba(0, 0, 0, .15);
box-shadow: 0 0 3px rgba(0, 0, 0, .15);
}
.mobile .tabs-inner .widget ul {
margin-left: 0;
margin-right: 0;
}
.mobile .post {
margin: 0;
}
.mobile .main-inner .column-center-inner .section {
margin: 0;
}
.mobile .date-header span {
padding: 0.1em 10px;
margin: 0 -10px;
}
.mobile h3.post-title {
margin: 0;
}
.mobile .blog-pager {
background: transparent none no-repeat scroll top center;
}
.mobile .footer-outer {
border-top: none;
}
.mobile .main-inner, .mobile .footer-inner {
background-color: #ffffff;
}
.mobile-index-contents {
color: #666666;
}
.mobile-link-button {
background-color: #2288bb;
}
.mobile-link-button a:link, .mobile-link-button a:visited {
color: #ffffff;
}
.mobile .tabs-inner .section:first-child {
border-top: none;
}
.mobile .tabs-inner .PageList .widget-content {
background-color: #eeeeee;
color: #000000;
border-top: 1px solid #dddddd;
border-bottom: 1px solid #dddddd;
}
.mobile .tabs-inner .PageList .widget-content .pagelist-arrow {
border-left: 1px solid #dddddd;
}

--></style> 
  <style id="template-skin-1" type="text/css"><!--
body {
min-width: 960px;
}
.content-outer, .content-fauxcolumn-outer, .region-inner {
min-width: 960px;
max-width: 960px;
_width: 960px;
}
.main-inner .columns {
padding-left: 0;
padding-right: 310px;
}
.main-inner .fauxcolumn-center-outer {
left: 0;
right: 310px;
/* IE6 does not respect left and right together */
_width: expression(this.parentNode.offsetWidth -
parseInt("0") -
parseInt("310px") + 'px');
}
.main-inner .fauxcolumn-left-outer {
width: 0;
}
.main-inner .fauxcolumn-right-outer {
width: 310px;
}
.main-inner .column-left-outer {
width: 0;
right: 100%;
margin-left: -0;
}
.main-inner .column-right-outer {
width: 310px;
margin-right: -310px;
}
#layout {
min-width: 0;
}
#layout .content-outer {
min-width: 0;
width: 800px;
}
#layout .region-inner {
min-width: 0;
width: auto;
}
body#layout div.add_widget {
padding: 8px;
}
body#layout div.add_widget a {
margin-left: 32px;
}
--></style> 
  <link href="https://www.blogger.com/dyn-css/authorization.css?targetBlogID=100826624083918515&amp;zx=fa87abb8-3872-4e41-aba4-0458def7fdb0" media="none" onload="if(media!='all')media='all'" rel="stylesheet">
  <noscript>
   <link href="https://www.blogger.com/dyn-css/authorization.css?targetBlogID=100826624083918515&amp;zx=fa87abb8-3872-4e41-aba4-0458def7fdb0" rel="stylesheet">
  </noscript> 
 </head> 
 <body class="loading variant-simplysimple"> 
  <div class="navbar section" id="navbar" name="Navbar">
   <div class="widget Navbar" data-version="1" id="Navbar1">
    <script type="text/javascript">
    function setAttributeOnload(object, attribute, val) {
      if(window.addEventListener) {
        window.addEventListener('load',
          function(){ object[attribute] = val; }, false);
      } else {
        window.attachEvent('onload', function(){ object[attribute] = val; });
      }
    }
  </script> 
    <div id="navbar-iframe-container"></div> 
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script> 
    <script type="text/javascript">
      gapi.load("gapi.iframes:gapi.iframes.style.bubble", function() {
        if (gapi.iframes && gapi.iframes.getContext) {
          gapi.iframes.getContext().openChild({
              url: 'https://www.blogger.com/navbar.g?targetBlogID\x3d100826624083918515\x26blogName\x3dGaryMcAllisterOnline\x26publishMode\x3dPUBLISH_MODE_BLOGSPOT\x26navbarType\x3dLIGHT\x26layoutType\x3dLAYOUTS\x26searchRoot\x3dhttp://garymcallisteronline.blogspot.com/search\x26blogLocale\x3den_GB\x26v\x3d2\x26homepageUrl\x3dhttp://garymcallisteronline.blogspot.com/\x26targetPostID\x3d3066795278905207542\x26blogPostOrPageUrl\x3dhttp://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html\x26vt\x3d7532633294906375160',
              where: document.getElementById("navbar-iframe-container"),
              id: "navbar-iframe"
          });
        }
      });
    </script>
    <script type="text/javascript">
(function() {
var script = document.createElement('script');
script.type = 'text/javascript';
script.src = '//pagead2.googlesyndication.com/pagead/js/google_top_exp.js';
var head = document.getElementsByTagName('head')[0];
if (head) {
head.appendChild(script);
}})();
</script> 
   </div>
  </div> 
  <div class="body-fauxcolumns"> 
   <div class="fauxcolumn-outer body-fauxcolumn-outer"> 
    <div class="cap-top"> 
     <div class="cap-left"></div> 
     <div class="cap-right"></div> 
    </div> 
    <div class="fauxborder-left"> 
     <div class="fauxborder-right"></div> 
     <div class="fauxcolumn-inner"> 
     </div> 
    </div> 
    <div class="cap-bottom"> 
     <div class="cap-left"></div> 
     <div class="cap-right"></div> 
    </div> 
   </div> 
  </div> 
  <div class="content"> 
   <div class="content-fauxcolumns"> 
    <div class="fauxcolumn-outer content-fauxcolumn-outer"> 
     <div class="cap-top"> 
      <div class="cap-left"></div> 
      <div class="cap-right"></div> 
     </div> 
     <div class="fauxborder-left"> 
      <div class="fauxborder-right"></div> 
      <div class="fauxcolumn-inner"> 
      </div> 
     </div> 
     <div class="cap-bottom"> 
      <div class="cap-left"></div> 
      <div class="cap-right"></div> 
     </div> 
    </div> 
   </div> 
   <div class="content-outer"> 
    <div class="content-cap-top cap-top"> 
     <div class="cap-left"></div> 
     <div class="cap-right"></div> 
    </div> 
    <div class="fauxborder-left content-fauxborder-left"> 
     <div class="fauxborder-right content-fauxborder-right"></div> 
     <div class="content-inner"> 
      <header> 
       <div class="header-outer"> 
        <div class="header-cap-top cap-top"> 
         <div class="cap-left"></div> 
         <div class="cap-right"></div> 
        </div> 
        <div class="fauxborder-left header-fauxborder-left"> 
         <div class="fauxborder-right header-fauxborder-right"></div> 
         <div class="region-inner header-inner"> 
          <div class="header section" id="header" name="Header">
           <div class="widget Header" data-version="1" id="Header1"> 
            <div id="header-inner"> 
             <div class="titlewrapper"> 
              <h1 class="title"> <a href="http://garymcallisteronline.blogspot.com.ar/"> GaryMcAllisterOnline </a> </h1> 
             </div> 
             <div class="descriptionwrapper"> 
              <p class="description"><span> </span></p> 
             </div> 
            </div> 
           </div>
          </div> 
         </div> 
        </div> 
        <div class="header-cap-bottom cap-bottom"> 
         <div class="cap-left"></div> 
         <div class="cap-right"></div> 
        </div> 
       </div> 
      </header> 
      <div class="tabs-outer"> 
       <div class="tabs-cap-top cap-top"> 
        <div class="cap-left"></div> 
        <div class="cap-right"></div> 
       </div> 
       <div class="fauxborder-left tabs-fauxborder-left"> 
        <div class="fauxborder-right tabs-fauxborder-right"></div> 
        <div class="region-inner tabs-inner"> 
         <div class="tabs no-items section" id="crosscol" name="Cross-column"></div> 
         <div class="tabs no-items section" id="crosscol-overflow" name="Cross-Column 2"></div> 
        </div> 
       </div> 
       <div class="tabs-cap-bottom cap-bottom"> 
        <div class="cap-left"></div> 
        <div class="cap-right"></div> 
       </div> 
      </div> 
      <div class="main-outer"> 
       <div class="main-cap-top cap-top"> 
        <div class="cap-left"></div> 
        <div class="cap-right"></div> 
       </div> 
       <div class="fauxborder-left main-fauxborder-left"> 
        <div class="fauxborder-right main-fauxborder-right"></div> 
        <div class="region-inner main-inner"> 
         <div class="columns fauxcolumns"> 
          <div class="fauxcolumn-outer fauxcolumn-center-outer"> 
           <div class="cap-top"> 
            <div class="cap-left"></div> 
            <div class="cap-right"></div> 
           </div> 
           <div class="fauxborder-left"> 
            <div class="fauxborder-right"></div> 
            <div class="fauxcolumn-inner"> 
            </div> 
           </div> 
           <div class="cap-bottom"> 
            <div class="cap-left"></div> 
            <div class="cap-right"></div> 
           </div> 
          </div> 
          <div class="fauxcolumn-outer fauxcolumn-left-outer"> 
           <div class="cap-top"> 
            <div class="cap-left"></div> 
            <div class="cap-right"></div> 
           </div> 
           <div class="fauxborder-left"> 
            <div class="fauxborder-right"></div> 
            <div class="fauxcolumn-inner"> 
            </div> 
           </div> 
           <div class="cap-bottom"> 
            <div class="cap-left"></div> 
            <div class="cap-right"></div> 
           </div> 
          </div> 
          <div class="fauxcolumn-outer fauxcolumn-right-outer"> 
           <div class="cap-top"> 
            <div class="cap-left"></div> 
            <div class="cap-right"></div> 
           </div> 
           <div class="fauxborder-left"> 
            <div class="fauxborder-right"></div> 
            <div class="fauxcolumn-inner"> 
            </div> 
           </div> 
           <div class="cap-bottom"> 
            <div class="cap-left"></div> 
            <div class="cap-right"></div> 
           </div> 
          </div> 
          <!-- corrects IE6 width calculation --> 
          <div class="columns-inner"> 
           <div class="column-center-outer"> 
            <div class="column-center-inner"> 
             <div class="main section" id="main" name="Main">
              <div class="widget Blog" data-version="1" id="Blog1"> 
               <div class="blog-posts hfeed"> 
                <div class="date-outer"> 
                 <h2 class="date-header"><span>Sunday, 13 January 2013</span></h2> 
                 <div class="date-posts"> 
                  <div class="post-outer"> 
                   <div class="post hentry uncustomized-post-template" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting"> 
                    <meta content="http://lh5.ggpht.com/-4s0igXmQ65w/UPM52cP8fiI/AAAAAAAAAEA/xxbn76zVGL8/image_thumb%25255B12%25255D.png?imgmax=800" itemprop="image_url"> 
                    <meta content="100826624083918515" itemprop="blogId"> 
                    <meta content="3066795278905207542" itemprop="postId"> 
                    <a name="3066795278905207542"></a> 
                    <h3 class="post-title entry-title" itemprop="name"> ASP.NET MVC 4, ADFS 2.0 and 3rd party STS integration (IdentityServer2) </h3> 
                    <div class="post-header"> 
                     <div class="post-header-line-1"></div> 
                    </div> 
                    <div class="post-body entry-content" id="post-body-3066795278905207542" itemprop="description articleBody"> 
                     <p></p> 
                     <h2>Introduction</h2> 
                     <p>I am currently going through the architectural process of enabling 3rd party claims authentication via both active directory and a custom authentication store.&nbsp; This is a common requirement for the enterprise where a users primary login is not necessarily active directory.&nbsp; This complex scenario enables a single user to login via both an application account or the windows account, providing ultimate authentication flexibility.</p> 
                     <p class="post-title entry-title" itemprop="name">So, how is this achieved via ADFS 2.0?.. The honest answer is it isn’t.&nbsp; ADFS does not provide a pluggable model for custom authentication and only supports active directory authentication out of the box.&nbsp; Custom authentication needs to be provided via the utilisation of a custom Trusted STS and ADFS 2.0.&nbsp; Producing a reliable STS is no simple feat, the management, security and protocol support required to produce a working token service is a lot of work.&nbsp; Luckily for us, Dominick Baier (@leastprivilege) has taken all of this pain away via Identity Server 2.0.&nbsp; </p> 
                     <p class="post-title entry-title" itemprop="name">Identity server 2.0 is an Open Source STS providing the ability to “swap out” elements of the architecture and wrap a custom identity store.&nbsp; Once wrapped, this store can be accessed via the claims protocols (WS-Trust) and provide alternative authentication tokens.&nbsp; These tokens can be used to sign-in to ADFS and authenticate the user.&nbsp; With authentication complete, subsequent claims transforms can be applied inside ADFS.&nbsp; This is a challenging use-case, not one for the feint hearted.</p> 
                     <p class="post-title entry-title" itemprop="name">In the first part of this 2 part series I will configure ADFS 2.0 and Setup the relying party trust to an ASP.NET MVC application.&nbsp; In the 2nd part in the series I will install identity server v2 and modify the ADFS forms process to delegate access to the identity server provider via WS-Trust.</p> 
                     <h2>Environment</h2> 
                     <p class="post-title entry-title" itemprop="name">To get started you will need a Windows 2012 domain server, Windows 8 (IIS configured with a self-signed cert) and Visual Studio 2012 along with Identity Server 2.0.&nbsp; Knowledge of ASP.NET MVC 4.0 and Windows Identity Foundation is a bonus.</p> 
                     <p class="post-title entry-title" itemprop="name">Identity Server can be downloaded from <a href="http://thinktecture.github.com/Thinktecture.IdentityServer.v2/">here</a>.</p> 
                     <ul> 
                      <li> 
                       <div class="post-title entry-title" itemprop="name">
                        On the Windows 2012 Server, Add the ADFS 2.0 role and configure a self-signed IIS certificate with the correct bindings.&nbsp; This is explained exceptionally on the sysadminblog. 
                        <a title="http://www.sysadminsblog.com/microsoft/installing-and-configuring-adfs-2-0/" href="http://www.sysadminsblog.com/microsoft/installing-and-configuring-adfs-2-0/">Installing ADFS 2.0</a>
                       </div> </li>
                      <li> 
                       <div class="post-title entry-title" itemprop="name">
                        Once installed, install and configure identity server as described in the video at 
                        <a title="http://vimeo.com/51088126" href="http://vimeo.com/51088126">http://vimeo.com/51088126</a>.
                       </div> </li>
                      <li> 
                       <div class="post-title entry-title" itemprop="name">
                        .NET 4.5 and Windows 8 ship with WIF.
                       </div> </li>
                      <li> 
                       <div class="post-title entry-title" itemprop="name">
                        Visual Studio 2012 ships with ASP.NET MVC 4.0, to make life easy to you enable the “Identity and Access Tool” from Tools, Extensions and Updates extension manager.&nbsp; This provides an application level menu to configure your .NET application against the new federation service.
                       </div></li>
                     </ul> 
                     <h2>Configuring ADFS 2.0 for Forms Authentication</h2> 
                     <p>ADFS 2.0 by default is configured to hook directly into your existing active directory via integrated security through the browser.&nbsp; To utilise the ability to login to the 3rd party STS (IdentityServer) you need to change the default configuration to Forms (more on this in part 2).&nbsp; This is achieved by modifying the ADFS web.config (Found at c:\inetpub\adfs\ls\web.config) authentication preference (as below).&nbsp; You can also achieve this directly by embedding the authentication type into authenticating applications url via the wauth parameter.&nbsp; I.E: <a href="https://windows2012/adfs/ls?wauth=Forms">https://windows2012/adfs/ls?wauth=Forms</a></p> 
                     <blockquote>
                      <pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">microsoft.identityServer.web</span><span class="kwrd">&gt;</span><br>    <span class="kwrd">&lt;</span><span class="html">localAuthenticationTypes</span><span class="kwrd">&gt;</span><br>      <span class="kwrd">&lt;</span><span class="html">add</span> <span class="attr">name</span><span class="kwrd">="Forms"</span> <span class="attr">page</span><span class="kwrd">="FormsSignIn.aspx"</span> <span class="kwrd">/&gt;</span><br>      <span class="kwrd">&lt;</span><span class="html">add</span> <span class="attr">name</span><span class="kwrd">="Integrated"</span> <span class="attr">page</span><span class="kwrd">="auth/integrated/"</span> <span class="kwrd">/&gt;</span><br>      <span class="kwrd">&lt;</span><span class="html">add</span> <span class="attr">name</span><span class="kwrd">="TlsClient"</span> <span class="attr">page</span><span class="kwrd">="auth/sslclient/"</span> <span class="kwrd">/&gt;</span><br>      <span class="kwrd">&lt;</span><span class="html">add</span> <span class="attr">name</span><span class="kwrd">="Basic"</span> <span class="attr">page</span><span class="kwrd">="auth/basic/"</span> <span class="kwrd">/&gt;</span><br>    <span class="kwrd">&lt;/</span><span class="html">localAuthenticationTypes</span><span class="kwrd">&gt;</span><br>    <span class="kwrd">&lt;</span><span class="html">commonDomainCookie</span> <span class="attr">writer</span><span class="kwrd">=""</span> <span class="attr">reader</span><span class="kwrd">=""</span> <span class="kwrd">/&gt;</span><br>    <span class="kwrd">&lt;</span><span class="html">context</span> <span class="attr">hidden</span><span class="kwrd">="true"</span> <span class="kwrd">/&gt;</span><br>    <span class="kwrd">&lt;</span><span class="html">error</span> <span class="attr">page</span><span class="kwrd">="Error.aspx"</span> <span class="kwrd">/&gt;</span><br>    <span class="kwrd">&lt;</span><span class="html">acceptedFederationProtocols</span> <span class="attr">saml</span><span class="kwrd">="true"</span> <span class="attr">wsFederation</span><span class="kwrd">="true"</span> <span class="kwrd">/&gt;</span><br>    <span class="kwrd">&lt;</span><span class="html">homeRealmDiscovery</span> <span class="attr">page</span><span class="kwrd">="HomeRealmDiscovery.aspx"</span> <span class="kwrd">/&gt;</span><br>    <span class="kwrd">&lt;</span><span class="html">persistIdentityProviderInformation</span> <span class="attr">enabled</span><span class="kwrd">="true"</span> <span class="attr">lifetimeInDays</span><span class="kwrd">="30"</span> <span class="kwrd">/&gt;</span><br>    <span class="kwrd">&lt;</span><span class="html">singleSignOn</span> <span class="attr">enabled</span><span class="kwrd">="true"</span> <span class="kwrd">/&gt;</span><br><span class="kwrd">&lt;/</span><span class="html">microsoft.identityServer.web</span><span class="kwrd">&gt;</span></pre>
                     </blockquote>
                     <br>
                     <style type="text/css">.csharpcode, .csharpcode pre<br />{<br />	font-size: small;<br />	color: black;<br />	font-family: consolas, "Courier New", courier, monospace;<br />	background-color: #ffffff;<br />	/*white-space: pre;*/<br />}<br />.csharpcode pre { margin: 0em; }<br />.csharpcode .rem { color: #008000; }<br />.csharpcode .kwrd { color: #0000ff; }<br />.csharpcode .str { color: #006080; }<br />.csharpcode .op { color: #0000c0; }<br />.csharpcode .preproc { color: #cc6633; }<br />.csharpcode .asp { background-color: #ffff00; }<br />.csharpcode .html { color: #800000; }<br />.csharpcode .attr { color: #ff0000; }<br />.csharpcode .alt <br />{<br />	background-color: #f4f4f4;<br />	width: 100%;<br />	margin: 0em;<br />}<br />.csharpcode .lnum { color: #606060; }<br /></style>
                     <br>
                     <br>
                     <div class="post-title entry-title" itemprop="name">
                      Take note of the FormsSignIn.aspx page, this one of very few customisation points in ADFS 2.0.&nbsp; We will be using this later to redirect our credentials to our 3rd party STS.
                     </div>
                     <br>
                     <div class="post-title entry-title" itemprop="name">
                      &nbsp;
                     </div>
                     <br>
                     <div class="post-title entry-title" itemprop="name">
                      With ADFS configured, take note of the metadata address from the ADFS management console.&nbsp; This is found under the service, endpoints folder, for the purposes of this post we will use the Federation Metadata endpoint.&nbsp; As you can’t copy this from the MMC, here is the endpoint suffix: 
                     </div>
                     <br>
                     <div class="post-title entry-title" itemprop="name">
                      &nbsp;
                     </div>
                     <br>
                     <div class="post-title entry-title" align="center" itemprop="name">
                      /FederationMetadata/2007-06/FederationMetadata.xml
                     </div>
                     <br>
                     <div class="post-title entry-title" itemprop="name">
                      &nbsp;
                     </div>
                     <br>
                     <div class="post-title entry-title" itemprop="name">
                      <a href="http://lh3.ggpht.com/-KhyuRnnf9yE/UPM508dUf-I/AAAAAAAAAD4/3JOcz6G6bcc/s1600-h/image%25255B22%25255D.png"><img alt="image" border="0" height="400" src="http://lh5.ggpht.com/-4s0igXmQ65w/UPM52cP8fiI/AAAAAAAAAEA/xxbn76zVGL8/image_thumb%25255B12%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" title="image" width="537"></a> 
                     </div>
                     <br>
                     <div class="post-title entry-title" itemprop="name">
                      &nbsp;
                     </div>
                     <br>
                     <h2>Creating the ASP.NET MVC 4.0 Application</h2>
                     <br>
                     <p>In order to test the demonstration we will need a sample harness.&nbsp; An easy option to demonstrate this process is to create our own claims enabled application.&nbsp; To create this application launch visual studio (as an Administrator) and create a new blank basic ASP.NET MVC 4 application.&nbsp; Add this application to IIS, this makes the process easier.&nbsp; </p>
                     <br>
                     <p><strong><font color="#ff0000">Please ensure you have added the “Identity and Access Tool” from Tools, Extensions and Updates extension manager.</font></strong></p>
                     <br>
                     <p><a href="http://lh4.ggpht.com/-f8OphgG_QXU/UPM53Dw4pMI/AAAAAAAAAEI/EkT297Lv29U/s1600-h/image%25255B3%25255D.png"><img alt="image" border="0" height="349" src="http://lh3.ggpht.com/-uzDUFUco3WQ/UPM54CM7E8I/AAAAAAAAAEM/p_hOVzCtkzg/image_thumb%25255B1%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" title="image" width="381"></a> </p>
                     <br>
                     <p>In the project options ensure your application is using IIS.&nbsp; This process does work under IIS Express, this is my personal preference as configuring certificates is easier inside IIS.</p>
                     <br>
                     <p><a href="http://lh3.ggpht.com/-JBRNAqu0WDY/UPcJzcTWSfI/AAAAAAAAAJE/la75USyv2Yk/s1600-h/image%25255B123%25255D.png"><img alt="image" border="0" height="83" src="http://lh5.ggpht.com/-Fo31tO10dpE/UPM55jT_7lI/AAAAAAAAAJM/jl8M-oBSpPI/image_thumb%25255B75%25255D.png?imgmax=800" style="border-top: 0px; border-right: 0px; border-bottom: 0px; float: none; margin-left: auto; border-left: 0px; display: block; margin-right: auto" title="image" width="407"></a>&nbsp;</p>
                     <br>
                     <p>Once loaded, right click on the project and select the Identity and Access option.</p>
                     <br>
                     <p><a href="http://lh5.ggpht.com/-T6vSQ_VcPf0/UPM56gDXf4I/AAAAAAAAAEo/ygyHb1QHbnk/s1600-h/image%25255B18%25255D.png"><img alt="image" border="0" height="438" src="http://lh5.ggpht.com/-ULqFNUWsPiQ/UPM57SucBbI/AAAAAAAAAEs/Ub2pRT-TpoE/image_thumb%25255B10%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" title="image" width="235"></a>Once clicked, you will need the metadata URL from above, everything else will be configured automatically based on your application URL.&nbsp; You may desire to change the application realm (configuration tab), this can be done after metadata configuration.</p>
                     <br>
                     <p><img alt="image" border="0" height="420" src="http://lh5.ggpht.com/-J6hicsuRz1o/UPM595xaQcI/AAAAAAAAAFA/Bx-2xhqeDCg/image_thumb%25255B18%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" title="image" width="486">Once complete your web.config will be modified.&nbsp; The modifications provide the details of the identity provider and changes the application authentication settings and paths to allow for claims authentication.&nbsp; This is a fairly self-explanatory configuration consisting of the audience (your application root URL), The public certificate thumbnail of the issuing identity provider, and the redirection address to the identity provider for authentication (issuer).&nbsp; Realm is the relying party (service-provider) key (name) given to the identity provider to identify your application.</p>
                     <br>
                     <blockquote>
                      <pre class="csharpcode">  <span class="kwrd">&lt;</span><span class="html">system.identityModel</span><span class="kwrd">&gt;</span><br>    <span class="kwrd">&lt;</span><span class="html">identityConfiguration</span><span class="kwrd">&gt;</span><br>      <span class="kwrd">&lt;</span><span class="html">audienceUris</span><span class="kwrd">&gt;</span><br>        <span class="kwrd">&lt;</span><span class="html">add</span> <span class="attr">value</span><span class="kwrd">="http://localhost/Claims.Test/"</span> <span class="kwrd">/&gt;</span><br>      <span class="kwrd">&lt;/</span><span class="html">audienceUris</span><span class="kwrd">&gt;</span><br>      <span class="kwrd">&lt;</span><span class="html">issuerNameRegistry</span> <span class="attr">type</span><span class="kwrd">="System.IdentityModel.Tokens.ConfigurationBasedIssuerNameRegistry, System.IdentityModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"</span><span class="kwrd">&gt;</span><br>        <span class="kwrd">&lt;</span><span class="html">trustedIssuers</span><span class="kwrd">&gt;</span><br>          <span class="kwrd">&lt;</span><span class="html">add</span> <span class="attr">thumbprint</span><span class="kwrd">="THUMBNAIL OF CERT"</span> <span class="attr">name</span><span class="kwrd">="http://IdServ/adfs/services/trust"</span> <span class="kwrd">/&gt;</span><br>        <span class="kwrd">&lt;/</span><span class="html">trustedIssuers</span><span class="kwrd">&gt;</span><br>      <span class="kwrd">&lt;/</span><span class="html">issuerNameRegistry</span><span class="kwrd">&gt;</span><br>    <span class="kwrd">&lt;/</span><span class="html">identityConfiguration</span><span class="kwrd">&gt;</span><br>  <span class="kwrd">&lt;/</span><span class="html">system.identityModel</span><span class="kwrd">&gt;</span><br>  <span class="kwrd">&lt;</span><span class="html">system.identityModel.services</span><span class="kwrd">&gt;</span><br>    <span class="kwrd">&lt;</span><span class="html">federationConfiguration</span><span class="kwrd">&gt;</span><br>      <span class="kwrd">&lt;</span><span class="html">cookieHandler</span> <span class="attr">requireSsl</span><span class="kwrd">="false"</span> <span class="kwrd">/&gt;</span><br>      <span class="kwrd">&lt;</span><span class="html">wsFederation</span> <span class="attr">passiveRedirectEnabled</span><span class="kwrd">="true"</span> <span class="attr">issuer</span><span class="kwrd">="https://IdServ/adfs/ls/"</span> <span class="attr">realm</span><span class="kwrd">="http://localhost/Claims.Test/"</span> <span class="attr">requireHttps</span><span class="kwrd">="false"</span> <span class="kwrd">/&gt;</span><br>    <span class="kwrd">&lt;/</span><span class="html">federationConfiguration</span><span class="kwrd">&gt;</span><br>  <span class="kwrd">&lt;/</span><span class="html">system.identityModel.services</span><span class="kwrd">&gt;</span></pre>
                     </blockquote>
                     <br>
                     <style type="text/css">.csharpcode, .csharpcode pre<br />{<br />	font-size: small;<br />	color: black;<br />	font-family: consolas, "Courier New", courier, monospace;<br />	background-color: #ffffff;<br />	/*white-space: pre;*/<br />}<br />.csharpcode pre { margin: 0em; }<br />.csharpcode .rem { color: #008000; }<br />.csharpcode .kwrd { color: #0000ff; }<br />.csharpcode .str { color: #006080; }<br />.csharpcode .op { color: #0000c0; }<br />.csharpcode .preproc { color: #cc6633; }<br />.csharpcode .asp { background-color: #ffff00; }<br />.csharpcode .html { color: #800000; }<br />.csharpcode .attr { color: #ff0000; }<br />.csharpcode .alt <br />{<br />	background-color: #f4f4f4;<br />	width: 100%;<br />	margin: 0em;<br />}<br />.csharpcode .lnum { color: #606060; }<br /></style>
                     <br>
                     <br>
                     <p>The identity and access tool also adds the following settings to your application settings section.</p>
                     <br>
                     <blockquote>
                      <pre class="csharpcode">    <span class="kwrd">&lt;</span><span class="html">add</span> <span class="attr">key</span><span class="kwrd">="ida:FederationMetadataLocation"</span> <span class="attr">value</span><span class="kwrd">="https://idserv/FederationMetadata/2007-06/FederationMetadata.xml"</span> <span class="kwrd">/&gt;</span><br>    <span class="kwrd">&lt;</span><span class="html">add</span> <span class="attr">key</span><span class="kwrd">="ida:Issuer"</span> <span class="attr">value</span><span class="kwrd">="https://Idserv/adfs/ls/"</span> <span class="kwrd">/&gt;</span><br>    <span class="kwrd">&lt;</span><span class="html">add</span> <span class="attr">key</span><span class="kwrd">="ida:ProviderSelection"</span> <span class="attr">value</span><span class="kwrd">="productionSTS"</span> <span class="kwrd">/&gt;</span></pre>
                     </blockquote>
                     <br>
                     <style type="text/css">.csharpcode, .csharpcode pre<br />{<br />	font-size: small;<br />	color: black;<br />	font-family: consolas, "Courier New", courier, monospace;<br />	background-color: #ffffff;<br />	/*white-space: pre;*/<br />}<br />.csharpcode pre { margin: 0em; }<br />.csharpcode .rem { color: #008000; }<br />.csharpcode .kwrd { color: #0000ff; }<br />.csharpcode .str { color: #006080; }<br />.csharpcode .op { color: #0000c0; }<br />.csharpcode .preproc { color: #cc6633; }<br />.csharpcode .asp { background-color: #ffff00; }<br />.csharpcode .html { color: #800000; }<br />.csharpcode .attr { color: #ff0000; }<br />.csharpcode .alt <br />{<br />	background-color: #f4f4f4;<br />	width: 100%;<br />	margin: 0em;<br />}<br />.csharpcode .lnum { color: #606060; }<br /></style>
                     <br>
                     <br>
                     <p>With the above complete, when you run the application you should be presented with the default ADFS login authentication homepage as below.&nbsp; At this point the login process will fail as you have not configured the “relying party trust” in ADFS 2.0.&nbsp; ADFS does not know whether the user has access to the relying application.&nbsp; <em>As articulated in my previous post, relying party is a MS linguistic, service-provider is more environment agnostic.</em><img alt="image" border="0" height="240" src="http://lh4.ggpht.com/-dr_8RgXymc4/UPM5_jZyZ2I/AAAAAAAAAFM/wf_TjqrcGnU/image_thumb%25255B27%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" title="image" width="435"> </p>
                     <br>
                     <p><a href="http://lh6.ggpht.com/-FC9VAFpyyDA/UPM6AUY1UjI/AAAAAAAAAFY/aBI1TdHJZBg/s1600-h/image%25255B48%25255D.png"><img alt="image" border="0" height="244" src="http://lh3.ggpht.com/-6mKKxtJNDEE/UPM6BSeevnI/AAAAAAAAAFc/k0r3KEF0CP4/image_thumb%25255B28%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" title="image" width="433"></a>Now your application is configured you need to configure the relying party trust in ADFS 2.0.&nbsp; On your ADFS server, browse to the ADFS 2.0 MMC and select Relying Party Trusts, Add Relying Party Trust.&nbsp; This will launch the relying party configuration wizard.</p>
                     <br>
                     <p><a href="http://lh3.ggpht.com/-6AbKXnnYGFE/UPM6Cf5SrXI/AAAAAAAAAFo/giuzyCB8aWg/s1600-h/image%25255B62%25255D.png"><img alt="image" border="0" height="367" src="http://lh4.ggpht.com/-8NFyEWhjuAA/UPM6Da_X4vI/AAAAAAAAAFs/jqTOu9PLt6I/image_thumb%25255B38%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" title="image" width="443"></a></p>
                     <br>
                     <p>Screen 1, enter data manually</p>
                     <br>
                     <p><a href="http://lh5.ggpht.com/-vFfAOf9URXg/UPM6EGLFyiI/AAAAAAAAAF4/wcJGuxekFjk/s1600-h/image%25255B58%25255D.png"><img alt="image" border="0" height="354" src="http://lh6.ggpht.com/-dyhl9l2y2W4/UPM6FIqik-I/AAAAAAAAAF8/-SdXoTJ78rE/image_thumb%25255B34%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" title="image" width="445"></a></p>
                     <br>
                     <p>Screen 2, Give your application a meaning full name and description.&nbsp; <a href="http://lh3.ggpht.com/-PNobQv87xd4/UPM6GJvXRrI/AAAAAAAAAGE/Stq0dtOjRX8/s1600-h/image%25255B67%25255D.png"><img alt="image" border="0" height="353" src="http://lh3.ggpht.com/-EniLOuTLgUI/UPM6G-3YFNI/AAAAAAAAAGM/RnCakllQ7-8/image_thumb%25255B41%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" title="image" width="444"></a></p>
                     <br>
                     <p>Screen 3, Select ADFS profile <a href="http://lh6.ggpht.com/-R-82ayHv9fw/UPM6HwBPO8I/AAAAAAAAAGU/JGJBNJAyeUk/s1600-h/image%25255B71%25255D.png"><img alt="image" border="0" height="350" src="http://lh4.ggpht.com/-2_R1O5g0ius/UPM6IlRGCUI/AAAAAAAAAGc/HhRuQmAY1RA/image_thumb%25255B43%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" title="image" width="445"></a> Screen 4, Click next.&nbsp; This screen is used to configure the public key provided by your application to encrypt the token send from the identity provider.&nbsp; For the purposes of this post we will not be encrypting tokens.</p>
                     <br>
                     <p><a href="http://lh4.ggpht.com/-WHsYwB_MtyQ/UPM6JvxuzzI/AAAAAAAAAGo/Jk50o1fEl2U/s1600-h/image%25255B76%25255D.png"><img alt="image" border="0" height="353" src="http://lh6.ggpht.com/-GAk1NL_mZYs/UPM6KjfEf3I/AAAAAAAAAGs/Aj7hjziZDhs/image_thumb%25255B46%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" title="image" width="444"></a>Screen 5, provide the endpoint URL for your relying application.&nbsp; This is the home URL as WIF utilises the ASP.NET authentication module architecture to intercept and validate tokens.&nbsp; For this demo I am working from a host called Windows 8.</p>
                     <br>
                     <p><a href="http://lh3.ggpht.com/-aw5RP66CDMQ/UPM6Lcz6A3I/AAAAAAAAAG4/-gZY8AE8AtM/s1600-h/image%25255B81%25255D.png"><img alt="image" border="0" height="358" src="http://lh5.ggpht.com/-sEhPGs4esKY/UPM6MTXsUMI/AAAAAAAAAG8/vwg0t3RUYOQ/image_thumb%25255B49%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" title="image" width="450"></a>Screen 6, add the trust identifier (this is the realm as configured above).&nbsp; The realm is send in the federation url to determine the relying party configuration to utilise at the IDP.</p>
                     <br>
                     <p>&nbsp;<a href="http://lh6.ggpht.com/-2OTqpoqMGKA/UPM6NfOFltI/AAAAAAAAAHI/iCiW5huRJ-A/s1600-h/image%25255B85%25255D.png"><img alt="image" border="0" height="356" src="http://lh5.ggpht.com/-gb7LST5JRk8/UPM6OOXdIhI/AAAAAAAAAHM/nVj3sLfahyM/image_thumb%25255B51%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" title="image" width="454"></a>Screen 7, configure the users to access the relying party (service-provider).&nbsp; Permit all users initially, this can be changed by utilising authorisation rules in ADFS.</p>
                     <br>
                     <p><a href="http://lh4.ggpht.com/-rWWNWx5LFsg/UPM6PAhMSmI/AAAAAAAAAHY/eYarTnbEYIY/s1600-h/image%25255B90%25255D.png"><img alt="image" border="0" height="367" src="http://lh5.ggpht.com/-uOs7Mew89MY/UPM6P8PWy7I/AAAAAAAAAHg/C4TT_vdSGac/image_thumb%25255B54%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" title="image" width="462"></a>Screen 8, Verify your settings and save the Trust, ensuring you open the claim Edit claim rules dialog.</p>
                     <br>
                     <p>You will now be able to login to your application, although at this point no claims have been configured so it is rather useless.&nbsp; The next dialog provides you the ability to configure and forward claims to the relying application. Without any claims your application will see no authentication properties.&nbsp; Below I configure the Name claim to be sent to the ASP.NET application, this is then presented in the ASP.NET Thread.CurrentPrincipal.Name property.</p>
                     <br>
                     <p><a href="http://lh4.ggpht.com/-XdCfUw8MYaU/UPM6QhqyzGI/AAAAAAAAAHo/mcrUxAzNfO4/s1600-h/image%25255B107%25255D.png"><img alt="image" border="0" height="199" src="http://lh3.ggpht.com/-E1ScLK0nb1M/UPM6R1gsmSI/AAAAAAAAAHs/NDgNAGHIzMg/image_thumb%25255B63%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" title="image" width="191"></a></p>
                     <br>
                     <p align="center">Add Rule (Opens Rule Template Wizard)</p>
                     <br>
                     <p align="center"><a href="http://lh5.ggpht.com/-twxAe3RZFL4/UPM6SgUjnzI/AAAAAAAAAH0/HGJZR50xBuo/s1600-h/image%25255B113%25255D.png"><img alt="image" border="0" height="279" src="http://lh4.ggpht.com/-YVRP26ilaps/UPM6TVED5_I/AAAAAAAAAIA/xO_P5jtKv-E/image_thumb%25255B69%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" title="image" width="335"></a> </p>
                     <br>
                     <p align="center">Pass Through or Filter Claim Selection.</p>
                     <br>
                     <p align="center"><a href="http://lh4.ggpht.com/-txxVfDoJjpo/UPM6UHQAkUI/AAAAAAAAAIE/42GBDLYLMVU/s1600-h/image%25255B116%25255D.png"><img alt="image" border="0" height="275" src="http://lh6.ggpht.com/-pDUAcPuZAAI/UPM6U3HnkEI/AAAAAAAAAIQ/AobDfehfP28/image_thumb%25255B72%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; display: inline; border-top-width: 0px" title="image" width="333"></a> </p>
                     <br>
                     <p align="center">Call the rule “Send Name” and select the Name claim type.&nbsp; Click Finish</p>
                     <br>
                     <p align="left">With this now configured your application will be able to login and you should be able to obtain the claim name presented within ASP.NET.&nbsp; If you used the blank ASP.NET MVC 4 template, add a new home controller and copy the code below into the Home View.</p>
                     <br>
                     <blockquote>
                      <pre class="csharpcode">@{<br>    ViewBag.Title = "Index";<br>}<br><br><span class="kwrd">&lt;</span><span class="html">h2</span><span class="kwrd">&gt;</span>Index<span class="kwrd">&lt;/</span><span class="html">h2</span><span class="kwrd">&gt;</span><br><br><span class="kwrd">&lt;</span><span class="html">p</span><span class="kwrd">&gt;</span><br>    @System.Threading.Thread.CurrentPrincipal.Identity.Name<br><span class="kwrd">&lt;/</span><span class="html">p</span><span class="kwrd">&gt;</span><br><br><span class="kwrd">&lt;</span><span class="html">p</span><span class="kwrd">&gt;</span><br>@User.Identity.AuthenticationType<br><span class="kwrd">&lt;/</span><span class="html">p</span><span class="kwrd">&gt;</span></pre>
                     </blockquote>
                     <br>
                     <style type="text/css">.csharpcode, .csharpcode pre<br />{<br />	font-size: small;<br />	color: black;<br />	font-family: consolas, "Courier New", courier, monospace;<br />	background-color: #ffffff;<br />	/*white-space: pre;*/<br />}<br />.csharpcode pre { margin: 0em; }<br />.csharpcode .rem { color: #008000; }<br />.csharpcode .kwrd { color: #0000ff; }<br />.csharpcode .str { color: #006080; }<br />.csharpcode .op { color: #0000c0; }<br />.csharpcode .preproc { color: #cc6633; }<br />.csharpcode .asp { background-color: #ffff00; }<br />.csharpcode .html { color: #800000; }<br />.csharpcode .attr { color: #ff0000; }<br />.csharpcode .alt <br />{<br />	background-color: #f4f4f4;<br />	width: 100%;<br />	margin: 0em;<br />}<br />.csharpcode .lnum { color: #606060; }<br /></style>
                     <br>
                     <br>
                     <p>Once launched and logged in, you have completed the ADFS 2.0 application configuration process.&nbsp; Well Done!</p>
                     <br>
                     <p><a href="http://lh6.ggpht.com/-QjvXInhVCT8/UPM6WO5SJPI/AAAAAAAAAIU/mM5HwZbP0lA/s1600-h/image%25255B122%25255D.png"><img alt="image" border="0" height="118" src="http://lh5.ggpht.com/-zvKPVom3KGQ/UPM6Wwci_cI/AAAAAAAAAIg/xoSGMrJFfWc/image_thumb%25255B74%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" title="image" width="244"></a> </p>
                     <br>
                     <p><a href="http://lh3.ggpht.com/-gZQRSMrqhMI/UPM6X4EoLdI/AAAAAAAAAIo/IZnE9uHglZY/s1600-h/image%25255B119%25255D.png"><img alt="image" border="0" height="148" src="http://lh5.ggpht.com/-sYcrOhbN8hQ/UPM6Y4ECArI/AAAAAAAAAIw/IZvD9u_QhN8/image_thumb%25255B73%25255D.png?imgmax=800" style="border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto" title="image" width="244"></a> </p>
                     <br>
                     <p>Part 2, takes this to another level by modifying the ADFS 2.0 FormsSignIn.aspx to delegate authentication to Dominick Baiers (@leastprivilege) Identity Server v2, enabling custom credential stores.</p> 
                     <div style="clear: both;"></div> 
                    </div> 
                    <div class="post-footer"> 
                     <div class="post-footer-line post-footer-line-1"> 
                      <span class="post-author vcard"> Posted by <span class="fn" itemprop="author" itemscope itemtype="http://schema.org/Person"> 
                        <meta content="https://www.blogger.com/profile/05717200028959447386" itemprop="url"> <a class="g-profile" href="https://www.blogger.com/profile/05717200028959447386" rel="author" title="author profile"> <span itemprop="name">Gary McAllister</span> </a> </span> </span> 
                      <span class="post-timestamp"> at 
                       <meta content="http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html" itemprop="url"> <a class="timestamp-link" href="http://garymcallisteronline.blogspot.com.ar/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html" rel="bookmark" title="permanent link"><abbr class="published" itemprop="datePublished" title="2013-01-13T14:51:00-08:00">14:51</abbr></a> </span> 
                      <span class="reaction-buttons"> </span> 
                      <span class="post-comment-link"> </span> 
                      <span class="post-backlinks post-comment-link"> </span> 
                      <span class="post-icons"> <span class="item-control blog-admin pid-1953183973"> <a href="https://www.blogger.com/post-edit.g?blogID=100826624083918515&amp;postID=3066795278905207542&amp;from=pencil" title="Edit Post"> <img alt="" class="icon-action" height="18" src="https://resources.blogblog.com/img/icon18_edit_allbkg.gif" width="18"> </a> </span> </span> 
                      <div class="post-share-buttons goog-inline-block"> 
                       <a class="goog-inline-block share-button sb-email" href="https://www.blogger.com/share-post.g?blogID=100826624083918515&amp;postID=3066795278905207542&amp;target=email" target="_blank" title="Email This"><span class="share-button-link-text">Email This</span></a>
                       <a class="goog-inline-block share-button sb-blog" href="https://www.blogger.com/share-post.g?blogID=100826624083918515&amp;postID=3066795278905207542&amp;target=blog" onclick="window.open(this.href, &quot;_blank&quot;, &quot;height=270,width=475&quot;); return false;" target="_blank" title="BlogThis!"><span class="share-button-link-text">BlogThis!</span></a>
                       <a class="goog-inline-block share-button sb-twitter" href="https://www.blogger.com/share-post.g?blogID=100826624083918515&amp;postID=3066795278905207542&amp;target=twitter" target="_blank" title="Share to Twitter"><span class="share-button-link-text">Share to Twitter</span></a>
                       <a class="goog-inline-block share-button sb-facebook" href="https://www.blogger.com/share-post.g?blogID=100826624083918515&amp;postID=3066795278905207542&amp;target=facebook" onclick="window.open(this.href, &quot;_blank&quot;, &quot;height=430,width=640&quot;); return false;" target="_blank" title="Share to Facebook"><span class="share-button-link-text">Share to Facebook</span></a>
                       <a class="goog-inline-block share-button sb-pinterest" href="https://www.blogger.com/share-post.g?blogID=100826624083918515&amp;postID=3066795278905207542&amp;target=pinterest" target="_blank" title="Share to Pinterest"><span class="share-button-link-text">Share to Pinterest</span></a>
                       <div class="goog-inline-block google-plus-share-container">
                        <g:plusone source="blogger:blog:plusone" href="http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html" size="medium" width="300" annotation="inline" />
                       </div> 
                      </div> 
                     </div> 
                     <div class="post-footer-line post-footer-line-2"> 
                      <span class="post-labels"> </span> 
                     </div> 
                     <div class="post-footer-line post-footer-line-3"> 
                      <span class="post-location"> </span> 
                     </div> 
                    </div> 
                   </div> 
                   <div class="comments" id="comments"> 
                    <a name="comments"></a> 
                    <h4>10 comments:</h4> 
                    <div class="comments-content"> 
                     <script async src="//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js" type="text/javascript"></script> 
                     <script type="text/javascript">
    (function() {
      var items = [{'id': '2374684772558180348', 'body': 'Hi Gary, thanks for this post. I\x26#39;m currently solving the similar problem: Sharepoint is my Service Provider. Sharepoint communicates with the ADFS 2.0. and ADFS 2.0 communicates with third party Idendity Provider. As I\x26#39;m newbie in ADFS currently I\x26#39;m trying figure out how to delegate the request from Sharepoint to IdP through ADFS. Probably it is what you will write in your next post. May I ask you when do you plane to post the second part of this article? Could you outline the concept of this delegation as I need to finish this integration within this week? thanks in advance. ', 'timestamp': '1358207856607', 'permalink': 'http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment\x3d1358207856607#c2374684772558180348', 'author': {'name': 'martinkar', 'avatarUrl': '//lh3.googleusercontent.com/Rw_wdkZHfDXh8tDEBFF1Q3aSS_nDE-gMVWNfOHb7a2nIp2XuWAmJyGISHv9akZE\x3ds35', 'profileUrl': 'http://martinkar.livejournal.com/'}, 'displayTime': '14 January 2013 at 15:57', 'deleteclass': 'item-control blog-admin pid-689902720'}, {'id': '1546845508623116610', 'body': 'Should be updated tomorrow.', 'timestamp': '1358281016530', 'permalink': 'http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment\x3d1358281016530#c1546845508623116610', 'author': {'name': 'Gary McAllister', 'avatarUrl': '//2.bp.blogspot.com/-lvyw3kwZ5LA/UKT0u24M65I/AAAAAAAAACo/_ZJdkSA2enM/s35/377269_10150382886811400_1883019625_n.jpg', 'profileUrl': 'https://www.blogger.com/profile/05717200028959447386'}, 'displayTime': '15 January 2013 at 12:16', 'deleteclass': 'item-control blog-admin pid-1953183973'}, {'id': '2072614121924991882', 'body': 'Thanks for the awesome write up.  Combined with \x3cbr /\x3eDominick Baier\x26#39;s Identity Server videos, ADFS makes more sense to me.  Waiting eagerly for the second part of this article.  Keep up the good work!', 'timestamp': '1358365699513', 'permalink': 'http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment\x3d1358365699513#c2072614121924991882', 'author': {'name': 'Bookachi', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/09270403649348165347'}, 'displayTime': '16 January 2013 at 11:48', 'deleteclass': 'item-control blog-admin pid-1960026568'}, {'id': '7311495333963586238', 'body': 'Hi,\x3cbr /\x3e\x3cbr /\x3eI\x26#39;m also eagerly awaiting part 2 of your article as well. Thanks for an awesome part 1.', 'timestamp': '1358383435933', 'permalink': 'http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment\x3d1358383435933#c7311495333963586238', 'author': {'name': 'Reynold Barnes', 'avatarUrl': '//lh4.googleusercontent.com/-FLdKlS8aCYc/AAAAAAAAAAI/AAAAAAAAACc/A1WOEGRxPBE/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/15668657038799650140'}, 'displayTime': '16 January 2013 at 16:43', 'deleteclass': 'item-control blog-admin pid-570888220'}, {'id': '8018477182246641059', 'body': 'Hi Gary, its great post and very helpful , i wish if post another article for windows server 2012 adfs 2.1, on premise server', 'timestamp': '1391488671356', 'permalink': 'http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment\x3d1391488671356#c8018477182246641059', 'author': {'name': 'walid', 'avatarUrl': '//4.bp.blogspot.com/-tbKasrQvSlI/TlSvq2yaa2I/AAAAAAAAAJU/c4g-4Ia9xHk/s35/DSCF1026.JPG', 'profileUrl': 'https://www.blogger.com/profile/05818565262504333329'}, 'displayTime': '3 February 2014 at 20:37', 'deleteclass': 'item-control blog-admin pid-1877429072'}, {'id': '1922063391623522765', 'body': 'Hi Gary,\x3cbr /\x3e\x3cbr /\x3eI\x26#39;ve successfully integrated ADFS 2.1 with Thinktecture 2.0. Would you happen to have any intentions or experience with the integration of Thinktecture 2.0 and ADFS 3.0 (2012 R2)', 'timestamp': '1400775507153', 'permalink': 'http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment\x3d1400775507153#c1922063391623522765', 'author': {'name': 'JasonK', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/07610230057952408800'}, 'displayTime': '22 May 2014 at 09:18', 'deleteclass': 'item-control blog-admin pid-982423539'}, {'id': '8756675667511270961', 'body': 'Hi Gary, we now are using Id Server with SharePoint On Prem, which works fine. We are considering going to Office 365. Main goal is that we can share document with extrenal users easily as well and having them to use the credentials that are stored in the Identity Database. Do you know if that\x26#39;s possible?', 'timestamp': '1410938414971', 'permalink': 'http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment\x3d1410938414971#c8756675667511270961', 'author': {'name': 'michiel m', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/04484721427344233229'}, 'displayTime': '17 September 2014 at 00:20', 'deleteclass': 'item-control blog-admin pid-466160153'}, {'id': '7265914923324137562', 'body': 'Hi, now I am very clear on the ADFS its very help full, but how can we handled both ADFS and customer authentication if user not in AD server. Can you provide anything so it would be help us.\x3cbr /\x3e\x3cbr /\x3eThanks,\x3cbr /\x3eP.V.Pratap. ', 'timestamp': '1413874310332', 'permalink': 'http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment\x3d1413874310332#c7265914923324137562', 'author': {'name': 'Pratap Kumar Paluvadi', 'avatarUrl': '//lh4.googleusercontent.com/-O8mSodiox8I/AAAAAAAAAAI/AAAAAAAAAmE/KBIbnTxirVI/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/15475666069823142830'}, 'displayTime': '20 October 2014 at 23:51', 'deleteclass': 'item-control blog-admin pid-1570915550'}, {'id': '5443817671127260354', 'body': 'Great Article\x3cbr /\x3e\x3cbr /\x3e\x3ca href\x3d\x22http://wisenitsolutions.com/IT-Courses/MVC-Training\x22 title\x3d\x22ASP.NET MVC Training\x22 rel\x3d\x22nofollow\x22\x3eASP.NET MVC Training\x3c/a\x3e\x3cbr /\x3e\x3ca href\x3d\x22http://wisentechnologies.com/it-courses/.net-training.aspx\x22 title\x3d\x22Dot Net Training in Chennai\x22 rel\x3d\x22nofollow\x22\x3eDot Net Training in Chennai\x3c/a\x3e', 'timestamp': '1451026912682', 'permalink': 'http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment\x3d1451026912682#c5443817671127260354', 'author': {'name': 'John Peter', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/08425218170331995337'}, 'displayTime': '24 December 2015 at 23:01', 'deleteclass': 'item-control blog-admin pid-1184541341'}, {'id': '5777639551620002485', 'body': 'Nice Article', 'timestamp': '1479731500407', 'permalink': 'http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment\x3d1479731500407#c5777639551620002485', 'author': {'name': 'Vikas', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/14837269436480241810'}, 'displayTime': '21 November 2016 at 04:31', 'deleteclass': 'item-control blog-admin pid-1175411486'}];
      var msgs = {'loadMore': 'Load more...', 'loading': 'Loading...', 'loaded': 'No more.', 'addComment': 'Add comment', 'reply': 'Reply', 'delete': 'Delete'};
      var config = {'blogId': '100826624083918515', 'postId': '3066795278905207542', 'feed': 'http://garymcallisteronline.blogspot.com/feeds/3066795278905207542/comments/default', 'authorName': 'Gary McAllister', 'authorUrl': 'https://www.blogger.com/profile/05717200028959447386', 'baseUri': 'https://www.blogger.com', 'maxThreadDepth': 2};

// <![CDATA[
      var cursor = null;
      if (items && items.length > 0) {
        cursor = parseInt(items[items.length - 1].timestamp) + 1;
      }

      var bodyFromEntry = function(entry) {
        if (entry.gd$extendedProperty) {
          for (var k in entry.gd$extendedProperty) {
            if (entry.gd$extendedProperty[k].name == 'blogger.contentRemoved') {
              return '<span class="deleted-comment">' + entry.content.$t + '</span>';
            }
          }
        }
        return entry.content.$t;
      }

      var parse = function(data) {
        cursor = null;
        var comments = [];
        if (data && data.feed && data.feed.entry) {
          for (var i = 0, entry; entry = data.feed.entry[i]; i++) {
            var comment = {};
            // comment ID, parsed out of the original id format
            var id = /blog-(\d+).post-(\d+)/.exec(entry.id.$t);
            comment.id = id ? id[2] : null;
            comment.body = bodyFromEntry(entry);
            comment.timestamp = Date.parse(entry.published.$t) + '';
            if (entry.author && entry.author.constructor === Array) {
              var auth = entry.author[0];
              if (auth) {
                comment.author = {
                  name: (auth.name ? auth.name.$t : undefined),
                  profileUrl: (auth.uri ? auth.uri.$t : undefined),
                  avatarUrl: (auth.gd$image ? auth.gd$image.src : undefined)
                };
              }
            }
            if (entry.link) {
              if (entry.link[2]) {
                comment.link = comment.permalink = entry.link[2].href;
              }
              if (entry.link[3]) {
                var pid = /.*comments\/default\/(\d+)\?.*/.exec(entry.link[3].href);
                if (pid && pid[1]) {
                  comment.parentId = pid[1];
                }
              }
            }
            comment.deleteclass = 'item-control blog-admin';
            if (entry.gd$extendedProperty) {
              for (var k in entry.gd$extendedProperty) {
                if (entry.gd$extendedProperty[k].name == 'blogger.itemClass') {
                  comment.deleteclass += ' ' + entry.gd$extendedProperty[k].value;
                } else if (entry.gd$extendedProperty[k].name == 'blogger.displayTime') {
                  comment.displayTime = entry.gd$extendedProperty[k].value;
                }
              }
            }
            comments.push(comment);
          }
        }
        return comments;
      };

      var paginator = function(callback) {
        if (hasMore()) {
          var url = config.feed + '?alt=json&v=2&orderby=published&reverse=false&max-results=50';
          if (cursor) {
            url += '&published-min=' + new Date(cursor).toISOString();
          }
          window.bloggercomments = function(data) {
            var parsed = parse(data);
            cursor = parsed.length < 50 ? null
                : parseInt(parsed[parsed.length - 1].timestamp) + 1
            callback(parsed);
            window.bloggercomments = null;
          }
          url += '&callback=bloggercomments';
          var script = document.createElement('script');
          script.type = 'text/javascript';
          script.src = url;
          document.getElementsByTagName('head')[0].appendChild(script);
        }
      };
      var hasMore = function() {
        return !!cursor;
      };
      var getMeta = function(key, comment) {
        if ('iswriter' == key) {
          var matches = !!comment.author
              && comment.author.name == config.authorName
              && comment.author.profileUrl == config.authorUrl;
          return matches ? 'true' : '';
        } else if ('deletelink' == key) {
          return config.baseUri + '/delete-comment.g?blogID='
               + config.blogId + '&postID=' + comment.id;
        } else if ('deleteclass' == key) {
          return comment.deleteclass;
        }
        return '';
      };

      var replybox = null;
      var replyUrlParts = null;
      var replyParent = undefined;

      var onReply = function(commentId, domId) {
        if (replybox == null) {
          // lazily cache replybox, and adjust to suit this style:
          replybox = document.getElementById('comment-editor');
          if (replybox != null) {
            replybox.height = '250px';
            replybox.style.display = 'block';
            replyUrlParts = replybox.src.split('#');
          }
        }
        if (replybox && (commentId !== replyParent)) {
          replybox.src = '';
          document.getElementById(domId).insertBefore(replybox, null);
          replybox.src = replyUrlParts[0]
              + (commentId ? '&parentID=' + commentId : '')
              + '#' + replyUrlParts[1];
          replyParent = commentId;
        }
      };

      var hash = (window.location.hash || '#').substring(1);
      var startThread, targetComment;
      if (/^comment-form_/.test(hash)) {
        startThread = hash.substring('comment-form_'.length);
      } else if (/^c[0-9]+$/.test(hash)) {
        targetComment = hash.substring(1);
      }

      // Configure commenting API:
      var configJso = {
        'maxDepth': config.maxThreadDepth
      };
      var provider = {
        'id': config.postId,
        'data': items,
        'loadNext': paginator,
        'hasMore': hasMore,
        'getMeta': getMeta,
        'onReply': onReply,
        'rendered': true,
        'initComment': targetComment,
        'initReplyThread': startThread,
        'config': configJso,
        'messages': msgs
      };

      var render = function() {
        if (window.goog && window.goog.comments) {
          var holder = document.getElementById('comment-holder');
          window.goog.comments.render(holder, provider);
        }
      };

      // render now, or queue to render when library loads:
      if (window.goog && window.goog.comments) {
        render();
      } else {
        window.goog = window.goog || {};
        window.goog.comments = window.goog.comments || {};
        window.goog.comments.loadQueue = window.goog.comments.loadQueue || [];
        window.goog.comments.loadQueue.push(render);
      }
    })();
// ]]>
  </script> 
                     <div id="comment-holder"> 
                      <div id="bc_0_11C" kind="c">
                       <div id="bc_0_11CT">
                        <div id="bc_0_10T" class="comment-thread" kind="r" t="0" u="0">
                         <ol id="bc_0_10TB">
                          <li id="bc_0_0B" class="comment" kind="b">
                           <div class="avatar-image-container">
                            <img src="//lh3.googleusercontent.com/Rw_wdkZHfDXh8tDEBFF1Q3aSS_nDE-gMVWNfOHb7a2nIp2XuWAmJyGISHv9akZE=s35">
                           </div>
                           <div id="c2374684772558180348" class="comment-block">
                            <div id="bc_0_0M" class="comment-header" kind="m">
                             <cite class="user"><a rel="nofollow" href="http://martinkar.livejournal.com/">martinkar</a></cite>
                             <span class="icon user"></span>
                             <span class="datetime secondary-text"><a rel="nofollow" href="http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment=1358207856607#c2374684772558180348">14 January 2013 at 15:57</a></span>
                            </div>
                            <p id="bc_0_0MC" class="comment-content">Hi Gary, thanks for this post. I'm currently solving the similar problem: Sharepoint is my Service Provider. Sharepoint communicates with the ADFS 2.0. and ADFS 2.0 communicates with third party Idendity Provider. As I'm newbie in ADFS currently I'm trying figure out how to delegate the request from Sharepoint to IdP through ADFS. Probably it is what you will write in your next post. May I ask you when do you plane to post the second part of this article? Could you outline the concept of this delegation as I need to finish this integration within this week? thanks in advance. </p>
                            <span id="bc_0_0MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-689902720"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=100826624083918515&amp;postID=2374684772558180348">Delete</a></span></span>
                           </div>
                           <div id="bc_0_0BR" class="comment-replies"></div>
                           <div id="bc_0_0B_box" class="comment-replybox-single"></div></li>
                          <li id="bc_0_1B" class="comment" kind="b">
                           <div class="avatar-image-container">
                            <img src="//2.bp.blogspot.com/-lvyw3kwZ5LA/UKT0u24M65I/AAAAAAAAACo/_ZJdkSA2enM/s35/377269_10150382886811400_1883019625_n.jpg">
                           </div>
                           <div id="c1546845508623116610" class="comment-block">
                            <div id="bc_0_1M" class="comment-header" kind="m">
                             <cite class="user blog-author"><a rel="nofollow" href="https://www.blogger.com/profile/05717200028959447386">Gary McAllister</a></cite>
                             <span class="icon user blog-author"></span>
                             <span class="datetime secondary-text"><a rel="nofollow" href="http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment=1358281016530#c1546845508623116610">15 January 2013 at 12:16</a></span>
                            </div>
                            <p id="bc_0_1MC" class="comment-content">Should be updated tomorrow.</p>
                            <span id="bc_0_1MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-1953183973"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=100826624083918515&amp;postID=1546845508623116610">Delete</a></span></span>
                           </div>
                           <div id="bc_0_1BR" class="comment-replies"></div>
                           <div id="bc_0_1B_box" class="comment-replybox-single"></div></li>
                          <li id="bc_0_2B" class="comment" kind="b">
                           <div class="avatar-image-container">
                            <img src="//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
                           </div>
                           <div id="c2072614121924991882" class="comment-block">
                            <div id="bc_0_2M" class="comment-header" kind="m">
                             <cite class="user"><a rel="nofollow" href="https://www.blogger.com/profile/09270403649348165347">Bookachi</a></cite>
                             <span class="icon user"></span>
                             <span class="datetime secondary-text"><a rel="nofollow" href="http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment=1358365699513#c2072614121924991882">16 January 2013 at 11:48</a></span>
                            </div>
                            <p id="bc_0_2MC" class="comment-content">Thanks for the awesome write up. Combined with <br>Dominick Baier's Identity Server videos, ADFS makes more sense to me. Waiting eagerly for the second part of this article. Keep up the good work!</p>
                            <span id="bc_0_2MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-1960026568"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=100826624083918515&amp;postID=2072614121924991882">Delete</a></span></span>
                           </div>
                           <div id="bc_0_2BR" class="comment-replies"></div>
                           <div id="bc_0_2B_box" class="comment-replybox-single"></div></li>
                          <li id="bc_0_3B" class="comment" kind="b">
                           <div class="avatar-image-container">
                            <img src="//lh4.googleusercontent.com/-FLdKlS8aCYc/AAAAAAAAAAI/AAAAAAAAACc/A1WOEGRxPBE/s35-c/photo.jpg">
                           </div>
                           <div id="c7311495333963586238" class="comment-block">
                            <div id="bc_0_3M" class="comment-header" kind="m">
                             <cite class="user"><a rel="nofollow" href="https://www.blogger.com/profile/15668657038799650140">Reynold Barnes</a></cite>
                             <span class="icon user"></span>
                             <span class="datetime secondary-text"><a rel="nofollow" href="http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment=1358383435933#c7311495333963586238">16 January 2013 at 16:43</a></span>
                            </div>
                            <p id="bc_0_3MC" class="comment-content">Hi,<br><br>I'm also eagerly awaiting part 2 of your article as well. Thanks for an awesome part 1.</p>
                            <span id="bc_0_3MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-570888220"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=100826624083918515&amp;postID=7311495333963586238">Delete</a></span></span>
                           </div>
                           <div id="bc_0_3BR" class="comment-replies"></div>
                           <div id="bc_0_3B_box" class="comment-replybox-single"></div></li>
                          <li id="bc_0_4B" class="comment" kind="b">
                           <div class="avatar-image-container">
                            <img src="//4.bp.blogspot.com/-tbKasrQvSlI/TlSvq2yaa2I/AAAAAAAAAJU/c4g-4Ia9xHk/s35/DSCF1026.JPG">
                           </div>
                           <div id="c8018477182246641059" class="comment-block">
                            <div id="bc_0_4M" class="comment-header" kind="m">
                             <cite class="user"><a rel="nofollow" href="https://www.blogger.com/profile/05818565262504333329">walid</a></cite>
                             <span class="icon user"></span>
                             <span class="datetime secondary-text"><a rel="nofollow" href="http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment=1391488671356#c8018477182246641059">3 February 2014 at 20:37</a></span>
                            </div>
                            <p id="bc_0_4MC" class="comment-content">Hi Gary, its great post and very helpful , i wish if post another article for windows server 2012 adfs 2.1, on premise server</p>
                            <span id="bc_0_4MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-1877429072"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=100826624083918515&amp;postID=8018477182246641059">Delete</a></span></span>
                           </div>
                           <div id="bc_0_4BR" class="comment-replies"></div>
                           <div id="bc_0_4B_box" class="comment-replybox-single"></div></li>
                          <li id="bc_0_5B" class="comment" kind="b">
                           <div class="avatar-image-container">
                            <img src="//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
                           </div>
                           <div id="c1922063391623522765" class="comment-block">
                            <div id="bc_0_5M" class="comment-header" kind="m">
                             <cite class="user"><a rel="nofollow" href="https://www.blogger.com/profile/07610230057952408800">JasonK</a></cite>
                             <span class="icon user"></span>
                             <span class="datetime secondary-text"><a rel="nofollow" href="http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment=1400775507153#c1922063391623522765">22 May 2014 at 09:18</a></span>
                            </div>
                            <p id="bc_0_5MC" class="comment-content">Hi Gary,<br><br>I've successfully integrated ADFS 2.1 with Thinktecture 2.0. Would you happen to have any intentions or experience with the integration of Thinktecture 2.0 and ADFS 3.0 (2012 R2)</p>
                            <span id="bc_0_5MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-982423539"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=100826624083918515&amp;postID=1922063391623522765">Delete</a></span></span>
                           </div>
                           <div id="bc_0_5BR" class="comment-replies"></div>
                           <div id="bc_0_5B_box" class="comment-replybox-single"></div></li>
                          <li id="bc_0_6B" class="comment" kind="b">
                           <div class="avatar-image-container">
                            <img src="//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
                           </div>
                           <div id="c8756675667511270961" class="comment-block">
                            <div id="bc_0_6M" class="comment-header" kind="m">
                             <cite class="user"><a rel="nofollow" href="https://www.blogger.com/profile/04484721427344233229">michiel m</a></cite>
                             <span class="icon user"></span>
                             <span class="datetime secondary-text"><a rel="nofollow" href="http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment=1410938414971#c8756675667511270961">17 September 2014 at 00:20</a></span>
                            </div>
                            <p id="bc_0_6MC" class="comment-content">Hi Gary, we now are using Id Server with SharePoint On Prem, which works fine. We are considering going to Office 365. Main goal is that we can share document with extrenal users easily as well and having them to use the credentials that are stored in the Identity Database. Do you know if that's possible?</p>
                            <span id="bc_0_6MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-466160153"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=100826624083918515&amp;postID=8756675667511270961">Delete</a></span></span>
                           </div>
                           <div id="bc_0_6BR" class="comment-replies"></div>
                           <div id="bc_0_6B_box" class="comment-replybox-single"></div></li>
                          <li id="bc_0_7B" class="comment" kind="b">
                           <div class="avatar-image-container">
                            <img src="//lh4.googleusercontent.com/-O8mSodiox8I/AAAAAAAAAAI/AAAAAAAAAmE/KBIbnTxirVI/s35-c/photo.jpg">
                           </div>
                           <div id="c7265914923324137562" class="comment-block">
                            <div id="bc_0_7M" class="comment-header" kind="m">
                             <cite class="user"><a rel="nofollow" href="https://www.blogger.com/profile/15475666069823142830">Pratap Kumar Paluvadi</a></cite>
                             <span class="icon user"></span>
                             <span class="datetime secondary-text"><a rel="nofollow" href="http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment=1413874310332#c7265914923324137562">20 October 2014 at 23:51</a></span>
                            </div>
                            <p id="bc_0_7MC" class="comment-content">Hi, now I am very clear on the ADFS its very help full, but how can we handled both ADFS and customer authentication if user not in AD server. Can you provide anything so it would be help us.<br><br>Thanks,<br>P.V.Pratap. </p>
                            <span id="bc_0_7MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-1570915550"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=100826624083918515&amp;postID=7265914923324137562">Delete</a></span></span>
                           </div>
                           <div id="bc_0_7BR" class="comment-replies"></div>
                           <div id="bc_0_7B_box" class="comment-replybox-single"></div></li>
                          <li id="bc_0_8B" class="comment" kind="b">
                           <div class="avatar-image-container">
                            <img src="//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
                           </div>
                           <div id="c5443817671127260354" class="comment-block">
                            <div id="bc_0_8M" class="comment-header" kind="m">
                             <cite class="user"><a rel="nofollow" href="https://www.blogger.com/profile/08425218170331995337">John Peter</a></cite>
                             <span class="icon user"></span>
                             <span class="datetime secondary-text"><a rel="nofollow" href="http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment=1451026912682#c5443817671127260354">24 December 2015 at 23:01</a></span>
                            </div>
                            <p id="bc_0_8MC" class="comment-content">Great Article<br><br><a href="http://wisenitsolutions.com/IT-Courses/MVC-Training" title="ASP.NET MVC Training" rel="nofollow">ASP.NET MVC Training</a><br><a href="http://wisentechnologies.com/it-courses/.net-training.aspx" title="Dot Net Training in Chennai" rel="nofollow">Dot Net Training in Chennai</a></p>
                            <span id="bc_0_8MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-1184541341"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=100826624083918515&amp;postID=5443817671127260354">Delete</a></span></span>
                           </div>
                           <div id="bc_0_8BR" class="comment-replies"></div>
                           <div id="bc_0_8B_box" class="comment-replybox-single"></div></li>
                          <li id="bc_0_9B" class="comment" kind="b">
                           <div class="avatar-image-container">
                            <img src="//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35">
                           </div>
                           <div id="c5777639551620002485" class="comment-block">
                            <div id="bc_0_9M" class="comment-header" kind="m">
                             <cite class="user"><a rel="nofollow" href="https://www.blogger.com/profile/14837269436480241810">Vikas</a></cite>
                             <span class="icon user"></span>
                             <span class="datetime secondary-text"><a rel="nofollow" href="http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html?showComment=1479731500407#c5777639551620002485">21 November 2016 at 04:31</a></span>
                            </div>
                            <p id="bc_0_9MC" class="comment-content">Nice Article</p>
                            <span id="bc_0_9MN" class="comment-actions secondary-text" kind="m"><a kind="i" href="javascript:;" target="_self" o="r">Reply</a><span class="item-control blog-admin pid-1175411486"><a o="d" target="_self" href="https://www.blogger.com/delete-comment.g?blogID=100826624083918515&amp;postID=5777639551620002485">Delete</a></span></span>
                           </div>
                           <div id="bc_0_9BR" class="comment-replies"></div>
                           <div id="bc_0_9B_box" class="comment-replybox-single"></div></li>
                         </ol>
                         <div id="bc_0_10I" class="continue" kind="ci">
                          <a href="javascript:;" target="_self">Add comment</a>
                         </div>
                         <div id="bc_0_10T_box" class="comment-replybox-thread"></div>
                         <div id="bc_0_10L" class="loadmore loaded" kind="rb">
                          <a href="javascript:;" target="_self">Load more...</a>
                         </div>
                        </div>
                       </div>
                      </div> 
                     </div> 
                    </div> 
                    <p class="comment-footer"> </p>
                    <div class="comment-form"> 
                     <a name="comment-form"></a> 
                     <p> </p> 
                     <a href="https://www.blogger.com/comment-iframe.g?blogID=100826624083918515&amp;postID=3066795278905207542" id="comment-editor-src"></a> 
                     <iframe allowtransparency="true" class="blogger-iframe-colorize blogger-comment-from-post" frameborder="0" height="410px" id="comment-editor" name="comment-editor" src="" width="100%"></iframe> 
                     <script src="https://www.blogger.com/static/v1/jsbin/3223910711-comment_from_post_iframe.js" type="text/javascript"></script> 
                     <script type="text/javascript">
      BLOG_CMT_createIframe('https://www.blogger.com/rpc_relay.html');
    </script> 
                    </div> 
                    <p></p> 
                    <div id="backlinks-container"> 
                     <div id="Blog1_backlinks-container"> 
                     </div> 
                    </div> 
                   </div> 
                  </div> 
                 </div>
                </div> 
               </div> 
               <div class="blog-pager" id="blog-pager"> 
                <span id="blog-pager-newer-link"> <a class="blog-pager-newer-link" href="http://garymcallisteronline.blogspot.com.ar/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts_20.html" id="Blog1_blog-pager-newer-link" title="Newer Post">Newer Post</a> </span> 
                <span id="blog-pager-older-link"> <a class="blog-pager-older-link" href="http://garymcallisteronline.blogspot.com.ar/2012/11/claims-explained.html" id="Blog1_blog-pager-older-link" title="Older Post">Older Post</a> </span> 
                <a class="home-link" href="http://garymcallisteronline.blogspot.com.ar/">Home</a> 
               </div> 
               <div class="clear"></div> 
               <div class="post-feeds"> 
                <div class="feed-links">
                  Subscribe to: 
                 <a class="feed-link" href="http://garymcallisteronline.blogspot.com/feeds/3066795278905207542/comments/default" target="_blank" type="application/atom+xml">Post Comments (Atom)</a> 
                </div> 
               </div> 
               <script type="text/javascript">
    window.___gcfg = { 'lang': 'en-GB' };
  </script> 
              </div>
             </div> 
            </div> 
           </div> 
           <div class="column-left-outer"> 
            <div class="column-left-inner"> 
             <aside> 
             </aside> 
            </div> 
           </div> 
           <div class="column-right-outer"> 
            <div class="column-right-inner"> 
             <aside> 
              <div class="sidebar section" id="sidebar-right-1">
               <div class="widget Profile" data-version="1" id="Profile1"> 
                <h2>About Me</h2> 
                <div class="widget-content"> 
                 <a href="https://www.blogger.com/profile/05717200028959447386"><img alt="My photo" class="profile-img" height="60" src="//1.bp.blogspot.com/-2KrsHCcyWWk/UKT0IFMynHI/AAAAAAAAACE/OOMluaekxZw/s80/377269_10150382886811400_1883019625_n.jpg" width="80"></a> 
                 <dl class="profile-datablock"> 
                  <dt class="profile-data"> 
                   <a class="profile-name-link g-profile" href="https://www.blogger.com/profile/05717200028959447386" rel="author" style="background-image: url(//www.blogger.com/img/logo-16.png);"> Gary McAllister </a> 
                  </dt> 
                  <dd class="profile-textblock">
                   Enterprise Software Architect living London. Interested in academic engineering principles. Follow me on twitter @GaryMcAllister VIEWS ARE MY OWN AND NOT OF MY EMPLOYER.
                  </dd> 
                 </dl> 
                 <a class="profile-link" href="https://www.blogger.com/profile/05717200028959447386" rel="author">View my complete profile</a> 
                 <div class="clear"></div> 
                 <span class="widget-item-control"> <span class="item-control blog-admin"> <a class="quickedit" href="//www.blogger.com/rearrange?blogID=100826624083918515&amp;widgetType=Profile&amp;widgetId=Profile1&amp;action=editWidget&amp;sectionId=sidebar-right-1" onclick="return _WidgetManager._PopupConfig(document.getElementById(&quot;Profile1&quot;));" target="configProfile1" title="Edit"> <img alt="" height="18" src="https://resources.blogblog.com/img/icon18_wrench_allbkg.png" width="18"> </a> </span> </span> 
                 <div class="clear"></div> 
                </div> 
               </div>
              </div> 
              <table border="0" cellpadding="0" cellspacing="0" class="section-columns columns-2"> 
               <tbody> 
                <tr> 
                 <td class="first columns-cell"> 
                  <div class="sidebar section" id="sidebar-right-2-1">
                   <div class="widget BlogArchive" data-version="1" id="BlogArchive1"> 
                    <h2>Blog Archive</h2> 
                    <div class="widget-content"> 
                     <div id="ArchiveList"> 
                      <div id="BlogArchive1_ArchiveList"> 
                       <ul class="hierarchy"> 
                        <li class="archivedate collapsed"> <a class="toggle" href="javascript:void(0)"> <span class="zippy"> ?&nbsp; </span> </a> <a class="post-count-link" href="http://garymcallisteronline.blogspot.com.ar/2015/"> 2015 </a> <span class="post-count" dir="ltr">(1)</span> 
                         <ul class="hierarchy"> 
                          <li class="archivedate collapsed"> <a class="toggle" href="javascript:void(0)"> <span class="zippy"> ?&nbsp; </span> </a> <a class="post-count-link" href="http://garymcallisteronline.blogspot.com.ar/2015/11/"> November </a> <span class="post-count" dir="ltr">(1)</span> </li> 
                         </ul> </li> 
                       </ul> 
                       <ul class="hierarchy"> 
                        <li class="archivedate collapsed"> <a class="toggle" href="javascript:void(0)"> <span class="zippy"> ?&nbsp; </span> </a> <a class="post-count-link" href="http://garymcallisteronline.blogspot.com.ar/2014/"> 2014 </a> <span class="post-count" dir="ltr">(1)</span> 
                         <ul class="hierarchy"> 
                          <li class="archivedate collapsed"> <a class="toggle" href="javascript:void(0)"> <span class="zippy"> ?&nbsp; </span> </a> <a class="post-count-link" href="http://garymcallisteronline.blogspot.com.ar/2014/01/"> January </a> <span class="post-count" dir="ltr">(1)</span> </li> 
                         </ul> </li> 
                       </ul> 
                       <ul class="hierarchy"> 
                        <li class="archivedate expanded"> <a class="toggle" href="javascript:void(0)"> <span class="zippy toggle-open"> ?&nbsp; </span> </a> <a class="post-count-link" href="http://garymcallisteronline.blogspot.com.ar/2013/"> 2013 </a> <span class="post-count" dir="ltr">(9)</span> 
                         <ul class="hierarchy"> 
                          <li class="archivedate collapsed"> <a class="toggle" href="javascript:void(0)"> <span class="zippy"> ?&nbsp; </span> </a> <a class="post-count-link" href="http://garymcallisteronline.blogspot.com.ar/2013/12/"> December </a> <span class="post-count" dir="ltr">(2)</span> </li> 
                         </ul> 
                         <ul class="hierarchy"> 
                          <li class="archivedate collapsed"> <a class="toggle" href="javascript:void(0)"> <span class="zippy"> ?&nbsp; </span> </a> <a class="post-count-link" href="http://garymcallisteronline.blogspot.com.ar/2013/10/"> October </a> <span class="post-count" dir="ltr">(1)</span> </li> 
                         </ul> 
                         <ul class="hierarchy"> 
                          <li class="archivedate collapsed"> <a class="toggle" href="javascript:void(0)"> <span class="zippy"> ?&nbsp; </span> </a> <a class="post-count-link" href="http://garymcallisteronline.blogspot.com.ar/2013/09/"> September </a> <span class="post-count" dir="ltr">(1)</span> </li> 
                         </ul> 
                         <ul class="hierarchy"> 
                          <li class="archivedate collapsed"> <a class="toggle" href="javascript:void(0)"> <span class="zippy"> ?&nbsp; </span> </a> <a class="post-count-link" href="http://garymcallisteronline.blogspot.com.ar/2013/07/"> July </a> <span class="post-count" dir="ltr">(1)</span> </li> 
                         </ul> 
                         <ul class="hierarchy"> 
                          <li class="archivedate collapsed"> <a class="toggle" href="javascript:void(0)"> <span class="zippy"> ?&nbsp; </span> </a> <a class="post-count-link" href="http://garymcallisteronline.blogspot.com.ar/2013/04/"> April </a> <span class="post-count" dir="ltr">(1)</span> </li> 
                         </ul> 
                         <ul class="hierarchy"> 
                          <li class="archivedate collapsed"> <a class="toggle" href="javascript:void(0)"> <span class="zippy"> ?&nbsp; </span> </a> <a class="post-count-link" href="http://garymcallisteronline.blogspot.com.ar/2013/03/"> March </a> <span class="post-count" dir="ltr">(1)</span> </li> 
                         </ul> 
                         <ul class="hierarchy"> 
                          <li class="archivedate expanded"> <a class="toggle" href="javascript:void(0)"> <span class="zippy toggle-open"> ?&nbsp; </span> </a> <a class="post-count-link" href="http://garymcallisteronline.blogspot.com.ar/2013/01/"> January </a> <span class="post-count" dir="ltr">(2)</span> 
                           <ul class="posts"> 
                            <li><a href="http://garymcallisteronline.blogspot.com.ar/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts_20.html">ASP.NET MVC 4, ADFS 2.0 and 3rd party STS integrat...</a></li> 
                            <li><a href="http://garymcallisteronline.blogspot.com.ar/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html">ASP.NET MVC 4, ADFS 2.0 and 3rd party STS integrat...</a></li> 
                           </ul> </li> 
                         </ul> </li> 
                       </ul> 
                       <ul class="hierarchy"> 
                        <li class="archivedate collapsed"> <a class="toggle" href="javascript:void(0)"> <span class="zippy"> ?&nbsp; </span> </a> <a class="post-count-link" href="http://garymcallisteronline.blogspot.com.ar/2012/"> 2012 </a> <span class="post-count" dir="ltr">(3)</span> 
                         <ul class="hierarchy"> 
                          <li class="archivedate collapsed"> <a class="toggle" href="javascript:void(0)"> <span class="zippy"> ?&nbsp; </span> </a> <a class="post-count-link" href="http://garymcallisteronline.blogspot.com.ar/2012/11/"> November </a> <span class="post-count" dir="ltr">(3)</span> </li> 
                         </ul> </li> 
                       </ul> 
                      </div> 
                     </div> 
                     <div class="clear"></div> 
                     <span class="widget-item-control"> <span class="item-control blog-admin"> <a class="quickedit" href="//www.blogger.com/rearrange?blogID=100826624083918515&amp;widgetType=BlogArchive&amp;widgetId=BlogArchive1&amp;action=editWidget&amp;sectionId=sidebar-right-2-1" onclick="return _WidgetManager._PopupConfig(document.getElementById(&quot;BlogArchive1&quot;));" target="configBlogArchive1" title="Edit"> <img alt="" height="18" src="https://resources.blogblog.com/img/icon18_wrench_allbkg.png" width="18"> </a> </span> </span> 
                     <div class="clear"></div> 
                    </div> 
                   </div>
                  </div> </td> 
                 <td class="columns-cell"> 
                  <div class="sidebar no-items section" id="sidebar-right-2-2"></div> </td> 
                </tr> 
               </tbody> 
              </table> 
              <div class="sidebar no-items section" id="sidebar-right-3"></div> 
             </aside> 
            </div> 
           </div> 
          </div> 
          <div style="clear: both"></div> 
          <!-- columns --> 
         </div> 
         <!-- main --> 
        </div> 
       </div> 
       <div class="main-cap-bottom cap-bottom"> 
        <div class="cap-left"></div> 
        <div class="cap-right"></div> 
       </div> 
      </div> 
      <footer> 
       <div class="footer-outer"> 
        <div class="footer-cap-top cap-top"> 
         <div class="cap-left"></div> 
         <div class="cap-right"></div> 
        </div> 
        <div class="fauxborder-left footer-fauxborder-left"> 
         <div class="fauxborder-right footer-fauxborder-right"></div> 
         <div class="region-inner footer-inner"> 
          <div class="foot no-items section" id="footer-1"></div> 
          <table border="0" cellpadding="0" cellspacing="0" class="section-columns columns-2"> 
           <tbody> 
            <tr> 
             <td class="first columns-cell"> 
              <div class="foot no-items section" id="footer-2-1"></div> </td> 
             <td class="columns-cell"> 
              <div class="foot no-items section" id="footer-2-2"></div> </td> 
            </tr> 
           </tbody> 
          </table> 
          <!-- outside of the include in order to lock Attribution widget --> 
          <div class="foot section" id="footer-3" name="Footer">
           <div class="widget Attribution" data-version="1" id="Attribution1"> 
            <div class="widget-content" style="text-align: center;">
              Simple theme. Powered by 
             <a href="https://www.blogger.com" target="_blank">Blogger</a>. 
            </div> 
            <div class="clear"></div> 
            <span class="widget-item-control"> <span class="item-control blog-admin"> <a class="quickedit" href="//www.blogger.com/rearrange?blogID=100826624083918515&amp;widgetType=Attribution&amp;widgetId=Attribution1&amp;action=editWidget&amp;sectionId=footer-3" onclick="return _WidgetManager._PopupConfig(document.getElementById(&quot;Attribution1&quot;));" target="configAttribution1" title="Edit"> <img alt="" height="18" src="https://resources.blogblog.com/img/icon18_wrench_allbkg.png" width="18"> </a> </span> </span> 
            <div class="clear"></div> 
           </div>
          </div> 
         </div> 
        </div> 
        <div class="footer-cap-bottom cap-bottom"> 
         <div class="cap-left"></div> 
         <div class="cap-right"></div> 
        </div> 
       </div> 
      </footer> 
      <!-- content --> 
     </div> 
    </div> 
    <div class="content-cap-bottom cap-bottom"> 
     <div class="cap-left"></div> 
     <div class="cap-right"></div> 
    </div> 
   </div> 
  </div> 
  <script type="text/javascript">
    window.setTimeout(function() {
        document.body.className = document.body.className.replace('loading', '');
      }, 10);
  </script> 
  <script src="https://apis.google.com/js/plusone.js" type="text/javascript"></script> 
  <script type="text/javascript" src="https://www.blogger.com/static/v1/widgets/2115856256-widgets.js"></script> 
  <script type="text/javascript">
window['__wavt'] = 'AOuZoY7pFcHuJ4bSsJnoLMNQEJba-3lDgw:1506931128978';_WidgetManager._Init('//www.blogger.com/rearrange?blogID\x3d100826624083918515','//garymcallisteronline.blogspot.com.ar/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html','100826624083918515');
_WidgetManager._SetDataContext([{'name': 'blog', 'data': {'blogId': '100826624083918515', 'title': 'GaryMcAllisterOnline', 'url': 'http://garymcallisteronline.blogspot.com.ar/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html', 'canonicalUrl': 'http://garymcallisteronline.blogspot.com/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html', 'homepageUrl': 'http://garymcallisteronline.blogspot.com.ar/', 'searchUrl': 'http://garymcallisteronline.blogspot.com.ar/search', 'canonicalHomepageUrl': 'http://garymcallisteronline.blogspot.com/', 'blogspotFaviconUrl': 'http://garymcallisteronline.blogspot.com.ar/favicon.ico', 'bloggerUrl': 'https://www.blogger.com', 'hasCustomDomain': false, 'httpsEnabled': true, 'enabledCommentProfileImages': true, 'gPlusViewType': 'FILTERED_POSTMOD', 'adultContent': false, 'analyticsAccountNumber': '', 'encoding': 'UTF-8', 'locale': 'en-GB', 'localeUnderscoreDelimited': 'en_gb', 'languageDirection': 'ltr', 'isPrivate': false, 'isMobile': false, 'isMobileRequest': false, 'mobileClass': '', 'isPrivateBlog': false, 'feedLinks': '\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22GaryMcAllisterOnline - Atom\x22 href\x3d\x22http://garymcallisteronline.blogspot.com/feeds/posts/default\x22 /\x3e\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/rss+xml\x22 title\x3d\x22GaryMcAllisterOnline - RSS\x22 href\x3d\x22http://garymcallisteronline.blogspot.com/feeds/posts/default?alt\x3drss\x22 /\x3e\n\x3clink rel\x3d\x22service.post\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22GaryMcAllisterOnline - Atom\x22 href\x3d\x22https://www.blogger.com/feeds/100826624083918515/posts/default\x22 /\x3e\n\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22GaryMcAllisterOnline - Atom\x22 href\x3d\x22http://garymcallisteronline.blogspot.com/feeds/3066795278905207542/comments/default\x22 /\x3e\n', 'meTag': '', 'openIdOpTag': '', 'adsenseHostId': 'ca-host-pub-1556223355139109', 'adsenseHasAds': false, 'ieCssRetrofitLinks': '\x3c!--[if IE]\x3e\x3cscript type\x3d\x22text/javascript\x22 src\x3d\x22https://www.blogger.com/static/v1/jsbin/35781802-ieretrofit.js\x22\x3e\x3c/script\x3e\n\x3c![endif]--\x3e', 'view': '', 'dynamicViewsCommentsSrc': '//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js', 'dynamicViewsScriptSrc': '//www.blogblog.com/dynamicviews/97e2ab1c57854d2e', 'plusOneApiSrc': 'https://apis.google.com/js/plusone.js', 'sharing': {'platforms': [{'name': 'Get link', 'key': 'link', 'shareMessage': 'Get link', 'target': ''}, {'name': 'Facebook', 'key': 'facebook', 'shareMessage': 'Share to Facebook', 'target': 'facebook'}, {'name': 'BlogThis!', 'key': 'blogThis', 'shareMessage': 'BlogThis!', 'target': 'blog'}, {'name': 'Twitter', 'key': 'twitter', 'shareMessage': 'Share to Twitter', 'target': 'twitter'}, {'name': 'Pinterest', 'key': 'pinterest', 'shareMessage': 'Share to Pinterest', 'target': 'pinterest'}, {'name': 'Google+', 'key': 'googlePlus', 'shareMessage': 'Share to Google+', 'target': 'googleplus'}, {'name': 'Email', 'key': 'email', 'shareMessage': 'Email', 'target': 'email'}], 'googlePlusShareButtonWidth': 300, 'googlePlusBootstrap': '\x3cscript type\x3d\x22text/javascript\x22\x3ewindow.___gcfg \x3d {\x27lang\x27: \x27en_GB\x27};\x3c/script\x3e'}, 'hasCustomJumpLinkMessage': false, 'jumpLinkMessage': 'Read more', 'pageType': 'item', 'postId': '3066795278905207542', 'postImageThumbnailUrl': 'http://lh5.ggpht.com/-4s0igXmQ65w/UPM52cP8fiI/AAAAAAAAAEA/xxbn76zVGL8/s72-c/image_thumb%25255B12%25255D.png?imgmax\x3d800', 'postImageUrl': 'http://lh5.ggpht.com/-4s0igXmQ65w/UPM52cP8fiI/AAAAAAAAAEA/xxbn76zVGL8/image_thumb%25255B12%25255D.png?imgmax\x3d800', 'pageName': 'ASP.NET MVC 4, ADFS 2.0 and 3rd party STS integration (IdentityServer2)', 'pageTitle': 'GaryMcAllisterOnline: ASP.NET MVC 4, ADFS 2.0 and 3rd party STS integration (IdentityServer2)'}}, {'name': 'features', 'data': {'lazy_images': 'false', 'unsupported_browser_message': 'false', 'lightbox_img_parsing': 'false', 'video_theatre_support': 'false', 'sharing_get_link_dialog': 'false', 'sharing_native': 'false'}}, {'name': 'messages', 'data': {'edit': 'Edit', 'linkCopiedToClipboard': 'Link copied to clipboard', 'ok': 'Ok', 'postLink': 'Post link'}}, {'name': 'template', 'data': {'name': 'Simple', 'localizedName': 'Simple', 'isResponsive': false, 'isAlternateRendering': false, 'isCustom': false, 'variant': 'simplysimple', 'variantId': 'simplysimple', 'variantName': 'Simply Simple', 'localizedVariantName': 'Simply Simple'}}, {'name': 'view', 'data': {'classic': {'name': 'classic', 'url': '?view\x3dclassic'}, 'flipcard': {'name': 'flipcard', 'url': '?view\x3dflipcard'}, 'magazine': {'name': 'magazine', 'url': '?view\x3dmagazine'}, 'mosaic': {'name': 'mosaic', 'url': '?view\x3dmosaic'}, 'sidebar': {'name': 'sidebar', 'url': '?view\x3dsidebar'}, 'snapshot': {'name': 'snapshot', 'url': '?view\x3dsnapshot'}, 'timeslide': {'name': 'timeslide', 'url': '?view\x3dtimeslide'}, 'isMobile': false, 'title': 'ASP.NET MVC 4, ADFS 2.0 and 3rd party STS integration (IdentityServer2)', 'description': ' Introduction  I am currently going through the architectural process of enabling 3rd party claims authentication via both active directory ...', 'featuredImage': 'http://lh5.ggpht.com/-4s0igXmQ65w/UPM52cP8fiI/AAAAAAAAAEA/xxbn76zVGL8/image_thumb%25255B12%25255D.png?imgmax\x3d800', 'url': 'http://garymcallisteronline.blogspot.com.ar/2013/01/aspnet-mvc-4-adfs-20-and-3rd-party-sts.html', 'type': 'item', 'isSingleItem': true, 'isMultipleItems': false, 'isError': false, 'isPage': false, 'isPost': true, 'isHomepage': false, 'isArchive': false, 'isLabelSearch': false, 'postId': 3066795278905207542}}]);
_WidgetManager._RegisterWidget('_NavbarView', new _WidgetInfo('Navbar1', 'navbar', null, document.getElementById('Navbar1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HeaderView', new _WidgetInfo('Header1', 'header', null, document.getElementById('Header1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogView', new _WidgetInfo('Blog1', 'main', null, document.getElementById('Blog1'), {'cmtInteractionsEnabled': false, 'lightboxEnabled': true, 'lightboxModuleUrl': 'https://www.blogger.com/static/v1/jsbin/538228564-lbx__en_gb.js', 'lightboxCssUrl': 'https://www.blogger.com/static/v1/v-css/368954415-lightbox_bundle.css'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_ProfileView', new _WidgetInfo('Profile1', 'sidebar-right-1', null, document.getElementById('Profile1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogArchiveView', new _WidgetInfo('BlogArchive1', 'sidebar-right-2-1', null, document.getElementById('BlogArchive1'), {'languageDirection': 'ltr', 'loadingMessage': 'Loading\x26hellip;'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AttributionView', new _WidgetInfo('Attribution1', 'footer-3', null, document.getElementById('Attribution1'), {}, 'displayModeFull'));
</script>  
 </body>
</html>