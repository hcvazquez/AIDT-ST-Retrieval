<!doctype html>
<html>
 <head> 
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
  <title>Using Node.js to Interact with Facebook's Graph API</title> 
  <link rel="shortcut icon" href="/assets/favicon.png?v=475c5e3b61"> 
  <meta name="description" content="This post outlines strategies for interacting with Facebook's Graph API using Node.js. Code examples for common operations are provided."> 
  <link href="https://fonts.googleapis.com/css?family=Arvo|Raleway" rel="stylesheet"> 
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet"> 
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet"> 
  <link rel="stylesheet" type="text/css" href="/assets/css/styles.css?v=475c5e3b61"> 
  <link rel="stylesheet" type="text/css" href="/assets/css/loren.css?v=475c5e3b61"> 
  <link rel="stylesheet" type="text/css" href="/assets/css/jPushMenu.css?v=475c5e3b61"> 
  <link rel="stylesheet" type="text/css" href="/assets/css/prism.css?v=475c5e3b61"> 
  <script type="text/javascript" src="/assets/js/jquery-1.9.1.min.js?v=475c5e3b61"></script> 
  <script type="text/javascript" src="/assets/js/prism.js?v=475c5e3b61"></script> 
  <script>
  (function($) {
    var ost = 0;
    $(window).scroll(function() {
      var cOst = $(this).scrollTop();

      if(cOst > 100 && cOst > ost) {
         $('#header').addClass('fixed').removeClass('default');
         $('#mc_embed_signup').addClass('fixed');
      }
      else {
         $('#header').addClass('default').removeClass('fixed');
         $('#mc_embed_signup').removeClass('fixed');
      }

      ost = cOst;
    });
  })(jQuery);
</script> 
  <script type="text/javascript" src="/assets/js/jPushMenu.js?v=475c5e3b61"></script> 
  <script>
jQuery(document).ready(function($) {
	$('.toggle-menu').jPushMenu();
});
</script> 
  <script>
  (function(d) {
    var config = {
      kitId: 'ffz5sus',
      scriptTimeout: 3000,
      async: true
    },
    h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
  })(document);
</script> 
  <meta name="HandheldFriendly" content="True"> 
  <meta name="MobileOptimized" content="320"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"> 
  <link rel="canonical" href="http://lorenstewart.me/2017/03/12/using-node-js-to-interact-with-facebooks-graph-api/"> 
  <meta name="referrer" content="no-referrer-when-downgrade"> 
  <meta property="og:site_name" content="Loren Stewart"> 
  <meta property="og:type" content="article"> 
  <meta property="og:title" content="Using Node.js to Interact with Facebook's Graph API"> 
  <meta property="og:description" content="This post outlines strategies for interacting with Facebook's Graph API using Node.js. Code examples for common operations are provided."> 
  <meta property="og:url" content="http://lorenstewart.me/2017/03/12/using-node-js-to-interact-with-facebooks-graph-api/"> 
  <meta property="article:published_time" content="2017-03-12T23:50:08.000Z"> 
  <meta property="article:modified_time" content="2017-04-03T11:58:35.000Z"> 
  <meta property="article:tag" content="node.js"> 
  <meta property="article:tag" content="api"> 
  <meta property="article:tag" content="express.js"> 
  <meta property="article:tag" content="JavaScript"> 
  <meta name="twitter:card" content="summary"> 
  <meta name="twitter:title" content="Using Node.js to Interact with Facebook's Graph API"> 
  <meta name="twitter:description" content="This post outlines strategies for interacting with Facebook's Graph API using Node.js. Code examples for common operations are provided."> 
  <meta name="twitter:url" content="http://lorenstewart.me/2017/03/12/using-node-js-to-interact-with-facebooks-graph-api/"> 
  <meta name="twitter:label1" content="Written by"> 
  <meta name="twitter:data1" content="Loren Stewart"> 
  <meta name="twitter:label2" content="Filed under"> 
  <meta name="twitter:data2" content="node.js, api, express.js, JavaScript"> 
  <meta name="twitter:site" content="@lorenstewart111"> 
  <meta name="twitter:creator" content="@lorenstewart111"> 
  <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Loren Stewart",
        "logo": "http://lorenstewart.me/ghost/img/ghosticon.jpg"
    },
    "author": {
        "@type": "Person",
        "name": "Loren Stewart",
        "image": {
            "@type": "ImageObject",
            "url": "http://lorenstewart.me/content/images/2017/06/speakr_headshot_cropped.png",
            "width": 2664,
            "height": 2580
        },
        "url": "http://lorenstewart.me/author/lorenseanstewart/",
        "sameAs": [
            "http://codemore.io",
            "https://twitter.com/lorenstewart111"
        ],
        "description": "Writing code with the wonderful devs at Speaker, a data-driven influencer marketing company. Also an educator for Codemore."
    },
    "headline": "Using Node.js to Interact with Facebook&#x27;s Graph API",
    "url": "http://lorenstewart.me/2017/03/12/using-node-js-to-interact-with-facebooks-graph-api/",
    "datePublished": "2017-03-12T23:50:08.000Z",
    "dateModified": "2017-04-03T11:58:35.000Z",
    "keywords": "node.js, api, express.js, JavaScript",
    "description": "This post outlines strategies for interacting with Facebook&#x27;s Graph API using Node.js. Code examples for common operations are provided.",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://lorenstewart.me"
    }
}
    </script> 
  <script type="text/javascript" src="/shared/ghost-url.min.js?v=475c5e3b61"></script> 
  <script type="text/javascript">
ghost.init({
	clientId: "ghost-frontend",
	clientSecret: "798a70529932"
});
</script> 
  <meta name="generator" content="Ghost 0.11"> 
  <link rel="alternate" type="application/rss+xml" title="Loren Stewart" href="http://lorenstewart.me/rss/"> 
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83573568-1', 'auto');
  ga('send', 'pageview');

</script> 
  <style>
    .promo-banner { display: none; }
    .about-author_purus h5 a {
        color: #5ba4e5;
    }
    .about-author_purus h5 a:hover {
        color: #5ba4e5;
    }
</style> 
  <!-- Begin MailChimp Signup Form --> 
  <link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css"> 
  <style type="text/css">
	#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
	/* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style> 
 </head>
 <body class="post-template tag-node-js tag-api tag-express-js tag-javascript">
  <div id="mc_embed_signup"> 
   <form action="//lorenstewart.us14.list-manage.com/subscribe/post?u=ced969084ede5300260257b00&amp;id=ebd8679806" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate> 
    <div id="mc_embed_signup_scroll"> 
     <label for="mce-EMAIL">Get notified about new content</label> 
     <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required> 
     <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--> 
     <div style="position: absolute; left: -5000px;" aria-hidden="true">
      <input type="text" name="b_ced969084ede5300260257b00_ebd8679806" tabindex="-1" value="">
     </div> 
     <div class="clear">
      <input type="submit" value="?" name="subscribe" id="mc-embedded-subscribe" class="button">
     </div> 
    </div> 
   </form> 
  </div> 
  <!--End mc_embed_signup-->   
  <header id="header" class="default "> 
   <button class="toggle-menu menu-left push-body"> <i class="fa fa-bars"></i> </button> 
   <!--<div class="header-author_purus">
                <div class="authorimage_purus" style="background-image: url(/content/images/2017/06/speakr_headshot_cropped.png)"></div>
            <h4 class="authorname_purus"><a href="http://lorenstewart.me/author/lorenseanstewart">Loren Stewart</a></h4>
        </div>--> 
   <div class="post-reading-time"></div> 
  </header> 
  <div class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left"> 
   <section class="menu_purus"> 
    <h6>Menu</h6> 
    <ul> 
     <li class="nav-blog" role="presentation"><a href="http://lorenstewart.me/">Blog</a></li> 
     <li class="nav-search" role="presentation"><a href="http://lorenstewart.me/search/">Search</a></li> 
     <li class="nav-contact" role="presentation"><a href="http://lorenstewart.me/contact/">Contact</a></li> 
     <li class="nav-reading-list" role="presentation"><a href="http://lorenstewart.me/reading-list/">Reading List</a></li> 
     <li class="nav-codemore" role="presentation"><a href="http://codemore.io/">Codemore</a></li> 
    </ul> 
   </section> 
   <section class="subscribe_purus"> 
    <a href="https://twitter.com/lorenstewart111" target="_blank"><i class="fa fa-twitter"></i><span class="hidden_purus">Twitter</span></a> 
    <a href="https://github.com/lorenseanstewart" target="_blank"><i class="fa fa-github"></i><span class="hidden_purus">Github</span></a> 
    <a href="https://www.linkedin.com/in/lsstewart111
" target="_blank"><i class="fa fa-linkedin"></i><span class="hidden_purus">LinkedIn</span></a> 
    <a href="http://feeds.feedburner.com/LorenStewart" target="_blank"><i class="fa fa-rss"></i><span class="hidden_purus">Subscribe</span></a> 
   </section> 
  </div> 
  <main role="main"> 
   <article class="post tag-node-js tag-api tag-express-js tag-javascript article_purus"> 
    <header class="postheader_purus no-cover"> 
     <div class="vertical_purus"> 
      <div class="inner_purus"> 
       <h1 class="posttitle_purus">Using Node.js to Interact with Facebook's Graph API</h1> 
       <ul> 
        <li><time class="date_purus"> Mar 12 2017</time></li> 
       </ul> 
      </div> 
     </div> 
    </header> 
    <div class="wrapper_purus"> 
     <div class="postcontent_purus"> 
      <p>Here's some context about pairing Node.js with Facebook's Graph API. </p> 
      <h5 id="thebad">The Bad:</h5> 
      <ul> 
       <li>Facebook has a JavaScript SDK for interacting with their Graph API, but it's for client-side JavaScript – there is <strong>no Node.js SDK</strong>. </li> 
       <li>Although there are several NPM packages for working with Facebook's Graph API, <strong>no NPM package seems to be as mature as packages for other social media platforms</strong> like <a href="https://github.com/ttezel/twit" target="_blank">Twit</a> for the Twitter API. The best of the few seems to be <a href="https://github.com/node-facebook/facebook-node-sdk" target="_blank">facebook-node-sdk</a>, but I hesitate to rely on it for a business critical app. </li> 
       <li>The Graph API docs have <strong>no examples using vanilla JavaScript</strong> (although there are a few examples using their client-side SDK).</li> 
       <li>At the time of this writing (March 12th, 2017), there are <strong>very few blog posts or tutorial on the topic</strong>.</li> 
      </ul> 
      <h5 id="thegood">The good:</h5> 
      <ul> 
       <li>If you have some examples, using <strong>Facebook's Graph API with Node.js is fun</strong>. </li> 
       <li>This blog post is filled with <strong>useful examples using Node/Express</strong>!</li> 
      </ul> 
      <h4 id="contents">Contents:</h4> 
      <ol> 
       <li>Authorization &amp; Access Tokens </li> 
       <li>Querying the Search Route </li> 
       <li>Querying a Single Graph Object </li> 
       <li>Querying for the Pages a User Manages </li> 
       <li>Posting Content</li> 
      </ol> 
      <p>What's outlined here is based on my app's needs. For example, most people probably don't need to get a list of pages a user manages. Despite this, the actions outlined below can be used as a model for nearly any other request. </p> 
      <p>A common need this post doesn't address is working with response <strong>pagination</strong>. However, working with pagination seems straightforward. The docs for pagination are <a href="https://developers.facebook.com/docs/graph-api/using-graph-api" target="_blank">here</a>.</p> 
      <p>As always, if you have questions or feedback, you can reach me on <a href="https://twitter.com/lorenstewart111" target="_blank">Twitter</a> or via the <a href="http://lorenstewart.me/contact/" target="_blank">Contact form</a>.</p> 
      <h5 id="ajaxlibrary">AJAX library</h5> 
      <p>All the examples below use <a href="https://github.com/request/request-promise" target="_blank">request-promise</a>, so be sure to <code>npm install --save request request-promise</code> and </p> 
      <pre><code class="language-javascript">const request = require('request-promise');  
</code></pre> 
      <p>in your code. </p> 
      <h5 id="nodeframework">Node framework</h5> 
      <p>The examples below you may notice a route or two. As I mentioned above, <a href="http://expressjs.com/" target="_blank">Express.js</a> is my framework of choice, and it's used in several of the examples below.</p> 
      <h3 id="1authorizationampaccesstokens">1. Authorization &amp; Access Tokens</h3> 
      <blockquote> 
       <p>To get started, you need an access token obtained through Facebook authentication. <strong>If you have an access token at your disposal, you can skip the rest of this section.</strong> If you need to get one, read on.</p> 
      </blockquote> 
      <p>Generally, an app acquires a user access token through an authentication procedure. <a href="http://passportjs.org/" target="_blank">Passport.js</a> is a great authentication package for Node.js apps. </p> 
      <p>The Passport.js Facebook authentication strategy comes with a very useful <a href="https://github.com/passport/express-4.x-facebook-example" target="_blank">demo app</a> that uses Express.js. If you need to acquaint yourself with Passport, this repo is a great place to start.</p> 
      <h5 id="gettingatoken">Getting a token</h5> 
      <p>Unfortunately, it isn't as easy as merely firing up the example linked to above and authenticating. <strong>You must to have an app registered with Facebook.</strong> Instructions for doing so can be found <a href="https://developers.facebook.com/docs/apps/register" target="_blank">here</a>. </p> 
      <p>Once you have a registered app, you'll need to use the <code>app_id</code> and <code>app_secret</code> in the config file of your authentication app. Adjust the code in the <a href="https://github.com/passport/express-4.x-facebook-example" target="_blank">demo app</a> so you <code>console.log()</code> the returned access token, as you'll need the token for the requests outlined below.</p> 
      <h5 id="gettingpostpermissions">Getting POST permissions</h5> 
      <p>No all access tokens are created equal. If you intend to post to a user's feed or to a page managed by a user, you need to specifically ask for <code>'publish_actions'</code> and <code>'manage_pages'</code> permissions through a scope object in your authentication. </p> 
      <p>When you ask for these permissions, a user logging in will see a prompt stating your app is requesting these permissions. If the user clicks the okay button, an access token with the specified permissions is generated.</p> 
      <p>To request publish permissions include an object with a scope property in the <code>'/login/facebook'</code> route, as demonstrated below:</p> 
      <pre><code class="language-javascript">app.get('/login/facebook',  
  passport.authenticate('facebook', {
    scope: ['publish_actions', 'manage_pages']
  }
));
</code></pre> 
      <p>If you don't include an object with the <code>scope</code> property, the tokens returned will have <code>'public_profile'</code> permissions only.</p> 
      <p>You may want other permissions, like <code>'user_about_me'</code>, <code>'user_photos'</code>, or <code>'user_feed'</code>, but the two in the code above are the only ones you need for publishing. Take a look at <a href="https://developers.facebook.com/docs/facebook-login/permissions" target="_blank">this page</a> for an outline of different permissions you can request during authorization. </p> 
      <h5 id="facebooksappreviewprocess">Facebook's App Review Process</h5> 
      <p>Without submitting your app to an official FB review process, the above code will only give you <code>'public_profile'</code> access. To request additional permissions you have to prove that you're a well-intentioned developer with a well-intentioned app.</p> 
      <p>For the right to obtain access tokens with additional permissions, you'll have to fill out the 'App Review' section of your app's settings page in the Facebook Developers website. </p> 
      <p><strong>The review process is quite an endeavor</strong>, and requires you to describe your app and submit a video walk-through of how your app is used. </p> 
      <p>Remember, the procedure for getting an access token is not related to interacting with the Graph API. The only reason I mention it is so you can obtain an access token (or an access token with permissions to post), as code examples below require one.</p> 
      <h3 id="2graphapisearch">2. Graph API Search</h3> 
      <p>If have an access token, you're ready to get started.</p> 
      <p>In this section, we'll look at querying users and pages through Facebook's <code>https://graph.facebook.com/v2.8/search</code> url. Other objects should be similar to these, so you can use the examples here as a guide. Here's a list of the object you can search:</p> 
      <ul> 
       <li><code>user</code></li> 
       <li><code>page</code></li> 
       <li><code>event</code></li> 
       <li><code>group</code></li> 
       <li><code>place</code></li> 
       <li><code>placetopic</code></li> 
      </ul> 
      <p>The search route below is a POST endpoint that requires a payload like the one below. The payload object has two properties: a search term (<code>queryTerm</code>) property, and a search type (<code>searchType</code>) property. </p> 
      <p>Although the Node/Express route is a POST route, the request we are sending to the Graph API is a GET.</p> 
      <p>For the app we are building, the value assigned to <code>searchType</code> could be <code>'page'</code> or <code>'user'</code>, and each type will return different properties. In reality, the <code>searchType</code> could be any of the objects listed above. </p> 
      <p>Check out the docs for the <a href="https://developers.facebook.com/docs/graph-api/reference/user/" target="_blank">User</a> object, and <a href="https://developers.facebook.com/docs/graph-api/reference/page/" target="_blank">Page</a> object to see the properties that belong to each object, and can be requested.</p> 
      <pre><code class="language-javascript">const payload = {  
  queryTerm: 'Fiat',
  searchType: 'page'
}
</code></pre> 
      <p>Below is the route:</p> 
      <pre><code class="language-javascript line-numbers">const request = require('request-promise');

module.exports = (app) =&gt; {

  // you'll need to have requested 'user_about_me' permissions
  // in order to get 'quotes' and 'about' fields from search
  const userFieldSet = 'name, link, is_verified, picture';
  const pageFieldSet = 'name, category, link, picture, is_verified';


  app.post('/facebook-search', (req, res) =&gt; {
    const  { queryTerm, searchType } = req.body;

    const options = {
      method: 'GET',
      uri: 'https://graph.facebook.com/search',
      qs: {
        access_token: config.user_access_token,
        q: queryTerm,
        type: searchType,
        fields: searchType === 'page' ? pageFieldSet : userFieldSet
      }
    };

    request(options)
      .then(fbRes =&gt; {
// Search results are in the data property of the response.
// There is another property that allows for pagination of results.
// Pagination will not be covered in this post,
// so we only need the data property of the parsed response.
        const parsedRes = JSON.parse(fbRes).data; 
        res.json(parsedRes);
      })
  });
}
</code></pre> 
      <p>Notice the the <code>fields</code> property and the <code>userFieldSet</code> and <code>pageFieldSet</code> constants. When searching <strong>pages</strong>, the code above requests the <code>'name, category, link, picture, is_verified'</code> fields to be returned. These are all part of the page public profile and do not require special permissions.</p> 
      <p>The <code>fields</code> requested when searching <strong>users</strong> are part of the user public profile. Although these fields are all publicly available, this data will not be returned unless specified in the <code>fields</code> property of the request. </p> 
      <p>The Graph API's search end point only returns publicly available information (<em>I think</em>), and there's a good chance that you'll want more than this; you'll probably want the additional information your user access token permits you.</p> 
      <p>In my case, my employer has clients that manage quite a few Facebook pages. One of these clients will want to search pages, chose one that they manage, and get more info. This requires a second API call – a request for a specific object (in this scenario, a <code>page</code> object) from the Graph API.</p> 
      <h3 id="3queryingasinglegraphobject">3. Querying a Single Graph Object</h3> 
      <p>This section covers what you'll need to do to get information about a single object. The section starts with querying a single user, and ends with querying a single photo.</p> 
      <p>When querying the search route (see above), an id is returned regardless of the object type and fields specified. You need this id to make a single object request(e.g. <code>'page'</code>, <code>'user'</code>, <code>'event'</code>, <code>'photo'</code>, <code>'post'</code>, etc.). </p> 
      <p>Below is an example of querying a single user by id.</p> 
      <p><strong>Permissions:</strong> If you have a Graph object's id, you can request detailed data as long as the access token you're using has permissions for the fields you are requesting.</p> 
      <p>The access token used in the request below has the following permissions:</p> 
      <ul> 
       <li><code>'user_relationships'</code></li> 
       <li><code>'user_about_me'</code></li> 
       <li><code>'user_location'</code></li> 
       <li><code>'user_website'</code></li> 
       <li><code>'user_photos'</code></li> 
       <li><code>'user_posts</code></li> 
       <li><code>'email'</code></li> 
      </ul> 
      <p>Given all the above permissions, the code below will return detailed user information.</p> 
      <p><strong>Other Graph objects can be requested the same way</strong>. The only difference would be the fields specified. </p> 
      <p>If you don't have a <em>user</em> access token from authorization, you can use your <em>app's</em> access token. In the latter case, you'll only be able to request publicly available profile data.</p> 
      <pre><code class="language-javascript line-numbers">app.get('/facebook-search/:id', (req, res) =&gt; {

  // you need permission for most of these fields
  const userFieldSet = 'id, name, about, email, accounts, link, is_verified, significant_other, relationship_status, website, picture, photos, feed';

  const options = {
    method: 'GET',
    uri: `https://graph.facebook.com/v2.8/${req.params.id}`,
    qs: {
      access_token: user_access_token,
      fields: userFieldSet
    }
  };
  request(options)
    .then(fbRes =&gt; {
      res.json(fbRes);
    })
})
</code></pre> 
      <p>Below is the JSON response received when I request my own user data (using an access token all the permissions listed above). I replaced sensitive information with <code>'youwish!'</code>.</p> 
      <pre><code class="language-javascript line-numbers">{
  "id": "1458722400807259",
  "name": "Loren Stewart",
  "email": "youwish!",
  "location": {
    "id": "109434625742337",
    "name": "West Hollywood, California"
  },
  "accounts": {
    "data": [
      {
        "access_token": "youwish!",
        "category": "Internet Company",
        "name": "Codemore",
        "id": "1775471846051866",
        "perms": [
          "ADMINISTER",
          "EDIT_PROFILE",
          "CREATE_CONTENT",
          "MODERATE_CONTENT",
          "CREATE_ADS",
          "BASIC_ADMIN"
        ]
      }
    ],
    "paging": {
      "cursors": {
        "before": "MTc3NTQ3MTg0NjA1MTg2NgZDZD",
        "after": "MTc3NTQ3MTg0NjA1MTg2NgZDZD"
      }
    }
  },
  "link": "https://www.facebook.com/app_scoped_user_id/1458722400807259/",
  "is_verified": false,
  "significant_other": {
    "name": "Alex Galeczka",
    "id": "10210777928898847"
  },
  "relationship_status": "In a relationship",
  "website": "http://lorenstewart.me/",
  "picture": {
    "data": {
      "is_silhouette": false,
      "url": "https://scontent.xx.fbcdn.net/v/t1.0-1/p50x50/14463080_1313697801976387_8357030504322451215_n.jpg?oh=c958013d684d5d409e3523b6a31470cf&amp;oe=5969F623"
    }
  },
  "photos": {
    "data": [
      {
        "created_time": "2015-05-11T12:23:08+0000",
        "id": "994251753920995"
      },
      {
        "created_time": "2014-06-07T01:55:50+0000",
        "name": "Worker bee",
        "id": "810452288967610"
      },   
// the list goes on
    ],
    "paging": {
      "cursors": {
        "before": "T1RrME1qVXhOelV6T1RJd09UazFPakUwTXpFek5Ea3dORGs2TXprME1EZAzVOalF3TmpRM09ETTIZD",
        "after": "TXpReE1USXlOREkxT1RBNE5UZAzVPakV6TWpjNU1EQTFOakE2TXprME1EZAzVOalF3TmpRM09ETTIZD"
      }
    }
  },
  "feed": {
    "data": [
      {
        "message": "Hey all. Don't just delete Uber's app. Delete your account.",
        "created_time": "2017-01-30T02:20:41+0000",
        "id": "1458722400807259_1445514005461432"
      },
      {
        "message": "I'm teaching a React workshop at the end of February ?   \nPlease share with your developer friends. Rachael, lemme know if you want to come and we'll work something out.",
        "story": "Loren Stewart shared an event.",
        "created_time": "2017-01-29T21:00:17+0000",
        "id": "1458722400807259_1445248875487945"
      },
      {
        "story": "Loren Stewart updated his cover photo.",
        "created_time": "2017-01-04T02:56:35+0000",
        "id": "1458722400807259_1418730148139818"
      },
      {
        "story": "Loren Stewart at Artists Palette, Death Valley.",
        "created_time": "2016-12-31T04:19:52+0000",
        "id": "1458722400807259_1415002355179264"
      }
// the list goes on
    ],
    "paging": {
      "previous": "https://graph.facebook.com/v2.8/1458722400807259/feed?since=1485742841&amp;access_token=youwish!&amp;__previous=1",
      "next": "https://graph.facebook.com/v2.8/1458722400807259/feed?access_token=youwish!!"
    }
  }
}
</code></pre> 
      <p>Although a lot of information is returned, much important information is left out. For example, no urls are provided for the photos in my photo library. To get a photo's url, you have to ask for the <code>link</code> field of the photo. <code>photos</code> is a field of a <code>User</code> node; <code>link</code> is field of <code>photo</code>. To get the link of each photo in our response, we need to request a field (<code>link</code>) of a field (<code>photo</code>).</p> 
      <p>The syntax for requesting the field of a field is <code>field{nestedField}</code>. To request more than one nested field, separate them by commas like so: <code>field{nestedField1, nestedField2, nestedField3}</code>. While we're on the topic of cool syntax to work with the Graph API, there's also a way to limit the number of items returned.</p> 
      <p>If I only want two photos returned with my user data, I can specify <code>photos.limit(2)</code>. And if I want to include the link to the photo, the people tagged in the photo, as well as three comments, the syntax would be <code>photos.limit(2){link, tags, comments.limit(3)}</code>.</p> 
      <p>A request for a user's last two photos, along with the link and the last two comments, looks like this:</p> 
      <pre><code class="language-javascript">const getMediaOptions = {  
  method: 'GET',
  uri: `https://graph.facebook.com/v2.8/${user.facebook_id}`,
  qs: {
    access_token: user.access_token,
    type: 'user',
    fields: 'photos.limit(2).order(reverse_chronological){link, comments.limit(2).order(reverse_chronological)}'
  }
};
</code></pre> 
      <p>Notice that I specify the order in which I want the photos back. By specifying <code>.order(reverse_chronological)</code> I get the latest two photos.</p> 
      <pre><code class="language-javascript line-numbers">{
  "photos":{
    "data":[
      {
        "link":"https://www.facebook.com/photo.php?fbid=994251753920995&amp;set=a.393129324033244.98295.100000085382615&amp;type=3",
        "comments":{
          "data":[
            {
              "created_time":"2015-05-11T19:29:01+0000",
              "from":{
                "name":"Danny Human",
                "id":"1245359685745239"
              },
              "message":".......   https://youtu.be/sGiZoE5eqZc",
              "id":"994251753920995_994327993913389"
            },
            {
              "created_time":"2015-05-11T15:24:23+0000",
              "from":{
                "name":"Jose Sapien",
                "id":"1245359685745235"
              },
              "message":"Wish I were there!",
              "id":"994251753920995_994404017239188"
            }
          ]
          "id":"994251753920995"
      },
      {
        "link":"https://www.facebook.com/photo.php?fbid=810452288967610&amp;set=a.260137377332440.73629.100000085382615&amp;type=3",
        "comments":{
          "data":[
            {
              "created_time":"2015-04-19T04:17:01+0000",
              "from":{
                "name":"Danny Human",
                "id":"1245359685745239"
              },
              "message":"OMG!",
              "id":"994251753920995_994327993913389"
            },
            {
              "created_time":"2015-04-19T01:56:13+0000",
              "from":{
                "name":"Jose Sapien",
                "id":"1245359685745235"
              },
              "message":"Is that real!",
              "id":"994251753920995_994404017239188"
            }
          ],

          "id":"810452288967610"
        }
      ]
}
</code></pre> 
      <p>Many thanks to <a href="" target="_blank">Ian Williams</a> for helping me out with the Graph API's unusual query syntax.</p> 
      <h3 id="4queryingforthepagesausermanages">4. Querying for the Pages a User Manages</h3> 
      <p>This request is probably not one you need to use very frequently, but if your app needs to manage the pages for which the user has admin permissions, this example will be useful.</p> 
      <p>In the example below, notice <strong>the <code>fields</code> property is not included</strong> because the data you're requesting is implicit in the url.</p> 
      <p>The user query in section #3 above also returned this information because the user access token that is used has permissions for this information, and <code>'accounts'</code> is specified in the <code>fields</code> property of the request. </p> 
      <p>If you have <code>accounts</code> permissions, and only want a list of accounts the user manages (rather than all user data), then this is the query you want to perform. </p> 
      <pre><code class="language-javascript line-numbers">const options = {  
// let's assume id below is 1458722400807259,
// which is my user id
  method: 'GET',
  uri: `https://graph.facebook.com/v2.8/${req.params.id}/accounts`,
  qs: {
      access_token: user_access_token
  }
};
request(options)  
  .then(fbRes =&gt; {
    res.json(fbRes);
  })
</code></pre> 
      <p>Here's the response:</p> 
      <pre><code class="language-javascript line-numbers">{
  "data": [
      {
          "access_token": "youwish!",
          "category": "Internet Company",
          "name": "Codemore",
          "id": "1775471846051866",
          "perms": [
              "ADMINISTER",
              "EDIT_PROFILE",
              "CREATE_CONTENT",
              "MODERATE_CONTENT",
              "CREATE_ADS",
              "BASIC_ADMIN"
          ]
      }
  ],
  "paging": {
      "cursors": {
          "before": "MTc3NTQ3MTg0NjA1MTg2NgZDZD",
          "after": "MTc3NTQ3MTg0NjA1MTg2NgZDZD"
      }
  }
}
</code></pre> 
      <p>The request above returns the Facebook pages I manage, and since I only manage one page, the list is short!</p> 
      <p>Similar to other responses, there's no url to the Facebook page; that has to be requested separately (see section #5 below).</p> 
      <p>The user permission types with regard to each page/account are also listed in the response, and may be useful to your project.</p> 
      <h5 id="somanyaccesstokens">So many access tokens</h5> 
      <p>When you query for user accounts (i.e. pages they manage), each account returns an access token. If you want to perform an action on that page, this is the token to use.</p> 
      <p>For example, if I wanted to post content to my <a href="https://www.facebook.com/codemore/" target="_blank">Codemore Facebook page</a>, I would need to use the page access token above (not my user access token) in the post request. Since I used my user token to get the page token, the page token has my permissions with regard to that page. For some pages I may be able to post content, other pages I may only be able to read analytics, etc. </p> 
      <h3 id="5postingcontent">5. Posting Content</h3> 
      <p>Below are examples for posting text, images, and videos (the latter have to be under 1GB in size) to a page or a user's feed. We'll start with posting text to a feed.</p> 
      <h5 id="postingtext">Posting text</h5> 
      <pre><code class="language-javascript line-numbers">const id = 'page or user id goes here';  
const access_token = 'for page if posting to a page, for user if posting to a user\'s feed';

const postTextOptions = {  
  method: 'POST',
  uri: `https://graph.facebook.com/v2.8/${id}/feed`,
  qs: {
    access_token: access_token,
    message: 'Hello world!'
  }
};
request(postTextOptions);  
</code></pre> 
      <h5 id="postinganimage">Posting an image</h5> 
      <pre><code class="language-javascript line-numbers">const id = 'page or user id goes here';  
const access_token = 'for page if posting to a page, for user if posting to a user\'s feed';

const postImageOptions = {  
  method: 'POST',
  uri: `https://graph.facebook.com/v2.8/${id}/photos`,
  qs: {
    access_token: access_token,
    caption: 'Caption goes here',
    url: 'Image url goes here'
  }
};
request(postImageOptions)  
</code></pre> 
      <h5 id="postingavideo">Posting a video</h5> 
      <p>Videos over 1GB in size need to be chunk uploaded, and I won't go over that here (because I don't have a good solution yet!). Fortunately, uploading a video (under 1GB) is no more difficult than an image or text.</p> 
      <pre><code class="language-javascript line-numbers">const id = 'page or user id goes here';  
const access_token = 'for page if posting to a page, for user if posting to a user\'s feed';

const postVideoOptions = {  
  method: 'POST',
  uri: `https://graph.facebook.com/v2.8/${id}/videos`,
  qs: {
    access_token: access_token,
    description: 'Caption goes here',
    file_url: 'Video url goes here'
  }
};
request(postVideoOptions);  
</code></pre> 
      <h5 id="uploadingmediawithoutinclusioninfeed">Uploading media without inclusion in feed</h5> 
      <p>It's possible to add an image or video to the library of the user/page without having it show up in their feed. To do this, in the <code>qs</code> property of the request, add the property <code>no_story</code> and set it to <code>true</code>. If <code>no_story</code> isn't specified, Facebook defaults to <code>no_story: false</code> and the upload is visible in the user's/page's feed.</p> 
      <h5 id="gettingtheurlofyourpost">Getting the url of your post</h5> 
      <p>After the POST you can use the returned <code>id</code> or <code>post_id</code> to make another request for the post's url. Uploading an image returns an object with <code>id</code> and <code>post_id</code> properties, while uploading a video or posting text returns only an <code>id</code> property.</p> 
      <p>Here are some example responses:</p> 
      <pre><code class="language-javascript line-numbers">// example video/text post response
{
  id: '323262661405199'
}

// example image post response
{
  id: '323262661405199',
  post_id: '309953479402795_323262661405172'
}
</code></pre> 
      <p>To obtain a url, the field you need to request is <code>'permalink_url'</code>.</p> 
      <pre><code class="language-javascript line-numbers">const fb_id = 'the returned post_id or id goes here';  
const type = '`video` or `post`, see comment below'

const getUrlOptions = {  
  method: 'GET',
  uri: `https://graph.facebook.com/v2.8/${fb_id}`,
    qs: {
      access_token: user_access_token,
      // type should be 'post' for image or text, 
      // and should be 'video' for a video url
      type: type,
      fields: 'permalink_url'
    }
};
return request(getUrlOptions)  
  .then(fbUrlRes =&gt; {
    const permalink = JSON.parse(fbUrlRes).permalink_url;
      if(video) {
        permalink = `https://www.facebook.com${permalink}`;
      }
      return {postUrl: permalink};
  })
</code></pre> 
      <p>Image and text posts return a full url. However, the video response returns only the end of the url so you'll need to construct the full url yourself (see line 19 above). In order to construct a video url, you have to prepend <code>'https://www.facebook.com'</code> to the returned value.</p> 
      <h3 id="nbsp">&nbsp;</h3> 
      <p><em>If you'd like to be notified when I publish new content, sign up for my mailing list in the navbar.</em></p> 
     </div> 
     <footer class="article-footer_purus"> 
      <section class="written-by_purus"> 
       <h6>Written by</h6> 
       <div class="footerflex_purus"> 
        <div class="authorimage_purus" style="background-image: url(/content/images/2017/06/speakr_headshot_cropped.png)"></div> 
        <div class="about-author_purus"> 
         <h4 class="authorname_purus"><a href="http://lorenstewart.me/author/lorenseanstewart">Loren Stewart</a></h4> 
         <p class="authorbio_purus">Writing code with the wonderful devs at Speaker, a data-driven influencer marketing company. Also an educator for Codemore.</p> 
         <h5>Los Angeles, CA</h5> 
         <h5><a href="http://codemore.io" itemprop="url">http://codemore.io</a></h5> 
         <br> 
         <a class="social-icon_purus" href="https://twitter.com/lorenstewart111"><i class="fa fa-twitter"><span class="hidden_purus">@lorenstewart111</span></i></a> 
        </div> 
       </div> 
      </section> 
      <section class="tags-post_purus"> 
       <h6>Tags</h6> 
       <span><a href="/tag/node-js/">node.js</a><a href="/tag/api/">api</a><a href="/tag/express-js/">express.js</a><a href="/tag/javascript/">JavaScript</a></span> 
      </section> 
     </footer> 
    </div> 
   </article> 
   <!-- <div class="wrapper_purus">
        <div class="disqusbox_purus">
            <div id="disqus_thread"><form onsubmit="my.loadDisqus();return false;" class=formBlock><input class="cmd_purus" type=submit value="Load Comments"></form>
            </div>

                    <script type="text/javascript">
                    var disqus_shortname = 'example'; // required: replace example with your Disqus shortname
                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    var disqus_url = "http://lorenstewart.me/2017/03/12/using-node-js-to-interact-with-facebooks-graph-api/";
                    var disqus_identifier = '';
                    var my = my || {};
                    my.loadDisqus = function() {
                        var dsq = document.createElement('script');
                        dsq.type = 'text/javascript';
                        dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    };
                    </script>

                    <noscript>Please enable javascript to <a rel="nofollow" href="http://disqus.com/?ref_noscript">discus this page, powered by Disqus.</a></noscript>
                    <style scoped=scoped>
                    @media print{
                     .disqusbox{display:none}
                    }
                    </style>
        </div>
    </div> --> 
  </main> 
  <aside class="read-next_purus"> 
   <a class="frame-article_purus next-story_purus" href="/2017/06/04/data-validation-a-functional-approach/"> 
    <section> 
     <h2>A Functional Approach to Data Validation</h2> 
     <p>Validating data usually starts out simple, but as requirements change and your app grows, validation logic can quickly become…</p> 
     <time>04 Jun 2017</time> 
    </section> </a> 
   <a class="frame-article_purus prev-story_purus" href="/2017/02/03/twitter-api-uploading-videos-using-node-js/"> 
    <section> 
     <h2>Twitter API: Uploading Videos using Node.js</h2> 
     <p>I work for an influencer marketing and data company, Speakr, and we work with social media APIs all the…</p> 
     <time>03 Feb 2017</time> 
    </section> </a> 
  </aside> 
  <footer class="main-footer_purus" style="background-image: url()"> 
   <div class="wrapper-footer_purus"> 
    <div class="center-footer_purus"> 
     <a target="_blank" href="https://twitter.com/share?text=Using Node.js to Interact with Facebook's Graph API&amp;url=http://lorenstewart.me/2017/03/12/using-node-js-to-interact-with-facebooks-graph-api/"><i class="fa fa-twitter"></i><span class="hidden_purus">Twitter</span></a> 
     <a target="_blank" href="https://www.facebook.com/sharer.php?u=http://lorenstewart.me/2017/03/12/using-node-js-to-interact-with-facebooks-graph-api/"><i class="fa fa-facebook"></i><span class="hidden_purus">Facebook</span></a> 
     <a target="_blank" href="https://plus.google.com/share?url=http://lorenstewart.me/2017/03/12/using-node-js-to-interact-with-facebooks-graph-api/"><i class="fa fa-google-plus"></i> <span class="hidden_purus">Google+</span></a> 
    </div> 
   </div> 
   <div class="copyright_purus"> 
    <p>All content copyright <a href="/">Loren Stewart</a> © 2017 • All rights reserved.<br> Proudly published with <a class="icon-ghost" href="http://ghost.org" target="_blank">Ghost</a></p> 
   </div>
  </footer> 
  <!--
<div class="promo-banner">
  <p>Come to my <a href="http://bit.ly/2kjworkshopbanner" target="_blank">React Workshop</a> in LA!</p>
</div>
--> 
  <script type="text/javascript" src="/assets/js/jquery.fitvids.js?v=475c5e3b61"></script> 
  <script type="text/javascript" src="/assets/js/index1.js?v=475c5e3b61"></script>   
 </body>
</html>